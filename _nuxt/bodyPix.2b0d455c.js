import{d as wd}from"./component.8cd3390c.js";import{A as Id,m as A,s as ai,c as X,a as io,b as Wt,d as on,e as pt,f as Nt,n as Ht,g as ut,h as oo,i as kd,j as Me,k as Vt,l as lt,r as V,o as zr,p as Er,z as Ft,q as $r,t as ao,u as ro,v as J,w as lo,x as co,y as uo,B as _n,C as De,D as Y,E as ri,F as pe,G as Or,H as Lr,I as _r,J as Pr,K as Br,L as ne,M as Vr,N as Wr,O as xd,P as Sd,Q as Nd,R as ho,S as Ve,T as Pn,U as Bn,V as li,W as Hr,X as Gr,Y as Ot,Z as _e,_ as Ur,$ as po,a0 as vd,a1 as jr,a2 as qr,a3 as Vs,a4 as Kr,a5 as Yr,a6 as Cd,a7 as fo,a8 as Xr,a9 as mo,aa as Jr,ab as Zr,ac as be,ad as Qr,ae as dt,af as tl,ag as ci,ah as Td,ai as Dd,aj as el,ak as Bi,al as Vi,am as go,an as nl,ao as bo,ap as Vn,aq as Ad,ar as sl,as as Fd,at as Rd,au as Md,av as il,aw as ol,ax as hn,ay as al,az as rl,aA as ds,aB as zd,aC as Ed,aD as yo,aE as wo,aF as Io,aG as ll,aH as ye,aI as ko,aJ as $d,aK as Od,aL as cl,aM as ul,aN as Je,aO as fe,aP as hl,aQ as Ld,aR as dl,aS as pl,aT as fl,aU as ml,aV as gl,aW as bl,aX as We,aY as nt,aZ as Wn,a_ as yl,a$ as _d,b0 as wl,b1 as Le,b2 as xo,b3 as So,b4 as Pd,b5 as Bd,b6 as Il,b7 as Yt,b8 as kl,b9 as xl,ba as is,bb as Sl,bc as No,bd as vo,be as Ze,bf as Nl,bg as Vd,bh as Wi,bi as Co,bj as To,bk as Do,bl as Ao,bm as vl,bn as Cl,bo as Tl,bp as Dl,bq as Al,br as Fl,bs as os,bt as Fo,bu as Wd,bv as Rl,bw as Ml,bx as Ro,by as zl,bz as El,bA as Hd,bB as Mo,bC as zo,bD as Eo,bE as $o,bF as $l,bG as Gd,bH as Ud,bI as Oo,bJ as Ol,bK as Lo,bL as Hn,bM as Ll,bN as _l,bO as Pl,bP as ps,bQ as jd,bR as Bl,bS as qd,bT as _o,bU as Kd,bV as Vl,bW as Po,bX as Bo,bY as Wl,bZ as Yd,b_ as Hl,b$ as ui,c0 as Gl,c1 as gn,c2 as Vo,c3 as oe,c4 as Ul,c5 as Xd,c6 as F,c7 as fn,c8 as Jd,c9 as Zd,ca as jl,cb as Hi,cc as Mn,cd as Qd,ce as tp,cf as ep,cg as np,ch as sp,ci as ip,cj as ql,ck as op,cl as ap,cm as rp,cn as Xt,co as Re,cp as Kl,cq as Yl,cr as lp,cs as Xl,ct as cp,cu as up,cv as hp,cw as Wo,cx as dp,cy as pp,cz as fp,cA as mp,cB as gp,cC as bp,cD as yp,cE as wp,cF as Ip,cG as kp,cH as Jl,cI as xp,cJ as Sp,cK as Zl,cL as Np,cM as Ql,cN as vp,cO as Cp,cP as tc,cQ as zn,cR as Lt,cS as ec,cT as Ho,cU as Tp,cV as Dp,cW as Ap,cX as Ws,cY as Go,cZ as ae,c_ as Fp,c$ as nc,d0 as Rp,d1 as Mp,d2 as Gn,d3 as zp,d4 as Ep,d5 as $p,d6 as Op,d7 as Lp,d8 as sc,d9 as ic,da as _p,db as Uo,dc as hi,dd as Pp,de as Ne,df as Bp,dg as Vp,dh as jo,di as Wp,dj as Hp,dk as Hs,dl as oc,dm as D,dn as Gs,dp as qo,dq as ac,dr as Ko,ds as Gp,dt as Ea,du as Us,dv as Up,dw as jp,dx as qp,dy as Kp,dz as Yp,dA as B,dB as di,dC as rc,dD as Xp,dE as Jp,dF as fs,dG as ms,dH as Zp,dI as Jt,dJ as St,dK as Gi,dL as Yo,dM as Pe,dN as Qp,dO as $a,dP as tf,dQ as xn,dR as ef,dS as nf,dT as sf,dU as of,dV as Oa,dW as af,dX as se,dY as rf,dZ as lf,d_ as cf,d$ as Xo,e0 as uf,e1 as hf,e2 as df,e3 as pf,e4 as ff,e5 as lc,e6 as Jo,e7 as La,e8 as mf,e9 as gf,ea as js,eb as bf,ec as yf,ed as wf,ee as pi,ef as If,eg as cc,eh as Bt,ei as Q,ej as kf,ek as xf,el as bt,em as Qe,en as bn,eo as yn,ep as Sf,eq as Nf,er as ct,es as vf,et as as,eu as Cf,ev as Zt,ew as He,ex as wn,ey as an,ez as Tf,eA as Un,eB as gs,eC as fi,eD as uc,eE as hc,eF as dc,eG as Df,eH as Af,eI as En,eJ as Ff,eK as pc,eL as Rf,eM as Mf,eN as zf,eO as Fi,eP as rs,eQ as Se,eR as Ef,eS as Zo,eT as jn,eU as jt,eV as $f,eW as Qo,eX as Of,eY as Lf,eZ as _f,e_ as mi,e$ as Pf,f0 as Bf,f1 as Vf,f2 as Wf,f3 as Hf,f4 as Gf,f5 as Uf,f6 as ta,f7 as ea,f8 as ns,f9 as na,fa as An,fb as fc,fc as jf,fd as sa,fe as qf,ff as Kf,fg as Yf,fh as Xf,fi as Jf,fj as Zf,fk as Qf,fl as ia,fm as tm,fn as em,fo as nm,fp as sm,fq as im,fr as om,fs as mc,ft as gc,fu as am,fv as rm,fw as lm,fx as cm,fy as bc,fz as um,fA as hm,fB as dm,fC as pm,fD as fm,fE as mm,fF as gm,fG as bm,fH as ym,fI as wm,fJ as Im,fK as km,fL as xm,fM as Sm,fN as Nm,fO as vm,fP as yc,fQ as wc,fR as Ic,fS as Cm,fT as Tm,fU as Dm,fV as kc,fW as Am,fX as Fm,fY as Rm,fZ as Mm,f_ as zm,f$ as Em,g0 as $m,g1 as Om,g2 as Lm,g3 as _m,g4 as Pm,g5 as Bm,g6 as Vm,g7 as Wm,g8 as Hm,g9 as Gm,ga as Um,gb as jm,gc as qm,gd as Km,ge as Ym,gf as oa,gg as Tn,gh as Xm,gi as Jm,gj as Zm,gk as Qm,gl as tg,gm as eg,gn as xc,go as ng,gp as sg,gq as ig,gr as og,gs as ag,gt as rg,gu as lg,gv as cg,gw as ug,gx as hg,gy as dg,gz as pg,gA as fg,gB as mg,gC as gg,gD as bg,gE as yg,gF as wg,gG as aa,gH as Ig,gI as kg,gJ as xg,gK as Sg,gL as Ng,gM as vg,gN as Cg,gO as Tg,gP as Dg,gQ as Ag,gR as Fg,gS as Rg,gT as Mg,gU as zg,gV as Eg,gW as $g,gX as Og,gY as Lg,gZ as _g,g_ as Pg,g$ as Bg,h0 as Vg,h1 as Wg,h2 as Hg,h3 as Gg,h4 as Ug,h5 as jg,h6 as qg,h7 as Kg,h8 as Yg,h9 as Xg,ha as Jg,hb as Zg,hc as Qg,hd as tb,he as eb,hf as Sc,hg as Nc,hh as nb,hi as sb,hj as ib}from"./graph_model.007d961f.js";import{a as ob,b as ab,e as Cn,o as rb}from"./entry.2d6086a8.js";/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vc={kernelName:Id,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>A(n,ai(X(e,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lb={kernelName:io,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>{const s=Wt(X(e,"float32")),i=on(pt(Nt(1),s));return Ht(ut(n,i))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cb={kernelName:oo,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>{const s=on(pt(Wt(X(e,"float32")),1));return ut(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ub={kernelName:kd,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,i=Me(e.shape,s.shape);return{a:()=>{let r=n;const l=Vt(e.shape,i);return l.length>0&&(r=lt(r,l)),V(r,e.shape)},b:()=>{let r=n;const l=Vt(s.shape,i);return l.length>0&&(r=lt(r,l)),V(r,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hb={kernelName:zr,saveAllInputs:!0,gradFunc:(n,t)=>{const e={};return t.forEach((s,i)=>{e[i]=()=>n.clone()}),e}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const db={kernelName:Er,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>Ft(e)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pb={kernelName:$r,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>Ft(e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fb={kernelName:ao,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ut(n,on(pt(Nt(1),Wt(X(e,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mb={kernelName:ro,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>{const s=on(J(Nt(1),Wt(X(e,"float32"))));return ut(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gb={kernelName:lo,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,i=Me(e.shape,s.shape);return{a:()=>{const r=J(Wt(e),Wt(s));let l=A(n,ut(s,r));const c=Vt(e.shape,i);return c.length>0&&(l=lt(l,c)),V(l,e.shape)},b:()=>{const r=J(Wt(e),Wt(s));let l=Ht(A(n,ut(e,r)));const c=Vt(s.shape,i);return c.length>0&&(l=lt(l,c)),V(l,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bb={kernelName:co,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ut(n,J(Wt(X(e,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yb={kernelName:uo,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ut(n,pt(Nt(1),Wt(X(e,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wb(n,t,e,s,i,o){const a=De(n,"dy","avgPool3dGrad"),r=De(t,"input","avgPool3dGrad");let l=a,c=r,u=!1;r.rank===4&&(u=!0,l=V(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),c=V(r,[1,r.shape[0],r.shape[1],r.shape[2],r.shape[3]])),Y(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),Y(c.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${c.rank}.`),ri("avgPool3dGrad",i,o);const d={dy:l,input:c},h={filterSize:e,strides:s,pad:i,dimRoundingMode:o},p=pe.runKernel(Or,d,h);return u?V(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const Ib=_n({avgPool3dGrad_:wb});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kb={kernelName:Lr,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{filterSize:i,strides:o,pad:a,dimRoundingMode:r}=e;return{x:()=>Ib(n,s,i,o,a,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xb(n,t,e,s,i){const o=De(n,"dy","avgPoolGrad"),a=De(t,"input","avgPoolGrad");Y(a.rank===o.rank,()=>`Rank of input (${a.rank}) does not match rank of dy (${o.rank})`);let r=a,l=o,c=!1;a.rank===3&&(c=!0,r=V(a,[1,a.shape[0],a.shape[1],a.shape[2]]),l=V(o,[1,o.shape[0],o.shape[1],o.shape[2]])),Y(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),Y(r.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${r.rank}.`);const u={dy:l,input:r},d={filterSize:e,strides:s,pad:i},h=pe.runKernel(_r,u,d);return c?V(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const Sb=_n({avgPoolGrad_:xb});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nb={kernelName:Pr,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{filterSize:i,strides:o,pad:a}=e;return{x:()=>Sb(n,s,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vb={kernelName:Br,inputsToSave:["a","b"],gradFunc:(n,t,e)=>{const[s,i]=t,{transposeA:o,transposeB:a}=e;return!o&&!a?{a:()=>ne(n,i,!1,!0),b:()=>ne(s,n,!0,!1)}:!o&&a?{a:()=>ne(n,i,!1,!1),b:()=>ne(n,s,!0,!1)}:o&&!a?{a:()=>ne(i,n,!1,!0),b:()=>ne(s,n,!1,!1)}:{a:()=>ne(i,n,!0,!0),b:()=>ne(n,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cb={kernelName:Vr,gradFunc:(n,t,e)=>{const{blockShape:s,crops:i}=e;return{x:()=>Wr(n,s,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tb={kernelName:xd,gradFunc:(n,t,e)=>{const s=e,i=s.inputShape,o=s.shape,a=Array.from(o);for(let l=i.length-1;l>=0;l--)if(i[l]===o[l])a[l]=1;else if(i[l]!==1)throw new Error(`broadcastTo(): [${i}] cannot be broadcast to [${o}].`);const r=[];for(let l=0;l<a.length;l++)a[l]>1&&r.push(l);return{x:()=>lt(n,r,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Db={kernelName:Sd,gradFunc:n=>({x:()=>n.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ab={kernelName:Nd,gradFunc:n=>({x:()=>Ft(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fb={kernelName:ho,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{clipValueMin:i,clipValueMax:o}=e;return{x:()=>Ve(Pn(Bn(s,i),li(s,o)),n,Ft(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rb={kernelName:Hr,inputsToSave:["x"],gradFunc:vc.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mb={kernelName:Gr,saveAllInputs:!0,gradFunc:(n,t,e)=>{const s=t.map(l=>l.shape),{axis:i}=e,o=Ot(i,t[0].shape)[0],a=s.map(l=>l[o]);return _e(n,a,o).map(l=>()=>l)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zb={kernelName:Ur,inputsToSave:["x","filter"],gradFunc:(n,t,e)=>{const[s,i]=t,{dilations:o,strides:a,pad:r,dataFormat:l}=e;return Y(po(o),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`),{x:()=>vd(s.shape,n,i,a,r,l),filter:()=>jr(s,n,i.shape,a,r,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eb={kernelName:qr,inputsToSave:["dy","filter"],gradFunc:(n,t,e)=>{const[s,i]=t,{strides:o,pad:a,dataFormat:r,dimRoundingMode:l}=e;return{dy:()=>Vs(n,i,o,a,r,1,l),filter:()=>jr(n,s,i.shape,o,a,r,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $b(n,t,e,s,i){let o=n;n.rank===4&&(o=V(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let a=t;a.rank===4&&(a=V(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),Y(o.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${o.shape}.`),Y(a.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${a.shape}.`),Y(e.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${e}.`),Y(o.shape[4]===e[3],()=>`Error in conv3dDerFilter: depth of input ${o.shape[4]}) must match input depth in filter (${e[3]}.`),Y(a.shape[4]===e[4],()=>`Error in conv3dDerFilter: depth of dy (${a.shape[4]}) must match output depth for filter (${e[4]}).`);const r={x:o,dy:a},l={strides:s,pad:i,filterShape:e};return pe.runKernel(Kr,r,l)}const Ob=_n({conv3DBackpropFilter_:$b});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lb={kernelName:Yr,inputsToSave:["x","filter"],gradFunc:(n,t,e)=>{const{dilations:s,strides:i,pad:o}=e;Y(po(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[a,r]=t;return{x:()=>Cd(a.shape,n,r,i,o),filter:()=>Ob(a,n,r.shape,i,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _b={kernelName:fo,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>A(Ht(Xr(X(e,"float32"))),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pb={kernelName:mo,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>A(Jr(X(e,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bb={kernelName:Zr,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{axis:i,exclusive:o,reverse:a}=e;return{x:()=>{const r=be([i],s.rank);let l=Qr(n,i,o,!a);return r!=null&&(l=dt(l,r)),l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vb={kernelName:tl,inputsToSave:["x","filter"],gradFunc:(n,t,e)=>{const{dilations:s,strides:i,pad:o,dimRoundingMode:a}=e,r=s??[1,1];Y(po(r),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${r}'`);const[l,c]=t;return Y(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),Y(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${c.rank}.`),Y(l.shape[3]===c.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${c.shape[2]}.`),Y(ci(i,r),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${i} and dilations '${r}'.`),ri("depthwiseConv2d",o,a),{x:()=>Td(l.shape,n,c,i,o,r,a),filter:()=>Dd(l,n,c.shape,i,o,r,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wb={kernelName:el,inputsToSave:["x","filter"],gradFunc:(n,t,e)=>{const[s,i]=t,o={x:s,filter:i,dy:n},a={x:s,filter:i,dy:n};return{x:()=>pe.runKernel(Bi,o,e),filter:()=>pe.runKernel(Vi,a,e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hb={kernelName:go,outputsToSave:[!0],gradFunc:(n,t)=>{const[e]=t,s={dy:n,y:e};return{x:()=>pe.runKernel(nl,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gb={kernelName:bo,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t,s=A(Vn(Ht(Wt(e))),2/Math.sqrt(Math.PI));return{x:()=>A(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ub={kernelName:Ad,outputsToSave:[!0],gradFunc:(n,t)=>{const[e]=t;return{x:()=>A(n,e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jb={kernelName:sl,inputsToSave:["input"],gradFunc:(n,t)=>{const[e]=t;return{input:()=>V(n,e.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qb={kernelName:Fd,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>A(n,Vn(e))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kb={kernelName:Rd,gradFunc:n=>({x:()=>Ft(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yb={kernelName:Md,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,i=Me(e.shape,s.shape);return{a:()=>{const r=ut(n,X(s,"float32")),l=Vt(e.shape,i);return l.length>0?V(lt(r,l),e.shape):r},b:()=>{let r=A(n,X(e,"float32"));const l=Vt(s.shape,i);l.length>0&&(r=V(lt(r,l),s.shape));const c=Wt(s);return Ht(ut(r,X(c,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xb={kernelName:il,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,t,e)=>{const{varianceEpsilon:s}=e,[i,o,a,r]=t,l=r??Nt(1),c=Vt(o.shape,i.shape),u=[];if(o.rank===1){for(let y=0;y<i.shape.length-1;++y)u.push(i.shape[y]);u.push(1)}const d=pt(i,o),h=A(n,l),p=ol(J(a,Nt(s))),m=A(A(A(p,p),p),Nt(-.5));return{x:()=>o.rank===1?V(A(A(n,hn(V(p,[1,1,1,o.shape[0]]),u)),l),i.shape):V(A(A(n,p),l),i.shape),mean:()=>{let y=A(A(p,Nt(-1)),h);return o.rank===1&&(y=lt(y,c)),V(y,o.shape)},variance:()=>{let y=A(A(m,d),h);return o.rank===1&&(y=lt(y,c)),V(y,o.shape)},scale:()=>{const y=A(d,p);let k=A(n,y);return o.rank===1&&(k=lt(k,c)),V(k,o.shape)},offset:()=>{let y=n;return o.rank===1&&(y=lt(y,c)),V(y,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jb={kernelName:al,inputsToSave:["x","indices"],gradFunc:(n,t,e)=>{const[s,i]=t,{axis:o}=e,a=Ot(o,s.shape)[0];return{x:()=>{const l=s.shape,c=i.size,u=l.slice(0,a),d=u.length,h=l.slice(o,l.length).slice(1),p=h.length,m=_a(0,d),f=_a(d+1,d+1+p),g=Pa([u,[c],h]),w=V(n,g),b=V(i,[c]),I=Pa([[d],m,f]),y=dt(w,I);let k=rl(y,b,s.shape[a]);const x=ds(I);return k=dt(k,x),k},indices:()=>i}}};function _a(n,t){const e=[];for(let s=n;s<t;++s)e.push(s);return e}function Pa(n){const t=[];for(let e=0;e<n.length;++e)for(let s=0;s<n[e].length;++s)t.push(n[e][s]);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zb={kernelName:zd,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t;return{a:()=>Ft(e),b:()=>Ft(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qb={kernelName:Ed,gradFunc:n=>({x:()=>X(n,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ty={kernelName:yo,gradFunc:n=>({x:()=>Ft(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ey={kernelName:wo,gradFunc:n=>({x:()=>Ft(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ny={kernelName:Io,gradFunc:n=>({x:()=>Ft(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sy={kernelName:ll,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{alpha:i}=e,o=ye(s,0);return{x:()=>Ve(o,n,A(n,i))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iy={kernelName:ko,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ut(n,J(e,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oy={kernelName:$d,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ut(n,X(e,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ay={kernelName:Od,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,t,e)=>{const[s]=t,{axis:i}=e;return{logits:()=>{const a=Vn(s);return pt(n,A(lt(n,i,!0),a))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ry(n,t,e,s=5,i=1,o=1,a=.5){const r={x:n,y:t,dy:e},l={depthRadius:s,bias:i,alpha:o,beta:a};return pe.runKernel(cl,r,l)}const ly=_n({localResponseNormalizationBackprop_:ry});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cy={kernelName:ul,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{const[s,i]=t,{depthRadius:o,bias:a,alpha:r,beta:l}=e;return{x:()=>ly(s,i,n,o,a,r,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cc(n,t,e,s){return t.rank<e.rank&&(t=V(t,Je(t.shape,s))),n.rank<e.rank&&(n=V(n,Je(n.shape,s))),{x:()=>A(n,X(fe(e,t),n.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ba={kernelName:hl,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{const s=e,{reductionIndices:i}=s,o=t[0],a=t[1],r=Ot(i,o.shape),l=Cc(n,a,o,r);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uy={kernelName:Ld,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t;return{a:()=>A(n,X(Bn(e,s),"float32")),b:()=>A(n,X(dl(e,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hy(n,t,e,s,i,o,a){const r=De(n,"dy","maxPool3dGrad"),l=De(t,"input","maxPool3dGrad"),c=De(e,"output","maxPool3dGrad");let u=r,d=l,h=c,p=!1;l.rank===4&&(p=!0,u=V(r,[1,r.shape[0],r.shape[1],r.shape[2],r.shape[3]]),d=V(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),h=V(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),Y(u.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),Y(d.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${d.rank}.`),Y(h.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${h.rank}.`),ri("maxPool3dGrad",o,a);const m={dy:u,input:d,output:h},f={filterSize:s,strides:i,pad:o,dimRoundingMode:a},g=pe.runKernel(pl,m,f);return p?V(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}const dy=_n({maxPool3dGrad_:hy});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const py={kernelName:fl,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{const[s,i]=t,{filterSize:o,strides:a,pad:r,dimRoundingMode:l}=e;return{x:()=>dy(n,s,i,o,a,r,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fy(n,t,e,s,i,o,a){const r=De(n,"dy","maxPoolGrad"),l=De(t,"input","maxPoolGrad"),c=De(e,"output","maxPoolGrad");Y(l.rank===r.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${r.rank})`),Y(r.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${r.rank}.`),Y(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),ri("maxPoolGrad",o,a);const u={dy:r,input:l,output:c},d={filterSize:s,strides:i,pad:o,dimRoundingMode:a};return pe.runKernel(ml,u,d)}const my=_n({maxPoolGrad_:fy});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gy={kernelName:gl,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{const[s,i]=t,{filterSize:o,strides:a,pad:r}=e;return{x:()=>my(n,s,i,o,a,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const by={kernelName:bl,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{axis:i}=e,o=Ot(i,s.shape),r=We(s.shape,o)[1],l=nt(r);return{x:()=>{const u=s.shape.slice();o.forEach(p=>{u[p]=1});const d=V(n,u);return ut(A(d,Wn(s.shape,"float32")),l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yy={kernelName:yl,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{const s=e,{axis:i}=s,[o,a]=t,r=Ot(i,o.shape),l=Cc(n,a,o,r);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wy={kernelName:_d,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t;return{a:()=>A(n,X(li(e,s),"float32")),b:()=>A(n,X(ye(e,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iy={kernelName:wl,inputsToSave:["x"],gradFunc:(n,t,e)=>{const s=t[0],{paddings:i}=e,o=i.map(a=>a[0]);return{x:()=>Le(n,o,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ky={kernelName:xo,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,i=Me(e.shape,s.shape);return{a:()=>{const r=Vt(e.shape,i);return r.length>0?V(lt(n,r),e.shape):n},b:()=>{const r=A(n,Ht(So(ut(e,s)))),l=Vt(s.shape,i);return l.length>0?V(lt(r,l),s.shape):r}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xy={kernelName:Pd,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,i=Me(e.shape,s.shape);return{a:()=>{const r=A(n,X(s,"float32")),l=Vt(e.shape,i);return l.length>0?V(lt(r,l),e.shape):r},b:()=>{const r=A(n,X(e,"float32")),l=Vt(s.shape,i);return l.length>0?V(lt(r,l),s.shape):r}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sy={kernelName:Bd,gradFunc:n=>({x:()=>Ht(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ny={kernelName:Il,inputsToSave:["indices"],gradFunc:(n,t)=>{const e=t[0];return{indices:()=>Yt(e.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vy={kernelName:kl,gradFunc:n=>({x:()=>Ft(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cy={kernelName:xl,saveAllInputs:!0,gradFunc:(n,t,e)=>{const{axis:s}=e;return is(n,s).map(o=>()=>o)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Va={kernelName:Sl,inputsToSave:["x"],gradFunc:(n,t,e)=>{const s=t[0],{paddings:i}=e,o=i.map(a=>a[0]);return{x:()=>Le(n,o,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ty={kernelName:No,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,t)=>{const[e,s,i]=t,o=e,a=s,r=Me(o.shape,a.shape);return{a:()=>{const u=X(a,"float32");let d=A(n,A(u,vo(o,pt(u,Nt(1)))));const h=Vt(o.shape,r);return h.length>0&&(d=lt(d,h)),V(d,o.shape)},b:()=>{const u=ye(o,0),d=Ve(u,Ze(o),Ft(o));let h=A(n,A(i,d));const p=Vt(a.shape,r);return p.length>0&&(h=lt(h,p)),V(h,a.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dy={kernelName:Nl,inputsToSave:["x","alpha"],gradFunc:(n,t)=>{const[e,s]=t,i=ye(e,0);return{x:()=>Ve(i,n,A(n,s)),alpha:()=>{let o=Ve(i,Ft(n),A(n,e));const a=Vt(s.shape,n.shape);return a.length>0&&(o=lt(o,a)),V(o,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ay(n,t,e){const s=n.shape.slice();s[e]=1;const i=V(t,s),o=Wi(n,e,!0,!1),a=Wi(n,e,!0,!0),r=A(o,a);return A(i,r)}function Fy(n,t,e){const s=n.shape.length,i=s-e.length,o=be(e,s);let a=n;o!=null&&(a=dt(n,o));const r=a.shape.slice(),c=r.splice(s-e.length,e.length).reduce((h,p)=>h*p,1);r.push(c);const u=a.reshape(r);let d=Ay(u,t,i);if(d=d.reshape(a.shape),o!=null){const h=ds(o);d=dt(d,h)}return d}const Ry={kernelName:Vd,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{axis:i}=e;let o=[];return i==null?o=s.shape.map((a,r)=>r):typeof i=="number"?o=[i]:o=i,{x:()=>Fy(s,n,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const My={kernelName:Co,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,i=Me(e.shape,s.shape);return{a:()=>{const r=ut(n,X(s,"float32")),l=Vt(e.shape,i);return l.length>0?V(lt(r,l),e.shape):r},b:()=>{let r=A(n,X(e,"float32"));const l=Vt(s.shape,i);l.length>0&&(r=V(lt(r,l),s.shape));const c=Wt(s);return Ht(ut(r,X(c,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zy={kernelName:To,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ut(n,Ht(Wt(e)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ey={kernelName:Do,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t,s=A(li(e,6),ai(e));return{x:()=>A(n,X(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $y={kernelName:Ao,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>A(n,X(ai(e),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oy={kernelName:vl,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>V(n,e.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ly={kernelName:Cl,inputsToSave:["images"],gradFunc:(n,t,e)=>{const[s]=t,i={dy:n,images:s};return{images:()=>pe.runKernel(Tl,i,e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _y={kernelName:Dl,inputsToSave:["images"],gradFunc:(n,t,e)=>{const[s]=t,i={dy:n,images:s};return{images:()=>pe.runKernel(Al,i,e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Py={kernelName:Fl,gradFunc:(n,t,e)=>{const{dims:s}=e,i=Ot(s,n.shape);return{x:()=>os(n,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const By={kernelName:Fo,gradFunc:n=>({x:()=>Ft(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vy={kernelName:Wd,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>Ht(ut(n,A(vo(e,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wy={kernelName:Rl,inputsToSave:["condition"],gradFunc:(n,t)=>{const[e]=t;return{condition:()=>X(Ft(e),"float32"),t:()=>A(n,X(e,n.dtype)),e:()=>A(n,X(Ml(e),n.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hy={kernelName:Ro,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>{const s=ye(e,Nt(0)),i=Nt(zl),o=Nt(El),a=A(n,o),r=A(A(n,i),Vn(X(e,"float32")));return Ve(s,a,r)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gy={kernelName:Hd,outputsToSave:[!0],gradFunc:(n,t)=>{const[e]=t;return{x:()=>A(n,A(e,pt(Nt(1),e)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uy={kernelName:Mo,gradFunc:n=>({x:()=>Ft(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jy={kernelName:zo,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>A(Eo(X(e,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qy={kernelName:$o,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>A($l(X(e,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ky={kernelName:Gd,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{begin:i,size:o}=e,a=s.shape,[r,l]=Ud(s,i,o),c=[];for(let u=0;u<n.rank;u++)c.push([r[u],a[u]-r[u]-l[u]]);return{x:()=>Oo(n,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yy={kernelName:Ol,outputsToSave:[!0],gradFunc:(n,t,e)=>{const[s]=t,{dim:i}=e,o=!0,a=A(n,s);return{logits:()=>pt(a,A(lt(a,[i],o),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xy={kernelName:Lo,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>A(n,Hn(e))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wa={kernelName:Ll,gradFunc:(n,t,e)=>{const{blockShape:s,paddings:i}=e;return{x:()=>_l(n,s,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ha={kernelName:Pl,gradFunc:(n,t,e)=>{const{axis:s}=e;return{x:()=>ps(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jy={kernelName:jd,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ut(n,A(on(X(e,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zy={kernelName:Bl,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>A(n,A(X(e,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qy={kernelName:qd,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,i=Nt(2);return{a:()=>A(n,A(i,pt(e,s))),b:()=>A(n,A(i,pt(s,e)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tw={kernelName:_o,gradFunc:n=>({x:()=>Ft(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ew={kernelName:Kd,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,i=Me(e.shape,s.shape);return{a:()=>{let r=n;const l=Vt(e.shape,i);return l.length>0&&(r=lt(r,l)),V(r,e.shape)},b:()=>{let r=n;const l=Vt(s.shape,i);return l.length>0&&(r=lt(r,l)),V(Ht(r),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nw={kernelName:Vl,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,i=s.shape.slice(),{axis:o}=e;Ot(o,s.shape).forEach(c=>{i[c]=1});const r=V(n,i),l=A(r,Wn(s.shape,"float32"));return{x:()=>l}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sw={kernelName:Po,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ut(n,Wt(Eo(e)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iw={kernelName:Bo,outputsToSave:[!0],gradFunc:(n,t)=>{const[e]=t;return{x:()=>A(pt(Nt(1),Wt(e)),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ow={kernelName:Wl,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{reps:i}=e;return{x:()=>{let a=Ft(s);if(s.rank===1)for(let r=0;r<i[0];++r)a=J(a,Le(n,[r*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let r=0;r<i[0];++r)for(let l=0;l<i[1];++l)a=J(a,Le(n,[r*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let r=0;r<i[0];++r)for(let l=0;l<i[1];++l)for(let c=0;c<i[2];++c)a=J(a,Le(n,[r*s.shape[0],l*s.shape[1],c*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let r=0;r<i[0];++r)for(let l=0;l<i[1];++l)for(let c=0;c<i[2];++c)for(let u=0;u<i[3];++u)a=J(a,Le(n,[r*s.shape[0],l*s.shape[1],c*s.shape[2],u*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aw={kernelName:Yd,gradFunc:(n,t,e)=>{const s=e,{perm:i}=s,o=ds(i);return{x:()=>dt(n,o)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rw={kernelName:Hl,gradFunc:(n,t,e)=>{const s=e,{axis:i}=s;return{value:()=>ui(n,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lw={kernelName:Gl,inputsToSave:["segmentIds"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>cw(n,e)}}};function cw(n,t){const e=gn(t,Ft(t)),s=Vo(n,e);let i=Bn(t,Nt(0,"int32"));const o=s.rank-i.rank;for(let r=0;r<o;++r)i=oe(i,r+1);i=Pn(i,Wn(s.shape,"bool"));const a=Ft(s);return Ve(i,s,a)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uw={kernelName:Ul,gradFunc:n=>({x:()=>Ft(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hw=[vc,lb,cb,ub,hb,db,pb,fb,mb,gb,bb,yb,kb,Nb,vb,Cb,Tb,Db,Ab,Fb,Rb,Mb,Eb,zb,Lb,_b,Pb,Bb,Vb,Wb,My,Hb,Gb,Ub,jb,qb,Yb,Kb,Xb,Jb,Zb,Qb,ty,ey,ny,sy,iy,oy,ay,cy,Ba,Ba,uy,py,gy,by,yy,wy,Iy,ky,xy,Sy,Ny,vy,Cy,Va,Va,Ty,Dy,Ry,zy,Ey,$y,Oy,Ly,_y,Py,By,Vy,Wy,Hy,Gy,Uy,jy,qy,Ky,Yy,Xy,Wa,Wa,Ha,Ha,Jy,Qy,Zy,tw,ew,nw,sw,iw,ow,aw,rw,lw,uw];for(const n of hw)Xd(n);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.abs=function(){return this.throwIfDisposed(),fn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.acos=function(){return this.throwIfDisposed(),Jd(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.acosh=function(){return this.throwIfDisposed(),Zd(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.add=function(n){return this.throwIfDisposed(),J(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.all=function(n,t){return this.throwIfDisposed(),jl(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.any=function(n,t){return this.throwIfDisposed(),Hi(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.argMax=function(n){return this.throwIfDisposed(),Mn(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.argMin=function(n){return this.throwIfDisposed(),Qd(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.asScalar=function(){return this.throwIfDisposed(),Y(this.size===1,()=>"The array must have only 1 element."),V(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.asType=function(n){return this.throwIfDisposed(),X(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.as1D=function(){return this.throwIfDisposed(),V(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.as2D=function(n,t){return this.throwIfDisposed(),V(this,[n,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.as3D=function(n,t,e){return this.throwIfDisposed(),V(this,[n,t,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.as4D=function(n,t,e,s){return this.throwIfDisposed(),V(this,[n,t,e,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.as5D=function(n,t,e,s,i){return this.throwIfDisposed(),V(this,[n,t,e,s,i])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.asin=function(){return this.throwIfDisposed(),tp(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.asinh=function(){return this.throwIfDisposed(),ep(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.atan=function(){return this.throwIfDisposed(),np(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.atan2=function(n){return this.throwIfDisposed(),sp(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.atanh=function(){return this.throwIfDisposed(),ip(this)};F().prototype.avgPool=function(n,t,e,s){return this.throwIfDisposed(),ql(this,n,t,e,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.batchToSpaceND=function(n,t){return this.throwIfDisposed(),_l(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.batchNorm=function(n,t,e,s,i){return this.throwIfDisposed(),op(this,n,t,e,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.broadcastTo=function(n){return this.throwIfDisposed(),ap(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.cast=function(n){return this.throwIfDisposed(),X(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.ceil=function(){return this.throwIfDisposed(),rp(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.clipByValue=function(n,t){return this.throwIfDisposed(),Xt(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.concat=function(n,t){return this.throwIfDisposed(),n instanceof Re&&(n=[n]),ps([this,...n],t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.conv1d=function(n,t,e,s,i,o){return this.throwIfDisposed(),Kl(this,n,t,e,s,i,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.conv2dTranspose=function(n,t,e,s,i){return this.throwIfDisposed(),Yl(this,n,t,e,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.conv2d=function(n,t,e,s,i,o){return this.throwIfDisposed(),Vs(this,n,t,e,s,i,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.cos=function(){return this.throwIfDisposed(),Eo(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.cosh=function(){return this.throwIfDisposed(),$l(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.cumprod=function(n,t,e){return this.throwIfDisposed(),Wi(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.cumsum=function(n,t,e){return this.throwIfDisposed(),Qr(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.depthToSpace=function(n,t){return this.throwIfDisposed(),lp(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.depthwiseConv2d=function(n,t,e,s,i,o){return this.throwIfDisposed(),Xl(this,n,t,e,s,i,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.dilation2d=function(n,t,e,s,i){return this.throwIfDisposed(),cp(this,n,t,e,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.divNoNan=function(n){return this.throwIfDisposed(),up(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.div=function(n){return this.throwIfDisposed(),ut(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.dot=function(n){return this.throwIfDisposed(),hp(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.elu=function(){return this.throwIfDisposed(),Wo(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.equal=function(n){return this.throwIfDisposed(),fe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.erf=function(){return this.throwIfDisposed(),dp(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.euclideanNorm=function(n,t){return this.throwIfDisposed(),pp(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.exp=function(){return this.throwIfDisposed(),Vn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.expandDims=function(n){return this.throwIfDisposed(),oe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.expm1=function(){return this.throwIfDisposed(),fp(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.fft=function(){return this.throwIfDisposed(),mp(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.flatten=function(){return this.throwIfDisposed(),V(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.floor=function(){return this.throwIfDisposed(),So(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.floorDiv=function(n){return this.throwIfDisposed(),gp(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.gather=function(n,t,e){return this.throwIfDisposed(),Vo(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.greaterEqual=function(n){return this.throwIfDisposed(),Bn(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.greater=function(n){return this.throwIfDisposed(),ye(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.ifft=function(){return this.throwIfDisposed(),bp(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.irfft=function(){return this.throwIfDisposed(),yp(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.isFinite=function(){return this.throwIfDisposed(),wp(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.isInf=function(){return this.throwIfDisposed(),Ip(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.isNaN=function(){return this.throwIfDisposed(),kp(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.leakyRelu=function(n){return this.throwIfDisposed(),Jl(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.lessEqual=function(n){return this.throwIfDisposed(),li(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.less=function(n){return this.throwIfDisposed(),dl(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.localResponseNormalization=function(n,t,e,s){return this.throwIfDisposed(),xp(this,n,t,e,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.logSigmoid=function(){return this.throwIfDisposed(),Sp(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.logSoftmax=function(n){return this.throwIfDisposed(),Zl(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.logSumExp=function(n,t){return this.throwIfDisposed(),Np(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.log=function(){return this.throwIfDisposed(),Ze(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.log1p=function(){return this.throwIfDisposed(),Ql(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.logicalAnd=function(n){return this.throwIfDisposed(),Pn(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.logicalNot=function(){return this.throwIfDisposed(),Ml(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.logicalOr=function(n){return this.throwIfDisposed(),vp(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.logicalXor=function(n){return this.throwIfDisposed(),Cp(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.matMul=function(n,t,e){return this.throwIfDisposed(),ne(this,n,t,e)};F().prototype.maxPool=function(n,t,e,s){return this.throwIfDisposed(),tc(this,n,t,e,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.max=function(n,t){return this.throwIfDisposed(),zn(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.maximum=function(n){return this.throwIfDisposed(),gn(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.mean=function(n,t){return this.throwIfDisposed(),Lt(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.min=function(n,t){return this.throwIfDisposed(),ec(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.minimum=function(n){return this.throwIfDisposed(),Ho(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.mirrorPad=function(n,t){return this.throwIfDisposed(),Tp(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.mod=function(n){return this.throwIfDisposed(),Dp(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.mul=function(n){return this.throwIfDisposed(),A(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.neg=function(){return this.throwIfDisposed(),Ht(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.norm=function(n,t,e){return this.throwIfDisposed(),Ap(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.notEqual=function(n){return this.throwIfDisposed(),Ws(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.oneHot=function(n,t=1,e=0){return this.throwIfDisposed(),Go(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.onesLike=function(){return this.throwIfDisposed(),ae(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.pad=function(n,t){return this.throwIfDisposed(),Oo(this,n,t)};F().prototype.pool=function(n,t,e,s,i,o){return this.throwIfDisposed(),Fp(this,n,t,e,s,i,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.pow=function(n){return this.throwIfDisposed(),vo(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.prelu=function(n){return this.throwIfDisposed(),nc(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.prod=function(n,t){return this.throwIfDisposed(),Rp(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.reciprocal=function(){return this.throwIfDisposed(),Mp(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.relu=function(){return this.throwIfDisposed(),Gn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.relu6=function(){return this.throwIfDisposed(),zp(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.reshapeAs=function(n){return this.throwIfDisposed(),V(this,n.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.reshape=function(n){return this.throwIfDisposed(),V(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.resizeBilinear=function(n,t,e){return this.throwIfDisposed(),Ep(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.resizeNearestNeighbor=function(n,t,e){return this.throwIfDisposed(),$p(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.reverse=function(n){return this.throwIfDisposed(),os(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.rfft=function(){return this.throwIfDisposed(),Op(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.round=function(){return this.throwIfDisposed(),Lp(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.rsqrt=function(){return this.throwIfDisposed(),ol(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.selu=function(){return this.throwIfDisposed(),sc(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.separableConv2d=function(n,t,e,s,i,o){return this.throwIfDisposed(),ic(this,n,t,e,s,i,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.sigmoid=function(){return this.throwIfDisposed(),Hn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.sign=function(){return this.throwIfDisposed(),_p(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.sin=function(){return this.throwIfDisposed(),Xr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.sinh=function(){return this.throwIfDisposed(),Jr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.slice=function(n,t){return this.throwIfDisposed(),Le(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.softmax=function(n){return this.throwIfDisposed(),Uo(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.softplus=function(){return this.throwIfDisposed(),hi(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.spaceToBatchND=function(n,t){return this.throwIfDisposed(),Wr(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.split=function(n,t){return this.throwIfDisposed(),_e(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.sqrt=function(){return this.throwIfDisposed(),on(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.square=function(){return this.throwIfDisposed(),Wt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.squaredDifference=function(n){return this.throwIfDisposed(),Pp(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.squeeze=function(n){return this.throwIfDisposed(),Ne(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.stack=function(n,t){this.throwIfDisposed();const e=n instanceof Re?[this,n]:[this,...n];return ui(e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.step=function(n){return this.throwIfDisposed(),ai(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.stridedSlice=function(n,t,e,s,i,o,a,r){return this.throwIfDisposed(),Bp(this,n,t,e,s,i,o,a,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.sub=function(n){return this.throwIfDisposed(),pt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.sum=function(n,t){return this.throwIfDisposed(),lt(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.tan=function(){return this.throwIfDisposed(),Vp(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.tanh=function(){return this.throwIfDisposed(),jo(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.tile=function(n){return this.throwIfDisposed(),hn(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.toBool=function(){return this.throwIfDisposed(),X(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.toFloat=function(){return this.throwIfDisposed(),X(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.toInt=function(){return this.throwIfDisposed(),X(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.topk=function(n,t){return this.throwIfDisposed(),Wp(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.transpose=function(n){return this.throwIfDisposed(),dt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.unique=function(n){return this.throwIfDisposed(),Hp(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.unsortedSegmentSum=function(n,t){return this.throwIfDisposed(),rl(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.unstack=function(n){return this.throwIfDisposed(),is(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.where=function(n,t){return this.throwIfDisposed(),Ve(n,this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F().prototype.zerosLike=function(){return this.throwIfDisposed(),Ft(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Ie extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Ie.prototype)}}class ie extends Error{constructor(t){super(t),Object.setPrototypeOf(this,ie.prototype)}}class S extends Error{constructor(t){super(t),Object.setPrototypeOf(this,S.prototype)}}class it extends Error{constructor(t){super(t),Object.setPrototypeOf(this,it.prototype)}}class ra extends Error{constructor(t){super(t),Object.setPrototypeOf(this,ra.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Tc{constructor(t){this.maxEntries=t||100,this.cache=new Map}get(t){let e;return this.cache.has(t)&&(e=this.cache.get(t),this.cache.delete(t),this.cache.set(t,e)),e}put(t,e){if(this.cache.has(t))this.cache.delete(t);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(t,e)}getMaxEntries(){return this.maxEntries}setMaxEntries(t){if(t<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${t}.`);if(this.maxEntries>t)for(let e=0;e<this.maxEntries-t;e++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=t}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function mn(n,t){if(Array.isArray(n)){let e=[];for(let s=0;s<t;s++)e=e.concat(n);return e}else{const e=new Array(t);return e.fill(n),e}}function ke(n,t){if(!n)throw new ra(t)}function Ga(n,t){let e=0;for(const s of n)s===t&&e++;return e}function Gt(n){return n.length===1?n[0]:n}function kt(n){return Array.isArray(n)?n:[n]}function Oe(n){const e=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return e[0]!=="_"?e:"private"+e}function un(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(t,e)=>e.toUpperCase())}let te={};function la(n){if(n==null)return null;const t={};return t.className=n.getClassName(),t.config=n.getConfig(),t}function Ui(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(t=>Ui(t));else{const t=Object.keys(n);for(const e of t){const s=n[e];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?n[e]=s.value:Ui(s))}}}function bs(n,t={},e={},s="object",i=!1){if(typeof n=="string"){const o=n;let a;if(o in e)a=e[o];else if(o in te)a=te[o];else if(a=t[o],a==null)throw new S(`Unknown ${s}: ${n}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return a}else{const o=n;if(o.className==null||o.config==null)throw new S(`${s}: Improper config format: ${JSON.stringify(o)}.
'className' and 'config' must set.`);const a=o.className;let r,l;if(a in e?[r,l]=e[a]:a in te?[r,l]=te.className:a in t&&([r,l]=t[a]),r==null)throw new S(`Unknown ${s}: ${a}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const c={};for(const p of Object.keys(te))c[p]=te[p];for(const p of Object.keys(e))c[p]=e[p];const u=o.config;u.customObjects=c;const d=Object.assign({},te);for(const p of Object.keys(e))te[p]=e[p];Ui(o.config);const h=l(r,o.config,e,i);return te=Object.assign({},d),h}else{const c=Object.assign({},te);for(const d of Object.keys(e))te[d]=e[d];const u=new r(o.config);return te=Object.assign({},c),u}}}function dw(n,t){return n<t?-1:n>t?1:0}function Ts(n,t){return-1*dw(n,t)}function Ye(n){if(n==null)return n;const t=[];for(const e of n)t.indexOf(e)===-1&&t.push(e);return t}function pw(n){if(n==null)throw new S(`Invalid value in obj: ${JSON.stringify(n)}`);for(const t in n)if(n.hasOwnProperty(t))return!1;return!0}function In(n,t,e){if(e!=null&&n.indexOf(e)<0)throw new S(`${e} is not a valid ${t}.  Valid values are ${n} or null/undefined.`)}function ca(n,t,e=0,s=1/0){return ke(e>=0),ke(s>=e),Array.isArray(n)&&n.length>=e&&n.length<=s&&n.every(i=>typeof i===t)}function _t(n,t){Array.isArray(n)?(Y(n.length>0,()=>`${t} is unexpectedly an empty array.`),n.forEach((e,s)=>_t(e,`element ${s+1} of ${t}`))):Y(Number.isInteger(n)&&n>0,()=>`Expected ${t} to be a positive integer, but got ${Dc(n)}.`)}function Dc(n){return n===null?"null":Array.isArray(n)?"["+n.map(t=>Dc(t)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function fw(n,t,e){let s=e!=null?e():Hs(),i;return(...a)=>{const r=e!=null?e():Hs();return r-s<t||(s=r,i=n(...a)),i}}function Ac(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let mw=0;function Fc(){return mw++}const Ds={};function gi(n=""){return n in Ds||(Ds[n]=0),Ds[n]+=1,n+Ds[n].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const gw=["channelsFirst","channelsLast"],bw=["nearest","bilinear"],yw=["valid","same","causal"],ww=["max","avg"],Iw=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Sn=new Map;function Rt(n){In(gw,"DataFormat",n)}function kw(n){In(bw,"InterpolationFormat",n)}function Qt(n){In(yw,"PaddingMode",n)}function Rc(n){In(ww,"PoolMode",n)}const ss=[],Ua="/";function dn(n,t){ss.push(n);try{const e=t();return ss.pop(),e}catch(e){throw ss.pop(),e}}function xw(){return ss.length===0?"":ss.join(Ua)+Ua}function Mc(n){if(!Ec(n))throw new Error("Not a valid tensor name: '"+n+"'");return xw()+n}function zc(n){if(!Ec(n))throw new Error("Not a valid tensor name: '"+n+"'");Sn.has(n)||Sn.set(n,0);const t=Sn.get(n);if(Sn.set(n,Sn.get(n)+1),t>0){const e=`${n}_${t}`;return Sn.set(e,1),e}else return n}const Sw=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function Ec(n){return!!n.match(Sw)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Nw(n){return n===parseInt(n.toString(),10)}function Xe(n,t,e){t==null&&(t=0),e==null&&(e=n.length);let s=1;for(let i=t;i<e;++i)s*=n[i];return s}function $n(n){if(n.length===0)return Number.NaN;let t=Number.POSITIVE_INFINITY;for(let e=0;e<n.length;e++){const s=n[e];s<t&&(t=s)}return t}function tn(n){if(n.length===0)return Number.NaN;let t=Number.NEGATIVE_INFINITY;for(let e=0;e<n.length;e++){const s=n[e];s>t&&(t=s)}return t}function me(n,t){if(t<n)throw new S(`end (${t}) < begin (${n}) is forbidden.`);const e=[];for(let s=n;s<t;++s)e.push(s);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Ri;function Mt(){return Ri==null&&(Ri=oc().epsilon()),Ri}function ge(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ae(n,t){return X(n,t)}function ys(n,t=-1){const e=n.shape.slice();return t<0&&(t=e.length+t+1),e.splice(t,0,1),V(n,e)}function vw(n,t){return D(()=>{if(n.shape.length!==2)throw new S(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);const e=ys(n,1);return ji(e,[1,t,1])})}function Cw(n){const t=[Xe(n.shape)];return V(n,t)}function Tw(n){if(n.rank<=1)throw new S(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);const t=[n.shape[0],Xe(n.shape,1)];return V(n,t)}function pn(n,t,e){return D(()=>{switch(n.rank){case 1:return Ko(n,t,e);case 2:return ac(n,[t,0],[e,n.shape[1]]);case 3:return qo(n,[t,0,0],[e,n.shape[1],n.shape[2]]);case 4:return Gs(n,[t,0,0,0],[e,n.shape[1],n.shape[2],n.shape[3]]);case 5:return Le(n,[t,0,0,0,0],[e,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return Le(n,[t,0,0,0,0,0],[e,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new S(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Mi(n,t,e){return D(()=>{switch(n.rank){case 1:return Ko(n,t,e);case 2:return ac(n,[0,t],[n.shape[0],e]);case 3:return qo(n,[0,0,t],[n.shape[0],n.shape[1],e]);case 4:return Gs(n,[0,0,0,t],[n.shape[0],n.shape[1],n.shape[2],e]);default:throw new S(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function As(n,t,e,s){return D(()=>{switch(n.rank){case 1:return Ko(n,t,e);case 2:switch(s){case 1:return pn(n,t,e);case 2:return Mi(n,t,e);default:throw new S(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return pn(n,t,e);case 2:return qo(n,[0,t,0],[n.shape[0],e,n.shape[2]]);case 3:return Mi(n,t,e);default:throw new S(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return pn(n,t,e);case 2:return Gs(n,[0,t,0,0],[n.shape[0],e,n.shape[2],n.shape[3]]);case 3:return Gs(n,[0,0,t,0],[n.shape[0],n.shape[1],e,n.shape[3]]);case 4:return Mi(n,t,e);default:throw new S(`The axis is not within the rank of the tensor ${s}`)}default:throw new S(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function ua(n,t=-1){let e;return t<0&&(e=n[0].rank,e!==0?t=e:t=0),t===n[0].rank&&(t=-1),ps(n,t)}function ja(n,t){switch(n.rank){case 1:return Kp([n,t]);case 2:return qp([n,t],0);case 3:return jp([n,t],0);case 4:return Up([n,t],0);default:throw new S(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function ji(n,t){if(Array.isArray(t)||(t=[t]),n.rank!==t.length)throw new S(`The length of input n (${t.length}) does not match the number of dimensions in input x (${n.rank})`);return hn(n,t)}function bi(n,t=0,e=1,s,i){return Gp(n,t,e,s,i)}function Fe(n,t,e,s){if(n.rank<2||t.rank<2)throw new it(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${t.shape}`);if(t.rank>=3){const i=n.shape.slice(-1)[0],o=t.shape.slice(-2)[0];if(i!==o)throw new it(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${t.shape}`)}if(n.rank===2&&t.rank===2)return Ea({a:n,b:t,transposeA:!1,transposeB:!1,bias:s?qi(n.rank,s,ge()):null,activation:e});{const i=n.shape.slice(),o=i.pop();n=V(n,[-1,o]);const a=t.shape.slice(),r=a.pop(),l=a.pop(),c=[...a,r],u=Array.from({length:t.rank},(m,f)=>f===0?t.rank-2:f<=t.rank-2?f-1:f);t=V(dt(t,u),[l,-1]);const d=[...i,...c];return V(Ea({a:n,b:t,transposeA:!1,transposeB:!1,bias:s?qi(n.rank,s,ge()):null,activation:e}),d)}}function $c(n,t,e){return D(()=>(Array.isArray(t)?t=Us(t,"int32"):t=X(t,"int32"),Vo(n,t,e)))}function ws(n){return A(n,n)}function qi(n,t,e){const s=t.shape;if(t.rank!==1&&t.rank!==n)throw new S(`Unexpected bias dimensions: ${t.rank}; expected it to be 1 or ${n}`);if(n===5){if(e==="channelsFirst")return s.length===1?V(t,[1,s[0],1,1,1]):V(t,[1,s[3],s[0],s[1],s[2]]);if(e==="channelsLast")return s.length===1?V(t,[1,1,1,1,s[0]]):V(t,[1].concat(s))}else if(n===4){if(e==="channelsFirst")return s.length===1?V(t,[1,s[0],1,1]):V(t,[1,s[2],s[0],s[1]]);if(e==="channelsLast")return s.length===1?V(t,[1,1,1,s[0]]):V(t,[1].concat(s))}else if(n===3){if(e==="channelsFirst")return s.length===1?V(t,[1,s[0],1]):V(t,[1,s[1],s[0]]);if(e==="channelsLast")return s.length===1?V(t,[1,1,s[0]]):V(t,[1].concat(s))}else if(n<3)return t;throw new S(`Unsupported input rank by biasAdd: ${t.rank}`)}function we(n,t,e){return D(()=>(e==null&&(e=ge()),Rt(e),J(n,qi(n.rank,t,e))))}function Dw(n,t=1){if(t!==1)throw new it(`Support for alpha values other than 1 (${t}) is not implemented yet.`);return Wo(n)}function Aw(n){return D(()=>ut(n,J(fn(n),1)))}function Oc(n,t,e,s){return D(()=>Yp(n,t,e,s))}function Fw(n){return D(()=>{const t=J(.5,A(.2,n));return Xt(t,0,1)})}function Is(n,t,e=!1){return e?n():t()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Rw=["fanIn","fanOut","fanAvg"],Mw=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function zw(n){In(Rw,"FanMode",n)}function Ew(n){In(Mw,"Distribution",n)}class re extends fs{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class Lc extends re{apply(t,e){return Yt(t,e)}}Lc.className="Zeros";B(Lc);class ha extends re{apply(t,e){return Wn(t,e)}}ha.className="Ones";B(ha);class _c extends re{constructor(t){if(super(),typeof t!="object")throw new S(`Expected argument of type ConstantConfig but got ${t}`);if(t.value===void 0)throw new S(`config must have value set but got ${t}`);this.value=t.value}apply(t,e){return D(()=>A(Nt(this.value),Wn(t,e)))}getConfig(){return{value:this.value}}}_c.className="Constant";B(_c);class Pc extends re{constructor(t){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=t.minval||this.DEFAULT_MINVAL,this.maxval=t.maxval||this.DEFAULT_MAXVAL,this.seed=t.seed}apply(t,e){return di(t,this.minval,this.maxval,e,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}Pc.className="RandomUniform";B(Pc);class Bc extends re{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,e){if(e=e||"float32",e!=="float32"&&e!=="int32")throw new it(`randomNormal does not support dType ${e}.`);return bi(t,this.mean,this.stddev,e,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}Bc.className="RandomNormal";B(Bc);class Vc extends re{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,e){if(e=e||"float32",e!=="float32"&&e!=="int32")throw new it(`truncatedNormal does not support dType ${e}.`);return rc(t,this.mean,this.stddev,e,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}Vc.className="TruncatedNormal";B(Vc);class Wc extends re{constructor(t){super(),this.gain=t.gain!=null?t.gain:1}apply(t,e){return D(()=>{if(t.length!==2||t[0]!==t[1])throw new S("Identity matrix initializer can only be used for 2D square matrices.");return A(this.gain,Xp(t[0]))})}getConfig(){return{gain:this.gain}}}Wc.className="Identity";B(Wc);function $w(n,t="channelsLast"){let e,s;if(Rt(t),n.length===2)e=n[0],s=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(t==="channelsFirst"){const i=Xe(n,2);e=n[1]*i,s=n[0]*i}else if(t==="channelsLast"){const i=Xe(n,0,n.length-2);e=n[n.length-2]*i,s=n[n.length-1]*i}}else{const i=Xe(n);e=Math.sqrt(i),s=Math.sqrt(i)}return[e,s]}class qt extends re{constructor(t){if(super(),t.scale<0)throw new S(`scale must be a positive float. Got: ${t.scale}`);this.scale=t.scale==null?1:t.scale,this.mode=t.mode==null?"fanIn":t.mode,zw(this.mode),this.distribution=t.distribution==null?"normal":t.distribution,Ew(this.distribution),this.seed=t.seed}apply(t,e){const s=$w(t),i=s[0],o=s[1];let a=this.scale;if(this.mode==="fanIn"?a/=Math.max(1,i):this.mode==="fanOut"?a/=Math.max(1,o):a/=Math.max(1,(i+o)/2),this.distribution==="normal"){const r=Math.sqrt(a);if(e=e||"float32",e!=="float32"&&e!=="int32")throw new it(`${this.getClassName()} does not support dType ${e}.`);return rc(t,0,r,e,this.seed)}else{const r=Math.sqrt(3*a);return di(t,-r,r,e,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}qt.className="VarianceScaling";B(qt);class da extends qt{constructor(t){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return qt.className}}da.className="GlorotUniform";B(da);class pa extends qt{constructor(t){super({scale:1,mode:"fanAvg",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return qt.className}}pa.className="GlorotNormal";B(pa);class fa extends qt{constructor(t){super({scale:2,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return qt.className}}fa.className="HeNormal";B(fa);class ma extends qt{constructor(t){super({scale:2,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return qt.className}}ma.className="HeUniform";B(ma);class ga extends qt{constructor(t){super({scale:1,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return qt.className}}ga.className="LeCunNormal";B(ga);class ba extends qt{constructor(t){super({scale:1,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return qt.className}}ba.className="LeCunUniform";B(ba);class Hc extends re{constructor(t){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=t.gain==null?this.DEFAULT_GAIN:t.gain,this.seed=t.seed}apply(t,e){return D(()=>{if(t.length<2)throw new it("Shape must be at least 2D.");if(e!=="int32"&&e!=="float32"&&e!==void 0)throw new TypeError(`Unsupported data type ${e}.`);e=e;const s=nt(t.slice(0,-1)),i=t[t.length-1],o=s*i;o>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${o}) elements: Slowness may result.`);const a=[Math.max(i,s),Math.min(i,s)],r=bi(a,0,1,e,this.seed),l=Jp.qr(r,!1);let c=l[0];const d=l[1].flatten().stridedSlice([0],[Math.min(i,s)*Math.min(i,s)],[Math.min(i,s)+1]);return c=A(c,d.sign()),s<i&&(c=c.transpose()),A(Nt(this.gain),c.reshape(t))})}getConfig(){return{gain:this.gain,seed:this.seed}}}Hc.className="Orthogonal";B(Hc);const qa={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function Ka(n,t={}){return bs(n,ms.getMap().classNameMap,t,"initializer")}function Dt(n){return la(n)}function vt(n){if(typeof n=="string"){const t=n in qa?qa[n]:n;if(t==="GlorotNormal")return new pa;if(t==="GlorotUniform")return new da;if(t==="HeNormal")return new fa;if(t==="HeUniform")return new ma;if(t==="LeCunNormal")return new ga;if(t==="LeCunUniform")return new ba;{const e={};return e.className=t,e.config={},Ka(e)}}else return n instanceof re?n:Ka(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ki(n){return Array.isArray(n)&&Array.isArray(n[0])}function qs(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function st(n){let t;if(Array.isArray(n)){if(n.length!==1)throw new S(`Expected Tensor length to be 1; got ${n.length}`);t=n[0]}else t=n;return t}function ht(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new S(`Expected exactly 1 Shape; got ${n.length}`)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ks(n){let t=0;for(const e of n)e.shape.length===0?t+=1:t+=e.shape.reduce((s,i)=>s*i);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Ya="Variable";class Ow{constructor(t,e="float32",s=Ya,i=!0,o=null){this.dtype=e??"float32",this.shape=t.shape,this.id=Fc(),s=s??Ya,this.originalName=Mc(s),this.name=zc(this.originalName),this.trainable_=i,this.constraint=o,this.val=Zp(t,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(t){return this.assertNotDisposed(),Lw(this.val,t),this.val.id!==t.id&&(this.val.assign(t),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(t){this.trainable_=t,this.val.trainable=t}}function Lw(n,t){if(n.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(t.shape))}function Yi(n){return n.map(t=>t.read())}function ya(n){n.forEach(t=>{t[0].write(t[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class zt{constructor(t){this.dtype=t.dtype,this.shape=t.shape,t.shape!=null?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}}}class ve{constructor(t,e,s,i,o,a,r){this.dtype=t,this.shape=e,this.sourceLayer=s,this.inputs=i,this.callArgs=o,this.outputTensorIndex=r,this.id=Fc(),a!=null&&(this.originalName=Mc(a),this.name=zc(this.originalName)),this.rank=e.length}}let _w=0;class yi{constructor(t,e){this.callArgs=e,this.id=_w++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;for(const s of t.inboundLayers)s!=null&&s.outboundNodes.push(this);t.outboundLayer.inboundNodes.push(this)}getConfig(){const t=[];for(const e of this.inboundLayers)e!=null?t.push(e.name):t.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let Pw=0;class rt extends fs{constructor(t={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=Pw++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let e=t.name;if(!e){const s=this.getClassName();e=Oe(s)+"_"+gi(s)}if(this.name=e,this.trainable_=t.trainable==null?!0:t.trainable,t.inputShape!=null||t.batchInputShape!=null){let s;if(t.batchInputShape!=null)s=t.batchInputShape;else if(t.inputShape!=null){let o=null;t.batchSize!=null&&(o=t.batchSize),s=[o].concat(t.inputShape)}this.batchInputShape=s;let i=t.dtype;i==null&&(i=t.inputDType),i==null&&(i="float32"),this.dtype=i}t.weights!=null?this.initialWeights=t.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(t,e){return t.name+"_ib-"+e.toString()}getNodeAtIndex(t,e){if(this.inboundNodes.length===0)throw new ie(`The layer has never been called and thus has no defined ${e}.`);if(this.inboundNodes.length<=t)throw new S(`Asked to get ${e} at node ${t}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[t]}getInputAt(t){return Gt(this.getNodeAtIndex(t,"input").inputTensors)}getOutputAt(t){return Gt(this.getNodeAtIndex(t,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new Ie(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new Ie(`Layer ${this.name} is not connected, no input to return.`);return Gt(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new Ie(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new Ie(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Gt(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(t=>t())}get updates(){return this._updates}get built(){return this._built}set built(t){this._built=t}get trainable(){return this.trainable_}set trainable(t){this._trainableWeights.forEach(e=>e.trainable=t),this.trainable_=t}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(t=>t.trainable):[]}set trainableWeights(t){this._trainableWeights=t}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(t=>!t.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(t){this._nonTrainableWeights=t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(t){if(t=kt(t),this.inputSpec==null||this.inputSpec.length===0)return;const e=kt(this.inputSpec);if(t.length!==e.length)throw new S(`Layer ${this.name} expects ${e.length} inputs, but it received ${t.length} input tensors. Input received: ${t}`);for(let s=0;s<t.length;s++){const i=t[s],o=e[s];if(o==null)continue;const a=i.rank;if(o.ndim!=null&&a!==o.ndim)throw new S(`Input ${s} is incompatible with layer ${this.name}: expected ndim=${o.ndim}, found ndim=${a}`);if(o.maxNDim!=null&&a>o.maxNDim)throw new S(`Input ${s} is incompatible with layer ${this.name}: expected max_ndim=${o.maxNDim}, found ndim=${a}`);if(o.minNDim!=null&&a<o.minNDim)throw new S(`Input ${s} is incompatible with layer ${this.name}: expected min_ndim=${o.minNDim}, found ndim=${a}.`);if(o.dtype!=null&&i.dtype!==o.dtype)throw new S(`Input ${s} is incompatible with layer ${this.name} : expected dtype=${o.dtype}, found dtype=${i.dtype}.`);if(o.axes){const r=i.shape;for(const l in o.axes){const c=Number(l),u=o.axes[l],d=c>=0?r[c]:r[r.length+c];if(u!=null&&[u,null].indexOf(d)===-1)throw new S(`Input ${s} is incompatible with layer ${this.name}: expected axis ${c} of input shape to have value ${u} but got shape ${r}.`)}}if(o.shape!=null)for(let r=0;r<o.shape.length;++r){const l=o.shape[r],c=i.shape[r];if(l!=null&&c!=null&&l!==c)throw new S(`Input ${s} is incompatible with layer ${this.name}: expected shape=${o.shape}, found shape=${i.shape}.`)}}}call(t,e){return t}invokeCallHook(t,e){this._callHook!=null&&this._callHook(t,e)}setCallHook(t){this._callHook=t}clearCallHook(){this._callHook=null}apply(t,e){e=e||{},this.assertNotDisposed();const s=kt(t);let i=!0;for(const a of s)if(!(a instanceof ve)){i=!1;break}let o=!0;for(const a of s)if(a instanceof ve){o=!1;break}if(i===o)throw new S("Arguments to apply() must be all SymbolicTensors or all Tensors");return dn(this.name,()=>{if(!this.built){this.assertInputCompatibility(t);const a=[];for(const r of kt(t))a.push(r.shape);this.build(Gt(a)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&o&&(this._refCount=1)}if(this.assertInputCompatibility(t),o){let a=this.call(t,e);const r=kt(a),l=[];for(let c of r)s.indexOf(c)!==-1&&(c=c.clone()),l.push(c);if(a=Gt(l),this.activityRegularizer!=null)throw new it("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return a}else{const a=Bw(t),r=this.computeOutputShape(a);let l;const c=Vw(t);if(this.warnOnIncompatibleInputShape(Array.isArray(t)?a[0]:a),r!=null&&r.length>0&&Array.isArray(r[0])?l=r.map((u,d)=>new ve(c,u,this,kt(t),e,this.name,d)):l=new ve(c,r,this,kt(t),e,this.name),this.addInboundNode(t,l,null,null,a,r,e),this._refCount++,this.activityRegularizer!=null)throw new it("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(t){if(this.batchInputShape!=null)if(t.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(t)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let e=!1;this.batchInputShape.forEach((s,i)=>{s!=null&&t[i]!=null&&t[i]!==s&&(e=!0)}),e&&console.warn(`The shape of the input tensor (${JSON.stringify(t)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Ie(`The layer ${this.name} has never been called and thus has no defined output shape.`);const t=[];for(const e of this.inboundNodes){const s=JSON.stringify(e.outputShapes);t.indexOf(s)===-1&&t.push(s)}if(t.length===1){const e=this.inboundNodes[0].outputShapes;return Array.isArray(e)&&Array.isArray(e[0])&&e.length===1?e[0]:e}else throw new Ie(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new ie(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Ks(this.weights)}build(t){this.built=!0}getWeights(t=!1){return Yi(t?this.trainableWeights:this.weights)}setWeights(t){D(()=>{const e=this.weights;if(e.length!==t.length)throw new S(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${t.length}, but the layer was expecting ${e.length} weights. Provided weights: ${t}...`);if(e.length===0)return;const s=[],i=Yi(e);for(let o=0;o<i.length;++o){const a=i[o],r=e[o],l=t[o];if(!Jt(a.shape,l.shape))throw new S(`Layer weight shape ${a.shape} not compatible with provided weight shape ${l.shape}`);s.push([r,l])}ya(s)})}addWeight(t,e,s,i,o,a,r,l){if(this._addedWeightNames.indexOf(t)!==-1)throw new S(`Duplicate weight name ${t} for layer ${this.name}`);this._addedWeightNames.push(t),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(i=l!=null?l():vt("zeros"));const c=i.apply(e,s),u=new Ow(c,s,t,a,r);return c.dispose(),o!=null&&this.addLoss(()=>o.apply(u.read())),a==null&&(a=!0),a?this._trainableWeights.push(u):this._nonTrainableWeights.push(u),u}setFastWeightInitDuringBuild(t){this.fastWeightInitDuringBuild=t}addLoss(t){t==null||Array.isArray(t)&&t.length===0||(t=kt(t),this._losses!==void 0&&this._losses!==null&&this.losses.push(...t))}computeOutputShape(t){return t}computeMask(t,e){if(!this.supportsMasking){if(e!=null)if(Array.isArray(e))e.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return e}addInboundNode(t,e,s,i,o,a,r=null){const l=kt(t);e=kt(e),s=kt(s),i=kt(i),o=qs(o),a=qs(a);const c=[],u=[],d=[];for(const h of l)c.push(h.sourceLayer),u.push(h.nodeIndex),d.push(h.tensorIndex);new yi({outboundLayer:this,inboundLayers:c,nodeIndices:u,tensorIndices:d,inputTensors:l,outputTensors:e,inputMasks:s,outputMasks:i,inputShapes:o,outputShapes:a},r);for(let h=0;h<e.length;h++)e[h].sourceLayer=this,e[h].nodeIndex=this.inboundNodes.length-1,e[h].tensorIndex=h}getConfig(){const t={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(t.batchInputShape=this.batchInputShape),this.dtype!=null&&(t.dtype=this.dtype),t}disposeWeights(){return this.weights.forEach(t=>t.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let t=0;return--this._refCount===0&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}}}function Bw(n){n=kt(n);const t=[];for(const e of n)t.push(e.shape);return Gt(t)}function Vw(n){return"float32"}function Gc(n,t,e){if((t==null||e!=null&&e>0)&&(t=n.sourceLayer,e=n.nodeIndex),t.inboundNodes.length===0)return[n];{const s=t.inboundNodes[e];if(s.inboundLayers.length===0)return s.inputTensors;{const i=[];for(let o=0;o<s.inboundLayers.length;o++){const a=s.inputTensors[o],r=s.inboundLayers[o],l=s.nodeIndices[o],c=Gc(a,r,l);for(const u of c)i.indexOf(u)===-1&&i.push(u)}return i}}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class ks extends rt{constructor(t){if(super({dtype:t.dtype,name:t.name!=null?t.name:gi("input").toString()}),t.batchSize==null&&(t.batchSize=null),t.sparse==null&&(t.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=t.sparse,t.inputShape!=null&&t.batchInputShape!=null)throw new S("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let e=t.batchInputShape;if(e==null){if(t.inputShape==null)throw new S("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");e=[t.batchSize].concat(t.inputShape)}else if(t.batchSize!=null)throw new S("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=t.dtype||"float32";this.batchInputShape=e,this.dtype=s,this.inputSpec=[{shape:e}];const i=new ve(this.dtype,this.batchInputShape,this,[],{},this.name);i.nodeIndex=0,i.tensorIndex=0,new yi({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[i],outputTensors:[i],inputMasks:[null],outputMasks:[null],inputShapes:[e],outputShapes:[e]})}apply(t,e){throw new S(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}ks.className="InputLayer";B(ks);function Ww(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new S("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let t=n.batchShape;n.shape!=null&&t==null&&(t=[null].concat(n.shape));let e=n.dtype;return e==null&&(e="float32"),new ks({batchInputShape:t,name:n.name,dtype:e,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Hw(n,t){if(n.dtype==null||n.dtype===t.dtype)return t;try{return X(t,n.dtype)}catch{throw new S(`The dtype of the feed (${t.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}class Ke{constructor(t){if(this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof Ke)for(const e in t.id2Value)this.id2Value[e]=t.id2Value[e],e in t.id2Mask&&(this.id2Mask[e]=t.id2Mask[e]);else{if(t==null)return;for(const e of t)this.add(e.key,e.value)}}add(t,e,s){if(this.id2Value[t.id]==null)this.id2Value[t.id]=Hw(t,e),this.name2Id[t.name]=t.id,s!=null&&(this.id2Mask[t.id]=s);else throw new S(`Duplicate key: name=${t.name}, id=${t.id}`);return this}addFeed(t){this.add(t.key,t.value)}hasKey(t){return this.id2Value[t.id]!=null}names(){return Object.keys(this.name2Id)}getValue(t){if(t instanceof ve){if(this.id2Value[t.id]==null)throw new S(`Nonexistent key: ${t.name}`);return this.id2Value[t.id]}else{const e=this.name2Id[t];if(e==null)throw new S(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Value[e]}}getMask(t){if(t instanceof ve){if(this.id2Value[t.id]==null)throw new S(`Nonexistent key: ${t.name}`);return this.id2Mask[t.id]}else{const e=this.name2Id[t];if(e==null)throw new S(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Mask[e]}}disposeMasks(){this.id2Mask!=null&&St(this.id2Mask)}}const Ys=new Tc,Xs=new Tc;function Gw(n){Ys!=null&&Ys.setMaxEntries(n),Xs!=null&&Xs.setMaxEntries(n)}function Zn(n,t,e,s){const i=e==null?!1:e.training,o=Array.isArray(n),a=o?n:[n],r=a.map(m=>m.name),l=[],c=t.names();for(const m of r)c.indexOf(m)!==-1?l.push(t.getValue(m)):l.push(null);s!=null&&(s.maxNumTensors=-1/0,s.minNumTensors=1/0);const u=r.join(",")+"|"+t.names().sort().join(",");let d=Ys.get(u),h;if(d==null){const m=Uw(a,t);d=m.sorted,h=m.recipientCounts,Ys.put(u,d),Xs.put(u,h)}h={},i||Object.assign(h,Xs.get(u));const p=new Ke(t);for(let m=0;m<d.length;++m){if(s!=null){const C=Gi().numTensors;C>s.maxNumTensors&&(s.maxNumTensors=C),C<s.minNumTensors&&(s.minNumTensors=C)}const f=d[m],g=f.sourceLayer;if(g instanceof ks)continue;const w=[],b=[],I=[];let y=!1;for(const C of f.inputs){const T=p.getValue(C),R=p.getMask(C);w.push(T),b.push(R),R!=null&&(y=!0),i||(h[C.name]--,h[C.name]===0&&!t.hasKey(C)&&r.indexOf(C.name)===-1&&!T.isDisposed&&C.sourceLayer.stateful!==!0&&I.push(T))}y&&(e=e||{},e.mask=b[0]);const k=kt(g.apply(w,e));let x=null;g.supportsMasking&&(x=g.computeMask(w,b));const N=qw(f),v=Array.isArray(N)?N:[N];for(let C=0;C<v.length;++C){p.hasKey(v[C])||p.add(v[C],k[C],Array.isArray(x)?x[0]:x);const T=r.indexOf(v[C].name);T!==-1&&(l[T]=k[C])}i||St(I)}return p.disposeMasks(),o?l:l[0]}function Uw(n,t){Y(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let e=[],s={};if(n.length===1){const i=Xa(n[0],t);e=i.sorted,s=i.recipientMap}else{const i=new Set;for(const o of n){const{sorted:a,recipientMap:r}=Xa(o,t);for(const l of a)i.has(l.name)||(e.push(l),i.add(l.name));for(const l in r)s[l]==null&&(s[l]=new Set),r[l].forEach(c=>s[l].add(c))}}return{sorted:e,recipientCounts:jw(s)}}function jw(n){const t={};for(const e in n)t[e]=n[e].size;return t}function Xa(n,t){const e=new Set,s=[],i={};for(const r of t.names())e.add(r);const o=[],a=[];for(o.push(n);o.length>0;){const r=o[o.length-1];if(e.has(r.name)){o.pop();continue}const l=a[a.length-1]===o.length-1;if(r.inputs.length===0||l)o.pop(),s.push(r),e.add(r.name),l&&a.pop();else{a.push(o.length-1);for(const c of r.inputs)i[c.name]==null&&(i[c.name]=new Set),i[c.name].add(r.name),!e.has(c.name)&&o.push(c)}}return{sorted:s,recipientMap:i}}function qw(n){let t;if(n.sourceLayer.inboundNodes.length===1)t=n.sourceLayer.output;else{let e=null;for(let s=0;s<n.sourceLayer.inboundNodes.length;++s)for(const i of n.sourceLayer.inboundNodes[s].outputTensors)if(i.id===n.id){e=s;break}t=n.sourceLayer.getOutputAt(e)}return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kw=Yo();Kw.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,Gw);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function wa(n,t){return D(()=>on(lt(A(n,n),t,!0)))}class xs extends fs{getConfig(){return{}}}class Uc extends xs{constructor(t){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=t.maxValue!=null?t.maxValue:this.defaultMaxValue,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return D(()=>{const e=wa(t,this.axis),s=Xt(e,0,this.maxValue);return A(t,ut(s,J(Mt(),e)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}Uc.className="MaxNorm";B(Uc);class jc extends xs{constructor(t){super(),this.defaultAxis=0,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return D(()=>ut(t,J(Mt(),wa(t,this.axis))))}getConfig(){return{axis:this.axis}}}jc.className="UnitNorm";B(jc);class qc extends xs{apply(t){return Gn(t)}}qc.className="NonNeg";B(qc);class Kc extends xs{constructor(t){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=t.minValue!=null?t.minValue:this.defaultMinValue,this.maxValue=t.maxValue!=null?t.maxValue:this.defaultMaxValue,this.rate=t.rate!=null?t.rate:this.defaultRate,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return D(()=>{const e=wa(t,this.axis),s=J(A(this.rate,Xt(e,this.minValue,this.maxValue)),A(1-this.rate,e));return A(t,ut(s,J(Mt(),e)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}Kc.className="MinMaxNorm";B(Kc);const Ja={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Et(n){return la(n)}function Za(n,t={}){return bs(n,ms.getMap().classNameMap,t,"constraint")}function $t(n){if(n==null)return null;if(typeof n=="string"){const e={className:n in Ja?Ja[n]:n,config:{}};return Za(e)}else return n instanceof xs?n:Za(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function cn(n){if(n==null)return;const t=[],e=[],s=[];for(const i in n){const o=n[i];if(typeof o!="number"){const a=o;t.push(a.data()),e.push(i),s.push(a)}}if(t.length>0){const i=await Promise.all(t);for(let o=0;o<i.length;++o)n[e[o]]=i[o][0];St(s)}}function Yc(n){if(n!=null)for(const t in n){const e=n[t];typeof e!="number"&&e.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var Qa;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(Qa||(Qa={}));const Yw=125;class ls{constructor(){this.validationData=null}setParams(t){this.params=t}async onEpochBegin(t,e){}async onEpochEnd(t,e){}async onBatchBegin(t,e){}async onBatchEnd(t,e){}async onTrainBegin(t){}async onTrainEnd(t){}setModel(t){}}class Xw{constructor(t,e=10){t==null&&(t=[]),this.callbacks=t,this.queueLength=e}append(t){this.callbacks.push(t)}setParams(t){for(const e of this.callbacks)e.setParams(t)}setModel(t){for(const e of this.callbacks)e.setModel(t)}async onEpochBegin(t,e){e==null&&(e={});for(const s of this.callbacks)await s.onEpochBegin(t,e)}async onEpochEnd(t,e){e==null&&(e={});for(const s of this.callbacks)await s.onEpochEnd(t,e)}async onBatchBegin(t,e){e==null&&(e={});for(const s of this.callbacks)await s.onBatchBegin(t,e)}async onBatchEnd(t,e){e==null&&(e={});for(const s of this.callbacks)await s.onBatchEnd(t,e)}async onTrainBegin(t){t==null&&(t={});for(const e of this.callbacks)await e.onTrainBegin(t)}async onTrainEnd(t){t==null&&(t={});for(const e of this.callbacks)await e.onTrainEnd(t)}}class Jw extends ls{constructor(){super()}async onEpochBegin(t){this.seen=0,this.totals={}}async onBatchEnd(t,e){e==null&&(e={});const s=e.size==null?0:e.size;this.seen+=s;for(const i in e){const o=e[i];if(typeof o=="number")this.totals.hasOwnProperty(i)||(this.totals[i]=0),this.totals[i]=this.totals[i]+o*s;else{let a;i in this.totals?a=this.totals[i]:this.totals[i]=0;const r=D(()=>J(this.totals[i],A(o,s)));this.totals[i]=r,a!=null&&a.dispose()}}}async onEpochEnd(t,e){if(e!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?e[s]=this.totals[s]/this.seen:D(()=>{const i=A(ut(1,this.seen),this.totals[s]);e[s]=i,this.totals[s].dispose(),Pe(e[s])}))}}class Zw extends ls{async onTrainBegin(t){this.epoch=[],this.history={}}async onEpochEnd(t,e){e==null&&(e={}),this.epoch.push(t);for(const s in e)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(e[s])}async syncData(){const t=[],e=[],s=[];for(const o in this.history){const a=this.history[o];for(let r=0;r<a.length;++r)if(typeof a[r]!="number"){const l=a[r];t.push(l.data()),e.push(o),s.push(r)}}const i=await Promise.all(t);for(let o=0;o<i.length;++o)this.history[e[o]][s[o]].dispose(),this.history[e[o]][s[o]]=i[o][0]}}class Qw extends ls{constructor(t,e){if(super(),this.currentEpoch=0,this.nowFunc=t.nowFunc,this.nextFrameFunc=t.nextFrameFunc||Qp,this.yieldEvery=e||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=Yw),this.yieldEvery==="never"&&t.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");$a(this.yieldEvery)&&(this.maybeWait=fw(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=t.onTrainBegin,this.trainEnd=t.onTrainEnd,this.epochBegin=t.onEpochBegin,this.epochEnd=t.onEpochEnd,this.batchBegin=t.onBatchBegin,this.batchEnd=t.onBatchEnd,this.yield=t.onYield}async maybeWait(t,e,s){const i=[];this.yield!=null&&(await cn(s),i.push(this.yield(t,e,s))),i.push(this.nextFrameFunc()),await Promise.all(i)}async onEpochBegin(t,e){this.currentEpoch=t,this.epochBegin!=null&&(await cn(e),await this.epochBegin(t,e))}async onEpochEnd(t,e){const s=[];this.epochEnd!=null&&(await cn(e),s.push(this.epochEnd(t,e))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(t,e){this.batchBegin!=null&&(await cn(e),await this.batchBegin(t,e))}async onBatchEnd(t,e){const s=[];this.batchEnd!=null&&(await cn(e),s.push(this.batchEnd(t,e))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):$a(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,t,e)),await Promise.all(s)}async onTrainBegin(t){this.trainBegin!=null&&(await cn(t),await this.trainBegin(t))}async onTrainEnd(t){this.trainEnd!=null&&(await cn(t),await this.trainEnd(t))}}function Xc(n,t){return n==null&&(n={}),n instanceof ls?[n]:Array.isArray(n)&&n[0]instanceof ls?n:kt(n).map(s=>new Qw(s,t))}class ee{constructor(){}static registerCallbackConstructor(t,e){Y(t>=0&&Number.isInteger(t),()=>`Verbosity level is expected to be an integer >= 0, but got ${t}`),ee.checkForDuplicate(e),ee.constructors[t]==null&&(ee.constructors[t]=[]),ee.constructors[t].push(e)}static checkForDuplicate(t){for(const e in ee.constructors)ee.constructors[+e].forEach(i=>{if(i===t)throw new S("Duplicate callback constructor.")})}static clear(){ee.constructors={}}static createCallbacks(t){const e=[];for(const s in ee.constructors){const i=+s;t>=i&&e.push(...ee.constructors[i])}return e.map(s=>new s)}}ee.constructors={};function Jc(n,t,e,s,i,o,a,r,l){const c=new Zw,u=[new Jw,...ee.createCallbacks(t)];n!=null&&u.push(...n),u.push(c);const d=new Xw(u);return d.setParams({epochs:e,initialEpoch:s,samples:i,steps:o,batchSize:a,verbose:t,doValidation:r,metrics:l}),{callbackList:d,history:c}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Be(n,t={},e=!1){return bs(n,ms.getMap().classNameMap,t,"layer",e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Js(n,t){return D(()=>{n.dtype!=="float32"&&(n=X(n,"float32"));const e=lt(ws(n),t,!0),s=tf(e.shape,Mt()),i=on(gn(e,s));return ut(n,i)})}function wi(n,t){return D(()=>Lt(ws(pt(t,n)),-1))}function Ia(n,t){return D(()=>Lt(fn(pt(t,n)),-1))}function ka(n,t){return D(()=>{const e=pt(n,t),s=Xt(fn(n),Mt(),Number.MAX_VALUE),i=fn(ut(e,s));return A(100,Lt(i,-1))})}function tI(n,t){return D(()=>{const e=Xt(t,Mt(),Number.MAX_VALUE),s=Ze(J(1,e)),i=Xt(n,Mt(),Number.MAX_VALUE),o=Ze(J(1,i));return Lt(ws(pt(s,o)),-1)})}function eI(n,t){return D(()=>{const e=gn(0,pt(1,A(n,t)));return Lt(ws(e),-1)})}function nI(n,t){return D(()=>{const e=gn(0,pt(1,A(n,t)));return Lt(e,-1)})}function sI(n,t){return D(()=>{const e=lt(A(n,t),-1),s=zn(A(pt(1,n),t),-1);return gn(0,J(1,pt(s,e)))})}function iI(n,t){return D(()=>{const e=Math.log(2),s=pt(t,n),i=pt(J(s,hi(A(-2,s))),e);return Lt(i,-1)})}function cs(n,t,e=!1){return D(()=>{if(e)t=Uo(t);else{const s=lt(t,t.shape.length-1,!0);t=ut(t,s)}return t=Xt(t,Mt(),1-Mt()),Ht(lt(A(X(n,"float32"),Ze(t)),t.shape.length-1))})}function Zs(n,t,e=!1){return D(()=>{const s=X(So(Cw(n)),"int32");t=Xt(t,Mt(),1-Mt());const i=t.shape,o=V(Go(s,i[i.length-1]),i);return cs(o,t,e)})}function oI(n,t){if(!Jt(n.shape,t.shape))throw new S(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(t.shape)}`);return D(()=>{const e=Gn(t),s=Ht(fn(t));return J(pt(e,A(t,n)),Ql(Vn(s)))})}function Ii(n,t){return D(()=>{let e;return e=Xt(t,Mt(),1-Mt()),e=Ze(ut(e,pt(1,e))),Lt(oI(n,e),-1)})}function aI(n,t){return D(()=>{const e=Xt(n,Mt(),1),s=Xt(t,Mt(),1);return lt(A(n,Ze(ut(e,s))),-1)})}function rI(n,t){return D(()=>{const e=Ze(J(Mt(),t));return Lt(pt(t,A(n,e)),-1)})}function Zc(n,t){return D(()=>{const e=Js(n,-1),s=Js(t,-1),i=A(e,s);return Ht(lt(i,-1))})}const Qs={meanSquaredError:wi,meanAbsoluteError:Ia,meanAbsolutePercentageError:ka,meanSquaredLogarithmicError:tI,squaredHinge:eI,hinge:nI,categoricalHinge:sI,logcosh:iI,categoricalCrossentropy:cs,sparseCategoricalCrossentropy:Zs,binaryCrossentropy:Ii,kullbackLeiblerDivergence:aI,poisson:rI,cosineProximity:Zc};function zi(n){if(typeof n=="string"){if(n in Qs)return Qs[n];let t=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(t=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new S(t)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Qc(n,t){return D(()=>{const e=A(.5,ae(t)),s=Ae(ye(t,e),n.dtype);return Lt(fe(n,s),-1)})}function tu(n,t){return D(()=>Ae(fe(Mn(n,-1),Mn(t,-1)),"float32"))}function lI(n,t){return D(()=>X(lt(Pn(fe(n,1),fe(t,1))),"float32"))}function cI(n,t){return D(()=>X(lt(Pn(fe(n,0),fe(t,1))),"float32"))}function uI(n,t){return D(()=>{const e=lI(n,t),s=cI(n,t),i=J(e,s);return X(Ve(ye(i,0),ut(e,i),0),"float32")})}function hI(n,t){return Ii(n,t)}function dI(n,t){return n.rank===t.rank&&(n=Ne(n,[n.rank-1])),t=Mn(t,-1),t.dtype!==n.dtype&&(t=X(t,n.dtype)),X(fe(n,t),"float32")}const pI=wi,fI=wi,mI=Ia,gI=Ia,bI=ka,yI=ka,eu=cs,wI=Zc,nu=Zs,ti={binaryAccuracy:Qc,categoricalAccuracy:tu,precision:uI,categoricalCrossentropy:eu,sparseCategoricalCrossentropy:nu,mse:pI,MSE:fI,mae:mI,MAE:gI,mape:bI,MAPE:yI,cosine:wI};function II(n){if(typeof n=="string"&&n in ti)return ti[n];if(typeof n!="string"&&n!=null)return n;throw new S(`Unknown metric ${n}`)}function Fs(n){if(ke(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let t;for(const e of Object.keys(Qs))if(Qs[e]===n){t=e;break}if(t!==void 0)return t;for(const e of Object.keys(ti))if(ti[e]===n){t=e;break}return t!==void 0?t:n.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function kI(n){const t={Adagrad:()=>xn.adagrad(.01),Adadelta:()=>xn.adadelta(1,.95,Mt()),Adam:()=>xn.adam(.001,.9,.999,Mt()),Adamax:()=>xn.adamax(.002,.9,.999,Mt(),0),RMSProp:()=>xn.rmsprop(.001,.9,0,Mt()),SGD:()=>xn.sgd(.01)};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,n in t)return t[n]();throw new S(`Unknown Optimizer ${n}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const tr=1*1024*1024;function er(n,t,e=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!Xi(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(e){const s=JSON.stringify(n);s.length>tr&&console.warn(`User-defined metadata of model "${t}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${tr}.`)}}function Xi(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){const t=Object.keys(n);for(const e of t)if(typeof e!="string"||!Xi(n[e]))return!1;return!0}else if(Array.isArray(n)){for(const t of n)if(!Xi(t))return!1;return!0}else return!1;else{const t=typeof n;return t==="string"||t==="number"||t==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function xI(n,t,e,s=console.log){const i=NI(n),o=["Layer (type)","Input Shape","Output shape","Param #"];i?(t=t||90,e=e||[.32,.61,.89,1]):(t=t||115,e=e||[.24,.48,.7,.8,1]),e[e.length-1]<=1&&(e=e.map(u=>Math.floor(t*u)));let a;if(!i){o.push("Receives inputs"),a=[];for(const u in n.nodesByDepth)a.push(...n.nodesByDepth[u])}s("_".repeat(t)),ei(o,e,s),s("=".repeat(t));const r=n.layers;for(let u=0;u<r.length;++u)i?vI(r[u],e,s):CI(r[u],e,a,s),s((u===r.length-1?"=":"_").repeat(t));n.checkTrainableWeightsConsistency();const l=SI(n),c=Ks(n.nonTrainableWeights);s(`Total params: ${l+c}`),s(`Trainable params: ${l}`),s(`Non-trainable params: ${c}`),s("_".repeat(t))}function SI(n){let t;return n.collectedTrainableWeights!=null?t=Ks(n.collectedTrainableWeights):t=Ks(n.trainableWeights),t}function NI(n){let t=!0;const e=[],s=[];for(const i in n.nodesByDepth)e.push(n.nodesByDepth[i]);for(const i of e){if(i.length>1||i.length===1&&i[0].inboundLayers.length>1){t=!1;break}s.push(...i)}if(t)for(const i of n.layers){let o=!1;for(const a of i.inboundNodes)if(s.indexOf(a)!==-1)if(o){t=!1;break}else o=!0;if(!t)break}return t}function ei(n,t,e=console.log){let s="";for(let i=0;i<n.length;++i)i>0&&(s=s.slice(0,s.length-1)+" "),s+=n[i],s=s.slice(0,t[i]),s+=" ".repeat(t[i]-s.length);e(s)}function vI(n,t,e){let s,i;try{i=n.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{i="multiple"}try{s=JSON.stringify(n.outputShape)}catch{s="multiple"}const o=n.name,a=n.getClassName(),r=[`${o} (${a})`,i,s,n.countParams().toString()];ei(r,t,e)}function CI(n,t,e,s){let i,o;try{o=n.inboundNodes.map(d=>JSON.stringify(d.inputShapes)).join(",")}catch{o="multiple"}try{i=JSON.stringify(n.outputShape)}catch{i="multiple"}const a=[];for(const d of n.inboundNodes)if(!(e!=null&&e.length>0&&e.indexOf(d)===-1))for(let h=0;h<d.inboundLayers.length;++h){const p=d.inboundLayers[h].name,m=d.nodeIndices[h],f=d.tensorIndices[h];a.push(`${p}[${m}][${f}]`)}const r=n.name,l=n.getClassName(),c=a.length===0?"":a[0],u=[`${r} (${l})`,o,i,n.countParams().toString(),c];ei(u,t,s);for(let d=1;d<a.length;++d)ei(["","","","",a[d]],t,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function su(n,t,e){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&t===0&&typeof e=="string"}function Ji(n,t){if(n===null)return null;if(typeof n=="string")return un(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const e=[],s=n.length;for(let i=0;i<s;++i){const o=n[i];su(t,i,o)?e.push(o):e.push(Ji(o,t))}return e}else{const e={};for(const s of Object.keys(n)){const i=n[s];if(s==="name"&&typeof i=="string")e[s]=i;else{const o=un(s);e[o]=Ji(i,o)}}return e}}function Zi(n,t){if(n==null)return null;if(typeof n=="string")return Oe(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const e=[],s=n.length;for(let i=0;i<s;++i){const o=n[i];su(t,i,o)?e.push(o):e.push(Zi(o,t))}return e}else{const e={};for(const s of Object.keys(n)){const i=n[s],o=Oe(s);(s==="name"||s==="className")&&typeof i=="string"?e[o]=i:e[o]=Zi(i,s)}return e}}/** @license See the LICENSE file. */const iu="4.8.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class ue extends rt{constructor(t){if(super({}),this.containerNodes=new Set,this.name=t.name,this.name==null){const b=this.getClassName().toLowerCase();this.name=gi(b)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(t.inputs)?this.inputs=t.inputs.slice():this.inputs=[t.inputs],Array.isArray(t.outputs)?this.outputs=t.outputs.slice():this.outputs=[t.outputs],Ye(this.inputs).length!==this.inputs.length)throw new S(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(b=>b.name)}`);Ye(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(b=>b.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const b of this.outputs){const I=b.sourceLayer,y=b.nodeIndex,k=b.tensorIndex;this.outputLayers.push(I),this.outputLayersNodeIndices.push(y),this.outputLayersTensorIndices.push(k)}for(const b of this.inputs){const I=b.sourceLayer,y=b.nodeIndex,k=b.tensorIndex;ke(y===0,"input layer has >1 nodes"),ke(k===0,"input layer has >1 tensors"),this.inputLayers.push(I),this.inputLayersNodeIndices.push(y),this.inputLayersTensorIndices.push(k)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let b=0;b<this.inputLayers.length;b++){const I=this.inputLayers[b];if(!(I instanceof ks))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${t.inputs}. Input ${b} (0-based) originates from layer type ${I.getClassName()}.`);this.inputNames.push(I.name),this.feedInputShapes.push(I.batchInputShape),this.feedInputNames.push(I.name)}for(const b of this.outputLayers)this.outputNames.push(b.name);this.internalInputShapes=this.inputs.map(b=>b.shape),this.internalOutputShapes=this.outputs.map(b=>b.shape);const e={},s={},i={},o={},a={},r=[],l=(b,I,y,k,x,N)=>{(k==null||x==null||N==null)&&(k=b.sourceLayer,x=b.nodeIndex,N=b.tensorIndex);const v=k.inboundNodes[x];if(y.indexOf(v)!==-1)throw new ie(`The tensor ${b.name} at layer "${k.name}" is part of a cycle.`);if(I.indexOf(v)!==-1)return;this.containerNodes.add(ue.nodeKey(k,x)),k.id in a||(a[k.id]=Object.keys(a).length),y.indexOf(v)===-1&&y.push(v);const C=v.inboundLayers.length;for(let T=0;T<C;T++){const R=v.inputTensors[T],_=v.inboundLayers[T],M=v.nodeIndices[T],O=v.tensorIndices[T];l(R,I,y,_,M,O)}for(I.push(v);y.indexOf(v)>=0;)y.splice(y.indexOf(v),1);r.push(v)},c=[],u=[];for(const b of this.outputs)l(b,c,u);const d=r.slice().reverse();for(const b of d){s[b.id]=b,b.id in e||(e[b.id]=0);let I=e[b.id];const y=i[b.outboundLayer.id]==null?0:i[b.outboundLayer.id];I=Math.max(I,y),i[b.outboundLayer.id]=I,o[b.outboundLayer.id]=b.outboundLayer,e[b.id]=I;for(let k=0;k<b.inboundLayers.length;k++){const x=b.inboundLayers[k],N=b.nodeIndices[k],v=x.inboundNodes[N],C=e[v.id]==null?0:e[v.id];e[v.id]=Math.max(I+1,C),s[v.id]=v}}const h={};for(const b in e){const I=e[b];I in h||(h[I]=[]),h[I].push(s[b])}const p={};for(const b in i){const I=i[b];I in p||(p[I]=[]),p[I].push(o[b])}let m=Object.keys(p).map(b=>parseInt(b,10)).sort(Ts);this.layers=[];for(const b of m){const I=p[b];I.sort((y,k)=>{const x=a[y.id],N=a[k.id];return x<N?-1:x>N?1:0});for(const y of I)y instanceof ue&&this.internalContainerRefs.push(y),this.layers.push(y)}this.layersByDepth=p,m=Object.keys(h).map(b=>parseInt(b,10)).sort(Ts);const f=this.inputs.slice(),g=[];for(const b of m)for(const I of h[b]){const y=I.outboundLayer;if(y!=null){for(const k of I.inputTensors)if(f.indexOf(k)===-1)throw new ie(`Graph disconnected: cannot obtain value for tensor ${k} at layer "${y.name}". The following previous layers were accessed without issue: ${g}`);for(const k of I.outputTensors)f.push(k);g.push(y.name)}}this.nodesByDepth=h;const w=this.layers.map(b=>b.name);for(const b of w){const I=w.filter(y=>y===b).length;if(I!==1)throw new ie(`The name "${b}" is used ${I} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(w))}this.outboundNodes=[],this.inboundNodes=[],new yi({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(b=>null),outputMasks:this.outputs.map(b=>null),inputShapes:this.inputs.map(b=>b.shape),outputShapes:this.outputs.map(b=>b.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const t={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const e of this.layers)t.numDisposedVariables+=e.dispose().numDisposedVariables;for(const e of this.internalContainerRefs)t.numDisposedVariables+=e.dispose().numDisposedVariables}return t.refCountAfterDispose=this._refCount,t}get trainable(){return this.trainable_}set trainable(t){this.layers.forEach(e=>{e._trainableWeights.forEach(s=>s.trainable=t)}),this.trainable_=t}get trainableWeights(){if(this._trainableWeights.length>0)throw new S("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let t=[];for(const e of this.layers)t=t.concat(e.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const e of this.layers)t.push(...e.nonTrainableWeights);if(!this.trainable){const e=[];for(const s of this.layers)e.push(...s.trainableWeights);return e.concat(t)}return t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(t,e=!0){const s={};let i=0;for(const a of this.layers)for(const r of a.weights){if(s[r.originalName]!=null)throw new S(`Duplicate weight name: ${r.originalName}`);s[r.originalName]=r,i++}const o=[];for(const a in t){let r=a;if(s[a]==null){const l=a.split("/");r=l.slice(0,-2).concat([l[l.length-1]]).join("/")}if(s[r]!=null)o.push([s[r],t[a]]);else if(e)throw new S(`Provided weight data has no target variable: ${a}`);delete s[r]}if(e){const a=[];for(const r in s)a.push(r);if(a.length>0)throw new S(`${a.length} of ${i} weights are not set: ${a}`)}ya(o)}updatedConfig(){const t=this.getConfig(),e={};return e.className=this.getClassName(),e.config=t,e.kerasVersion=`tfjs-layers ${iu}`,e.backend="TensorFlow.js",e}toJSON(t,e=!0){const s=Zi(this.updatedConfig());return e?JSON.stringify(s):s}call(t,e){return D(()=>{t=kt(t);const s=new Ke;for(let i=0;i<this.inputs.length;++i)s.add(this.inputs[i],t[i]);return Zn(this.outputs,s,e)})}computeMask(t,e){return D(()=>{t=kt(t);let s;return e==null?s=mn(null,t.length):s=kt(e),this.runInternalGraph(t,s)[1]})}computeOutputShape(t){const e=qs(t);if(e.length!==this.inputLayers.length)throw new S(`Invalid inputShape argument ${t}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let r=0;r<e.length;r++){const l=this.inputLayers[r],c=e[r],u=l.name+"_0_0";s[u]=c}const i=Object.keys(this.nodesByDepth).map(r=>parseInt(r,10)).sort(Ts);if(i.length>1)for(const r of i){const l=this.nodesByDepth[r];for(const c of l){const u=c.outboundLayer;if(this.inputLayers.map(f=>f.id).indexOf(u.id)!==-1)continue;const d=[];for(let f=0;f<c.inboundLayers.length;f++){const g=c.inboundLayers[f],w=c.nodeIndices[f],b=c.tensorIndices[f],I=`${g.name}_${w}_${b}`,y=s[I];d.push(y)}const h=u.computeOutputShape(Gt(d)),p=qs(h),m=u.inboundNodes.indexOf(c);for(let f=0;f<p.length;f++){const g=`${u.name}_${m}_${f}`;s[g]=p[f]}}}const o=[],a=[];for(let r=0;r<this.outputLayers.length;r++){const l=this.outputLayers[r],c=this.outputLayersNodeIndices[r],u=this.outputLayersTensorIndices[r],d=`${l.name}_${c}_${u}`;a.push(d)}for(let r=0;r<a.length;r++){const l=a[r];ke(l in s),o.push(s[l])}return Gt(o)}runInternalGraph(t,e){e==null&&(e=mn(null,t.length));const s={};for(let l=0;l<this.inputs.length;++l){const c=this.inputs[l],u=t[l],d=e[l];s[c.id]=[u,d]}const i=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(Ts);for(const l of i){const c=this.nodesByDepth[l];for(const u of c){const d=u.outboundLayer,h=u.inputTensors,p=u.outputTensors,m=new Array;for(const f of h)f.id in s&&m.push(s[f.id]);if(m.length===h.length){let f={},g,w,b,I;if(u.callArgs!=null&&(f=u.callArgs),m.length===1){const[y,k]=m[0];f.mask==null&&(f.mask=k),b=kt(d.call(y,f)),I=kt(d.computeMask(y,k)),g=[y],w=[k]}else g=m.map(y=>y[0]),w=m.map(y=>y[1]),f.mask==null&&(f.mask=w),b=kt(d.call(g,f)),I=kt(d.computeMask(g,w));if(d.activityRegularizer)throw new it("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let y=0;y<p.length;++y){const k=p[y],x=b[y],N=I[y];s[k.id]=[x,N]}}}}const o=[],a=[],r=[];for(const l of this.outputs){ke(l.id in s,`Could not compute output ${l.name} : ${l.id}`);const[c,u]=s[l.id];r.push(c.shape),o.push(c),a.push(u)}return[o,a,r]}buildNodeConversionMap(t){const e={};let s;for(const i of this.layers){s=i instanceof ue?1:0;for(let o=0;o<i.inboundNodes.length;o++){const a=ue.nodeKey(i,o);this.containerNodes.has(a)&&(e[a]=s,s+=1)}}return e}getLayer(t,e){if(e!=null)return this.findLayer(e);if(t==null)throw new S("Provide either a layer name or layer index");if(typeof t=="number")return this.findLayer(t);for(const s of this.layers)if(s.name===t)return s;throw new S(`No such layer: ${t}`)}findLayer(t){if(this.layers.length<=t)throw new S(`Was asked to retrieve layer at index ${t}, but model only has ${this.layers.length} layer(s).`);return this.layers[t]}calculateLosses(){return D(()=>{const t=[];for(const e of this.layers)for(let s=0;s<e.inboundNodes.length;++s){const i=ue.nodeKey(e,s);this.containerNodes.has(i)&&t.push(...e.calculateLosses())}return t})}getConfig(){const t={name:this.name},e=this.buildNodeConversionMap(this.layers),s=[];for(const a of this.layers){const r=a.getClassName(),l=a.getConfig(),c=[];for(let d=0;d<a.inboundNodes.length;d++){const h=a.inboundNodes[d],p=ue.nodeKey(a,d);let m={};if(this.containerNodes.has(p)){if(h.callArgs)try{JSON.stringify(h.callArgs),m=h.callArgs}catch{console.warn(`Layer ${a.name} was passed non-serializable keyword arguments: ${h.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),m={}}if(h.inboundLayers.length>0){const f=[];for(let g=0;g<h.inboundLayers.length;g++){const w=h.inboundLayers[g],b=h.nodeIndices[g],I=h.tensorIndices[g],y=ue.nodeKey(w,b);let k=e[y];k==null&&(k=0),f.push([w.name,k,I,m])}c.push(f)}}}const u={};u.name=a.name,u.className=r,u.config=l,u.inboundNodes=c,s.push(u)}t.layers=s;const i=[];for(let a=0;a<this.inputLayers.length;a++){const r=this.inputLayers[a],l=this.inputLayersNodeIndices[a],c=ue.nodeKey(r,l);if(!this.containerNodes.has(c))continue;let u=e[c];u==null&&(u=0);const d=this.inputLayersTensorIndices[a];i.push([r.name,u,d])}t.inputLayers=i;const o=[];for(let a=0;a<this.outputLayers.length;a++){const r=this.outputLayers[a],l=this.outputLayersNodeIndices[a],c=ue.nodeKey(r,l);if(!this.containerNodes.has(c))continue;let u=e[c];u==null&&(u=0);const d=this.outputLayersTensorIndices[a];o.push([r.name,u,d])}return t.outputLayers=o,t}static fromConfig(t,e,s={},i=!1){const o={},a={};function r(g,w){g.name in a?a[g.name].push(w):a[g.name]=[w]}function l(g,w){const b=[];let I;for(const y of w){const k=y[0],x=y[1],N=y[2];if(I=y[3]==null?{}:y[3],!(k in o)){r(g,w);return}const v=o[k];if(v.inboundNodes.length<=x){r(g,w);return}const C=v.inboundNodes[x];b.push(C.outputTensors[N])}b.length>0&&g.apply(Gt(b),I)}function c(g){const w=g.name,b=Be(g,e.customObjects!=null?e.customObjects:{});b.setFastWeightInitDuringBuild(i),o[w]=b,g.inboundNodes.forEach(y=>{if(!(y instanceof Array))throw new S(`Corrupted configuration, expected array for nodeData: ${y}`);r(b,y)})}const u=e.name,d=e.layers;for(const g of d)c(g);for(;!pw(a);)for(const g of d){const w=o[g.name];if(w.name in a){const b=a[w.name];delete a[w.name];for(const I of b)l(w,I)}}const h=[],p=[],m=e.inputLayers;for(const g of m){const w=g[0],b=g[1],I=g[2];ke(w in o);const k=o[w].inboundNodes[b].outputTensors;h.push(k[I])}const f=e.outputLayers;for(const g of f){const w=g[0],b=g[1],I=g[2];ke(w in o);const k=o[w].inboundNodes[b].outputTensors;p.push(k[I])}return new t({inputs:h,outputs:p,name:u})}get stateful(){if(this._stateful)throw new S("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const t of this.layers)if(t.stateful)return!0;return!1}resetStates(){D(()=>{this.layers.forEach(t=>{t.stateful&&t.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function TI(n,t,e){const s=t.length;if(n==null||Array.isArray(n)&&n.length===0)return t.map(i=>null);if(s===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&t[0]in n?[n[t[0]]]:[n];if(Array.isArray(n)){if(n.length!==s)throw new Error(`Provided ${e} is an array of ${n.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){const i=[];return t.forEach(o=>{o in n?i.push(n[o]):i.push(null)}),i}else throw new Error(`The model has multiple (${s}) outputs, so ${e} must be either an array with ${s} elements or an object with ${t} keys. Provided ${e} not understood: ${JSON.stringify(n)}`)}function ou(n,t){return TI(n,t,"classWeight")}async function au(n,t,e,s){if(t!=null||s!=null)throw new Error("Support sampleWeight is not implemented yet");if(e!=null){const i=D(()=>{if(n.shape.length===1)return ef(n);if(n.shape.length===2){if(n.shape[1]>1)return Mn(n,1);if(n.shape[1]===1)return V(n,[n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),o=Array.from(await i.data());St(i);const a=[];return o.forEach(r=>{if(e[r]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${r} exists in the data but not in classWeight`);a.push(e[r])}),Us(a,"float32")}else return null}function DI(n,t){return A(n,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const AI=32;function ru(n,t){let e,s;const i=t;e=i.xs,s=i.ys,Y(e!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${t}`);const o=nr("input",n.inputNames,e),a=nr("output",n.outputNames,s),r=o[0].shape[0];Y(o.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${o.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),Y(a.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${a.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let l=0;l<o.length;l++)Y(o[l].shape[0]===r,()=>`Batch size mismatch: input ${n.inputNames[l]} has ${o[l].shape[0]}; expected  ${r} based on input ${n.inputNames[0]}.`);for(let l=0;l<a.length;l++)Y(a[l].shape[0]===r,()=>`Batch size mismatch: output ${n.outputNames[l]} has ${a[l].shape[0]}; expected  ${r} based on input ${n.inputNames[0]}.`);return{xs:o,ys:a}}function nr(n,t,e){if(e instanceof Re)return[e];if(Array.isArray(e))return Y(e.length===t.length,()=>`Received an array of ${e.length} Tensors, but expected ${t.length} to match the ${n} keys ${t}.`),e;{const s=[];for(const i of t){if(e[i]==null)throw new S(`The feature data generated by the dataset lacks the required ${n} key '${i}'.`);s.push(e[i])}return s}}function FI(n){if(n.length===3)throw new it("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}async function RI(n,t,e){const s=e.batchesPerEpoch!=null;if(Y(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),Y(e!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),Y(e.epochs!=null&&e.epochs>0&&Number.isInteger(e.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${e.epochs}`),Y(!s||e.batchesPerEpoch>0&&Number.isInteger(e.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${e.batchesPerEpoch}`),Y(e.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{const i=e.validationData!=null;let o,a;if(i)if(sr(e.validationData))Y(e.validationBatches==null||e.validationBatches>0&&Number.isInteger(e.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${e.validationBatches}`);else{const g=FI(e.validationData);o=g.xs,a=g.ys}const r=n.makeTrainFunction(),l=n.getDedupedMetricsNames();let c;i?c=l.slice().concat(l.map(g=>"val_"+g)):c=l.slice();const u=Xc(e.callbacks,e.yieldEvery),d=e.verbose==null?1:e.verbose,{callbackList:h,history:p}=Jc(u,d,e.epochs,null,null,MI(t,e),null,i,c);h.setModel(n),n.history=p,await h.onTrainBegin(),n.stopTraining_=!1;let m=e.initialEpoch==null?0:e.initialEpoch,f=await t.iterator();for(;m<e.epochs;){const g={};await h.onEpochBegin(m);let w=0,b=0;for(s||(f=await t.iterator());!s||w<e.batchesPerEpoch;){const I=await f.next();if(s&&I.done){console.warn(`You provided \`batchesPerEpoch\` as ${e.batchesPerEpoch}, but your dataset iterator ran out of data after ${w} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${e.batchesPerEpoch*e.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(I.value!=null){const{xs:y,ys:k}=ru(n,I.value),x={};x.batch=b,x.size=y[0].shape[0],await h.onBatchBegin(b,x);const N=[];if(e.classWeight!=null){const T=ou(e.classWeight,n.outputNames);for(let R=0;R<T.length;++R)N.push(await au(k[R],null,T[R]))}const v=y.concat(k).concat(N),C=r(v);St(v);for(let T=0;T<l.length;++T){const R=l[T],_=C[T];x[R]=_,Pe(_)}await h.onBatchEnd(b,x),Yc(x),b++,w++}if(s?w>=e.batchesPerEpoch:I.done){if(i){let y;sr(e.validationData)?y=kt(await n.evaluateDataset(e.validationData,{batches:e.validationBatches})):y=kt(n.evaluate(o,a,{batchSize:e.validationBatchSize==null?AI:e.validationBatchSize,verbose:0}));for(let k=0;k<n.metricsNames.length;++k)g[`val_${n.metricsNames[k]}`]=y[k]}break}if(n.stopTraining_)break}if(await h.onEpochEnd(m,g),m++,n.stopTraining_)break}return await h.onTrainEnd(),await n.history.syncData(),n.history}finally{n.isTraining=!1}}function MI(n,t){let e=null;return t.batchesPerEpoch!=null?e=t.batchesPerEpoch:Number.isFinite(n.size)&&(e=n.size),e}function sr(n){return typeof n.iterator=="function"}function zI(n){return typeof n.next=="function"}async function EI(n,t,e){e=e||{};const s=e.batches!=null,i=n.testFunction;let o=[];if(e.verbose>0)throw new it("Verbose mode is not implemented yet.");Y(!s||e.batches>0&&Number.isInteger(e.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(e.batches)}`);const a=zI(t)?t:await t.iterator();let r=0,l=0;for(;!s||l<e.batches;){const c=await a.next();if(o=D(()=>{if(c.value){const{xs:u,ys:d}=ru(n,c.value),h=u.concat(d),p=D(()=>i(h));if(St(h),l===0)for(let f=0;f<p.length;++f)o.push(Nt(0));const m=h[0].shape[0];for(let f=0;f<p.length;++f){const g=p[f],w=o[f];o[f]=D(()=>J(o[f],A(m,g))),l>0&&St(w)}St(p),r+=m,++l}return o}),c.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${e.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let c=0;c<o.length;++c){const u=o[c];o[c]=ut(o[c],r),St(u)}return Gt(o)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ei(n){Y(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function Yn(n,t,e){return n==null?[null]:Array.isArray(n)?n.map(s=>pn(s,t,e-t)):pn(n,t,e-t)}function Qi(n,t){return D(()=>n==null?null:Array.isArray(n)?n.map(e=>Qi(e,t)):$c(n,t.dtype==="int32"?t:X(t,"int32")))}function $i(n,t){const e=[];let s=0,i=null;for(;s<n;)i=s+t,i>=n&&(i=n),e.push([s,i]),s=i;return e}function lu(n){const t=[];n instanceof Re&&(n=[n]);for(let e=0;e<n.length;++e){const s=n[e];if(s.rank===1)t.push(ys(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(s)}}return t}function ce(n,t){if(n==null)return;const e=[];if(t instanceof Re)e.push(t.id);else if(Array.isArray(t))t.forEach(i=>e.push(i.id));else if(t!=null)for(const i in t){const o=t[i];e.push(o.id)}const s=[];if(n instanceof Re)e.indexOf(n.id)===-1&&s.push(n);else if(Array.isArray(n))n.forEach(i=>{e.indexOf(i.id)===-1&&s.push(i)});else if(n!=null)for(const i in n){const o=n[i];e.indexOf(o.id)===-1&&s.push(o)}s.forEach(i=>{i.isDisposed||i.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function $I(n){return n instanceof Re}function to(n){return Array.isArray(n)}function ir(n){return!$I(n)&&!to(n)}function or(n,t,e,s=!0,i=""){if(t==null||t.length===0){if(n!=null){let a=!1;if(to(n)&&n.length>0)a=!0;else if(ir(n)){for(const r in n)if(n.hasOwnProperty(r)){a=!0;break}}else a=!0;if(a)throw new S(`Error when checking model ${i} expected no data, but got ${n}`)}return[]}if(n==null)return t.map(a=>null);let o;if(ir(n)){n=n,o=[];for(const a of t){if(n[a]==null)throw new S(`No data provided for "${a}". Need data for each key in: ${t}`);o.push(n[a])}}else if(to(n)){if(n=n,n.length!==t.length)throw new S(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${t.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);o=n}else{if(n=n,t.length>1)throw new S(`The model ${i} expects ${t.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);o=[n]}if(o=lu(o),e!=null)for(let a=0;a<t.length;++a){if(e[a]==null)continue;const r=o[a];if(r.shape.length!==e[a].length)throw new S(`Error when checking ${i}: expected ${t[a]} to have ${e[a].length} dimension(s). but got array with shape ${r.shape}`);for(let l=0;l<e[a].length;++l){if(l===0&&!s)continue;const c=r.shape[l],u=e[a][l];if(u!=null&&u>=0&&c!==u)throw new S(`${i} expected a batch of elements where each example has shape [${e[a].slice(1,e[a].length)}] (i.e.,tensor shape [*,${e[a].slice(1,e[a].length)}]) but the ${i} received an input with ${r.shape[0]} examples, each with shape [${r.shape.slice(1,r.shape.length)}] (tensor shape [${r.shape}])`)}}return o}function OI(n,t,e){const s=Ye(n.map(o=>o.shape[0]));s.sort();const i=Ye(t.map(o=>o.shape[0]));if(i.sort(),s.length>1)throw new S(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(o=>o.shape))}`);if(i.length>1)throw new S(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(o=>o.shape))}`);if(s.length>0&&i.length>0&&!Jt(s,i))throw new S(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${i[0]} target sample(s).`)}function LI(n,t,e){const s=[wi,Ii,cs];for(let i=0;i<n.length;++i){const o=n[i],a=t[i],r=e[i];if(a!=null){if(a===cs&&o.shape[o.shape.length-1]===1)throw new S(`You are passing a target array of shape ${o.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(a)!==-1){const l=o.shape.slice(1),c=r.slice(1);for(let u=0;u<l.length;++u){const d=l[u],h=c[u];if(h!=null&&d!==h)throw new S(`A target Tensor with shape ${o.shape} was passed for an output of shape ${r}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function ar(n,t,e,s=!0,i=""){let o;if(Array.isArray(n)){if(n.length!==t.length)throw new S(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${t.length} Tensor(s), but instead got ${n.length} Tensors(s).`);o=n}else{if(t.length>1)throw new S(`The model expects ${t.length} ${i} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);o=[n]}if(e!=null)for(let a=0;a<t.length;++a){if(e[a]==null)continue;const r=o[a];if(r.shape.length!==e[a].length)throw new S(`Error when checking ${i}: expected ${t[a]} to have ${e[a].length} dimension(s), but got array with shape ${JSON.stringify(r.shape)}`);for(let l=0;l<e[a].length;++l){if(l===0&&!s)continue;const c=r.shape[l],u=e[a][l];if(u!=null&&u!==c)throw new S(`Error when checking ${i}: expected ${t[a]} to have shape ${JSON.stringify(e[a])} but got array with shape ${JSON.stringify(r.shape)}.`)}}}function _I(n,t){if(n==null||Array.isArray(n)&&n.length===0)return t.map(s=>[]);let e;if(typeof n=="string"||typeof n=="function")e=[n];else if(Array.isArray(n)||typeof n=="object")e=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(e))return t.map(s=>e);{const s=[];for(const i of t){let o=e.hasOwnProperty(i)?e[i]:[];Array.isArray(o)||(o=[o]),s.push(o)}return s}}const PI="layers-model";class Fn extends ue{constructor(t){super(t),this.isTraining=!1}summary(t,e,s=console.log){if(!this.built)throw new S("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");xI(this,t,e,s)}compile(t){if(t.loss==null&&(t.loss=[]),this.loss=t.loss,typeof t.optimizer=="string")this.optimizer_=kI(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof nf))throw new S("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}let e=[];if(!Array.isArray(t.loss)&&typeof t.loss!="string"&&typeof t.loss!="function"){t.loss=t.loss;for(const a in t.loss)if(this.outputNames.indexOf(a)===-1)throw new S(`Unknown entry in loss dictionary: "${a}". Only expected the following keys: ${this.outputNames}`);for(const a of this.outputNames)t.loss[a]==null&&console.warn(`Output "${a}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${a} during training`),e.push(zi(t.loss[a]))}else if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new S(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${t.loss}.`);e=t.loss.map(r=>zi(r))}else{const a=zi(t.loss);this.outputs.forEach(r=>{e.push(a)})}this.lossFunctions=e,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let a=0;a<this.outputs.length;++a){const r=this.internalOutputShapes[a],l=this.outputNames[a];this.feedOutputNames.push(l),this.feedOutputShapes.push(r),this.feedLossFns.push(this.lossFunctions[a])}const s=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],dn("loss",()=>{for(let a=0;a<this.outputs.length;++a){if(s.indexOf(a)!==-1)continue;const r=this.lossFunctions[a];this.outputs.length>1&&(this.metricsTensors.push([r,a]),this.metricsNames.push(this.outputNames[a]+"_loss"))}});const i=_I(t.metrics,this.outputNames),o=(a,r,l)=>{this.outputNames.length>1&&(r=this.outputNames[a]+"_"+r),this.metricsNames.push(r),this.metricsTensors.push([l,a])};dn("metric",()=>{for(let a=0;a<this.outputs.length;++a){if(s.indexOf(a)!==-1)continue;const r=i[a];(c=>{const u="";let d,h,p;for(const m of c){if(typeof m=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(m)!==-1){const g=this.internalOutputShapes[a];g[g.length-1]===1||this.lossFunctions[a]===Ii?["accuracy","acc"].indexOf(m)!==-1?h=Qc:["crossentropy","ce"].indexOf(m)!==-1&&(h=hI):this.lossFunctions[a]===Zs?["accuracy","acc"].indexOf(m)!==-1?h=dI:["crossentropy","ce"].indexOf(m)!==-1&&(h=nu):["accuracy","acc"].indexOf(m)!==-1?h=tu:["crossentropy","ce"].indexOf(m)!==-1&&(h=eu);let w;["accuracy","acc"].indexOf(m)!==-1?w="acc":["crossentropy","ce"].indexOf(m)!==-1&&(w="ce"),p=h,d=u+w}else p=II(m),d=u+Fs(m);let f;dn(d,()=>{f=p}),o(a,d,f)}})(r)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(t,e,s={}){const i=s.batchSize==null?32:s.batchSize;Ei(i);const o=!0,a=this.standardizeUserDataXY(t,e,o,i);try{const r=a[0].concat(a[1]);this.makeTestFunction();const l=this.testFunction,c=this.testLoop(l,r,i,s.verbose,s.steps);return Gt(c)}finally{ce(a[0],t),ce(a[1],e)}}async evaluateDataset(t,e){return this.makeTestFunction(),EI(this,t,e)}checkNumSamples(t,e,s,i="steps"){let o;if(s!=null){if(o=null,e!=null)throw new S(`If ${i} is set, batchSize must be null or undefined.Got batchSize = ${e}`)}else if(t!=null)Array.isArray(t)?o=t[0].shape[0]:o=t.shape[0];else throw new S(`Either the input data should have a defined shape, or ${i} shoud be specified.`);return o}execute(t,e){if(Array.isArray(e)&&e.length===0)throw new S("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(e),i=s?e:[e],o=this.retrieveSymbolicTensors(i),a=new Ke;if(t instanceof Re&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new S(`The number of inputs provided (${t.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)a.add(this.inputs[l],t[l])}else for(const l of this.inputs){const c=t[l.name];if(c==null)throw new S(`No value is provided for the model's input ${l.name}`);a.add(l,c)}const r=Zn(o,a);return s?r:r[0]}retrieveSymbolicTensors(t){const e=mn(null,t.length);let s=t.length;for(const i of this.layers){const o=Array.isArray(i.output)?i.output:[i.output],a=o.map(r=>r.name);for(let r=0;r<t.length;++r){const l=a.indexOf(t[r]);if(l!==-1&&(e[r]=o[l],s--),s===0)break}if(s===0)break}if(s>0){const i=[];throw e.forEach((o,a)=>{o==null&&i.push(t[a])}),new S(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(i)}`)}return e}predictLoop(t,e=32,s=!1){return D(()=>{const i=this.checkNumSamples(t);if(s)throw new it("Verbose predictLoop() is not implemented yet.");const o=$i(i,e),a=this.outputs.map(r=>[]);for(let r=0;r<o.length;++r)D(()=>{const c=o[r][0],u=o[r][1],d=Yn(t,c,u),h=[];if(Array.isArray(d))for(let m=0;m<d.length;++m)h.push({key:this.inputs[m],value:d[m]});else h.push({key:this.inputs[0],value:d});const p=new Ke(h);return Zn(this.outputs,p)}).forEach((c,u)=>a[u].push(c));return Gt(a.map(r=>ps(r,0)))})}predict(t,e={}){const s=lu(t);ar(s,this.inputNames,this.feedInputShapes,!1);try{const i=e.batchSize==null?32:e.batchSize;return Ei(i),this.predictLoop(s,i)}finally{ce(s,t)}}predictOnBatch(t){ar(t,this.inputNames,this.feedInputShapes,!0);const e=(Array.isArray(t)?t[0]:t).shape[0];return this.predictLoop(t,e)}standardizeUserDataXY(t,e,s=!0,i){if(this.optimizer_==null)throw new ie("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const o=[];for(let a=0;a<this.feedOutputShapes.length;++a){const r=this.feedOutputShapes[a];this.feedLossFns[a]===Zs?o.push(r.slice(0,r.length-1).concat([1])):o.push(r)}if(t=or(t,this.feedInputNames,this.feedInputShapes,!1,"input"),e=or(e,this.feedOutputNames,o,!1,"target"),OI(t,e),LI(e,this.feedLossFns,this.feedOutputShapes),this.stateful&&i!=null&&i>0&&t[0].shape[0]%i!==0)throw new S(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${i}. Found: ${t[0].shape[0]} sample(s).`);return[t,e]}async standardizeUserData(t,e,s,i,o=!0,a){const[r,l]=this.standardizeUserDataXY(t,e,o,a);if(s!=null)throw new Error("sample weight is not supported yet.");let c=null;if(i!=null){const u=ou(i,this.outputNames);c=[];for(let d=0;d<u.length;++d)c.push(await au(l[d],null,u[d]))}return[r,l,c]}testLoop(t,e,s,i=0,o){return D(()=>{const a=this.checkNumSamples(e,s,o,"steps"),r=[];if(i>0)throw new it("Verbose mode is not implemented yet.");if(o!=null)throw new it("steps mode in testLoop() is not implemented yet");{const l=$i(a,s),c=Us(me(0,a));for(let u=0;u<l.length;++u){const d=l[u][0],h=l[u][1],p=pn(c,d,h-d),m=Qi(e,p),f=t(m);if(u===0)for(let g=0;g<f.length;++g)r.push(Nt(0));for(let g=0;g<f.length;++g){const w=f[g];r[g]=J(r[g],A(h-d,w))}}for(let u=0;u<r.length;++u)r[u]=ut(r[u],a)}return r})}getDedupedMetricsNames(){const t=this.metricsNames,e=[];for(let s=0;s<t.length;++s){const i=t[s];let o=i;if(Ga(t,i)>1){const a=Ga(t.slice(0,s),i);o+=`_${a}`}e.push(o)}return e}makeTrainFunction(){return t=>{const e=[],s=t.slice(0,this.inputs.length),i=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=t.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),a=[],r=()=>{const d=[];for(let f=0;f<this.inputs.length;++f)d.push({key:this.inputs[f],value:s[f]});const h=new Ke(d),p=Zn(this.outputs,h,{training:!0});let m;for(let f=0;f<this.lossFunctions.length;++f){const g=this.lossFunctions[f];let w=g(i[f],p[f]);o[f]!=null&&(w=DI(w,o[f]));const b=Lt(w);e.push(b),f===0?m=w:m=J(m,w)}for(let f=0;f<this.metricsTensors.length;++f){let g;if(this.outputs.length>1&&f<this.outputs.length)g=e[f];else{const w=this.metricsTensors[f][0],b=this.metricsTensors[f][1];g=Lt(w(i[b],p[b]))}Pe(g),a.push(g)}return m=Lt(m),this.calculateLosses().forEach(f=>{m=J(m,f)}),m},l=this.collectedTrainableWeights.map(d=>d.read()),c=!0;return[this.optimizer_.minimize(r,c,l)].concat(a)}}makeTestFunction(){this.testFunction=t=>D(()=>{const e=[];let s;const i=t.slice(0,this.inputs.length),o=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),a=[];for(let c=0;c<this.inputs.length;++c)a.push({key:this.inputs[c],value:i[c]});const r=new Ke(a),l=Zn(this.outputs,r);for(let c=0;c<this.lossFunctions.length;++c){const u=this.lossFunctions[c],d=Lt(u(o[c],l[c]));c===0?s=d:s=J(s,d),e.push(s)}for(let c=0;c<this.metricsTensors.length;++c){const u=this.metricsTensors[c][0],d=this.metricsTensors[c][1],h=Lt(u(o[d],l[d]));e.push(h)}return e})}async fit(t,e,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let i,o,a,r,l,c,u,d,h;try{const p=s.batchSize==null?32:s.batchSize;Ei(p);const m=!1,f=await this.standardizeUserData(t,e,s.sampleWeight,s.classWeight,m,p);i=f[0],o=f[1],h=f[2];let g=!1,w;if(s.validationData!=null&&s.validationData.length>0){if(g=!0,s.validationData.length===2)l=s.validationData[0],c=s.validationData[1];else throw s.validationData.length===3?new it("validationData including sample weights is not supported yet."):new S(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const C=!0,T=await this.standardizeUserData(l,c,null,null,C,p);u=T[0],d=T[1],w=u.concat(d)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){g=!0;const C=Math.floor(i[0].shape[0]*(1-s.validationSplit)),T=i[0].shape[0];u=Yn(i,C,T),a=i,i=Yn(i,0,C),d=Yn(o,C,T),r=o,o=Yn(o,0,C),w=u.concat(d)}else s.validationSteps!=null&&(g=!0);const b=i.concat(o).concat(h);this.checkTrainableWeightsConsistency();const I=this.makeTrainFunction(),y=this.getDedupedMetricsNames();let k,x;g?(this.makeTestFunction(),k=this.testFunction,x=y.slice().concat(y.map(C=>"val_"+C))):(k=null,w=[],x=y.slice());const N=Xc(s.callbacks,s.yieldEvery);return await this.fitLoop(I,b,y,p,s.epochs,s.verbose,N,k,w,s.shuffle,x,s.initialEpoch,null,null)}finally{this.isTraining=!1,ce(i,t),ce(o,e),ce(a,t),ce(r,e),ce(u,l),ce(d,c),h!=null&&St(h)}}async fitLoop(t,e,s,i,o,a,r,l,c,u,d,h,p,m){i==null&&(i=32),o==null&&(o=1),u==null&&(u=!0),h==null&&(h=0);let f=!1;if(l!=null&&c!=null&&(f=!0),m!=null&&(f=!0,p==null))throw new S("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const g=this.checkNumSamples(e,i,p,"steps_per_epoch");let w;g!=null&&(w=me(0,g)),a==null&&(a=1);const{callbackList:b,history:I}=Jc(r,a,o,h,g,p,i,f,d);b.setModel(this),this.history=I,await b.onTrainBegin(),this.stopTraining_=!1;for(let y=h;y<o;++y){await b.onEpochBegin(y);const k={};if(p!=null)throw new it("stepsPerEpoch mode is not implemented yet.");{if(u==="batch")throw new it("batch shuffling is not implemneted yet");u&&sf(w);const x=Us(w),N=$i(g,i);for(let v=0;v<N.length;++v){const C={};if(await b.onBatchBegin(v,C),D(()=>{const T=N[v][0],R=N[v][1],_=pn(x,T,R-T);C.batch=v,C.size=R-T;const M=Qi(e,_),O=t(M);for(let z=0;z<s.length;++z){const E=s[z],L=O[z];C[E]=L,Pe(L)}if(v===N.length-1&&f){const z=this.testLoop(l,c,i);for(let E=0;E<s.length;++E){const L=s[E],$=z[E];Pe($),k["val_"+L]=$}}}),await b.onBatchEnd(v,C),Yc(C),this.stopTraining_)break}x.dispose()}if(await b.onEpochEnd(y,k),this.stopTraining_)break}return await b.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(t,e){return RI(this,t,e)}async trainOnBatch(t,e){const s=await this.standardizeUserData(t,e),i=s[0],o=s[1],r=this.makeTrainFunction()(i.concat(o)),l=[];for(const c of r){const u=await c.data();l.push(u[0])}return St(r),ce(s[0],t),ce(s[1],e),Gt(l)}getNamedWeights(t){const e=[],s=t!=null&&t.trainableOnly,i=s?this.trainableWeights:this.weights,o=this.getWeights(s);for(let a=0;a<i.length;++a)s&&!i[a].trainable||e.push({name:i[a].originalName,tensor:o[a]});return e}set stopTraining(t){this.stopTraining_=t}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)}dispose(){const t=super.dispose();if(t.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const e=Gi().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=e-Gi().numTensors}return t}getLossIdentifiers(){let t;if(typeof this.loss=="string")t=Oe(this.loss);else if(Array.isArray(this.loss)){for(const e of this.loss)if(typeof e!="string")throw new Error("Serialization of non-string loss is not supported.");t=this.loss.map(e=>Oe(e))}else{const e=Object.keys(this.loss);t={};const s=this.loss;for(const i of e)if(typeof s[i]=="string")t[i]=Oe(s[i]);else throw new Error("Serialization of non-string loss is not supported.")}return t}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Oe(Fs(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(t=>Oe(Fs(t)));{const t={};for(const e in this.metrics)t[e]=Oe(Fs(this.metrics[e]));return t}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(t){if(t.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(t.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(t.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const e=Ji(t.optimizer_config),s=Be(e);let i;if(typeof t.loss=="string")i=un(t.loss);else if(Array.isArray(t.loss))i=t.loss.map(a=>un(a));else if(t.loss!=null){i={};for(const a in t.loss)i[a]=un(t.loss[a])}let o;if(Array.isArray(t.metrics))o=t.metrics.map(a=>un(a));else if(t.metrics!=null){o={};for(const a in t.metrics)o[a]=un(t.metrics[a])}this.compile({loss:i,metrics:o,optimizer:s})}async save(t,e){if(typeof t=="string"){const c=of(t);if(c.length===0)throw new S(`Cannot find any save handlers for URL '${t}'`);if(c.length>1)throw new S(`Found more than one (${c.length}) save handlers for URL '${t}'`);t=c[0]}if(t.save==null)throw new S("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await Oa(this.getNamedWeights(e)),i=!1,o=null,r={modelTopology:this.toJSON(o,i),format:PI,generatedBy:`TensorFlow.js tfjs-layers v${iu}`,convertedBy:null};if((e==null?!1:e.includeOptimizer)&&this.optimizer!=null){r.trainingConfig=this.getTrainingConfig();const c="optimizer",{data:u,specs:d}=await Oa(await this.optimizer.getWeights(),c);s.specs.push(...d),s.data=af([s.data,u])}return this.userDefinedMetadata!=null&&(er(this.userDefinedMetadata,this.name,!0),r.userDefinedMetadata=this.userDefinedMetadata),r.weightData=s.data,r.weightSpecs=s.specs,t.save(r)}setUserDefinedMetadata(t){er(t,this.name),this.userDefinedMetadata=t}getUserDefinedMetadata(){return this.userDefinedMetadata}}Fn.className="Model";B(Fn);class cu extends Fn{}cu.className="Functional";B(cu);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class us extends Fn{constructor(t){if(super({inputs:[],outputs:[]}),t=t||{},this.trainable=!0,this.built=!1,this.name=t.name!=null?t.name:gi("sequential_"),t.layers!=null)for(const e of t.layers)this.add(e)}checkShape(t){if(t.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new S(`Negative dimension size caused by adding layer ${t.name} with input shape [${t.inboundNodes[0].inputTensors[0].shape}]`)}add(t){const e=t instanceof us||t instanceof Fn;let s;if(e){if(s=t,s.outputs.length!==1)throw new S("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new S("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(t.inboundNodes.length===0){if(t.batchInputShape==null)throw new S("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const i=Ww({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(i)}if(e)this.outputs=s.outputs,this.inputs=s.inputs;else{if(t.inboundNodes.length!==1)throw new S(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${t.name} which has ${t.inboundNodes.length} pre-existing inbound connections.`);if(t.inboundNodes[0].outputTensors.length!==1)throw new S("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=Gc(this.outputs[0])}this.inboundNodes=[],new yi({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:mn(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(i=>i.shape),outputShapes:this.outputs[0].shape})}else{const i=t.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(t,e){return this.model==null&&this.build(),this.model.call(t,e)}build(t){if(ht(t),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Fn({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(t,e,s=console.log){this.built||this.build(),super.summary(t,e,s)}setWeights(t){this.model==null&&this.build(),this.model.setWeights(t)}evaluate(t,e,s={}){if(!this.built)throw new ie("The model needs to be compiled before being used.");return this.model.evaluate(t,e,s)}async evaluateDataset(t,e){if(!this.built)throw new ie("The model needs to be compiled before being used.");return this.model.evaluateDataset(t,e)}predict(t,e={}){return this.model==null&&this.build(),this.model.predict(t,e)}predictOnBatch(t){return this.model==null&&this.build(),this.model.predictOnBatch(t)}compile(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(t){this.model.optimizer=t}async fit(t,e,s={}){if(!this.built)throw new ie("The model needs to be compiled before being used.");return this.model.fit(t,e,s)}async fitDataset(t,e){if(!this.built)throw new ie("The model needs to be compiled before being used.");return this.model.fitDataset(t,e)}async trainOnBatch(t,e){return this.model.trainOnBatch(t,e)}static fromConfig(t,e,s={},i=!1){let o,a={};if(e instanceof Array){if(e[0].className==null||e[0].className==="Merge")throw new S("Legacy serialization format not supported yet.");o=e}else Y(e.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),o=e.layers,delete e.layers,a=e;const r=new t(a);if(!(r instanceof us))throw new it(`Sequential.fromConfig called on non-Sequential input: ${r}`);for(const l of o){const u=Be(l,void 0,i);i&&u.setFastWeightInitDuringBuild(!0),r.add(u)}return r}set stopTraining(t){if(this.model==null)throw new S("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t}get stopTraining(){if(this.model==null)throw new S("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const t=[];for(const e of this.layers){const s={};s.className=e.getClassName(),s.config=e.getConfig(),t.push(s)}return{name:this.name,layers:t}}}us.className="Sequential";B(us);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Ut=class extends fs{getConfig(){return{}}};class uu extends Ut{apply(t,e=1){return Dw(t,e)}}uu.className="elu";B(uu);class hu extends Ut{apply(t){return sc(t)}}hu.className="selu";B(hu);class du extends Ut{apply(t){return Gn(t)}}du.className="relu";B(du);class pu extends Ut{apply(t){return D(()=>Ho(6,Gn(t)))}}pu.className="relu6";B(pu);class fu extends Ut{apply(t){return t}}fu.className="linear";B(fu);class mu extends Ut{apply(t){return Hn(t)}}mu.className="sigmoid";B(mu);class gu extends Ut{apply(t){return Fw(t)}}gu.className="hardSigmoid";B(gu);class bu extends Ut{apply(t){return hi(t)}}bu.className="softplus";B(bu);class yu extends Ut{apply(t){return Aw(t)}}yu.className="softsign";B(yu);class wu extends Ut{apply(t){return jo(t)}}wu.className="tanh";B(wu);let xa=class extends Ut{apply(t,e=-1){return Uo(t,e)}};xa.className="softmax";B(xa);class Iu extends Ut{apply(t,e=-1){return Zl(t,e)}}Iu.className="logSoftmax";B(Iu);class ku extends Ut{apply(t,e=1){return D(()=>A(Hn(A(t,e)),t))}}ku.className="swish";B(ku);class xu extends Ut{apply(t){return D(()=>A(t,jo(hi(t))))}}xu.className="mish";B(xu);function en(n){return n.getClassName()}function Oi(n,t={}){return bs(n,ms.getMap().classNameMap,t,"activation")}function nn(n){if(n==null){const t={};return t.className="linear",t.config={},Oi(t)}if(typeof n=="string"){const t={};return t.className=n,t.config={},Oi(t)}else return n instanceof Ut?n:Oi(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function BI(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}class Su extends fs{}class Nu extends Su{constructor(t){super(),BI(t),this.l1=t==null||t.l1==null?.01:t.l1,this.l2=t==null||t.l2==null?.01:t.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(t){return D(()=>{let e=Yt([1]);return this.hasL1&&(e=J(e,lt(A(this.l1,fn(t))))),this.hasL2&&(e=J(e,lt(A(this.l2,ws(t))))),V(e,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(t,e){return new t({l1:e.l1,l2:e.l2})}}Nu.className="L1L2";B(Nu);const rr={l1l2:"L1L2"};function gt(n){return la(n)}function lr(n,t={}){return bs(n,ms.getMap().classNameMap,t,"regularizer")}function Ct(n){if(n==null)return null;if(typeof n=="string"){const e={className:n in rr?rr[n]:n,config:{}};return lr(e)}else return n instanceof Su?n:lr(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class vu extends rt{constructor(t){super(t??{}),this.supportsMasking=!0,t!=null&&(this.maxValue=t.maxValue)}call(t,e){t=st(t);let s=Gn(t);return this.maxValue!=null&&(s=Xt(s,0,this.maxValue)),s}computeOutputShape(t){return t}getConfig(){const t={maxValue:this.maxValue},e=super.getConfig();return Object.assign(t,e),t}}vu.className="ReLU";B(vu);class Cu extends rt{constructor(t){super(t??{}),this.DEFAULT_ALPHA=.3,t==null&&(t={}),this.alpha=t.alpha==null?this.DEFAULT_ALPHA:t.alpha}call(t,e){const s=st(t);return Jl(s,this.alpha)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},e=super.getConfig();return Object.assign(t,e),t}}Cu.className="LeakyReLU";B(Cu);class Tu extends rt{constructor(t){if(super(t??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",t==null&&(t={}),this.supportsMasking=!0,this.alphaInitializer=vt(t.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=Ct(t.alphaRegularizer),this.alphaConstraint=$t(t.alphaConstraint),t.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(t.sharedAxes))this.sharedAxes=t.sharedAxes;else if(typeof t.sharedAxes=="number")this.sharedAxes=[t.sharedAxes];else throw new S(`Expected sharedAxes to be a number or an array of numbers, but got ${t.sharedAxes}`)}build(t){t=ht(t);const e=t.slice(1);if(this.sharedAxes!=null)for(const i of this.sharedAxes)e[i-1]=1;this.alpha=this.addWeight("alpha",e,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let i=1;i<t.length;++i)s[i]=t[i];this.inputSpec=[new zt({ndim:t.length,axes:s})],this.built=!0}call(t,e){return t=st(t),nc(t,this.alpha.read())}getConfig(){const t={alphaInitializer:Dt(this.alphaInitializer),alphaRegularizer:gt(this.alphaRegularizer),alphaConstraint:Et(this.alphaConstraint),sharedAxes:this.sharedAxes},e=super.getConfig();return Object.assign(t,e),t}}Tu.className="PReLU";B(Tu);class Du extends rt{constructor(t){if(super(t??{}),this.DEFAULT_ALPHA=1,t==null&&(t={}),t.alpha!=null&&t.alpha!==this.DEFAULT_ALPHA)throw new it(`Non-default alpha value (${t.alpha}) is not supported by the ELU layer yet.`);this.alpha=t.alpha==null?this.DEFAULT_ALPHA:t.alpha}call(t,e){const s=st(t);return Wo(s)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},e=super.getConfig();return Object.assign(t,e),t}}Du.className="ELU";B(Du);class Au extends rt{constructor(t){super(t??{}),this.DEFAULT_THETA=1,t==null&&(t={}),this.theta=t.theta==null?this.DEFAULT_THETA:t.theta}call(t,e){const s=st(t);return A(s,X(ye(s,this.theta),"float32"))}computeOutputShape(t){return t}getConfig(){const t={theta:this.theta},e=super.getConfig();return Object.assign(t,e),t}}Au.className="ThresholdedReLU";B(Au);class Fu extends rt{constructor(t){super(t??{}),this.DEFAULT_AXIS=1,t==null&&(t={}),this.softmax=new xa().apply,this.axis=t.axis==null?this.DEFAULT_AXIS:t.axis}call(t,e){const s=st(t);return this.softmax(s,this.axis)}computeOutputShape(t){return t}getConfig(){const t={axis:this.axis},e=super.getConfig();return Object.assign(t,e),t}}Fu.className="Softmax";B(Fu);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Rn(n,t,e){if(typeof n=="number")return mn(n,t);if(n.length!==t)throw new S(`The ${e} argument must be an integer or tuple of ${t} integers. Received: ${n.length} elements.`);for(let s=0;s<t;++s){const i=n[s];if(!Nw(i))throw new S(`The ${e} argument must be an integer or tuple of ${t} integers. Received: ${JSON.stringify(n)} including a non-integer number ${i}`)}return n}function de(n,t,e,s,i=1){if(n==null)return n;const o=t+(t-1)*(i-1);let a;return e==="same"?a=n:a=n-o+1,Math.floor((a+s-1)/s)}function xe(n,t,e,s){if(n==null)return null;if(s==="valid")n=n*t+tn([e-t,0]);else if(s==="same")n=n*t;else throw new S(`Unsupport padding mode: ${s}.`);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Sa(n,t){return D(()=>(Rt(t),t==="channelsFirst"?dt(n,[0,2,3,1]):n))}function Ru(n,t){return D(()=>(Rt(t),t==="channelsFirst"?dt(n,[0,2,3,4,1]):n))}function VI(n,t,e,s=1,i="valid",o,a=1){return D(()=>{if(o==null&&(o=ge()),Rt(o),n.shape.length!==3)throw new S(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(t.shape.length!==3)throw new S(`The kernel for a conv1dWithBias operation should be 3, but is ${t.shape.length} instead`);if(e!=null&&e.shape.length!==1)throw new S(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if(o==="channelsFirst"&&(n=dt(n,[0,2,1])),i==="causal")throw new it("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let r=Kl(n,t,s,i==="same"?"same":"valid","NWC",a);return e!=null&&(r=we(r,e)),r})}function cr(n,t,e,s=[1,1],i="valid",o,a,r=null){return D(()=>{if(o==null&&(o=ge()),Rt(o),n.rank!==3&&n.rank!==4)throw new S(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(t.rank!==3&&t.rank!==4)throw new S(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let l=Sa(n,o);if(i==="causal")throw new it("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=lf({x:l,filter:t,strides:s,pad:i==="same"?"same":"valid",dilations:a,dataFormat:"NHWC",bias:e,activation:r}),o==="channelsFirst"&&(l=dt(l,[0,3,1,2])),l})}function WI(n,t,e,s=[1,1,1],i="valid",o,a){return D(()=>{if(o==null&&(o=ge()),Rt(o),n.rank!==4&&n.rank!==5)throw new S(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(t.rank!==4&&t.rank!==5)throw new S(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let r=Ru(n,o);if(i==="causal")throw new it("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return r=cf(r,t,s,i==="same"?"same":"valid","NDHWC",a),e!=null&&(r=we(r,e)),o==="channelsFirst"&&(r=dt(r,[0,4,1,2,3])),r})}class ki extends rt{constructor(t,e){if(super(e),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",ki.verifyArgs(e),this.rank=t,_t(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new it(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=Rn(e.kernelSize,t,"kernelSize"),this.strides=Rn(e.strides==null?1:e.strides,t,"strides"),this.padding=e.padding==null?"valid":e.padding,Qt(this.padding),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Rt(this.dataFormat),this.activation=nn(e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.biasInitializer=vt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=$t(e.biasConstraint),this.biasRegularizer=Ct(e.biasRegularizer),this.activityRegularizer=Ct(e.activityRegularizer),this.dilationRate=Rn(e.dilationRate==null?1:e.dilationRate,t,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new S(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new S(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new S(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(t){if(ke("kernelSize"in t,"required key 'kernelSize' not in config"),typeof t.kernelSize!="number"&&!ca(t.kernelSize,"number",1,3))throw new S(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(t.kernelSize)}.`)}getConfig(){const t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:en(this.activation),useBias:this.useBias,biasInitializer:Dt(this.biasInitializer),biasRegularizer:gt(this.biasRegularizer),activityRegularizer:gt(this.activityRegularizer),biasConstraint:Et(this.biasConstraint)},e=super.getConfig();return Object.assign(t,e),t}}class qn extends ki{constructor(t,e){super(t,e),this.kernel=null,qn.verifyArgs(e),this.filters=e.filters,_t(this.filters,"filters"),this.kernelInitializer=vt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=$t(e.kernelConstraint),this.kernelRegularizer=Ct(e.kernelRegularizer)}build(t){t=ht(t);const e=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[e]==null)throw new S(`The channel dimension of the input should be defined. Found ${t[e]}`);const s=t[e],i=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[e]:s}}],this.built=!0}call(t,e){return D(()=>{t=st(t);let s;const i=this.bias==null?null:this.bias.read(),o=Ac(this.activation.getClassName());if(o!=null&&this.rank===2)s=cr(t,this.kernel.read(),i,this.strides,this.padding,this.dataFormat,this.dilationRate,o);else{if(this.rank===1)s=VI(t,this.kernel.read(),i,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=cr(t,this.kernel.read(),i,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=WI(t,this.kernel.read(),i,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new it("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(t){t=ht(t);const e=[],s=this.dataFormat==="channelsLast"?t.slice(1,t.length-1):t.slice(2);for(let o=0;o<s.length;++o){const a=de(s[o],this.kernelSize[o],this.padding,this.strides[o],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[o]);e.push(a)}let i=[t[0]];return this.dataFormat==="channelsLast"?(i=i.concat(e),i.push(this.filters)):(i.push(this.filters),i=i.concat(e)),i}getConfig(){const t={filters:this.filters,kernelInitializer:Dt(this.kernelInitializer),kernelRegularizer:gt(this.kernelRegularizer),kernelConstraint:Et(this.kernelConstraint)},e=super.getConfig();return Object.assign(t,e),t}static verifyArgs(t){if(!("filters"in t)||typeof t.filters!="number"||t.filters<1)throw new S(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(t.filters)}`)}}class Ss extends qn{constructor(t){super(2,t),Ss.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!ca(t.kernelSize,"number",1,2))throw new S(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(t.kernelSize)}.`)}}Ss.className="Conv2D";B(Ss);class Ns extends qn{constructor(t){super(3,t),Ns.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!(Array.isArray(t.kernelSize)&&(t.kernelSize.length===1||t.kernelSize.length===3)))throw new S(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(t.kernelSize)}.`)}}Ns.className="Conv3D";B(Ns);class Mu extends Ss{constructor(t){if(super(t),this.inputSpec=[new zt({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new S(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(t=ht(t),t.length!==4)throw new S("Input should have rank 4; Received input shape: "+JSON.stringify(t));const e=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[e]==null)throw new S("The channel dimension of the inputs should be defined. Found `None`.");const s=t[e],i=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new zt({ndim:4,axes:{[e]:s}})],this.built=!0}call(t,e){return D(()=>{let s=st(t);if(s.shape.length!==4)throw new S(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const i=s.shape,o=i[0];let a,r;this.dataFormat==="channelsFirst"?(a=2,r=3):(a=1,r=2);const l=i[a],c=i[r],u=this.kernelSize[0],d=this.kernelSize[1],h=this.strides[0],p=this.strides[1],m=xe(l,h,u,this.padding),f=xe(c,p,d,this.padding),g=[o,m,f,this.filters];this.dataFormat!=="channelsLast"&&(s=dt(s,[0,2,3,1]));let w=Yl(s,this.kernel.read(),g,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(w=dt(w,[0,3,1,2])),this.bias!=null&&(w=we(w,this.bias.read(),this.dataFormat)),this.activation!=null&&(w=this.activation.apply(w)),w})}computeOutputShape(t){t=ht(t);const e=t.slice();let s,i,o;this.dataFormat==="channelsFirst"?(s=1,i=2,o=3):(s=3,i=1,o=2);const a=this.kernelSize[0],r=this.kernelSize[1],l=this.strides[0],c=this.strides[1];return e[s]=this.filters,e[i]=xe(e[i],l,a,this.padding),e[o]=xe(e[o],c,r,this.padding),e}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}Mu.className="Conv2DTranspose";B(Mu);class zu extends Ns{constructor(t){if(super(t),this.inputSpec=[new zt({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new S(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(t=ht(t),t.length!==5)throw new S("Input should have rank 5; Received input shape: "+JSON.stringify(t));const e=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[e]==null)throw new S("The channel dimension of the inputs should be defined. Found `None`.");const s=t[e],i=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new zt({ndim:5,axes:{[e]:s}})],this.built=!0}call(t,e){return D(()=>{let s=st(t);if(s.shape.length!==5)throw new S(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const i=s.shape,o=i[0];let a,r,l;this.dataFormat==="channelsFirst"?(l=2,a=3,r=4):(l=1,a=2,r=3);const c=i[l],u=i[a],d=i[r],h=this.kernelSize[0],p=this.kernelSize[1],m=this.kernelSize[2],f=this.strides[0],g=this.strides[1],w=this.strides[2],b=xe(c,f,h,this.padding),I=xe(u,g,p,this.padding),y=xe(d,w,m,this.padding),k=[o,b,I,y,this.filters];this.dataFormat!=="channelsLast"&&(s=dt(s,[0,2,3,4,1]));let x=rf(s,this.kernel.read(),k,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(x=dt(x,[0,4,1,2,3])),this.bias!==null&&(x=we(x,this.bias.read(),this.dataFormat)),this.activation!==null&&(x=this.activation.apply(x)),x})}computeOutputShape(t){t=ht(t);const e=t.slice();let s,i,o,a;this.dataFormat==="channelsFirst"?(s=1,i=2,o=3,a=4):(s=4,i=1,o=2,a=3);const r=this.kernelSize[0],l=this.kernelSize[1],c=this.kernelSize[2],u=this.strides[0],d=this.strides[1],h=this.strides[2];return e[s]=this.filters,e[i]=xe(e[i],u,r,this.padding),e[o]=xe(e[o],d,l,this.padding),e[a]=xe(e[a],h,c,this.padding),e}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}zu.className="Conv3DTranspose";B(zu);class Eu extends qn{constructor(t,e){if(super(t,e),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,e.filters==null)throw new S("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(e.kernelInitializer!=null||e.kernelRegularizer!=null||e.kernelConstraint!=null)throw new S("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(e.padding!=null&&e.padding!=="same"&&e.padding!=="valid")throw new S(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(e.padding)}`);this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=vt(e.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=Ct(e.depthwiseRegularizer),this.depthwiseConstraint=$t(e.depthwiseConstraint),this.pointwiseInitializer=vt(e.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=Ct(e.pointwiseRegularizer),this.pointwiseConstraint=$t(e.pointwiseConstraint)}build(t){if(t=ht(t),t.length<this.rank+2)throw new S(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(t)}`);const e=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[e]==null||t[e]<0)throw new S(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(t[e])}`);const s=t[e],i=this.kernelSize.concat([s,this.depthMultiplier]),o=[];for(let r=0;r<this.rank;++r)o.push(1);o.push(s*this.depthMultiplier,this.filters);const a=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",i,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,a,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",o,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,a,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,a,this.biasConstraint):this.bias=null,this.inputSpec=[new zt({ndim:this.rank+2,axes:{[e]:s}})],this.built=!0}call(t,e){return D(()=>{t=st(t);let s;if(this.rank===1)throw new it("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(t=dt(t,[0,2,3,1])),s=ic(t,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=we(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=dt(s,[0,3,1,2])),s})}getConfig(){const t=super.getConfig();return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=Dt(this.depthwiseInitializer),t.pointwiseInitializer=Dt(this.pointwiseInitializer),t.depthwiseRegularizer=gt(this.depthwiseRegularizer),t.pointwiseRegularizer=gt(this.pointwiseRegularizer),t.depthwiseConstraint=Et(this.depthwiseConstraint),t.pointwiseConstraint=Et(this.pointwiseConstraint),t}}Eu.className="SeparableConv";class $u extends Eu{constructor(t){super(2,t)}}$u.className="SeparableConv2D";B($u);class xi extends qn{constructor(t){super(1,t),xi.verifyArgs(t),this.inputSpec=[{ndim:3}]}getConfig(){const t=super.getConfig();return delete t.rank,delete t.dataFormat,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!ca(t.kernelSize,"number",1,1))throw new S(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(t.kernelSize)}.`)}}xi.className="Conv1D";B(xi);class Ou extends rt{constructor(t){super(t),typeof t.cropping=="number"?this.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:typeof t.cropping[0]=="number"?this.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:this.cropping=t.cropping,this.dataFormat=t.dataFormat===void 0?"channelsLast":t.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(t){return this.dataFormat==="channelsFirst"?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]}call(t,e){return D(()=>{if(t=st(t),this.dataFormat==="channelsLast"){const s=As(t,this.cropping[0][0],t.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return As(s,this.cropping[1][0],t.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=As(t,this.cropping[0][0],t.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return As(s,this.cropping[1][0],t.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const t={cropping:this.cropping,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}Ou.className="Cropping2D";B(Ou);class Lu extends rt{constructor(t){super(t),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=t.size==null?this.DEFAULT_SIZE:t.size,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Rt(this.dataFormat),this.interpolation=t.interpolation==null?"nearest":t.interpolation,kw(this.interpolation)}computeOutputShape(t){if(this.dataFormat==="channelsFirst"){const e=t[2]==null?null:this.size[0]*t[2],s=t[3]==null?null:this.size[1]*t[3];return[t[0],t[1],e,s]}else{const e=t[1]==null?null:this.size[0]*t[1],s=t[2]==null?null:this.size[1]*t[2];return[t[0],e,s,t[3]]}}call(t,e){return D(()=>{let s=st(t);const i=s.shape;if(this.dataFormat==="channelsFirst"){s=dt(s,[0,2,3,1]);const o=this.size[0]*i[2],a=this.size[1]*i[3],r=this.interpolation==="nearest"?se.resizeNearestNeighbor(s,[o,a]):se.resizeBilinear(s,[o,a]);return dt(r,[0,3,1,2])}else{const o=this.size[0]*i[1],a=this.size[1]*i[2];return this.interpolation==="nearest"?se.resizeNearestNeighbor(s,[o,a]):se.resizeBilinear(s,[o,a])}})}getConfig(){const t={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},e=super.getConfig();return Object.assign(t,e),t}}Lu.className="UpSampling2D";B(Lu);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function HI(n,t,e=[1,1],s="valid",i,o){return D(()=>{i==null&&(i=ge()),Rt(i);let a=Sa(n,i);if(n.rank!==4)throw new S(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(t.rank!==4)throw new S(`depthwiseKernel is required to be 4-D, but is instead ${t.rank}-D`);return a=Xl(a,t,e,s==="same"?"same":"valid","NHWC",o),i==="channelsFirst"&&(a=dt(a,[0,3,1,2])),a})}class _u extends ki{constructor(t){super(2,t),this.depthwiseKernel=null,this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=vt(t.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=$t(t.depthwiseConstraint),this.depthwiseRegularizer=Ct(t.depthwiseRegularizer)}build(t){if(t=ht(t),t.length<4)throw new S(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(t)}.`);const e=this.dataFormat==="channelsFirst"?1:3;if(t[e]==null||t[e]<0)throw new S(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${t[e]}).`);const s=t[e],i=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",i,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return D(()=>{t=st(t);let s=HI(t,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=we(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(t){t=ht(t);const e=this.dataFormat==="channelsFirst"?t[2]:t[1],s=this.dataFormat==="channelsFirst"?t[3]:t[2],i=this.dataFormat==="channelsFirst"?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,o=de(e,this.kernelSize[0],this.padding,this.strides[0]),a=de(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[t[0],i,o,a]:[t[0],o,a,i]}getConfig(){const t=super.getConfig();return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=Dt(this.depthwiseInitializer),t.depthwiseRegularizer=gt(this.depthwiseRegularizer),t.depthwiseConstraint=Et(this.depthwiseRegularizer),t}}_u.className="DepthwiseConv2D";B(_u);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Pu(n,t,e,s){if(Array.isArray(n)){if(t!=null||e!=null)throw new S("When inputs is an array, neither initialState or constants should be provided");s!=null&&(e=n.slice(n.length-s,n.length),n=n.slice(0,n.length-s)),n.length>1&&(t=n.slice(1,n.length)),n=n[0]}function i(o){return o==null||Array.isArray(o)?o:[o]}return t=i(t),e=i(e),{inputs:n,initialState:t,constants:e}}function Bu(n,t,e,s=!1,i,o,a=!1,r=!1){return D(()=>{const l=t.shape.length;if(l<3)throw new S(`Input should be at least 3D, but is ${l}D.`);const c=[1,0].concat(me(2,l));if(t=dt(t,c),o!=null)throw new it("The rnn() functoin of the deeplearn.js backend does not support constants yet.");a&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),i!=null&&(i=X(X(i,"bool"),"float32"),i.rank===l-1&&(i=oe(i,-1)),i=dt(i,c)),s&&(t=os(t,0),i!=null&&(i=os(i,0)));const u=[];let d,h=e;const p=t.shape[0],m=is(t);let f;i!=null&&(f=is(i));for(let w=0;w<p;++w){const b=m[w],I=D(()=>n(b,h));if(i==null)d=I[0],h=I[1];else{const y=D(()=>{const k=f[w],x=pt(ae(k),k),N=J(A(I[0],k),A(h[0],x)),v=h.map((C,T)=>J(A(I[1][T],k),A(C,x)));return{output:N,newStates:v}});d=y.output,h=y.newStates}r&&u.push(d)}let g;return r&&(g=ui(u,1)),[d,g,h]})}class rn extends rt{constructor(t){super(t);let e;if(t.cell==null)throw new S("cell property is missing for the constructor of RNN.");if(Array.isArray(t.cell)?e=new Ca({cells:t.cell}):e=t.cell,e.stateSize==null)throw new S("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=e,this.returnSequences=t.returnSequences==null?!1:t.returnSequences,this.returnState=t.returnState==null?!1:t.returnState,this.goBackwards=t.goBackwards==null?!1:t.goBackwards,this._stateful=t.stateful==null?!1:t.stateful,this.unroll=t.unroll==null?!1:t.unroll,this.supportsMasking=!0,this.inputSpec=[new zt({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return me(0,t).map(e=>null)}else return this.states_}setStates(t){this.states_=t}computeOutputShape(t){Ki(t)&&(t=t[0]),t=t;let e=this.cell.stateSize;Array.isArray(e)||(e=[e]);const s=e[0];let i;if(this.returnSequences?i=[t[0],t[1],s]:i=[t[0],s],this.returnState){const o=[];for(const a of e)o.push([t[0],a]);return[i].concat(o)}else return i}computeMask(t,e){return D(()=>{Array.isArray(e)&&(e=e[0]);const s=this.returnSequences?e:null;if(this.returnState){const i=this.states.map(o=>null);return[s].concat(i)}else return s})}get states(){if(this.states_==null){const t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,e=[];for(let s=0;s<t;++s)e.push(null);return e}else return this.states_}set states(t){this.states_=t}build(t){if(this.numConstants!=null)throw new it("Constants support is not implemented in RNN yet.");Ki(t)&&(t=t[0]),t=t;const e=this.stateful?t[0]:null,s=t.slice(2);this.inputSpec[0]=new zt({shape:[e,null,...s]});const i=[t[0]].concat(t.slice(2));this.cell.build(i);let o;if(Array.isArray(this.cell.stateSize)?o=this.cell.stateSize:o=[this.cell.stateSize],this.stateSpec!=null){if(!Jt(this.stateSpec.map(a=>a.shape[a.shape.length-1]),o))throw new S(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=o.map(a=>new zt({shape:[null,a]}));this.stateful&&this.resetStates()}resetStates(t,e=!1){D(()=>{if(!this.stateful)throw new Ie("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new S("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(i=>Yt([s,i])):this.states_=[Yt([s,this.cell.stateSize])];else if(t==null)St(this.states_),this.keptStates!=null&&(St(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(i=>Yt([s,i])):this.states_[0]=Yt([s,this.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new S(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);e===!0?this.keptStates.push(this.states_.slice()):St(this.states_);for(let i=0;i<this.states_.length;++i){const o=t[i],a=Array.isArray(this.cell.stateSize)?this.cell.stateSize[i]:this.cell.stateSize,r=[s,a];if(!Jt(o.shape,r))throw new S(`State ${i} is incompatible with layer ${this.name}: expected shape=${r}, received shape=${o.shape}`);this.states_[i]=o}}this.states_=this.states_.map(i=>Pe(i.clone()))})}apply(t,e){let s=e==null?null:e.initialState,i=e==null?null:e.constants;e==null&&(e={});const o=Pu(t,s,i,this.numConstants);t=o.inputs,s=o.initialState,i=o.constants;let a=[],r=[];if(s!=null){e.initialState=s,a=a.concat(s),this.stateSpec=[];for(const c of s)this.stateSpec.push(new zt({shape:c.shape}));r=r.concat(this.stateSpec)}if(i!=null&&(e.constants=i,a=a.concat(i),this.numConstants=i.length),a[0]instanceof ve){const c=[t].concat(a),u=this.inputSpec.concat(r),d=this.inputSpec;this.inputSpec=u;const h=super.apply(c,e);return this.inputSpec=d,h}else return super.apply(t,e)}call(t,e){return D(()=>{const s=e==null?null:e.mask,i=e==null?null:e.training;let o=e==null?null:e.initialState;t=st(t),o==null&&(this.stateful?o=this.states_:o=this.getInitialState(t));const a=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(o.length!==a)throw new S(`RNN Layer has ${a} state(s) but was passed ${o.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const r={training:i},c=Bu((m,f)=>{const g=this.cell.call([m].concat(f),r);return[g[0],g.slice(1)]},t,o,this.goBackwards,s,null,this.unroll,this.returnSequences),u=c[0],d=c[1],h=c[2];this.stateful&&this.resetStates(h,i);const p=this.returnSequences?d:u;return this.returnState?[p].concat(h):p})}getInitialState(t){return D(()=>{let e=Yt(t.shape);return e=lt(e,[1,2]),e=ys(e),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?ji(e,[1,s]):e):this.cell.stateSize>1?[ji(e,[1,this.cell.stateSize])]:[e]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(t)}getConfig(){const t=super.getConfig(),e={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(e.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===rn.className&&(e.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),t),e)}static fromConfig(t,e,s={}){const i=e.cell,o=Be(i,s);return new t(Object.assign(e,{cell:o}))}}rn.className="RNN";B(rn);class Si extends rt{}class Na extends Si{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,_t(this.units,"units"),this.activation=nn(t.activation==null?this.DEFAULT_ACTIVATION:t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=vt(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=vt(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=vt(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Ct(t.kernelRegularizer),this.recurrentRegularizer=Ct(t.recurrentRegularizer),this.biasRegularizer=Ct(t.biasRegularizer),this.kernelConstraint=$t(t.kernelConstraint),this.recurrentConstraint=$t(t.recurrentConstraint),this.biasConstraint=$t(t.biasConstraint),this.dropout=$n([1,tn([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=$n([1,tn([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=ht(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return D(()=>{if(t=t,t.length!==2)throw new S(`SimpleRNNCell expects 2 input Tensors, got ${t.length}.`);let s=t[1];t=t[0];const i=e.training==null?!1:e.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=sn({ones:()=>ae(t),rate:this.dropout,training:i,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=sn({ones:()=>ae(s),rate:this.recurrentDropout,training:i,dropoutFunc:this.dropoutFunc}));let o;const a=this.dropoutMask,r=this.recurrentDropoutMask;a!=null?o=Fe(A(t,a),this.kernel.read()):o=Fe(t,this.kernel.read()),this.bias!=null&&(o=we(o,this.bias.read())),r!=null&&(s=A(s,r));let l=J(o,Fe(s,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const t=super.getConfig(),e={units:this.units,activation:en(this.activation),useBias:this.useBias,kernelInitializer:Dt(this.kernelInitializer),recurrentInitializer:Dt(this.recurrentInitializer),biasInitializer:Dt(this.biasInitializer),kernelRegularizer:gt(this.kernelRegularizer),recurrentRegularizer:gt(this.recurrentRegularizer),biasRegularizer:gt(this.biasRegularizer),activityRegularizer:gt(this.activityRegularizer),kernelConstraint:Et(this.kernelConstraint),recurrentConstraint:Et(this.recurrentConstraint),biasConstraint:Et(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},t),e)}}Na.className="SimpleRNNCell";B(Na);class Vu extends rn{constructor(t){t.cell=new Na(t),super(t)}call(t,e){return D(()=>{this.cell.dropoutMask!=null&&(St(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(St(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=e==null?null:e.mask,i=e==null?null:e.training,o=e==null?null:e.initialState;return super.call(t,{mask:s,training:i,initialState:o})})}static fromConfig(t,e){return new t(e)}}Vu.className="SimpleRNN";B(Vu);class va extends Si{constructor(t){if(super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.resetAfter)throw new S("GRUCell does not support reset_after parameter set to true.");this.units=t.units,_t(this.units,"units"),this.activation=nn(t.activation===void 0?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=nn(t.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=vt(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=vt(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=vt(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Ct(t.kernelRegularizer),this.recurrentRegularizer=Ct(t.recurrentRegularizer),this.biasRegularizer=Ct(t.biasRegularizer),this.kernelConstraint=$t(t.kernelConstraint),this.recurrentConstraint=$t(t.recurrentConstraint),this.biasConstraint=$t(t.biasConstraint),this.dropout=$n([1,tn([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=$n([1,tn([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=ht(t);const e=t[t.length-1];this.kernel=this.addWeight("kernel",[e,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return D(()=>{if(t=t,t.length!==2)throw new S(`GRUCell expects 2 input Tensors (inputs, h, c), got ${t.length}.`);const s=e.training==null?!1:e.training;let i=t[1];t=t[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=sn({ones:()=>ae(t),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=sn({ones:()=>ae(i),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,a=this.recurrentDropoutMask;let r,l,c;0<this.dropout&&this.dropout<1&&(t=A(t,o[0]));let u=Fe(t,this.kernel.read());this.useBias&&(u=we(u,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(i=A(i,a[0]));const d=this.recurrentKernel.read(),[h,p]=_e(d,[2*this.units,this.units],d.rank-1),m=Fe(i,h),[f,g,w]=_e(u,3,u.rank-1),[b,I]=_e(m,2,m.rank-1);r=this.recurrentActivation.apply(J(f,b)),l=this.recurrentActivation.apply(J(g,I));const y=Fe(A(l,i),p);c=this.activation.apply(J(w,y));const k=J(A(r,i),A(J(1,Ht(r)),c));return[k,k]})}getConfig(){const t=super.getConfig(),e={units:this.units,activation:en(this.activation),recurrentActivation:en(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Dt(this.kernelInitializer),recurrentInitializer:Dt(this.recurrentInitializer),biasInitializer:Dt(this.biasInitializer),kernelRegularizer:gt(this.kernelRegularizer),recurrentRegularizer:gt(this.recurrentRegularizer),biasRegularizer:gt(this.biasRegularizer),activityRegularizer:gt(this.activityRegularizer),kernelConstraint:Et(this.kernelConstraint),recurrentConstraint:Et(this.recurrentConstraint),biasConstraint:Et(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},t),e)}}va.className="GRUCell";B(va);class Wu extends rn{constructor(t){t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new va(t),super(t)}call(t,e){return D(()=>{this.cell.dropoutMask!=null&&(St(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(St(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=e==null?null:e.mask,i=e==null?null:e.training,o=e==null?null:e.initialState;return super.call(t,{mask:s,training:i,initialState:o})})}static fromConfig(t,e){return e.implmentation===0&&(e.implementation=1),new t(e)}}Wu.className="GRU";B(Wu);class Ni extends Si{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,_t(this.units,"units"),this.activation=nn(t.activation===void 0?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=nn(t.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=vt(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=vt(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=vt(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=t.unitForgetBias,this.kernelRegularizer=Ct(t.kernelRegularizer),this.recurrentRegularizer=Ct(t.recurrentRegularizer),this.biasRegularizer=Ct(t.biasRegularizer),this.kernelConstraint=$t(t.kernelConstraint),this.recurrentConstraint=$t(t.recurrentConstraint),this.biasConstraint=$t(t.biasConstraint),this.dropout=$n([1,tn([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=$n([1,tn([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){var e;t=ht(t);const s=t[t.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let i;if(this.useBias){if(this.unitForgetBias){const o=this.biasInitializer,a=this.units;i=new(e=class extends re{apply(l,c){const u=o.apply([a]),d=new ha().apply([a]),h=o.apply([a*2]);return ja(ja(u,d),h)}},e.className="CustomInit",e)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,i,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(t,e){return D(()=>{const s=e.training==null?!1:e.training;if(t=t,t.length!==3)throw new S(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);let i=t[1];const o=t[2];t=t[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=sn({ones:()=>ae(t),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=sn({ones:()=>ae(i),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const a=this.dropoutMask,r=this.recurrentDropoutMask;let l,c,u,d;0<this.dropout&&this.dropout<1&&(t=A(t,a[0]));let h=Fe(t,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(i=A(i,r[0])),h=J(h,Fe(i,this.recurrentKernel.read())),this.useBias&&(h=we(h,this.bias.read()));const[p,m,f,g]=_e(h,4,h.rank-1);l=this.recurrentActivation.apply(p),c=this.recurrentActivation.apply(m),u=J(A(c,o),A(l,this.activation.apply(f))),d=this.recurrentActivation.apply(g);const w=A(d,this.activation.apply(u));return[w,w,u]})}getConfig(){const t=super.getConfig(),e={units:this.units,activation:en(this.activation),recurrentActivation:en(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Dt(this.kernelInitializer),recurrentInitializer:Dt(this.recurrentInitializer),biasInitializer:Dt(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:gt(this.kernelRegularizer),recurrentRegularizer:gt(this.recurrentRegularizer),biasRegularizer:gt(this.biasRegularizer),activityRegularizer:gt(this.activityRegularizer),kernelConstraint:Et(this.kernelConstraint),recurrentConstraint:Et(this.recurrentConstraint),biasConstraint:Et(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},t),e)}}Ni.className="LSTMCell";B(Ni);class Hu extends rn{constructor(t){t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new Ni(t),super(t)}call(t,e){return D(()=>{this.cell.dropoutMask!=null&&(St(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(St(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=e==null?null:e.mask,i=e==null?null:e.training,o=e==null?null:e.initialState;return super.call(t,{mask:s,training:i,initialState:o})})}static fromConfig(t,e){return e.implmentation===0&&(e.implementation=1),new t(e)}}Hu.className="LSTM";B(Hu);class Ca extends Si{constructor(t){super(t),this.cells=t.cells}get stateSize(){const t=[];for(const e of this.cells.slice().reverse())Array.isArray(e.stateSize)?t.push(...e.stateSize):t.push(e.stateSize);return t}call(t,e){return D(()=>{t=t;let s=t.slice(1);const i=[];for(const r of this.cells.slice().reverse())Array.isArray(r.stateSize)?i.push(s.splice(0,r.stateSize.length)):i.push(s.splice(0,1));i.reverse();const o=[];let a;for(let r=0;r<this.cells.length;++r){const l=this.cells[r];s=i[r],r===0?a=[t[0]].concat(s):a=[a[0]].concat(s),a=l.call(a,e),o.push(a.slice(1))}s=[];for(const r of o.slice().reverse())s.push(...r);return[a[0]].concat(s)})}build(t){Ki(t)&&(t=t[0]),t=t;let e;this.cells.forEach((s,i)=>{dn(`RNNCell_${i}`,()=>{s.build(t),Array.isArray(s.stateSize)?e=s.stateSize[0]:e=s.stateSize,t=[t[0],e]})}),this.built=!0}getConfig(){const t=super.getConfig(),e=o=>({className:o.getClassName(),config:o.getConfig()}),i={cells:this.cells.map(e)};return Object.assign(Object.assign({},t),i)}static fromConfig(t,e,s={}){const i=[];for(const o of e.cells)i.push(Be(o,s));return new t({cells:i})}get trainableWeights(){if(!this.trainable)return[];const t=[];for(const e of this.cells)t.push(...e.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const e of this.cells)t.push(...e.nonTrainableWeights);if(!this.trainable){const e=[];for(const s of this.cells)e.push(...s.trainableWeights);return e.concat(t)}return t}getWeights(){const t=[];for(const e of this.cells)t.push(...e.weights);return Yi(t)}setWeights(t){const e=[];for(const s of this.cells){const i=s.weights.length,o=t.splice(i);for(let a=0;a<s.weights.length;++a)e.push([s.weights[a],o[a]])}ya(e)}}Ca.className="StackedRNNCells";B(Ca);function sn(n){const{ones:t,rate:e,training:s=!1,count:i=1,dropoutFunc:o}=n,a=()=>o!=null?o(t(),e):Oc(t(),e),r=()=>Is(a,t,s);return!i||i<=1?Pe(r().clone()):Array(i).fill(void 0).map(r).map(c=>Pe(c.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var GI=globalThis&&globalThis.__rest||function(n,t){var e={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&t.indexOf(s)<0&&(e[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(n);i<s.length;i++)t.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(n,s[i])&&(e[s[i]]=n[s[i]]);return e};class Gu extends rn{constructor(t){if(t.unroll)throw new it("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(t.cell))throw new it("It is not possible at the moment to stack convolutional cells.");super(t),this.inputSpec=[new zt({ndim:5})]}call(t,e){return D(()=>{if(this.cell.dropoutMask!=null&&(St(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(St(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),e&&e.constants)throw new S("ConvRNN2D cell does not support constants");const s=e==null?null:e.mask,i=e==null?null:e.training,o=e==null?null:e.initialState;return super.call(t,{mask:s,training:i,initialState:o})})}computeOutputShape(t){let e=this.computeSingleOutputShape(t);return this.returnSequences||(e=[e[0],...e.slice(2)]),this.returnState&&(e=[e,...Array(2).fill([t[0],...e.slice(-3)])]),e}getInitialState(t){return D(()=>{const{stateSize:e}=this.cell,s=t.shape,i=this.computeSingleOutputShape(s),o=[i[0],...i.slice(2)],a=Yt(o);return Array.isArray(e)?Array(e.length).fill(a):[a]})}resetStates(t,e=!1){D(()=>{if(!this.stateful)throw new Ie("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,i=this.computeSingleOutputShape(s),o=[i[0],...i.slice(2)];if(s[0]==null)throw new S("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Yt(o)):this.states_=[Yt(o)];else if(t==null)St(this.states_),this.keptStates!=null&&(St(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Yt(o)):this.states_[0]=Yt(o);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new S(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);e?this.keptStates.push(this.states_.slice()):St(this.states_);for(let r=0;r<this.states_.length;++r){const l=t[r],c=o;if(!Jt(l.shape,c))throw new S(`State ${r} is incompatible with layer ${this.name}: expected shape=${c}, received shape=${l.shape}`);this.states_[r]=l}}this.states_=this.states_.map(r=>Pe(r.clone()))})}computeSingleOutputShape(t){const{dataFormat:e,filters:s,kernelSize:i,padding:o,strides:a,dilationRate:r}=this.cell,l=e==="channelsFirst",c=t[l?3:2],u=t[l?4:3],d=de(c,i[0],o,a[0],r[0]),h=de(u,i[1],o,a[1],r[1]);return[...t.slice(0,2),...l?[s,d,h]:[d,h,s]]}}Gu.className="ConvRNN2D";class Ta extends Ni{constructor(t){const{filters:e,kernelSize:s,strides:i,padding:o,dataFormat:a,dilationRate:r}=t;super(Object.assign(Object.assign({},t),{units:e})),this.filters=e,_t(this.filters,"filters"),this.kernelSize=Rn(s,2,"kernelSize"),this.kernelSize.forEach(l=>_t(l,"kernelSize")),this.strides=Rn(i||1,2,"strides"),this.strides.forEach(l=>_t(l,"strides")),this.padding=o||"valid",Qt(this.padding),this.dataFormat=a||"channelsLast",Rt(this.dataFormat),this.dilationRate=Rn(r||1,2,"dilationRate"),this.dilationRate.forEach(l=>_t(l,"dilationRate"))}build(t){var e;t=ht(t);const s=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[s]==null)throw new S(`The channel dimension of the input should be defined. Found ${t[s]}`);const i=t[s],o=4,a=this.kernelSize.concat([i,this.filters*o]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const r=this.kernelSize.concat([this.filters,this.filters*o]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",r,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const c=this.biasInitializer,u=this.filters;l=new(e=class extends re{apply(h,p){const m=c.apply([u]),f=Wn([u]),g=c.apply([u*2]);return ua([m,f,g])}},e.className="CustomInit",e)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*o],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(t,e){return D(()=>{if(t.length!==3)throw new S(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);const s=e.training||!1,i=t[0],o=t[1],a=t[2],r=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=sn({ones:()=>ae(i),rate:this.dropout,training:s,count:r,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,c=(H,W,U)=>!W||!W[U]?H:A(W[U],H);let u=c(i,l,0),d=c(i,l,1),h=c(i,l,2),p=c(i,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=sn({ones:()=>ae(o),rate:this.recurrentDropout,training:s,count:r,dropoutFunc:this.dropoutFunc}));const m=this.recurrentDropoutMask;let f=c(o,m,0),g=c(o,m,1),w=c(o,m,2),b=c(o,m,3);const I=3,[y,k,x,N]=_e(this.kernel.read(),r,I),[v,C,T,R]=this.useBias?_e(this.bias.read(),r):[null,null,null,null];u=this.inputConv(u,y,v,this.padding),d=this.inputConv(d,k,C,this.padding),h=this.inputConv(h,x,T,this.padding),p=this.inputConv(p,N,R,this.padding);const[_,M,O,z]=_e(this.recurrentKernel.read(),r,I);f=this.recurrentConv(f,_),g=this.recurrentConv(g,M),w=this.recurrentConv(w,O),b=this.recurrentConv(b,z);const E=this.recurrentActivation.apply(J(u,f)),L=this.recurrentActivation.apply(J(d,g)),$=J(A(L,a),A(E,this.activation.apply(J(h,w)))),P=A(this.recurrentActivation.apply(J(p,b)),this.activation.apply($));return[P,P,$]})}getConfig(){const t=super.getConfig(),e=GI(t,["units"]),s={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},e),s)}inputConv(t,e,s,i){const o=Vs(t,e,this.strides,i||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?we(o,s,this.dataFormat):o}recurrentConv(t,e){return Vs(t,e,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}Ta.className="ConvLSTM2DCell";B(Ta);class Uu extends Gu{constructor(t){const e=new Ta(t);super(Object.assign(Object.assign({},t),{cell:e}))}static fromConfig(t,e){return new t(e)}}Uu.className="ConvLSTM2D";B(Uu);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Da extends rt{constructor(t){super(t),this.rate=Math.max(Math.min(t.rate,1),0),this.noiseShape=t.noiseShape,this.seed=t.seed,this.supportsMasking=!0}getNoiseShape(t){if(this.noiseShape==null)return this.noiseShape;const e=t.shape,s=[];for(let i=0;i<this.noiseShape.length;++i)s.push(this.noiseShape[i]==null?e[i]:this.noiseShape[i]);return s}call(t,e){return D(()=>{this.invokeCallHook(t,e);const s=st(t);if(0<this.rate&&this.rate<1){const i=e.training==null?!1:e.training,o=this.getNoiseShape(s);return Is(()=>Oc(s,this.rate,o,this.seed),()=>s,i)}return t})}getConfig(){const t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},e=super.getConfig();return Object.assign(t,e),t}dispose(){return super.dispose()}}Da.className="Dropout";B(Da);class ju extends Da{constructor(t){super(t),this.inputSpec=[{ndim:3}]}getNoiseShape(t){const e=t.shape;return[e[0],1,e[2]]}}ju.className="SpatialDropout1D";B(ju);class qu extends rt{constructor(t){if(super(t),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.batchInputShape==null&&t.inputShape==null&&t.inputDim!=null){let e=null;t.batchSize!=null&&(e=t.batchSize),this.batchInputShape=[e,t.inputDim]}this.units=t.units,_t(this.units,"units"),this.activation=nn(t.activation),t.useBias!=null&&(this.useBias=t.useBias),this.kernelInitializer=vt(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=vt(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=$t(t.kernelConstraint),this.biasConstraint=$t(t.biasConstraint),this.kernelRegularizer=Ct(t.kernelRegularizer),this.biasRegularizer=Ct(t.biasRegularizer),this.activityRegularizer=Ct(t.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(t){t=ht(t);const e=t[t.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[e,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:e}}],this.built=!0}computeOutputShape(t){t=ht(t);const e=t.slice();return e[e.length-1]=this.units,e}call(t,e){return D(()=>{this.invokeCallHook(t,e);const s=st(t),i=Ac(this.activation.getClassName());let o;return i!=null?o=Fe(s,this.kernel.read(),i,this.bias?this.bias.read():null):(o=Fe(s,this.kernel.read()),this.bias!=null&&(o=we(o,this.bias.read())),this.activation!=null&&(o=this.activation.apply(o))),o})}getConfig(){const t={units:this.units,activation:en(this.activation),useBias:this.useBias,kernelInitializer:Dt(this.kernelInitializer),biasInitializer:Dt(this.biasInitializer),kernelRegularizer:gt(this.kernelRegularizer),biasRegularizer:gt(this.biasRegularizer),activityRegularizer:gt(this.activityRegularizer),kernelConstraint:Et(this.kernelConstraint),biasConstraint:Et(this.biasConstraint)},e=super.getConfig();return Object.assign(t,e),t}}qu.className="Dense";B(qu);class Ku extends rt{constructor(t){t=t||{},super(t),this.inputSpec=[{minNDim:3}],this.dataFormat=t.dataFormat}computeOutputShape(t){t=ht(t);for(const e of t.slice(1))if(e==null)throw new S(`The shape of the input to "Flatten" is not fully defined (got ${t.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[t[0],Xe(t,1)]}call(t,e){return D(()=>{this.invokeCallHook(t,e);let s=st(t);if(this.dataFormat==="channelsFirst"&&s.rank>1){const i=[0];for(let o=2;o<s.rank;++o)i.push(o);i.push(1),s=dt(s,i)}return Tw(s)})}getConfig(){const t={};this.dataFormat!=null&&(t.dataFormat=this.dataFormat);const e=super.getConfig();return Object.assign(t,e),t}}Ku.className="Flatten";B(Ku);class Yu extends rt{constructor(t){super(t),this.supportsMasking=!0,this.activation=nn(t.activation)}call(t,e){return D(()=>{this.invokeCallHook(t,e);const s=st(t);return this.activation.apply(s)})}getConfig(){const t={activation:en(this.activation)},e=super.getConfig();return Object.assign(t,e),t}}Yu.className="Activation";B(Yu);class Xu extends rt{constructor(t){super(t),this.n=t.n,this.inputSpec=[{ndim:2}]}computeOutputShape(t){return[t[0],this.n,t[1]]}call(t,e){return D(()=>(t=st(t),vw(t,this.n)))}getConfig(){const t={n:this.n},e=super.getConfig();return Object.assign(t,e),t}}Xu.className="RepeatVector";B(Xu);class Ju extends rt{constructor(t){super(t),this.targetShape=t.targetShape;for(let e=0;e<this.targetShape.length;++e)this.isUnknown(this.targetShape[e])&&(this.targetShape[e]=null)}isUnknown(t){return t<0||t==null}fixUnknownDimension(t,e){const s="Total size of new array must be unchanged.",i=e.slice();let o=1,a=null;for(let l=0;l<i.length;++l){const c=i[l];if(this.isUnknown(c))if(a===null)a=l;else throw new S("Can only specifiy one unknown dimension.");else o*=c}const r=Xe(t);if(a!==null){if(o===0||r%o!==0)throw new S(s);i[a]=r/o}else if(r!==o)throw new S(s);return i}computeOutputShape(t){let e=!1;for(let s=0;s<t.length;++s)if(this.isUnknown(t[s])){e=!0;break}return e?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))}call(t,e){return D(()=>{this.invokeCallHook(t,e);const s=st(t),i=s.shape,o=i.slice(0,1).concat(this.fixUnknownDimension(i.slice(1),this.targetShape));return V(s,o)})}getConfig(){const t={targetShape:this.targetShape},e=super.getConfig();return Object.assign(t,e),t}}Ju.className="Reshape";B(Ju);class Zu extends rt{constructor(t){if(super(t),t.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${t.dims} instead.`);const e=me(1,t.dims.length+1);if(!Jt(t.dims.slice().sort(),e))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=t.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new zt({ndim:this.dims.length+1})]}computeOutputShape(t){t=ht(t);const e=t.slice();return this.dims.forEach((s,i)=>{e[i+1]=t[s]}),e}call(t,e){return dt(st(t),this.dimsIncludingBatch)}getConfig(){const t={dims:this.dims},e=super.getConfig();return Object.assign(t,e),t}}Zu.className="Permute";B(Zu);class Qu extends rt{constructor(t){super(t??{}),this.supportsMasking=!0,t!=null?this.maskValue=t.maskValue==null?0:t.maskValue:this.maskValue=0}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={maskValue:this.maskValue};return Object.assign(e,t),e}computeMask(t,e){const s=st(t),i=-1;return Hi(Ws(s,this.maskValue),i)}call(t,e){return D(()=>{this.invokeCallHook(t,e);const s=st(t),i=-1,o=!0,a=Hi(Ws(s,this.maskValue),i,o);return A(s,X(a,s.dtype))})}}Qu.className="Masking";B(Qu);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class th extends rt{constructor(t){if(super(t),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",t.batchInputShape==null&&t.inputShape==null){let e=null;t.batchSize!=null&&(e=t.batchSize),t.inputLength==null?this.batchInputShape=[e,null]:this.batchInputShape=[e].concat(kt(t.inputLength))}this.inputDim=t.inputDim,_t(this.inputDim,"inputDim"),this.outputDim=t.outputDim,_t(this.outputDim,"outputDim"),this.embeddingsInitializer=vt(t.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=Ct(t.embeddingsRegularizer),this.activityRegularizer=Ct(t.activityRegularizer),this.embeddingsConstraint=$t(t.embeddingsConstraint),this.maskZero=t.maskZero,this.supportsMasking=t.maskZero,this.inputLength=t.inputLength}build(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(t){}computeMask(t,e){return D(()=>this.maskZero?(t=st(t),Ws(t,Ft(t))):null)}computeOutputShape(t){if(t=ht(t),this.inputLength==null)return[...t,this.outputDim];const e=kt(this.inputLength);if(e.length!==t.length-1)throw new S(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);{let s=0;for(let i=0;i<e.length;++i){const o=e[i],a=t[i+1];if(o!=null&&a!=null&&o!==a)throw new S(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);o==null&&(e[s]=a),s++}}return[t[0],...e,this.outputDim]}call(t,e){return D(()=>{this.invokeCallHook(t,e);let s=st(t);s.dtype!=="int32"&&(s=Ae(s,"int32"));const i=$c(this.embeddings.read(),V(s,[s.size]));return V(i,ht(this.computeOutputShape(s.shape)))})}getConfig(){const t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Dt(this.embeddingsInitializer),embeddingsRegularizer:gt(this.embeddingsRegularizer),activityRegularizer:gt(this.activityRegularizer),embeddingsConstraint:Et(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},e=super.getConfig();return Object.assign(t,e),t}}th.className="Embedding";B(th);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class kn extends rt{constructor(t){super(t||{}),this.supportsMasking=!0}mergeFunction(t){throw new it}computeElementwiseOpOutputShape(t,e){if(t==null||e==null)return null;if(t.length<e.length)return this.computeElementwiseOpOutputShape(e,t);if(e.length===0)return t;const s=t.slice(0,t.length-e.length);for(let i=0;i<e.length;++i){const o=t[t.length-e.length+i],a=e[i];if(o==null||a==null||o<0||a<0)s.push(null);else if(o===1)s.push(a);else if(a===1)s.push(o);else{if(o!==a)throw new S("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(e));s.push(o)}}return s}build(t){if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[ht(t)]),t=t,t.length<2)throw new S(`A merge layer should be called on an Array of at least 2 inputs. Got ${t.length} input(s).`);let e=[];for(const o of t)o!=null&&o[0]!==null&&e.push(o[0]);if(e=Ye(e),e.length>1)throw new S(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(t)}.`);let s=t[0]==null?null:t[0].slice(1);for(let o=1;o<t.length;++o){const a=t[o]==null?null:t[o].slice(1);s=this.computeElementwiseOpOutputShape(s,a)}const i=t.map(o=>o.length);t.indexOf(null)===-1&&Ye(i).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(t,e){return D(()=>{if(t=t,this.reshapeRequired){const s=[],i=t.map(o=>o.rank);if(i.indexOf(null)===-1){const o=tn(i);for(let a of t){const r=a.rank;for(let l=0;l<o-r;++l)a=ys(a,1);s.push(a)}return this.mergeFunction(s)}else{let o=!1;for(const l of t){const c=l.rank;if(c==null){const u=l.shape,d=u[0],h=u.slice(1).concat([d]);let p=V(l,[d].concat(Xe(u.slice(1))));p=dt(p,[1,0]),p=V(p,h),s.push(p),o=!0}else if(c>1){const u=me(1,c).concat([0]);s.push(dt(l,u)),o=!0}else s.push(l)}let a=this.mergeFunction(s);const r=a.rank;if(o){if(r==null){const l=a.shape,c=l.length,u=l[c-1],d=[u].concat(l.slice(0,l.length-1));a=V(dt(V(a,[-1,u]),[1,0]),d)}else if(r>1){const l=[r-1].concat(me(0,r-1));a=dt(a,l)}}return a}}else return this.mergeFunction(t)})}computeOutputShape(t){t=t;let e;t[0]==null?e=null:e=t[0].slice(1);for(let i=1;i<t.length;++i){const o=t[i]==null?null:t[i].slice(1);e=this.computeElementwiseOpOutputShape(e,o)}let s=[];for(const i of t)i!=null&&i[0]!==null&&s.push(i[0]);return s=Ye(s),s.length===1?e=s.concat(e):e=[null].concat(e),e}computeMask(t,e){return D(()=>{if(e==null)return null;if(!Array.isArray(e))throw new S("`mask` should be an Array");if(!Array.isArray(t))throw new S("`inputs` should be an Array");if(e.length!==t.length)throw new S(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${t.length} vs ${e.length})`);if(e.every(i=>i==null))return null;e=e.map(i=>i==null?i:oe(i,0));let s=e[0];for(let i=1;i<e.length-1;++i)s=Pn(s,e[i]);return s})}}class eh extends kn{constructor(t){super(t)}mergeFunction(t){return D(()=>{let e=t[0].clone();for(let s=1;s<t.length;++s)e=J(e,t[s]);return e})}}eh.className="Add";B(eh);class nh extends kn{constructor(t){super(t)}mergeFunction(t){return D(()=>{let e=t[0].clone();for(let s=1;s<t.length;++s)e=A(e,t[s]);return e})}}nh.className="Multiply";B(nh);class sh extends kn{constructor(t){super(t)}mergeFunction(t){return D(()=>{let e=t[0].clone();for(let s=1;s<t.length;++s)e=J(e,t[s]);return A(1/t.length,e)})}}sh.className="Average";B(sh);class ih extends kn{constructor(t){super(t)}mergeFunction(t){return D(()=>{let e=t[0];for(let s=1;s<t.length;++s)e=gn(e,t[s]);return e})}}ih.className="Maximum";B(ih);class oh extends kn{constructor(t){super(t)}mergeFunction(t){return D(()=>{let e=t[0];for(let s=1;s<t.length;++s)e=Ho(e,t[s]);return e})}}oh.className="Minimum";B(oh);class ah extends kn{constructor(t){super(t),this.DEFAULT_AXIS=-1,t==null&&(t={}),this.axis=t.axis==null?this.DEFAULT_AXIS:t.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){if(!(Array.isArray(t)&&Array.isArray(t[0]))||t.length===1)throw new S("A `Concatenate` layer should be called on a list of at least 2 inputs");t=t;let e=!0;for(const i of t)if(i!=null){e=!1;break}if(e)return;const s=[];for(let i=0;i<t.length;++i){const o=t[i].slice();o.splice(this.axis,1);let a=!1;for(const r of s)if(Jt(r,o)){a=!0;break}a||s.push(o)}if(s.length>1)throw new S("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}mergeFunction(t){return D(()=>ua(t,this.axis))}computeOutputShape(t){if(!(Array.isArray(t)&&Array.isArray(t[0])))throw new S("A `Concatenate` layer should be called on a list of inputs.");const e=t,s=e[0].slice(),i=this.axis<0?s.length+this.axis:this.axis;for(const o of e.slice(1)){if(s[i]==null||o[i]==null){s[i]=null;break}s[i]+=o[i]}return s}computeMask(t,e){if(e==null)return null;if(!Array.isArray(e))throw new S("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new S("`inputs` should be an array for Concatenate");if(e.length!==t.length)throw new S(`Mismatch in the length of mask (${e.length}) and the legnth of inputs (${t.length})`);return D(()=>{let s=!0;if(e.forEach(a=>{if(a!=null){s=!1;return}}),s)return null;const i=[];for(let a=0;a<t.length;++a)e[a]==null?i.push(X(ae(t[a]),"bool")):e[a].rank<t[a].rank?i.push(oe(e[a],-1)):i.push(e[a]);const o=ps(i,this.axis);return jl(o,-1,!1)})}getConfig(){const t={axis:this.axis},e=super.getConfig();return Object.assign(t,e),t}}ah.className="Concatenate";B(ah);function Xn(n,t){for(;n<0;)n+=t;return n}function UI(n,t,e){if(n.shape.length>3||t.shape.length>3)throw new it("batchDot is not implemented for tensors of 4D or higher rank yet");if(Y(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),Y(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${t.shape.length}`),typeof e=="number"&&(e=[e,e]),n.dtype==="complex64"||t.dtype==="complex64")throw new it("batchDot is not implemented for complex64-type Tensors yet.");const s=n.shape.length,i=t.shape.length;e==null&&(e=[s-1,i-2]);const o=e;return D(()=>{let a;if(s>i){a=s-i;const l=[];for(let c=0;c<a;++c)l.push(1);t=V(t,t.shape.concat(l))}else if(i>s){a=i-s;const l=[];for(let c=0;c<a;++c)l.push(1);n=V(n,n.shape.concat(l))}else a=0;let r;if(n.shape.length===2&&t.shape.length===2)o[0]===o[1]?r=lt(A(n,t),o[0]):r=lt(A(dt(n,[1,0]),t),o[1]);else{const l=o[0]!==n.shape.length-1,c=o[1]===t.shape.length-1;r=ne(n,t,l,c)}if(a>0){let l;s>i?l=s+i-3:l=s-1;const c=[];for(let u=l;u<l+a;++u)c.push(u);r=Ne(r,c)}return r.shape.length===1&&(r=oe(r,1)),r})}class rh extends kn{constructor(t){super(t),this.axes=t.axes,this.normalize=t.normalize==null?!1:t.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){Y(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const e=t[0],s=t[1];if(e.length>3||s.length>3)throw new it("Dot layer does not support tensors of 4D or higher rank yet.");const i=this.interpretAxes(e,s);if(e[i[0]]!==s[i[1]])throw new S(`Dimension incompatibility: ${e[i[0]]} !== ${s[i[1]]}`)}mergeFunction(t){if(t.length!==2)throw new S(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${t.length} input(s).`);let e=t[0],s=t[1],i;return Array.isArray(this.axes)?i=this.axes.map((o,a)=>Xn(o,t[a].shape.length)):i=[Xn(this.axes,e.shape.length),Xn(this.axes,s.shape.length)],this.normalize&&(e=Js(e,i[0]),s=Js(s,i[1])),UI(e,s,i)}interpretAxes(t,e){let s;return Array.isArray(this.axes)?s=this.axes:s=[Xn(this.axes,t.length),Xn(this.axes,e.length)],s}computeOutputShape(t){Y(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const e=t[0].slice(),s=t[1].slice();if(e.length>3||s.length>3)throw new it("Dot layer does not support tensors of 4D or higher rank yet.");const i=this.interpretAxes(e,s);e.splice(i[0],1),s.splice(i[1],1),s.splice(0,1);const o=e.concat(s);return o.length===1&&o.push(1),o}computeMask(t,e){return null}getConfig(){const t={axes:this.axes,normalize:this.normalize},e=super.getConfig();return Object.assign(t,e),t}}rh.className="Dot";B(rh);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class lh extends rt{constructor(t){super(t),this.supportsMasking=!0,this.stddev=t.stddev}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={stddev:this.stddev};return Object.assign(e,t),e}call(t,e){return D(()=>{this.invokeCallHook(t,e);const s=st(t);return Is(()=>J(bi(s.shape,0,this.stddev),s),()=>s,e.training||!1)})}}lh.className="GaussianNoise";B(lh);class ch extends rt{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={rate:this.rate};return Object.assign(e,t),e}call(t,e){return D(()=>{this.invokeCallHook(t,e);const s=st(t);return this.rate>0&&this.rate<1?Is(()=>{const o=Math.sqrt(this.rate/(1-this.rate));return A(s,bi(s.shape,1,o))},()=>s,e.training||!1):s})}}ch.className="GaussianDropout";B(ch);class uh extends rt{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate,this.noiseShape=t.noiseShape}_getNoiseShape(t){return this.noiseShape||st(t).shape}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={rate:this.rate};return Object.assign(e,t),e}call(t,e){return D(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(t);return Is(()=>{const o=st(t),a=1.6732632423543772,r=1.0507009873554805,l=-a*r;let c=Bn(di(s),this.rate);c=Ae(c,"float32");const u=((1-this.rate)*(1+this.rate*l**2))**-.5,d=-u*l*this.rate,h=J(A(o,c),A(J(c,-1),l));return J(A(h,u),d)},()=>st(t),e.training||!1)}return t})}}uh.className="AlphaDropout";B(uh);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function hs(n,t,e,s,i,o=.001){let a;if(n.rank===2)a=uf(n,t,e,s,i,o);else if(n.rank===3)a=hf(n,t,e,s,i,o);else if(n.rank===4)a=df(n,t,e,s,i,o);else throw new it(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return a}function jI(n,t,e,s,i=.001){return D(()=>{const o=Xo(n,s),a=o.mean,r=o.variance;return[hs(n,a,r,e,t,i),a,r]})}function qI(n,t,e,s,i=.001){return D(()=>{const o=Xo(n,s),a=o.mean,r=o.variance,l=[];for(const m of me(0,n.rank))s.indexOf(m)!==-1?l.push(1):l.push(n.shape[m]);const c=V(a,l),u=V(r,l),d=t==null?null:V(t,l),h=e==null?null:V(e,l);return[hs(n,c,u,h,d,i),a,r]})}function KI(n,t,e,s,i=.001){return Jt(s.slice().sort(),me(0,n.rank-1))?jI(n,t,e,s,i):qI(n,t,e,s,i)}class hh extends rt{constructor(t){t==null&&(t={}),super(t),this.supportsMasking=!0,this.axis=t.axis==null?-1:t.axis,this.momentum=t.momentum==null?.99:t.momentum,this.epsilon=t.epsilon==null?.001:t.epsilon,this.center=t.center==null?!0:t.center,this.scale=t.scale==null?!0:t.scale,this.betaInitializer=vt(t.betaInitializer||"zeros"),this.gammaInitializer=vt(t.gammaInitializer||"ones"),this.movingMeanInitializer=vt(t.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=vt(t.movingVarianceInitializer||"ones"),this.betaConstraint=$t(t.betaConstraint),this.gammaConstraint=$t(t.gammaConstraint),this.betaRegularizer=Ct(t.betaRegularizer),this.gammaRegularizer=Ct(t.gammaRegularizer)}build(t){t=ht(t);const e=this.axis>=0?this.axis:this.axis+t.length,s=t[e];if(s==null)throw new S(`Axis ${e} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(t)}.`);this.inputSpec=[new zt({ndim:t.length,axes:{[e]:s}})];const i=[s];this.scale&&(this.gamma=this.addWeight("gamma",i,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",i,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",i,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",i,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(t,e){return D(()=>{const s=e.training==null?!1:e.training,i=st(t),o=i.shape,a=o.length,r=me(0,a),l=this.axis>=0?this.axis:this.axis+a;r.splice(l,1);const c=mn(1,a);c[l]=o[l];const u=r.slice();u.sort();const d=!Jt(u,me(0,a).slice(0,a-1)),h=()=>{if(d){const b=V(this.movingMean.read(),c),I=V(this.movingVariance.read(),c),y=this.center?V(this.beta.read(),c):null,k=this.scale?V(this.gamma.read(),c):null;return hs(i,b,I,y,k,this.epsilon)}else return hs(i,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return h();const[p,m,f]=KI(i,this.gamma.read(),this.beta.read(),r,this.epsilon),g=(b,I,y)=>{D(()=>{const k=1-y,x=b.read(),N=A(pt(x,I),k);b.write(pt(x,N))})};return(()=>{g(this.movingMean,m,this.momentum),g(this.movingVariance,f,this.momentum)})(),p})}getConfig(){const t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Dt(this.betaInitializer),gammaInitializer:Dt(this.gammaInitializer),movingMeanInitializer:Dt(this.movingMeanInitializer),movingVarianceInitializer:Dt(this.movingVarianceInitializer),betaRegularizer:gt(this.betaRegularizer),gammaRegularizer:gt(this.gammaRegularizer),betaConstraint:Et(this.betaConstraint),gammaConstraint:Et(this.gammaConstraint)},e=super.getConfig();return Object.assign(t,e),t}}hh.className="BatchNormalization";B(hh);class dh extends rt{constructor(t){if(t==null&&(t={}),super(t),this.axis=t.axis==null?-1:t.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const e of this.axis)if(!Number.isInteger(e))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=t.epsilon==null?.001:t.epsilon,this.center=t.center==null?!0:t.center,this.scale=t.scale==null?!0:t.scale,this.betaInitializer=vt(t.betaInitializer||"zeros"),this.gammaInitializer=vt(t.gammaInitializer||"ones"),this.betaRegularizer=Ct(t.betaRegularizer),this.gammaRegularizer=Ct(t.gammaRegularizer),this.supportsMasking=!0}build(t){t=ht(t);const e=t.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let o=0;o<this.axis.length;++o)this.axis[o]<0&&(this.axis[o]+=e);for(const o of this.axis)if(o<0||o>=e)throw new Error(`Invalid axis: ${o}`);if(this.axis.length!==Ye(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(o=>t[o]),i=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,i):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,i):this.beta=null,this.built=!0}call(t,e){const s=st(t),i=s.shape,o=i.length;return D(()=>{let{mean:r,variance:l}=Xo(s,this.axis,!0);const c=mn(1,o);for(const f of this.axis)c[f]=i[f];const u=f=>f!=null&&f.shape.length!==o?V(f,c):f;let d=this.scale?u(this.gamma.read()):null,h=this.center?u(this.beta.read()):null;const p=[],m=[];for(let f=0;f<o;++f)this.axis.indexOf(f)!==-1?(p.push(i[f]),m.push(1)):(p.push(1),m.push(i[f]));return r=hn(r,p),l=hn(l,p),d!=null&&(d=hn(d,m)),h!=null&&(h=hn(h,m)),hs(s,r,l,h,d,this.epsilon)})}getConfig(){const t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Dt(this.betaInitializer),gammaInitializer:Dt(this.gammaInitializer),betaRegularizer:gt(this.betaRegularizer),gammaRegularizer:gt(this.gammaRegularizer)},e=super.getConfig();return Object.assign(t,e),t}}dh.className="LayerNormalization";B(dh);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function YI(n,t,e){return D(()=>{if(n.rank!==4)throw new S(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(t==null&&(t=[[1,1],[1,1]]),t.length!==2||t[0].length!==2||t[1].length!==2)throw new S("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(e==null&&(e=ge()),e!=="channelsLast"&&e!=="channelsFirst")throw new S(`Unknown data format: ${e}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return e==="channelsFirst"?s=[[0,0],[0,0],t[0],t[1]]:s=[[0,0],t[0],t[1],[0,0]],Oo(n,s)})}class ph extends rt{constructor(t){if(t==null&&(t={}),super(t),this.dataFormat=t.dataFormat==null?ge():t.dataFormat,t.padding==null)this.padding=[[1,1],[1,1]];else if(typeof t.padding=="number")this.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,t.padding.length!==2)throw new S(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${t.padding.length} array.`);let e,s;if(typeof t.padding[0]=="number")e=[t.padding[0],t.padding[0]],s=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,t.padding[0].length!==2)throw new S(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${t.padding[0].length} array.`);if(e=t.padding[0],t.padding[1].length!==2)throw new S(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${t.padding[1].length} array.`);s=t.padding[1]}this.padding=[e,s]}this.inputSpec=[new zt({ndim:4})]}computeOutputShape(t){t=ht(t);let e,s;return this.dataFormat==="channelsFirst"?(t[2]!=null&&t[2]>=0?e=t[2]+this.padding[0][0]+this.padding[0][1]:e=null,t[3]!=null&&t[3]>=0?s=t[3]+this.padding[1][0]+this.padding[1][1]:s=null,[t[0],t[1],e,s]):(t[1]!=null&&t[1]>=0?e=t[1]+this.padding[0][0]+this.padding[0][1]:e=null,t[2]!=null&&t[2]>=0?s=t[2]+this.padding[1][0]+this.padding[1][1]:s=null,[t[0],e,s,t[3]])}call(t,e){return D(()=>YI(st(t),this.padding,this.dataFormat))}getConfig(){const t={padding:this.padding,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}ph.className="ZeroPadding2D";B(ph);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function vi(n,t,e,s,i,o){return D(()=>{Rt(i),Rc(o),Qt(s),e==null&&(e=[1,1]),s==null&&(s="valid"),i==null&&(i=ge()),o==null&&(o="max"),n=Sa(n,i);let a;const r=s==="same"?"same":"valid";return o==="max"?a=tc(n,t,e,r):a=ql(n,t,e,r),i==="channelsFirst"&&(a=dt(a,[0,3,1,2])),a})}function fh(n,t,e,s,i,o){return D(()=>{Rt(i),Rc(o),Qt(s),e==null&&(e=[1,1,1]),s==null&&(s="valid"),i==null&&(i=ge()),o==null&&(o="max"),n=Ru(n,i);let a;const r=s==="same"?"same":"valid";return o==="max"?a=pf(n,t,e,r):a=ff(n,t,e,r),i==="channelsFirst"&&(a=dt(a,[0,4,1,2,3])),a})}class mh extends rt{constructor(t){if(t.poolSize==null&&(t.poolSize=2),super(t),typeof t.poolSize=="number")this.poolSize=[t.poolSize];else if(Array.isArray(t.poolSize)&&t.poolSize.length===1&&typeof t.poolSize[0]=="number")this.poolSize=t.poolSize;else throw new S(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.poolSize)}`);if(_t(this.poolSize,"poolSize"),t.strides==null)this.strides=this.poolSize;else if(typeof t.strides=="number")this.strides=[t.strides];else if(Array.isArray(t.strides)&&t.strides.length===1&&typeof t.strides[0]=="number")this.strides=t.strides;else throw new S(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.strides)}`);_t(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,Qt(this.padding),this.inputSpec=[new zt({ndim:3})]}computeOutputShape(t){t=ht(t);const e=de(t[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],e,t[2]]}call(t,e){return D(()=>{this.invokeCallHook(t,e),t=ys(st(t),2);const s=this.poolingFunction(st(t),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return Ne(s,[2])})}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},e=super.getConfig();return Object.assign(t,e),t}}class gh extends mh{constructor(t){super(t)}poolingFunction(t,e,s,i,o){return Rt(o),Qt(i),vi(t,e,s,i,o,"max")}}gh.className="MaxPooling1D";B(gh);class bh extends mh{constructor(t){super(t)}poolingFunction(t,e,s,i,o){return Rt(o),Qt(i),vi(t,e,s,i,o,"avg")}}bh.className="AveragePooling1D";B(bh);class yh extends rt{constructor(t){if(t.poolSize==null&&(t.poolSize=[2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],t.strides==null)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==2)throw new S(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides];_t(this.poolSize,"poolSize"),_t(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Rt(this.dataFormat),Qt(this.padding),this.inputSpec=[new zt({ndim:4})]}computeOutputShape(t){t=ht(t);let e=this.dataFormat==="channelsFirst"?t[2]:t[1],s=this.dataFormat==="channelsFirst"?t[3]:t[2];return e=de(e,this.poolSize[0],this.padding,this.strides[0]),s=de(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[t[0],t[1],e,s]:[t[0],e,s,t[3]]}call(t,e){return D(()=>(this.invokeCallHook(t,e),this.poolingFunction(st(t),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class wh extends yh{constructor(t){super(t)}poolingFunction(t,e,s,i,o){return Rt(o),Qt(i),vi(t,e,s,i,o,"max")}}wh.className="MaxPooling2D";B(wh);class Ih extends yh{constructor(t){super(t)}poolingFunction(t,e,s,i,o){return Rt(o),Qt(i),vi(t,e,s,i,o,"avg")}}Ih.className="AveragePooling2D";B(Ih);class kh extends rt{constructor(t){if(t.poolSize==null&&(t.poolSize=[2,2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],t.strides==null)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==3)throw new S(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides,t.strides];_t(this.poolSize,"poolSize"),_t(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Rt(this.dataFormat),Qt(this.padding),this.inputSpec=[new zt({ndim:5})]}computeOutputShape(t){t=ht(t);let e=this.dataFormat==="channelsFirst"?t[2]:t[1],s=this.dataFormat==="channelsFirst"?t[3]:t[2],i=this.dataFormat==="channelsFirst"?t[4]:t[3];return e=de(e,this.poolSize[0],this.padding,this.strides[0]),s=de(s,this.poolSize[1],this.padding,this.strides[1]),i=de(i,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[t[0],t[1],e,s,i]:[t[0],e,s,i,t[4]]}call(t,e){return D(()=>(this.invokeCallHook(t,e),this.poolingFunction(st(t),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class xh extends kh{constructor(t){super(t)}poolingFunction(t,e,s,i,o){return Rt(o),Qt(i),fh(t,e,s,i,o,"max")}}xh.className="MaxPooling3D";B(xh);class Sh extends kh{constructor(t){super(t)}poolingFunction(t,e,s,i,o){return Rt(o),Qt(i),fh(t,e,s,i,o,"avg")}}Sh.className="AveragePooling3D";B(Sh);class Nh extends rt{constructor(t){super(t),this.inputSpec=[new zt({ndim:3})]}computeOutputShape(t){return[t[0],t[2]]}call(t,e){throw new it}}class vh extends Nh{constructor(t){super(t||{})}call(t,e){return D(()=>{const s=st(t);return Lt(s,1)})}}vh.className="GlobalAveragePooling1D";B(vh);class Ch extends Nh{constructor(t){super(t||{})}call(t,e){return D(()=>{const s=st(t);return zn(s,1)})}}Ch.className="GlobalMaxPooling1D";B(Ch);class Th extends rt{constructor(t){super(t),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Rt(this.dataFormat),this.inputSpec=[new zt({ndim:4})]}computeOutputShape(t){return t=t,this.dataFormat==="channelsLast"?[t[0],t[3]]:[t[0],t[1]]}call(t,e){throw new it}getConfig(){const t={dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class Dh extends Th{call(t,e){return D(()=>{const s=st(t);return this.dataFormat==="channelsLast"?Lt(s,[1,2]):Lt(s,[2,3])})}}Dh.className="GlobalAveragePooling2D";B(Dh);class Ah extends Th{call(t,e){return D(()=>{const s=st(t);return this.dataFormat==="channelsLast"?zn(s,[1,2]):zn(s,[2,3])})}}Ah.className="GlobalMaxPooling2D";B(Ah);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Fh extends rt{constructor(t){super(t),this.layer=t.layer}build(t){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(t){this.layer!=null&&(this.layer.trainable=t)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(t){this.layer.setWeights(t)}getConfig(){const t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},e=super.getConfig();return Object.assign(t,e),t}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(t)}static fromConfig(t,e,s={}){const i=e.layer,o=Be(i,s);delete e.layer;const a={layer:o};return Object.assign(a,e),new t(a)}}class Rh extends Fh{constructor(t){super(t),this.supportsMasking=!0}build(t){if(t=ht(t),t.length<3)throw new S(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(t)}`);this.inputSpec=[{shape:t}];const e=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(e),this.layer.built=!0),super.build(t)}computeOutputShape(t){t=ht(t);const e=[t[0]].concat(t.slice(2)),s=this.layer.computeOutputShape(e),i=t[1];return[s[0],i].concat(s.slice(1))}call(t,e){return D(()=>(t=st(t),Bu((a,r)=>[st(this.layer.call(a,e)),[]],t,[],!1,null,null,!1,!0)[1]))}}Rh.className="TimeDistributed";B(Rh);function XI(n){In(Iw,"BidirectionalMergeMode",n)}const JI="concat";class Mh extends Fh{constructor(t){super(t);const e=t.layer.getConfig(),s={};s.className=t.layer.getClassName(),s.config=e,this.forwardLayer=Be(s),e.goBackwards=e.goBackwards!==!0;const i={};if(i.className=t.layer.getClassName(),i.config=e,this.backwardLayer=Be(i),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=t.mergeMode===void 0?JI:t.mergeMode,XI(this.mergeMode),t.weights)throw new it("weights support is not implemented for Bidirectional layer yet.");this._stateful=t.layer.stateful,this.returnSequences=t.layer.returnSequences,this.returnState=t.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=t.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(t){this._trainable=t,this.forwardLayer!=null&&(this.forwardLayer.trainable=t),this.backwardLayer!=null&&(this.backwardLayer.trainable=t)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(t){const e=t.length,s=Math.floor(e/2);this.forwardLayer.setWeights(t.slice(0,s)),this.backwardLayer.setWeights(t.slice(s))}computeOutputShape(t){let e=this.forwardLayer.computeOutputShape(t);Array.isArray(e)&&Array.isArray(e[0])||(e=[e]),e=e;let s,i,o;return this.returnState&&(o=e.slice(1)),s=e[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,i=[s]):this.mergeMode==null?i=[s,s.slice()]:i=[s],this.returnState?this.mergeMode==null?i.concat(o).concat(o.slice()):[s].concat(o).concat(o.slice()):Gt(i)}apply(t,e){let s=e==null?null:e.initialState,i=e==null?null:e.constants;e==null&&(e={});const o=Pu(t,s,i,this.numConstants);if(t=o.inputs,s=o.initialState,i=o.constants,Array.isArray(t)&&(s=t.slice(1),t=t[0]),(s==null||s.length===0)&&i==null)return super.apply(t,e);const a=[],r=[];if(s!=null){const c=s.length;if(c%2>0)throw new S("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");e.initialState=s,a.push(...s);const u=s.map(d=>new zt({shape:d.shape}));this.forwardLayer.stateSpec=u.slice(0,c/2),this.backwardLayer.stateSpec=u.slice(c/2),r.push(...u)}if(i!=null)throw new it("Support for constants in Bidirectional layers is not implemented yet.");const l=a[0]instanceof ve;for(const c of a)if(c instanceof ve!==l)throw new S("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const c=[t].concat(a),u=this.inputSpec.concat(r),d=this.inputSpec;this.inputSpec=u;const h=super.apply(c,e);return this.inputSpec=d,h}else return super.apply(t,e)}call(t,e){return D(()=>{const s=e.initialState;let i,o;if(s==null)i=this.forwardLayer.call(t,e),o=this.backwardLayer.call(t,e);else{const l=s.slice(0,s.length/2),c=s.slice(s.length/2);i=this.forwardLayer.call(t,Object.assign(e,{initialState:l})),o=this.backwardLayer.call(t,Object.assign(e,{initialState:c}))}let a;this.returnState&&(Array.isArray(i)&&(a=i.slice(1).concat(o.slice(1))),i=i[0],o=o[0]),this.returnSequences&&(o=os(o,1));let r;return this.mergeMode==="concat"?r=ua([i,o]):this.mergeMode==="sum"?r=J(i,o):this.mergeMode==="ave"?r=A(.5,J(i,o)):this.mergeMode==="mul"?r=A(i,o):this.mergeMode==null&&(r=[i,o]),this.returnState?this.mergeMode==null?r.concat(a):[r].concat(a):r})}resetStates(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(t){dn(this.forwardLayer.name,()=>{this.forwardLayer.build(t)}),dn(this.backwardLayer.name,()=>{this.backwardLayer.build(t)}),this.built=!0}computeMask(t,e){Array.isArray(e)&&(e=e[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[e,e]:s=e:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const o=this.forwardLayer.states.map(a=>null);return Array.isArray(s)?s.concat(o).concat(o):[s].concat(o).concat(o)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(t),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(t)}getConfig(){const t={mergeMode:this.mergeMode},e=super.getConfig();return Object.assign(t,e),t}static fromConfig(t,e){const s=Be(e.layer);if(delete e.layer,e.numConstants!=null)throw new it("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const i=e;return i.layer=s,new t(i)}}Mh.className="Bidirectional";B(Mh);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class zh extends rt{constructor(t){super(t),this.scale=t.scale,t.offset?this.offset=t.offset:this.offset=0}getConfig(){const t={scale:this.scale,offset:this.offset},e=super.getConfig();return Object.assign(t,e),t}call(t,e){return D(()=>(t=st(t),t.dtype!=="float32"&&(t=Ae(t,"float32")),J(A(t,this.scale),this.offset)))}}zh.className="Rescaling";B(zh);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:ZI,cropAndResize:QI}=se;class Eh extends rt{constructor(t){super(t),this.height=t.height,this.width=t.width}centerCrop(t,e,s,i,o,a,r,l){return D(()=>{let c,u=!1;const d=e/a,h=s/r,p=(i+e)/a,m=(o+s)/r,f=[d,h,p,m],g=[];t.rank===3?(u=!0,c=ui([t])):c=t;for(let k=0;k<c.shape[0];k++)g.push(f);const w=lc(g,[g.length,4]),b=Jo(0,g.length,1,"int32"),y=QI(c,w,b,[i,o],"nearest");return Ae(u?st(is(y)):y,l)})}upsize(t,e,s,i){return D(()=>{const o=ZI(t,[e,s]);return Ae(o,i)})}call(t,e){return D(()=>{const s=st(t),i=s.dtype,o=s.shape,a=o[o.length-3],r=o[o.length-2];let l=0;a!==this.height&&(l=Math.floor((a-this.height)/2));let c=0;return r!==this.width&&(c=Math.floor((r-this.width)/2),c===0&&(c=1)),l>=0&&c>=0?this.centerCrop(s,l,c,this.height,this.width,a,r,i):this.upsize(t,this.height,this.width,i)})}getConfig(){const t={height:this.height,width:this.width},e=super.getConfig();return Object.assign(t,e),t}computeOutputShape(t){t=ht(t);const e=t.length-3,s=t.length-2;return t[e]=this.height,t[s]=this.width,t}}Eh.className="CenterCrop";B(Eh);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function t0(n,t,e,s){let i=st(n);if(i.dtype!=="int32"&&(i=Ae(i,"int32")),t==="int")return i;const o=i.shape;if(i.rank===0&&(i=oe(i,-1)),t==="oneHot"&&i.shape[i.shape.length-1]!==1&&(i=oe(i,-1)),i.rank>2)throw new S(`When outputMode is not int, maximum output rank is 2 Received outputMode ${t} and input shape ${o} which would result in output rank ${i.rank}.`);const a=["multiHot","oneHot"].includes(t),r=i;let l;if(typeof s<"u"&&t==="count"?l=La(r,s,e,a):l=La(r,[],e,a),t!=="tfIdf")return l;if(s)return A(l,s);throw new S("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class $h extends rt{constructor(t){super(t),this.numTokens=t.numTokens,t.outputMode?this.outputMode=t.outputMode:this.outputMode="multiHot"}getConfig(){const t={numTokens:this.numTokens,outputMode:this.outputMode},e=super.getConfig();return Object.assign(t,e),t}computeOutputShape(t){return t=ht(t),t==null?[this.numTokens]:this.outputMode==="oneHot"&&t[t.length-1]!==1?(t.push(this.numTokens),t):(t[t.length-1]=this.numTokens,t)}call(t,e){return D(()=>{t=st(t),t.dtype!=="int32"&&(t=Ae(t,"int32"));let s;if(typeof e.countWeights<"u"){if(this.outputMode!=="count")throw new S(`countWeights is not used when outputMode !== count.
              Received countWeights=${e.countWeights}`);s=st(e.countWeights)}const i=zn(t),o=ec(t),a=ye(this.numTokens,i).bufferSync().get(0),r=Bn(o,0).bufferSync().get(0);if(!(a&&r))throw new S(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return t0(t,this.outputMode,this.numTokens,s)})}}$h.className="CategoryEncoding";B($h);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const e0=["bilinear","nearest"],ur=new Set(e0);class Oh extends rt{constructor(t){if(super(t),this.height=t.height,this.width=t.width,t.interpolation)if(ur.has(t.interpolation))this.interpolation=t.interpolation;else throw new S(`Invalid interpolation parameter: ${t.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!t.cropToAspectRatio}computeOutputShape(t){t=ht(t);const e=t[2];return[this.height,this.width,e]}getConfig(){const t={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},e=super.getConfig();return Object.assign(t,e),t}call(t,e){return D(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return se.resizeBilinear(t,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return se.resizeNearestNeighbor(t,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...ur]} are supported`)})}}Oh.className="Resizing";B(Oh);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Lh{constructor(t){this.seed=t}next(){if(this.seed!==void 0)return this.seed++}}Lh.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class _h extends rt{constructor(t){super(t),this.randomGenerator=new Lh(t.seed)}getConfig(){const t={seed:this.randomGenerator.seed},e=super.getConfig();return Object.assign(t,e),t}}_h.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const n0=["bilinear","nearest"],hr=new Set(n0);class Ph extends _h{constructor(t){super(t);const{factor:e,interpolation:s="bilinear"}=t;if(this.factor=e,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new S(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new S(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new S(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if(hr.has(s))this.interpolation=s;else throw new S(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const t={factor:this.factor,interpolation:this.interpolation},e=super.getConfig();return Object.assign(t,e),t}computeOutputShape(t){t=ht(t);const e=t[2];return[this.imgHeight,-1,e]}call(t,e){return D(()=>{const s=st(t);this.imgHeight=s.shape[s.shape.length-3];const i=s.shape[s.shape.length-2];this.widthFactor=di([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let o=this.widthFactor.dataSync()[0]*i;o=Math.round(o);const a=[this.imgHeight,o];switch(this.interpolation){case"bilinear":return se.resizeBilinear(t,a);case"nearest":return se.resizeNearestNeighbor(t,a);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...hr]} are supported`)}})}}Ph.className="RandomWidth";B(Ph);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s0=Yo();s0.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var dr;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(dr||(dr={}));var pr;(function(n){(function(t){t[t.LEGACY=0]="LEGACY",t[t.V1=1]="V1",t[t.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(pr||(pr={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var fr;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(fr||(fr={}));/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i0=kf;class Ci extends mf{nextDataId(){return Ci.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new gf(this,js())}write(t,e,s){this.firstUse&&(this.firstUse=!1,Yo().get("IS_NODE")&&bf(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const i={id:this.nextDataId()};return this.data.set(i,{values:t,dtype:s,refCount:1}),i}makeTensorInfo(t,e,s){let i;if(e==="string"&&s!=null&&s.length>0&&yf(s[0])){const o=s.map(a=>wf(a));i=this.write(o,t,e)}else i=this.write(s,t,e);return{dataId:i,shape:t,dtype:e}}refCount(t){return this.data.has(t)?this.data.get(t).refCount:0}incRef(t){const e=this.data.get(t);e.refCount++}decRef(t){if(this.data.has(t)){const e=this.data.get(t);e.refCount--}}move(t,e,s,i,o){this.data.set(t,{values:e,dtype:i,refCount:o})}numDataIds(){return this.data.numDataIds()}async read(t){return this.readSync(t)}readSync(t){const{dtype:e,complexTensorInfos:s}=this.data.get(t);if(e==="complex64"){const i=this.readSync(s.real.dataId),o=this.readSync(s.imag.dataId);return pi(i,o)}return If(this.data.get(t).values,e)}bufferSync(t){const e=this.readSync(t.dataId);if(t.dtype==="string")try{const s=e.map(i=>cc(i));return Bt(t.shape,t.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Bt(t.shape,t.dtype,e)}makeOutput(t,e,s){return js().makeTensorFromTensorInfo(this.makeTensorInfo(e,s,t),this)}disposeData(t,e=!1){if(this.data.has(t)){if(this.data.get(t).refCount--,!e&&this.data.get(t).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(t);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(t)}return!0}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}async time(t){const e=Hs();return t(),{kernelMs:Hs()-e}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(t){Q([t],"where");const e=this.readSync(t.dataId);return i0(t.shape,e)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}Ci.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xf("cpu",()=>new Ci,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bh=bt(go,n=>n>=0?n:Math.exp(n)-1),o0={kernelName:go,backendName:"cpu",kernelFunc:Bh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vh(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{alpha:o}=s;Q([i],"leakyRelu");const a=nt(i.shape),r=e.data.get(i.dataId).values,l=Qe("float32",a);for(let c=0;c<r.length;c++)l[c]=r[c]<0?o*r[c]:r[c];return e.makeTensorInfo(i.shape,"float32",l)}const a0={kernelName:ll,backendName:"cpu",kernelFunc:Vh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r0=bn((n,t)=>n<0?t*n:n);function Wh(n){const{inputs:t,backend:e}=n,{x:s,alpha:i}=t;Q([s,i],"prelu");const o=e.data.get(s.dataId).values,a=e.data.get(i.dataId).values,[r,l]=r0(s.shape,i.shape,o,a,"float32");return e.makeTensorInfo(l,"float32",r)}const l0={kernelName:Nl,backendName:"cpu",kernelFunc:Wh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hh=bt(Ao,n=>Math.max(0,n)),c0={kernelName:Ao,backendName:"cpu",kernelFunc:Hh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gh=bt(Do,n=>Math.min(Math.max(0,n),6)),u0={kernelName:Do,backendName:"cpu",kernelFunc:Gh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ni(n,t,e,s,i){if(e==="linear")return yn({inputs:{x:t},backend:n});if(e==="relu")return Hh({inputs:{x:t},backend:n});if(e==="elu")return Bh({inputs:{x:t},backend:n});if(e==="relu6")return Gh({inputs:{x:t},backend:n});if(e==="prelu")return Wh({inputs:{x:t,alpha:s},backend:n});if(e==="leakyrelu")return Vh({inputs:{x:t},backend:n,attrs:{alpha:i}});if(e==="sigmoid")return Sf({inputs:{x:t},backend:n});throw new Error(`Activation ${e} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function It(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{shape:o}=s,a=nt(i.shape),r=Nf(o,a),l=nt(r);Y(a===l,()=>`The new shape (${r}) has ${l} elements and the old shape (${i.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`),e.incRef(i.dataId);const c=e.data.get(i.dataId);if(c.complexTensorInfos!=null){const u=c.complexTensorInfos.real,d=c.complexTensorInfos.imag;u.shape=r,d.shape=r}return{dataId:i.dataId,shape:r,dtype:i.dtype}}const h0={kernelName:vl,backendName:"cpu",kernelFunc:It};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uh(n){const{inputs:t,backend:e,attrs:s}=n,{a:i,b:o}=t,{transposeA:a,transposeB:r}=s;Q([i,o],"matMul");const l=i.shape.length,c=o.shape.length,u=a?i.shape[l-2]:i.shape[l-1],d=r?o.shape[c-1]:o.shape[c-2],h=a?i.shape[l-1]:i.shape[l-2],p=r?o.shape[c-2]:o.shape[c-1],m=i.shape.slice(0,-2),f=o.shape.slice(0,-2),g=nt(m),w=nt(f),I=Me(i.shape.slice(0,-2),o.shape.slice(0,-2)).concat([h,p]);Y(u===d,()=>`Error in matMul: inner shapes (${u}) and (${d}) of Tensors with shapes ${i.shape} and ${o.shape} and transposeA=${a} and transposeB=${r} must match.`);const y=a?[g,u,h]:[g,h,u],k=r?[w,p,d]:[w,d,p],x=It({inputs:{x:i},backend:e,attrs:{shape:y}}),N=It({inputs:{x:o},backend:e,attrs:{shape:k}}),v=a?x.shape[1]:x.shape[2],C=a?x.shape[2]:x.shape[1],T=r?N.shape[1]:N.shape[2],R=Math.max(g,w),_=e.data.get(x.dataId).values,M=e.data.get(N.dataId).values,O=ct(x.shape),z=ct(N.shape),[E,L,$]=a?[O[0],1,O[1]]:[O[0],O[1],1],[P,H,W]=r?[1,z[1],z[0]]:[z[1],1,z[0]],U=C*T,G=Bt([R,C,T],x.dtype),q=G.values,j=e.blockSize;for(let K=0;K<R;K++){const Z=K%g,et=K%w;for(let tt=0;tt<C;tt+=j){const ot=Math.min(tt+j,C);for(let at=0;at<T;at+=j){const ft=Math.min(at+j,T);for(let yt=0;yt<v;yt+=j){const At=Math.min(yt+j,v);for(let wt=tt;wt<ot;wt++)for(let mt=at;mt<ft;mt++){let Tt=0;for(let xt=yt;xt<At;xt++){const ze=_[Z*E+wt*L+xt*$],Pt=M[xt*P+mt*H+et*W];Tt+=ze*Pt}q[K*U+(wt*T+mt)]+=Tt}}}}}return e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(N),e.makeTensorInfo(I,G.dtype,G.values)}const d0={kernelName:Br,backendName:"cpu",kernelFunc:Uh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p0(n){const{inputs:t,backend:e,attrs:s}=n,{a:i,b:o,bias:a,preluActivationWeights:r}=t,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:d}=s;let h,p,m;const f=[];h=Uh({inputs:{a:i,b:o},attrs:{transposeA:l,transposeB:c},backend:e}),a&&(p=as({inputs:{a:h,b:a},backend:e}),f.push(h),h=p),u&&(m=ni(e,h,u,r,d),f.push(h),h=m);for(const w of f)e.disposeIntermediateTensorInfo(w);return h}const f0={kernelName:vf,backendName:"cpu",kernelFunc:p0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m0=bt(io,n=>Math.acos(n)),g0={kernelName:io,backendName:"cpu",kernelFunc:m0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b0=bt(oo,n=>Math.acosh(n)),y0={kernelName:oo,backendName:"cpu",kernelFunc:b0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w0(n){const{inputs:t,backend:e}=n,s=t;Q(t,"addN");const i=s.map(r=>e.data.get(r.dataId).values),o=Bt(s[0].shape,s[0].dtype),a=o.values;for(let r=0;r<s.length;r++){const l=i[r];for(let c=0;c<a.length;c++)a[c]+=l[c]}return e.makeTensorInfo(o.shape,o.dtype,o.values)}const I0={kernelName:zr,backendName:"cpu",kernelFunc:w0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k0(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{axis:o,keepDims:a}=s;Q(i,"all");const r=Ot(o,i.shape);let l=r;const c=be(l,i.shape.length);let u=i;c!=null&&(u=Zt({inputs:{x:i},backend:e,attrs:{perm:c}}),l=He(l.length,i.shape.length)),wn("all",l,u.shape.length);const[d,h]=We(u.shape,l),p=nt(h),m=an(nt(d),u.dtype),f=e.data.get(u.dataId).values;for(let w=0;w<m.length;++w){const b=w*p;let I=f[b];for(let y=0;y<p;++y){const k=f[b+y];I=I&&k}m[w]=I}c!=null&&e.disposeIntermediateTensorInfo(u);const g=e.makeTensorInfo(d,u.dtype,m);if(a){const w=Je(d,r),b=It({inputs:{x:g},backend:e,attrs:{shape:w}});return e.disposeIntermediateTensorInfo(g),b}return g}const x0={kernelName:Cf,backendName:"cpu",kernelFunc:k0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S0(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{axis:o,keepDims:a}=s;Q(i,"any");const r=Ot(o,i.shape);let l=r;const c=be(l,i.shape.length);let u=i;c!=null&&(u=Zt({inputs:{x:i},backend:e,attrs:{perm:c}}),l=He(l.length,i.shape.length)),wn("any",l,u.shape.length);const[d,h]=We(u.shape,l),p=nt(h),m=an(nt(d),u.dtype),f=e.data.get(u.dataId).values;for(let w=0;w<m.length;++w){const b=w*p;let I=f[b];for(let y=0;y<p;++y){const k=f[b+y];I=I||k}m[w]=I}c!=null&&e.disposeIntermediateTensorInfo(u);const g=e.makeTensorInfo(d,u.dtype,m);if(a){const w=Je(d,r),b=It({inputs:{x:g},backend:e,attrs:{shape:w}});return e.disposeIntermediateTensorInfo(g),b}return g}const N0={kernelName:Tf,backendName:"cpu",kernelFunc:S0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v0(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{axis:o}=s;Q(i,"argMax");let a=Ot(o,i.shape);const r=be(a,i.shape.length);let l=i;const c=[];r!=null&&(l=Zt({inputs:{x:i},backend:e,attrs:{perm:r}}),c.push(l),a=He(a.length,l.shape.length)),a=[a[0]],wn("argMax",a,l.shape.length);const[u,d]=We(l.shape,a),h=nt(u),p=an(h,"int32"),m=nt(d),f=e.data.get(l.dataId).values;for(let g=0;g<p.length;++g){const w=g*m;let b=f[w],I=0;for(let y=0;y<m;++y){const k=f[w+y];k>b&&(b=k,I=y)}p[g]=I}return c.forEach(g=>e.disposeIntermediateTensorInfo(g)),e.makeTensorInfo(u,"int32",p)}const C0={kernelName:Er,backendName:"cpu",kernelFunc:v0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T0(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{axis:o}=s;Q(i,"argMin");let a=Ot(o,i.shape);const r=be(a,i.shape.length);let l=i;const c=[];r!=null&&(l=Zt({inputs:{x:i},backend:e,attrs:{perm:r}}),c.push(l),a=He(a.length,l.shape.length)),a=[a[0]],wn("argMin",a,l.shape.length);const[u,d]=We(l.shape,a),h=nt(u),p=an(h,"int32"),m=nt(d),f=e.data.get(l.dataId).values;for(let g=0;g<p.length;++g){const w=g*m;let b=f[w],I=0;for(let y=0;y<m;++y){const k=f[w+y];k<b&&(b=k,I=y)}p[g]=I}return c.forEach(g=>e.disposeIntermediateTensorInfo(g)),e.makeTensorInfo(u,"int32",p)}const D0={kernelName:$r,backendName:"cpu",kernelFunc:T0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A0=bt(ao,n=>Math.asin(n)),F0={kernelName:ao,backendName:"cpu",kernelFunc:A0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R0=bt(ro,n=>Math.asinh(n)),M0={kernelName:ro,backendName:"cpu",kernelFunc:R0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z0=bt(co,n=>Math.atan(n)),E0={kernelName:co,backendName:"cpu",kernelFunc:z0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $0=bn((n,t)=>Math.atan2(n,t)),O0=Un(lo,$0),L0={kernelName:lo,backendName:"cpu",kernelFunc:O0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _0=bt(uo,n=>Math.atanh(n)),P0={kernelName:uo,backendName:"cpu",kernelFunc:_0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aa(n,t,e,s,i,o){const a=i.strideHeight,r=i.strideWidth,l=i.dilationHeight,c=i.dilationWidth,u=i.effectiveFilterHeight,d=i.effectiveFilterWidth,h=i.padInfo.top,p=i.padInfo.left,m=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,f=Bt(i.outShape,e),g=f.values,w=i.outShape[1]*i.outShape[2]*i.outShape[3],b=i.outShape[2]*i.outShape[3],I=i.outShape[3];for(let y=0;y<i.batchSize;++y){const k=y*w,x=y*s[0];for(let N=0;N<i.inChannels;++N)for(let v=0;v<i.outHeight;++v){const C=v*a-h,T=Math.max(0,C),R=Math.min(i.inHeight,u+C),_=k+v*b;for(let M=0;M<i.outWidth;++M){const O=M*r-p,z=Math.max(0,O),E=Math.min(i.inWidth,d+O);let L=m,$=0,P=0;for(let W=T;W<R;W+=l){const U=x+W*s[1];for(let G=z;G<E;G+=c){const q=U+G*s[2],j=n[q+N];o==="max"&&j>L?L=j:o==="avg"&&($+=j,P++)}if(isNaN(L))break}const H=_+M*I+N;g[H]=o==="avg"?$/P:L}}}return f}function jh(n,t,e,s,i=!1,o=!1){const a=Bt(s.outShape,"int32"),r=s.strideHeight,l=s.strideWidth,c=s.dilationHeight,u=s.dilationWidth,d=s.effectiveFilterHeight,h=s.effectiveFilterWidth,p=s.padInfo.top,m=s.padInfo.left,f=Bt(t,e,n);for(let g=0;g<s.batchSize;++g)for(let w=0;w<s.inChannels;++w)for(let b=0;b<s.outHeight;++b){const I=b*r-p;let y=I;for(;y<0;)y+=c;const k=Math.min(s.inHeight,d+I);for(let x=0;x<s.outWidth;++x){const N=x*l-m;let v=N;for(;v<0;)v+=u;const C=Math.min(s.inWidth,h+N);let T=Number.NEGATIVE_INFINITY,R=-1;for(let _=y;_<k;_+=c){const M=_-I;for(let O=v;O<C;O+=u){const z=O-N,E=f.get(g,_,O,w);E>T&&(T=E,i?R=o?((g*s.inHeight+_)*s.inWidth+O)*s.inChannels+w:(_*s.inWidth+O)*s.inChannels+w:R=M*h+z)}}a.set(R,g,b,x,w)}}return a}function qh(n,t,e,s,i,o){const a=i.strideDepth,r=i.strideHeight,l=i.strideWidth,c=i.dilationDepth,u=i.dilationHeight,d=i.dilationWidth,h=i.effectiveFilterDepth,p=i.effectiveFilterHeight,m=i.effectiveFilterWidth,f=i.padInfo.front,g=i.padInfo.top,w=i.padInfo.left,b=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,I=Bt(i.outShape,e),y=I.values,k=i.outShape[1]*i.outShape[2]*i.outShape[3]*i.outShape[4],x=i.outShape[2]*i.outShape[3]*i.outShape[4],N=i.outShape[3]*i.outShape[4],v=i.outShape[4];for(let C=0;C<i.batchSize;++C){const T=C*k,R=C*s[0];for(let _=0;_<i.inChannels;++_)for(let M=0;M<i.outDepth;++M){const O=M*a-f;let z=O;for(;z<0;)z+=c;const E=Math.min(i.inDepth,h+O),L=T+M*x;for(let $=0;$<i.outHeight;++$){const P=$*r-g;let H=P;for(;H<0;)H+=u;const W=Math.min(i.inHeight,p+P),U=L+$*N;for(let G=0;G<i.outWidth;++G){const q=G*l-w;let j=q;for(;j<0;)j+=d;const K=Math.min(i.inWidth,m+q),Z=U+G*v;let et=b,tt=0,ot=0;for(let ft=z;ft<E;ft+=c){const yt=R+ft*s[1];for(let At=H;At<W;At+=u){const wt=yt+At*s[2];for(let mt=j;mt<K;mt+=d){const Tt=wt+mt*s[3],xt=n[Tt+_];if(o==="max"&&xt>et?et=xt:o==="avg"&&(tt+=xt,ot++),isNaN(et))break}if(isNaN(et))break}if(isNaN(et))break}const at=Z+_;y[at]=o==="avg"?tt/Math.max(ot,1):et}}}}return I}function B0(n,t){const e=Bt(t.outShape,"int32"),s=t.strideDepth,i=t.strideHeight,o=t.strideWidth,a=t.dilationDepth,r=t.dilationHeight,l=t.dilationWidth,c=t.effectiveFilterDepth,u=t.effectiveFilterHeight,d=t.effectiveFilterWidth,h=t.padInfo.front,p=t.padInfo.top,m=t.padInfo.left;for(let f=0;f<t.batchSize;++f)for(let g=0;g<t.inChannels;++g)for(let w=0;w<t.outDepth;++w){const b=w*s-h;let I=b;for(;I<0;)I+=a;const y=Math.min(t.inDepth,c+b);for(let k=0;k<t.outHeight;++k){const x=k*i-p;let N=x;for(;N<0;)N+=r;const v=Math.min(t.inHeight,u+x);for(let C=0;C<t.outWidth;++C){const T=C*o-m;let R=T;for(;R<0;)R+=l;const _=Math.min(t.inWidth,d+T);let M=Number.NEGATIVE_INFINITY,O=-1;for(let z=I;z<y;z+=a){const E=z-b;for(let L=N;L<v;L+=r){const $=L-x;for(let P=R;P<_;P+=l){const H=P-T,W=n.get(f,z,L,P,g);W>=M&&(M=W,O=E*u*d+$*u+H)}}}e.set(O,f,w,k,C,g)}}}return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V0(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t;Q(i,"avgPool");const{filterSize:o,strides:a,pad:r,dimRoundingMode:l}=s,c=1;Y(ci(a,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${a} and dilations '${c}'`);const u=gs(i.shape,o,a,c,r,l);let d;if(u.filterWidth===1&&u.filterHeight===1&&Jt(u.inShape,u.outShape))d=yn({inputs:{x:i},backend:e});else{const h=e.data.get(i.dataId).values,p=ct(i.shape),m=Aa(h,i.shape,i.dtype,p,u,"avg");d=e.makeTensorInfo(u.outShape,i.dtype,m.values)}return d}const W0={kernelName:Pr,backendName:"cpu",kernelFunc:V0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H0(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{filterSize:o,strides:a,pad:r,dimRoundingMode:l,dataFormat:c}=s;Q(i,"avgPool3d");const u=fi(i.shape,o,a,1,r,l,c),d=e.data.get(i.dataId).values,h=qh(d,i.shape,i.dtype,ct(i.shape),u,"avg");return e.makeTensorInfo(h.shape,"float32",h.values)}const G0={kernelName:Lr,backendName:"cpu",kernelFunc:H0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U0(n){const{inputs:t,backend:e,attrs:s}=n,{dy:i,input:o}=t,{filterSize:a,strides:r,pad:l,dimRoundingMode:c}=s;Q([i,o],"avgPool3DGrad");const u=fi(o.shape,a,r,1,l,c),d=u.strideDepth,h=u.strideHeight,p=u.strideWidth,m=u.filterDepth,f=u.filterHeight,g=u.filterWidth,w=u.dilationDepth,b=u.dilationHeight,I=u.dilationWidth,y=u.effectiveFilterDepth,k=u.effectiveFilterHeight,x=u.effectiveFilterWidth,N=y-1-u.padInfo.front,v=x-1-u.padInfo.left,C=k-1-u.padInfo.top,T=Bt(o.shape,"float32"),R=1/(m*f*g),_=e.bufferSync(i);for(let M=0;M<u.batchSize;++M)for(let O=0;O<u.inChannels;++O)for(let z=0;z<u.inDepth;++z)for(let E=0;E<u.inHeight;++E)for(let L=0;L<u.inWidth;++L){const $=z-N,P=E-C,H=L-v;let W=0;for(let U=0;U<y;U+=w){const G=($+U)/d;if(!(G<0||G>=u.outDepth||Math.floor(G)!==G))for(let q=0;q<k;q+=b){const j=(P+q)/h;if(!(j<0||j>=u.outHeight||Math.floor(j)!==j))for(let K=0;K<x;K+=I){const Z=(H+K)/p;if(Z<0||Z>=u.outWidth||Math.floor(Z)!==Z)continue;const et=_.get(M,G,j,Z,O);W+=et}}}T.set(W*R,M,z,E,L,O)}return e.makeTensorInfo(T.shape,T.dtype,T.values)}const j0={kernelName:Or,backendName:"cpu",kernelFunc:U0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q0(n){const{inputs:t,backend:e,attrs:s}=n,{dy:i,input:o}=t,a=o;Q([i,o],"avgPoolGrad");const{filterSize:r,strides:l,pad:c}=s,u=gs(a.shape,r,l,1,c),d=u.strideHeight,h=u.strideWidth,p=u.filterHeight,m=u.filterWidth,f=u.dilationHeight,g=u.dilationWidth,w=u.effectiveFilterHeight,b=u.effectiveFilterWidth,I=b-1-u.padInfo.left,y=w-1-u.padInfo.top,k=Bt(a.shape,"float32"),x=1/(p*m),N=e.data.get(i.dataId).values,v=Bt(i.shape,"float32",N);for(let C=0;C<u.batchSize;++C)for(let T=0;T<u.inChannels;++T)for(let R=0;R<u.inHeight;++R)for(let _=0;_<u.inWidth;++_){const M=R-y,O=_-I;let z=0;for(let E=0;E<w;E+=f){const L=(M+E)/d;if(!(L<0||L>=u.outHeight||Math.floor(L)!==L))for(let $=0;$<b;$+=g){const P=(O+$)/h;if(P<0||P>=u.outWidth||Math.floor(P)!==P)continue;const H=v.get(C,L,P,T);z+=H}}k.set(z*x,C,R,_,T)}return e.makeTensorInfo(k.shape,k.dtype,k.values)}const K0={kernelName:_r,backendName:"cpu",kernelFunc:q0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y0(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,scale:o,offset:a,mean:r,variance:l}=t;Y(r.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),Y(a==null||r.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),Y(o==null||r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Q([i,r,l,o,a],"batchNorm");let{varianceEpsilon:c}=s;c==null&&(c=.001);const u=e.data.get(i.dataId).values,d=e.data.get(r.dataId).values,h=e.data.get(l.dataId).values,p=o?e.data.get(o.dataId).values:new Float32Array([1]),m=a?e.data.get(a.dataId).values:new Float32Array([0]),f=new Float32Array(u.length),g=m.length,w=p.length,b=h.length,I=d.length;let y=0,k=0,x=0,N=0;for(let v=0;v<u.length;++v)f[v]=m[y++]+(u[v]-d[k++])*p[x++]/Math.sqrt(h[N++]+c),y>=g&&(y=0),k>=I&&(k=0),x>=w&&(x=0),N>=b&&(N=0);return e.makeTensorInfo(i.shape,i.dtype,f)}const X0={kernelName:il,backendName:"cpu",kernelFunc:Y0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J0(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{blockShape:o,crops:a}=s;Q([i],"batchToSpaceND");const r=o.reduce((w,b)=>w*b),l=uc(i.shape,o,r),c=hc(l.length,o.length),u=dc(i.shape,o,r),d=Df(a,o.length),h=Af(u,a,o.length),p=It({inputs:{x:i},backend:e,attrs:{shape:l}}),m=Zt({inputs:{x:p},backend:e,attrs:{perm:c}}),f=It({inputs:{x:m},backend:e,attrs:{shape:u}}),g=En({inputs:{x:f},backend:e,attrs:{begin:d,size:h}});return e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(f),g}const Z0={kernelName:Vr,backendName:"cpu",kernelFunc:J0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q0(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,weights:o}=t,{size:a}=s,r=e.data.get(i.dataId).values,l=e.data.get(o.dataId).values,c=pc(r,l,o.dtype,o.shape,a);return e.makeTensorInfo([a],o.dtype,c)}const tk={kernelName:Ff,backendName:"cpu",kernelFunc:Q0};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ek(n){const{inputs:t,backend:e}=n,{s0:s,s1:i}=t,o=e.data.get(s.dataId).values,a=e.data.get(i.dataId).values,r=Me(Array.from(o),Array.from(a));return e.makeTensorInfo([r.length],"int32",Int32Array.from(r))}const nk={kernelName:Rf,backendName:"cpu",kernelFunc:ek};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sk=bt(ho,(n,t)=>{const e=t;return n>e.clipValueMax?e.clipValueMax:n<e.clipValueMin?e.clipValueMin:n}),ik={kernelName:ho,backendName:"cpu",kernelFunc:sk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ok=n=>{const{x:t}=n.inputs,e=n.backend,s=new Float32Array(nt(t.shape)),i=e.data.get(t.dataId),o=i.complexTensorInfos.real,a=i.complexTensorInfos.imag,r=e.data.get(o.dataId).values,l=e.data.get(a.dataId).values;for(let c=0;c<r.length;c++){const u=r[c],d=l[c];s[c]=Math.hypot(u,d)}return e.makeOutput(s,t.shape,"float32")},ak={kernelName:Hr,backendName:"cpu",kernelFunc:ok};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function On(n){const{inputs:t,backend:e}=n,{input:s}=t,i=e.data.get(s.dataId).complexTensorInfos.imag,o=e.data.get(i.dataId).values;return e.makeTensorInfo(i.shape,i.dtype,o)}const rk={kernelName:Mf,backendName:"cpu",kernelFunc:On};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ln(n){const{inputs:t,backend:e,attrs:s}=n,{axis:i}=s,o=Ot(i,t[0].shape)[0],a=t.map(f=>f.shape);zf(a,o);let r=Fi(t.map(f=>f.shape),o);if(nt(r)===0)return e.makeTensorInfo(r,t[0].dtype,[]);const l=t.filter(f=>nt(f.shape)>0);if(l.length===1)return yn({inputs:{x:l[0]},backend:e});if(l[0].dtype==="complex64"){const f=l.map(y=>rs({inputs:{input:y},backend:e})),g=l.map(y=>On({inputs:{input:y},backend:e})),w=Ln({inputs:f,backend:e,attrs:{axis:o}}),b=Ln({inputs:g,backend:e,attrs:{axis:o}}),I=Se({inputs:{real:w,imag:b},backend:e});return f.forEach(y=>e.disposeIntermediateTensorInfo(y)),g.forEach(y=>e.disposeIntermediateTensorInfo(y)),e.disposeIntermediateTensorInfo(w),e.disposeIntermediateTensorInfo(b),I}const c=l.map(f=>{const w=[-1,nt(f.shape.slice(o))];return It({inputs:{x:f},backend:e,attrs:{shape:w}})}),u=c.map(f=>({vals:e.data.get(f.dataId).values,shape:f.shape}));r=Fi(c.map(f=>f.shape),1);const d=c[0].shape[0]===1,h=Ef(u,r,t[0].dtype,d),p=Fi(l.map(f=>f.shape),o),m=e.makeTensorInfo(p,t[0].dtype,h);return c.forEach(f=>e.disposeIntermediateTensorInfo(f)),m}const lk={kernelName:Gr,backendName:"cpu",kernelFunc:Ln};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kh(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,filter:o}=t,{strides:a,pad:r,dataFormat:l,dilations:c,dimRoundingMode:u}=s;Q([i,o],"conv2d");const d=Zo(l),h=jn(i.shape,o.shape,a,c,r,u,!1,d),p=h.filterHeight,m=h.filterWidth,f=h.dilationHeight,g=h.dilationWidth,w=h.padInfo.left,b=h.padInfo.top,I=h.dataFormat==="channelsLast",y=new jt(h.outShape,i.dtype),k=ct(i.shape),x=ct(o.shape),N=k[0],v=I?k[1]:k[2],C=I?k[2]:1,T=I?1:k[1],R=y.strides[0],_=I?y.strides[1]:y.strides[2],M=I?y.strides[2]:1,O=I?1:y.strides[1],z=e.data.get(i.dataId).values,E=e.data.get(o.dataId).values,L=y.values;for(let $=0;$<h.batchSize;++$){const P=$*N,H=$*R;for(let W=0;W<h.outHeight;++W){const U=H+W*_,G=W*h.strideHeight-b;for(let q=0;q<p;++q){const j=G+q*f;if(j<0||j>=h.inHeight)continue;const K=q*x[0],Z=P+j*v;for(let et=0;et<h.outWidth;++et){const tt=U+et*M,ot=et*h.strideWidth-w;for(let at=0;at<m;++at){const ft=ot+at*g;if(ft<0||ft>=h.inWidth)continue;const yt=K+at*x[1],At=Z+ft*C;let wt=yt;for(let mt=0;mt<h.inChannels;++mt){const Tt=z[At+mt*T];for(let xt=0;xt<h.outChannels;++xt)L[tt+xt*O]+=Tt*E[wt+xt];wt+=h.outChannels}}}}}}return e.makeTensorInfo(y.shape,y.dtype,L)}const ck={kernelName:Ur,backendName:"cpu",kernelFunc:Kh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uk(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,dy:o}=t,{strides:a,pad:r,dataFormat:l,dimRoundingMode:c,filterShape:u}=s;Q([i,o],"conv2dBackpropFilter");const d=Zo(l),h=jn(i.shape,u,a,1,r,c,!1,d),{strideHeight:p,strideWidth:m,filterHeight:f,filterWidth:g}=h,w=h.dataFormat==="channelsLast",b=new jt(h.filterShape,"float32"),I=h.padInfo.left,y=h.padInfo.top,k=e.data.get(i.dataId).values,x=e.data.get(o.dataId).values,N=new jt(i.shape,i.dtype,k),v=new jt(o.shape,o.dtype,x);for(let C=0;C<f;++C){const T=Math.max(0,Math.ceil((y-C)/p)),R=Math.min(h.outHeight,(h.inHeight+y-C)/p);for(let _=0;_<g;++_){const M=Math.max(0,Math.ceil((I-_)/m)),O=Math.min(h.outWidth,(h.inWidth+I-_)/m);for(let z=0;z<h.inChannels;++z)for(let E=0;E<h.outChannels;++E){let L=0;for(let $=0;$<h.batchSize;++$)for(let P=T;P<R;++P){const H=C+P*p-y;for(let W=M;W<O;++W){const U=_+W*m-I;w?L+=N.get($,H,U,z)*v.get($,P,W,E):L+=N.get($,z,H,U)*v.get($,E,P,W)}}b.set(L,C,_,z,E)}}}return e.makeTensorInfo(b.shape,b.dtype,b.values)}const hk={kernelName:$f,backendName:"cpu",kernelFunc:uk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dk(n){const{inputs:t,backend:e,attrs:s}=n,{dy:i,filter:o}=t,{inputShape:a,strides:r,pad:l,dataFormat:c,dimRoundingMode:u}=s;Q([i,o],"conv2dBackpropInput");const d=ct(o.shape),h=ct(i.shape);let p=Zo(c);const m=jn(a,o.shape,r,1,l,u,!1,p),f=new jt(m.inShape,"float32"),g=f.values,w=e.data.get(i.dataId).values,b=e.data.get(o.dataId).values,[I,y,k]=d,{batchSize:x,filterHeight:N,filterWidth:v,inChannels:C,inHeight:T,inWidth:R,outChannels:_,outHeight:M,outWidth:O,strideHeight:z,strideWidth:E}=m;p=m.dataFormat;const L=N-1-m.padInfo.top,$=v-1-m.padInfo.left,P=p==="channelsLast",H=f.strides[0],W=P?f.strides[1]:f.strides[2],U=P?f.strides[2]:1,G=P?1:f.strides[1],q=h[0],j=P?h[1]:h[2],K=P?h[2]:1,Z=P?1:h[1];for(let et=0;et<x;++et)for(let tt=0;tt<C;++tt)for(let ot=0;ot<T;++ot){const at=ot-L,ft=Math.max(0,Math.ceil(at/z)),yt=Math.min(M,(N+at)/z);for(let At=0;At<R;++At){const wt=At-$,mt=Math.max(0,Math.ceil(wt/E)),Tt=Math.min(O,(v+wt)/E);let xt=0;for(let Pt=ft;Pt<yt;++Pt){const Ge=Pt*z-at;for(let Kt=mt;Kt<Tt;++Kt){const ln=Kt*E-wt,le=q*et+j*Pt+K*Kt,Ee=I*(N-1-Ge)+y*(v-1-ln)+k*tt;for(let Ue=0;Ue<_;++Ue){const je=w[le+Z*Ue],qe=b[Ee+Ue];xt+=je*qe}}}const ze=H*et+W*ot+U*At+G*tt;g[ze]=xt}}return e.makeTensorInfo(f.shape,f.dtype,f.values)}const pk={kernelName:qr,backendName:"cpu",kernelFunc:dk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fk(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,filter:o}=t,{strides:a,pad:r,dilations:l}=s;Q([i,o],"conv3d");const c=Qo(i.shape,o.shape,a,l,r),{filterDepth:u,filterHeight:d,filterWidth:h,dilationDepth:p,dilationHeight:m,dilationWidth:f,padInfo:g}=c,w=g.front,b=g.left,I=g.top,y=new jt(c.outShape,i.dtype),k=e.data.get(i.dataId).values,x=e.data.get(o.dataId).values,N=y.values,v=ct(i.shape),C=ct(o.shape);for(let T=0;T<c.batchSize;++T){const R=T*v[0],_=T*y.strides[0];for(let M=0;M<c.outDepth;++M){const O=_+M*y.strides[1],z=M*c.strideDepth-w;for(let E=0;E<u;++E){const L=z+E*p;if(L<0||L>=c.inDepth)continue;const $=E*C[0],P=R+L*v[1];for(let H=0;H<c.outHeight;++H){const W=O+H*y.strides[2],U=H*c.strideHeight-I;for(let G=0;G<d;++G){const q=U+G*m;if(q<0||q>=c.inHeight)continue;const j=$+G*C[1],K=P+q*v[2];for(let Z=0;Z<c.outWidth;++Z){const et=W+Z*c.outChannels,tt=Z*c.strideWidth-b;for(let ot=0;ot<h;++ot){const at=tt+ot*f;if(at<0||at>=c.inWidth)continue;const ft=j+ot*C[2],yt=K+at*c.inChannels;let At=ft;for(let wt=0;wt<c.inChannels;++wt){const mt=k[yt+wt];for(let Tt=0;Tt<c.outChannels;++Tt)N[et+Tt]+=mt*x[At+Tt];At+=c.outChannels}}}}}}}}return e.makeTensorInfo(y.shape,y.dtype,y.values)}const mk={kernelName:Yr,backendName:"cpu",kernelFunc:fk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gk(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,dy:o}=t,{strides:a,pad:r,filterShape:l}=s;Q([i,o],"conv3dBackpropFilterV2");const c=ct(i.shape),u=ct(o.shape),d=Qo(i.shape,l,a,1,r),h=d.strideDepth,p=d.strideHeight,m=d.strideWidth,f=d.filterDepth,g=d.filterHeight,w=d.filterWidth,b=new jt(d.filterShape,"float32"),I=b.values,[y,k,x,N]=b.strides,v=e.data.get(o.dataId).values,[C,T,R,_]=u,M=e.data.get(i.dataId).values,[O,z,E,L]=c,$=d.padInfo.front,P=d.padInfo.left,H=d.padInfo.top;for(let W=0;W<f;++W){const U=Math.max(0,Math.ceil(($-W)/h)),G=Math.min(d.outDepth,(d.inDepth+$-W)/h),q=W*y;for(let j=0;j<g;++j){const K=Math.max(0,Math.ceil((H-j)/p)),Z=Math.min(d.outHeight,(d.inHeight+H-j)/p),et=j*k+q;for(let tt=0;tt<w;++tt){const ot=Math.max(0,Math.ceil((P-tt)/m)),at=Math.min(d.outWidth,(d.inWidth+P-tt)/m),ft=tt*x+et;for(let yt=0;yt<d.inChannels;++yt){const At=yt*N+ft;for(let wt=0;wt<d.outChannels;++wt){let mt=0;for(let Tt=0;Tt<d.batchSize;++Tt){const xt=Tt*O,ze=Tt*C;for(let Pt=U;Pt<G;++Pt){const Kt=(W+Pt*h-$)*z+xt,ln=Pt*T+ze;for(let le=K;le<Z;++le){const Ue=(j+le*p-H)*E+Kt,je=le*R+ln;for(let qe=ot;qe<at;++qe){const Di=(tt+qe*m-P)*L+Ue,Ai=qe*_+je;mt+=M[Di+yt]*v[Ai+wt]}}}}I[At+wt]=mt}}}}}return e.makeTensorInfo(b.shape,b.dtype,b.values)}const bk={kernelName:Kr,backendName:"cpu",kernelFunc:gk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yk(n){const{inputs:t,backend:e,attrs:s}=n,{dy:i,filter:o}=t,{pad:a,strides:r,inputShape:l}=s;Q([i],"conv3dBackpropInputV2");const c=ct(i.shape),u=ct(o.shape),d=Qo(l,o.shape,r,1,a),h=new jt(d.inShape,"float32"),p=h.values,[m,f,g,w]=h.strides,b=e.data.get(i.dataId).values,[I,y,k,x]=c,N=e.data.get(o.dataId).values,[v,C,T,R]=u,{batchSize:_,filterDepth:M,filterHeight:O,filterWidth:z,inChannels:E,inDepth:L,inHeight:$,inWidth:P,outChannels:H,outDepth:W,outHeight:U,outWidth:G,strideDepth:q,strideHeight:j,strideWidth:K}=d,Z=M-1-d.padInfo.front,et=O-1-d.padInfo.top,tt=z-1-d.padInfo.left;for(let ot=0;ot<_;++ot)for(let at=0;at<E;++at)for(let ft=0;ft<L;++ft){const yt=ft-Z,At=Math.max(0,Math.ceil(yt/q)),wt=Math.min(W,(M+yt)/q);for(let mt=0;mt<$;++mt){const Tt=mt-et,xt=Math.max(0,Math.ceil(Tt/j)),ze=Math.min(U,(O+Tt)/j);for(let Pt=0;Pt<P;++Pt){const Ge=Pt-tt,Kt=Math.max(0,Math.ceil(Ge/K)),ln=Math.min(G,(z+Ge)/K);let le=0;for(let Ee=At;Ee<wt;++Ee){const Ue=Ee*q-yt;for(let je=xt;je<ze;++je){const qe=je*j-Tt;for(let Kn=Kt;Kn<ln;++Kn){const Di=Kn*K-Ge,Ai=I*ot+y*Ee+k*je+x*Kn,gd=v*(M-1-Ue)+C*(O-1-qe)+T*(z-1-Di)+R*at;for(let Cs=0;Cs<H;++Cs){const bd=b[Ai+Cs],yd=N[gd+Cs];le+=bd*yd}}}}p[m*ot+f*ft+g*mt+w*Pt+at]=le}}}return e.makeTensorInfo(h.shape,h.dtype,h.values)}const wk={kernelName:Of,backendName:"cpu",kernelFunc:yk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ik=bt(fo,n=>Math.cos(n)),kk={kernelName:fo,backendName:"cpu",kernelFunc:Ik};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xk=bt(mo,n=>Math.cosh(n)),Sk={kernelName:mo,backendName:"cpu",kernelFunc:xk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nk(n){const{inputs:t,backend:e,attrs:s}=n,{image:i,boxes:o,boxInd:a}=t,{cropSize:r,method:l,extrapolationValue:c}=s,[u,d,h,p]=i.shape,m=o.shape[0],[f,g]=r,w=Bt([m,f,g,p],"float32"),b=e.data.get(o.dataId).values,I=e.data.get(a.dataId).values,y=e.data.get(i.dataId).values,k=ct(i.shape),x=ct(w.shape);for(let N=0;N<m;N++){const v=N*4,C=b[v],T=b[v+1],R=b[v+2],_=b[v+3],M=I[N];if(M>=u)continue;const O=f>1?(R-C)*(d-1)/(f-1):0,z=g>1?(_-T)*(h-1)/(g-1):0;for(let E=0;E<f;E++){const L=f>1?C*(d-1)+E*O:.5*(C+R)*(d-1);if(L<0||L>d-1){for(let $=0;$<g;$++)for(let P=0;P<p;P++){const H=P+$*x[2]+E*x[1]+N*x[0];w.values[H]=c}continue}if(l==="bilinear"){const $=Math.floor(L),P=Math.ceil(L),H=L-$;for(let W=0;W<g;W++){const U=g>1?T*(h-1)+W*z:.5*(T+_)*(h-1);if(U<0||U>h-1){for(let K=0;K<p;K++){const Z=K+W*x[2]+E*x[1]+N*x[0];w.values[Z]=c}continue}const G=Math.floor(U),q=Math.ceil(U),j=U-G;for(let K=0;K<p;K++){let Z=K+G*k[2]+$*k[1]+M*k[0];const et=y[Z];Z=K+q*k[2]+$*k[1]+M*k[0];const tt=y[Z];Z=K+G*k[2]+P*k[1]+M*k[0];const ot=y[Z];Z=K+q*k[2]+P*k[1]+M*k[0];const at=y[Z],ft=et+(tt-et)*j,yt=ot+(at-ot)*j;Z=K+W*x[2]+E*x[1]+N*x[0],w.values[Z]=ft+(yt-ft)*H}}}else for(let $=0;$<g;++$){const P=g>1?T*(h-1)+$*z:.5*(T+_)*(h-1);if(P<0||P>h-1){for(let U=0;U<p;U++){const G=U+$*x[2]+E*x[1]+N*x[0];w.values[G]=c}continue}const H=Math.round(P),W=Math.round(L);for(let U=0;U<p;U++){const G=U+H*k[2]+W*k[1]+M*k[0],q=U+$*x[2]+E*x[1]+N*x[0];w.values[q]=y[G]}}}}return e.makeTensorInfo(w.shape,w.dtype,w.values)}const vk={kernelName:Lf,backendName:"cpu",kernelFunc:Nk};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ck(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{axis:o,exclusive:a,reverse:r}=s;Q(i,"cumprod");const l=be([o],i.shape.length);let c=i;l!=null&&(c=Zt({inputs:{x:i},backend:e,attrs:{perm:l}}));const u=He(1,i.shape.length)[0];if(u!==c.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${u}`);const d=mi(c.dtype,"int32"),h=Pf(nt(c.shape),d),p=e.data.get(c.dataId).values,m=c.shape[c.shape.length-1],f=r?(w,b)=>w+m-b-1:(w,b)=>w+b;for(let w=0;w<p.length;w+=m)for(let b=0;b<m;b++){const I=f(w,b);if(b===0)h[I]=a?1:p[I];else{const y=f(w,b-1);h[I]=a?p[y]*h[y]:p[I]*h[y]}}const g=e.makeTensorInfo(c.shape,d,h);if(l!=null){const w=ds(l),b=Zt({inputs:{x:g},backend:e,attrs:{perm:w}});return e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(c),b}return g}const Tk={kernelName:_f,backendName:"cpu",kernelFunc:Ck};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dk(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{axis:o,exclusive:a,reverse:r}=s;Q(i,"cumsum");const l=be([o],i.shape.length);let c=i;l!=null&&(c=Zt({inputs:{x:i},backend:e,attrs:{perm:l}}));const u=He(1,i.shape.length)[0];if(u!==c.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${u}`);const d=mi(c.dtype,"int32"),h=an(nt(c.shape),d),p=e.data.get(c.dataId).values,m=c.shape[c.shape.length-1],f=r?(w,b)=>w+m-b-1:(w,b)=>w+b;for(let w=0;w<p.length;w+=m)for(let b=0;b<m;b++){const I=f(w,b);if(b===0)h[I]=a?0:p[I];else{const y=f(w,b-1);h[I]=a?p[y]+h[y]:p[I]+h[y]}}const g=e.makeTensorInfo(c.shape,d,h);if(l!=null){const w=ds(l),b=Zt({inputs:{x:g},backend:e,attrs:{perm:w}});return e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(c),b}return g}const Ak={kernelName:Zr,backendName:"cpu",kernelFunc:Dk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fk(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,weights:o}=t,{size:a,binaryOutput:r}=s;if(i.shape.length===1){const l=e.data.get(i.dataId).values,c=e.data.get(o.dataId).values,u=pc(l,c,o.dtype,o.shape,a);return e.makeTensorInfo([a],o.dtype,u)}else if(i.shape.length===2){const l=e.bufferSync(i),c=e.bufferSync(o),u=Vf(l,c,a,r);return e.makeTensorInfo(u.shape,o.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}const Rk={kernelName:Bf,backendName:"cpu",kernelFunc:Fk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mk(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{blockSize:o,dataFormat:a}=s;Y(a==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${a}`);const r=i.shape[0],l=i.shape[1],c=i.shape[2],u=i.shape[3],d=l*o,h=c*o,p=u/(o*o),m=e.data.get(i.dataId).values,f=new Float32Array(r*d*h*p);let g=0;for(let w=0;w<r;++w)for(let b=0;b<d;++b){const I=Math.floor(b/o),y=b%o;for(let k=0;k<h;++k){const x=Math.floor(k/o),N=k%o,v=(y*o+N)*p;for(let C=0;C<p;++C){const R=C+v+u*(x+c*(I+l*w));f[g++]=m[R]}}}return e.makeTensorInfo([r,d,h,p],i.dtype,f)}const zk={kernelName:Wf,backendName:"cpu",kernelFunc:Mk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yh(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,filter:o}=t,{strides:a,pad:r,dilations:l,dimRoundingMode:c}=s;Q([i,o],"depthwiseConv2DNative");const u=ct(i.shape),d=ct(o.shape);let h=l;h==null&&(h=[1,1]),Y(ci(a,h),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${a} and dilations '${h}'`);const p=jn(i.shape,o.shape,a,h,r,c,!0),{filterHeight:m,filterWidth:f,dilationHeight:g,dilationWidth:w,padInfo:b}=p,I=b.left,y=b.top,k=p.outChannels/p.inChannels,x=new jt(p.outShape,i.dtype),N=e.data.get(i.dataId).values,v=e.data.get(o.dataId).values,C=x.values;for(let T=0;T<p.batchSize;++T){const R=T*u[0],_=T*x.strides[0];for(let M=0;M<p.outHeight;++M){const O=_+M*x.strides[1],z=M*p.strideHeight-y;for(let E=0;E<m;++E){const L=z+E*g;if(L<0||L>=p.inHeight)continue;const $=E*d[0],P=R+L*u[1];for(let H=0;H<p.outWidth;++H){const W=O+H*x.strides[2],U=H*p.strideWidth-I;for(let G=0;G<f;++G){const q=U+G*w;if(q<0||q>=p.inWidth)continue;const j=$+G*d[1],K=P+q*p.inChannels;let Z=W,et=j;for(let tt=0;tt<p.inChannels;++tt){const ot=N[K+tt];for(let at=0;at<k;++at)C[Z+at]+=ot*v[et+at];Z+=k,et+=k}}}}}}return e.makeTensorInfo(x.shape,x.dtype,x.values)}const Ek={kernelName:tl,backendName:"cpu",kernelFunc:Yh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $k(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,dy:o}=t,{strides:a,dilations:r,pad:l,dimRoundingMode:c,filterShape:u}=s;Q([i,o],"depthwiseConv2dNativeBackpropFilter");const d=jn(i.shape,u,a,r,l,c,!0),{strideHeight:h,strideWidth:p,filterHeight:m,filterWidth:f}=d,g=new jt(d.filterShape,"float32"),w=d.padInfo.left,b=d.padInfo.top,I=d.outChannels/d.inChannels,y=e.data.get(i.dataId).values,k=new jt(i.shape,i.dtype,y),x=e.data.get(o.dataId).values,N=new jt(o.shape,o.dtype,x);for(let v=0;v<m;++v){const C=Math.max(0,Math.ceil((b-v)/h)),T=Math.min(d.outHeight,(d.inHeight+b-v)/h);for(let R=0;R<f;++R){const _=Math.max(0,Math.ceil((w-R)/p)),M=Math.min(d.outWidth,(d.inWidth+w-R)/p);for(let O=0;O<d.outChannels;++O){const z=Math.trunc(O/I),E=O%I;let L=0;for(let $=0;$<d.batchSize;++$)for(let P=C;P<T;++P){const H=v+P*h-b;for(let W=_;W<M;++W){const U=R+W*p-w;L+=k.get($,H,U,z)*N.get($,P,W,O)}}g.set(L,v,R,z,E)}}}return e.makeTensorInfo(g.shape,g.dtype,g.values)}const Ok={kernelName:Hf,backendName:"cpu",kernelFunc:$k};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lk(n){const{inputs:t,backend:e,attrs:s}=n,{dy:i,filter:o}=t,{strides:a,dilations:r,pad:l,dimRoundingMode:c,inputShape:u}=s;Q([i,o],"depthwiseConv2DNativeBackpropInput");const d=ct(i.shape),h=ct(o.shape),p=jn(u,o.shape,a,r,l,c,!0),m=new jt(p.inShape,"float32"),f=m.values,[g,w,b]=m.strides,I=e.data.get(i.dataId).values,[y,k,x]=d,N=e.data.get(o.dataId).values,[v,C,T]=h,{batchSize:R,filterHeight:_,filterWidth:M,inChannels:O,inHeight:z,inWidth:E,outChannels:L,outHeight:$,outWidth:P,strideHeight:H,strideWidth:W}=p,U=_-1-p.padInfo.top,G=M-1-p.padInfo.left,q=L/O;for(let j=0;j<R;++j)for(let K=0;K<O;++K)for(let Z=0;Z<z;++Z){const et=Z-U,tt=Math.max(0,Math.ceil(et/H)),ot=Math.min($,(_+et)/H);for(let at=0;at<E;++at){const ft=at-G,yt=Math.max(0,Math.ceil(ft/W)),At=Math.min(P,(M+ft)/W);let wt=0;for(let mt=tt;mt<ot;++mt){const Tt=mt*H-et;for(let xt=yt;xt<At;++xt){const ze=xt*W-ft,Pt=y*j+k*mt+x*xt,Ge=v*(_-1-Tt)+C*(M-1-ze)+T*K;for(let Kt=0;Kt<q;++Kt){const ln=K*q+Kt,le=I[Pt+ln],Ee=N[Ge+Kt];wt+=le*Ee}}}f[g*j+w*Z+b*at+K]=wt}}return e.makeTensorInfo(m.shape,m.dtype,m.values)}const _k={kernelName:Gf,backendName:"cpu",kernelFunc:Lk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pk(n){const{inputs:t,backend:e}=n,{x:s}=t,i=nt(s.shape),o=e.data.get(s.dataId).values,a=Bt([i,i],s.dtype),r=a.values;for(let c=0;c<o.length;c++)r[c*i+c]=o[c];const l=[...s.shape,...s.shape];return e.makeTensorInfo(l,a.dtype,a.values)}const Bk={kernelName:Uf,backendName:"cpu",kernelFunc:Pk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vk={kernelName:el,backendName:"cpu",kernelFunc:({inputs:n,backend:t,attrs:e})=>{const{x:s,filter:i}=n,{strides:o,pad:a,dilations:r}=e,l=t,c=l.data.get(s.dataId).values,u=s.shape.length,d=l.data.get(i.dataId).values,h=i.shape.length,{batchSize:p,inHeight:m,inWidth:f,inChannels:g,outHeight:w,outWidth:b,padInfo:I,strideHeight:y,strideWidth:k,filterHeight:x,filterWidth:N,dilationHeight:v,dilationWidth:C,outShape:T}=ta(s.shape,i.shape,o,a,"NHWC",r),R=nt(T),_=T.length,M=ea(s.dtype,R);for(let z=0;z<p;++z)for(let E=0;E<w;++E){const L=E*y-I.top;for(let $=0;$<b;++$){const P=$*k-I.left;for(let H=0;H<g;++H){let W=Number.MIN_SAFE_INTEGER;for(let G=0;G<x;++G){const q=L+G*v;if(q>=0&&q<m)for(let j=0;j<N;++j){const K=P+j*C;if(K>=0&&K<f){const Z=ns([z,q,K,H],u,ct(s.shape)),et=ns([G,j,H],h,ct(i.shape)),tt=c[Z]+d[et];tt>W&&(W=tt)}}}const U=ns([z,E,$,H],_,ct(T));M[U]=W}}}return{dataId:l.write(na(M,s.dtype),T,s.dtype),shape:T,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wk={kernelName:Vi,backendName:"cpu",kernelFunc:({inputs:n,backend:t,attrs:e})=>{const{x:s,filter:i,dy:o}=n,{strides:a,pad:r,dilations:l}=e,c=t,u=An(s.shape,c.data.get(s.dataId).values),d=An(i.shape,c.data.get(i.dataId).values),{batchSize:h,inHeight:p,inWidth:m,inChannels:f,outHeight:g,outWidth:w,padInfo:b,strideHeight:I,strideWidth:y,filterHeight:k,filterWidth:x,dilationHeight:N,dilationWidth:v,outShape:C}=ta(s.shape,i.shape,a,r,"NHWC",l);Y(o.rank===C.length,()=>`Error in ${Vi}, dy must have the same rank as output ${C.length}, but got ${o.rank}`);const T=An(C,c.data.get(o.dataId).values),R=fc(i.shape,i.dtype);for(let M=0;M<h;++M)for(let O=0;O<g;++O){const z=O*I-b.top;for(let E=0;E<w;++E){const L=E*y-b.left;for(let $=0;$<f;++$){let P=Number.MIN_SAFE_INTEGER,H=0,W=0;for(let U=0;U<k;++U){const G=z+U*N;if(G>=0&&G<p)for(let q=0;q<x;++q){const j=L+q*v;if(j>=0&&j<m){const K=u[M][G][j][$]+d[U][q][$];K>P&&(P=K,H=U,W=q)}}}R[H][W][$]+=T[M][O][E][$]}}}return{dataId:c.write(na(R,s.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hk={kernelName:Bi,backendName:"cpu",kernelFunc:({inputs:n,backend:t,attrs:e})=>{const{x:s,filter:i,dy:o}=n,{strides:a,pad:r,dilations:l}=e,c=t,u=An(s.shape,c.data.get(s.dataId).values),d=An(i.shape,c.data.get(i.dataId).values),{batchSize:h,inHeight:p,inWidth:m,inChannels:f,outHeight:g,outWidth:w,padInfo:b,strideHeight:I,strideWidth:y,filterHeight:k,filterWidth:x,dilationHeight:N,dilationWidth:v,outShape:C}=ta(s.shape,i.shape,a,r,"NHWC",l);Y(o.rank===C.length,()=>`Error in ${Bi}, dy must have the same rank as output ${C.length}, but got ${o.rank}`);const T=An(C,c.data.get(o.dataId).values),R=fc(s.shape,s.dtype);for(let M=0;M<h;++M)for(let O=0;O<g;++O){const z=O*I-b.top;for(let E=0;E<w;++E){const L=E*y-b.left;for(let $=0;$<f;++$){let P=Number.MIN_SAFE_INTEGER,H=z<0?0:z,W=L<0?0:L;for(let U=0;U<k;++U){const G=z+U*N;if(G>=0&&G<p)for(let q=0;q<x;++q){const j=L+q*v;if(j>=0&&j<m){const K=u[M][G][j][$]+d[U][q][$];K>P&&(P=K,H=G,W=j)}}}R[M][H][W][$]+=T[M][O][E][$]}}}return{dataId:c.write(na(R,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gk(n){const{inputs:t,backend:e,attrs:s}=n,{image:i}=t,{canvas:o,options:a}=s,{contextOptions:r,imageOptions:l}=a||{},c=(l==null?void 0:l.alpha)||1,u=(r==null?void 0:r.contextType)||"2d";if(u!=="2d")throw new Error(`Context type ${r.contextType} is not supported by the CPU backend.`);const d=o.getContext(u,(r==null?void 0:r.contextAttributes)||{});if(d==null)throw new Error(`Could not get the context with ${u} type.`);const[h,p]=i.shape.slice(0,2),m=i.shape.length===2?1:i.shape[2],f=e.data.get(i.dataId).values,g=i.dtype==="float32"?255:1,w=new Uint8ClampedArray(p*h*4);for(let I=0;I<h*p;++I){const y=[0,0,0,255*c];for(let x=0;x<m;x++){const N=f[I*m+x];if(i.dtype==="float32"){if(N<0||N>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${N}.`)}else if(i.dtype==="int32"&&(N<0||N>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${N}.`);m===1?(y[0]=N*g,y[1]=N*g,y[2]=N*g):y[x]=N*g}const k=I*4;w[k+0]=Math.round(y[0]),w[k+1]=Math.round(y[1]),w[k+2]=Math.round(y[2]),w[k+3]=Math.round(y[3])}o.width=p,o.height=h;const b=new ImageData(w,p,h);return d.putImageData(b,0,0),i}const Uk={kernelName:jf,backendName:"cpu",kernelFunc:Gk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vs(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{axis:o,keepDims:a}=s;Q(i,"sum");let r;i.dtype==="bool"?r=sa({inputs:{x:i},backend:e,attrs:{dtype:"int32"}}):r=yn({inputs:{x:i},backend:e});const l=r.shape.length,c=Ot(o,r.shape),u=be(c,l);let d=c,h=r;u!=null&&(h=Zt({inputs:{x:r},backend:e,attrs:{perm:u}}),d=He(d.length,l)),wn("sum",d,h.shape.length);const[p,m]=We(h.shape,d),f=mi(h.dtype,"int32");let g=qf(e,p,f);const w=nt(m),b=e.data.get(g.dataId).values,I=e.data.get(h.dataId).values;for(let y=0;y<b.length;++y){const k=y*w;let x=0;for(let N=0;N<w;++N)x+=I[k+N];b[y]=x}if(a){const y=Je(g.shape,c),k=g;g=It({inputs:{x:g},backend:e,attrs:{shape:y}}),e.disposeIntermediateTensorInfo(k)}return e.disposeIntermediateTensorInfo(r),u!=null&&e.disposeIntermediateTensorInfo(h),g}const jk={kernelName:Vl,backendName:"cpu",kernelFunc:vs};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qk(n){const{inputs:t,backend:e,attrs:s}=n,{equation:i}=s,o=t,{allDims:a,summedDims:r,idDims:l}=Yf(i,o.length);Xf(a.length,l,o);const{path:c,steps:u}=Jf(r,l),d=u.length;let h=null,p=a.length;const m=[];for(let f=0;f<d;++f){for(const g of u[f]){const{permutationIndices:w,expandDims:b}=Zf(p,l[g]);let I;Qf(w)?I=o[g]:(I=Zt({inputs:{x:o[g]},backend:e,attrs:{perm:w}}),m.push(I));const y=I.shape.slice();for(let k=0;k<b.length;++k)y.splice(b[k],0,1);Jt(I.shape,y)||(I=It({inputs:{x:I},backend:e,attrs:{shape:y}}),m.push(I)),h===null?h=I:(h=ia({inputs:{a:I,b:h},backend:e}),m.push(h))}f<d-1&&(c[f]>=0&&(h=vs({inputs:{x:h},backend:e,attrs:{axis:c[f]-(a.length-p),keepDims:!1}}),m.push(h)),p--)}for(const f of m)f!==h&&e.disposeIntermediateTensorInfo(f);return h}const Kk={kernelName:Kf,backendName:"cpu",kernelFunc:qk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yk(n){const{inputs:t,backend:e}=n,{dy:s,y:i}=t;Q([s,i],"eluGrad");const o=new Float32Array(nt(i.shape)),a=e.data.get(i.dataId).values,r=e.data.get(s.dataId).values;for(let l=0;l<a.length;++l){const c=a[l];c>=0?o[l]=r[l]:o[l]=r[l]*(c+1)}return e.makeTensorInfo(i.shape,"float32",o)}const Xk={kernelName:nl,backendName:"cpu",kernelFunc:Yk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jk=om,Zk=tm,Qk=em,t1=nm,e1=sm,n1=im,s1=bt(bo,n=>{const t=Math.sign(n),e=Math.abs(n),s=1/(1+Jk*e);return t*(1-((((n1*s+e1)*s+t1)*s+Qk)*s+Zk)*s*Math.exp(-e*e))}),i1={kernelName:bo,backendName:"cpu",kernelFunc:s1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function si(n){const{inputs:t,backend:e,attrs:s}=n,{input:i}=t,{dim:o}=s,a=i.shape.length,r=i.shape.slice();let l=o;return o<0&&(Y(-(a+1)<=o,()=>`Axis must be in the interval [${-(a+1)}, ${a}]`),l=a+o+1),r.splice(l,0,1),It({inputs:{x:i},backend:e,attrs:{shape:r}})}const o1={kernelName:sl,backendName:"cpu",kernelFunc:si};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a1=bn((n,t)=>n/t),Fa=Un(Co,a1),eo={kernelName:Co,backendName:"cpu",kernelFunc:Fa};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xh(n,t,e){const s=n.shape,i=s[0],o=s[1],a=e.data.get(n.dataId),r=a.complexTensorInfos.real,l=a.complexTensorInfos.imag,c=[i,o],u=nt(c),d=Qe("float32",u),h=Qe("float32",u);for(let g=0;g<i;g++){const w=En({inputs:{x:r},backend:e,attrs:{begin:[g,0],size:[1,o]}}),b=En({inputs:{x:l},backend:e,attrs:{begin:[g,0],size:[1,o]}}),I=Se({inputs:{real:w,imag:b},backend:e}),{real:y,imag:k}=r1(I,t,e),x=pi(y,k);for(let N=0;N<o;N++){const v=mc(x,N);d[g*o+N]=v.real,h[g*o+N]=v.imag}e.disposeIntermediateTensorInfo(w),e.disposeIntermediateTensorInfo(b),e.disposeIntermediateTensorInfo(I)}const p=e.makeTensorInfo(c,"float32",d),m=e.makeTensorInfo(c,"float32",h),f=Se({inputs:{real:p,imag:m},backend:e});return e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(m),f}function r1(n,t,e){const s=nt(n.shape),i=e.data.get(n.dataId),o=e.data.get(i.complexTensorInfos.real.dataId).values,a=e.data.get(i.complexTensorInfos.imag.dataId).values;if(l1(s)){const r=no(o,a,s,t,e),l=[n.shape[0],n.shape[1]];if(t){const c=e.makeTensorInfo(l,"float32",r.real),u=e.makeTensorInfo(l,"float32",r.imag),d=e.makeTensorInfo([],"float32",gc(s,"float32")),h=yn({inputs:{x:d},backend:e}),p=eo.kernelFunc({inputs:{a:c,b:d},backend:e}),m=eo.kernelFunc({inputs:{a:u,b:h},backend:e}),f=e.data.get(p.dataId).values,g=e.data.get(m.dataId).values;return e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(u),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(m),{real:f,imag:g}}return r}else{const r=pi(o,a),l=c1(r,s,t);return am(l)}}function l1(n){return(n&n-1)===0}function no(n,t,e,s,i){if(e===1)return{real:n,imag:t};const o=pi(n,t),a=e/2,r=rm(o),l=r.real,c=r.imag,u=[l.length],d=i.makeTensorInfo(u,"float32",l),h=i.makeTensorInfo(u,"float32",c),p=Se({inputs:{real:d,imag:h},backend:i}),m=lm(o),f=m.real,g=m.imag,w=[f.length],b=i.makeTensorInfo(w,"float32",f),I=i.makeTensorInfo(w,"float32",g),y=Se({inputs:{real:b,imag:I},backend:i}),k=no(l,c,a,s,i),x=k.real,N=k.imag,v=[x.length],C=i.makeTensorInfo(v,"float32",x),T=i.makeTensorInfo(v,"float32",N),R=Se({inputs:{real:C,imag:T},backend:i}),_=no(f,g,a,s,i),M=_.real,O=_.imag,z=[M.length],E=i.makeTensorInfo(z,"float32",M),L=i.makeTensorInfo(z,"float32",O),$=Se({inputs:{real:E,imag:L},backend:i}),P=cm(e,s),H=[P.real.length],W=i.makeTensorInfo(H,"float32",P.real),U=i.makeTensorInfo(H,"float32",P.imag),G=Se({inputs:{real:W,imag:U},backend:i}),q=ia({inputs:{a:G,b:$},backend:i}),j=as({inputs:{a:R,b:q},backend:i}),K=bc({inputs:{a:R,b:q},backend:i}),Z=rs({inputs:{input:j},backend:i}),et=rs({inputs:{input:K},backend:i}),tt=On({inputs:{input:j},backend:i}),ot=On({inputs:{input:K},backend:i}),at=Ln({inputs:[Z,et],backend:i,attrs:{axis:0}}),ft=Ln({inputs:[tt,ot],backend:i,attrs:{axis:0}}),yt=i.data.get(at.dataId).values,At=i.data.get(ft.dataId).values;return i.disposeIntermediateTensorInfo(d),i.disposeIntermediateTensorInfo(h),i.disposeIntermediateTensorInfo(p),i.disposeIntermediateTensorInfo(b),i.disposeIntermediateTensorInfo(I),i.disposeIntermediateTensorInfo(y),i.disposeIntermediateTensorInfo(C),i.disposeIntermediateTensorInfo(T),i.disposeIntermediateTensorInfo(R),i.disposeIntermediateTensorInfo(E),i.disposeIntermediateTensorInfo(L),i.disposeIntermediateTensorInfo($),i.disposeIntermediateTensorInfo(W),i.disposeIntermediateTensorInfo(U),i.disposeIntermediateTensorInfo(G),i.disposeIntermediateTensorInfo(q),i.disposeIntermediateTensorInfo(j),i.disposeIntermediateTensorInfo(K),i.disposeIntermediateTensorInfo(Z),i.disposeIntermediateTensorInfo(tt),i.disposeIntermediateTensorInfo(et),i.disposeIntermediateTensorInfo(ot),i.disposeIntermediateTensorInfo(at),i.disposeIntermediateTensorInfo(ft),{real:yt,imag:At}}function c1(n,t,e){const s=new Float32Array(t*2);for(let i=0;i<t;i++){let o=0,a=0;for(let r=0;r<t;r++){const l=hm(i*r,t,e),c=mc(n,r);o+=c.real*l.real-c.imag*l.imag,a+=c.real*l.imag+c.imag*l.real}e&&(o/=t,a/=t),um(s,o,a,i)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u1(n){const{inputs:t,backend:e}=n,{input:s}=t,i=nt(s.shape),o=s.shape[s.shape.length-1],a=i/o,r=It({inputs:{x:s},backend:e,attrs:{shape:[a,o]}}),l=Xh(r,!1,e),c=It({inputs:{x:l},backend:e,attrs:{shape:s.shape}});return e.disposeIntermediateTensorInfo(r),e.disposeIntermediateTensorInfo(l),c}const h1={kernelName:dm,backendName:"cpu",kernelFunc:u1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ra(n){const{backend:t,attrs:e}=n,{shape:s,value:i,dtype:o}=e,a=o||fm(i),r=ea(a,nt(s));return p1(r,i,a),t.makeTensorInfo(s,a,r)}const d1={kernelName:pm,backendName:"cpu",kernelFunc:Ra};function p1(n,t,e){n.fill(t)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f1={kernelName:mm,backendName:"cpu",kernelFunc:({inputs:n,attrs:t,backend:e})=>{const{image:s}=n,i=e,o=Qe(s.dtype,nt(s.shape)),[a,r,l,c]=s.shape,u=i.data.get(s.dataId).values;for(let h=0;h<a;h++){const p=h*l*r*c;for(let m=0;m<r;m++){const f=m*(l*c);for(let g=0;g<l;g++){const w=g*c;for(let b=0;b<c;b++){const I=Math.round(l-g-1),y=p+f+w+b;let k=u[y];if(I>=0&&I<l){const x=I*c,N=p+f+x+b;k=u[N]}o[y]=k}}}}return{dataId:i.write(o,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m1(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,filter:o,bias:a,preluActivationWeights:r}=t,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:h,activation:p,leakyreluAlpha:m}=s;let f=Kh({inputs:{x:i,filter:o},backend:e,attrs:{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:h}});if(a){const g=f;if(u==="NCHW"&&a.shape.length===1&&a.shape[0]!==1){const w=It({inputs:{x:a},backend:e,attrs:{shape:[a.shape[0],1,1]}});f=as({inputs:{a:f,b:w},backend:e}),e.disposeIntermediateTensorInfo(w)}else f=as({inputs:{a:f,b:a},backend:e});e.disposeIntermediateTensorInfo(g)}if(p){const g=f;if(u==="NCHW"&&p==="prelu"&&r.shape.length===1&&r.shape[0]!==1){const w=It({inputs:{x:r},backend:e,attrs:{shape:[r.shape[0],1,1]}});f=ni(e,f,p,w,m),e.disposeIntermediateTensorInfo(w)}else f=ni(e,f,p,r,m);e.disposeIntermediateTensorInfo(g)}return f}const g1={kernelName:gm,backendName:"cpu",kernelFunc:m1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b1(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,filter:o,bias:a,preluActivationWeights:r}=t,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:h,activation:p,leakyreluAlpha:m}=s;let f=Yh({inputs:{x:i,filter:o},backend:e,attrs:{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:h}});if(a){const g=f;f=as({inputs:{a:f,b:a},backend:e}),e.disposeIntermediateTensorInfo(g)}if(p){const g=f;f=ni(e,f,p,r,m),e.disposeIntermediateTensorInfo(g)}return f}const y1={kernelName:bm,backendName:"cpu",kernelFunc:b1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w1(n){const{inputs:t,backend:e}=n,{params:s,indices:i}=t,o=nt(s.shape),a=i.shape,r=a[a.length-1],[l,c,u,d]=wm(s,i);if(c===0)return e.makeTensorInfo(l,s.dtype,[]);const h=e.data.get(i.dataId).values,p=e.bufferSync(s),m=Im(h,p,s.dtype,c,r,u,d,s.shape,o);return e.makeTensorInfo(l,s.dtype,m.values)}const I1={kernelName:ym,backendName:"cpu",kernelFunc:w1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k1(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,indices:o}=t,{axis:a,batchDims:r}=s;Q([i,o],"gatherV2");const l=Ot(a,i.shape)[0],c=e.data.get(o.dataId).values,u=i.shape[l];for(let y=0;y<c.length;++y){const k=c[y];Y(k<=u-1&&k>=0,()=>`GatherV2: the index value ${k} is not in [0, ${u-1}]`)}let d=r;r==null&&(d=0);const h=nt(o.shape),p=km(i,o,l,d),m=It({inputs:{x:i},backend:e,attrs:{shape:[p.batchSize,p.outerSize,p.dimSize,p.sliceSize]}}),f=It({inputs:{x:o},backend:e,attrs:{shape:[p.batchSize,h/p.batchSize]}}),g=[p.batchSize,p.outerSize,h/p.batchSize,p.sliceSize],w=e.bufferSync(f),b=e.bufferSync(m),I=xm(b,w,g);return e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(f),e.makeTensorInfo(p.outputShape,I.dtype,I.values)}const x1={kernelName:al,backendName:"cpu",kernelFunc:k1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S1(n){const{inputs:t,backend:e}=n,{input:s}=t,i=nt(s.shape),o=s.shape[s.shape.length-1],a=i/o,r=It({inputs:{x:s},backend:e,attrs:{shape:[a,o]}}),l=Xh(r,!0,e),c=It({inputs:{x:l},backend:e,attrs:{shape:s.shape}});return e.disposeIntermediateTensorInfo(r),e.disposeIntermediateTensorInfo(l),c}const N1={kernelName:Sm,backendName:"cpu",kernelFunc:S1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v1=bt(yo,n=>Number.isFinite(n)?1:0,"bool"),C1={kernelName:yo,backendName:"cpu",kernelFunc:v1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T1=bt(wo,n=>Math.abs(n)===1/0?1:0,"bool"),D1={kernelName:wo,backendName:"cpu",kernelFunc:T1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A1=bt(Io,n=>Number.isNaN(n)?1:0,"bool"),F1={kernelName:Io,backendName:"cpu",kernelFunc:A1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R1(n){const{backend:t,attrs:e}=n,{start:s,stop:i,num:o}=e,a=vm(s,i,o);return t.makeTensorInfo([a.length],"float32",a)}const M1={kernelName:Nm,backendName:"cpu",kernelFunc:R1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z1=bt(ko,n=>Math.log1p(n)),E1={kernelName:ko,backendName:"cpu",kernelFunc:z1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $1=bn((n,t)=>n&&t),O1=Un(yc,$1,null,"bool"),L1={kernelName:yc,backendName:"cpu",kernelFunc:O1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _1=bt(wc,n=>n?0:1,"bool"),P1={kernelName:wc,backendName:"cpu",kernelFunc:_1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B1=bn((n,t)=>n||t),V1=Un(Ic,B1,null,"bool"),W1={kernelName:Ic,backendName:"cpu",kernelFunc:V1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H1(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{depthRadius:o,bias:a,alpha:r,beta:l}=s;Q(i,"LRN");const c=i.shape[3],u=c-1,d=e.data.get(i.dataId).values,h=nt(i.shape),p=new Float32Array(h);function m(f){const g=f%c;let w=f-g+Math.max(0,g-o);const b=f-g+Math.min(g+o,u);let I=0;for(;w<=b;w++){const y=d[w];I+=y*y}return I}for(let f=0;f<h;f++){const g=m(f),w=d[f]*Math.pow(a+r*g,-l);p[f]=w}return e.makeTensorInfo(i.shape,i.dtype,p)}const G1={kernelName:ul,backendName:"cpu",kernelFunc:H1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U1(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,y:o,dy:a}=t,{depthRadius:r,bias:l,alpha:c,beta:u}=s;Q(a,"LRNGrad");const d=nt(a.shape),h=a.shape[3],p=e.data.get(a.dataId).values,m=e.data.get(i.dataId).values,f=e.data.get(o.dataId).values,g=new Float32Array(d),w=d;for(let b=0;b<w;b++){const I=b%h,y=b-I+Math.max(0,I-r),k=b-I+Math.min(h,I+r+1);let x=0;for(let N=y;N<k;N++)x+=Math.pow(m[N],2);x=c*x+l;for(let N=y;N<k;N++){let v=-2*c*u*m[N]*f[b]/x;b===N&&(v+=Math.pow(x,-u)),v*=p[b],g[N]+=v}}return e.makeTensorInfo(a.shape,i.dtype,g)}const j1={kernelName:cl,backendName:"cpu",kernelFunc:U1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jh(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{reductionIndices:o,keepDims:a}=s,r=e;let l=i.shape;const c=l.length,u=Ot(o,l);let d=u;const h=be(d,c);let p=r.data.get(i.dataId).values;if(h!=null){const y=new Array(c);for(let k=0;k<y.length;k++)y[k]=l[h[k]];p=Cm(p,l,i.dtype,h,y),d=He(d.length,c),l=y}Q(i,"max"),wn("max",d,c);const[m,f]=We(l,d),g=nt(f),w=Tm(p,g,m,i.dtype),b=r.write(w,m,i.dtype);let I=m;return a&&(I=Je(m,u)),{dataId:b,shape:I,dtype:i.dtype}}const q1={kernelName:hl,backendName:"cpu",kernelFunc:Jh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K1(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t;Q(i,"maxPool");const{filterSize:o,strides:a,pad:r,dimRoundingMode:l}=s,c=1;Y(ci(a,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${a} and dilations '${c}'`);const u=gs(i.shape,o,a,c,r,l);let d;if(u.filterWidth===1&&u.filterHeight===1&&Jt(u.inShape,u.outShape))d=yn({inputs:{x:i},backend:e});else{const h=e.data.get(i.dataId).values,p=ct(i.shape),m=Aa(h,i.shape,i.dtype,p,u,"max");d=e.makeTensorInfo(u.outShape,i.dtype,m.values)}return d}const Y1={kernelName:gl,backendName:"cpu",kernelFunc:K1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X1(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{filterSize:o,strides:a,pad:r,dimRoundingMode:l,dataFormat:c}=s;Q(i,"maxPool3d");const u=fi(i.shape,o,a,1,r,l,c),d=e.data.get(i.dataId).values,h=qh(d,i.shape,i.dtype,ct(i.shape),u,"max");return e.makeTensorInfo(h.shape,"float32",h.values)}const J1={kernelName:fl,backendName:"cpu",kernelFunc:X1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z1(n){const{inputs:t,backend:e,attrs:s}=n,{dy:i,input:o}=t,{filterSize:a,strides:r,pad:l,dimRoundingMode:c}=s;Q([i,o],"maxPool3DGrad");const u=fi(o.shape,a,r,1,l,c),d=e.bufferSync(o),h=B0(d,u),p=u.strideDepth,m=u.strideHeight,f=u.strideWidth,g=u.dilationDepth,w=u.dilationHeight,b=u.dilationWidth,I=u.effectiveFilterDepth,y=u.effectiveFilterHeight,k=u.effectiveFilterWidth,x=I-1-u.padInfo.front,N=k-1-u.padInfo.left,v=y-1-u.padInfo.top,C=Bt(o.shape,"float32"),T=e.bufferSync(i);for(let R=0;R<u.batchSize;++R)for(let _=0;_<u.inChannels;++_)for(let M=0;M<u.inDepth;++M)for(let O=0;O<u.inHeight;++O)for(let z=0;z<u.inWidth;++z){const E=M-x,L=O-v,$=z-N;let P=0;for(let H=0;H<I;H+=g){const W=(E+H)/p;if(!(W<0||W>=u.outDepth||Math.floor(W)!==W))for(let U=0;U<y;U+=w){const G=(L+U)/m;if(!(G<0||G>=u.outHeight||Math.floor(G)!==G))for(let q=0;q<k;q+=b){const j=($+q)/f;if(j<0||j>=u.outWidth||Math.floor(j)!==j)continue;const K=I*y*k-1-h.get(R,W,G,j,_),Z=H*y*k+U*k+q,et=K===Z?1:0;if(et===0)continue;const tt=T.get(R,W,G,j,_);P+=tt*et}}}C.set(P,R,M,O,z,_)}return e.makeTensorInfo(C.shape,C.dtype,C.values)}const Q1={kernelName:pl,backendName:"cpu",kernelFunc:Z1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tx(n){const{inputs:t,backend:e,attrs:s}=n,{dy:i,input:o,output:a}=t,r=o;Q([o,a],"maxPoolGrad");const{filterSize:l,strides:c,pad:u,dimRoundingMode:d}=s,h=gs(r.shape,l,c,1,u,d),p=e.data.get(r.dataId).values,m=Bt(h.outShape,r.dtype,jh(p,r.shape,r.dtype,h).values),f=h.strideHeight,g=h.strideWidth,w=h.dilationHeight,b=h.dilationWidth,I=h.effectiveFilterHeight,y=h.effectiveFilterWidth,k=y-1-h.padInfo.left,x=I-1-h.padInfo.top,N=Bt(r.shape,"float32"),v=e.data.get(i.dataId).values,C=Bt(i.shape,"float32",v);for(let T=0;T<h.batchSize;++T)for(let R=0;R<h.inChannels;++R)for(let _=0;_<h.inHeight;++_)for(let M=0;M<h.inWidth;++M){const O=_-x,z=M-k;let E=0;for(let L=0;L<I;L+=w){const $=(O+L)/f;if(!($<0||$>=h.outHeight||Math.floor($)!==$))for(let P=0;P<y;P+=b){const H=(z+P)/g;if(H<0||H>=h.outWidth||Math.floor(H)!==H)continue;const W=I*y-1-m.get(T,$,H,R),U=L*y+P,G=W===U?1:0;if(G===0)continue;const q=C.get(T,$,H,R);E+=q*G}}N.set(E,T,_,M,R)}return e.makeTensorInfo(N.shape,N.dtype,N.values)}const ex={kernelName:ml,backendName:"cpu",kernelFunc:tx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nx(n,t,e,s,i){const o=ct(t),a=Aa(n,t,e,o,i,"max"),r=jh(n,t,e,i,!0,s);return[a.values,r.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sx={kernelName:Dm,backendName:"cpu",kernelFunc:({inputs:n,attrs:t,backend:e})=>{const{x:s}=n,{filterSize:i,strides:o,pad:a,includeBatchInIndex:r}=t,l=e;Q(s,"MaxPoolWithArgmax");const c=l.data.get(s.dataId).values,u=gs(s.shape,i,o,[1,1],a),[d,h]=nx(c,s.shape,s.dtype,r,u),p=l.write(d,u.outShape,s.dtype),m=l.write(h,u.outShape,s.dtype);return[{dataId:p,shape:u.outShape,dtype:s.dtype},{dataId:m,shape:u.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ix(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{axis:o,keepDims:a}=s,r=Ot(o,i.shape),c=We(i.shape,r)[1],u=nt(c),d=[],h=e.makeTensorInfo([],"float32",new Float32Array([u]));d.push(h);const p=sa({inputs:{x:i},backend:e,attrs:{dtype:"float32"}});d.push(p);const m=Fa({inputs:{a:p,b:h},backend:e});d.push(m);const f=vs({inputs:{x:m},backend:e,attrs:{axis:o,keepDims:a}});return d.forEach(g=>e.disposeIntermediateTensorInfo(g)),f}const ox={kernelName:bl,backendName:"cpu",kernelFunc:ix};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ax(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{axis:o,keepDims:a}=s;Q(i,"min");const r=Ot(o,i.shape);let l=r;const c=be(l,i.shape.length);let u=i;c!=null&&(u=Zt({inputs:{x:i},backend:e,attrs:{perm:c}}),l=He(l.length,i.shape.length)),wn("min",l,u.shape.length);const[d,h]=We(u.shape,l),p=nt(h),m=an(nt(d),u.dtype),f=e.data.get(u.dataId).values;for(let w=0;w<m.length;++w){const b=w*p;let I=f[b];for(let y=0;y<p;++y){const k=f[b+y];(Number.isNaN(k)||k<I)&&(I=k)}m[w]=I}c!=null&&e.disposeIntermediateTensorInfo(u);const g=e.makeTensorInfo(d,u.dtype,m);if(a){const w=Je(d,r),b=It({inputs:{x:g},backend:e,attrs:{shape:w}});return e.disposeIntermediateTensorInfo(g),b}return g}const rx={kernelName:yl,backendName:"cpu",kernelFunc:ax};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lx(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{paddings:o,mode:a}=s;Q(i,"mirrorPad");const r=o.map((I,y)=>I[0]+i.shape[y]+I[1]),l=o.map(I=>I[0]),c=o.map((I,y)=>I[0]+i.shape[y]),u=a==="reflect"?0:1,d=e.data.get(i.dataId).values,h=i.shape.length,p=ct(i.shape),m=nt(r),f=r.length,g=ct(r),w=Qe(i.dtype,m);for(let I=0;I<m;I++){let y=kc(I,f,g);for(let x=0;x<f;x++)y[x]<l[x]?y[x]=l[x]*2-y[x]-u:y[x]>=c[x]&&(y[x]=(c[x]-1)*2-y[x]+u);y=y.map((x,N)=>x-l[N]);const k=ns(y,h,p);w[I]=d[k]}return{dataId:e.write(w,r,i.dtype),shape:r,dtype:i.dtype}}const cx={kernelName:wl,backendName:"cpu",kernelFunc:lx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ux=bn((n,t)=>{const e=n%t;return n<0&&t<0||n>=0&&t>=0?e:(e+t)%t}),hx=Un(xo,ux),dx={kernelName:xo,backendName:"cpu",kernelFunc:hx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zh(n){const{inputs:t,backend:e,attrs:s}=n,{logits:i}=t,{dim:o}=s,a=i.shape.length;let r=o;if(r===-1&&(r=a-1),r!==a-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${a} and dim was ${r}`);const l=Ot([r],i.shape),c=Jh({inputs:{x:i},backend:e,attrs:{reductionIndices:l,keepDims:!1}}),u=Je(c.shape,l),d=It({inputs:{x:c},backend:e,attrs:{shape:u}}),h=bc({inputs:{a:i,b:d},backend:e}),p=Am({inputs:{x:h},backend:e}),m=vs({inputs:{x:p},backend:e,attrs:{axis:l,keepDims:!1}}),f=It({inputs:{x:m},backend:e,attrs:{shape:u}}),g=Fa({inputs:{a:p,b:f},backend:e});return e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(f),g}const px={kernelName:Ol,backendName:"cpu",kernelFunc:Zh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fx(n){const{inputs:t,backend:e,attrs:s}=n,{logits:i}=t,{numSamples:o,seed:a,normalized:r}=s;Q(i,"multinomial");const l=r?i:Zh({inputs:{logits:i},backend:e,attrs:{dim:-1}}),c=l.shape[0],u=l.shape[1],d=e.data.get(l.dataId).values,h=[c,o],p=an(nt(h),"int32");for(let m=0;m<c;++m){const f=m*u,g=new Float32Array(u-1);g[0]=d[f];for(let I=1;I<g.length;++I)g[I]=g[I-1]+d[f+I];const w=Rm.alea(a.toString()),b=m*o;for(let I=0;I<o;++I){const y=w();p[b+I]=g.length;for(let k=0;k<g.length;k++)if(y<g[k]){p[b+I]=k;break}}}return r||e.disposeIntermediateTensorInfo(l),e.makeTensorInfo(h,"int32",p)}const mx={kernelName:Fm,backendName:"cpu",kernelFunc:fx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gx=zm;function bx(n){const{inputs:t,backend:e,attrs:s}=n,{boxes:i,scores:o}=t,{maxOutputSize:a,iouThreshold:r,scoreThreshold:l}=s;Q(i,"NonMaxSuppression");const c=e.data.get(i.dataId).values,u=e.data.get(o.dataId).values,{selectedIndices:d}=gx(c,u,a,r,l);return e.makeTensorInfo([d.length],"int32",new Int32Array(d))}const yx={kernelName:Mm,backendName:"cpu",kernelFunc:bx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wx=$m;function Ix(n){const{inputs:t,backend:e,attrs:s}=n,{boxes:i,scores:o}=t,{maxOutputSize:a,iouThreshold:r,scoreThreshold:l,padToMaxOutputSize:c}=s;Q(i,"NonMaxSuppressionPadded");const u=e.data.get(i.dataId).values,d=e.data.get(o.dataId).values,{selectedIndices:h,validOutputs:p}=wx(u,d,a,r,l,c);return[e.makeTensorInfo([h.length],"int32",new Int32Array(h)),e.makeTensorInfo([],"int32",new Int32Array([p]))]}const kx={kernelName:Em,backendName:"cpu",kernelFunc:Ix};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xx=Lm;function Sx(n){const{inputs:t,backend:e,attrs:s}=n,{boxes:i,scores:o}=t,{maxOutputSize:a,iouThreshold:r,scoreThreshold:l,softNmsSigma:c}=s;Q(i,"NonMaxSuppressionWithScore");const u=e.data.get(i.dataId).values,d=e.data.get(o.dataId).values,h=a,p=r,m=l,f=c,{selectedIndices:g,selectedScores:w}=xx(u,d,h,p,m,f);return[e.makeTensorInfo([g.length],"int32",new Int32Array(g)),e.makeTensorInfo([w.length],"float32",new Float32Array(w))]}const Nx={kernelName:Om,backendName:"cpu",kernelFunc:Sx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vx(n){const{inputs:t,backend:e,attrs:s}=n,{indices:i}=t,{dtype:o,depth:a,onValue:r,offValue:l}=s;Q(i,"oneHot");const c=nt(i.shape),u=new Float32Array(c*a);u.fill(l);const d=e.data.get(i.dataId).values;for(let h=0;h<c;++h)d[h]>=0&&d[h]<a&&(u[h*a+d[h]]=r);return e.makeTensorInfo([...i.shape,a],o,u)}const Cx={kernelName:Il,backendName:"cpu",kernelFunc:vx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ii(n){const{inputs:t,backend:e}=n,{x:s}=t;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const i=rs({inputs:{input:s},backend:e}),o=ii({inputs:{x:i},backend:e}),a=On({inputs:{input:s},backend:e}),r=ii({inputs:{x:a},backend:e}),l=Se({inputs:{real:o,imag:r},backend:e});return e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(r),l}else return Ra({backend:e,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const Tx={kernelName:Ul,backendName:"cpu",kernelFunc:ii};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qh(n){const{inputs:t,backend:e}=n,{x:s}=t;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const i=rs({inputs:{input:s},backend:e}),o=Qh({inputs:{x:i},backend:e}),a=On({inputs:{input:s},backend:e}),r=ii({inputs:{x:a},backend:e}),l=Se({inputs:{real:o,imag:r},backend:e});return e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(r),l}else return Ra({backend:e,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const Dx={kernelName:kl,backendName:"cpu",kernelFunc:Qh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function td(n){const{inputs:t,backend:e,attrs:s}=n,{axis:i}=s;if(t.length===1)return si({inputs:{input:t[0]},backend:e,attrs:{dim:i}});const o=t[0].shape,a=t[0].dtype;t.forEach(u=>{_m(o,u.shape,"All tensors passed to stack must have matching shapes"),Y(a===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});const r=[],l=t.map(u=>{const d=si({inputs:{input:u},backend:e,attrs:{dim:i}});return r.push(d),d}),c=Ln({inputs:l,backend:e,attrs:{axis:i}});return r.forEach(u=>e.disposeIntermediateTensorInfo(u)),c}const Ax={kernelName:xl,backendName:"cpu",kernelFunc:td};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fx(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{paddings:o,constantValue:a}=s;Q(i,"pad");const r=o.map((b,I)=>b[0]+i.shape[I]+b[1]),l=o.map(b=>b[0]),c=e.data.get(i.dataId).values,u=nt(i.shape),d=i.shape.length,h=ct(i.shape),p=nt(r),m=r.length,f=ct(r),g=Qe(i.dtype,p);a!==0&&g.fill(a);for(let b=0;b<u;b++){const y=kc(b,d,h).map((x,N)=>x+l[N]),k=ns(y,m,f);g[k]=c[b]}return{dataId:e.write(g,r,i.dtype),shape:r,dtype:i.dtype}}const ed={kernelName:Sl,backendName:"cpu",kernelFunc:Fx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rx=bn((n,t)=>Math.pow(n,t)),Mx=Un(No,Rx),zx={kernelName:No,backendName:"cpu",kernelFunc:Mx};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ex(n){const{inputs:t,backend:e,attrs:s}=n,{paramsNestedSplits:i,paramsDenseValues:o,indices:a}=t,r=i.map(g=>e.data.get(g.dataId).values),l=i.map(g=>g.shape),c=e.data.get(o.dataId).values,u=e.data.get(a.dataId).values,[d,h,p]=Bm(r,l,c,o.shape,o.dtype,u,a.shape),m=d.map(g=>e.makeTensorInfo([g.length],"int32",g)),f=e.makeTensorInfo(p,o.dtype,h);return m.concat([f])}const $x={kernelName:Pm,backendName:"cpu",kernelFunc:Ex};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ox(n){const{inputs:t,backend:e}=n,{starts:s,limits:i,deltas:o}=t,a=e.data.get(s.dataId).values,r=e.data.get(i.dataId).values,l=e.data.get(o.dataId).values,[c,u]=Wm(a,s.shape,s.dtype,r,i.shape,l,o.shape),d=e.makeTensorInfo([c.length],"int32",c),h=e.makeTensorInfo([u.length],s.dtype,u);return[d,h]}const Lx={kernelName:Vm,backendName:"cpu",kernelFunc:Ox};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _x(n){const{inputs:t,backend:e,attrs:s}=n,{shape:i,values:o,defaultValue:a,rowPartitionTensors:r}=t,{rowPartitionTypes:l}=s,c=e.data.get(i.dataId).values,u=e.data.get(o.dataId).values,d=e.data.get(a.dataId).values,h=r.map(g=>e.data.get(g.dataId).values),p=r.map(g=>g.shape),[m,f]=Gm(c,i.shape,u,o.shape,o.dtype,d,a.shape,h,p,l);return e.makeTensorInfo(m,o.dtype,f)}const Px={kernelName:Hm,backendName:"cpu",kernelFunc:_x};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bx(n){const{backend:t,attrs:e}=n,{start:s,stop:i,dtype:o,step:a}=e,r=jm(s,i,a,o);return t.makeTensorInfo([r.length],o,r)}const Vx={kernelName:Um,backendName:"cpu",kernelFunc:Bx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wx=bt(To,n=>1/n),Hx={kernelName:To,backendName:"cpu",kernelFunc:Wx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gx(n){const{inputs:t,backend:e,attrs:s}=n,{images:i}=t,{alignCorners:o,halfPixelCenters:a,size:r}=s;Q(i,"resizeBilinear");const l=ct(i.shape),[c,u]=r,[d,h,p,m]=i.shape,f=e.data.get(i.dataId).values,g=new Float32Array(nt([d,c,u,m])),w=[o&&c>1?h-1:h,o&&u>1?p-1:p],b=[o&&c>1?c-1:c,o&&u>1?u-1:u];let I=0;const y=w[0]/b[0],k=w[1]/b[1];for(let x=0;x<d;x++)for(let N=0;N<c;N++){let v;a?v=y*(N+.5)-.5:v=y*N;const C=Math.max(0,Math.floor(v)),T=v-C,R=Math.min(h-1,Math.ceil(v)),_=x*l[0]+C*l[1],M=x*l[0]+R*l[1];for(let O=0;O<u;O++){let z;a?z=k*(O+.5)-.5:z=k*O;const E=Math.max(0,Math.floor(z)),L=z-E,$=Math.min(p-1,Math.ceil(z)),P=_+E*l[2],H=M+E*l[2],W=_+$*l[2],U=M+$*l[2];for(let G=0;G<m;G++){const q=f[P+G],j=f[H+G],K=f[W+G],Z=f[U+G],et=q+(K-q)*L,tt=j+(Z-j)*L,ot=et+(tt-et)*T;g[I++]=ot}}}return e.makeTensorInfo([d,c,u,m],"float32",g)}const Ux={kernelName:Cl,backendName:"cpu",kernelFunc:Gx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jx(n){const{inputs:t,backend:e,attrs:s}=n,{images:i,dy:o}=t,{alignCorners:a}=s;Q([o,i],"resizeBilinearGrad");const r=ct(i.shape),[l,c,u,d]=i.shape,[,h,p]=o.shape,m=new Float32Array(l*c*u*d),f=[a&&h>1?c-1:c,a&&p>1?u-1:u],g=[a&&h>1?h-1:h,a&&p>1?p-1:p],w=f[0]/g[0],b=f[1]/g[1],I=e.data.get(o.dataId).values;let y=0;for(let k=0;k<l;k++){const x=k*r[0];for(let N=0;N<h;N++){const v=N*w,C=Math.floor(v),T=Math.min(Math.ceil(v),c-1),R=x+C*r[1],_=x+T*r[1],M=v-C,O=1-M;for(let z=0;z<p;z++){const E=z*b,L=Math.floor(E),$=Math.min(Math.ceil(E),u-1),P=E-L,H=1-P,W=R+L*r[2],U=R+$*r[2],G=_+L*r[2],q=_+$*r[2],j=O*H,K=O*P,Z=M*H,et=M*P;for(let tt=0;tt<d;tt++){const ot=I[y++];m[W+tt]+=ot*j,m[U+tt]+=ot*K,m[G+tt]+=ot*Z,m[q+tt]+=ot*et}}}}return e.makeTensorInfo([l,u,c,d],"float32",m)}const qx={kernelName:Tl,backendName:"cpu",kernelFunc:jx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kx(n){const{inputs:t,backend:e,attrs:s}=n,{images:i}=t,{alignCorners:o,halfPixelCenters:a,size:r}=s;Q(i,"resizeNearestNeighbor");const l=ct(i.shape),[c,u]=r,[d,h,p,m]=i.shape,f=e.data.get(i.dataId).values,g=new Float32Array(d*c*u*m),w=[o&&c>1?h-1:h,o&&u>1?p-1:p],b=[o&&c>1?c-1:c,o&&u>1?u-1:u],I=w[0]/b[0],y=w[1]/b[1];let k=0;for(let x=0;x<d;x++){const N=x*l[0];for(let v=0;v<c;v++){const C=a?I*(v+.5):I*v;let T=Math.min(h-1,o?Math.round(C):Math.floor(C));a&&(T=Math.max(0,T));const R=N+T*l[1];for(let _=0;_<u;_++){const M=a?y*(_+.5):y*_;let O=Math.min(p-1,o?Math.round(M):Math.floor(M));a&&(O=Math.max(0,O));const z=R+O*l[2];for(let E=0;E<m;E++){const L=f[z+E];g[k++]=L}}}}return e.makeTensorInfo([d,c,u,m],i.dtype,g)}const Yx={kernelName:Dl,backendName:"cpu",kernelFunc:Kx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xx(n){const{inputs:t,backend:e,attrs:s}=n,{images:i,dy:o}=t,{alignCorners:a}=s;Q([o,i],"resizeNearestNeighborGrad");const r=ct(i.shape),l=ct(o.shape),[c,u,d,h]=i.shape,[,p,m]=o.shape,f=new Float32Array(c*u*d*h),g=e.data.get(o.dataId).values,w=[a&&p>1?u-1:u,a&&m>1?d-1:d],b=[a&&p>1?p-1:p,a&&m>1?m-1:m],I=w[0]/b[0],y=w[1]/b[1],k=1/I,x=1/y,N=Math.ceil(k)*2+2,v=Math.ceil(x)*2+2;for(let C=0;C<c;C++){const T=C*r[0];for(let R=0;R<u;R++){const _=T+R*r[1],M=Math.floor(R*k),O=Math.floor(M-N/2);for(let z=0;z<d;z++){const E=_+z*r[2],L=Math.floor(z*x),$=Math.floor(L-v/2);for(let P=0;P<h;P++){let H=0;for(let W=0;W<N;W++){const U=W+O;if(U<0||U>=p)continue;const G=T+U*l[1],q=U*I,j=Math.min(u-1,a?Math.round(q):Math.floor(q));if(R===j)for(let K=0;K<v;K++){const Z=K+$;if(Z<0||Z>=m)continue;const et=G+Z*l[2],tt=Z*y,ot=Math.min(d-1,a?Math.round(tt):Math.floor(tt));z===ot&&(H+=g[et+P])}}f[E+P]=H}}}}return e.makeTensorInfo(i.shape,i.dtype,f)}const Jx={kernelName:Al,backendName:"cpu",kernelFunc:Xx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zx(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{dims:o}=s;Q(i,"reverse");const a=i.shape.length,r=Ot(o,i.shape);if(a===0)return yn({inputs:{x:i},backend:e});const l=new jt(i.shape,i.dtype),c=e.bufferSync(i);for(let u=0;u<l.size;u++){const d=l.indexToLoc(u),h=d.slice();r.forEach(p=>h[p]=i.shape[p]-1-h[p]),l.set(c.get(...h),...d)}return e.makeTensorInfo(l.shape,l.dtype,l.values)}const Qx={kernelName:Fl,backendName:"cpu",kernelFunc:Zx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tS={kernelName:qm,backendName:"cpu",kernelFunc:({inputs:n,attrs:t,backend:e})=>{const{image:s}=n,{radians:i,fillValue:o,center:a}=t,r=e,l=Qe(s.dtype,nt(s.shape)),[c,u,d,h]=s.shape,[p,m]=Km(a,u,d),f=255,g=Math.sin(i),w=Math.cos(i),b=r.data.get(s.dataId).values;for(let y=0;y<c;y++){const k=y*d*u*h;for(let x=0;x<u;x++){const N=x*(d*h);for(let v=0;v<d;v++){const C=v*h;for(let T=0;T<h;T++){const R=[c,x,v,T],_=R[2],M=R[1];let O=(_-p)*w-(M-m)*g,z=(_-p)*g+(M-m)*w;O=Math.round(O+p),z=Math.round(z+m);let E=o;if(typeof o!="number"&&(T===3?E=f:E=o[T]),O>=0&&O<d&&z>=0&&z<u){const $=z*(d*h),P=O*h,H=k+$+P+T;E=b[H]}const L=k+N+C+T;l[L]=E}}}}return{dataId:r.write(l,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eS=bt(Fo,n=>{const t=Math.floor(n);return n-t<.5?Math.floor(n):n-t>.5?Math.ceil(n):t%2===0?t:t+1}),nS={kernelName:Fo,backendName:"cpu",kernelFunc:eS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sS(n){const{inputs:t,backend:e,attrs:s}=n,{indices:i,updates:o}=t,{shape:a}=s,{sliceRank:r,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=oa(o,i,a),h=!0,p=e.bufferSync(i),m=e.bufferSync(o),f=Tn(p,m,a,d,c,l,r,u,0,h);return e.makeTensorInfo(a,f.dtype,f.values)}const iS={kernelName:Ym,backendName:"cpu",kernelFunc:sS};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oS(n,t){let e=0,s=n.length,i=0;for(;e<s;)i=Math.floor((e+s)/2),n[i]<t?e=i+1:s=i;return s}function aS(n,t){let e=0,s=n.length,i=0;for(;e<s;)i=Math.floor((e+s)/2),n[i]<=t?e=i+1:s=i;return s}function rS(n,t,e,s,i,o){const a=ea("int32",e*i);for(let r=0;r<e;++r){const l=n.slice(r*s,(r+1)*s),c=r*i;for(let u=0;u<i;++u)a[c+u]=o==="left"?oS(l,t[u+c]):aS(l,t[u+c])}return a}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lS(n){const{inputs:t,backend:e,attrs:s}=n,{sortedSequence:i,values:o}=t,{side:a}=s,r=e.data.get(i.dataId).values,l=e.data.get(o.dataId).values,c=rS(r,l,i.shape[0],i.shape[1],o.shape[1],a);return e.makeTensorInfo(o.shape,"int32",c)}const cS={kernelName:Xm,backendName:"cpu",kernelFunc:lS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uS(n){const{inputs:t,backend:e}=n,{condition:s,t:i,e:o}=t;Q([s,i,o],"select");const a=s.shape.length,r=e.data.get(s.dataId).values,l=e.data.get(i.dataId).values,c=e.data.get(o.dataId).values,u=mi(i.dtype,o.dtype),d=an(nt(i.shape),u);let h=0;const p=a===0||a>1||i.shape.length===1?1:nt(i.shape.slice(1));for(let m=0;m<r.length;m++)for(let f=0;f<p;f++)r[m]===1?d[h++]=l[m]:d[h++]=c[m];return e.makeTensorInfo(i.shape,u,d)}const hS={kernelName:Rl,backendName:"cpu",kernelFunc:uS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dS=zl,pS=El,fS=bt(Ro,n=>n>=0?pS*n:dS*(Math.exp(n)-1)),mS={kernelName:Ro,backendName:"cpu",kernelFunc:fS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gS=bt(Mo,n=>n<0?-1:n>0?1:0),bS={kernelName:Mo,backendName:"cpu",kernelFunc:gS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yS=bt(zo,n=>Math.sin(n)),wS={kernelName:zo,backendName:"cpu",kernelFunc:yS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IS=bt($o,n=>Math.sinh(n)),kS={kernelName:$o,backendName:"cpu",kernelFunc:IS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xS=11920928955078125e-23,mr=Math.log(xS)+2,SS=bt(Lo,n=>{const t=n>-mr,e=n<mr,s=Math.exp(n);let i;return e?i=s:t?i=n:i=Math.log(1+s),i}),NS={kernelName:Lo,backendName:"cpu",kernelFunc:SS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vS(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{blockShape:o,paddings:a}=s;Q([i],"spaceToBatchND");const r=nt(o),l=[[0,0]];l.push(...a);for(let x=1+o.length;x<i.shape.length;++x)l.push([0,0]);const c=ed.kernelFunc({inputs:{x:i},backend:e,attrs:{paddings:l,constantValue:0}}),u=uc(c.shape,o,r,!1),d=hc(u.length,o.length,!1),h=dc(c.shape,o,r,!1),f=It({inputs:{x:c},backend:e,attrs:{shape:u}}),b=Zt({inputs:{x:f},backend:e,attrs:{perm:d}}),k=It({inputs:{x:b},backend:e,attrs:{shape:h}});return e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(b),k}const CS={kernelName:Ll,backendName:"cpu",kernelFunc:vS};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TS(n){const{inputs:t,backend:e}=n,{indices:s,values:i,denseShape:o,defaultValue:a}=t;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${o.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(i.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${i.shape}`);if(a.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${a.shape}`);const r=e.data.get(s.dataId).values,l=e.data.get(i.dataId).values,c=e.data.get(o.dataId).values,u=e.data.get(a.dataId).values[0],[d,h,p,m,f]=Zm(r,s.shape,s.dtype,l,i.dtype,c,u);return[e.makeTensorInfo(h,s.dtype,d),e.makeTensorInfo([h[0]],i.dtype,p),e.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(g=>Number(g)))),e.makeTensorInfo([f.length],s.dtype,new Int32Array(f))]}const DS={kernelName:Jm,backendName:"cpu",kernelFunc:TS};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AS(n){const{inputs:t,backend:e}=n,{inputIndices:s,inputShape:i,newShape:o}=t;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(i.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${i.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const a=Array.from(e.data.get(i.dataId).values),r=e.data.get(s.dataId).values,l=Array.from(e.data.get(o.dataId).values),[c,u,d]=tg(r,s.shape,s.dtype,a,l);return[e.makeTensorInfo(u,s.dtype,c),e.makeTensorInfo([d.length],o.dtype,new Int32Array(d))]}const FS={kernelName:Qm,backendName:"cpu",kernelFunc:AS};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RS(n){const{inputs:t,backend:e}=n,{data:s,indices:i,segmentIds:o}=t;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${i.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${o.shape}`);if(i.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const a=e.data.get(s.dataId).values,r=e.data.get(i.dataId).values,l=e.data.get(o.dataId).values,[c,u]=xc(a,s.shape,s.dtype,r,l,!0);return e.makeTensorInfo(u,s.dtype,c)}const MS={kernelName:eg,backendName:"cpu",kernelFunc:RS};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zS(n){const{inputs:t,backend:e}=n,{data:s,indices:i,segmentIds:o}=t;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${i.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${o.shape}`);if(i.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const a=e.data.get(s.dataId).values,r=e.data.get(i.dataId).values,l=e.data.get(o.dataId).values,[c,u]=xc(a,s.shape,s.dtype,r,l);return e.makeTensorInfo(u,s.dtype,c)}const ES={kernelName:ng,backendName:"cpu",kernelFunc:zS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $S(n){const{inputs:t,backend:e,attrs:s}=n,{sparseIndices:i,sparseValues:o,defaultValue:a}=t,{outputShape:r}=s,{sliceRank:l,numUpdates:c,sliceSize:u,strides:d,outputSize:h}=oa(o,i,r),p=!1,m=e.bufferSync(i);let f;switch(o.dtype){case"bool":{const g=e.bufferSync(o),w=!!e.data.get(a.dataId).values[0];f=Tn(m,g,r,h,u,c,l,d,w,p);break}case"float32":{const g=e.bufferSync(o),w=e.data.get(a.dataId).values[0];f=Tn(m,g,r,h,u,c,l,d,w,p);break}case"int32":{const g=e.bufferSync(o),w=e.data.get(a.dataId).values[0];f=Tn(m,g,r,h,u,c,l,d,w,p);break}case"string":{const g=e.bufferSync(o),w=cc(e.data.get(a.dataId).values[0]);f=Tn(m,g,r,h,u,c,l,d,w,p);break}default:throw new Error(`Unsupported type ${o.dtype}`)}return e.makeTensorInfo(r,f.dtype,f.values)}const OS={kernelName:sg,backendName:"cpu",kernelFunc:$S};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LS(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{numOrSizeSplits:o,axis:a}=s,r=Ot(a,i.shape)[0],l=ig(i,o,r),c=new Array(i.shape.length).fill(0),u=i.shape.slice();return l.map(d=>{const h=[...u];h[r]=d;const p=En({inputs:{x:i},backend:e,attrs:{begin:c,size:h}});return c[r]+=d,p})}const _S={kernelName:Pl,backendName:"cpu",kernelFunc:LS};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PS={kernelName:Bl,backendName:"cpu",kernelFunc:({inputs:n,backend:t})=>{const{x:e}=n,s=t;Q(e,"square");const i=s.data.get(e.dataId).values,o=new Float32Array(i.length);for(let r=0;r<i.length;++r){const l=i[r];o[r]=l*l}return{dataId:s.write(o,e.shape,e.dtype),shape:e.shape,dtype:e.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BS=bt(_o,(n,t)=>{const e=t;return isNaN(n)?NaN:n>0?1:e.alpha}),VS={kernelName:_o,backendName:"cpu",kernelFunc:BS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WS(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{begin:o,end:a,strides:r,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:d,shrinkAxisMask:h}=s;Q(i,"stridedSlice");const{finalShapeSparse:p,finalShape:m,isIdentity:f,sliceDim0:g,isSimpleSlice:w,begin:b,end:I,strides:y}=ag(i.shape,o,a,r,l,c,u,d,h);let k;if(f)k=It({inputs:{x:i},backend:e,attrs:{shape:m}});else if(g||w){Y(i.shape.length>=1,()=>`Input must have rank at least 1, got: ${i.shape.length}`);const x=rg(b,I,y),N=En({inputs:{x:i},backend:e,attrs:{begin:b,size:x}});k=It({inputs:{x:N},backend:e,attrs:{shape:m}}),e.disposeIntermediateTensorInfo(N)}else{const x=e.bufferSync(i),N=lg(p,x,y,b);k=e.makeTensorInfo(m,N.dtype,N.values)}return k}const HS={kernelName:og,backendName:"cpu",kernelFunc:WS};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GS(n){const{inputs:t,backend:e,attrs:s}=n,{separator:i,nGramWidths:o,leftPad:a,rightPad:r,padWidth:l,preserveShortSequences:c}=s,{data:u,dataSplits:d}=t,h=e.data.get(u.dataId).values,p=e.data.get(d.dataId).values,[m,f]=ug(h,p,i,o,a,r,l,c);return[e.makeTensorInfo([m.length],"string",m),e.makeTensorInfo(d.shape,"int32",f)]}const US={kernelName:cg,backendName:"cpu",kernelFunc:GS};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jS(n){const{inputs:t,backend:e,attrs:s}=n,{skipEmpty:i}=s,{input:o,delimiter:a}=t;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(a.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${a.shape}`);const r=e.data.get(o.dataId).values,l=e.data.get(a.dataId).values[0],[c,u,d]=dg(r,l,i),h=u.length;return[e.makeTensorInfo([h,2],"int32",c),e.makeTensorInfo([h],"string",u),e.makeTensorInfo([2],"int32",new Int32Array(d))]}const qS={kernelName:hg,backendName:"cpu",kernelFunc:jS};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KS(n){const{inputs:t,backend:e,attrs:s}=n,{numBuckets:i}=s,{input:o}=t;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(i<=0)throw new Error("Number of buckets must be at least 1");const a=e.data.get(o.dataId).values,r=fg(a,i);return e.makeTensorInfo(o.shape,"int32",r)}const YS={kernelName:pg,backendName:"cpu",kernelFunc:KS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XS=bt(Po,n=>Math.tan(n)),JS={kernelName:Po,backendName:"cpu",kernelFunc:XS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZS=bt(Bo,n=>Math.tanh(n)),QS={kernelName:Bo,backendName:"cpu",kernelFunc:ZS};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tN(n){const{inputs:t,backend:e}=n,{tensor:s,indices:i,updates:o}=t,{sliceRank:a,numUpdates:r,sliceSize:l,strides:c,outputSize:u}=oa(o,i,s.shape),d=!1,h=e.bufferSync(i),p=e.bufferSync(o),m=e.bufferSync(s),f=Tn(h,p,s.shape,u,l,r,a,c,m,d);return e.makeTensorInfo(s.shape,f.dtype,f.values)}const eN={kernelName:mg,backendName:"cpu",kernelFunc:tN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nN(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{reps:o}=s;Q(i,"tile");const a=gg(e.bufferSync(i),o);return e.makeTensorInfo(a.shape,a.dtype,a.values)}const sN={kernelName:Wl,backendName:"cpu",kernelFunc:nN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iN(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{k:o,sorted:a}=s;Q(i,"topk");const r=e.data.get(i.dataId).values,[l,c]=yg(r,i.shape,i.dtype,o,a);return[e.makeTensorInfo(l.shape,l.dtype,l.values),e.makeTensorInfo(c.shape,c.dtype,c.values)]}const oN={kernelName:bg,backendName:"cpu",kernelFunc:iN};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aN(n){const{inputs:t,attrs:e,backend:s}=n,{image:i,transforms:o}=t,{interpolation:a,fillMode:r,fillValue:l,outputShape:c}=e,[u,d,h,p]=i.shape,[m,f]=c??[d,h],g=[u,m,f,p],w=ct(i.shape),b=w[0],I=w[1],y=w[2],k=ct(g),x=k[0],N=k[1],v=k[2],C=Qe(i.dtype,nt(g));C.fill(l);const T=s.data.get(i.dataId).values,R=s.data.get(o.dataId).values;for(let M=0;M<u;++M){const O=o.shape[0]===1?R:R.subarray(M*8,M*8+8);for(let z=0;z<m;++z)for(let E=0;E<f;++E)for(let L=0;L<p;++L){let $;const P=O[6]*E+O[7]*z+1;if(P===0)continue;const H=(O[0]*E+O[1]*z+O[2])/P,W=(O[3]*E+O[4]*z+O[5])/P,U=gr(H,h,r),G=gr(W,d,r);switch(a){case"nearest":$=dN(T,d,h,b,I,y,M,G,U,L,l);break;case"bilinear":$=pN(T,d,h,b,I,y,M,G,U,L,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${a}`)}const q=M*x+z*N+E*v+L;C[q]=$}return s.makeTensorInfo(g,i.dtype,C)}return{dataId:s.write(C,g,i.dtype),shape:i.shape,dtype:i.dtype}}const rN={kernelName:wg,backendName:"cpu",kernelFunc:aN};function gr(n,t,e){switch(e){case"reflect":return lN(n,t);case"wrap":return cN(n,t);case"nearest":return hN(n,t);case"constant":default:return uN(n)}}function lN(n,t){let e=n;if(e<0)if(t<=1)e=0;else{const s=2*t;e<s&&(e=s*Math.trunc(-e/s)+e),e=e<-t?e+s:-e-1}else if(e>t-1)if(t<=1)e=0;else{const s=2*t;e-=s*Math.trunc(e/s),e>=t&&(e=s-e-1)}return aa(0,e,t-1)}function cN(n,t){let e=n;if(e<0)if(t<=1)e=0;else{const s=t-1;e+=t*(Math.trunc(-e/s)+1)}else if(e>t-1)if(t<=1)e=0;else{const s=t-1;e-=t*Math.trunc(e/s)}return aa(0,e,t-1)}function uN(n,t){return n}function hN(n,t){return aa(0,n,t-1)}function Qn(n,t,e,s,i,o,a,r,l,c,u){const d=a*s+r*i+l*o+c;return 0<=r&&r<t&&0<=l&&l<e?n[d]:u}function dN(n,t,e,s,i,o,a,r,l,c,u){const d=Math.round(r),h=Math.round(l);return Qn(n,t,e,s,i,o,a,d,h,c,u)}function pN(n,t,e,s,i,o,a,r,l,c,u){const d=Math.floor(r),h=Math.floor(l),p=d+1,m=h+1,f=(m-l)*Qn(n,t,e,s,i,o,a,d,h,c,u)+(l-h)*Qn(n,t,e,s,i,o,a,d,m,c,u),g=(m-l)*Qn(n,t,e,s,i,o,a,p,h,c,u)+(l-h)*Qn(n,t,e,s,i,o,a,p,m,c,u);return(p-r)*f+(r-d)*g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fN(n){const{inputs:t,attrs:e,backend:s}=n,{axis:i}=e,{x:o}=t;Q(o,"unique");const a=s.data.get(o.dataId).values,{outputValues:r,outputShape:l,indices:c}=kg(a,i,o.shape,o.dtype);return[s.makeTensorInfo(l,o.dtype,r),s.makeTensorInfo([c.length],"int32",c)]}const mN={kernelName:Ig,backendName:"cpu",kernelFunc:fN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gN(n){const{inputs:t,backend:e,attrs:s}=n,{value:i}=t;let{axis:o}=s;o<0&&(o+=i.shape.length);const a=i.shape.length,r=i.shape[o],l=new Array(a-1);let c=0;for(let p=0;p<a;p++)p!==o&&(l[c++]=i.shape[p]);const u=new Array(a).fill(0),d=i.shape.slice();d[o]=1;const h=new Array(r);for(let p=0;p<h.length;p++){u[o]=p;const m=En({inputs:{x:i},backend:e,attrs:{begin:u,size:d}});h[p]=It({inputs:{x:m},backend:e,attrs:{shape:l}}),e.disposeIntermediateTensorInfo(m)}return h}const bN={kernelName:Hl,backendName:"cpu",kernelFunc:gN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yN(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,segmentIds:o}=t,{numSegments:a}=s;Q(i,"unsortedSegmentSum");const r=i.shape.length,l=o.shape.length,c=[],u=[],d=r-l;let h=o;for(let m=0;m<d;++m){const f=si({inputs:{input:h},backend:e,attrs:{dim:m+1}});h=f,u.push(f)}for(let m=0;m<a;++m){const f=gc(m,"int32"),g=e.makeTensorInfo([],"int32",f),w=xg({inputs:{a:g,b:h},backend:e}),b=sa({inputs:{x:w},backend:e,attrs:{dtype:"float32"}}),I=ia({inputs:{a:b,b:i},backend:e}),y=vs({inputs:{x:I},backend:e,attrs:{axis:0,keepDims:!1}});c.push(y),u.push(g),u.push(w),u.push(b),u.push(I),u.push(y)}const p=td({inputs:c,backend:e,attrs:{axis:0}});return u.forEach(m=>e.disposeIntermediateTensorInfo(m)),p}const wN={kernelName:Gl,backendName:"cpu",kernelFunc:yN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IN=[f0,Ng,g0,y0,vg,I0,x0,N0,C0,D0,F0,M0,E0,L0,P0,W0,G0,j0,K0,d0,X0,Z0,tk,Cg,nk,Tg,Dg,ik,Ag,ak,lk,ck,hk,pk,mk,bk,wk,kk,Sk,vk,Tk,Ak,Rk,zk,Ek,Ok,_k,Bk,Vk,Wk,Hk,Uk,Kk,o0,Xk,Fg,i1,Rg,o1,Mg,h1,d1,f1,zg,Eg,g1,y1,I1,x1,$g,Og,Lg,N1,rk,C1,D1,F1,a0,_g,Pg,M1,Bg,E1,L1,P1,W1,G1,j1,q1,Vg,Y1,J1,Q1,ex,sx,ox,rx,Wg,cx,dx,mx,Hg,Gg,yx,kx,Nx,Ug,Cx,Dx,Ax,ed,zx,l0,jg,$x,Lx,Px,Vx,qg,eo,Hx,c0,u0,h0,Ux,qx,Yx,Jx,Qx,tS,nS,Kg,iS,cS,hS,mS,Yg,bS,wS,kS,Xg,px,NS,CS,DS,FS,MS,ES,OS,_S,Jg,PS,Zg,Qg,VS,HS,US,qS,YS,tb,jk,JS,QS,eN,sN,oN,rN,eb,mN,bN,wN,Tx];for(const n of IN)Sg(n);/**
    * @license
    * Copyright 2021 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */var nd=function(n,t){return(nd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,s){e.__proto__=s}||function(e,s){for(var i in s)s.hasOwnProperty(i)&&(e[i]=s[i])})(n,t)};function sd(n,t){function e(){this.constructor=n}nd(n,t),n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var $e=function(){return($e=Object.assign||function(n){for(var t,e=1,s=arguments.length;e<s;e++)for(var i in t=arguments[e])Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i]);return n}).apply(this,arguments)};function Ce(n,t,e,s){return new(e||(e=Promise))(function(i,o){function a(c){try{l(s.next(c))}catch(u){o(u)}}function r(c){try{l(s.throw(c))}catch(u){o(u)}}function l(c){var u;c.done?i(c.value):(u=c.value,u instanceof e?u:new e(function(d){d(u)})).then(a,r)}l((s=s.apply(n,t||[])).next())})}function Te(n,t){var e,s,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:r(0),throw:r(1),return:r(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function r(l){return function(c){return function(u){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,s&&(i=2&u[0]?s.return:u[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,u[1])).done)return i;switch(s=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,s=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){a=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){a.label=u[1];break}if(u[0]===6&&a.label<i[1]){a.label=i[1],i=u;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(u);break}i[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(n,a)}catch(d){u=[6,d],s=0}finally{e=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([l,c])}}}function id(n){var t=n.shape[2],e=Mn(n,2),s=V(e,[-1]);return Go(s,t)}function kN(n,t){return A(n,t)}function Rs(n,t){return D(function(){return X(ye(n,Nt(t)),"int32")})}function xN(n,t){var e=t.shape,s=e[0],i=e[1],o=e[2];return D(function(){var a=id(t),r=oe(Jo(0,o,1,"int32"),1),l=X(ne(a,r),"int32"),c=V(l,[s,i]),u=J(c,Nt(1,"int32"));return pt(kN(u,n),Nt(1,"int32"))})}function SN(n){var t=n.shape,e=t[0],s=t[1],i=t[2];return D(function(){var o=id(n),a=oe(Jo(0,i,1,"int32"),1),r=X(ne(o,a),"int32");return V(r,[e,s])})}var od=function(){function n(t,e){this.model=t,this.outputStride=e;var s=this.model.inputs[0].shape;Y(s[1]===-1&&s[2]===-1,function(){return"Input shape ["+s[1]+", "+s[2]+"] must both be equal to or -1"})}return n.prototype.predict=function(t){var e=this;return D(function(){var s=e.preprocessInput(X(t,"float32")),i=oe(s,0),o=e.model.predict(i).map(function(r){return Ne(r,[0])}),a=e.nameOutputResults(o);return{heatmapScores:Hn(a.heatmap),offsets:a.offsets,displacementFwd:a.displacementFwd,displacementBwd:a.displacementBwd,segmentation:a.segmentation,partHeatmaps:a.partHeatmaps,longOffsets:a.longOffsets,partOffsets:a.partOffsets}})},n.prototype.dispose=function(){this.model.dispose()},n}(),NN=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return sd(t,n),t.prototype.preprocessInput=function(e){return D(function(){return pt(ut(e,127.5),1)})},t.prototype.nameOutputResults=function(e){return{offsets:e[0],segmentation:e[1],partHeatmaps:e[2],longOffsets:e[3],heatmap:e[4],displacementFwd:e[5],displacementBwd:e[6],partOffsets:e[7]}},t}(od),Ti=["nose","leftEye","rightEye","leftEar","rightEar","leftShoulder","rightShoulder","leftElbow","rightElbow","leftWrist","rightWrist","leftHip","rightHip","leftKnee","rightKnee","leftAnkle","rightAnkle"],he=Ti.length,oi=Ti.reduce(function(n,t,e){return n[t]=e,n},{}),vN=[["leftHip","leftShoulder"],["leftElbow","leftShoulder"],["leftElbow","leftWrist"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["rightHip","rightShoulder"],["rightElbow","rightShoulder"],["rightElbow","rightWrist"],["rightHip","rightKnee"],["rightKnee","rightAnkle"],["leftShoulder","rightShoulder"],["leftHip","rightHip"]],CN=[["nose","leftEye"],["leftEye","leftEar"],["nose","rightEye"],["rightEye","rightEar"],["nose","leftShoulder"],["leftShoulder","leftElbow"],["leftElbow","leftWrist"],["leftShoulder","leftHip"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["nose","rightShoulder"],["rightShoulder","rightElbow"],["rightElbow","rightWrist"],["rightShoulder","rightHip"],["rightHip","rightKnee"],["rightKnee","rightAnkle"]];vN.map(function(n){var t=n[0],e=n[1];return[oi[t],oi[e]]});function Ma(n,t,e){var s=n[0],i=n[1],o=t[0],a=t[1],r=e.top,l=e.bottom;return[a/(e.left+e.right+i),o/(r+l+s)]}function ad(n,t,e,s){return{y:s.get(n,t,e),x:s.get(n,t,e+he)}}function rd(n,t,e){var s=ad(n.heatmapY,n.heatmapX,n.id,e),i=s.y,o=s.x;return{x:n.heatmapX*t+o,y:n.heatmapY*t+i}}function br(n,t,e){return n<t?t:n>e?e:n}function TN(n,t,e,s){var i=e-n,o=s-t;return i*i+o*o}function yr(n,t){return{x:n.x+t.x,y:n.y+t.y}}function DN(n,t,e){e===void 0&&(e=.3);for(var s=0,i=0,o=0;o<n.length;o++)t.keypoints[o].score>e&&(i+=1,s+=Math.pow(n[o].x-t.keypoints[o].position.x,2)+Math.pow(n[o].y-t.keypoints[o].position.y,2));return i===0?s=1/0:s/=i,s}function AN(n,t,e,s){var i=t[0],o=t[1],a=e[0],r=e[1],l=Math.round(((i+n.y+1)*r-1)/s);return{x:Math.round(((o+n.x+1)*a-1)/s),y:l}}function FN(n,t,e,s,i,o,a){for(var r=a[0],l=a[1],c=e(n),u=c.y*s+c.x,d=i[he*(2*u)+t],h=i[he*(2*u+1)+t],p=n.y+d,m=n.x+h,f=0;f<o;f++){p=Math.min(p,r-1);var g=e({x:m=Math.min(m,l-1),y:p}),w=g.y*s+g.x;p+=d=i[he*(2*w)+t],m+=h=i[he*(2*w+1)+t]}return{x:m,y:p}}function ld(n,t,e,s,i,o,a,r,l,c){for(var u=i[0],d=i[1],h=o[0],p=o[1],m=r[0],f=r[1],g=[],w=function(v){return AN(v,[u,d],[h,p],l)},b=0;b<s;b++){var I=FN(n,b,w,a,t,c,[m,f]);g.push(I)}for(var y=-1,k=1/0,x=0;x<e.length;x++){var N=DN(g,e[x]);N<k&&(y=x,k=N)}return y}function cd(n,t){var e=n[0],s=n[1];return[Math.round((s-1)/t+1),Math.round((e-1)/t+1)]}function RN(n,t,e,s,i,o,a,r,l,c){var u=a[0],d=a[1];c===void 0&&(c=5);for(var h=e.map(function(N){return new Uint8Array(s*i).fill(0)}),p=r.top,m=r.left,f=Ma([s,i],[u,d],r),g=f[0],w=f[1],b=cd([u,d],o)[0],I=0;I<s;I+=1)for(var y=0;y<i;y+=1){var k=I*i+y;if(n[k]===1){var x=ld({x:y,y:I},t,e,c,[p,m],[g,w],b,[s,i],o,l);x>=0&&(h[x][k]=1)}}return h}function MN(n,t,e,s,i,o,a,r,l,c,u){var d=r[0],h=r[1];u===void 0&&(u=5);for(var p=s.map(function(v){return new Int32Array(i*o).fill(-1)}),m=l.top,f=l.left,g=Ma([i,o],[d,h],l),w=g[0],b=g[1],I=cd([d,h],a)[0],y=0;y<i;y+=1)for(var k=0;k<o;k+=1){var x=y*o+k;if(n[x]===1){var N=ld({x:k,y},t,s,u,[m,f],[w,b],I,[i,o],a,c);N>=0&&(p[N][x]=e[x])}}return p}function ud(n,t,e,s,i,o,a,r,l,c,u){for(var d=a[0],h=a[1],p=n.shape,m=p[0],f=p[1],g=t.shape.slice(0,2),w=g[0],b=g[1],I=V(t,[w,b,2,he]),y=new Float32Array(u*he*3).fill(0),k=0;k<e.length;k++)for(var x=k*he*3,N=e[k],v=0;v<he;v++){var C=N.keypoints[v],T=x+3*v;y[T]=C.score,y[T+1]=C.position.y,y[T+2]=C.position.x}var R=Ma([s,i],[d,h],r),_=R[0],M=R[1],O=lc(y,[u,he,3]),z=r.top,E=r.left,L={variableNames:["segmentation","longOffsets","poses"],outputShape:[m,f],userCode:`
    int convertToPositionInOutput(int pos, int pad, float scale, int stride) {
      return round(((float(pos + pad) + 1.0) * scale - 1.0) / float(stride));
    }

    float convertToPositionInOutputFloat(
        int pos, int pad, float scale, int stride) {
      return ((float(pos + pad) + 1.0) * scale - 1.0) / float(stride);
    }

    float dist(float x1, float y1, float x2, float y2) {
      return pow(x1 - x2, 2.0) + pow(y1 - y2, 2.0);
    }

    float sampleLongOffsets(float h, float w, int d, int k) {
      float fh = fract(h);
      float fw = fract(w);
      int clH = int(ceil(h));
      int clW = int(ceil(w));
      int flH = int(floor(h));
      int flW = int(floor(w));
      float o11 = getLongOffsets(flH, flW, d, k);
      float o12 = getLongOffsets(flH, clW, d, k);
      float o21 = getLongOffsets(clH, flW, d, k);
      float o22 = getLongOffsets(clH, clW, d, k);
      float o1 = mix(o11, o12, fw);
      float o2 = mix(o21, o22, fw);
      return mix(o1, o2, fh);
    }

    int findNearestPose(int h, int w) {
      float prob = getSegmentation(h, w);
      if (prob < 1.0) {
        return -1;
      }

      // Done(Tyler): convert from output space h/w to strided space.
      float stridedH = convertToPositionInOutputFloat(
        h, `+z+", "+M+", "+o+`);
      float stridedW = convertToPositionInOutputFloat(
        w, `+E+", "+_+", "+o+`);

      float minDist = 1000000.0;
      int iMin = -1;
      for (int i = 0; i < `+u+`; i++) {
        float curDistSum = 0.0;
        int numKpt = 0;
        for (int k = 0; k < `+he+`; k++) {
          float dy = sampleLongOffsets(stridedH, stridedW, 0, k);
          float dx = sampleLongOffsets(stridedH, stridedW, 1, k);

          float y = float(h) + dy;
          float x = float(w) + dx;

          for (int s = 0; s < `+l+`; s++) {
            int yRounded = round(min(y, float(`+(s-1)+`)));
            int xRounded = round(min(x, float(`+(i-1)+`)));

            float yStrided = convertToPositionInOutputFloat(
              yRounded, `+z+", "+M+", "+o+`);
            float xStrided = convertToPositionInOutputFloat(
              xRounded, `+E+", "+_+", "+o+`);

            float dy = sampleLongOffsets(yStrided, xStrided, 0, k);
            float dx = sampleLongOffsets(yStrided, xStrided, 1, k);

            y = y + dy;
            x = x + dx;
          }

          float poseScore = getPoses(i, k, 0);
          float poseY = getPoses(i, k, 1);
          float poseX = getPoses(i, k, 2);
          if (poseScore > `+c+`) {
            numKpt = numKpt + 1;
            curDistSum = curDistSum + dist(x, y, poseX, poseY);
          }
        }
        if (numKpt > 0 && curDistSum / float(numKpt) < minDist) {
          minDist = curDistSum / float(numKpt);
          iMin = i;
        }
      }
      return iMin;
    }

    void main() {
        ivec2 coords = getOutputCoords();
        int nearestPose = findNearestPose(coords[0], coords[1]);
        setOutput(float(nearestPose));
      }
  `};return oc().compileAndRun(L,[n,I,O])}function zN(n,t){return D(function(){return X(fe(n,Nt(t)),"int32")})}function EN(n,t,e){return D(function(){return pt(A(X(fe(n,Nt(e)),"int32"),J(t,1)),1)})}function hd(){return sb()==="webgl"}function $N(n,t,e,s,i,o,a,r,l,c,u,d){var h=a[0],p=a[1];return l===void 0&&(l=.2),c===void 0&&(c=8),u===void 0&&(u=.3),d===void 0&&(d=10),Ce(this,void 0,void 0,function(){var m,f,g,w,b;return Te(this,function(I){switch(I.label){case 0:return m=e.filter(function(y){return y.score>=l}),hd()?(g=D(function(){var y=ud(n,t,m,s,i,o,[h,p],r,c,u,d),k=js().makeTensorFromDataId(y.dataId,y.shape,y.dtype);return m.map(function(x,N){return zN(k,N)})}),[4,Promise.all(g.map(function(y){return y.data()}))]):[3,2];case 1:return f=I.sent(),g.forEach(function(y){return y.dispose()}),[3,5];case 2:return[4,n.data()];case 3:return w=I.sent(),[4,t.data()];case 4:b=I.sent(),f=RN(w,b,m,s,i,o,[h,p],r,c),I.label=5;case 5:return[2,f.map(function(y,k){return{data:y,pose:m[k],width:i,height:s}})]}})})}function ON(n,t,e,s,i,o,a,r,l,c,u,d,h){var p=r[0],m=r[1];return c===void 0&&(c=.2),u===void 0&&(u=8),d===void 0&&(d=.3),h===void 0&&(h=10),Ce(this,void 0,void 0,function(){var f,g,w,b,I,y;return Te(this,function(k){switch(k.label){case 0:return f=s.filter(function(x){return x.score>=c}),hd()?(w=D(function(){var x=ud(n,t,f,i,o,a,[p,m],l,u,d,h),N=js().makeTensorFromDataId(x.dataId,x.shape,x.dtype);return f.map(function(v,C){return EN(N,e,C)})}),[4,Promise.all(w.map(function(x){return x.data()}))]):[3,2];case 1:return g=k.sent(),w.forEach(function(x){return x.dispose()}),[3,6];case 2:return[4,n.data()];case 3:return b=k.sent(),[4,t.data()];case 4:return I=k.sent(),[4,e.data()];case 5:y=k.sent(),g=MN(b,I,y,f,i,o,a,[p,m],l,u),k.label=6;case 6:return[2,g.map(function(x,N){return{pose:f[N],data:x,height:i,width:o}})]}})})}function Li(n){return Math.floor(n/2)}var LN=function(){function n(t,e){this.priorityQueue=new Array(t),this.numberOfElements=-1,this.getElementValue=e}return n.prototype.enqueue=function(t){this.priorityQueue[++this.numberOfElements]=t,this.swim(this.numberOfElements)},n.prototype.dequeue=function(){var t=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,t},n.prototype.empty=function(){return this.numberOfElements===-1},n.prototype.size=function(){return this.numberOfElements+1},n.prototype.all=function(){return this.priorityQueue.slice(0,this.numberOfElements+1)},n.prototype.max=function(){return this.priorityQueue[0]},n.prototype.swim=function(t){for(;t>0&&this.less(Li(t),t);)this.exchange(t,Li(t)),t=Li(t)},n.prototype.sink=function(t){for(;2*t<=this.numberOfElements;){var e=2*t;if(e<this.numberOfElements&&this.less(e,e+1)&&e++,!this.less(t,e))break;this.exchange(t,e),t=e}},n.prototype.getValueAt=function(t){return this.getElementValue(this.priorityQueue[t])},n.prototype.less=function(t,e){return this.getValueAt(t)<this.getValueAt(e)},n.prototype.exchange=function(t,e){var s=this.priorityQueue[t];this.priorityQueue[t]=this.priorityQueue[e],this.priorityQueue[e]=s},n}();function _N(n,t,e,s,i,o){for(var a=o.shape,r=a[0],l=a[1],c=!0,u=Math.max(e-i,0),d=Math.min(e+i+1,r),h=u;h<d;++h){for(var p=Math.max(s-i,0),m=Math.min(s+i+1,l),f=p;f<m;++f)if(o.get(h,f,n)>t){c=!1;break}if(!c)break}return c}function PN(n,t,e){for(var s=e.shape,i=s[0],o=s[1],a=s[2],r=new LN(i*o*a,function(h){return h.score}),l=0;l<i;++l)for(var c=0;c<o;++c)for(var u=0;u<a;++u){var d=e.get(l,c,u);d<n||_N(u,d,l,c,t,e)&&r.enqueue({score:d,part:{heatmapY:l,heatmapX:c,id:u}})}return r}var dd=CN.map(function(n){var t=n[0],e=n[1];return[oi[t],oi[e]]}),_i=dd.map(function(n){return n[1]}),wr=dd.map(function(n){return n[0]});function BN(n,t,e){var s=e.shape[2]/2;return{y:e.get(t.y,t.x,n),x:e.get(t.y,t.x,s+n)}}function Pi(n,t,e,s){return{y:br(Math.round(n.y/t),0,e-1),x:br(Math.round(n.x/t),0,s-1)}}function Ir(n,t,e,s,i,o,a,r){r===void 0&&(r=2);for(var l=s.shape,c=l[0],u=l[1],d=BN(n,Pi(t.position,o,c,u),a),h=yr(t.position,d),p=0;p<r;p++){var m=Pi(h,o,c,u),f=ad(m.y,m.x,e,i);h=yr({x:m.x*o,y:m.y*o},{x:f.x,y:f.y})}var g=Pi(h,o,c,u),w=s.get(g.y,g.x,e);return{position:h,part:Ti[e],score:w}}function VN(n,t,e,s,i,o){var a=t.shape[2],r=_i.length,l=new Array(a),c=n.part,u=n.score,d=rd(c,s,e);l[c.id]={score:u,part:Ti[c.id],position:d};for(var h=r-1;h>=0;--h){var p=_i[h],m=wr[h];l[p]&&!l[m]&&(l[m]=Ir(h,l[p],m,t,e,s,o))}for(h=0;h<r;++h)p=wr[h],m=_i[h],l[p]&&!l[m]&&(l[m]=Ir(h,l[p],m,t,e,s,i));return l}function pd(n,t,e,s){var i=e.x,o=e.y;return n.some(function(a){var r=a.keypoints[s].position;return TN(o,i,r.y,r.x)<=t})}function WN(n,t,e){return e.reduce(function(s,i,o){var a=i.position,r=i.score;return pd(n,t,a,o)||(s+=r),s},0)/e.length}var HN=1;function Ms(n,t,e,s,i,o,a,r){a===void 0&&(a=.5),r===void 0&&(r=20);for(var l=[],c=PN(a,HN,n),u=r*r;l.length<o&&!c.empty();){var d=c.dequeue();if(!pd(l,u,rd(d.part,i,t),d.part.id)){var h=VN(d,n,t,i,e,s),p=WN(l,u,h);l.push({keypoints:h,score:p})}}return l}var Jn,GN=[-123.15,-115.9,-103.06],UN=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return sd(t,n),t.prototype.preprocessInput=function(e){return J(e,GN)},t.prototype.nameOutputResults=function(e){var s=e[0],i=e[1],o=e[2],a=e[3],r=e[4],l=e[5];return{offsets:r,segmentation:e[6],partHeatmaps:l,longOffsets:a,heatmap:o,displacementFwd:i,displacementBwd:s,partOffsets:e[7]}},t}(od),kr="https://storage.googleapis.com/tfjs-models/savedmodel/bodypix/resnet50/",xr="https://storage.googleapis.com/tfjs-models/savedmodel/bodypix/mobilenet/";function jN(n,t){var e="model-stride"+n+".json";return t===4?kr+"float/"+e:kr+"quant"+t+"/"+e}function qN(n,t,e){var s={1:"100",.75:"075",.5:"050"},i="model-stride"+n+".json";return e===4?xr+"float/"+s[t]+"/"+i:xr+"quant"+e+"/"+s[t]+"/"+i}function KN(n){if("offsetHeight"in n&&n.offsetHeight!==0&&"offsetWidth"in n&&n.offsetWidth!==0)return[n.offsetHeight,n.offsetWidth];if(n.height!=null&&n.width!=null)return[n.height,n.width];throw new Error("HTMLImageElement must have height and width attributes set.")}function YN(n){return n.hasAttribute("height")&&n.hasAttribute("width")?[n.height,n.width]:[n.videoHeight,n.videoWidth]}function ts(n){if(typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas||typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)return KN(n);if(typeof ImageData<"u"&&n instanceof ImageData)return[n.height,n.width];if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)return YN(n);if(n instanceof Re)return[n.shape[0],n.shape[1]];throw new Error("error: Unknown input type: "+n+".")}function XN(n,t){return(n-1)%t==0}function Sr(n,t){return XN(n,t)?n:Math.floor(n/t)*t+1}var es={low:"low",medium:"medium",high:"high",full:"full"},JN=((Jn={})[es.low]=.25,Jn[es.medium]=.5,Jn[es.high]=.75,Jn[es.full]=1,Jn),Nr=.1,vr=2;function ZN(n){if(typeof n=="string"){var t=JN[n];return Y(typeof t=="number",function(){return"string value of inputResolution must be one of "+Object.values(es).join(",")+" but was "+n+"."}),t}return Y(typeof n=="number"&&n<=vr&&n>=Nr,function(){return"inputResolution must be a string or number between "+Nr+" and "+vr+", but was "+n}),n}function zs(n,t,e){var s=e[0],i=e[1],o=ZN(n);return[Sr(s*o,t),Sr(i*o,t)]}function QN(n){return n instanceof Re?n:ib(n)}function Nn(n,t,e,s,i){var o=t[0],a=t[1],r=e[0],l=e[1],c=s[0],u=c[0],d=c[1],h=s[1],p=h[0],m=h[1];return i===void 0&&(i=!1),D(function(){var f=se.resizeBilinear(n,[r,l],!0);return i&&(f=Hn(f)),tv(f,[o,a],[[u,d],[p,m]])})}function tv(n,t,e){var s=t[0],i=t[1],o=e[0],a=o[0],r=o[1],l=e[1],c=l[0],u=l[1];return D(function(){var d=oe(n);return Ne(se.cropAndResize(d,[[a/(s+a+r-1),c/(i+c+u-1),(a+s-1)/(s+a+r-1),(c+i-1)/(i+c+u-1)]],[0],[s,i]),[0])})}function Es(n,t){var e=t[0],s=t[1],i=ts(n),o=i[0],a=i[1],r=s/e,l=[0,0,0,0],c=l[0],u=l[1],d=l[2],h=l[3];return a/o<r?(c=0,u=0,d=Math.round(.5*(r*o-a)),h=Math.round(.5*(r*o-a))):(c=Math.round(.5*(1/r*a-o)),u=Math.round(.5*(1/r*a-o)),d=0,h=0),{resized:D(function(){var p=QN(n);return p=nb(p,[[c,u],[d,h],[0,0]]),se.resizeBilinear(p,[e,s])}),padding:{top:c,left:d,right:h,bottom:u}}}function $s(n){return Ce(this,void 0,void 0,function(){return Te(this,function(t){return[2,Promise.all(n.map(function(e){return e.buffer()}))]})})}function ev(n,t,e,s,i){return s===void 0&&(s=0),i===void 0&&(i=0),{score:n.score,keypoints:n.keypoints.map(function(o){var a=o.score,r=o.part,l=o.position;return{score:a,part:r,position:{x:l.x*e+i,y:l.y*t+s}}})}}function nv(n,t,e,s,i){return s===void 0&&(s=0),i===void 0&&(i=0),e===1&&t===1&&s===0&&i===0?n:n.map(function(o){return ev(o,t,e,s,i)})}function sv(n,t){return{score:n.score,keypoints:n.keypoints.map(function(e){var s=e.score,i=e.part,o=e.position;return{score:s,part:i,position:{x:t-1-o.x,y:o.y}}})}}function iv(n,t){return t<=0?n:n.map(function(e){return sv(e,t)})}function Os(n,t,e,s,i){var o=t[0],a=t[1],r=e[0],l=e[1],c=nv(n,(o+s.top+s.bottom)/r,(a+s.left+s.right)/l,-s.top,-s.left);return i?iv(c,a):c}var vn=!0,Ls=!1,fd={architecture:"MobileNetV1",outputStride:16,quantBytes:4,multiplier:.75},Cr=["MobileNetV1","ResNet50"],Tr={MobileNetV1:[8,16,32],ResNet50:[32,16]},Dr={MobileNetV1:[.5,.75,1],ResNet50:[1]},Ar=[1,2,4];function ov(n){if((n=n||fd).architecture==null&&(n.architecture="MobileNetV1"),Cr.indexOf(n.architecture)<0)throw new Error("Invalid architecture "+n.architecture+". Should be one of "+Cr);if(n.outputStride==null&&(n.outputStride=16),Tr[n.architecture].indexOf(n.outputStride)<0)throw new Error("Invalid outputStride "+n.outputStride+". Should be one of "+Tr[n.architecture]+" for architecture "+n.architecture+".");if(n.multiplier==null&&(n.multiplier=1),Dr[n.architecture].indexOf(n.multiplier)<0)throw new Error("Invalid multiplier "+n.multiplier+". Should be one of "+Dr[n.architecture]+" for architecture "+n.architecture+".");if(n.quantBytes==null&&(n.quantBytes=4),Ar.indexOf(n.quantBytes)<0)throw new Error("Invalid quantBytes "+n.quantBytes+". Should be one of "+Ar+" for architecture "+n.architecture+".");return n}var _s={flipHorizontal:!1,internalResolution:"medium",segmentationThreshold:.7,maxDetections:10,scoreThreshold:.4,nmsRadius:20},Ps={flipHorizontal:!1,internalResolution:"medium",segmentationThreshold:.7,maxDetections:10,scoreThreshold:.4,nmsRadius:20,minKeypointScore:.3,refineSteps:10};function Fr(n){var t=n.segmentationThreshold,e=n.maxDetections,s=n.scoreThreshold,i=n.nmsRadius;if(t<0||t>1)throw new Error("segmentationThreshold "+t+". Should be in range [0.0, 1.0]");if(e<=0)throw new Error("Invalid maxDetections "+e+". Should be > 0");if(s<0||s>1)throw new Error("Invalid scoreThreshold "+s+". Should be in range [0.0, 1.0]");if(i<=0)throw new Error("Invalid nmsRadius "+i+".")}function Rr(n){var t=n.segmentationThreshold,e=n.maxDetections,s=n.scoreThreshold,i=n.nmsRadius,o=n.minKeypointScore,a=n.refineSteps;if(t<0||t>1)throw new Error("segmentationThreshold "+t+". Should be in range [0.0, 1.0]");if(e<=0)throw new Error("Invalid maxDetections "+e+". Should be > 0");if(s<0||s>1)throw new Error("Invalid scoreThreshold "+s+". Should be in range [0.0, 1.0]");if(i<=0)throw new Error("Invalid nmsRadius "+i+".");if(o<0||o>1)throw new Error("Invalid minKeypointScore "+o+".Should be in range [0.0, 1.0]");if(a<=0||a>20)throw new Error("Invalid refineSteps "+a+".Should be in range [1, 20]")}var md=function(){function n(t){this.baseModel=t}return n.prototype.predictForPersonSegmentation=function(t){var e=this.baseModel.predict(t);return{segmentLogits:e.segmentation,heatmapScores:e.heatmapScores,offsets:e.offsets,displacementFwd:e.displacementFwd,displacementBwd:e.displacementBwd}},n.prototype.predictForPersonSegmentationAndPart=function(t){var e=this.baseModel.predict(t);return{segmentLogits:e.segmentation,partHeatmapLogits:e.partHeatmaps,heatmapScores:e.heatmapScores,offsets:e.offsets,displacementFwd:e.displacementFwd,displacementBwd:e.displacementBwd}},n.prototype.predictForMultiPersonInstanceSegmentationAndPart=function(t){var e=this.baseModel.predict(t);return{segmentLogits:e.segmentation,longOffsets:e.longOffsets,heatmapScores:e.heatmapScores,offsets:e.offsets,displacementFwd:e.displacementFwd,displacementBwd:e.displacementBwd,partHeatmaps:e.partHeatmaps}},n.prototype.segmentPersonActivation=function(t,e,s){var i=this;s===void 0&&(s=.5);var o=ts(t),a=o[0],r=o[1],l=zs(e,this.baseModel.outputStride,[a,r]),c=Es(t,l),u=c.resized,d=c.padding,h=D(function(){var b=i.predictForPersonSegmentation(u),I=b.segmentLogits,y=b.heatmapScores,k=b.offsets,x=b.displacementFwd,N=b.displacementBwd,v=u.shape,C=v[0],T=v[1],R=Nn(I,[a,r],[C,T],[[d.top,d.bottom],[d.left,d.right]],vn);return{segmentation:Rs(Ne(R),s),heatmapScores:y,offsets:k,displacementFwd:x,displacementBwd:N}}),p=h.segmentation,m=h.heatmapScores,f=h.offsets,g=h.displacementFwd,w=h.displacementBwd;return u.dispose(),{segmentation:p,heatmapScores:m,offsets:f,displacementFwd:g,displacementBwd:w,padding:d,internalResolutionHeightAndWidth:l}},n.prototype.segmentPerson=function(t,e){return e===void 0&&(e=_s),Ce(this,void 0,void 0,function(){var s,i,o,a,r,l,c,u,d,h,p,m,f,g,w,b,I,y;return Te(this,function(k){switch(k.label){case 0:return Fr(e=$e($e({},_s),e)),s=this.segmentPersonActivation(t,e.internalResolution,e.segmentationThreshold),i=s.segmentation,o=s.heatmapScores,a=s.offsets,r=s.displacementFwd,l=s.displacementBwd,c=s.padding,u=s.internalResolutionHeightAndWidth,d=i.shape,h=d[0],p=d[1],[4,i.data()];case 1:return m=k.sent(),i.dispose(),[4,$s([o,a,r,l])];case 2:return f=k.sent(),g=f[0],w=f[1],b=f[2],I=f[3],y=Os(y=Ms(g,w,b,I,this.baseModel.outputStride,e.maxDetections,e.scoreThreshold,e.nmsRadius),[h,p],u,c,Ls),o.dispose(),a.dispose(),r.dispose(),l.dispose(),[2,{height:h,width:p,data:m,allPoses:y}]}})})},n.prototype.segmentMultiPerson=function(t,e){return e===void 0&&(e=Ps),Ce(this,void 0,void 0,function(){var s,i,o,a,r,l,c,u,d,h,p,m,f,g,w,b,I,y,k,x,N,v=this;return Te(this,function(C){switch(C.label){case 0:return Rr(e=$e($e({},Ps),e)),s=ts(t),i=s[0],o=s[1],a=zs(e.internalResolution,this.baseModel.outputStride,[i,o]),r=Es(t,a),l=r.resized,c=r.padding,u=D(function(){var T,R=v.predictForMultiPersonInstanceSegmentationAndPart(l),_=R.segmentLogits,M=R.longOffsets,O=R.heatmapScores,z=R.offsets,E=R.displacementFwd,L=R.displacementBwd,$=Nn(_,[i,o],a,[[c.top,c.bottom],[c.left,c.right]],vn);return T=M,{segmentation:Rs(Ne($),e.segmentationThreshold),longOffsets:T,heatmapScoresRaw:O,offsetsRaw:z,displacementFwdRaw:E,displacementBwdRaw:L}}),d=u.segmentation,h=u.longOffsets,p=u.heatmapScoresRaw,m=u.offsetsRaw,f=u.displacementFwdRaw,g=u.displacementBwdRaw,[4,$s([p,m,f,g])];case 1:return w=C.sent(),b=w[0],I=w[1],y=w[2],k=w[3],x=Os(x=Ms(b,I,y,k,this.baseModel.outputStride,e.maxDetections,e.scoreThreshold,e.nmsRadius),[i,o],a,c,Ls),[4,$N(d,h,x,i,o,this.baseModel.outputStride,a,c,e.scoreThreshold,e.refineSteps,e.minKeypointScore,e.maxDetections)];case 2:return N=C.sent(),l.dispose(),d.dispose(),h.dispose(),p.dispose(),m.dispose(),f.dispose(),g.dispose(),[2,N]}})})},n.prototype.segmentPersonPartsActivation=function(t,e,s){var i=this;s===void 0&&(s=.5);var o=ts(t),a=o[0],r=o[1],l=zs(e,this.baseModel.outputStride,[a,r]),c=Es(t,l),u=c.resized,d=c.padding,h=D(function(){var b=i.predictForPersonSegmentationAndPart(u),I=b.segmentLogits,y=b.partHeatmapLogits,k=b.heatmapScores,x=b.offsets,N=b.displacementFwd,v=b.displacementBwd,C=u.shape,T=C[0],R=C[1],_=Nn(I,[a,r],[T,R],[[d.top,d.bottom],[d.left,d.right]],vn),M=Nn(y,[a,r],[T,R],[[d.top,d.bottom],[d.left,d.right]],vn);return{partSegmentation:xN(Rs(Ne(_),s),M),heatmapScores:k,offsets:x,displacementFwd:N,displacementBwd:v}}),p=h.partSegmentation,m=h.heatmapScores,f=h.offsets,g=h.displacementFwd,w=h.displacementBwd;return u.dispose(),{partSegmentation:p,heatmapScores:m,offsets:f,displacementFwd:g,displacementBwd:w,padding:d,internalResolutionHeightAndWidth:l}},n.prototype.segmentPersonParts=function(t,e){return e===void 0&&(e=_s),Ce(this,void 0,void 0,function(){var s,i,o,a,r,l,c,u,d,h,p,m,f,g,w,b,I,y;return Te(this,function(k){switch(k.label){case 0:return Fr(e=$e($e({},_s),e)),s=this.segmentPersonPartsActivation(t,e.internalResolution,e.segmentationThreshold),i=s.partSegmentation,o=s.heatmapScores,a=s.offsets,r=s.displacementFwd,l=s.displacementBwd,c=s.padding,u=s.internalResolutionHeightAndWidth,d=i.shape,h=d[0],p=d[1],[4,i.data()];case 1:return m=k.sent(),i.dispose(),[4,$s([o,a,r,l])];case 2:return f=k.sent(),g=f[0],w=f[1],b=f[2],I=f[3],y=Os(y=Ms(g,w,b,I,this.baseModel.outputStride,e.maxDetections,e.scoreThreshold,e.nmsRadius),[h,p],u,c,Ls),o.dispose(),a.dispose(),r.dispose(),l.dispose(),[2,{height:h,width:p,data:m,allPoses:y}]}})})},n.prototype.segmentMultiPersonParts=function(t,e){return e===void 0&&(e=Ps),Ce(this,void 0,void 0,function(){var s,i,o,a,r,l,c,u,d,h,p,m,f,g,w,b,I,y,k,x,N,v,C=this;return Te(this,function(T){switch(T.label){case 0:return Rr(e=$e($e({},Ps),e)),s=ts(t),i=s[0],o=s[1],a=zs(e.internalResolution,this.baseModel.outputStride,[i,o]),r=Es(t,a),l=r.resized,c=r.padding,u=D(function(){var R=C.predictForMultiPersonInstanceSegmentationAndPart(l),_=R.segmentLogits,M=R.longOffsets,O=R.heatmapScores,z=R.offsets,E=R.displacementFwd,L=R.displacementBwd,$=R.partHeatmaps,P=Nn(_,[i,o],a,[[c.top,c.bottom],[c.left,c.right]],vn),H=Nn($,[i,o],a,[[c.top,c.bottom],[c.left,c.right]],vn),W=M;return{segmentation:Rs(Ne(P),e.segmentationThreshold),longOffsets:W,heatmapScoresRaw:O,offsetsRaw:z,displacementFwdRaw:E,displacementBwdRaw:L,partSegmentation:SN(H)}}),d=u.segmentation,h=u.longOffsets,p=u.heatmapScoresRaw,m=u.offsetsRaw,f=u.displacementFwdRaw,g=u.displacementBwdRaw,w=u.partSegmentation,[4,$s([p,m,f,g])];case 1:return b=T.sent(),I=b[0],y=b[1],k=b[2],x=b[3],N=Os(N=Ms(I,y,k,x,this.baseModel.outputStride,e.maxDetections,e.scoreThreshold,e.nmsRadius),[i,o],a,c,Ls),[4,ON(d,h,w,N,i,o,this.baseModel.outputStride,a,c,e.scoreThreshold,e.refineSteps,e.minKeypointScore,e.maxDetections)];case 2:return v=T.sent(),l.dispose(),d.dispose(),h.dispose(),p.dispose(),m.dispose(),f.dispose(),g.dispose(),w.dispose(),[2,v]}})})},n.prototype.dispose=function(){this.baseModel.dispose()},n}();function av(n){return Ce(this,void 0,void 0,function(){var t,e,s,i,o,a;return Te(this,function(r){switch(r.label){case 0:if(t=n.outputStride,e=n.quantBytes,s=n.multiplier,Sc==null)throw new Error(`Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this
        model.`);return i=qN(t,s,e),[4,Nc(n.modelUrl||i)];case 1:return o=r.sent(),a=new NN(o,t),[2,new md(a)]}})})}function rv(n){return Ce(this,void 0,void 0,function(){var t,e,s,i,o;return Te(this,function(a){switch(a.label){case 0:if(t=n.outputStride,e=n.quantBytes,Sc==null)throw new Error(`Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this
        model.`);return s=jN(t,e),[4,Nc(n.modelUrl||s)];case 1:return i=a.sent(),o=new UN(i,t),[2,new md(o)]}})})}function lv(n){return n===void 0&&(n=fd),Ce(this,void 0,void 0,function(){return Te(this,function(t){return(n=ov(n)).architecture==="ResNet50"?[2,rv(n)]:n.architecture==="MobileNetV1"?[2,av(n)]:[2,null]})})}const so=0,cv=1,uv=12,Mr=-1,Bs=413,Dn=531,hv=.75,dv=(1-hv)/2,za=Math.trunc(Dn*dv),pv=Dn-za,fv=async n=>{console.log("processPhoto",n.width,n.height);const t=await mv(n),e=gv(t);return bv(e)},mv=async n=>{console.log("loadAndPredict");const t=await lv();return console.log(t),await t.segmentPersonParts(n)},gv=n=>(console.log("mapHeadAndTorso"),n.data=n.data.map(t=>{switch(t){case Mr:return Mr;case so:case cv:return so;default:return uv}}),n),bv=n=>{console.log("computeCropRegion");const{leftMostPoint:t,rightMostPoint:e,topMostPoint:s,bottomMostPoint:i}=yv(n);console.log("head coordinates:",s,i);const o=wv(s.y,i.y);console.log("scale ratio:",o);const a=(e.x-t.x)*o,r=(Bs-a)/2,l=t.x*o-r,u=Math.trunc(s.y*o)-za;return{x:l,y:u,scaleRatio:o}},yv=n=>{console.log("computeHeadYCoordinates");const t=[];n.data.forEach((l,c)=>t.push({pixelIndex:c,pixelId:l}));const e=l=>({x:Math.trunc(l%n.width),y:Math.trunc(l/n.width)}),s=t.filter(({pixelIndex:l,pixelId:c})=>c===so).map(({pixelIndex:l,pixelId:c})=>e(l)),i=s.reduce((l,c)=>c.x<l.x?c:l),o=s.reduce((l,c)=>c.x>l.x?c:l),a=s.reduce((l,c)=>c.y<l.y?c:l),r=s.reduce((l,c)=>c.y>l.y?c:l);return{leftMostPoint:i,rightMostPoint:o,topMostPoint:a,bottomMostPoint:r}},wv=(n,t)=>{console.log("computeScaleRatio");const e=t-n;return(pv-za)/e},Iv=wd({data(){return{convertButtonDisabled:!0,photoInput:null,photo:null,canvas:null,context:null}},mounted(){this.initCanvas(),this.initPhoto()},methods:{initCanvas(){this.context=this.$refs.canvas.getContext("2d"),this.resetCanvas()},initPhoto(){this.photo=new Image,this.photo.onload=()=>{if(this.resetCanvas(),this.context){const n=Dn/this.photo.height;this.context.scale(n,n),this.context.drawImage(this.photo,0,0),this.context.save()}}},resetCanvas(){this.$refs.canvas.width=Bs,this.$refs.canvas.height=Dn,this.context&&(this.context.fillStyle="rgb(99 102 241)",this.context.fillRect(0,0,Bs,Dn),this.context.save())},selectPhoto(){this.displayOriginalPhoto(),this.convertButtonDisabled=!1},displayOriginalPhoto(){const n=this.$refs.photoInput.files;if(n&&n.length>0){const t=n[0];this.photo.src=URL.createObjectURL(t)}},async convert(){const n=await fv(this.photo);this.displayPassportPhoto(n),this.convertButtonDisabled=!0},displayPassportPhoto({x:n,y:t,scaleRatio:e}){var o,a;const s=document.createElement("canvas");s.width=this.photo.width,s.height=this.photo.height;const i=s.getContext("2d");if(i){i.scale(e,e),i.drawImage(this.photo,0,0);const r=i.getImageData(n,t,Bs,Dn);(o=this.context)==null||o.putImageData(r,0,0),(a=this.context)==null||a.save()}}}},"$3l1CDmMdg3"),kv={class:"text-center"},xv=Cn("label",{for:"photo-input",class:"text-indigo-500 rounded border border-2 border-indigo-500 px-1"}," Select photo ",-1),Sv=["disabled"],Nv={class:"mx-auto",ref:"canvas"};function vv(n,t,e,s,i,o){return rb(),ab("div",null,[Cn("div",kv,[xv,Cn("input",{id:"photo-input",type:"file",accept:"image/*",ref:"photoInput",onChange:t[0]||(t[0]=(...a)=>n.selectPhoto&&n.selectPhoto(...a)),hidden:""},null,544),Cn("button",{class:"disabled:opacity-75 text-indigo-500 rounded border border-2 border-indigo-500 px-1",disabled:n.convertButtonDisabled,ref:"convertButton",onClick:t[1]||(t[1]=(...a)=>n.convert&&n.convert(...a))}," Convert ",8,Sv)]),Cn("div",null,[Cn("canvas",Nv,null,512)])])}const zv=ob(Iv,[["render",vv]]);export{zv as default};
