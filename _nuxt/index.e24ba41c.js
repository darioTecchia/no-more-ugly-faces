var ZC=Object.defineProperty;var JC=(n,t,e)=>t in n?ZC(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var br=(n,t,e)=>(JC(n,typeof t!="symbol"?t+"":t,e),e);import{d as QC,f as zy,l as Ns,z as Ti,m as _e,t as Mg,A as Yd,B as By,C as rx,q as Vy,D as rg,v as Yi,k as vs,x as tN,y as eN,_ as ix,E as nN,F as sN,G as rN,H as iN,I as oN}from"./entry.6cc46802.js";import{d as ox}from"./component.9a125155.js";function aN(n,t){for(var e=0;e<t.length;e++){const s=t[e];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in n)){const i=Object.getOwnPropertyDescriptor(s,r);i&&Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}const zg=(n,t)=>{const e=document.createElement("a");n instanceof Blob?e.href=URL.createObjectURL(n):e.href=n,e.download=t,document.body.appendChild(e),e.click(),e.remove(),URL.revokeObjectURL(e.href)};var ks=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ax(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function uN(n){if(n.__esModule)return n;var t=n.default;if(typeof t=="function"){var e=function s(){if(this instanceof s){var r=[null];r.push.apply(r,arguments);var i=Function.bind.apply(t,r);return new i}return t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(n).forEach(function(s){var r=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(e,s,r.get?r:{enumerable:!0,get:function(){return n[s]}})}),e}var lN={};(function(){var n;function t(I){var $=0;return function(){return $<I.length?{done:!1,value:I[$++]}:{done:!0}}}var e=typeof Object.defineProperties=="function"?Object.defineProperty:function(I,$,D){return I==Array.prototype||I==Object.prototype||(I[$]=D.value),I};function s(I){I=[typeof globalThis=="object"&&globalThis,I,typeof window=="object"&&window,typeof self=="object"&&self,typeof ks=="object"&&ks];for(var $=0;$<I.length;++$){var D=I[$];if(D&&D.Math==Math)return D}throw Error("Cannot find global object")}var r=s(this);function i(I,$){if($)t:{var D=r;I=I.split(".");for(var J=0;J<I.length-1;J++){var wt=I[J];if(!(wt in D))break t;D=D[wt]}I=I[I.length-1],J=D[I],$=$(J),$!=J&&$!=null&&e(D,I,{configurable:!0,writable:!0,value:$})}}i("Symbol",function(I){function $(Dt){if(this instanceof $)throw new TypeError("Symbol is not a constructor");return new D(J+(Dt||"")+"_"+wt++,Dt)}function D(Dt,Ct){this.g=Dt,e(this,"description",{configurable:!0,writable:!0,value:Ct})}if(I)return I;D.prototype.toString=function(){return this.g};var J="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",wt=0;return $}),i("Symbol.iterator",function(I){if(I)return I;I=Symbol("Symbol.iterator");for(var $="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),D=0;D<$.length;D++){var J=r[$[D]];typeof J=="function"&&typeof J.prototype[I]!="function"&&e(J.prototype,I,{configurable:!0,writable:!0,value:function(){return o(t(this))}})}return I});function o(I){return I={next:I},I[Symbol.iterator]=function(){return this},I}function a(I){var $=typeof Symbol<"u"&&Symbol.iterator&&I[Symbol.iterator];return $?$.call(I):{next:t(I)}}function u(I){if(!(I instanceof Array)){I=a(I);for(var $,D=[];!($=I.next()).done;)D.push($.value);I=D}return I}var l=typeof Object.create=="function"?Object.create:function(I){function $(){}return $.prototype=I,new $},c;if(typeof Object.setPrototypeOf=="function")c=Object.setPrototypeOf;else{var h;t:{var d={a:!0},f={};try{f.__proto__=d,h=f.a;break t}catch{}h=!1}c=h?function(I,$){if(I.__proto__=$,I.__proto__!==$)throw new TypeError(I+" is not extensible");return I}:null}var p=c;function m(I,$){if(I.prototype=l($.prototype),I.prototype.constructor=I,p)p(I,$);else for(var D in $)if(D!="prototype")if(Object.defineProperties){var J=Object.getOwnPropertyDescriptor($,D);J&&Object.defineProperty(I,D,J)}else I[D]=$[D];I.ea=$.prototype}function g(){this.l=!1,this.i=null,this.h=void 0,this.g=1,this.s=this.m=0,this.j=null}function y(I){if(I.l)throw new TypeError("Generator is already running");I.l=!0}g.prototype.o=function(I){this.h=I};function b(I,$){I.j={U:$,V:!0},I.g=I.m||I.s}g.prototype.return=function(I){this.j={return:I},this.g=this.s};function w(I,$,D){return I.g=D,{value:$}}function v(I){this.g=new g,this.h=I}function S(I,$){y(I.g);var D=I.g.i;return D?N(I,"return"in D?D.return:function(J){return{value:J,done:!0}},$,I.g.return):(I.g.return($),R(I))}function N(I,$,D,J){try{var wt=$.call(I.g.i,D);if(!(wt instanceof Object))throw new TypeError("Iterator result "+wt+" is not an object");if(!wt.done)return I.g.l=!1,wt;var Dt=wt.value}catch(Ct){return I.g.i=null,b(I.g,Ct),R(I)}return I.g.i=null,J.call(I.g,Dt),R(I)}function R(I){for(;I.g.g;)try{var $=I.h(I.g);if($)return I.g.l=!1,{value:$.value,done:!1}}catch(D){I.g.h=void 0,b(I.g,D)}if(I.g.l=!1,I.g.j){if($=I.g.j,I.g.j=null,$.V)throw $.U;return{value:$.return,done:!0}}return{value:void 0,done:!0}}function L(I){this.next=function($){return y(I.g),I.g.i?$=N(I,I.g.i.next,$,I.g.o):(I.g.o($),$=R(I)),$},this.throw=function($){return y(I.g),I.g.i?$=N(I,I.g.i.throw,$,I.g.o):(b(I.g,$),$=R(I)),$},this.return=function($){return S(I,$)},this[Symbol.iterator]=function(){return this}}function F(I,$){return $=new L(new v($)),p&&I.prototype&&p($,I.prototype),$}function B(I,$){I instanceof String&&(I+="");var D=0,J=!1,wt={next:function(){if(!J&&D<I.length){var Dt=D++;return{value:$(Dt,I[Dt]),done:!1}}return J=!0,{done:!0,value:void 0}}};return wt[Symbol.iterator]=function(){return wt},wt}var H=typeof Object.assign=="function"?Object.assign:function(I,$){for(var D=1;D<arguments.length;D++){var J=arguments[D];if(J)for(var wt in J)Object.prototype.hasOwnProperty.call(J,wt)&&(I[wt]=J[wt])}return I};i("Object.assign",function(I){return I||H}),i("Promise",function(I){function $(Ct){this.h=0,this.i=void 0,this.g=[],this.o=!1;var Ft=this.j();try{Ct(Ft.resolve,Ft.reject)}catch(Ht){Ft.reject(Ht)}}function D(){this.g=null}function J(Ct){return Ct instanceof $?Ct:new $(function(Ft){Ft(Ct)})}if(I)return I;D.prototype.h=function(Ct){if(this.g==null){this.g=[];var Ft=this;this.i(function(){Ft.l()})}this.g.push(Ct)};var wt=r.setTimeout;D.prototype.i=function(Ct){wt(Ct,0)},D.prototype.l=function(){for(;this.g&&this.g.length;){var Ct=this.g;this.g=[];for(var Ft=0;Ft<Ct.length;++Ft){var Ht=Ct[Ft];Ct[Ft]=null;try{Ht()}catch(ae){this.j(ae)}}}this.g=null},D.prototype.j=function(Ct){this.i(function(){throw Ct})},$.prototype.j=function(){function Ct(ae){return function(ve){Ht||(Ht=!0,ae.call(Ft,ve))}}var Ft=this,Ht=!1;return{resolve:Ct(this.C),reject:Ct(this.l)}},$.prototype.C=function(Ct){if(Ct===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(Ct instanceof $)this.F(Ct);else{t:switch(typeof Ct){case"object":var Ft=Ct!=null;break t;case"function":Ft=!0;break t;default:Ft=!1}Ft?this.u(Ct):this.m(Ct)}},$.prototype.u=function(Ct){var Ft=void 0;try{Ft=Ct.then}catch(Ht){this.l(Ht);return}typeof Ft=="function"?this.G(Ft,Ct):this.m(Ct)},$.prototype.l=function(Ct){this.s(2,Ct)},$.prototype.m=function(Ct){this.s(1,Ct)},$.prototype.s=function(Ct,Ft){if(this.h!=0)throw Error("Cannot settle("+Ct+", "+Ft+"): Promise already settled in state"+this.h);this.h=Ct,this.i=Ft,this.h===2&&this.D(),this.A()},$.prototype.D=function(){var Ct=this;wt(function(){if(Ct.B()){var Ft=r.console;typeof Ft<"u"&&Ft.error(Ct.i)}},1)},$.prototype.B=function(){if(this.o)return!1;var Ct=r.CustomEvent,Ft=r.Event,Ht=r.dispatchEvent;return typeof Ht>"u"?!0:(typeof Ct=="function"?Ct=new Ct("unhandledrejection",{cancelable:!0}):typeof Ft=="function"?Ct=new Ft("unhandledrejection",{cancelable:!0}):(Ct=r.document.createEvent("CustomEvent"),Ct.initCustomEvent("unhandledrejection",!1,!0,Ct)),Ct.promise=this,Ct.reason=this.i,Ht(Ct))},$.prototype.A=function(){if(this.g!=null){for(var Ct=0;Ct<this.g.length;++Ct)Dt.h(this.g[Ct]);this.g=null}};var Dt=new D;return $.prototype.F=function(Ct){var Ft=this.j();Ct.J(Ft.resolve,Ft.reject)},$.prototype.G=function(Ct,Ft){var Ht=this.j();try{Ct.call(Ft,Ht.resolve,Ht.reject)}catch(ae){Ht.reject(ae)}},$.prototype.then=function(Ct,Ft){function Ht(Ae,Ie){return typeof Ae=="function"?function(le){try{ae(Ae(le))}catch(k){ve(k)}}:Ie}var ae,ve,ze=new $(function(Ae,Ie){ae=Ae,ve=Ie});return this.J(Ht(Ct,ae),Ht(Ft,ve)),ze},$.prototype.catch=function(Ct){return this.then(void 0,Ct)},$.prototype.J=function(Ct,Ft){function Ht(){switch(ae.h){case 1:Ct(ae.i);break;case 2:Ft(ae.i);break;default:throw Error("Unexpected state: "+ae.h)}}var ae=this;this.g==null?Dt.h(Ht):this.g.push(Ht),this.o=!0},$.resolve=J,$.reject=function(Ct){return new $(function(Ft,Ht){Ht(Ct)})},$.race=function(Ct){return new $(function(Ft,Ht){for(var ae=a(Ct),ve=ae.next();!ve.done;ve=ae.next())J(ve.value).J(Ft,Ht)})},$.all=function(Ct){var Ft=a(Ct),Ht=Ft.next();return Ht.done?J([]):new $(function(ae,ve){function ze(le){return function(k){Ae[le]=k,Ie--,Ie==0&&ae(Ae)}}var Ae=[],Ie=0;do Ae.push(void 0),Ie++,J(Ht.value).J(ze(Ae.length-1),ve),Ht=Ft.next();while(!Ht.done)})},$}),i("Object.is",function(I){return I||function($,D){return $===D?$!==0||1/$===1/D:$!==$&&D!==D}}),i("Array.prototype.includes",function(I){return I||function($,D){var J=this;J instanceof String&&(J=String(J));var wt=J.length;for(D=D||0,0>D&&(D=Math.max(D+wt,0));D<wt;D++){var Dt=J[D];if(Dt===$||Object.is(Dt,$))return!0}return!1}}),i("String.prototype.includes",function(I){return I||function($,D){if(this==null)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if($ instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return this.indexOf($,D||0)!==-1}}),i("Array.prototype.keys",function(I){return I||function(){return B(this,function($){return $})}});var z=this||self;function G(I,$){I=I.split(".");var D=z;I[0]in D||typeof D.execScript>"u"||D.execScript("var "+I[0]);for(var J;I.length&&(J=I.shift());)I.length||$===void 0?D[J]&&D[J]!==Object.prototype[J]?D=D[J]:D=D[J]={}:D[J]=$}function T(I,$){return $=String.fromCharCode.apply(null,$),I==null?$:I+$}var K,ht=typeof TextDecoder<"u",rt,gt=typeof TextEncoder<"u";function at(I){if(gt)I=(rt||(rt=new TextEncoder)).encode(I);else{var $=void 0;$=$===void 0?!1:$;for(var D=0,J=new Uint8Array(3*I.length),wt=0;wt<I.length;wt++){var Dt=I.charCodeAt(wt);if(128>Dt)J[D++]=Dt;else{if(2048>Dt)J[D++]=Dt>>6|192;else{if(55296<=Dt&&57343>=Dt){if(56319>=Dt&&wt<I.length){var Ct=I.charCodeAt(++wt);if(56320<=Ct&&57343>=Ct){Dt=1024*(Dt-55296)+Ct-56320+65536,J[D++]=Dt>>18|240,J[D++]=Dt>>12&63|128,J[D++]=Dt>>6&63|128,J[D++]=Dt&63|128;continue}else wt--}if($)throw Error("Found an unpaired surrogate");Dt=65533}J[D++]=Dt>>12|224,J[D++]=Dt>>6&63|128}J[D++]=Dt&63|128}}I=J.subarray(0,D)}return I}var It={},et=null;function st(I,$){$===void 0&&($=0),yt(),$=It[$];for(var D=Array(Math.floor(I.length/3)),J=$[64]||"",wt=0,Dt=0;wt<I.length-2;wt+=3){var Ct=I[wt],Ft=I[wt+1],Ht=I[wt+2],ae=$[Ct>>2];Ct=$[(Ct&3)<<4|Ft>>4],Ft=$[(Ft&15)<<2|Ht>>6],Ht=$[Ht&63],D[Dt++]=ae+Ct+Ft+Ht}switch(ae=0,Ht=J,I.length-wt){case 2:ae=I[wt+1],Ht=$[(ae&15)<<2]||J;case 1:I=I[wt],D[Dt]=$[I>>2]+$[(I&3)<<4|ae>>4]+Ht+J}return D.join("")}function St(I){var $=I.length,D=3*$/4;D%3?D=Math.floor(D):"=.".indexOf(I[$-1])!=-1&&(D="=.".indexOf(I[$-2])!=-1?D-2:D-1);var J=new Uint8Array(D),wt=0;return kt(I,function(Dt){J[wt++]=Dt}),J.subarray(0,wt)}function kt(I,$){function D(Ht){for(;J<I.length;){var ae=I.charAt(J++),ve=et[ae];if(ve!=null)return ve;if(!/^[\s\xa0]*$/.test(ae))throw Error("Unknown base64 encoding at char: "+ae)}return Ht}yt();for(var J=0;;){var wt=D(-1),Dt=D(0),Ct=D(64),Ft=D(64);if(Ft===64&&wt===-1)break;$(wt<<2|Dt>>4),Ct!=64&&($(Dt<<4&240|Ct>>2),Ft!=64&&$(Ct<<6&192|Ft))}}function yt(){if(!et){et={};for(var I="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),$=["+/=","+/","-_=","-_.","-_"],D=0;5>D;D++){var J=I.concat($[D].split(""));It[D]=J;for(var wt=0;wt<J.length;wt++){var Dt=J[wt];et[Dt]===void 0&&(et[Dt]=wt)}}}}var Pt=typeof Uint8Array.prototype.slice=="function",Xt;function Wt(I,$,D){return $===D?Xt||(Xt=new Uint8Array(0)):Pt?I.slice($,D):new Uint8Array(I.subarray($,D))}var Bt=0,Jt=0;function jt(I,$){$=$===void 0?{}:$,$=$.v===void 0?!1:$.v,this.h=null,this.g=this.j=this.l=0,this.m=!1,this.v=$,I&&be(this,I)}function be(I,$){$=$.constructor===Uint8Array?$:$.constructor===ArrayBuffer?new Uint8Array($):$.constructor===Array?new Uint8Array($):$.constructor===String?St($):$ instanceof Uint8Array?new Uint8Array($.buffer,$.byteOffset,$.byteLength):new Uint8Array(0),I.h=$,I.l=0,I.j=I.h.length,I.g=I.l}jt.prototype.reset=function(){this.g=this.l};function ce(I){for(var $=128,D=0,J=0,wt=0;4>wt&&128<=$;wt++)$=I.h[I.g++],D|=($&127)<<7*wt;if(128<=$&&($=I.h[I.g++],D|=($&127)<<28,J|=($&127)>>4),128<=$)for(wt=0;5>wt&&128<=$;wt++)$=I.h[I.g++],J|=($&127)<<7*wt+3;if(128>$)return I=D>>>0,$=J>>>0,(J=$&2147483648)&&(I=~I+1>>>0,$=~$>>>0,I==0&&($=$+1>>>0)),I=4294967296*$+(I>>>0),J?-I:I;I.m=!0}jt.prototype.i=function(){var I=this.h,$=I[this.g],D=$&127;return 128>$?(this.g+=1,D):($=I[this.g+1],D|=($&127)<<7,128>$?(this.g+=2,D):($=I[this.g+2],D|=($&127)<<14,128>$?(this.g+=3,D):($=I[this.g+3],D|=($&127)<<21,128>$?(this.g+=4,D):($=I[this.g+4],D|=($&15)<<28,128>$?(this.g+=5,D>>>0):(this.g+=5,128<=I[this.g++]&&128<=I[this.g++]&&128<=I[this.g++]&&128<=I[this.g++]&&this.g++,D)))))},jt.prototype.o=function(){var I=this.h[this.g],$=this.h[this.g+1],D=this.h[this.g+2],J=this.h[this.g+3];return this.g+=4,D=(I<<0|$<<8|D<<16|J<<24)>>>0,I=2*(D>>31)+1,$=D>>>23&255,D&=8388607,$==255?D?NaN:1/0*I:$==0?I*Math.pow(2,-149)*D:I*Math.pow(2,$-150)*(D+Math.pow(2,23))};var O=[];function Nt(){this.g=new Uint8Array(64),this.h=0}Nt.prototype.push=function(I){if(!(this.h+1<this.g.length)){var $=this.g;this.g=new Uint8Array(Math.ceil(1+2*this.g.length)),this.g.set($)}this.g[this.h++]=I},Nt.prototype.length=function(){return this.h},Nt.prototype.end=function(){var I=this.g,$=this.h;return this.h=0,Wt(I,0,$)};function xt(I,$){for(;127<$;)I.push($&127|128),$>>>=7;I.push($)}function q(I){var $={},D=$.N===void 0?!1:$.N;this.o={v:$.v===void 0?!1:$.v},this.N=D,$=this.o,O.length?(D=O.pop(),$&&(D.v=$.v),I&&be(D,I),I=D):I=new jt(I,$),this.g=I,this.m=this.g.g,this.h=this.i=this.l=-1,this.j=!1}q.prototype.reset=function(){this.g.reset(),this.h=this.l=-1};function j(I){var $=I.g;if(($=$.g==$.j)||($=I.j)||($=I.g,$=$.m||0>$.g||$.g>$.j),$)return!1;I.m=I.g.g,$=I.g.i();var D=$&7;return D!=0&&D!=5&&D!=1&&D!=2&&D!=3&&D!=4?(I.j=!0,!1):(I.i=$,I.l=$>>>3,I.h=D,!0)}function ft(I){switch(I.h){case 0:if(I.h!=0)ft(I);else{for(I=I.g;I.h[I.g]&128;)I.g++;I.g++}break;case 1:I.h!=1?ft(I):(I=I.g,I.g+=8);break;case 2:if(I.h!=2)ft(I);else{var $=I.g.i();I=I.g,I.g+=$}break;case 5:I.h!=5?ft(I):(I=I.g,I.g+=4);break;case 3:$=I.l;do{if(!j(I)){I.j=!0;break}if(I.h==4){I.l!=$&&(I.j=!0);break}ft(I)}while(1);break;default:I.j=!0}}function At(I,$,D){var J=I.g.j,wt=I.g.i(),Dt=I.g.g+wt;if(I.g.j=Dt,D($,I),D=Dt-I.g.g,D!==0)throw Error("Message parsing ended unexpectedly. Expected to read "+wt+" bytes, instead read "+(wt-D)+" bytes, either the data ended unexpectedly or the message misreported its own length");return I.g.g=Dt,I.g.j=J,$}function Rt(I){return I.g.o()}function bt(I){var $=I.g.i();I=I.g;var D=I.g;I.g+=$,I=I.h;var J;if(ht)(J=K)||(J=K=new TextDecoder("utf-8",{fatal:!1})),J=J.decode(I.subarray(D,D+$));else{$=D+$;for(var wt=[],Dt=null,Ct,Ft,Ht;D<$;)Ct=I[D++],128>Ct?wt.push(Ct):224>Ct?D>=$?wt.push(65533):(Ft=I[D++],194>Ct||(Ft&192)!==128?(D--,wt.push(65533)):wt.push((Ct&31)<<6|Ft&63)):240>Ct?D>=$-1?wt.push(65533):(Ft=I[D++],(Ft&192)!==128||Ct===224&&160>Ft||Ct===237&&160<=Ft||((J=I[D++])&192)!==128?(D--,wt.push(65533)):wt.push((Ct&15)<<12|(Ft&63)<<6|J&63)):244>=Ct?D>=$-2?wt.push(65533):(Ft=I[D++],(Ft&192)!==128||(Ct<<28)+(Ft-144)>>30||((J=I[D++])&192)!==128||((Ht=I[D++])&192)!==128?(D--,wt.push(65533)):(Ct=(Ct&7)<<18|(Ft&63)<<12|(J&63)<<6|Ht&63,Ct-=65536,wt.push((Ct>>10&1023)+55296,(Ct&1023)+56320))):wt.push(65533),8192<=wt.length&&(Dt=T(Dt,wt),wt.length=0);J=T(Dt,wt)}return J}function Ut(I,$,D){var J=I.g.i();for(J=I.g.g+J;I.g.g<J;)D.push($.call(I.g))}function qt(I,$){I.h==2?Ut(I,jt.prototype.o,$):$.push(Rt(I))}function zt(){this.h=[],this.i=0,this.g=new Nt}function ne(I,$){$.length!==0&&(I.h.push($),I.i+=$.length)}function Te(I){var $=I.i+I.g.length();if($===0)return new Uint8Array(0);$=new Uint8Array($);for(var D=I.h,J=D.length,wt=0,Dt=0;Dt<J;Dt++){var Ct=D[Dt];Ct.length!==0&&($.set(Ct,wt),wt+=Ct.length)}return D=I.g,J=D.h,J!==0&&($.set(D.g.subarray(0,J),wt),D.h=0),I.h=[$],$}function me(I,$,D){if(D!=null){xt(I.g,8*$+5),I=I.g;var J=D;J=(D=0>J?1:0)?-J:J,J===0?0<1/J?Bt=Jt=0:(Jt=0,Bt=2147483648):isNaN(J)?(Jt=0,Bt=2147483647):34028234663852886e22<J?(Jt=0,Bt=(D<<31|2139095040)>>>0):11754943508222875e-54>J?(J=Math.round(J/Math.pow(2,-149)),Jt=0,Bt=(D<<31|J)>>>0):($=Math.floor(Math.log(J)/Math.LN2),J*=Math.pow(2,-$),J=Math.round(8388608*J),16777216<=J&&++$,Jt=0,Bt=(D<<31|$+127<<23|J&8388607)>>>0),D=Bt,I.push(D>>>0&255),I.push(D>>>8&255),I.push(D>>>16&255),I.push(D>>>24&255)}}var on=typeof Uint8Array=="function";function ms(I,$,D){if(I!=null)return typeof I=="object"?on&&I instanceof Uint8Array?D(I):$n(I,$,D):$(I)}function $n(I,$,D){if(Array.isArray(I)){for(var J=Array(I.length),wt=0;wt<I.length;wt++)J[wt]=ms(I[wt],$,D);return Array.isArray(I)&&I.W&&ln(J),J}J={};for(wt in I)J[wt]=ms(I[wt],$,D);return J}function Bs(I){return typeof I=="number"?isFinite(I)?I:String(I):I}var We={W:{value:!0,configurable:!0}};function ln(I){return Array.isArray(I)&&!Object.isFrozen(I)&&Object.defineProperties(I,We),I}var en;function Ye(I,$,D){var J=en;en=null,I||(I=J),J=this.constructor.ca,I||(I=J?[J]:[]),this.j=J?0:-1,this.m=this.g=null,this.h=I;t:{if(J=this.h.length,I=J-1,J&&(J=this.h[I],!(J===null||typeof J!="object"||Array.isArray(J)||on&&J instanceof Uint8Array))){this.l=I-this.j,this.i=J;break t}$!==void 0&&-1<$?(this.l=Math.max($,I+1-this.j),this.i=null):this.l=Number.MAX_VALUE}if(D)for($=0;$<D.length;$++)I=D[$],I<this.l?(I+=this.j,(J=this.h[I])?ln(J):this.h[I]=Fn):(mr(this),(J=this.i[I])?ln(J):this.i[I]=Fn)}var Fn=Object.freeze(ln([]));function mr(I){var $=I.l+I.j;I.h[$]||(I.i=I.h[$]={})}function Ge(I,$,D){return $===-1?null:D!==void 0&&D||$>=I.l?I.i?I.i[$]:void 0:I.h[$+I.j]}function Vs(I,$){var D=D===void 0?!1:D,J=Ge(I,$,D);return J==null&&(J=Fn),J===Fn&&(J=ln([]),Le(I,$,J,D)),J}function qr(I){var $=Vs(I,3);if(I.m||(I.m={}),!I.m[3]){for(var D=0;D<$.length;D++)$[D]=+$[D];I.m[3]=!0}return $}function Xn(I,$,D){return I=Ge(I,$),I??D}function _n(I,$,D){return I=Ge(I,$),I=I==null?I:+I,I??(D===void 0?0:D)}function Le(I,$,D,J){J!==void 0&&J||$>=I.l?(mr(I),I.i[$]=D):I.h[$+I.j]=D}function _r(I,$,D){if(D===-1)return null;if(I.g||(I.g={}),!I.g[D]){var J=Ge(I,D,!1);J&&(I.g[D]=new $(J))}return I.g[D]}function mi(I,$){I.g||(I.g={});var D=I.g[1];if(!D){var J=Vs(I,1);D=[];for(var wt=0;wt<J.length;wt++)D[wt]=new $(J[wt]);I.g[1]=D}return D}function gi(I,$,D){var J=J===void 0?!1:J;I.g||(I.g={});var wt=D&&Us(D);I.g[$]=D,Le(I,$,wt,J)}function Ar(I,$,D,J){var wt=mi(I,D);$=$||new D,I=Vs(I,1),J!=null?(wt.splice(J,0,$),I.splice(J,0,Us($))):(wt.push($),I.push(Us($)))}Ye.prototype.toJSON=function(){var I=Us(this);return $n(I,Bs,st)};function Us(I,$){if(I.g)for(var D in I.g){var J=I.g[D];if(Array.isArray(J))for(var wt=0;wt<J.length;wt++)J[wt]&&Us(J[wt]);else J&&Us(J)}return I.h}Ye.prototype.toString=function(){return Us(this).toString()};function wo(I,$){if(I=I.o){ne($,$.g.end());for(var D=0;D<I.length;D++)ne($,I[D])}}function Wn(I,$){if($.h==4)return!1;var D=$.m;return ft($),$.N||($=Wt($.g.h,D,$.g.g),(D=I.o)?D.push($):I.o=[$]),!0}function Rr(I){Ye.call(this,I,-1,Xr)}m(Rr,Ye),Rr.prototype.getRows=function(){return Ge(this,1)},Rr.prototype.getCols=function(){return Ge(this,2)},Rr.prototype.getPackedDataList=function(){return qr(this)},Rr.prototype.getLayout=function(){return Xn(this,4,0)};function Js(I,$){for(;j($);)switch($.i){case 8:var D=$.g.i();Le(I,1,D);break;case 16:D=$.g.i(),Le(I,2,D);break;case 29:case 26:qt($,I.getPackedDataList());break;case 32:D=ce($.g),Le(I,4,D);break;default:if(!Wn(I,$))return I}return I}var Xr=[3];function Ln(I,$){var D=void 0;return new(D||(D=Promise))(function(J,wt){function Dt(Ht){try{Ft($.next(Ht))}catch(ae){wt(ae)}}function Ct(Ht){try{Ft($.throw(Ht))}catch(ae){wt(ae)}}function Ft(Ht){Ht.done?J(Ht.value):new D(function(ae){ae(Ht.value)}).then(Dt,Ct)}Ft(($=$.apply(I,void 0)).next())})}function Je(I){Ye.call(this,I)}m(Je,Ye);function Ws(I,$){for(;j($);)switch($.i){case 8:var D=$.g.i();Le(I,1,D);break;case 21:D=Rt($),Le(I,2,D);break;case 26:D=bt($),Le(I,3,D);break;case 34:D=bt($),Le(I,4,D);break;default:if(!Wn(I,$))return I}return I}function yi(I){Ye.call(this,I,-1,du)}m(yi,Ye),yi.prototype.addClassification=function(I,$){return Ar(this,I,Je,$),this};var du=[1];function gr(I){Ye.call(this,I)}m(gr,Ye);function ua(I,$){for(;j($);)switch($.i){case 13:var D=Rt($);Le(I,1,D);break;case 21:D=Rt($),Le(I,2,D);break;case 29:D=Rt($),Le(I,3,D);break;case 37:D=Rt($),Le(I,4,D);break;case 45:D=Rt($),Le(I,5,D);break;default:if(!Wn(I,$))return I}return I}function Gi(I){Ye.call(this,I,-1,la)}m(Gi,Ye);function bi(I){t:{var $=new Gi;for(I=new q(I);j(I);)switch(I.i){case 10:var D=At(I,new gr,ua);Ar($,D,gr,void 0);break;default:if(!Wn($,I))break t}}return $}var la=[1];function xi(I){Ye.call(this,I)}m(xi,Ye);function yr(I){Ye.call(this,I,-1,Gs)}m(yr,Ye),yr.prototype.getVertexType=function(){return Xn(this,1,0)},yr.prototype.getPrimitiveType=function(){return Xn(this,2,0)},yr.prototype.getVertexBufferList=function(){return qr(this)},yr.prototype.getIndexBufferList=function(){return Vs(this,4)};function fu(I,$){for(;j($);)switch($.i){case 8:var D=ce($.g);Le(I,1,D);break;case 16:D=ce($.g),Le(I,2,D);break;case 29:case 26:qt($,I.getVertexBufferList());break;case 32:case 34:D=$;var J=I.getIndexBufferList();D.h==2?Ut(D,jt.prototype.i,J):J.push(D.g.i());break;default:if(!Wn(I,$))return I}return I}var Gs=[3,4];function gs(I){Ye.call(this,I)}m(gs,Ye),gs.prototype.getMesh=function(){return _r(this,yr,1)},gs.prototype.getPoseTransformMatrix=function(){return _r(this,Rr,2)};function wi(I){t:{var $=new gs;for(I=new q(I);j(I);)switch(I.i){case 10:var D=At(I,new yr,fu);gi($,1,D);break;case 18:D=At(I,new Rr,Js),gi($,2,D);break;default:if(!Wn($,I))break t}}return $}function ji(I,$,D){if(D=I.createShader(D===0?I.VERTEX_SHADER:I.FRAGMENT_SHADER),I.shaderSource(D,$),I.compileShader(D),!I.getShaderParameter(D,I.COMPILE_STATUS))throw Error(`Could not compile WebGL shader.

`+I.getShaderInfoLog(D));return D}function Hi(I){return mi(I,Je).map(function($){return{index:Xn($,1,0),Y:_n($,2),label:Ge($,3)!=null?Xn($,3,""):void 0,displayName:Ge($,4)!=null?Xn($,4,""):void 0}})}function vo(I){return{x:_n(I,1),y:_n(I,2),z:_n(I,3),visibility:Ge(I,4)!=null?_n(I,4):void 0}}function Yr(I,$){this.h=I,this.g=$,this.l=0}function Yn(I,$,D){return Cs(I,$),typeof I.g.canvas.transferToImageBitmap=="function"?Promise.resolve(I.g.canvas.transferToImageBitmap()):D?Promise.resolve(I.g.canvas):typeof createImageBitmap=="function"?createImageBitmap(I.g.canvas):(I.i===void 0&&(I.i=document.createElement("canvas")),new Promise(function(J){I.i.height=I.g.canvas.height,I.i.width=I.g.canvas.width,I.i.getContext("2d",{}).drawImage(I.g.canvas,0,0,I.g.canvas.width,I.g.canvas.height),J(I.i)}))}function Cs(I,$){var D=I.g;if(I.m===void 0){var J=ji(D,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,0),wt=ji(D,`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D sampler0;
  void main(){
    gl_FragColor = texture2D(sampler0, vTex);
  }`,1),Dt=D.createProgram();if(D.attachShader(Dt,J),D.attachShader(Dt,wt),D.linkProgram(Dt),!D.getProgramParameter(Dt,D.LINK_STATUS))throw Error(`Could not compile WebGL program.

`+D.getProgramInfoLog(Dt));J=I.m=Dt,D.useProgram(J),wt=D.getUniformLocation(J,"sampler0"),I.j={I:D.getAttribLocation(J,"aVertex"),H:D.getAttribLocation(J,"aTex"),da:wt},I.s=D.createBuffer(),D.bindBuffer(D.ARRAY_BUFFER,I.s),D.enableVertexAttribArray(I.j.I),D.vertexAttribPointer(I.j.I,2,D.FLOAT,!1,0,0),D.bufferData(D.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),D.STATIC_DRAW),D.bindBuffer(D.ARRAY_BUFFER,null),I.o=D.createBuffer(),D.bindBuffer(D.ARRAY_BUFFER,I.o),D.enableVertexAttribArray(I.j.H),D.vertexAttribPointer(I.j.H,2,D.FLOAT,!1,0,0),D.bufferData(D.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),D.STATIC_DRAW),D.bindBuffer(D.ARRAY_BUFFER,null),D.uniform1i(wt,0)}J=I.j,D.useProgram(I.m),D.canvas.width=$.width,D.canvas.height=$.height,D.viewport(0,0,$.width,$.height),D.activeTexture(D.TEXTURE0),I.h.bindTexture2d($.glName),D.enableVertexAttribArray(J.I),D.bindBuffer(D.ARRAY_BUFFER,I.s),D.vertexAttribPointer(J.I,2,D.FLOAT,!1,0,0),D.enableVertexAttribArray(J.H),D.bindBuffer(D.ARRAY_BUFFER,I.o),D.vertexAttribPointer(J.H,2,D.FLOAT,!1,0,0),D.bindFramebuffer(D.DRAW_FRAMEBUFFER?D.DRAW_FRAMEBUFFER:D.FRAMEBUFFER,null),D.clearColor(0,0,0,0),D.clear(D.COLOR_BUFFER_BIT),D.colorMask(!0,!0,!0,!0),D.drawArrays(D.TRIANGLE_FAN,0,4),D.disableVertexAttribArray(J.I),D.disableVertexAttribArray(J.H),D.bindBuffer(D.ARRAY_BUFFER,null),I.h.bindTexture2d(0)}function ko(I){this.g=I}var Qs=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function Ki(I,$){return $+I}function ca(I,$){window[I]=$}function ys(I){var $=document.createElement("script");return $.setAttribute("src",I),$.setAttribute("crossorigin","anonymous"),new Promise(function(D){$.addEventListener("load",function(){D()},!1),$.addEventListener("error",function(){D()},!1),document.body.appendChild($)})}function So(){return Ln(this,function I(){return F(I,function($){switch($.g){case 1:return $.m=2,w($,WebAssembly.instantiate(Qs),4);case 4:$.g=3,$.m=0;break;case 2:return $.m=0,$.j=null,$.return(!1);case 3:return $.return(!0)}})})}function Zr(I){if(this.g=I,this.listeners={},this.j={},this.F={},this.m={},this.s={},this.G=this.o=this.R=!0,this.C=Promise.resolve(),this.P="",this.B={},this.locateFile=I&&I.locateFile||Ki,typeof window=="object")var $=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else if(typeof location<"u")$=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/";else throw Error("solutions can only be loaded on a web page or in a web worker");if(this.S=$,I.options){$=a(Object.keys(I.options));for(var D=$.next();!D.done;D=$.next()){D=D.value;var J=I.options[D].default;J!==void 0&&(this.j[D]=typeof J=="function"?J():J)}}}n=Zr.prototype,n.close=function(){return this.i&&this.i.delete(),Promise.resolve()};function pu(I,$){return I.g.files===void 0?[]:typeof I.g.files=="function"?I.g.files($):I.g.files}function Io(I){return Ln(I,function $(){var D=this,J,wt,Dt,Ct,Ft,Ht,ae,ve,ze,Ae,Ie;return F($,function(le){switch(le.g){case 1:return J=D,D.R?(wt=pu(D,D.j),w(le,So(),2)):le.return();case 2:if(Dt=le.h,typeof window=="object")return ca("createMediapipeSolutionsWasm",{locateFile:D.locateFile}),ca("createMediapipeSolutionsPackedAssets",{locateFile:D.locateFile}),Ht=wt.filter(function(k){return k.data!==void 0}),ae=wt.filter(function(k){return k.data===void 0}),ve=Promise.all(Ht.map(function(k){var A=Jr(J,k.url);if(k.path!==void 0){var P=k.path;A=A.then(function(W){return J.overrideFile(P,W),Promise.resolve(W)})}return A})),ze=Promise.all(ae.map(function(k){return k.simd===void 0||k.simd&&Dt||!k.simd&&!Dt?ys(J.locateFile(k.url,J.S)):Promise.resolve()})).then(function(){return Ln(J,function k(){var A,P,W=this;return F(k,function(Z){if(Z.g==1)return A=window.createMediapipeSolutionsWasm,P=window.createMediapipeSolutionsPackedAssets,w(Z,A(P),2);W.h=Z.h,Z.g=0})})}),Ae=function(){return Ln(J,function k(){var A=this;return F(k,function(P){return A.g.graph&&A.g.graph.url?P=w(P,Jr(A,A.g.graph.url),0):(P.g=0,P=void 0),P})})}(),w(le,Promise.all([ze,ve,Ae]),7);if(typeof importScripts!="function")throw Error("solutions can only be loaded on a web page or in a web worker");return Ct=wt.filter(function(k){return k.simd===void 0||k.simd&&Dt||!k.simd&&!Dt}).map(function(k){return J.locateFile(k.url,J.S)}),importScripts.apply(null,u(Ct)),w(le,createMediapipeSolutionsWasm(Module),6);case 6:D.h=le.h,D.l=new OffscreenCanvas(1,1),D.h.canvas=D.l,Ft=D.h.GL.createContext(D.l,{antialias:!1,alpha:!1,ba:typeof WebGL2RenderingContext<"u"?2:1}),D.h.GL.makeContextCurrent(Ft),le.g=4;break;case 7:if(D.l=document.createElement("canvas"),Ie=D.l.getContext("webgl2",{}),!Ie&&(Ie=D.l.getContext("webgl",{}),!Ie))return alert("Failed to create WebGL canvas context when passing video frame."),le.return();D.D=Ie,D.h.canvas=D.l,D.h.createContext(D.l,!0,!0,{});case 4:D.i=new D.h.SolutionWasm,D.R=!1,le.g=0}})})}function mu(I){return Ln(I,function $(){var D=this,J,wt,Dt,Ct,Ft,Ht,ae,ve;return F($,function(ze){if(ze.g==1){if(D.g.graph&&D.g.graph.url&&D.P===D.g.graph.url)return ze.return();if(D.o=!0,!D.g.graph||!D.g.graph.url){ze.g=2;return}return D.P=D.g.graph.url,w(ze,Jr(D,D.g.graph.url),3)}for(ze.g!=2&&(J=ze.h,D.i.loadGraph(J)),wt=a(Object.keys(D.B)),Dt=wt.next();!Dt.done;Dt=wt.next())Ct=Dt.value,D.i.overrideFile(Ct,D.B[Ct]);if(D.B={},D.g.listeners)for(Ft=a(D.g.listeners),Ht=Ft.next();!Ht.done;Ht=Ft.next())ae=Ht.value,yu(D,ae);ve=D.j,D.j={},D.setOptions(ve),ze.g=0})})}n.reset=function(){return Ln(this,function I(){var $=this;return F(I,function(D){$.i&&($.i.reset(),$.m={},$.s={}),D.g=0})})},n.setOptions=function(I,$){var D=this;if($=$||this.g.options){for(var J=[],wt=[],Dt={},Ct=a(Object.keys(I)),Ft=Ct.next();!Ft.done;Dt={K:Dt.K,L:Dt.L},Ft=Ct.next()){var Ht=Ft.value;Ht in this.j&&this.j[Ht]===I[Ht]||(this.j[Ht]=I[Ht],Ft=$[Ht],Ft!==void 0&&(Ft.onChange&&(Dt.K=Ft.onChange,Dt.L=I[Ht],J.push(function(ae){return function(){return Ln(D,function ve(){var ze,Ae=this;return F(ve,function(Ie){if(Ie.g==1)return w(Ie,ae.K(ae.L),2);ze=Ie.h,ze===!0&&(Ae.o=!0),Ie.g=0})})}}(Dt))),Ft.graphOptionXref&&(Ht={valueNumber:Ft.type===1?I[Ht]:0,valueBoolean:Ft.type===0?I[Ht]:!1,valueString:Ft.type===2?I[Ht]:""},Ft=Object.assign(Object.assign(Object.assign({},{calculatorName:"",calculatorIndex:0}),Ft.graphOptionXref),Ht),wt.push(Ft))))}(J.length!==0||wt.length!==0)&&(this.o=!0,this.A=(this.A===void 0?[]:this.A).concat(wt),this.u=(this.u===void 0?[]:this.u).concat(J))}};function gu(I){return Ln(I,function $(){var D=this,J,wt,Dt,Ct,Ft,Ht,ae;return F($,function(ve){switch(ve.g){case 1:if(!D.o)return ve.return();if(!D.u){ve.g=2;break}J=a(D.u),wt=J.next();case 3:if(wt.done){ve.g=5;break}return Dt=wt.value,w(ve,Dt(),4);case 4:wt=J.next(),ve.g=3;break;case 5:D.u=void 0;case 2:if(D.A){for(Ct=new D.h.GraphOptionChangeRequestList,Ft=a(D.A),Ht=Ft.next();!Ht.done;Ht=Ft.next())ae=Ht.value,Ct.push_back(ae);D.i.changeOptions(Ct),Ct.delete(),D.A=void 0}D.o=!1,ve.g=0}})})}n.initialize=function(){return Ln(this,function I(){var $=this;return F(I,function(D){return D.g==1?w(D,Io($),2):D.g!=3?w(D,mu($),3):w(D,gu($),0)})})};function Jr(I,$){return Ln(I,function D(){var J=this,wt,Dt;return F(D,function(Ct){return $ in J.F?Ct.return(J.F[$]):(wt=J.locateFile($,""),Dt=fetch(wt).then(function(Ft){return Ft.arrayBuffer()}),J.F[$]=Dt,Ct.return(Dt))})})}n.overrideFile=function(I,$){this.i?this.i.overrideFile(I,$):this.B[I]=$},n.clearOverriddenFiles=function(){this.B={},this.i&&this.i.clearOverriddenFiles()},n.send=function(I,$){return Ln(this,function D(){var J=this,wt,Dt,Ct,Ft,Ht,ae,ve,ze,Ae;return F(D,function(Ie){switch(Ie.g){case 1:return J.g.inputs?(wt=1e3*($??performance.now()),w(Ie,J.C,2)):Ie.return();case 2:return w(Ie,J.initialize(),3);case 3:for(Dt=new J.h.PacketDataList,Ct=a(Object.keys(I)),Ft=Ct.next();!Ft.done;Ft=Ct.next())if(Ht=Ft.value,ae=J.g.inputs[Ht]){t:{var le=J,k=I[Ht];switch(ae.type){case"video":var A=le.m[ae.stream];if(A||(A=new Yr(le.h,le.D),le.m[ae.stream]=A),le=A,le.l===0&&(le.l=le.h.createTexture()),typeof HTMLVideoElement<"u"&&k instanceof HTMLVideoElement){var P=k.videoWidth;A=k.videoHeight}else typeof HTMLImageElement<"u"&&k instanceof HTMLImageElement?(P=k.naturalWidth,A=k.naturalHeight):(P=k.width,A=k.height);A={glName:le.l,width:P,height:A},P=le.g,P.canvas.width=A.width,P.canvas.height=A.height,P.activeTexture(P.TEXTURE0),le.h.bindTexture2d(le.l),P.texImage2D(P.TEXTURE_2D,0,P.RGBA,P.RGBA,P.UNSIGNED_BYTE,k),le.h.bindTexture2d(0),le=A;break t;case"detections":for(A=le.m[ae.stream],A||(A=new ko(le.h),le.m[ae.stream]=A),le=A,le.data||(le.data=new le.g.DetectionListData),le.data.reset(k.length),A=0;A<k.length;++A){P=k[A];var W=le.data,Z=W.setBoundingBox,X=A,Q=P.T,lt=new xi;Le(lt,1,Q.Z),Le(lt,2,Q.$),Le(lt,3,Q.height),Le(lt,4,Q.width),Le(lt,5,Q.rotation),Le(lt,6,Q.X);var Tt=Q=new zt;me(Tt,1,Ge(lt,1)),me(Tt,2,Ge(lt,2)),me(Tt,3,Ge(lt,3)),me(Tt,4,Ge(lt,4)),me(Tt,5,Ge(lt,5));var Ot=Ge(lt,6);if(Ot!=null&&Ot!=null){xt(Tt.g,48);var Mt=Tt.g,Yt=Ot;Ot=0>Yt,Yt=Math.abs(Yt);var Zt=Yt>>>0;for(Yt=Math.floor((Yt-Zt)/4294967296),Yt>>>=0,Ot&&(Yt=~Yt>>>0,Zt=(~Zt>>>0)+1,4294967295<Zt&&(Zt=0,Yt++,4294967295<Yt&&(Yt=0))),Bt=Zt,Jt=Yt,Ot=Bt,Zt=Jt;0<Zt||127<Ot;)Mt.push(Ot&127|128),Ot=(Ot>>>7|Zt<<25)>>>0,Zt>>>=7;Mt.push(Ot)}if(wo(lt,Tt),Q=Te(Q),Z.call(W,X,Q),P.O)for(W=0;W<P.O.length;++W)lt=P.O[W],Tt=!!lt.visibility,Z=le.data,X=Z.addNormalizedLandmark,Q=A,lt=Object.assign(Object.assign({},lt),{visibility:Tt?lt.visibility:0}),Tt=new gr,Le(Tt,1,lt.x),Le(Tt,2,lt.y),Le(Tt,3,lt.z),lt.visibility&&Le(Tt,4,lt.visibility),Mt=lt=new zt,me(Mt,1,Ge(Tt,1)),me(Mt,2,Ge(Tt,2)),me(Mt,3,Ge(Tt,3)),me(Mt,4,Ge(Tt,4)),me(Mt,5,Ge(Tt,5)),wo(Tt,Mt),lt=Te(lt),X.call(Z,Q,lt);if(P.M)for(W=0;W<P.M.length;++W){if(Z=le.data,X=Z.addClassification,Q=A,lt=P.M[W],Tt=new Je,Le(Tt,2,lt.Y),lt.index&&Le(Tt,1,lt.index),lt.label&&Le(Tt,3,lt.label),lt.displayName&&Le(Tt,4,lt.displayName),Mt=lt=new zt,Zt=Ge(Tt,1),Zt!=null&&Zt!=null)if(xt(Mt.g,8),Ot=Mt.g,0<=Zt)xt(Ot,Zt);else{for(Yt=0;9>Yt;Yt++)Ot.push(Zt&127|128),Zt>>=7;Ot.push(1)}me(Mt,2,Ge(Tt,2)),Ot=Ge(Tt,3),Ot!=null&&(Ot=at(Ot),xt(Mt.g,26),xt(Mt.g,Ot.length),ne(Mt,Mt.g.end()),ne(Mt,Ot)),Ot=Ge(Tt,4),Ot!=null&&(Ot=at(Ot),xt(Mt.g,34),xt(Mt.g,Ot.length),ne(Mt,Mt.g.end()),ne(Mt,Ot)),wo(Tt,Mt),lt=Te(lt),X.call(Z,Q,lt)}}le=le.data;break t;default:le={}}}switch(ve=le,ze=ae.stream,ae.type){case"video":Dt.pushTexture2d(Object.assign(Object.assign({},ve),{stream:ze,timestamp:wt}));break;case"detections":Ae=ve,Ae.stream=ze,Ae.timestamp=wt,Dt.pushDetectionList(Ae);break;default:throw Error("Unknown input config type: '"+ae.type+"'")}}return J.i.send(Dt),w(Ie,J.C,4);case 4:Dt.delete(),Ie.g=0}})})};function Zn(I,$,D){return Ln(I,function J(){var wt,Dt,Ct,Ft,Ht,ae,ve=this,ze,Ae,Ie,le,k,A,P,W;return F(J,function(Z){switch(Z.g){case 1:if(!D)return Z.return($);for(wt={},Dt=0,Ct=a(Object.keys(D)),Ft=Ct.next();!Ft.done;Ft=Ct.next())Ht=Ft.value,ae=D[Ht],typeof ae!="string"&&ae.type==="texture"&&$[ae.stream]!==void 0&&++Dt;1<Dt&&(ve.G=!1),ze=a(Object.keys(D)),Ft=ze.next();case 2:if(Ft.done){Z.g=4;break}if(Ae=Ft.value,Ie=D[Ae],typeof Ie=="string")return P=wt,W=Ae,w(Z,ha(ve,Ae,$[Ie]),14);if(le=$[Ie.stream],Ie.type==="detection_list"){if(le){for(var X=le.getRectList(),Q=le.getLandmarksList(),lt=le.getClassificationsList(),Tt=[],Ot=0;Ot<X.size();++Ot){var Mt=X.get(Ot);t:{var Yt=new xi;for(Mt=new q(Mt);j(Mt);)switch(Mt.i){case 13:var Zt=Rt(Mt);Le(Yt,1,Zt);break;case 21:Zt=Rt(Mt),Le(Yt,2,Zt);break;case 29:Zt=Rt(Mt),Le(Yt,3,Zt);break;case 37:Zt=Rt(Mt),Le(Yt,4,Zt);break;case 45:Zt=Rt(Mt),Le(Yt,5,Zt);break;case 48:Zt=ce(Mt.g),Le(Yt,6,Zt);break;default:if(!Wn(Yt,Mt))break t}}Yt={Z:_n(Yt,1),$:_n(Yt,2),height:_n(Yt,3),width:_n(Yt,4),rotation:_n(Yt,5,0),X:Xn(Yt,6,0)},Mt=mi(bi(Q.get(Ot)),gr).map(vo);var se=lt.get(Ot);t:for(Zt=new yi,se=new q(se);j(se);)switch(se.i){case 10:Zt.addClassification(At(se,new Je,Ws));break;default:if(!Wn(Zt,se))break t}Yt={T:Yt,O:Mt,M:Hi(Zt)},Tt.push(Yt)}X=Tt}else X=[];wt[Ae]=X,Z.g=7;break}if(Ie.type==="proto_list"){if(le){for(X=Array(le.size()),Q=0;Q<le.size();Q++)X[Q]=le.get(Q);le.delete()}else X=[];wt[Ae]=X,Z.g=7;break}if(le===void 0){Z.g=3;break}if(Ie.type==="float_list"){wt[Ae]=le,Z.g=7;break}if(Ie.type==="proto"){wt[Ae]=le,Z.g=7;break}if(Ie.type!=="texture")throw Error("Unknown output config type: '"+Ie.type+"'");return k=ve.s[Ae],k||(k=new Yr(ve.h,ve.D),ve.s[Ae]=k),w(Z,Yn(k,le,ve.G),13);case 13:A=Z.h,wt[Ae]=A;case 7:Ie.transform&&wt[Ae]&&(wt[Ae]=Ie.transform(wt[Ae])),Z.g=3;break;case 14:P[W]=Z.h;case 3:Ft=ze.next(),Z.g=2;break;case 4:return Z.return(wt)}})})}function ha(I,$,D){return Ln(I,function J(){var wt=this,Dt;return F(J,function(Ct){return typeof D=="number"||D instanceof Uint8Array||D instanceof wt.h.Uint8BlobList?Ct.return(D):D instanceof wt.h.Texture2dDataOut?(Dt=wt.s[$],Dt||(Dt=new Yr(wt.h,wt.D),wt.s[$]=Dt),Ct.return(Yn(Dt,D,wt.G))):Ct.return(void 0)})})}function yu(I,$){for(var D=$.name||"$",J=[].concat(u($.wants)),wt=new I.h.StringList,Dt=a($.wants),Ct=Dt.next();!Ct.done;Ct=Dt.next())wt.push_back(Ct.value);Dt=I.h.PacketListener.implement({onResults:function(Ft){for(var Ht={},ae=0;ae<$.wants.length;++ae)Ht[J[ae]]=Ft.get(ae);var ve=I.listeners[D];ve&&(I.C=Zn(I,Ht,$.outs).then(function(ze){ze=ve(ze);for(var Ae=0;Ae<$.wants.length;++Ae){var Ie=Ht[J[Ae]];typeof Ie=="object"&&Ie.hasOwnProperty&&Ie.hasOwnProperty("delete")&&Ie.delete()}ze&&(I.C=ze)}))}}),I.i.attachMultiListener(wt,Dt),wt.delete()}n.onResults=function(I,$){this.listeners[$||"$"]=I},G("Solution",Zr),G("OptionType",{BOOL:0,NUMBER:1,aa:2,0:"BOOL",1:"NUMBER",2:"STRING"});function Co(I){I=wi(I);var $=I.getMesh();if(!$)return I;var D=new Float32Array($.getVertexBufferList());$.getVertexBufferList=function(){return D};var J=new Uint32Array($.getIndexBufferList());return $.getIndexBufferList=function(){return J},I}var No={files:[{url:"face_mesh_solution_packed_assets_loader.js"},{simd:!0,url:"face_mesh_solution_simd_wasm_bin.js"},{simd:!1,url:"face_mesh_solution_wasm_bin.js"}],graph:{url:"face_mesh.binarypb"},listeners:[{wants:["multi_face_geometry","image_transformed","multi_face_landmarks"],outs:{image:"image_transformed",multiFaceGeometry:{type:"proto_list",stream:"multi_face_geometry",transform:function(I){return I.map(Co)}},multiFaceLandmarks:{type:"proto_list",stream:"multi_face_landmarks",transform:function(I){return I.map(function($){return mi(bi($),gr).map(vo)})}}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},enableFaceGeometry:{type:0,graphOptionXref:{calculatorName:"EnableFaceGeometryConstant",calculatorType:"ConstantSidePacketCalculator",fieldName:"bool_value"}},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},maxNumFaces:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorNumFaces",fieldName:"int_value"}},refineLandmarks:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorRefineLandmarks",fieldName:"bool_value"}},minDetectionConfidence:{type:1,graphOptionXref:{calculatorType:"TensorsToDetectionsCalculator",calculatorName:"facelandmarkfrontgpu__facedetectionshortrangegpu__facedetectionshortrangecommon__TensorsToDetectionsCalculator",fieldName:"min_score_thresh"}},minTrackingConfidence:{type:1,graphOptionXref:{calculatorType:"ThresholdingCalculator",calculatorName:"facelandmarkfrontgpu__facelandmarkgpu__ThresholdingCalculator",fieldName:"threshold"}},cameraNear:{type:1,graphOptionXref:{calculatorType:"FaceGeometryEnvGeneratorCalculator",fieldName:"near"}},cameraFar:{type:1,graphOptionXref:{calculatorType:"FaceGeometryEnvGeneratorCalculator",fieldName:"far"}},cameraVerticalFovDegrees:{type:1,graphOptionXref:{calculatorType:"FaceGeometryEnvGeneratorCalculator",fieldName:"vertical_fov_degrees"}}}},To=[[61,146],[146,91],[91,181],[181,84],[84,17],[17,314],[314,405],[405,321],[321,375],[375,291],[61,185],[185,40],[40,39],[39,37],[37,0],[0,267],[267,269],[269,270],[270,409],[409,291],[78,95],[95,88],[88,178],[178,87],[87,14],[14,317],[317,402],[402,318],[318,324],[324,308],[78,191],[191,80],[80,81],[81,82],[82,13],[13,312],[312,311],[311,310],[310,415],[415,308]],da=[[263,249],[249,390],[390,373],[373,374],[374,380],[380,381],[381,382],[382,362],[263,466],[466,388],[388,387],[387,386],[386,385],[385,384],[384,398],[398,362]],fa=[[276,283],[283,282],[282,295],[295,285],[300,293],[293,334],[334,296],[296,336]],$o=[[33,7],[7,163],[163,144],[144,145],[145,153],[153,154],[154,155],[155,133],[33,246],[246,161],[161,160],[160,159],[159,158],[158,157],[157,173],[173,133]],Eo=[[46,53],[53,52],[52,65],[65,55],[70,63],[63,105],[105,66],[66,107]],vi=[[10,338],[338,297],[297,332],[332,284],[284,251],[251,389],[389,356],[356,454],[454,323],[323,361],[361,288],[288,397],[397,365],[365,379],[379,378],[378,400],[400,377],[377,152],[152,148],[148,176],[176,149],[149,150],[150,136],[136,172],[172,58],[58,132],[132,93],[93,234],[234,127],[127,162],[162,21],[21,54],[54,103],[103,67],[67,109],[109,10]],pa=[].concat(u(To),u(da),u(fa),u($o),u(Eo),u(vi));function ma(I){I=I||{},I=Object.assign(Object.assign({},No),I),this.g=new Zr(I)}n=ma.prototype,n.close=function(){return this.g.close(),Promise.resolve()},n.onResults=function(I){this.g.onResults(I)},n.initialize=function(){return Ln(this,function I(){var $=this;return F(I,function(D){return w(D,$.g.initialize(),0)})})},n.reset=function(){this.g.reset()},n.send=function(I){return Ln(this,function $(){var D=this;return F($,function(J){return w(J,D.g.send(I),0)})})},n.setOptions=function(I){this.g.setOptions(I)},G("FACE_GEOMETRY",{Layout:{COLUMN_MAJOR:0,ROW_MAJOR:1,0:"COLUMN_MAJOR",1:"ROW_MAJOR"},PrimitiveType:{TRIANGLE:0,0:"TRIANGLE"},VertexType:{VERTEX_PT:0,0:"VERTEX_PT"},DEFAULT_CAMERA_PARAMS:{verticalFovDegrees:63,near:1,far:1e4}}),G("FaceMesh",ma),G("FACEMESH_LIPS",To),G("FACEMESH_LEFT_EYE",da),G("FACEMESH_LEFT_EYEBROW",fa),G("FACEMESH_LEFT_IRIS",[[474,475],[475,476],[476,477],[477,474]]),G("FACEMESH_RIGHT_EYE",$o),G("FACEMESH_RIGHT_EYEBROW",Eo),G("FACEMESH_RIGHT_IRIS",[[469,470],[470,471],[471,472],[472,469]]),G("FACEMESH_FACE_OVAL",vi),G("FACEMESH_CONTOURS",pa),G("FACEMESH_TESSELATION",[[127,34],[34,139],[139,127],[11,0],[0,37],[37,11],[232,231],[231,120],[120,232],[72,37],[37,39],[39,72],[128,121],[121,47],[47,128],[232,121],[121,128],[128,232],[104,69],[69,67],[67,104],[175,171],[171,148],[148,175],[118,50],[50,101],[101,118],[73,39],[39,40],[40,73],[9,151],[151,108],[108,9],[48,115],[115,131],[131,48],[194,204],[204,211],[211,194],[74,40],[40,185],[185,74],[80,42],[42,183],[183,80],[40,92],[92,186],[186,40],[230,229],[229,118],[118,230],[202,212],[212,214],[214,202],[83,18],[18,17],[17,83],[76,61],[61,146],[146,76],[160,29],[29,30],[30,160],[56,157],[157,173],[173,56],[106,204],[204,194],[194,106],[135,214],[214,192],[192,135],[203,165],[165,98],[98,203],[21,71],[71,68],[68,21],[51,45],[45,4],[4,51],[144,24],[24,23],[23,144],[77,146],[146,91],[91,77],[205,50],[50,187],[187,205],[201,200],[200,18],[18,201],[91,106],[106,182],[182,91],[90,91],[91,181],[181,90],[85,84],[84,17],[17,85],[206,203],[203,36],[36,206],[148,171],[171,140],[140,148],[92,40],[40,39],[39,92],[193,189],[189,244],[244,193],[159,158],[158,28],[28,159],[247,246],[246,161],[161,247],[236,3],[3,196],[196,236],[54,68],[68,104],[104,54],[193,168],[168,8],[8,193],[117,228],[228,31],[31,117],[189,193],[193,55],[55,189],[98,97],[97,99],[99,98],[126,47],[47,100],[100,126],[166,79],[79,218],[218,166],[155,154],[154,26],[26,155],[209,49],[49,131],[131,209],[135,136],[136,150],[150,135],[47,126],[126,217],[217,47],[223,52],[52,53],[53,223],[45,51],[51,134],[134,45],[211,170],[170,140],[140,211],[67,69],[69,108],[108,67],[43,106],[106,91],[91,43],[230,119],[119,120],[120,230],[226,130],[130,247],[247,226],[63,53],[53,52],[52,63],[238,20],[20,242],[242,238],[46,70],[70,156],[156,46],[78,62],[62,96],[96,78],[46,53],[53,63],[63,46],[143,34],[34,227],[227,143],[123,117],[117,111],[111,123],[44,125],[125,19],[19,44],[236,134],[134,51],[51,236],[216,206],[206,205],[205,216],[154,153],[153,22],[22,154],[39,37],[37,167],[167,39],[200,201],[201,208],[208,200],[36,142],[142,100],[100,36],[57,212],[212,202],[202,57],[20,60],[60,99],[99,20],[28,158],[158,157],[157,28],[35,226],[226,113],[113,35],[160,159],[159,27],[27,160],[204,202],[202,210],[210,204],[113,225],[225,46],[46,113],[43,202],[202,204],[204,43],[62,76],[76,77],[77,62],[137,123],[123,116],[116,137],[41,38],[38,72],[72,41],[203,129],[129,142],[142,203],[64,98],[98,240],[240,64],[49,102],[102,64],[64,49],[41,73],[73,74],[74,41],[212,216],[216,207],[207,212],[42,74],[74,184],[184,42],[169,170],[170,211],[211,169],[170,149],[149,176],[176,170],[105,66],[66,69],[69,105],[122,6],[6,168],[168,122],[123,147],[147,187],[187,123],[96,77],[77,90],[90,96],[65,55],[55,107],[107,65],[89,90],[90,180],[180,89],[101,100],[100,120],[120,101],[63,105],[105,104],[104,63],[93,137],[137,227],[227,93],[15,86],[86,85],[85,15],[129,102],[102,49],[49,129],[14,87],[87,86],[86,14],[55,8],[8,9],[9,55],[100,47],[47,121],[121,100],[145,23],[23,22],[22,145],[88,89],[89,179],[179,88],[6,122],[122,196],[196,6],[88,95],[95,96],[96,88],[138,172],[172,136],[136,138],[215,58],[58,172],[172,215],[115,48],[48,219],[219,115],[42,80],[80,81],[81,42],[195,3],[3,51],[51,195],[43,146],[146,61],[61,43],[171,175],[175,199],[199,171],[81,82],[82,38],[38,81],[53,46],[46,225],[225,53],[144,163],[163,110],[110,144],[52,65],[65,66],[66,52],[229,228],[228,117],[117,229],[34,127],[127,234],[234,34],[107,108],[108,69],[69,107],[109,108],[108,151],[151,109],[48,64],[64,235],[235,48],[62,78],[78,191],[191,62],[129,209],[209,126],[126,129],[111,35],[35,143],[143,111],[117,123],[123,50],[50,117],[222,65],[65,52],[52,222],[19,125],[125,141],[141,19],[221,55],[55,65],[65,221],[3,195],[195,197],[197,3],[25,7],[7,33],[33,25],[220,237],[237,44],[44,220],[70,71],[71,139],[139,70],[122,193],[193,245],[245,122],[247,130],[130,33],[33,247],[71,21],[21,162],[162,71],[170,169],[169,150],[150,170],[188,174],[174,196],[196,188],[216,186],[186,92],[92,216],[2,97],[97,167],[167,2],[141,125],[125,241],[241,141],[164,167],[167,37],[37,164],[72,38],[38,12],[12,72],[38,82],[82,13],[13,38],[63,68],[68,71],[71,63],[226,35],[35,111],[111,226],[101,50],[50,205],[205,101],[206,92],[92,165],[165,206],[209,198],[198,217],[217,209],[165,167],[167,97],[97,165],[220,115],[115,218],[218,220],[133,112],[112,243],[243,133],[239,238],[238,241],[241,239],[214,135],[135,169],[169,214],[190,173],[173,133],[133,190],[171,208],[208,32],[32,171],[125,44],[44,237],[237,125],[86,87],[87,178],[178,86],[85,86],[86,179],[179,85],[84,85],[85,180],[180,84],[83,84],[84,181],[181,83],[201,83],[83,182],[182,201],[137,93],[93,132],[132,137],[76,62],[62,183],[183,76],[61,76],[76,184],[184,61],[57,61],[61,185],[185,57],[212,57],[57,186],[186,212],[214,207],[207,187],[187,214],[34,143],[143,156],[156,34],[79,239],[239,237],[237,79],[123,137],[137,177],[177,123],[44,1],[1,4],[4,44],[201,194],[194,32],[32,201],[64,102],[102,129],[129,64],[213,215],[215,138],[138,213],[59,166],[166,219],[219,59],[242,99],[99,97],[97,242],[2,94],[94,141],[141,2],[75,59],[59,235],[235,75],[24,110],[110,228],[228,24],[25,130],[130,226],[226,25],[23,24],[24,229],[229,23],[22,23],[23,230],[230,22],[26,22],[22,231],[231,26],[112,26],[26,232],[232,112],[189,190],[190,243],[243,189],[221,56],[56,190],[190,221],[28,56],[56,221],[221,28],[27,28],[28,222],[222,27],[29,27],[27,223],[223,29],[30,29],[29,224],[224,30],[247,30],[30,225],[225,247],[238,79],[79,20],[20,238],[166,59],[59,75],[75,166],[60,75],[75,240],[240,60],[147,177],[177,215],[215,147],[20,79],[79,166],[166,20],[187,147],[147,213],[213,187],[112,233],[233,244],[244,112],[233,128],[128,245],[245,233],[128,114],[114,188],[188,128],[114,217],[217,174],[174,114],[131,115],[115,220],[220,131],[217,198],[198,236],[236,217],[198,131],[131,134],[134,198],[177,132],[132,58],[58,177],[143,35],[35,124],[124,143],[110,163],[163,7],[7,110],[228,110],[110,25],[25,228],[356,389],[389,368],[368,356],[11,302],[302,267],[267,11],[452,350],[350,349],[349,452],[302,303],[303,269],[269,302],[357,343],[343,277],[277,357],[452,453],[453,357],[357,452],[333,332],[332,297],[297,333],[175,152],[152,377],[377,175],[347,348],[348,330],[330,347],[303,304],[304,270],[270,303],[9,336],[336,337],[337,9],[278,279],[279,360],[360,278],[418,262],[262,431],[431,418],[304,408],[408,409],[409,304],[310,415],[415,407],[407,310],[270,409],[409,410],[410,270],[450,348],[348,347],[347,450],[422,430],[430,434],[434,422],[313,314],[314,17],[17,313],[306,307],[307,375],[375,306],[387,388],[388,260],[260,387],[286,414],[414,398],[398,286],[335,406],[406,418],[418,335],[364,367],[367,416],[416,364],[423,358],[358,327],[327,423],[251,284],[284,298],[298,251],[281,5],[5,4],[4,281],[373,374],[374,253],[253,373],[307,320],[320,321],[321,307],[425,427],[427,411],[411,425],[421,313],[313,18],[18,421],[321,405],[405,406],[406,321],[320,404],[404,405],[405,320],[315,16],[16,17],[17,315],[426,425],[425,266],[266,426],[377,400],[400,369],[369,377],[322,391],[391,269],[269,322],[417,465],[465,464],[464,417],[386,257],[257,258],[258,386],[466,260],[260,388],[388,466],[456,399],[399,419],[419,456],[284,332],[332,333],[333,284],[417,285],[285,8],[8,417],[346,340],[340,261],[261,346],[413,441],[441,285],[285,413],[327,460],[460,328],[328,327],[355,371],[371,329],[329,355],[392,439],[439,438],[438,392],[382,341],[341,256],[256,382],[429,420],[420,360],[360,429],[364,394],[394,379],[379,364],[277,343],[343,437],[437,277],[443,444],[444,283],[283,443],[275,440],[440,363],[363,275],[431,262],[262,369],[369,431],[297,338],[338,337],[337,297],[273,375],[375,321],[321,273],[450,451],[451,349],[349,450],[446,342],[342,467],[467,446],[293,334],[334,282],[282,293],[458,461],[461,462],[462,458],[276,353],[353,383],[383,276],[308,324],[324,325],[325,308],[276,300],[300,293],[293,276],[372,345],[345,447],[447,372],[352,345],[345,340],[340,352],[274,1],[1,19],[19,274],[456,248],[248,281],[281,456],[436,427],[427,425],[425,436],[381,256],[256,252],[252,381],[269,391],[391,393],[393,269],[200,199],[199,428],[428,200],[266,330],[330,329],[329,266],[287,273],[273,422],[422,287],[250,462],[462,328],[328,250],[258,286],[286,384],[384,258],[265,353],[353,342],[342,265],[387,259],[259,257],[257,387],[424,431],[431,430],[430,424],[342,353],[353,276],[276,342],[273,335],[335,424],[424,273],[292,325],[325,307],[307,292],[366,447],[447,345],[345,366],[271,303],[303,302],[302,271],[423,266],[266,371],[371,423],[294,455],[455,460],[460,294],[279,278],[278,294],[294,279],[271,272],[272,304],[304,271],[432,434],[434,427],[427,432],[272,407],[407,408],[408,272],[394,430],[430,431],[431,394],[395,369],[369,400],[400,395],[334,333],[333,299],[299,334],[351,417],[417,168],[168,351],[352,280],[280,411],[411,352],[325,319],[319,320],[320,325],[295,296],[296,336],[336,295],[319,403],[403,404],[404,319],[330,348],[348,349],[349,330],[293,298],[298,333],[333,293],[323,454],[454,447],[447,323],[15,16],[16,315],[315,15],[358,429],[429,279],[279,358],[14,15],[15,316],[316,14],[285,336],[336,9],[9,285],[329,349],[349,350],[350,329],[374,380],[380,252],[252,374],[318,402],[402,403],[403,318],[6,197],[197,419],[419,6],[318,319],[319,325],[325,318],[367,364],[364,365],[365,367],[435,367],[367,397],[397,435],[344,438],[438,439],[439,344],[272,271],[271,311],[311,272],[195,5],[5,281],[281,195],[273,287],[287,291],[291,273],[396,428],[428,199],[199,396],[311,271],[271,268],[268,311],[283,444],[444,445],[445,283],[373,254],[254,339],[339,373],[282,334],[334,296],[296,282],[449,347],[347,346],[346,449],[264,447],[447,454],[454,264],[336,296],[296,299],[299,336],[338,10],[10,151],[151,338],[278,439],[439,455],[455,278],[292,407],[407,415],[415,292],[358,371],[371,355],[355,358],[340,345],[345,372],[372,340],[346,347],[347,280],[280,346],[442,443],[443,282],[282,442],[19,94],[94,370],[370,19],[441,442],[442,295],[295,441],[248,419],[419,197],[197,248],[263,255],[255,359],[359,263],[440,275],[275,274],[274,440],[300,383],[383,368],[368,300],[351,412],[412,465],[465,351],[263,467],[467,466],[466,263],[301,368],[368,389],[389,301],[395,378],[378,379],[379,395],[412,351],[351,419],[419,412],[436,426],[426,322],[322,436],[2,164],[164,393],[393,2],[370,462],[462,461],[461,370],[164,0],[0,267],[267,164],[302,11],[11,12],[12,302],[268,12],[12,13],[13,268],[293,300],[300,301],[301,293],[446,261],[261,340],[340,446],[330,266],[266,425],[425,330],[426,423],[423,391],[391,426],[429,355],[355,437],[437,429],[391,327],[327,326],[326,391],[440,457],[457,438],[438,440],[341,382],[382,362],[362,341],[459,457],[457,461],[461,459],[434,430],[430,394],[394,434],[414,463],[463,362],[362,414],[396,369],[369,262],[262,396],[354,461],[461,457],[457,354],[316,403],[403,402],[402,316],[315,404],[404,403],[403,315],[314,405],[405,404],[404,314],[313,406],[406,405],[405,313],[421,418],[418,406],[406,421],[366,401],[401,361],[361,366],[306,408],[408,407],[407,306],[291,409],[409,408],[408,291],[287,410],[410,409],[409,287],[432,436],[436,410],[410,432],[434,416],[416,411],[411,434],[264,368],[368,383],[383,264],[309,438],[438,457],[457,309],[352,376],[376,401],[401,352],[274,275],[275,4],[4,274],[421,428],[428,262],[262,421],[294,327],[327,358],[358,294],[433,416],[416,367],[367,433],[289,455],[455,439],[439,289],[462,370],[370,326],[326,462],[2,326],[326,370],[370,2],[305,460],[460,455],[455,305],[254,449],[449,448],[448,254],[255,261],[261,446],[446,255],[253,450],[450,449],[449,253],[252,451],[451,450],[450,252],[256,452],[452,451],[451,256],[341,453],[453,452],[452,341],[413,464],[464,463],[463,413],[441,413],[413,414],[414,441],[258,442],[442,441],[441,258],[257,443],[443,442],[442,257],[259,444],[444,443],[443,259],[260,445],[445,444],[444,260],[467,342],[342,445],[445,467],[459,458],[458,250],[250,459],[289,392],[392,290],[290,289],[290,328],[328,460],[460,290],[376,433],[433,435],[435,376],[250,290],[290,392],[392,250],[411,416],[416,433],[433,411],[341,463],[463,464],[464,341],[453,464],[464,465],[465,453],[357,465],[465,412],[412,357],[343,412],[412,399],[399,343],[360,363],[363,440],[440,360],[437,399],[399,456],[456,437],[420,456],[456,363],[363,420],[401,435],[435,288],[288,401],[372,383],[383,353],[353,372],[339,255],[255,249],[249,339],[448,261],[261,255],[255,448],[133,243],[243,190],[190,133],[133,155],[155,112],[112,133],[33,246],[246,247],[247,33],[33,130],[130,25],[25,33],[398,384],[384,286],[286,398],[362,398],[398,414],[414,362],[362,463],[463,341],[341,362],[263,359],[359,467],[467,263],[263,249],[249,255],[255,263],[466,467],[467,260],[260,466],[75,60],[60,166],[166,75],[238,239],[239,79],[79,238],[162,127],[127,139],[139,162],[72,11],[11,37],[37,72],[121,232],[232,120],[120,121],[73,72],[72,39],[39,73],[114,128],[128,47],[47,114],[233,232],[232,128],[128,233],[103,104],[104,67],[67,103],[152,175],[175,148],[148,152],[119,118],[118,101],[101,119],[74,73],[73,40],[40,74],[107,9],[9,108],[108,107],[49,48],[48,131],[131,49],[32,194],[194,211],[211,32],[184,74],[74,185],[185,184],[191,80],[80,183],[183,191],[185,40],[40,186],[186,185],[119,230],[230,118],[118,119],[210,202],[202,214],[214,210],[84,83],[83,17],[17,84],[77,76],[76,146],[146,77],[161,160],[160,30],[30,161],[190,56],[56,173],[173,190],[182,106],[106,194],[194,182],[138,135],[135,192],[192,138],[129,203],[203,98],[98,129],[54,21],[21,68],[68,54],[5,51],[51,4],[4,5],[145,144],[144,23],[23,145],[90,77],[77,91],[91,90],[207,205],[205,187],[187,207],[83,201],[201,18],[18,83],[181,91],[91,182],[182,181],[180,90],[90,181],[181,180],[16,85],[85,17],[17,16],[205,206],[206,36],[36,205],[176,148],[148,140],[140,176],[165,92],[92,39],[39,165],[245,193],[193,244],[244,245],[27,159],[159,28],[28,27],[30,247],[247,161],[161,30],[174,236],[236,196],[196,174],[103,54],[54,104],[104,103],[55,193],[193,8],[8,55],[111,117],[117,31],[31,111],[221,189],[189,55],[55,221],[240,98],[98,99],[99,240],[142,126],[126,100],[100,142],[219,166],[166,218],[218,219],[112,155],[155,26],[26,112],[198,209],[209,131],[131,198],[169,135],[135,150],[150,169],[114,47],[47,217],[217,114],[224,223],[223,53],[53,224],[220,45],[45,134],[134,220],[32,211],[211,140],[140,32],[109,67],[67,108],[108,109],[146,43],[43,91],[91,146],[231,230],[230,120],[120,231],[113,226],[226,247],[247,113],[105,63],[63,52],[52,105],[241,238],[238,242],[242,241],[124,46],[46,156],[156,124],[95,78],[78,96],[96,95],[70,46],[46,63],[63,70],[116,143],[143,227],[227,116],[116,123],[123,111],[111,116],[1,44],[44,19],[19,1],[3,236],[236,51],[51,3],[207,216],[216,205],[205,207],[26,154],[154,22],[22,26],[165,39],[39,167],[167,165],[199,200],[200,208],[208,199],[101,36],[36,100],[100,101],[43,57],[57,202],[202,43],[242,20],[20,99],[99,242],[56,28],[28,157],[157,56],[124,35],[35,113],[113,124],[29,160],[160,27],[27,29],[211,204],[204,210],[210,211],[124,113],[113,46],[46,124],[106,43],[43,204],[204,106],[96,62],[62,77],[77,96],[227,137],[137,116],[116,227],[73,41],[41,72],[72,73],[36,203],[203,142],[142,36],[235,64],[64,240],[240,235],[48,49],[49,64],[64,48],[42,41],[41,74],[74,42],[214,212],[212,207],[207,214],[183,42],[42,184],[184,183],[210,169],[169,211],[211,210],[140,170],[170,176],[176,140],[104,105],[105,69],[69,104],[193,122],[122,168],[168,193],[50,123],[123,187],[187,50],[89,96],[96,90],[90,89],[66,65],[65,107],[107,66],[179,89],[89,180],[180,179],[119,101],[101,120],[120,119],[68,63],[63,104],[104,68],[234,93],[93,227],[227,234],[16,15],[15,85],[85,16],[209,129],[129,49],[49,209],[15,14],[14,86],[86,15],[107,55],[55,9],[9,107],[120,100],[100,121],[121,120],[153,145],[145,22],[22,153],[178,88],[88,179],[179,178],[197,6],[6,196],[196,197],[89,88],[88,96],[96,89],[135,138],[138,136],[136,135],[138,215],[215,172],[172,138],[218,115],[115,219],[219,218],[41,42],[42,81],[81,41],[5,195],[195,51],[51,5],[57,43],[43,61],[61,57],[208,171],[171,199],[199,208],[41,81],[81,38],[38,41],[224,53],[53,225],[225,224],[24,144],[144,110],[110,24],[105,52],[52,66],[66,105],[118,229],[229,117],[117,118],[227,34],[34,234],[234,227],[66,107],[107,69],[69,66],[10,109],[109,151],[151,10],[219,48],[48,235],[235,219],[183,62],[62,191],[191,183],[142,129],[129,126],[126,142],[116,111],[111,143],[143,116],[118,117],[117,50],[50,118],[223,222],[222,52],[52,223],[94,19],[19,141],[141,94],[222,221],[221,65],[65,222],[196,3],[3,197],[197,196],[45,220],[220,44],[44,45],[156,70],[70,139],[139,156],[188,122],[122,245],[245,188],[139,71],[71,162],[162,139],[149,170],[170,150],[150,149],[122,188],[188,196],[196,122],[206,216],[216,92],[92,206],[164,2],[2,167],[167,164],[242,141],[141,241],[241,242],[0,164],[164,37],[37,0],[11,72],[72,12],[12,11],[12,38],[38,13],[13,12],[70,63],[63,71],[71,70],[31,226],[226,111],[111,31],[36,101],[101,205],[205,36],[203,206],[206,165],[165,203],[126,209],[209,217],[217,126],[98,165],[165,97],[97,98],[237,220],[220,218],[218,237],[237,239],[239,241],[241,237],[210,214],[214,169],[169,210],[140,171],[171,32],[32,140],[241,125],[125,237],[237,241],[179,86],[86,178],[178,179],[180,85],[85,179],[179,180],[181,84],[84,180],[180,181],[182,83],[83,181],[181,182],[194,201],[201,182],[182,194],[177,137],[137,132],[132,177],[184,76],[76,183],[183,184],[185,61],[61,184],[184,185],[186,57],[57,185],[185,186],[216,212],[212,186],[186,216],[192,214],[214,187],[187,192],[139,34],[34,156],[156,139],[218,79],[79,237],[237,218],[147,123],[123,177],[177,147],[45,44],[44,4],[4,45],[208,201],[201,32],[32,208],[98,64],[64,129],[129,98],[192,213],[213,138],[138,192],[235,59],[59,219],[219,235],[141,242],[242,97],[97,141],[97,2],[2,141],[141,97],[240,75],[75,235],[235,240],[229,24],[24,228],[228,229],[31,25],[25,226],[226,31],[230,23],[23,229],[229,230],[231,22],[22,230],[230,231],[232,26],[26,231],[231,232],[233,112],[112,232],[232,233],[244,189],[189,243],[243,244],[189,221],[221,190],[190,189],[222,28],[28,221],[221,222],[223,27],[27,222],[222,223],[224,29],[29,223],[223,224],[225,30],[30,224],[224,225],[113,247],[247,225],[225,113],[99,60],[60,240],[240,99],[213,147],[147,215],[215,213],[60,20],[20,166],[166,60],[192,187],[187,213],[213,192],[243,112],[112,244],[244,243],[244,233],[233,245],[245,244],[245,128],[128,188],[188,245],[188,114],[114,174],[174,188],[134,131],[131,220],[220,134],[174,217],[217,236],[236,174],[236,198],[198,134],[134,236],[215,177],[177,58],[58,215],[156,143],[143,124],[124,156],[25,110],[110,7],[7,25],[31,228],[228,25],[25,31],[264,356],[356,368],[368,264],[0,11],[11,267],[267,0],[451,452],[452,349],[349,451],[267,302],[302,269],[269,267],[350,357],[357,277],[277,350],[350,452],[452,357],[357,350],[299,333],[333,297],[297,299],[396,175],[175,377],[377,396],[280,347],[347,330],[330,280],[269,303],[303,270],[270,269],[151,9],[9,337],[337,151],[344,278],[278,360],[360,344],[424,418],[418,431],[431,424],[270,304],[304,409],[409,270],[272,310],[310,407],[407,272],[322,270],[270,410],[410,322],[449,450],[450,347],[347,449],[432,422],[422,434],[434,432],[18,313],[313,17],[17,18],[291,306],[306,375],[375,291],[259,387],[387,260],[260,259],[424,335],[335,418],[418,424],[434,364],[364,416],[416,434],[391,423],[423,327],[327,391],[301,251],[251,298],[298,301],[275,281],[281,4],[4,275],[254,373],[373,253],[253,254],[375,307],[307,321],[321,375],[280,425],[425,411],[411,280],[200,421],[421,18],[18,200],[335,321],[321,406],[406,335],[321,320],[320,405],[405,321],[314,315],[315,17],[17,314],[423,426],[426,266],[266,423],[396,377],[377,369],[369,396],[270,322],[322,269],[269,270],[413,417],[417,464],[464,413],[385,386],[386,258],[258,385],[248,456],[456,419],[419,248],[298,284],[284,333],[333,298],[168,417],[417,8],[8,168],[448,346],[346,261],[261,448],[417,413],[413,285],[285,417],[326,327],[327,328],[328,326],[277,355],[355,329],[329,277],[309,392],[392,438],[438,309],[381,382],[382,256],[256,381],[279,429],[429,360],[360,279],[365,364],[364,379],[379,365],[355,277],[277,437],[437,355],[282,443],[443,283],[283,282],[281,275],[275,363],[363,281],[395,431],[431,369],[369,395],[299,297],[297,337],[337,299],[335,273],[273,321],[321,335],[348,450],[450,349],[349,348],[359,446],[446,467],[467,359],[283,293],[293,282],[282,283],[250,458],[458,462],[462,250],[300,276],[276,383],[383,300],[292,308],[308,325],[325,292],[283,276],[276,293],[293,283],[264,372],[372,447],[447,264],[346,352],[352,340],[340,346],[354,274],[274,19],[19,354],[363,456],[456,281],[281,363],[426,436],[436,425],[425,426],[380,381],[381,252],[252,380],[267,269],[269,393],[393,267],[421,200],[200,428],[428,421],[371,266],[266,329],[329,371],[432,287],[287,422],[422,432],[290,250],[250,328],[328,290],[385,258],[258,384],[384,385],[446,265],[265,342],[342,446],[386,387],[387,257],[257,386],[422,424],[424,430],[430,422],[445,342],[342,276],[276,445],[422,273],[273,424],[424,422],[306,292],[292,307],[307,306],[352,366],[366,345],[345,352],[268,271],[271,302],[302,268],[358,423],[423,371],[371,358],[327,294],[294,460],[460,327],[331,279],[279,294],[294,331],[303,271],[271,304],[304,303],[436,432],[432,427],[427,436],[304,272],[272,408],[408,304],[395,394],[394,431],[431,395],[378,395],[395,400],[400,378],[296,334],[334,299],[299,296],[6,351],[351,168],[168,6],[376,352],[352,411],[411,376],[307,325],[325,320],[320,307],[285,295],[295,336],[336,285],[320,319],[319,404],[404,320],[329,330],[330,349],[349,329],[334,293],[293,333],[333,334],[366,323],[323,447],[447,366],[316,15],[15,315],[315,316],[331,358],[358,279],[279,331],[317,14],[14,316],[316,317],[8,285],[285,9],[9,8],[277,329],[329,350],[350,277],[253,374],[374,252],[252,253],[319,318],[318,403],[403,319],[351,6],[6,419],[419,351],[324,318],[318,325],[325,324],[397,367],[367,365],[365,397],[288,435],[435,397],[397,288],[278,344],[344,439],[439,278],[310,272],[272,311],[311,310],[248,195],[195,281],[281,248],[375,273],[273,291],[291,375],[175,396],[396,199],[199,175],[312,311],[311,268],[268,312],[276,283],[283,445],[445,276],[390,373],[373,339],[339,390],[295,282],[282,296],[296,295],[448,449],[449,346],[346,448],[356,264],[264,454],[454,356],[337,336],[336,299],[299,337],[337,338],[338,151],[151,337],[294,278],[278,455],[455,294],[308,292],[292,415],[415,308],[429,358],[358,355],[355,429],[265,340],[340,372],[372,265],[352,346],[346,280],[280,352],[295,442],[442,282],[282,295],[354,19],[19,370],[370,354],[285,441],[441,295],[295,285],[195,248],[248,197],[197,195],[457,440],[440,274],[274,457],[301,300],[300,368],[368,301],[417,351],[351,465],[465,417],[251,301],[301,389],[389,251],[394,395],[395,379],[379,394],[399,412],[412,419],[419,399],[410,436],[436,322],[322,410],[326,2],[2,393],[393,326],[354,370],[370,461],[461,354],[393,164],[164,267],[267,393],[268,302],[302,12],[12,268],[312,268],[268,13],[13,312],[298,293],[293,301],[301,298],[265,446],[446,340],[340,265],[280,330],[330,425],[425,280],[322,426],[426,391],[391,322],[420,429],[429,437],[437,420],[393,391],[391,326],[326,393],[344,440],[440,438],[438,344],[458,459],[459,461],[461,458],[364,434],[434,394],[394,364],[428,396],[396,262],[262,428],[274,354],[354,457],[457,274],[317,316],[316,402],[402,317],[316,315],[315,403],[403,316],[315,314],[314,404],[404,315],[314,313],[313,405],[405,314],[313,421],[421,406],[406,313],[323,366],[366,361],[361,323],[292,306],[306,407],[407,292],[306,291],[291,408],[408,306],[291,287],[287,409],[409,291],[287,432],[432,410],[410,287],[427,434],[434,411],[411,427],[372,264],[264,383],[383,372],[459,309],[309,457],[457,459],[366,352],[352,401],[401,366],[1,274],[274,4],[4,1],[418,421],[421,262],[262,418],[331,294],[294,358],[358,331],[435,433],[433,367],[367,435],[392,289],[289,439],[439,392],[328,462],[462,326],[326,328],[94,2],[2,370],[370,94],[289,305],[305,455],[455,289],[339,254],[254,448],[448,339],[359,255],[255,446],[446,359],[254,253],[253,449],[449,254],[253,252],[252,450],[450,253],[252,256],[256,451],[451,252],[256,341],[341,452],[452,256],[414,413],[413,463],[463,414],[286,441],[441,414],[414,286],[286,258],[258,441],[441,286],[258,257],[257,442],[442,258],[257,259],[259,443],[443,257],[259,260],[260,444],[444,259],[260,467],[467,445],[445,260],[309,459],[459,250],[250,309],[305,289],[289,290],[290,305],[305,290],[290,460],[460,305],[401,376],[376,435],[435,401],[309,250],[250,392],[392,309],[376,411],[411,433],[433,376],[453,341],[341,464],[464,453],[357,453],[453,465],[465,357],[343,357],[357,412],[412,343],[437,343],[343,399],[399,437],[344,360],[360,440],[440,344],[420,437],[437,456],[456,420],[360,420],[420,363],[363,360],[361,401],[401,288],[288,361],[265,372],[372,353],[353,265],[390,339],[339,249],[249,390],[339,448],[448,255],[255,339]]),G("matrixDataToMatrix",function(I){for(var $=I.getCols(),D=I.getRows(),J=I.getPackedDataList(),wt=[],Dt=0;Dt<D;Dt++)wt.push(Array($));for(Dt=0;Dt<D;Dt++)for(var Ct=0;Ct<$;Ct++){var Ft=I.getLayout()===1?Dt*$+Ct:Ct*D+Dt;wt[Dt][Ct]=J[Ft]}return wt}),G("VERSION","0.4.1633559619")}).call(ks);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cN=1e-7,hN=1e-4;class M1{constructor(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}get(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)}set(t,e){this.dataIdsCount++,this.data.set(t,e)}has(t){return this.data.has(t)}delete(t){return this.dataIdsCount--,this.data.delete(t)}numDataIds(){return this.dataIdsCount}}class Pf{refCount(t){return nr("refCount")}incRef(t){return nr("incRef")}timerAvailable(){return!0}time(t){return nr("time")}read(t){return nr("read")}readSync(t){return nr("readSync")}readToGPU(t,e){return nr("readToGPU")}numDataIds(){return nr("numDataIds")}disposeData(t,e){return nr("disposeData")}write(t,e,s){return nr("write")}move(t,e,s,r,i){return nr("move")}createTensorFromGPUData(t,e,s){return nr("createTensorFromGPUData")}memory(){return nr("memory")}floatPrecision(){return nr("floatPrecision")}epsilon(){return this.floatPrecision()===32?cN:hN}dispose(){return nr("dispose")}}function nr(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z1(n){let t=n.length,e=0;for(;t>0;)e=Math.random()*t|0,t--,Zi(n,t,e)}function dN(n,t){if(n.length!==t.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${n.length}Second array length was ${t.length}`);let e=n.length,s=0;for(;e>0;)s=Math.random()*e|0,e--,Zi(n,e,s),Zi(t,e,s)}function Bo(n,t,e){return Math.max(n,Math.min(t,e))}function Mf(n){return n%2===0?n:n+1}function Zi(n,t,e){const s=n[t];n[t]=n[e],n[e]=s}function ux(n){let t=0;for(let e=0;e<n.length;e++)t+=n[e];return t}function fN(n,t){const e=Math.random();return t*e+(1-e)*n}function pN(n,t){let e=0;for(let s=0;s<n.length;s++){const r=Number(n[s])-Number(t[s]);e+=r*r}return e}function V(n,t){if(!n)throw new Error(typeof t=="string"?t:t())}function hs(n,t,e=""){V(Ve(n,t),()=>e+` Shapes ${n} and ${t} must match`)}function qa(n){V(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function Et(n){if(n.length===0)return 1;let t=n[0];for(let e=1;e<n.length;e++)t*=n[e];return t}function mN(n){return n.length===0}function lx(n,t){if(n===t)return!0;if(n==null||t==null||n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!==null&&t[e]!==null&&n[e]!==t[e])return!1;return!0}function Ve(n,t){if(n===t)return!0;if(n==null||t==null||n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!==t[e])return!1;return!0}function Oa(n){return n%1===0}function gN(n){if(Math.tanh!=null)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;{const t=Math.exp(2*n);return(t-1)/(t+1)}}function ef(n){const t=Math.ceil(Math.sqrt(n));return[t,Math.ceil(n/t)]}function yN(n){const t=new Uint32Array(n);for(let e=0;e<n;++e)t[e]=e;return z1(t),t}function Ea(n,t){return t<=n.length?n:n+" ".repeat(t-n.length)}function Bg(n,t=r=>0,e,s){return new Promise((r,i)=>{let o=0;const a=()=>{if(n()){r();return}o++;const u=t(o);if(e!=null&&o>=e){i();return}s!=null?s(a,u):setTimeout(a,u)};a()})}function B1(n,t){let e=1,s=-1;for(let i=0;i<n.length;++i)if(n[i]>=0)e*=n[i];else if(n[i]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${i}`);s=i}else if(n[i]<0)throw Error(`Shapes can not be < 0. Found ${n[i]} at dim ${i}`);if(s===-1){if(t>0&&t!==e)throw Error(`Size(${t}) must match the product of shape ${n}`);return n}if(e===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(t%e!==0)throw Error(`The implicit shape can't be a fractional number. Got ${t} / ${e}`);const r=n.slice();return r[s]=t/e,r}function Pe(n,t){const e=t.length;return n=n==null?t.map((s,r)=>r):[].concat(n),V(n.every(s=>s>=-e&&s<e),()=>`All values in axis param must be in range [-${e}, ${e}) but got axis ${n}`),V(n.every(s=>Oa(s)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(s=>s<0?e+s:s)}function ho(n,t){const e=[],s=[],r=t!=null&&Array.isArray(t)&&t.length===0,i=t==null||r?null:Pe(t,n).sort();let o=0;for(let a=0;a<n.length;++a){if(i!=null){if(i[o]===a&&n[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${n[a]}' is not 1`);(i[o]==null||i[o]>a)&&n[a]===1&&(e.push(n[a]),s.push(a)),i[o]<=a&&o++}n[a]!==1&&(e.push(n[a]),s.push(a))}return{newShape:e,keptDims:s}}function ss(n,t){return En(n,t)}function En(n,t){let e=null;if(n==null||n==="float32")e=new Float32Array(t);else if(n==="int32")e=new Int32Array(t);else if(n==="bool")e=new Uint8Array(t);else if(n==="string")e=new Array(t);else throw new Error(`Unknown data type ${n}`);return e}function cx(n,t){for(let e=0;e<n.length;e++){const s=n[e];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${t} being uploaded contains ${s}.`)}}function hx(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function V1(n,t){return!(t==="complex64"||t==="float32"&&n!=="complex64"||t==="int32"&&n!=="float32"&&n!=="complex64"||t==="bool"&&n==="bool")}function yc(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function dx(n){if(n==null)return 0;let t=0;return n.forEach(e=>t+=e.length),t}function $i(n){return typeof n=="string"||n instanceof String}function fx(n){return typeof n=="boolean"}function nf(n){return typeof n=="number"}function Xa(n){return Array.isArray(n)?Xa(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":nf(n)?"float32":$i(n)?"string":fx(n)?"bool":"float32"}function Vo(n){return!!(n&&n.constructor&&n.call&&n.apply)}function sf(n,t){for(let e=t;e<n;++e)if(n%e===0)return e;return n}function ge(n){const t=n.length;if(t<2)return[];const e=new Array(t-1);e[t-2]=n[t-1];for(let s=t-3;s>=0;--s)e[s]=e[s+1]*n[s+1];return e}function px(n,t,e,s=!1){const r=new Array;if(t.length===1){const i=t[0]*(s?2:1);for(let o=0;o<i;o++)r[o]=e[n+o]}else{const i=t[0],o=t.slice(1),a=o.reduce((u,l)=>u*l)*(s?2:1);for(let u=0;u<i;u++)r[u]=px(n+u*a,o,e,s)}return r}function Ir(n,t,e=!1){if(n.length===0)return t[0];const s=n.reduce((r,i)=>r*i)*(e?2:1);if(s===0)return[];if(s!==t.length)throw new Error(`[${n}] does not match the input size ${t.length}${e?" for a complex tensor":""}.`);return px(0,n,t,e)}function mx(n,t){if(Array.isArray(n))return n;if(t==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(t==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(t==="bool"||t==="string")return Uint8Array.from(new Int32Array(n));throw new Error(`Unknown dtype ${t}`)}function zf(n,t){const e=ls(n,t);for(let s=0;s<e.length;s++)e[s]=1;return e}function ls(n,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(n);if(t==="int32")return new Int32Array(n);if(t==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${t}`)}function U1(n,t){const e=n.reduce((s,r)=>s*r,1);if(t==null||t==="float32")return Ir(n,new Float32Array(e));if(t==="int32")return Ir(n,new Int32Array(e));if(t==="bool")return Ir(n,new Uint8Array(e));throw new Error(`Unknown data type ${t}`)}function fr(n){n.forEach(t=>{V(Number.isInteger(t)&&t>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function ri(n,t,e){if(t===0)return 0;if(t===1)return n[0];let s=n[n.length-1];for(let r=0;r<n.length-1;++r)s+=e[r]*n[r];return s}function Ya(n,t,e){if(t===0)return[];if(t===1)return[n];const s=new Array(t);for(let r=0;r<s.length-1;++r)s[r]=Math.floor(n/e[r]),n-=s[r]*e[r];return s[s.length-1]=n,s}function Uo(n){return n&&n.then&&typeof n.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uy="tfjsflags";class gx{constructor(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=bN,this.populateURLFlags()}setPlatform(t,e){this.platform!=null&&(vt().getBool("IS_TEST")||vt().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${t}.`)),this.platformName=t,this.platform=e}registerFlag(t,e,s){if(this.flagRegistry[t]={evaluationFn:e,setHook:s},this.urlFlags[t]!=null){const r=this.urlFlags[t];vt().getBool("IS_TEST")||vt().getBool("PROD")||console.warn(`Setting feature override from URL ${t}: ${r}.`),this.set(t,r)}}async getAsync(t){return t in this.flags?this.flags[t]:(this.flags[t]=await this.evaluateFlag(t),this.flags[t])}get(t){if(t in this.flags)return this.flags[t];const e=this.evaluateFlag(t);if(Uo(e))throw new Error(`Flag ${t} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[t]=e,this.flags[t]}getNumber(t){return this.get(t)}getBool(t){return this.get(t)}getString(t){return this.get(t)}getFlags(){return this.flags}get features(){return this.flags}set(t,e){if(this.flagRegistry[t]==null)throw new Error(`Cannot set flag ${t} as it has not been registered.`);this.flags[t]=e,this.flagRegistry[t].setHook!=null&&this.flagRegistry[t].setHook(e)}evaluateFlag(t){if(this.flagRegistry[t]==null)throw new Error(`Cannot evaluate flag '${t}': no evaluation function found.`);return this.flagRegistry[t].evaluationFn()}setFlags(t){this.flags=Object.assign({},t)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const t=this.getQueryParams(this.global.location.search);Uy in t&&t[Uy].split(",").forEach(s=>{const[r,i]=s.split(":");this.urlFlags[r]=wN(r,i)})}}function bN(n){const t={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(e,...s)=>(xN(t,s[0],s[1]),s.join("="))),t}function xN(n,t,e){n[decodeURIComponent(t)]=decodeURIComponent(e||"")}function wN(n,t){const e=t.toLowerCase();return e==="true"||e==="false"?e==="true":`${+e}`===e?+e:t}function vt(){return W1}let W1=null;function vN(n){W1=n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let ig;function yx(){if(ig==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");ig=n}return ig}function kN(){const n=yx();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function G1(n,t){const e=kN();if(e.has(n))return e.get(n);{const s=t();return e.set(n,s),e.get(n)}}const Mc="Abs",Wu="Acos",Gu="Acosh",Za="Add",zc="AddN",Bf="All",Vf="Any",Bc="ArgMax",Vc="ArgMin",ju="Asin",Hu="Asinh",Ku="Atan",qu="Atanh",Xu="Atan2",Uc="AvgPool",Uf="AvgPoolGrad",Wc="AvgPool3D",Wf="AvgPool3DGrad",Gc="BatchMatMul",jc="BatchToSpaceND",Gf="Bincount",Hc="BitwiseAnd",bx="BroadcastTo",jf="BroadcastArgs",Yu="Cast",Zu="Ceil",Ju="ClipByValue",Hf="Complex",Kc="ComplexAbs",qc="Concat",Xc="Conv2D",Kf="Conv2DBackpropFilter",Yc="Conv2DBackpropInput",Zc="Conv3D",qf="Conv3DBackpropFilterV2",Xf="Conv3DBackpropInputV2",Qu="Cos",tl="Cosh",Yf="Cumprod",Jc="Cumsum",Zf="CropAndResize",Jf="DenseBincount",Qf="DepthToSpace",Qc="DepthwiseConv2dNative",tp="DepthwiseConv2dNativeBackpropFilter",ep="DepthwiseConv2dNativeBackpropInput",np="Diag",th="Dilation2D",rf="Dilation2DBackpropInput",of="Dilation2DBackpropFilter",sp="Draw",el="RealDiv",rp="Einsum",nl="Elu",ip="EluGrad",sl="Erf",eh="Equal",rl="Exp",nh="ExpandDims",il="Expm1",op="FFT",ap="Fill",up="FlipLeftRight",ol="Floor",al="FloorDiv",sh="FusedBatchNorm",rh="GatherV2",lp="GatherNd",ih="Greater",ul="GreaterEqual",ll="Identity",cp="IFFT",hp="Imag",cl="IsFinite",hl="IsInf",dl="IsNan",oh="LeakyRelu",ah="Less",uh="LessEqual",dp="LinSpace",fl="Log",pl="Log1p",lh="LogicalAnd",ch="LogicalNot",hh="LogicalOr",SN="LogicalXor",xx="LogSoftmax",IN="LowerBound",dh="LRN",fp="LRNGrad",CN="MatrixBandPart",fh="Max",ml="Maximum",ph="MaxPool",pp="MaxPoolGrad",mh="MaxPool3D",mp="MaxPool3DGrad",gp="MaxPoolWithArgmax",gh="Mean",yh="Min",gl="Minimum",bh="MirrorPad",yl="Mod",yp="Multinomial",bl="Multiply",xh="Neg",wh="NotEqual",bp="NonMaxSuppressionV3",xp="NonMaxSuppressionV4",wp="NonMaxSuppressionV5",vh="OnesLike",kh="OneHot",Sh="Pack",Ih="PadV2",NN="Pool",xl="Pow",Ch="Prelu",Nh="Prod",vp="RaggedGather",kp="RaggedRange",Sp="RaggedTensorToTensor",Ip="Range",Cp="Real",wl="Reciprocal",vl="Relu",Th="Reshape",$h="ResizeNearestNeighbor",Np="ResizeNearestNeighborGrad",Eh="ResizeBilinear",Tp="ResizeBilinearGrad",kl="Relu6",_h="Reverse",Sl="Round",Il="Rsqrt",$p="ScatterNd",Ep="TensorScatterUpdate",_p="SearchSorted",Ah="Select",Cl="Selu",Rh="Slice",Nl="Sin",Tl="Sinh",$l="Sign",El="Sigmoid",_l="Softplus",Al="Sqrt",Dh="Sum",Oh="SpaceToBatchND",Fh="SplitV",Lh="Softmax",Ap="SparseFillEmptyRows",Rp="SparseReshape",Dp="SparseSegmentMean",Op="SparseSegmentSum",Fp="SparseToDense",Rl="SquaredDifference",Lp="Square",Ph="StaticRegexReplace",Pp="StridedSlice",Mp="StringNGrams",zp="StringSplit",Bp="StringToHashBucketFast",Dl="Sub",Ol="Tan",Fl="Tanh",Ll="Tile",Vp="TopK",Up="Transform",_a="Transpose",Wp="Unique",Mh="Unpack",zh="UnsortedSegmentSum",TN="UpperBound",Bh="ZerosLike",Pl="Step",af="FromPixels",Gp="RotateWithOffset",bc="_FusedMatMul",xc="FusedConv2D",wc="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wr(...n){vt().getBool("IS_TEST")||vt().getBool("PROD")||console.warn(...n)}function $N(...n){vt().getBool("IS_TEST")||vt().getBool("PROD")||console.log(...n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eu=G1("kernelRegistry",()=>new Map),vc=G1("gradRegistry",()=>new Map);function kc(n,t){const e=j1(n,t);return Eu.get(e)}function Vg(n){return vc.get(n)}function uf(n){const t=Eu.entries(),e=[];for(;;){const{done:s,value:r}=t.next();if(s)break;const[i,o]=r,[a]=i.split("_");a===n&&e.push(o)}return e}function jp(n){const{kernelName:t,backendName:e}=n,s=j1(t,e);Eu.has(s)&&wr(`The kernel '${t}' for backend '${e}' is already registered`),Eu.set(s,n)}function wx(n){const{kernelName:t}=n;vc.has(t)&&vt().getBool("DEBUG")&&wr(`Overriding the gradient for '${t}'`),vc.set(t,n)}function EN(n,t){const e=j1(n,t);if(!Eu.has(e))throw new Error(`The kernel '${n}' for backend '${t}' is not registered`);Eu.delete(e)}function _N(n){if(!vc.has(n))throw new Error(`The gradient '${n}' for backend is not registered`);vc.delete(n)}function AN(n,t){uf(n).forEach(s=>{const r=Object.assign({},s,{backendName:t});jp(r)})}function j1(n,t){return`${t}_${n}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vx(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}var kx=yn,Br=null;try{Br=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function yn(n,t,e){this.low=n|0,this.high=t|0,this.unsigned=!!e}yn.prototype.__isLong__;Object.defineProperty(yn.prototype,"__isLong__",{value:!0});function pr(n){return(n&&n.__isLong__)===!0}yn.isLong=pr;var Wy={},Gy={};function Ja(n,t){var e,s,r;return t?(n>>>=0,(r=0<=n&&n<256)&&(s=Gy[n],s)?s:(e=bn(n,(n|0)<0?-1:0,!0),r&&(Gy[n]=e),e)):(n|=0,(r=-128<=n&&n<128)&&(s=Wy[n],s)?s:(e=bn(n,n<0?-1:0,!1),r&&(Wy[n]=e),e))}yn.fromInt=Ja;function Vr(n,t){if(isNaN(n))return t?Na:Ur;if(t){if(n<0)return Na;if(n>=Sx)return Nx}else{if(n<=-Hy)return ir;if(n+1>=Hy)return Cx}return n<0?Vr(-n,t).neg():bn(n%_u|0,n/_u|0,t)}yn.fromNumber=Vr;function bn(n,t,e){return new yn(n,t,e)}yn.fromBits=bn;var lf=Math.pow;function H1(n,t,e){if(n.length===0)throw Error("empty string");if(n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return Ur;if(typeof t=="number"?(e=t,t=!1):t=!!t,e=e||10,e<2||36<e)throw RangeError("radix");var s;if((s=n.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return H1(n.substring(1),t,e).neg();for(var r=Vr(lf(e,8)),i=Ur,o=0;o<n.length;o+=8){var a=Math.min(8,n.length-o),u=parseInt(n.substring(o,o+a),e);if(a<8){var l=Vr(lf(e,a));i=i.mul(l).add(Vr(u))}else i=i.mul(r),i=i.add(Vr(u))}return i.unsigned=t,i}yn.fromString=H1;function hi(n,t){return typeof n=="number"?Vr(n,t):typeof n=="string"?H1(n,t):bn(n.low,n.high,typeof t=="boolean"?t:n.unsigned)}yn.fromValue=hi;var jy=65536,RN=1<<24,_u=jy*jy,Sx=_u*_u,Hy=Sx/2,Ky=Ja(RN),Ur=Ja(0);yn.ZERO=Ur;var Na=Ja(0,!0);yn.UZERO=Na;var Iu=Ja(1);yn.ONE=Iu;var Ix=Ja(1,!0);yn.UONE=Ix;var Ug=Ja(-1);yn.NEG_ONE=Ug;var Cx=bn(-1,2147483647,!1);yn.MAX_VALUE=Cx;var Nx=bn(-1,-1,!0);yn.MAX_UNSIGNED_VALUE=Nx;var ir=bn(0,-2147483648,!1);yn.MIN_VALUE=ir;var ee=yn.prototype;ee.toInt=function(){return this.unsigned?this.low>>>0:this.low};ee.toNumber=function(){return this.unsigned?(this.high>>>0)*_u+(this.low>>>0):this.high*_u+(this.low>>>0)};ee.toString=function(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ir)){var e=Vr(t),s=this.div(e),r=s.mul(e).sub(this);return s.toString(t)+r.toInt().toString(t)}else return"-"+this.neg().toString(t);for(var i=Vr(lf(t,6),this.unsigned),o=this,a="";;){var u=o.div(i),l=o.sub(u.mul(i)).toInt()>>>0,c=l.toString(t);if(o=u,o.isZero())return c+a;for(;c.length<6;)c="0"+c;a=""+c+a}};ee.getHighBits=function(){return this.high};ee.getHighBitsUnsigned=function(){return this.high>>>0};ee.getLowBits=function(){return this.low};ee.getLowBitsUnsigned=function(){return this.low>>>0};ee.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ir)?64:this.neg().getNumBitsAbs();for(var t=this.high!=0?this.high:this.low,e=31;e>0&&!(t&1<<e);e--);return this.high!=0?e+33:e+1};ee.isZero=function(){return this.high===0&&this.low===0};ee.eqz=ee.isZero;ee.isNegative=function(){return!this.unsigned&&this.high<0};ee.isPositive=function(){return this.unsigned||this.high>=0};ee.isOdd=function(){return(this.low&1)===1};ee.isEven=function(){return(this.low&1)===0};ee.equals=function(t){return pr(t)||(t=hi(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low};ee.eq=ee.equals;ee.notEquals=function(t){return!this.eq(t)};ee.neq=ee.notEquals;ee.ne=ee.notEquals;ee.lessThan=function(t){return this.comp(t)<0};ee.lt=ee.lessThan;ee.lessThanOrEqual=function(t){return this.comp(t)<=0};ee.lte=ee.lessThanOrEqual;ee.le=ee.lessThanOrEqual;ee.greaterThan=function(t){return this.comp(t)>0};ee.gt=ee.greaterThan;ee.greaterThanOrEqual=function(t){return this.comp(t)>=0};ee.gte=ee.greaterThanOrEqual;ee.ge=ee.greaterThanOrEqual;ee.compare=function(t){if(pr(t)||(t=hi(t)),this.eq(t))return 0;var e=this.isNegative(),s=t.isNegative();return e&&!s?-1:!e&&s?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1};ee.comp=ee.compare;ee.negate=function(){return!this.unsigned&&this.eq(ir)?ir:this.not().add(Iu)};ee.neg=ee.negate;ee.add=function(t){pr(t)||(t=hi(t));var e=this.high>>>16,s=this.high&65535,r=this.low>>>16,i=this.low&65535,o=t.high>>>16,a=t.high&65535,u=t.low>>>16,l=t.low&65535,c=0,h=0,d=0,f=0;return f+=i+l,d+=f>>>16,f&=65535,d+=r+u,h+=d>>>16,d&=65535,h+=s+a,c+=h>>>16,h&=65535,c+=e+o,c&=65535,bn(d<<16|f,c<<16|h,this.unsigned)};ee.subtract=function(t){return pr(t)||(t=hi(t)),this.add(t.neg())};ee.sub=ee.subtract;ee.multiply=function(t){if(this.isZero())return Ur;if(pr(t)||(t=hi(t)),Br){var e=Br.mul(this.low,this.high,t.low,t.high);return bn(e,Br.get_high(),this.unsigned)}if(t.isZero())return Ur;if(this.eq(ir))return t.isOdd()?ir:Ur;if(t.eq(ir))return this.isOdd()?ir:Ur;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(Ky)&&t.lt(Ky))return Vr(this.toNumber()*t.toNumber(),this.unsigned);var s=this.high>>>16,r=this.high&65535,i=this.low>>>16,o=this.low&65535,a=t.high>>>16,u=t.high&65535,l=t.low>>>16,c=t.low&65535,h=0,d=0,f=0,p=0;return p+=o*c,f+=p>>>16,p&=65535,f+=i*c,d+=f>>>16,f&=65535,f+=o*l,d+=f>>>16,f&=65535,d+=r*c,h+=d>>>16,d&=65535,d+=i*l,h+=d>>>16,d&=65535,d+=o*u,h+=d>>>16,d&=65535,h+=s*c+r*l+i*u+o*a,h&=65535,bn(f<<16|p,h<<16|d,this.unsigned)};ee.mul=ee.multiply;ee.divide=function(t){if(pr(t)||(t=hi(t)),t.isZero())throw Error("division by zero");if(Br){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1)return this;var e=(this.unsigned?Br.div_u:Br.div_s)(this.low,this.high,t.low,t.high);return bn(e,Br.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Na:Ur;var s,r,i;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return Na;if(t.gt(this.shru(1)))return Ix;i=Na}else{if(this.eq(ir)){if(t.eq(Iu)||t.eq(Ug))return ir;if(t.eq(ir))return Iu;var o=this.shr(1);return s=o.div(t).shl(1),s.eq(Ur)?t.isNegative()?Iu:Ug:(r=this.sub(t.mul(s)),i=s.add(r.div(t)),i)}else if(t.eq(ir))return this.unsigned?Na:Ur;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();i=Ur}for(r=this;r.gte(t);){s=Math.max(1,Math.floor(r.toNumber()/t.toNumber()));for(var a=Math.ceil(Math.log(s)/Math.LN2),u=a<=48?1:lf(2,a-48),l=Vr(s),c=l.mul(t);c.isNegative()||c.gt(r);)s-=u,l=Vr(s,this.unsigned),c=l.mul(t);l.isZero()&&(l=Iu),i=i.add(l),r=r.sub(c)}return i};ee.div=ee.divide;ee.modulo=function(t){if(pr(t)||(t=hi(t)),Br){var e=(this.unsigned?Br.rem_u:Br.rem_s)(this.low,this.high,t.low,t.high);return bn(e,Br.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))};ee.mod=ee.modulo;ee.rem=ee.modulo;ee.not=function(){return bn(~this.low,~this.high,this.unsigned)};ee.and=function(t){return pr(t)||(t=hi(t)),bn(this.low&t.low,this.high&t.high,this.unsigned)};ee.or=function(t){return pr(t)||(t=hi(t)),bn(this.low|t.low,this.high|t.high,this.unsigned)};ee.xor=function(t){return pr(t)||(t=hi(t)),bn(this.low^t.low,this.high^t.high,this.unsigned)};ee.shiftLeft=function(t){return pr(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?bn(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):bn(0,this.low<<t-32,this.unsigned)};ee.shl=ee.shiftLeft;ee.shiftRight=function(t){return pr(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?bn(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):bn(this.high>>t-32,this.high>=0?0:-1,this.unsigned)};ee.shr=ee.shiftRight;ee.shiftRightUnsigned=function(t){if(pr(t)&&(t=t.toInt()),t&=63,t===0)return this;var e=this.high;if(t<32){var s=this.low;return bn(s>>>t|e<<32-t,e>>>t,this.unsigned)}else return t===32?bn(e,0,this.unsigned):bn(e>>>t-32,0,this.unsigned)};ee.shru=ee.shiftRightUnsigned;ee.shr_u=ee.shiftRightUnsigned;ee.toSigned=function(){return this.unsigned?bn(this.low,this.high,!1):this};ee.toUnsigned=function(){return this.unsigned?this:bn(this.low,this.high,!0)};ee.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()};ee.toBytesLE=function(){var t=this.high,e=this.low;return[e&255,e>>>8&255,e>>>16&255,e>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]};ee.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,e>>>24,e>>>16&255,e>>>8&255,e&255]};yn.fromBytes=function(t,e,s){return s?yn.fromBytesLE(t,e):yn.fromBytesBE(t,e)};yn.fromBytesLE=function(t,e){return new yn(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)};yn.fromBytesBE=function(t,e){return new yn(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};const Tx=ax(kx),DN=aN({__proto__:null,default:Tx},[kx]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ka=Tx||DN;function Vh(n){return ka.fromString(n,!0,16)}const $x=Vh("c3a5c85c97cb3127"),wa=Vh("b492b66fbe98f273"),_s=Vh("9ae16a3b2f90404f");function Wg(n){return n.xor(n.shru(47))}function Ex(n,t,e){const s=n.slice(t,t+e);return ka.fromBytes(Array.from(s),!0,!0)}function hn(n,t){return Ex(n,t,8)}function qy(n,t){return Ex(n,t,4)}function Qn(n,t){return t===0?n:n.shru(t).or(n.shl(64-t))}function Po(n,t,e=Vh("9ddfea08eb382d69")){let s=n.xor(t).mul(e);s=s.xor(s.shru(47));let r=t.xor(s).mul(e);return r=r.xor(r.shru(47)),r=r.mul(e),r}function ON(n,t,e,s,r,i){r=r.add(n),i=Qn(i.add(r).add(s),21);const o=r;return r=r.add(t),r=r.add(e),i=i.add(Qn(r,44)),[r.add(s),i.add(o)]}function Td(n,t,e,s){return ON(hn(n,t),hn(n,t+8),hn(n,t+16),hn(n,t+24),e,s)}function FN(n,t=n.length){if(t>=8){const e=_s.add(t*2),s=hn(n,0).add(_s),r=hn(n,t-8),i=Qn(r,37).mul(e).add(s),o=Qn(s,25).add(r).mul(e);return Po(i,o,e)}if(t>=4){const e=_s.add(t*2),s=qy(n,0);return Po(s.shl(3).add(t),qy(n,t-4),e)}if(t>0){const e=n[0],s=n[t>>1],r=n[t-1],i=e+(s<<8),o=t+(r<<2);return Wg(_s.mul(i).xor($x.mul(o))).mul(_s)}return _s}function LN(n,t=n.length){const e=_s.add(t*2),s=hn(n,0).mul(wa),r=hn(n,8),i=hn(n,t-8).mul(e),o=hn(n,t-16).mul(_s);return Po(Qn(s.add(r),43).add(Qn(i,30)).add(o),s.add(Qn(r.add(_s),18)).add(i),e)}function PN(n,t=n.length){const e=_s.add(t*2),s=hn(n,0).mul(_s),r=hn(n,8),i=hn(n,t-8).mul(e),o=hn(n,t-16).mul(_s),a=Qn(s.add(r),43).add(Qn(i,30)).add(o),u=Po(a,s.add(Qn(r.add(_s),18)).add(i),e),l=hn(n,16).mul(e),c=hn(n,24),h=a.add(hn(n,t-32)).mul(e),d=u.add(hn(n,t-24)).mul(e);return Po(Qn(l.add(c),43).add(Qn(h,30)).add(d),l.add(Qn(c.add(s),18)).add(h),e)}function _x(n,t=n.length){const e=ka.fromNumber(81,!0);if(t<=32)return t<=16?FN(n,t):LN(n,t);if(t<=64)return PN(n,t);let s=e,r=e.mul(wa).add(113),i=Wg(r.mul(_s).add(113)).mul(_s),o=[ka.UZERO,ka.UZERO],a=[ka.UZERO,ka.UZERO];s=s.mul(_s).add(hn(n,0));let u=0;const l=(t-1>>6)*64,c=l+(t-1&63)-63;do s=Qn(s.add(r).add(o[0]).add(hn(n,u+8)),37).mul(wa),r=Qn(r.add(o[1]).add(hn(n,u+48)),42).mul(wa),s=s.xor(a[1]),r=r.add(o[0]).add(hn(n,u+40)),i=Qn(i.add(a[0]),33).mul(wa),o=Td(n,u,o[1].mul(wa),s.add(a[0])),a=Td(n,u+32,i.add(a[1]),r.add(hn(n,u+16))),[i,s]=[s,i],u+=64;while(u!==l);const h=wa.add(i.and(255).shl(1));return u=c,a[0]=a[0].add(t-1&63),o[0]=o[0].add(a[0]),a[0]=a[0].add(o[0]),s=Qn(s.add(r).add(o[0]).add(hn(n,u+8)),37).mul(h),r=Qn(r.add(o[1]).add(hn(n,u+48)),42).mul(h),s=s.xor(a[1].mul(9)),r=r.add(o[0].mul(9).add(hn(n,u+40))),i=Qn(i.add(a[0]),33).mul(h),o=Td(n,u,o[1].mul(h),s.add(a[0])),a=Td(n,u+32,i.add(a[1]),r.add(hn(n,u+16))),[i,s]=[s,i],Po(Po(o[0],a[0],h).add(Wg(r).mul($x)).add(i),Po(o[1],a[1],h).add(s),h)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fo(n,t){return t==="string"?Ai(n):Jo([n],t)}function MN(n,t){return n instanceof Float32Array&&t==="float32"||n instanceof Int32Array&&t==="int32"||n instanceof Uint8Array&&t==="bool"}function Jo(n,t){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Pi(n)),vt().getBool("DEBUG")&&cx(n,t),MN(n,t))return n;if(t==null||t==="float32"||t==="complex64")return new Float32Array(n);if(t==="int32")return new Int32Array(n);if(t==="bool"){const e=new Uint8Array(n.length);for(let s=0;s<e.length;++s)Math.round(n[s])!==0&&(e[s]=1);return e}else throw new Error(`Unknown data type ${t}`)}function $s(){return vt().platform.now()}function zN(n,t){return vt().platform.fetch(n,t)}function Ai(n,t="utf-8"){return t=t||"utf-8",vt().platform.encode(n,t)}function no(n,t="utf-8"){return t=t||"utf-8",vt().platform.decode(n,t)}function ts(n){return vt().platform.isTypedArray!=null?vt().platform.isTypedArray(n):vx(n)}function Pi(n,t=[],e=!1){if(t==null&&(t=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||Uo(n)||n==null||ts(n)&&e)t.push(n);else if(Array.isArray(n)||ts(n))for(let s=0;s<n.length;++s)Pi(n[s],t,e);else{let s=-1;for(const r of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(r)&&(s=Math.max(s,Number(r)));for(let r=0;r<=s;r++)Pi(n[r],t,e)}return t}const BN=Object.freeze(Object.defineProperty({__proto__:null,arraysEqual:Ve,arraysEqualWithNull:lx,assert:V,assertNonNegativeIntegerDimensions:fr,assertNonNull:qa,assertShapesMatch:hs,bytesFromStringArray:dx,bytesPerElement:yc,checkConversionForErrors:cx,clamp:Bo,computeStrides:ge,convertBackendValuesAndArrayBuffer:mx,createScalarValue:fo,createShuffledIndices:yN,decodeString:no,distSquared:pN,encodeString:Ai,fetch:zN,fingerPrint64:_x,flatten:Pi,getArrayFromDType:En,getTypedArrayFromDType:ss,hasEncodingLoss:V1,hexToLong:Vh,indexToLoc:Ya,inferDtype:Xa,inferFromImplicitShape:B1,isBoolean:fx,isFunction:Vo,isInt:Oa,isNumber:nf,isPromise:Uo,isScalarShape:mN,isString:$i,isTypedArray:ts,isValidDtype:hx,locToIndex:ri,makeOnesTypedArray:zf,makeZerosNestedTypedArray:U1,makeZerosTypedArray:ls,nearestDivisor:sf,nearestLargerEven:Mf,now:$s,parseAxisParam:Pe,randUniform:fN,repeatedTry:Bg,rightPad:Ea,shuffle:z1,shuffleCombo:dN,sizeFromShape:Et,sizeToSquarishShape:ef,squeezeShape:ho,sum:ux,swap:Zi,tanh:gN,toNestedArray:Ir,toTypedArray:Jo},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VN{constructor(t,e){this.backendTimer=t,this.logger=e,e==null&&(this.logger=new WN)}profileKernel(t,e,s){let r;const i=()=>{r=s()};let o;const a=$s();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(i);else{i();for(const l of r)l.dataSync();o=Promise.resolve({kernelMs:$s()-a})}if(vt().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let l=0;l<r.length;l++){const c=r[l];c.data().then(h=>{UN(h,c.dtype,t)})}return{kernelName:t,outputs:r,inputs:e,timeMs:o.then(l=>l.kernelMs),extraInfo:o.then(l=>l.getExtraProfileInfo!=null?l.getExtraProfileInfo():"")}}logKernelProfile(t){const{kernelName:e,outputs:s,timeMs:r,inputs:i,extraInfo:o}=t;s.forEach(a=>{Promise.all([a.data(),r,o]).then(u=>{this.logger.logKernelProfile(e,a,u[0],u[1],i,u[2])})})}}function UN(n,t,e){if(t!=="float32")return!1;for(let s=0;s<n.length;s++){const r=n[s];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${e}'`),!0}return!1}class WN{logKernelProfile(t,e,s,r,i,o){const a=typeof r=="number"?Ea(`${r}ms`,9):r.error,u=Ea(t,25),l=e.rank,c=e.size,h=Ea(e.shape.toString(),14);let d="";for(const f in i){const p=i[f];if(p!=null){const m=p.shape||e.shape,g=m.length;d+=`${f}: ${g}D ${g>0?m:""} `}}console.log(`%c${u}	%c${a}	%c${l}D ${h}	%c${c}	%c${d}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GN(n,t,e){const s={},r={};for(let u=0;u<t.length;u++)s[t[u].id]=!0;for(let u=0;u<n.length;u++){const l=n[u],c=l.inputs;for(const h in c){const d=c[h];let f=!1;for(let p=0;p<t.length;p++)if(s[d.id]){l.outputs.forEach(m=>s[m.id]=!0),f=!0,r[l.id]=!0;break}if(f)break}}const i={};i[e.id]=!0;const o={};for(let u=n.length-1;u>=0;u--){const l=n[u],c=l.inputs;for(let h=0;h<l.outputs.length;h++)if(i[l.outputs[h].id]){for(const d in c)i[c[d].id]=!0,o[l.id]=!0;break}}const a=[];for(let u=0;u<n.length;u++){const l=n[u];if(r[l.id]&&o[l.id]){const c={};for(const d in l.inputs){const f=l.inputs[d];s[f.id]&&(c[d]=f)}const h=Object.assign({},l);h.inputs=c,h.outputs=l.outputs,a.push(h)}}return a}function jN(n,t,e,s){for(let r=t.length-1;r>=0;r--){const i=t[r],o=[];if(i.outputs.forEach(u=>{const l=n[u.id];l!=null?o.push(l):o.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);const a=i.gradient(o);for(const u in i.inputs){if(!(u in a))throw new Error(`Cannot backprop through input ${u}. Available gradients found: ${Object.keys(a)}.`);const l=e(()=>a[u]());if(l.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${u} must have 'float32' dtype, but has '${l.dtype}'`);const c=i.inputs[u];if(!Ve(l.shape,c.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${u}' has shape '${l.shape}', which does not match the shape of the input '${c.shape}'`);if(n[c.id]==null)n[c.id]=l;else{const h=n[c.id];n[c.id]=s(h,l),h.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xy=20,nc=3,og=7;function HN(n,t,e,s){const r=ge(t),i=KN(n,t,e,r),o=t.length,a=Zd(n,t,e,r,i),u=["Tensor"];return s&&(u.push(`  dtype: ${e}`),u.push(`  rank: ${o}`),u.push(`  shape: [${t}]`),u.push("  values:")),u.push(a.map(l=>"    "+l).join(`
`)),u.join(`
`)}function KN(n,t,e,s){const r=Et(t),i=s[s.length-1],o=new Array(i).fill(0),a=t.length,u=e==="complex64"?uc(n):n;if(a>1)for(let l=0;l<r/i;l++){const c=l*i;for(let h=0;h<i;h++)o[h]=Math.max(o[h],ac(u[c+h],0,e).length)}return o}function ac(n,t,e){let s;return Array.isArray(n)?s=`${parseFloat(n[0].toFixed(og))} + ${parseFloat(n[1].toFixed(og))}j`:$i(n)?s=`'${n}'`:e==="bool"?s=Ax(n):s=parseFloat(n.toFixed(og)).toString(),Ea(s,t)}function Ax(n){return n===0?"false":"true"}function Zd(n,t,e,s,r,i=!0){const o=e==="complex64"?2:1,a=t[0],u=t.length;if(u===0){if(e==="complex64"){const m=uc(n);return[ac(m[0],0,e)]}return e==="bool"?[Ax(n[0])]:[n[0].toString()]}if(u===1){if(a>Xy){const g=nc*o;let y=Array.from(n.slice(0,g)),b=Array.from(n.slice((a-nc)*o,a*o));return e==="complex64"&&(y=uc(y),b=uc(b)),["["+y.map((w,v)=>ac(w,r[v],e)).join(", ")+", ..., "+b.map((w,v)=>ac(w,r[a-nc+v],e)).join(", ")+"]"]}return["["+(e==="complex64"?uc(n):Array.from(n)).map((g,y)=>ac(g,r[y],e)).join(", ")+"]"]}const l=t.slice(1),c=s.slice(1),h=s[0]*o,d=[];if(a>Xy){for(let m=0;m<nc;m++){const g=m*h,y=g+h;d.push(...Zd(n.slice(g,y),l,e,c,r,!1))}d.push("...");for(let m=a-nc;m<a;m++){const g=m*h,y=g+h;d.push(...Zd(n.slice(g,y),l,e,c,r,m===a-1))}}else for(let m=0;m<a;m++){const g=m*h,y=g+h;d.push(...Zd(n.slice(g,y),l,e,c,r,m===a-1))}const f=u===2?",":"";d[0]="["+(a>0?d[0]+f:"");for(let m=1;m<d.length-1;m++)d[m]=" "+d[m]+f;let p=`,
`;for(let m=2;m<u;m++)p+=`
`;return d[d.length-1]=" "+d[d.length-1]+"]"+(i?"":p),d}function uc(n){const t=[];for(let e=0;e<n.length;e+=2)t.push([n[e],n[e+1]]);return t}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vn{constructor(t,e,s){if(this.dtype=e,this.shape=t.slice(),this.size=Et(t),s!=null){const r=s.length;V(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(e==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||En(e,this.size),this.strides=ge(t)}set(t,...e){e.length===0&&(e=[0]),V(e.length===this.rank,()=>`The number of provided coordinates (${e.length}) must match the rank (${this.rank})`);const s=this.locToIndex(e);this.values[s]=t}get(...t){t.length===0&&(t=[0]);let e=0;for(const r of t){if(r<0||r>=this.shape[e]){const i=`Requested out of range element at ${t}.   Buffer shape=${this.shape}`;throw new Error(i)}e++}let s=t[t.length-1];for(let r=0;r<t.length-1;++r)s+=this.strides[r]*t[r];return this.values[s]}locToIndex(t){if(this.rank===0)return 0;if(this.rank===1)return t[0];let e=t[t.length-1];for(let s=0;s<t.length-1;++s)e+=this.strides[s]*t[s];return e}indexToLoc(t){if(this.rank===0)return[];if(this.rank===1)return[t];const e=new Array(this.shape.length);for(let s=0;s<e.length-1;++s)e[s]=Math.floor(t/this.strides[s]),t-=e[s]*this.strides[s];return e[e.length-1]=t,e}get rank(){return this.shape.length}toTensor(){return ei().makeTensor(this.values,this.shape,this.dtype)}}let ei=null,ku=null;function qN(n){ei=n}function XN(n){ku=n}class $e{constructor(t,e,s,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=Et(t),this.strides=ge(t),this.dataId=s,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const t=await this.data();return ku.buffer(this.shape,this.dtype,t)}bufferSync(){return ku.buffer(this.shape,this.dtype,this.dataSync())}async array(){const t=await this.data();return Ir(this.shape,t,this.dtype==="complex64")}arraySync(){return Ir(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const t=ei().read(this.dataId);if(this.dtype==="string"){const e=await t;try{return e.map(s=>no(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return t}dataToGPU(t){return this.throwIfDisposed(),ei().readToGPU(this.dataId,t)}dataSync(){this.throwIfDisposed();const t=ei().readSync(this.dataId);if(this.dtype==="string")try{return t.map(e=>no(e))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t}async bytes(){this.throwIfDisposed();const t=await ei().read(this.dataId);return this.dtype==="string"?t:new Uint8Array(t.buffer)}dispose(){this.isDisposed||(ei().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(t=!1){return ku.print(this,t)}clone(){return this.throwIfDisposed(),ku.clone(this)}toString(t=!1){const e=this.dataSync();return HN(e,this.shape,this.dtype,t)}cast(t){return this.throwIfDisposed(),ku.cast(this,t)}variable(t=!0,e,s){return this.throwIfDisposed(),ei().makeVariable(this,t,e,s)}}Object.defineProperty($e,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function _t(){return G1("Tensor",()=>$e)}_t();class Sc extends $e{constructor(t,e,s,r){super(t.shape,t.dtype,t.dataId,r),this.trainable=e,this.name=s}assign(t){if(t.dtype!==this.dtype)throw new Error(`dtype of the new value (${t.dtype}) and previous value (${this.dtype}) must match`);if(!Ve(t.shape,this.shape))throw new Error(`shape of the new value (${t.shape}) and previous value (${this.shape}) must match`);ei().disposeTensor(this),this.dataId=t.dataId,ei().incRef(this,null)}dispose(){ei().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(Sc,Symbol.hasInstance,{value:n=>n instanceof $e&&n.assign!=null&&n.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Gg;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(Gg||(Gg={}));var jg;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(jg||(jg={}));var Hg;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(Hg||(Hg={}));var Kg;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(Kg||(Kg={}));var qg;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(qg||(qg={}));const YN={float32:Kg,int32:jg,bool:Hg,complex64:qg};function qs(n,t){if(n==="string"||t==="string"){if(n==="string"&&t==="string")return"string";throw new Error(`Can not upcast ${n} with ${t}`)}return YN[n][t]}function Hp(n){return qs(n,"int32")}function Rx(n){return n!=null&&typeof n=="object"&&"texture"in n&&n.texture instanceof WebGLTexture}function Dx(n){return typeof GPUBuffer<"u"&&n!=null&&typeof n=="object"&&"buffer"in n&&n.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nn(n,t){if(n.dtype===t.dtype)return[n,t];const e=qs(n.dtype,t.dtype);return[n.cast(e),t.cast(e)]}function Ox(n,t){V(n.dtype===t.dtype,()=>`The dtypes of the first(${n.dtype}) and second(${t.dtype}) input must match`)}function ZN(n,t){return t.some(e=>e.id===n.id)}function K1(n){const t=[];return Fx(n,t,new Set),t}function Fx(n,t,e){if(n==null)return;if(n instanceof $e){t.push(n);return}if(!JN(n))return;const s=n;for(const r in s){const i=s[r];e.has(i)||(e.add(i),Fx(i,t,e))}}function JN(n){return Array.isArray(n)||typeof n=="object"}const QN=Object.freeze(Object.defineProperty({__proto__:null,assertTypesMatch:Ox,getTensorsInContainer:K1,isTensorInList:ZN,makeTypesMatch:Nn},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ag(n){return n.kernelName!=null}class Yy{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(t=>t.name)))}}}dispose(){for(const t in this.registeredVariables)this.registeredVariables[t].dispose()}}class Au{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Yy}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const s=t[e];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:t,asyncInit:e}=this.initializeBackendsAndReturnBest();if(e)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry))if(t in this.registryFactory){const{asyncInit:e}=this.initializeBackend(t);if(e)return null}else return null;return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,e,s=1){return t in this.registryFactory?(wr(`${t} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[t]={factory:e,priority:s},!0)}async setBackend(t){if(this.registryFactory[t]==null)throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,this.registry[t]==null){this.backendInstance=null;const{success:e,asyncInit:s}=this.initializeBackend(t);if(!(s?await e:e))return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new VN(this.backendInstance),!0}setupRegisteredKernels(){uf(this.backendName).forEach(e=>{e.setupFunc!=null&&e.setupFunc(this.backendInstance)})}disposeRegisteredKernels(t){uf(t).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[t])})}initializeBackend(t){const e=this.registryFactory[t];if(e==null)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{const s=e.factory();if(s&&!(s instanceof Pf)&&typeof s.then=="function"){const r=++this.pendingBackendInitId,i=s.then(o=>r<this.pendingBackendInitId?!1:(this.registry[t]=o,this.pendingBackendInit=null,!0)).catch(o=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,wr(`Initialization of backend ${t} failed`),wr(o.stack||o.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[t]=s,{success:!0,asyncInit:!1}}catch(s){return wr(`Initialization of backend ${t} failed`),wr(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(`${t} backend not found in registry`);this.backendName===t&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((t,e)=>this.registryFactory[e].priority-this.registryFactory[t].priority)}initializeBackendsAndReturnBest(){const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const s=t[e],{success:r,asyncInit:i}=this.initializeBackend(s);if(i||r)return{name:s,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,e){const s=this.state.tensorInfo.get(e),r=s.backend,i=this.readSync(e),o=r.refCount(e);r.disposeData(e,!0),s.backend=t,t.move(e,i,s.shape,s.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,e){let s=null;if(e==null){if(typeof t!="function")throw new Error("Please provide a function to tidy()");e=t}else{if(typeof t!="string"&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof e!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=t}let r;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(r),()=>(r=e(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(t,e,s){t();try{const r=s();return e(),r}catch(r){throw e(),r}}nextTensorId(){return Au.nextTensorId++}nextVariableId(){return Au.nextVariableId++}clone(t){const e=it.runKernel(ll,{x:t}),s={x:t},r=o=>({x:()=>{const a="float32",u={x:o},l={dtype:a};return it.runKernel(Yu,u,l)}}),i=[];return this.addTapeNode(this.state.activeScope.name,s,[e],r,i,{}),e}runKernel(t,e,s){if(this.backendName==null&&this.backend,!(kc(t,this.backendName)!=null))throw new Error(`Kernel '${t}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:t,inputs:e,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,e,s){const r=this.backend.numDataIds();let i=0;s.forEach(u=>{i+=u.dtype==="complex64"?3:1});const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-e-i-o;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${t}'`)}runKernelFunc(t){let e,s=[];const r=this.isTapeOn(),i=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let u;const l=ag(t)?t.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(ag(t)){const{kernelName:p,inputs:m,attrs:g}=t;this.backendName==null&&this.backend;const y=kc(p,this.backendName);V(y!=null,()=>`Cannot find registered kernel '${p}' for backend '${this.backendName}'`),a=()=>{const b=this.backend.numDataIds();u=y.kernelFunc({inputs:m,attrs:g,backend:this.backend});const w=Array.isArray(u)?u:[u];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(p,b,w);const v=w.map(S=>S.rank!=null?S:this.makeTensorFromTensorInfo(S));if(r){const S=this.getTensorsForGradient(p,m,v);s=this.saveTensorsForBackwardMode(S)}return v}}else{const{forwardFunc:p}=t,m=g=>{r&&(s=g.map(y=>this.keep(this.clone(y))))};a=()=>{const g=this.backend.numDataIds();u=this.tidy(()=>p(this.backend,m));const y=Array.isArray(u)?u:[u];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(l,g,y),y}}const{inputs:c,attrs:h}=t,d=ag(t)?null:t.backwardsFunc;let f;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?e=a():(f=this.profiler.profileKernel(l,c,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(f),e=f.outputs)}),r&&this.addTapeNode(l,c,e,d,s,h),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map(p=>c[p]!=null?c[p].shape:null),outputShapes:e.map(p=>p.shape),kernelTimeMs:f.timeMs,extraInfo:f.extraInfo}),Array.isArray(u)?e:e[0]}saveTensorsForBackwardMode(t){return t.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(t,e,s){const r=Vg(t);if(r!=null){const i=r.inputsToSave||[],o=r.outputsToSave||[];let a;r.saveAllInputs?(V(Array.isArray(e),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(e).map(l=>e[l])):a=i.map(l=>e[l]);const u=s.filter((l,c)=>o[c]);return a.concat(u)}return[]}makeTensor(t,e,s,r){if(t==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",r=r||this.backend;let i=t;s==="string"&&$i(t[0])&&(i=t.map(u=>Ai(u)));const o=r.write(i,e,s),a=new $e(e,s,o,this.nextTensorId());if(this.trackTensor(a,r),s==="string"){const u=this.state.tensorInfo.get(o),l=dx(i);this.state.numBytes+=l-u.bytes,u.bytes=l}return a}makeTensorFromDataId(t,e,s,r){s=s||"float32";const i={dataId:t,shape:e,dtype:s};return this.makeTensorFromTensorInfo(i,r)}makeTensorFromTensorInfo(t,e){const{dataId:s,shape:r,dtype:i}=t,o=new $e(r,i,s,this.nextTensorId());return this.trackTensor(o,e),o}makeVariable(t,e=!0,s,r){s=s||this.nextVariableId().toString(),r!=null&&r!==t.dtype&&(t=t.cast(r));const i=new Sc(t,e,s,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(t,e){this.state.numTensors++,t.dtype==="string"&&this.state.numStringTensors++;let s=0;t.dtype!=="complex64"&&t.dtype!=="string"&&(s=t.size*yc(t.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:s})),t instanceof Sc||this.track(t)}incRef(t,e){this.trackTensor(t,e),this.backend.incRef(t.dataId)}removeDataId(t,e){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===e&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;const e=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,t.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=e.bytes),t.dtype!=="complex64"&&t.dtype!=="string"){const s=t.size*yc(t.dtype);this.state.numBytes-=s}e.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,e.backend)}disposeVariables(){for(const t in this.state.registeredVariables){const e=this.state.registeredVariables[t];this.disposeVariable(e)}}disposeVariable(t){this.disposeTensor(t),this.state.registeredVariables[t.name]!=null&&delete this.state.registeredVariables[t.name]}memory(){const t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,t.reasons==null&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}async profile(t){this.state.profiling=!0;const e=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(t,e,s,r,i,o){const a={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:s,saved:i},u=Vg(t);u!=null&&(r=u.gradFunc),r!=null&&(a.gradient=l=>(l=l.map((c,h)=>{if(c==null){const d=s[h],f=ls(d.size,d.dtype);return this.makeTensor(f,d.shape,d.dtype)}return c}),r(l.length>1?l:l[0],i,o))),this.state.activeTape.push(a)}keep(t){return t.kept=!0,t}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){const e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e}endScope(t){const e=K1(t),s=new Set(e.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){const o=this.state.activeScope.track[i];!o.kept&&!s.has(o.id)&&o.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],e.forEach(i=>{!i.kept&&i.scopeId===r.id&&this.track(i)})}gradients(t,e,s,r=!1){if(V(e.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",t));V(i instanceof $e,()=>"The result y returned by f() must be a tensor.");const o=GN(this.state.activeTape,e,i);if(!r&&o.length===0&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[i.id]=s??tT(i.shape),jN(a,o,l=>this.tidy(l),eT);const u=e.map(l=>a[l.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(l=>{for(const c of l.saved)c.dispose()}),this.state.activeTape=null),{value:i,grads:u}})}customGrad(t){return V(Vo(t),()=>"The f passed in customGrad(f) must be a function."),(...e)=>{V(e.every(a=>a instanceof $e),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const r={};e.forEach((a,u)=>{r[u]=a});const i=(a,u)=>(s=t(...e,u),V(s.value instanceof $e,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),V(Vo(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),o=(a,u)=>{const l=s.gradFunc(a,u),c=Array.isArray(l)?l:[l];V(c.length===e.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),V(c.every(d=>d instanceof $e),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const h={};return c.forEach((d,f)=>{h[f]=()=>d}),h};return this.runKernelFunc({forwardFunc:i,backwardsFunc:o,inputs:r})}}readSync(t){return this.state.tensorInfo.get(t).backend.readSync(t)}read(t){return this.state.tensorInfo.get(t).backend.read(t)}readToGPU(t,e){return this.state.tensorInfo.get(t).backend.readToGPU(t,e)}async time(t){const e=$s(),s=await this.backend.time(t);return s.wallMs=$s()-e,s}track(t){return this.state.activeScope!=null&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Yy;for(const t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}Au.nextTensorId=0;Au.nextVariableId=0;function tT(n){const t=zf(Et(n),"float32");return it.makeTensor(t,n,"float32")}function Lx(){const n=yx();if(n._tfengine==null){const t=new gx(n);n._tfengine=new Au(t)}return vN(n._tfengine.ENV),qN(()=>n._tfengine),n._tfengine}const it=Lx();function eT(n,t){const e={a:n,b:t};return it.runKernel(Za,e)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nT(){return typeof navigator<"u"&&navigator!=null}let Xg;function sT(n){Xg=n}function q1(n){if(Xg!==void 0)return Xg;if(n||nT()){if(n||(n=navigator),n.product==="ReactNative")return!0;const t=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!t){const e=n;return e.userAgentData&&e.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function X1(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}const rT=Object.freeze(Object.defineProperty({__proto__:null,isBrowser:X1,isMobile:q1,mockIsMobile:sT},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xs=vt();Xs.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Xs.registerFlag("IS_BROWSER",()=>X1());Xs.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Xs.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Xs.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));Xs.registerFlag("PROD",()=>!1);Xs.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Xs.getBool("DEBUG"));Xs.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Xs.registerFlag("IS_TEST",()=>!1);Xs.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Xs.getBool("DEBUG"));Xs.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Xs.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Xs.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mi(n,t){let e=n;if(ts(n))return t==="string"?[]:[n.length];if(Rx(n)){const r=n.channels||"RGBA";return[n.height,n.width*r.length]}else if(Dx(n))return[n.buffer.size/(t==null?4:yc(t))];if(!Array.isArray(n))return[];const s=[];for(;Array.isArray(e)||ts(e)&&t!=="string";)s.push(e.length),e=e[0];return Array.isArray(n)&&vt().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&Px(n,s,[]),s}function Px(n,t,e){if(e=e||[],!Array.isArray(n)&&!ts(n)){V(t.length===0,()=>`Element arr[${e.join("][")}] is a primitive, but should be an array/TypedArray of ${t[0]} elements`);return}V(t.length>0,()=>`Element arr[${e.join("][")}] should be a primitive, but is an array of ${n.length} elements`),V(n.length===t[0],()=>`Element arr[${e.join("][")}] should have ${t[0]} elements, but has ${n.length} elements`);const s=t.slice(1);for(let r=0;r<n.length;++r)Px(n[r],s,e.concat(r))}function Zy(n,t,e,s){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==t||n==="numeric"&&t==="string")throw new Error(`Argument '${e}' passed to '${s}' must be ${n} tensor, but got ${t} tensor`)}}function U(n,t,e,s="numeric"){if(n instanceof $e)return Zy(s,n.dtype,t,e),n;let r=Xa(n);if(r!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(r=s),Zy(s,r,t,e),n==null||!ts(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){const u=n==null?"null":n.constructor.name;throw new Error(`Argument '${t}' passed to '${e}' must be a Tensor or TensorLike, but got '${u}'`)}const i=Mi(n,r);!ts(n)&&!Array.isArray(n)&&(n=[n]);const a=r!=="string"?Jo(n,r):Pi(n,[],!0);return it.makeTensor(a,i,r)}function Ic(n,t,e,s="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${t} passed to ${e} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((i,o)=>U(i,`${t}[${o}]`,e,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y1="__op";function ot(n){const t=Object.keys(n);if(t.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${t.length} keys.`);let e=t[0];const s=n[e];e.endsWith("_")&&(e=e.substring(0,e.length-1)),e=e+Y1;const r=(...i)=>{it.startScope(e);try{const o=s(...i);return Uo(o)&&console.error("Cannot return a Promise inside of tidy."),it.endScope(o),o}catch(o){throw it.endScope(null),o}};return Object.defineProperty(r,"name",{value:e,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iT(n,t){const e=U(n,"real","complex"),s=U(t,"imag","complex");hs(e.shape,s.shape,`real and imag shapes, ${e.shape} and ${s.shape}, must match in call to tf.complex().`);const r={real:e,imag:s};return it.runKernel(Hf,r)}const so=ot({complex_:iT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qo(n,t,e,s){if(s==null)s=Xa(n);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(Dx(n)||Rx(n)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return it.backend.createTensorFromGPUData(n,t||e,s)}if(!ts(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(t!=null){fr(t);const r=Et(t),i=Et(e);V(r===i,()=>`Based on the provided shape, [${t}], the tensor should have ${r} values but has ${i}`);for(let o=0;o<e.length;++o){const a=e[o],u=o===e.length-1?a!==Et(t.slice(o)):!0;V(e[o]===t[o]||!u,()=>`Error creating a new Tensor. Inferred shape (${e}) does not match the provided shape (${t}). `)}}return!ts(n)&&!Array.isArray(n)&&(n=[n]),t=t||e,n=s!=="string"?Jo(n,s):Pi(n,[],!0),it.makeTensor(n,t,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cr(n,t,e){const s=Mi(n,e);return Qo(n,t,s,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yg={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class di{static join(t){return new di(t).slice()}constructor(t){if(this.shards=[],this.previousShardIndex=0,t==null||(t instanceof Array||(t=[t]),t=t.map(s=>ts(s)?s.buffer:s),t.length===0))return;this.bufferUniformSize=t[0].byteLength;let e=0;for(let s=0;s<t.length;s++){const r=t[s];s!==t.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const i=e+r.byteLength;this.shards.push({buffer:r,start:e,end:i}),e=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(t=0,e=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(t=isNaN(Number(t))?0:t,e=isNaN(Number(e))?0:e,t=Math.max(0,t),e=Math.min(this.byteLength,e),e<=t)return new ArrayBuffer(0);const s=this.findShardForByte(t);if(s===-1)throw new Error(`Could not find start shard for byte ${t}`);const r=e-t,i=new ArrayBuffer(r),o=new Uint8Array(i);let a=0;for(let u=s;u<this.shards.length;u++){const l=this.shards[u],h=t+a-l.start,d=a,p=Math.min(e,l.end)-l.start,m=new Uint8Array(l.buffer,h,p-h);if(o.set(m,d),a+=m.length,e<l.end)break}return i}findShardForByte(t){if(this.shards.length===0||t<0||t>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(t/this.bufferUniformSize),this.previousShardIndex;function e(r){return t<r.start?-1:t>=r.end?1:0}if(e(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=oT(this.shards,e);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function oT(n,t){let e=0,s=n.length;for(;e<=s;){const r=Math.floor((s-e)/2)+e,i=t(n[r]);if(i===0)return r;i<0?s=r:e=r+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cf=4;async function Zg(n,t){const e=[],s=[],r=Array.isArray(n)?n.map(o=>o.name):Object.keys(n);for(let o=0;o<r.length;++o){const a=r[o],u=Array.isArray(n)?n[o].tensor:n[a];if(u.dtype!=="float32"&&u.dtype!=="int32"&&u.dtype!=="bool"&&u.dtype!=="string"&&u.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${u.dtype}`);const l={name:a,shape:u.shape,dtype:u.dtype};if(u.dtype==="string"){const c=new Promise(async h=>{const d=await u.bytes(),f=d.reduce((g,y)=>g+y.length,0)+cf*d.length,p=new Uint8Array(f);let m=0;for(let g=0;g<d.length;g++){const y=d[g],b=new Uint8Array(new Uint32Array([y.length]).buffer);p.set(b,m),m+=cf,p.set(y,m),m+=y.length}h(p)});s.push(c)}else s.push(u.data());t!=null&&(l.group=t),e.push(l)}const i=await Promise.all(s);return{data:aT(i),specs:e}}function Mx(n,t){const e=new di(n),s={};let r,i=0;for(const o of t){const a=o.name,u=o.dtype,l=o.shape,c=Et(l);let h;if("quantization"in o){const d=o.quantization;if(d.dtype==="uint8"||d.dtype==="uint16"){if(!("min"in d&&"scale"in d))throw new Error(`Weight ${o.name} with quantization ${d.dtype} doesn't have corresponding metadata min and scale.`)}else if(d.dtype==="float16"){if(u!=="float32")throw new Error(`Weight ${o.name} is quantized with ${d.dtype} which only supports weights of type float32 not ${u}.`)}else throw new Error(`Weight ${o.name} has unknown quantization dtype ${d.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const f=Yg[d.dtype],p=e.slice(i,i+c*f),m=d.dtype==="uint8"?new Uint8Array(p):new Uint16Array(p);if(u==="float32")if(d.dtype==="uint8"||d.dtype==="uint16"){h=new Float32Array(m.length);for(let g=0;g<m.length;g++){const y=m[g];h[g]=y*d.scale+d.min}}else if(d.dtype==="float16")r===void 0&&(r=fT()),h=r(m);else throw new Error(`Unsupported quantization type ${d.dtype} for weight type float32.`);else if(u==="int32"){if(d.dtype!=="uint8"&&d.dtype!=="uint16")throw new Error(`Unsupported quantization type ${d.dtype} for weight type int32.`);h=new Int32Array(m.length);for(let g=0;g<m.length;g++){const y=m[g];h[g]=Math.round(y*d.scale+d.min)}}else throw new Error(`Unsupported dtype in weight '${a}': ${u}`);i+=c*f}else if(u==="string"){const d=Et(o.shape);h=[];for(let f=0;f<d;f++){const p=new Uint32Array(e.slice(i,i+cf))[0];i+=cf;const m=new Uint8Array(e.slice(i,i+p));h.push(m),i+=p}}else{const d=Yg[u],f=e.slice(i,i+c*d);if(u==="float32")h=new Float32Array(f);else if(u==="int32")h=new Int32Array(f);else if(u==="bool")h=new Uint8Array(f);else if(u==="complex64"){h=new Float32Array(f);const p=new Float32Array(h.length/2),m=new Float32Array(h.length/2);for(let b=0;b<p.length;b++)p[b]=h[b*2],m[b]=h[b*2+1];const g=Cr(p,l,"float32"),y=Cr(m,l,"float32");s[a]=so(g,y),g.dispose(),y.dispose()}else throw new Error(`Unsupported dtype in weight '${a}': ${u}`);i+=c*d}u!=="complex64"&&(s[a]=Cr(h,l,u))}return s}function aT(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let t=0;const e=[];n.forEach(i=>{if(t+=i.byteLength,e.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${i.constructor.name}`)});const s=new Uint8Array(t);let r=0;return e.forEach(i=>{s.set(new Uint8Array(i.buffer),r),r+=i.byteLength}),s.buffer}const Z1=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function Jy(n){return Z1?Buffer.byteLength(n,"utf8"):new Blob([n]).size}function uT(n){if(Z1)return Buffer.from(n).toString("base64");const t=new Uint8Array(n);let e="";for(let s=0,r=t.length;s<r;s++)e+=String.fromCharCode(t[s]);return btoa(e)}function lT(n){if(Z1){const s=Buffer.from(n,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const t=atob(n),e=new Uint8Array(t.length);for(let s=0;s<t.length;++s)e.set([t.charCodeAt(s)],s);return e.buffer}function zx(n){return di.join(n)}function Qy(n){const t="/";for(n=n.trim();n.endsWith(t);)n=n.slice(0,n.length-1);const e=n.split(t);return e[e.length-1]}function Bx(n,t){const e={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:t};return n.signature!=null&&(e.signature=n.signature),n.userDefinedMetadata!=null&&(e.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(e.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(e.initializerSignature=n.initializerSignature),n.trainingConfig!=null&&(e.trainingConfig=n.trainingConfig),e}function Vx(n,t,e){const s={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy};if(n.trainingConfig!=null&&(s.trainingConfig=n.trainingConfig),n.weightsManifest!=null){if(!t)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!e)throw new Error("modelJSON has weightsManifest but weightData is null");s.weightSpecs=t,s.weightData=e}return n.signature!=null&&(s.signature=n.signature),n.userDefinedMetadata!=null&&(s.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(s.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(s.initializerSignature=n.initializerSignature),s}async function J1(n,t){let e,s;return n.weightsManifest!=null&&([e,s]=await t(n.weightsManifest)),Vx(n,e,s)}function Uh(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:Jy(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:Jy(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:new di(n.weightData).byteLength}}function Ux(n){const t=[];for(const e of n)t.push(...e.weights);return t}function cT(){const n=e=>{let s=e<<13,r=0;for(;!(s&8388608);)r-=8388608,s<<=1;return s&=-8388609,r+=947912704,s|r},t=new Uint32Array(2048);t[0]=0;for(let e=1;e<1024;e++)t[e]=n(e);for(let e=1024;e<2048;e++)t[e]=939524096+(e-1024<<13);return t}function hT(){const n=new Uint32Array(64);n[0]=0,n[31]=1199570944,n[32]=2147483648,n[63]=3347054592;for(let t=1;t<31;t++)n[t]=t<<23;for(let t=33;t<63;t++)n[t]=2147483648+(t-32<<23);return n}function dT(){const n=new Uint32Array(64);for(let t=0;t<64;t++)n[t]=1024;return n[0]=n[32]=0,n}function fT(){const n=cT(),t=hT(),e=dT();return s=>{const r=new ArrayBuffer(4*s.length),i=new Uint32Array(r);for(let o=0;o<s.length;o++){const a=s[o],u=n[e[a>>10]+(a&1023)]+t[a>>10];i[o]=u}return new Float32Array(r)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Sn{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Sn.instance==null&&(Sn.instance=new Sn),Sn.instance}static registerSaveRouter(t){Sn.getInstance().saveRouters.push(t)}static registerLoadRouter(t){Sn.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return Sn.getHandlers(t,"save")}static getLoadHandlers(t,e){return Sn.getHandlers(t,"load",e)}static getHandlers(t,e,s){const r=[];return(e==="load"?Sn.getInstance().loadRouters:Sn.getInstance().saveRouters).forEach(o=>{const a=o(t,s);a!==null&&r.push(a)}),r}}const pT=n=>Sn.registerSaveRouter(n),mT=n=>Sn.registerLoadRouter(n),Wx=n=>Sn.getSaveHandlers(n),gT=(n,t)=>Sn.getLoadHandlers(n,t);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jg="tensorflowjs",Qg=1,Ta="models_store",Oo="model_info_store";function Gx(){if(!vt().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const n=typeof window>"u"?self:window,t=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function t1(n){const t=n.result;t.createObjectStore(Ta,{keyPath:"modelPath"}),t.createObjectStore(Oo,{keyPath:"modelPath"})}class Fa{constructor(t){if(this.indexedDB=Gx(),t==null||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,t)}async load(){return this.databaseAction(this.modelPath)}databaseAction(t,e){return new Promise((s,r)=>{const i=this.indexedDB.open(Jg,Qg);i.onupgradeneeded=()=>t1(i),i.onsuccess=()=>{const o=i.result;if(e==null){const a=o.transaction(Ta,"readonly"),l=a.objectStore(Ta).get(this.modelPath);l.onsuccess=()=>{if(l.result==null)return o.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(l.result.modelArtifacts)},l.onerror=c=>(o.close(),r(l.error)),a.oncomplete=()=>o.close()}else{e.weightData=di.join(e.weightData);const a=Uh(e),u=o.transaction(Oo,"readwrite");let l=u.objectStore(Oo),c;try{c=l.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(d){return r(d)}let h;c.onsuccess=()=>{h=o.transaction(Ta,"readwrite");const d=h.objectStore(Ta);let f;try{f=d.put({modelPath:this.modelPath,modelArtifacts:e,modelArtifactsInfo:a})}catch(p){return r(p)}f.onsuccess=()=>s({modelArtifactsInfo:a}),f.onerror=p=>{l=u.objectStore(Oo);const m=l.delete(this.modelPath);m.onsuccess=()=>(o.close(),r(f.error)),m.onerror=g=>(o.close(),r(f.error))}},c.onerror=d=>(o.close(),r(c.error)),u.oncomplete=()=>{h==null?o.close():h.oncomplete=()=>o.close()}}},i.onerror=o=>r(i.error)})}}Fa.URL_SCHEME="indexeddb://";const jx=n=>vt().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Fa.URL_SCHEME)?yT(n.slice(Fa.URL_SCHEME.length)):null;Sn.registerSaveRouter(jx);Sn.registerLoadRouter(jx);function yT(n){return new Fa(n)}function bT(n){return n.startsWith(Fa.URL_SCHEME)?n.slice(Fa.URL_SCHEME.length):n}class xT{constructor(){this.indexedDB=Gx()}async listModels(){return new Promise((t,e)=>{const s=this.indexedDB.open(Jg,Qg);s.onupgradeneeded=()=>t1(s),s.onsuccess=()=>{const r=s.result,i=r.transaction(Oo,"readonly"),a=i.objectStore(Oo).getAll();a.onsuccess=()=>{const u={};for(const l of a.result)u[l.modelPath]=l.modelArtifactsInfo;t(u)},a.onerror=u=>(r.close(),e(a.error)),i.oncomplete=()=>r.close()},s.onerror=r=>e(s.error)})}async removeModel(t){return t=bT(t),new Promise((e,s)=>{const r=this.indexedDB.open(Jg,Qg);r.onupgradeneeded=()=>t1(r),r.onsuccess=()=>{const i=r.result,o=i.transaction(Oo,"readwrite"),a=o.objectStore(Oo),u=a.get(t);let l;u.onsuccess=()=>{if(u.result==null)return i.close(),s(new Error(`Cannot find model with path '${t}' in IndexedDB.`));{const c=a.delete(t),h=()=>{l=i.transaction(Ta,"readwrite");const f=l.objectStore(Ta).delete(t);f.onsuccess=()=>e(u.result.modelArtifactsInfo),f.onerror=p=>s(u.error)};c.onsuccess=h,c.onerror=d=>(h(),i.close(),s(u.error))}},u.onerror=c=>(i.close(),s(u.error)),o.oncomplete=()=>{l==null?i.close():l.oncomplete=()=>i.close()}},r.onerror=i=>s(r.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ji="/",Su="tensorflowjs_models",Hx="info",wT="model_topology",vT="weight_specs",kT="weight_data",ST="model_metadata";function Kx(n){return{info:[Su,n,Hx].join(Ji),topology:[Su,n,wT].join(Ji),weightSpecs:[Su,n,vT].join(Ji),weightData:[Su,n,kT].join(Ji),modelMetadata:[Su,n,ST].join(Ji)}}function qx(n){for(const t of Object.values(n))window.localStorage.removeItem(t)}function IT(n){const t=n.split(Ji);if(t.length<3)throw new Error(`Invalid key format: ${n}`);return t.slice(1,t.length-1).join(Ji)}function CT(n){return n.startsWith(La.URL_SCHEME)?n.slice(La.URL_SCHEME.length):n}class La{constructor(t){if(!vt().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,t==null||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=Kx(this.modelPath)}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const e=JSON.stringify(t.modelTopology),s=JSON.stringify(t.weightSpecs),r=Uh(t),i=di.join(t.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,uT(i));const o={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:t.signature!=null?t.signature:void 0,userDefinedMetadata:t.userDefinedMetadata!=null?t.userDefinedMetadata:void 0,modelInitializer:t.modelInitializer!=null?t.modelInitializer:void 0,initializerSignature:t.initializerSignature!=null?t.initializerSignature:void 0,trainingConfig:t.trainingConfig!=null?t.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:r}}catch{throw qx(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const t=JSON.parse(this.LS.getItem(this.keys.info));if(t==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(t.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const e={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);e.modelTopology=s;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);e.weightSpecs=r;const i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){const a=JSON.parse(i);e.format=a.format,e.generatedBy=a.generatedBy,e.convertedBy=a.convertedBy,a.signature!=null&&(e.signature=a.signature),a.userDefinedMetadata!=null&&(e.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(e.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(e.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(e.trainingConfig=a.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return e.weightData=lT(o),e}}La.URL_SCHEME="localstorage://";const Xx=n=>vt().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(La.URL_SCHEME)?NT(n.slice(La.URL_SCHEME.length)):null;Sn.registerSaveRouter(Xx);Sn.registerLoadRouter(Xx);function NT(n){return new La(n)}class TT{constructor(){V(vt().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),V(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const t={},e=Su+Ji,s=Ji+Hx;for(let r=0;r<this.LS.length;++r){const i=this.LS.key(r);if(i.startsWith(e)&&i.endsWith(s)){const o=IT(i);t[o]=JSON.parse(this.LS.getItem(i))}}return t}async removeModel(t){t=CT(t);const e=Kx(t);if(this.LS.getItem(e.info)==null)throw new Error(`Cannot find model at path '${t}'`);const s=JSON.parse(this.LS.getItem(e.info));return qx(e),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cu="://";class Es{constructor(){this.managers={}}static getInstance(){return Es.instance==null&&(Es.instance=new Es),Es.instance}static registerManager(t,e){V(t!=null,()=>"scheme must not be undefined or null."),t.endsWith(Cu)&&(t=t.slice(0,t.indexOf(Cu))),V(t.length>0,()=>"scheme must not be an empty string.");const s=Es.getInstance();V(s.managers[t]==null,()=>`A model store manager is already registered for scheme '${t}'.`),s.managers[t]=e}static getManager(t){const e=Es.getInstance().managers[t];if(e==null)throw new Error(`Cannot find model manager for scheme '${t}'`);return e}static getSchemes(){return Object.keys(Es.getInstance().managers)}}function Jd(n){if(n.indexOf(Cu)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${Es.getSchemes().join(",")}`);return{scheme:n.split(Cu)[0],path:n.split(Cu)[1]}}async function Yx(n,t,e=!1){V(n!==t,()=>`Old path and new path are the same: '${n}'`);const s=Sn.getLoadHandlers(n);V(s.length>0,()=>`Copying failed because no load handler is found for source URL ${n}.`),V(s.length<2,()=>`Copying failed because more than one (${s.length}) load handlers for source URL ${n}.`);const r=s[0],i=Sn.getSaveHandlers(t);V(i.length>0,()=>`Copying failed because no save handler is found for destination URL ${t}.`),V(i.length<2,()=>`Copying failed because more than one (${s.length}) save handlers for destination URL ${t}.`);const o=i[0],a=Jd(n).scheme,u=Jd(n).path,l=a===Jd(n).scheme,c=await r.load();e&&l&&await Es.getManager(a).removeModel(u);const h=await o.save(c);return e&&!l&&await Es.getManager(a).removeModel(u),h.modelArtifactsInfo}async function $T(){const n=Es.getSchemes(),t={};for(const e of n){const s=await Es.getManager(e).listModels();for(const r in s){const i=e+Cu+r;t[i]=s[r]}}return t}async function ET(n){const t=Jd(n);return Es.getManager(t.scheme).removeModel(t.path)}async function _T(n,t){return Yx(n,t,!1)}async function AT(n,t){return Yx(n,t,!0)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class RT{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(t,e){return fetch(t,e)}now(){return performance.now()}encode(t,e){if(e!=="utf-8"&&e!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${e}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)}decode(t,e){return new TextDecoder(e).decode(t)}setTimeoutCustom(t,e){if(typeof window>"u"||!vt().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(t,e);return}this.functionRefs.push(t),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},e),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const r=this.functionRefs[s.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(t){return vx(t)}}if(vt().get("IS_BROWSER")){vt().setPlatform("browser",new RT);try{Es.registerManager(La.URL_SCHEME,new TT)}catch{}try{Es.registerManager(Fa.URL_SCHEME,new xT)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DT={importFetch:()=>require("node-fetch")};let ug;class OT{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(t,e){return vt().global.fetch!=null?vt().global.fetch(t,e):(ug==null&&(ug=DT.importFetch()),ug(t,e))}now(){const t=process.hrtime();return t[0]*1e3+t[1]/1e6}encode(t,e){if(e!=="utf-8"&&e!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${e}`);return this.textEncoder.encode(t)}decode(t,e){return t.length===0?"":new this.util.TextDecoder(e).decode(t)}isTypedArray(t){return this.util.types.isFloat32Array(t)||this.util.types.isInt32Array(t)||this.util.types.isUint8Array(t)||this.util.types.isUint8ClampedArray(t)}}vt().get("IS_NODE")&&!vt().get("IS_BROWSER")&&vt().setPlatform("node",new OT);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fe(n,t="float32",e){return t=t||"float32",fr(n),new Vn(n,t,e)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FT(n,t){const e=U(n,"x","cast");if(!hx(t))throw new Error(`Failed to cast to unknown dtype ${t}`);if(t==="string"&&e.dtype!=="string"||t!=="string"&&e.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:e},r={dtype:t};return it.runKernel(Yu,s,r)}const Kt=ot({cast_:FT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LT(n){const e={x:U(n,"x","clone","string_or_numeric")};return it.runKernel(ll,e)}const Ri=ot({clone_:LT});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q1(n,t=!1){console.log(n.toString(t))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Lx();const PT={buffer:Fe,cast:Kt,clone:Ri,print:Q1};XN(PT);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MT(){vt().set("PROD",!0)}function zT(){vt().set("DEBUG",!0)}function BT(){vt().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function VT(n){vt().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function UT(){it.disposeVariables()}function xr(){return it}function hf(){return it.memory()}function WT(n){return it.profile(n)}function pt(n,t){return it.tidy(n,t)}function Se(n){K1(n).forEach(e=>e.dispose())}function es(n){return it.keep(n)}function GT(n){return it.time(n)}function jT(n){return it.setBackend(n)}function HT(){return it.ready()}function Zx(){return it.backendName}function KT(n){it.removeBackend(n)}function qT(n){return it.findBackend(n)}function XT(n){return it.findBackendFactory(n)}function t0(n,t,e=1){return it.registerBackend(n,t,e)}function e0(){return it.backend}function YT(n,t){vt().setPlatform(n,t)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZT(n,t){let e=U(n,"a","add"),s=U(t,"b","add");[e,s]=Nn(e,s);const r={a:e,b:s};return it.runKernel(Za,r)}const Lt=ot({add_:ZT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JT(n,t){let e=U(n,"a","floorDiv"),s=U(t,"b","floorDiv");[e,s]=Nn(e,s);const r={a:e,b:s};return it.runKernel(al,r)}const Kp=ot({floorDiv_:JT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QT(n,t){let e=U(n,"a","div"),s=U(t,"b","div");if([e,s]=Nn(e,s),e.dtype==="int32"&&s.dtype==="int32")return Kp(e,s);const r={a:e,b:s},i={};return it.runKernel(el,r,i)}const ie=ot({div_:QT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t$(n,t){let e=U(n,"a","mul"),s=U(t,"b","mul");[e,s]=Nn(e,s);const r={a:e,b:s};return it.runKernel(bl,r)}const ut=ot({mul_:t$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e$(n){const t=U(n,"x","abs");if(t.dtype==="complex64"){const e={x:t};return it.runKernel(Kc,e)}else{const e={x:t};return it.runKernel(Mc,e)}}const Pn=ot({abs_:e$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n$(n){const e={x:U(n,"x","acos")};return it.runKernel(Wu,e)}const n0=ot({acos_:n$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s$(n){const e={x:U(n,"x","acosh")};return it.runKernel(Gu,e)}const s0=ot({acosh_:s$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r$(n){V(Array.isArray(n),()=>"The argument passed to tf.addN() must be a list of tensors"),V(n.length>=1,()=>`Must pass at least one tensor to tf.addN(), but got ${n.length}`);const t=n.map((r,i)=>U(r,`tensors${i}`,"addN")),e=t[0];t.forEach(r=>{if(r.dtype!==e.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(r=>{if(!Ve(r.shape,e.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});const s=t;return it.runKernel(zc,s)}const Jx=ot({addN_:r$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i$(n,t=null,e=!1){const r={x:U(n,"x","all","bool")},i={axis:t,keepDims:e};return it.runKernel(Bf,r,i)}const qp=ot({all_:i$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o$(n,t=null,e=!1){const r={x:U(n,"x","any","bool")},i={axis:t,keepDims:e};return it.runKernel(Vf,r,i)}const Cc=ot({any_:o$});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a$(n,t=0){const s={x:U(n,"x","argMax")},r={axis:t};return it.runKernel(Bc,s,r)}const Wo=ot({argMax_:a$});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u$(n,t=0){const s={x:U(n,"x","argMin")},r={axis:t};return it.runKernel(Vc,s,r)}const r0=ot({argMin_:u$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l$(n){const e={x:U(n,"x","asin")};return it.runKernel(ju,e)}const i0=ot({asin_:l$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c$(n){const e={x:U(n,"x","asinh")};return it.runKernel(Hu,e)}const o0=ot({asinh_:c$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h$(n){const e={x:U(n,"x","atan")};return it.runKernel(Ku,e)}const a0=ot({atan_:h$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d$(n,t){let e=U(n,"a","atan2"),s=U(t,"b","atan2");[e,s]=Nn(e,s);const r={a:e,b:s};return it.runKernel(Xu,r)}const u0=ot({atan2_:d$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f$(n){const e={x:U(n,"x","atanh")};return it.runKernel(qu,e)}const l0=ot({atanh_:f$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wh(n,t,e,s,r="NHWC",i){const o=n[3],a=[...t,o],u=mo(r);return rs(n,a,e,i,s,null,null,u)}function jr(n,t,e,s,r,i,o="channelsLast"){const[a,u]=Nc(t);let l;if(o==="channelsLast")l=[a,u,n[3],n[3]];else if(o==="channelsFirst")l=[a,u,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return rs(n,l,e,s,r,i,!1,o)}function po(n,t,e,s,r,i,o="NDHWC"){const[a,u,l]=e1(t);let c,h;if(o==="NDHWC")h="channelsLast",c=[a,u,l,n[4],n[4]];else if(o==="NCDHW")h="channelsFirst",c=[a,u,l,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return ta(n,c,e,s,r,!1,h,i)}function rs(n,t,e,s,r,i,o=!1,a="channelsLast"){let[u,l,c,h]=[-1,-1,-1,-1];if(a==="channelsLast")[u,l,c,h]=n;else if(a==="channelsFirst")[u,h,l,c]=n;else throw new Error(`Unknown dataFormat ${a}`);const[d,f,,p]=t,[m,g]=Nc(e),[y,b]=Nc(s),w=Nu(d,y),v=Nu(f,b),{padInfo:S,outHeight:N,outWidth:R}=g$(r,l,c,m,g,w,v,i,a),L=o?p*h:p;let F;return a==="channelsFirst"?F=[u,L,N,R]:a==="channelsLast"&&(F=[u,N,R,L]),{batchSize:u,dataFormat:a,inHeight:l,inWidth:c,inChannels:h,outHeight:N,outWidth:R,outChannels:L,padInfo:S,strideHeight:m,strideWidth:g,filterHeight:d,filterWidth:f,effectiveFilterHeight:w,effectiveFilterWidth:v,dilationHeight:y,dilationWidth:b,inShape:n,outShape:F,filterShape:t}}function ta(n,t,e,s,r,i=!1,o="channelsLast",a){let[u,l,c,h,d]=[-1,-1,-1,-1,-1];if(o==="channelsLast")[u,l,c,h,d]=n;else if(o==="channelsFirst")[u,d,l,c,h]=n;else throw new Error(`Unknown dataFormat ${o}`);const[f,p,m,,g]=t,[y,b,w]=e1(e),[v,S,N]=e1(s),R=Nu(f,v),L=Nu(p,S),F=Nu(m,N),{padInfo:B,outDepth:H,outHeight:z,outWidth:G}=y$(r,l,c,h,y,b,w,R,L,F,a),T=i?g*d:g;let K;return o==="channelsFirst"?K=[u,T,H,z,G]:o==="channelsLast"&&(K=[u,H,z,G,T]),{batchSize:u,dataFormat:o,inDepth:l,inHeight:c,inWidth:h,inChannels:d,outDepth:H,outHeight:z,outWidth:G,outChannels:T,padInfo:B,strideDepth:y,strideHeight:b,strideWidth:w,filterDepth:f,filterHeight:p,filterWidth:m,effectiveFilterDepth:R,effectiveFilterHeight:L,effectiveFilterWidth:F,dilationDepth:v,dilationHeight:S,dilationWidth:N,inShape:n,outShape:K,filterShape:t}}function p$(n,t,e,s,r){s==null&&(s=c0(n,t,e));const i=n[0],o=n[1],a=Tc((i-t+2*s)/e+1,r),u=Tc((o-t+2*s)/e+1,r);return[a,u]}function m$(n,t,e,s,r,i){r==null&&(r=c0(n,t[0],s[0]));const o=[0,0,0,e];for(let a=0;a<3;a++)n[a]+2*r>=t[a]&&(o[a]=Tc((n[a]-t[a]+2*r)/s[a]+1,i));return o}function c0(n,t,e,s=1){const r=Nu(t,s);return Math.floor((n[0]*(e-1)-e+r)/2)}function Nc(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function e1(n){return typeof n=="number"?[n,n,n]:n}function Nu(n,t){return t<=1?n:n+(n-1)*(t-1)}function g$(n,t,e,s,r,i,o,a,u){let l,c,h;if(typeof n=="number"){l={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};const f=p$([t,e],i,s,n,a);c=f[0],h=f[1]}else if(n==="same"){c=Math.ceil(t/s),h=Math.ceil(e/r);const d=Math.max(0,(c-1)*s+i-t),f=Math.max(0,(h-1)*r+o-e),p=Math.floor(d/2),m=d-p,g=Math.floor(f/2),y=f-g;l={top:p,bottom:m,left:g,right:y,type:"SAME"}}else if(n==="valid")l={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((t-i+1)/s),h=Math.ceil((e-o+1)/r);else if(typeof n=="object"){const d=u==="channelsLast"?n[1][0]:n[2][0],f=u==="channelsLast"?n[1][1]:n[2][1],p=u==="channelsLast"?n[2][0]:n[3][0],m=u==="channelsLast"?n[2][1]:n[3][1];l={top:d,bottom:f,left:p,right:m,type:d===0&&f===0&&p===0&&m===0?"VALID":"EXPLICIT"},c=Tc((t-i+d+f)/s+1,a),h=Tc((e-o+p+m)/r+1,a)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:l,outHeight:c,outWidth:h}}function y$(n,t,e,s,r,i,o,a,u,l,c){let h,d,f,p;if(n==="valid"&&(n=0),typeof n=="number"){h={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};const g=m$([t,e,s,1],[a,u,l],1,[r,i,o],n,c);d=g[0],f=g[1],p=g[2]}else if(n==="same"){d=Math.ceil(t/r),f=Math.ceil(e/i),p=Math.ceil(s/o);const m=(d-1)*r+a-t,g=(f-1)*i+u-e,y=(p-1)*o+l-s,b=Math.floor(m/2),w=m-b,v=Math.floor(g/2),S=g-v,N=Math.floor(y/2),R=y-N;h={top:v,bottom:S,left:N,right:R,front:b,back:w,type:"SAME"}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:h,outDepth:d,outHeight:f,outWidth:p}}function Tc(n,t){if(!t)return Math.trunc(n);switch(t){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${t}`)}}function Go(n){const[t,e,s]=Nc(n);return t===1&&e===1&&s===1}function ds(n,t){return Go(n)||Go(t)}function Pa(n){return Nc(n).every(t=>t>0)}function mo(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function Ps(n,t,e){if(e!=null){if(typeof t=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${e} but got pad ${t}.`);if(typeof t=="number")V(Oa(t),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${e} but got pad ${t}.`);else if(typeof t=="object")t.forEach(s=>{s.forEach(r=>{V(Oa(r),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${e} but got pad ${r}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${t}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b$(n,t){const s={x:U(n,"x","reshape","string_or_numeric")},r={shape:t};return it.runKernel(Th,s,r)}const ct=ot({reshape_:b$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x$(n,t,e,s,r){const i=U(n,"x","avgPool","float32"),o=1;V(ds(e,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${e} and dilations '${o}'`);let a=i,u=!1;i.rank===3&&(u=!0,a=ct(i,[1,i.shape[0],i.shape[1],i.shape[2]])),V(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),Ps("avgPool",s,r);const l={x:a},c={filterSize:t,strides:e,pad:s,dimRoundingMode:r};let h=it.runKernel(Uc,l,c);return h=Kt(h,i.dtype),u?ct(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const Gh=ot({avgPool_:x$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w$(n,t,e,s,r,i="NDHWC"){const o=U(n,"x","avgPool3d","float32");let a=o,u=!1;o.rank===4&&(u=!0,a=ct(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),V(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),V(i==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),V(typeof e=="number"&&e>0||Array.isArray(e)&&e[0]>0&&e[1]>0&&e[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${e}'`),Ps("avgPool3d",s,r);const l={x:a},c={filterSize:t,strides:e,pad:s,dimRoundingMode:r,dataFormat:i};let h=it.runKernel(Wc,l,c);return h=Kt(h,a.dtype),u?ct(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const h0=ot({avgPool3d_:w$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v$(n,t=0){V(n.length>=1,()=>"Pass at least one tensor to concat");const e=Ic(n,"tensors","concat","string_or_numeric");if(e[0].dtype==="complex64"&&e.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),e.length===1)return Ri(e[0]);const s=e,r={axis:t};return it.runKernel(qc,s,r)}const Cn=ot({concat_:v$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k$(n,t,e=!1,s=!1){let r=U(n,"a","matMul"),i=U(t,"b","matMul");[r,i]=Nn(r,i);const o={a:r,b:i},a={transposeA:e,transposeB:s};return it.runKernel(Gc,o,a)}const De=ot({matMul_:k$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S$(n){const e={x:U(n,"x","sigmoid","float32")};return it.runKernel(El,e)}const Hs=ot({sigmoid_:S$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I$(n,t,e){const s=U(n,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const r={x:s},i={begin:t,size:e};return it.runKernel(Rh,r,i)}const xe=ot({slice_:I$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C$(n){const e={x:U(n,"x","tanh","float32")};return it.runKernel(Fl,e)}const Ma=ot({tanh_:C$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N$(n,t,e,s,r,i){const o=U(n,"forgetBias","basicLSTMCell"),a=U(t,"lstmKernel","basicLSTMCell"),u=U(e,"lstmBias","basicLSTMCell"),l=U(s,"data","basicLSTMCell"),c=U(r,"c","basicLSTMCell"),h=U(i,"h","basicLSTMCell"),d=Cn([l,h],1),f=De(d,a),p=Lt(f,u),m=p.shape[0],g=p.shape[1]/4,y=[m,g],b=xe(p,[0,0],y),w=xe(p,[0,g],y),v=xe(p,[0,g*2],y),S=xe(p,[0,g*3],y),N=Lt(ut(Hs(b),Ma(w)),ut(c,Hs(Lt(o,v)))),R=ut(Ma(N),Hs(S));return[N,R]}const Qx=ot({basicLSTMCell_:N$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T$(n,t,e){const s=U(n,"x","batchToSpaceND"),r=t.reduce((a,u)=>a*u);V(s.rank>=1+t.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${t.length}`),V(e.length===t.length,()=>`crops.length is ${e.length} but should be equal to blockShape.length  ${t.length}`),V(s.shape[0]%r===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${t.join(" * ")} === ${r}`);const i={x:s},o={blockShape:t,crops:e};return it.runKernel(jc,i,o)}const jh=ot({batchToSpaceND_:T$});function $$(n){let t;return n.rank===0||n.rank===1?t=ct(n,[1,1,1,n.size]):n.rank===2?t=ct(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?t=ct(n,[1,n.shape[0],n.shape[1],n.shape[2]]):t=n,t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E$(n,t,e,s,r,i){i==null&&(i=.001);const o=U(n,"x","batchNorm"),a=U(t,"mean","batchNorm"),u=U(e,"variance","batchNorm");let l;r!=null&&(l=U(r,"scale","batchNorm"));let c;s!=null&&(c=U(s,"offset","batchNorm")),V(a.rank===u.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),V(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),V(l==null||a.rank===l.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const d={x:$$(o),scale:l,offset:c,mean:a,variance:u},f={varianceEpsilon:i},p=it.runKernel(sh,d,f);return ct(p,o.shape)}const Ml=ot({batchNorm_:E$});function _$(n,t,e,s,r,i){const o=U(n,"x","batchNorm"),a=U(t,"mean","batchNorm"),u=U(e,"variance","batchNorm");let l;r!=null&&(l=U(r,"scale","batchNorm"));let c;return s!=null&&(c=U(s,"offset","batchNorm")),V(o.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`),V(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),V(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${u.rank}.`),l!=null&&V(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${l.rank}.`),c!=null&&V(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${c.rank}.`),Ml(o,a,u,c,l,i)}const d0=ot({batchNorm2d_:_$});function A$(n,t,e,s,r,i){const o=U(n,"x","batchNorm"),a=U(t,"mean","batchNorm"),u=U(e,"variance","batchNorm");let l;r!=null&&(l=U(r,"scale","batchNorm"));let c;return s!=null&&(c=U(s,"offset","batchNorm")),V(o.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`),V(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),V(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${u.rank}.`),l!=null&&V(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${l.rank}.`),c!=null&&V(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${c.rank}.`),Ml(o,a,u,c,l,i)}const f0=ot({batchNorm3d_:A$});function R$(n,t,e,s,r,i){const o=U(n,"x","batchNorm"),a=U(t,"mean","batchNorm"),u=U(e,"variance","batchNorm");let l;r!=null&&(l=U(r,"scale","batchNorm"));let c;return s!=null&&(c=U(s,"offset","batchNorm")),V(o.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`),V(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),V(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${u.rank}.`),l!=null&&V(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${l.rank}.`),c!=null&&V(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${c.rank}.`),Ml(o,a,u,c,l,i)}const p0=ot({batchNorm4d_:R$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D$(n,t,e){const s=U(n,"x","bincount"),r=U(t,"weights","bincount");V(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),V(e>=0,()=>`size must be non-negative, but got ${e}.`),V(r.size===s.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${r.shape}.`);const i={x:s,weights:r},o={size:e};return it.runKernel(Gf,i,o)}const m0=ot({bincount_:D$});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O$(n,t){const e=U(n,"x","bitwiseAnd"),s=U(t,"y","bitwiseAnd");if(!Ve(e.shape,s.shape))throw new Error(`BitwiseAnd: Tensors must have the same shape. x: ${e.shape}, y: ${s.shape}`);if(e.dtype!=="int32"||s.dtype!=="int32")throw new Error(`BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ${e.dtype} and type of y: ${s.dtype}`);const r={a:e,b:s};return it.runKernel(Hc,r)}const tw=ot({bitwiseAnd_:O$});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F$(n,t){const e=U(n,"s0","broadcastArgs","int32"),s=U(t,"s1","broadcastArgs","int32");if(e.rank!==1)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${e.rank}`);if(s.rank!==1)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${s.rank}`);const r={s0:e,s1:s};return it.runKernel(jf,r)}const ew=ot({broadcastArgs_:F$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L$(n,t){let e=U(n,"broadcastTo","x");const s=e.shape;if(fr(t),t.length<e.rank)throw new Error(`broadcastTo(): shape.length=${t.length} < input.rank=${e.rank}.`);if(t.length>e.rank){const l=e.shape.slice();for(;l.length<t.length;)l.unshift(1);e=ct(e,l)}const r=e.shape,i=Array.from(t);for(let l=t.length-1;l>=0;l--)if(r[l]===t[l])i[l]=1;else if(e.shape[l]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${t}].`);if(i.map((l,c)=>l>1?c:-1).filter(l=>l>=0).length===0)return Ri(e);const a={x:e},u={reps:i};return it.runKernel(Ll,a,u)}const Aa=ot({broadcastTo_:L$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P$(n){const e={x:U(n,"x","ceil","float32")};return it.runKernel(Zu,e)}const g0=ot({ceil_:P$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qa(n,t,e){fr(n),e=e||Xa(t);const s={shape:n,value:t,dtype:e};return it.runKernel(ap,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M$(n,t,e){const s=U(n,"x","clipByValue");if(V(t<=e,()=>`Error in clip: min (${t}) must be less than or equal to max (${e}).`),t===e)return Qa(s.shape,t,s.dtype);const r={x:s},i={clipValueMin:t,clipValueMax:e};return it.runKernel(Ju,r,i)}const Os=ot({clipByValue_:M$});function z$(n){return Cn(n,0)}const y0=ot({concat1d_:z$});function B$(n,t){return Cn(n,t)}const b0=ot({concat2d_:B$});function V$(n,t){return Cn(n,t)}const x0=ot({concat3d_:V$});function U$(n,t){return Cn(n,t)}const w0=ot({concat4d_:U$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W$(n,t,e,s,r="NHWC",i=[1,1],o){const a=U(n,"x","conv2d","float32"),u=U(t,"filter","conv2d","float32");let l=a,c=!1;a.rank===3&&(c=!0,l=ct(a,[1,a.shape[0],a.shape[1],a.shape[2]])),V(l.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${l.rank}.`),V(u.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`),Ps("conv2d",s,o);const h=r==="NHWC"?l.shape[3]:l.shape[1];V(h===u.shape[2],()=>`Error in conv2d: depth of input (${h}) must match input depth for filter ${u.shape[2]}.`),V(ds(e,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`),V(Pa(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),V(Pa(e),()=>"Error in conv2D: Strides should be larger than 0.");const d={x:l,filter:u},f={strides:e,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o},p=it.runKernel(Xc,d,f);return c?ct(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const ro=ot({conv2d_:W$});function G$(n,t,e,s,r="NWC",i=1,o){const a=U(n,"x","conv1d"),u=U(t,"filter","conv1d");let l=a,c=!1;a.rank===2&&(c=!0,l=ct(a,[1,a.shape[0],a.shape[1]])),V(l.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${l.rank}.`),V(u.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`),Ps("conv1d",s,o),V(l.shape[2]===u.shape[1],()=>`Error in conv1d: depth of input (${l.shape[2]}) must match input depth for filter ${u.shape[1]}.`),V(ds(e,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${e} and dilation '${i}'`),V(Pa(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),V(Pa(e),()=>"Error in conv1D: Stride should be larger than 0."),V(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const h=ct(u,[1,u.shape[0],u.shape[1],u.shape[2]]),d=ct(l,[l.shape[0],1,l.shape[1],l.shape[2]]),g=ro(d,h,[1,e],s,"NHWC",[1,i],o);return c?ct(g,[g.shape[2],g.shape[3]]):ct(g,[g.shape[0],g.shape[2],g.shape[3]])}const Xp=ot({conv1d_:G$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j$(n,t,e,s,r,i="NHWC",o){V(n.length===t.rank,()=>`Length of inShape (${n.length}) and rank of dy (${t.rank}) must match`);let a=n,u=t,l=!1;t.rank===3&&(l=!0,u=ct(t,[1,t.shape[0],t.shape[1],t.shape[2]]),a=[1,n[0],n[1],n[2]]),V(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),V(u.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`),V(e.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${e.rank}`);const c=i==="NHWC"?a[3]:a[1],h=i==="NHWC"?u.shape[3]:u.shape[1];V(c===e.shape[2],()=>`Error in conv2dDerInput: depth of input (${c}) must match input depth for filter ${e.shape[2]}.`),V(h===e.shape[3],()=>`Error in conv2dDerInput: depth of output (${h}) must match output depth for filter ${e.shape[3]}.`),Ps("conv2dDerInput",r,o);const d={dy:u,filter:e},f={strides:s,pad:r,dataFormat:i,dimRoundingMode:o,inputShape:a},p=it.runKernel(Yc,d,f);return l?ct(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const v0=ot({conv2DBackpropInput_:j$});function H$(n,t,e,s,r,i){const o=U(n,"x","conv2dTranspose"),a=U(t,"filter","conv2dTranspose");return v0(e,o,a,s,r,"NHWC",i)}const Yp=ot({conv2dTranspose_:H$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K$(n,t,e,s,r="NDHWC",i=[1,1,1]){const o=U(n,"x","conv3d"),a=U(t,"filter","conv3d");let u=o,l=!1;o.rank===4&&(l=!0,u=ct(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),V(u.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${u.rank}.`),V(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),V(u.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${u.shape[4]}) must match input depth for filter ${a.shape[3]}.`),V(ds(e,i),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`),V(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`),V(Pa(i),()=>"Error in conv3D: Dilated rates should be larger than 0."),V(Pa(e),()=>"Error in conv3D: Strides should be larger than 0.");const c={x:u,filter:a},h={strides:e,pad:s,dataFormat:r,dilations:i},d=it.runKernel(Zc,c,h);return l?ct(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const k0=ot({conv3d_:K$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q$(n,t,e,s,r){V(n.length===t.rank,()=>`Length of inShape (${n.length}) and rank of dy (${t.rank}) must match`);let i=n,o=t,a=!1;t.rank===4&&(a=!0,o=ct(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),i=[1,n[0],n[1],n[2],n[3]]);const u=i[4],l=o.shape[4];V(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),V(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),V(e.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${e.rank}`),V(u===e.shape[3],()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${e.shape[3]}.`),V(l===e.shape[4],()=>`Error in conv3dDerInput: depth of output (${l}) must match output depth for filter ${e.shape[4]}.`);const c={dy:o,filter:e},h={pad:r,strides:s,inputShape:i},d=it.runKernel(Xf,c,h);return a?ct(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const nw=ot({conv3DBackpropInput_:q$});function X$(n,t,e,s,r){const i=U(n,"x","conv3dTranspose"),o=U(t,"filter","conv3dTranspose");return nw(e,i,o,s,r)}const S0=ot({conv3dTranspose_:X$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y$(n){const e={x:U(n,"x","cos","float32")};return it.runKernel(Qu,e)}const Hh=ot({cos_:Y$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z$(n){const e={x:U(n,"x","cosh","float32")};return it.runKernel(tl,e)}const Zp=ot({cosh_:Z$});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J$(n,t=0,e=!1,s=!1){const i={x:U(n,"x","cumprod")},o={axis:t,exclusive:e,reverse:s};return it.runKernel(Yf,i,o)}const $c=ot({cumprod_:J$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q$(n,t=0,e=!1,s=!1){const i={x:U(n,"x","cumsum")},o={axis:t,exclusive:e,reverse:s};return it.runKernel(Jc,i,o)}const Jp=ot({cumsum_:Q$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tE(n,t,e,s=!1){const r=U(n,"x","denseBincount"),i=U(t,"weights","denseBincount");V(r.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`),V(r.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`),V(e>=0,()=>`size must be non-negative, but got ${e}.`),V(i.size===r.size||i.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${i.shape}.`);const o={x:r,weights:i},a={size:e,binaryOutput:s};return it.runKernel(Jf,o,a)}const df=ot({denseBincount_:tE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eE(n,t,e="NHWC"){const s=U(n,"x","depthToSpace","float32"),r=e==="NHWC"?s.shape[1]:s.shape[2],i=e==="NHWC"?s.shape[2]:s.shape[3],o=e==="NHWC"?s.shape[3]:s.shape[1];V(t>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${t}`),V(r*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${t}  for depthToSpace with input shape
    ${s.shape}`),V(i*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${t} for depthToSpace with input shape
        ${s.shape}`),V(o%(t*t)===0,()=>`Dimension size must be evenly divisible by ${t*t} but is ${o} for depthToSpace with input shape ${s.shape}`);const a={x:s},u={blockSize:t,dataFormat:e};return it.runKernel(Qf,a,u)}const I0=ot({depthToSpace_:eE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nE(n,t,e,s,r="NHWC",i=[1,1],o){const a=U(n,"x","depthwiseConv2d","float32"),u=U(t,"filter","depthwiseConv2d","float32");let l=a,c=!1;a.rank===3&&(c=!0,l=ct(a,[1,a.shape[0],a.shape[1],a.shape[2]])),V(l.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${l.rank}.`),V(u.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`);const h=r==="NHWC"?l.shape[3]:l.shape[1];V(h===u.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${h}) must match the inChannels dimension in filter ${u.shape[2]}.`),Ps("depthwiseConv2d",s,o);const d={x:l,filter:u},f={strides:e,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o},p=it.runKernel(Qc,d,f);return c?ct(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const zl=ot({depthwiseConv2d_:nE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sE(n){const e={x:U(n,"x","diag")};return it.runKernel(np,e)}const sw=ot({diag_:sE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rE(n,t,e,s,r=[1,1],i="NHWC"){const o=U(n,"x","dilation2d"),a=U(t,"filter","dilation2d");V(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),V(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),V(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let u=o,l=!1;o.rank===3&&(u=ct(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=!0),V(u.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${u.shape[3]} vs ${a.shape[2]}`);const c={x:u,filter:a},h={strides:e,pad:s,dilations:r},d=it.runKernel(th,c,h);return l?ct(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const C0=ot({dilation2d_:rE});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function za(n,t){const e=n.length,s=[];for(let r=0;r<e;r++){const i=e-1-r,o=n[i]||1;(t[t.length-1-r]||1)>1&&o===1&&s.unshift(i)}return s}function Un(n,t){const e=[];for(let s=0;s<t.length;s++){const r=n[n.length-s-1],i=t.length-s-1,o=t[i];(r==null||r===1&&o>1)&&e.unshift(i)}return e}function Ee(n,t){const e=Math.max(n.length,t.length),s=new Array(e);for(let r=0;r<e;r++){let i=n[n.length-r-1];i==null&&(i=1);let o=t[t.length-r-1];if(o==null&&(o=1),i===1)s[e-r-1]=o;else if(o===1)s[e-r-1]=i;else if(i!==o){const a=`Operands could not be broadcast together with shapes ${n} and ${t}.`;throw Error(a)}else s[e-r-1]=i}return s}const iE=Object.freeze(Object.defineProperty({__proto__:null,assertAndGetBroadcastShape:Ee,getBroadcastDims:za,getReductionAxes:Un},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oE(n,t){let e=U(n,"a","equal","string_or_numeric"),s=U(t,"b","equal","string_or_numeric");[e,s]=Nn(e,s),Ee(e.shape,s.shape);const r={a:e,b:s};return it.runKernel(eh,r)}const ar=ot({equal_:oE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aE(n,t,e){const s=U(t,"a","where"),r=U(e,"b","where"),i=U(n,"condition","where","bool"),o=Ee(Ee(i.shape,s.shape),r.shape),a=Aa(i,o),u=Aa(s,o),l=Aa(r,o),c={condition:a,t:u,e:l};return it.runKernel(Ah,c)}const us=ot({where_:aE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uE(n){const e={x:U(n,"x","zerosLike")};return it.runKernel(Bh,e)}const je=ot({zerosLike_:uE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lE(n,t){let e=U(n,"a","div"),s=U(t,"b","div");[e,s]=Nn(e,s);const r=ie(e,s),i=je(r),o=ar(s,i);return us(o,i,r)}const N0=ot({divNoNan_:lE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cE(n,t){const e=U(n,"t1","dot"),s=U(t,"t2","dot");V((e.rank===1||e.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${e.rank} and ${s.rank}.`);const r=e.rank===1?e.size:e.shape[1],i=s.rank===1?s.size:s.shape[0];if(V(r===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${i}.`),e.rank===1&&s.rank===1){const o=ct(e,[1,-1]),a=ct(s,[-1,1]),u=De(o,a);return ct(u,[])}else if(e.rank===1&&s.rank===2){const o=ct(e,[1,-1]),a=ct(s,[s.shape[0],s.shape[1]]),u=De(o,a);return ct(u,[u.size])}else if(e.rank===2&&s.rank===1){const o=ct(s,[-1,1]),a=De(e,o);return ct(a,[a.size])}else{const o=ct(s,[s.shape[0],s.shape[1]]);return De(e,o)}}const T0=ot({dot_:cE});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hE(n,...t){const e=t.map((r,i)=>U(r,`tensors${i}`,"einsum")),s={equation:n};return it.runKernel(rp,e,s)}const rw=ot({einsum_:hE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dE(n){const e={x:U(n,"x","elu","float32")};return it.runKernel(nl,e)}const Bl=ot({elu_:dE});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fE(n,t){const e=U(n,"x","ensureShape","string_or_numeric");if(!lx(e.shape,t))throw new Error(`EnsureShape: Shape of tensor ${e.shape} is not compatible with expected shape ${t}`);return n}const iw=ot({ensureShape_:fE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pE(n){let t=U(n,"x","erf");V(t.dtype==="int32"||t.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),t.dtype==="int32"&&(t=Kt(t,"float32"));const e={x:t};return it.runKernel(sl,e)}const $0=ot({erf_:pE});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E0(n,t){for(let e=0;e<n.length;++e)if(n[n.length-e-1]!==t-1-e)return!1;return!0}function ow(n,t,e){const s=n.length+t.length,r=[];let i=0,o=0;for(let a=0;a<s;a++)e.indexOf(a)===-1?r.push(n[i++]):r.push(t[o++]);return r}function is(n,t){const e=[],s=n.length;for(let i=0;i<s;i++)t.indexOf(i)===-1&&e.push(n[i]);const r=t.map(i=>n[i]);return[e,r]}function An(n,t){const e=t.map(s=>1);return ow(n,e,t)}function fs(n,t,e){V(E0(t,e),()=>`${n} supports only inner-most axes for now. Got axes ${t} and rank-${e} input.`)}function Tn(n,t){if(E0(n,t))return null;const e=[];for(let s=0;s<t;++s)n.indexOf(s)===-1&&e.push(s);return n.forEach(s=>e.push(s)),e}function ea(n){return n.map((t,e)=>[e,t]).sort((t,e)=>t[1]-e[1]).map(t=>t[0])}function Rn(n,t){const e=[];for(let s=t-n;s<t;++s)e.push(s);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mE(n,t=null,e=!1){const r={x:U(n,"x","max")},i={reductionIndices:t,keepDims:e};return it.runKernel(fh,r,i)}const Nr=ot({max_:mE});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gE(n,t=null,e=!1){const r={x:U(n,"x","min")},i={axis:t,keepDims:e};return it.runKernel(yh,r,i)}const Ru=ot({min_:gE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yE(n,t){let e=U(n,"base","pow"),s=U(t,"exp","pow");[e,s]=Nn(e,s);const r={a:e,b:s};return it.runKernel(xl,r)}const io=ot({pow_:yE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fe(n,t){if((ts(n)&&t!=="string"||Array.isArray(n))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(t==="string"&&ts(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Qo(n,[],[],t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bE(n){const e={x:U(n,"x","sqrt","float32")};return it.runKernel(Al,e)}const cs=ot({sqrt_:bE});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xE(n){const t=U(n,"x","square"),e={};return it.runKernel("Square",{x:t},e)}const an=ot({square_:xE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wE(n,t=null,e=!1){let s=U(n,"x","sum");s.dtype==="bool"&&(s=Kt(s,"int32"));const r={x:s},i={axis:t,keepDims:e};return it.runKernel(Dh,r,i)}const he=ot({sum_:wE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vE(n,t="euclidean",e=null,s=!1){n=U(n,"x","norm");const r=aw(n,t,e);let i=r.shape;if(s){const o=Pe(e,n.shape);i=An(r.shape,o)}return ct(r,i)}function aw(n,t,e=null){if(n.rank===0)return Pn(n);if(n.rank!==1&&e===null)return aw(ct(n,[-1]),t,e);if(n.rank===1||typeof e=="number"||Array.isArray(e)&&e.length===1){if(t===1)return he(Pn(n),e);if(t===1/0)return Nr(Pn(n),e);if(t===-1/0)return Ru(Pn(n),e);if(t==="euclidean"||t===2)return cs(he(io(Pn(n),fe(2,"int32")),e));throw new Error(`Error in norm: invalid ord value: ${t}`)}if(Array.isArray(e)&&e.length===2){if(t===1)return Nr(he(Pn(n),e[0]),e[1]-1);if(t===1/0)return Nr(he(Pn(n),e[1]),e[0]);if(t===-1/0)return Ru(he(Pn(n),e[1]),e[0]);if(t==="fro"||t==="euclidean")return cs(he(an(n),e));throw new Error(`Error in norm: invalid ord value: ${t}`)}throw new Error(`Error in norm: invalid axis: ${e}`)}const Vl=ot({norm_:vE});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kE(n,t=null,e=!1){return Vl(n,"euclidean",t,e)}const _0=ot({euclideanNorm_:kE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SE(n){const e={x:U(n,"x","exp")};return it.runKernel(rl,e)}const Fs=ot({exp_:SE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IE(n,t=0){const e=U(n,"x","expandDims","string_or_numeric");V(t<=e.rank,()=>"Axis must be <= rank of the tensor");const s={input:e},r={dim:t};return it.runKernel(nh,s,r)}const gn=ot({expandDims_:IE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CE(n){const e={x:U(n,"x","expm1")};return it.runKernel(il,e)}const A0=ot({expm1_:CE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NE(n,t){const e=U(n,"x","tile","string_or_numeric");V(e.rank===t.length,()=>`Error in transpose: rank of input ${e.rank} must match length of reps ${t}.`);const s={x:e},r={reps:t};return it.runKernel(Ll,s,r)}const kr=ot({tile_:NE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TE(n,t,e,s="float32"){t==null&&(t=n);const r=Fe([n,t],s),i=n<=t?n:t;for(let a=0;a<i;++a)r.set(1,a,a);const o=ct(r.toTensor(),[n,t]);if(e==null)return o;if(e.length===1)return kr(gn(o,0),[e[0],1,1]);if(e.length===2)return kr(gn(gn(o,0),0),[e[0],e[1],1,1]);if(e.length===3)return kr(gn(gn(gn(o,0),0),0),[e[0],e[1],e[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${e.length}D.`)}const Qp=ot({eye_:TE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $E(n){const e={x:U(n,"x","floor","float32")};return it.runKernel(ol,e)}const Ul=ot({floor_:$E});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EE(n,t,e=0,s=0){const r=U(n,"x","gather"),i=U(t,"indices","gather","int32"),o={x:r,indices:i},a={axis:e,batchDims:s};return it.runKernel(rh,o,a)}const Wl=ot({gather_:EE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _E(n,t){let e=U(n,"a","greater","string_or_numeric"),s=U(t,"b","greater","string_or_numeric");[e,s]=Nn(e,s),Ee(e.shape,s.shape);const r={a:e,b:s};return it.runKernel(ih,r)}const Ms=ot({greater_:_E});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AE(n,t){let e=U(n,"a","greaterEqual","string_or_numeric"),s=U(t,"b","greaterEqual","string_or_numeric");[e,s]=Nn(e,s),Ee(e.shape,s.shape);const r={a:e,b:s};return it.runKernel(ul,r)}const go=ot({greaterEqual_:AE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RE(n){const e={input:U(n,"input","imag")};return it.runKernel(hp,e)}const Kh=ot({imag_:RE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DE(n){const e={x:U(n,"x","isFinite")};return it.runKernel(cl,e)}const R0=ot({isFinite_:DE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OE(n){const e={x:U(n,"x","isInf")};return it.runKernel(hl,e)}const D0=ot({isInf_:OE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FE(n){const e={x:U(n,"x","isNaN")};return it.runKernel(dl,e)}const O0=ot({isNaN_:FE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LE(n,t=.2){const s={x:U(n,"x","leakyRelu")},r={alpha:t};return it.runKernel(oh,s,r)}const qh=ot({leakyRelu_:LE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PE(n,t){let e=U(n,"a","less","string_or_numeric"),s=U(t,"b","less","string_or_numeric");[e,s]=Nn(e,s),Ee(e.shape,s.shape);const r={a:e,b:s};return it.runKernel(ah,r)}const Du=ot({less_:PE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ME(n,t){let e=U(n,"a","lessEqual","string_or_numeric"),s=U(t,"b","lessEqual","string_or_numeric");[e,s]=Nn(e,s),Ee(e.shape,s.shape);const r={a:e,b:s};return it.runKernel(uh,r)}const na=ot({lessEqual_:ME});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uw(n,t,e){if(e<=0)throw new Error("The number of values should be positive.");const s={start:n,stop:t,num:e};return it.runKernel(dp,{},s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zE(n,t=5,e=1,s=1,r=.5){const i=U(n,"x","localResponseNormalization");V(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),V(Oa(t),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${t}.`);let o=i,a=!1;i.rank===3&&(a=!0,o=ct(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const u={x:o},l={depthRadius:t,bias:e,alpha:s,beta:r},c=it.runKernel(dh,u,l);return a?ct(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const F0=ot({localResponseNormalization_:zE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BE(n){const e={x:U(n,"x","log","float32")};return it.runKernel(fl,e)}const ur=ot({log_:BE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VE(n){const e={x:U(n,"x","log1p")};return it.runKernel(pl,e)}const Xh=ot({log1p_:VE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UE(n){return V(Vo(n),()=>"The f passed in grad(f) must be a function"),(t,e)=>{const s=U(t,"x","tf.grad","string_or_numeric"),r=e!=null?U(e,"dy","tf.grad"):null;return it.tidy(()=>{const{value:i,grads:o}=it.gradients(()=>n(s),[s],r);return r!=null&&hs(i.shape,r.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),tm(o),o[0]})}}function WE(n){return V(Vo(n),()=>"The f passed in grads(f) must be a function"),(t,e)=>{V(Array.isArray(t),()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s");const s=Ic(t,"args","tf.grads","string_or_numeric"),r=e!=null?U(e,"dy","tf.grads"):null;return it.tidy(()=>{const{value:i,grads:o}=it.gradients(()=>n(...s),s,r);return r!=null&&hs(i.shape,r.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),tm(o),o})}}function GE(n){return V(Vo(n),()=>"The f passed in valueAndGrad(f) must be a function"),(t,e)=>{V(t instanceof $e,()=>"The x passed in valueAndGrad(f)(x) must be a tensor"),V(e==null||e instanceof $e,()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor");const{grads:s,value:r}=it.gradients(()=>n(t),[t],e);return tm(s),{grad:s[0],value:r}}}function jE(n){return V(Vo(n),()=>"The f passed in valueAndGrads(f) must be a function"),(t,e)=>{V(Array.isArray(t)&&t.every(r=>r instanceof $e),()=>"The args passed in valueAndGrads(f)(args) must be array of tensors"),V(e==null||e instanceof $e,()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor");const s=it.gradients(()=>n(...t),t,e);return e!=null&&hs(s.value.shape,e.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),tm(s.grads),s}}function lw(n,t){V(Vo(n),()=>"The f passed in variableGrads(f) must be a function"),V(t==null||Array.isArray(t)&&t.every(l=>l instanceof Sc),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const e=t!=null;if(!e){t=[];for(const l in it.registeredVariables)t.push(it.registeredVariables[l])}const s=e?t.filter(l=>!l.trainable):null,r=t.length;t=t.filter(l=>l.trainable),V(t.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const i=!0,{value:o,grads:a}=it.gradients(n,t,null,i);V(a.some(l=>l!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),V(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);const u={};return t.forEach((l,c)=>{a[c]!=null&&(u[l.name]=a[c])}),s!=null&&s.forEach(l=>u[l.name]=null),{value:o,grads:u}}function zi(n){return it.customGrad(n)}function tm(n){if(n.filter(e=>e==null).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HE(n){const e={x:U(n,"x","neg")};return it.runKernel(xh,e)}const dn=ot({neg_:HE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KE(n){const e={x:U(n,"x","softplus")};return it.runKernel(_l,e)}const tu=ot({softplus_:KE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qE(n){const t=U(n,"x","logSigmoid");return zi(s=>({value:dn(tu(dn(s))),gradFunc:o=>ut(o,Hs(dn(s)))}))(t)}const L0=ot({logSigmoid_:qE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XE(n,t){let e=U(n,"a","sub"),s=U(t,"b","sub");[e,s]=Nn(e,s);const r={a:e,b:s};return it.runKernel(Dl,r)}const oe=ot({sub_:XE});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YE(n,t=-1){const e=U(n,"logits","logSoftmax");if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${e.rank} and axis was ${t}`);return zi((r,i)=>{const a=Nr(r,t,!0),u=oe(r,a),l=oe(Kt(u,"float32"),ur(he(Fs(u),t,!0)));return i([l]),{value:l,gradFunc:(h,d)=>{const[f]=d,p=!0,m=Fs(f);return oe(h,ut(he(h,t,p),m))}}})(e)}const em=ot({logSoftmax_:YE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZE(n,t=null,e=!1){const s=U(n,"x","logSumExp"),r=Pe(t,s.shape),i=Nr(s,r,!0),o=oe(s,i),a=Fs(o),u=he(a,r),l=ur(u),c=Lt(ct(i,l.shape),l);if(e){const h=An(c.shape,r);return ct(c,h)}return c}const nm=ot({logSumExp_:ZE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JE(n,t){const e=U(n,"a","logicalAnd","bool"),s=U(t,"b","logicalAnd","bool");Ee(e.shape,s.shape);const r={a:e,b:s};return it.runKernel(lh,r)}const ai=ot({logicalAnd_:JE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QE(n){const e={x:U(n,"x","logicalNot","bool")};return it.runKernel(ch,e)}const Yh=ot({logicalNot_:QE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t_(n,t){const e=U(n,"a","logicalOr","bool"),s=U(t,"b","logicalOr","bool");Ee(e.shape,s.shape);const r={a:e,b:s};return it.runKernel(hh,r)}const sm=ot({logicalOr_:t_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e_(n,t){const e=U(n,"a","logicalXor","bool"),s=U(t,"b","logicalXor","bool");return Ee(e.shape,s.shape),ai(sm(n,t),Yh(ai(n,t)))}const P0=ot({logicalXor_:e_});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $d=2147483648;function n_(n,t,e="left"){const s=U(n,"sortedSequence","searchSorted"),r=U(t,"values","searchSorted"),i=s.shape[s.shape.length-1],o=r.shape[r.shape.length-1],a=ct(s,[-1,i]),u=ct(r,[-1,o]);if(a.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(a.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(Et(u.shape)>=$d)throw new Error(`values tensor size must less than ${$d}`);if(a.shape[1]>=$d)throw new Error(`trailing dim_size must less than ${$d} for int32 output type, was ${a.shape[1]}`);const l={sortedSequence:a,values:u},c={side:e};return it.runKernel(_p,l,c)}const rm=ot({searchSorted_:n_});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cw(n,t){return rm(n,t,"left")}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s_(n,t,e,s,r){const i=U(n,"x","maxPool"),o=1;let a=i,u=!1;i.rank===3&&(u=!0,a=ct(i,[1,i.shape[0],i.shape[1],i.shape[2]])),V(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),V(ds(e,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${e} and dilations '${o}'`),Ps("maxPool",s,r);const l={x:a},c={filterSize:t,strides:e,pad:s,dimRoundingMode:r},h=it.runKernel(ph,l,c);return u?ct(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const Zh=ot({maxPool_:s_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r_(n,t=[1,1,1],e,s,r,i="NDHWC"){const o=U(n,"x","maxPool3d");let a=o,u=!1;o.rank===4&&(u=!0,a=ct(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),V(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),V(i==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),Ps("maxPool3d",s,r);const l={x:a},c={filterSize:t,strides:e,pad:s,dimRoundingMode:r,dataFormat:i},h=it.runKernel(mh,l,c);return u?ct(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const M0=ot({maxPool3d_:r_});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i_(n,t,e,s,r=!1){const o={x:U(n,"x","maxPoolWithArgmax")},a={filterSize:t,strides:e,pad:s,includeBatchInIndex:r},u=it.runKernel(gp,o,a);return{result:u[0],indexes:u[1]}}const hw=ot({maxPoolWithArgmax_:i_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o_(n,t){let e=U(n,"a","maximum"),s=U(t,"b","maximum");[e,s]=Nn(e,s),e.dtype==="bool"&&(e=Kt(e,"int32"),s=Kt(s,"int32")),Ee(e.shape,s.shape);const r={a:e,b:s};return it.runKernel(ml,r)}const Vi=ot({maximum_:o_});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a_(n,t=null,e=!1){const r={x:U(n,"x","mean")},i={axis:t,keepDims:e};return it.runKernel(gh,r,i)}const wn=ot({mean_:a_});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mn(n,t="float32"){if(fr(n),t==="complex64"){const s=Mn(n,"float32"),r=Mn(n,"float32");return so(s,r)}const e=ls(Et(n),t);return it.makeTensor(e,n,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function or(n,t="float32"){if(fr(n),t==="complex64"){const s=or(n,"float32"),r=Mn(n,"float32");return so(s,r)}const e=zf(Et(n),t);return it.makeTensor(e,n,t)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dw(n,t,{indexing:e="xy"}={}){if(e!=="xy"&&e!=="ij")throw new TypeError(`${e} is not a valid third argument to meshgrid`);if(n===void 0)return[];let s=U(n,"x","meshgrid",n instanceof $e?n.dtype:"float32");if(t===void 0)return[s];let r=U(t,"y","meshgrid",t instanceof $e?t.dtype:"float32");const i=Et(s.shape),o=Et(r.shape);return e==="xy"?(s=ct(s,[1,-1]),r=ct(r,[-1,1]),[De(or([o,1],s.dtype),s),De(r,or([1,i],r.dtype))]):(s=ct(s,[-1,1]),r=ct(r,[1,-1]),[De(s,or([1,o],s.dtype)),De(or([i,1],r.dtype),r)])}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u_(n,t){let e=U(n,"a","minimum"),s=U(t,"b","minimum");[e,s]=Nn(e,s),e.dtype==="bool"&&(e=Kt(e,"int32"),s=Kt(s,"int32")),Ee(e.shape,s.shape);const r={a:e,b:s};return it.runKernel(gl,r)}const jo=ot({minimum_:u_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l_(n,t,e){V(e==="reflect"||e==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${e}.`);const s=U(n,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");V(t.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${t.length}.`);const r=e==="reflect"?1:0;for(let a=0;a<s.rank;a++)V(t[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),V(t[a][0]>=0&&t[a][0]<=s.shape[a]-r&&t[a][1]>=0&&t[a][1]<=s.shape[a]-r,()=>`Padding in dimension ${a} cannot be greater than or equal to ${s.shape[a]-r} or less than 0 for input of shape ${s.shape}`);const i={paddings:t,mode:e},o={x:s};return it.runKernel(bh,o,i)}const im=ot({mirrorPad_:l_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c_(n,t){let e=U(n,"a","mod"),s=U(t,"b","mod");[e,s]=Nn(e,s);const r={a:e,b:s};return it.runKernel(yl,r)}const z0=ot({mod_:c_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h_(n,t=null,e=!1){n=U(n,"x","moments");const s=Pe(t,n.shape),r=wn(n,s,e);let i=r.shape;e||(i=An(r.shape,s));const o=an(oe(Kt(n,"float32"),ct(r,i))),a=wn(o,s,e);return{mean:r,variance:a}}const Jh=ot({moments_:h_});function d_(n,t,e,s){const r=U(t,"data","multiRNNCell"),i=Ic(e,"c","multiRNNCell"),o=Ic(s,"h","multiRNNCell");let a=r;const u=[];for(let h=0;h<n.length;h++){const d=n[h](a,i[h],o[h]);u.push(d[0]),u.push(d[1]),a=d[1]}const l=[],c=[];for(let h=0;h<u.length;h+=2)l.push(u[h]),c.push(u[h+1]);return[l,c]}const fw=ot({multiRNNCell_:d_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f_(n,t,e,s=!1){const r=U(n,"logits","multinomial"),i=r.size,o=r.rank;if(i<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${i}.`);if(o>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${o}`);e=e||Math.random();const u={logits:o===1?ct(r,[1,-1]):r},l={numSamples:t,seed:e,normalized:s},c=it.runKernel(yp,u,l);return o===1?ct(c,[c.size]):c}const pw=ot({multinomial_:f_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p_(n,t){let e=U(n,"a","notEqual","string_or_numeric"),s=U(t,"b","notEqual","string_or_numeric");[e,s]=Nn(e,s),Ee(e.shape,s.shape);const r={a:e,b:s};return it.runKernel(wh,r)}const Ba=ot({notEqual_:p_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m_(n,t,e=1,s=0,r="int32"){if(t<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${t}`);const o={indices:U(n,"indices","oneHot","int32")},a={dtype:r,depth:t,onValue:e,offValue:s};return it.runKernel(kh,o,a)}const Va=ot({oneHot_:m_});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g_(n){const e={x:U(n,"x","onesLike")};return it.runKernel(vh,e)}const lr=ot({onesLike_:g_});function y_(n,t){const e=U(n,"v1","outerProduct"),s=U(t,"v2","outerProduct");V(e.rank===1&&s.rank===1,()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${e.rank} and ${s.rank}.`);const r=ct(e,[-1,1]),i=ct(s,[1,-1]);return De(r,i)}const mw=ot({outerProduct_:y_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b_(n,t,e=0){const s=U(n,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:t,constantValue:e},i={x:s};return it.runKernel(Ih,i,r)}const Ui=ot({pad_:b_});function x_(n,t,e=0){return V(t.length===2,()=>"Invalid number of paddings. Must be length of 2."),Ui(n,[t],e)}const gw=ot({pad1d_:x_});function w_(n,t,e=0){return V(t.length===2&&t[0].length===2&&t[1].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Ui(n,t,e)}const yw=ot({pad2d_:w_});function v_(n,t,e=0){return V(t.length===3&&t[0].length===2&&t[1].length===2&&t[2].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Ui(n,t,e)}const B0=ot({pad3d_:v_});function k_(n,t,e=0){return V(t.length===4&&t[0].length===2&&t[1].length===2&&t[2].length===2&&t[3].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Ui(n,t,e)}const bw=ot({pad4d_:k_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S_(n,t,e){const s=U(n,"x","spaceToBatchND");V(s.rank>=1+t.length,()=>`input rank ${s.rank} should be > than [blockShape] ${t.length}`),V(e.length===t.length,()=>`paddings.shape[0] ${e.length} must be equal to [blockShape] ${t.length}`),V(s.shape.reduce((o,a,u)=>u>0&&u<=t.length?o&&(a+e[u-1][0]+e[u-1][1])%t[u-1]===0:o,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${e.toString()} must be divisible by blockShapes ${t.toString()}`);const r={x:s},i={blockShape:t,paddings:e};return it.runKernel(Oh,r,i)}const Qh=ot({spaceToBatchND_:S_});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I_(n,t,e,s,r,i,o){r==null&&(r=[1,1]),i==null&&(i=1),s===0&&(s="valid");const a=U(n,"x","maxPool");let u=a,l=!1;a.rank===3&&(l=!0,u=ct(a,[1,a.shape[0],a.shape[1],a.shape[2]])),V(ds(i,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${r}'`);const c=jr(u.shape,t,i,r,s),h=[c.dilationHeight,c.dilationWidth];let d;s==="same"?d=N_([c.filterHeight,c.filterWidth],h):d=[[0,0],[0,0]];const f=h[0]===1&&h[1]===1,[p,m]=C_([c.inHeight,c.inWidth],h,d),g=f?s:"valid",y=f?u:Qh(u,h,p),w=(e==="avg"?()=>Gh(y,t,i,g,o):()=>Zh(y,t,i,g,o))(),v=f?w:jh(w,h,m);return l?ct(v,[v.shape[1],v.shape[2],v.shape[3]]):v}function C_(n,t,e){const s=e.map(c=>c[0]),r=e.map(c=>c[1]),i=n.concat(s,r),o=t.map((c,h)=>(c-i[h]%c)%c),a=r.map((c,h)=>c+o[h]),u=t.map((c,h)=>[s[h],a[h]]),l=t.map((c,h)=>[0,o[h]]);return[u,l]}function N_(n,t){const s=n.map((o,a)=>o+(o-1)*(t[a]-1)).map(o=>o-1),r=s.map(o=>Math.floor(o/2)),i=s.map((o,a)=>o-r[a]);return s.map((o,a)=>[r[a],i[a]])}const V0=ot({pool_:I_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T_(n,t){const e=U(n,"x","prelu"),s=U(t,"alpha","prelu"),r={x:e,alpha:s};return it.runKernel(Ch,r)}const td=ot({prelu_:T_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $_(n,t=null,e=!1){let s=U(n,"x","prod");s.dtype==="bool"&&(s=Kt(s,"int32"));const r={x:s},i={axis:t,keepDims:e};return it.runKernel(Nh,r,i)}const U0=ot({prod_:$_});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E_(n,t,e,s){const r=n.map((c,h)=>U(c,`tensors${h}`,"raggedGather","int32")),i=U(t,"paramsDenseValues","raggedGather"),o=U(e,"indices","raggedGather","int32"),a={paramsNestedSplits:r,paramsDenseValues:i,indices:o},u={outputRaggedRank:s},l=it.runKernel(vp,a,u);return{outputNestedSplits:l.slice(0,l.length-1),outputDenseValues:l[l.length-1]}}const xw=ot({raggedGather_:E_});/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function __(n,t,e){const s=U(n,"starts","raggedRange"),r=U(t,"limits","raggedRange",s.dtype),i=U(e,"deltas","raggedRange",s.dtype),o={starts:s,limits:r,deltas:i},a=it.runKernel(kp,o);return{rtNestedSplits:a[0],rtDenseValues:a[1]}}const ww=ot({raggedRange_:__});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A_(n,t,e,s,r){const i=U(n,"shape","raggedTensorToTensor","int32"),o=U(t,"values","raggedTensorToTensor"),a=U(e,"defaultValue","raggedTensorToTensor",o.dtype),u=s.map((h,d)=>U(h,`tensors${d}`,"raggedTensorToTensor","int32")),l={shape:i,values:o,defaultValue:a,rowPartitionTensors:u},c={rowPartitionTypes:r};return it.runKernel(Sp,l,c)}const vw=ot({raggedTensorToTensor_:A_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R_(n,t,e){fr(n);const s=Et(n);let r=null;if(e==null||e==="float32")r=new Float32Array(s);else if(e==="int32")r=new Int32Array(s);else if(e==="bool")r=new Uint8Array(s);else throw new Error(`Unknown data type ${e}`);for(let i=0;i<s;i++)r[i]=t();return it.makeTensor(r,n,e)}const kw=ot({rand_:R_});var W0={exports:{}};W0.exports;(function(n){(function(t,e,s){function r(u){var l=this,c=a();l.next=function(){var h=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=h-(l.c=h|0)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(u),l.s0<0&&(l.s0+=1),l.s1-=c(u),l.s1<0&&(l.s1+=1),l.s2-=c(u),l.s2<0&&(l.s2+=1),c=null}function i(u,l){return l.c=u.c,l.s0=u.s0,l.s1=u.s1,l.s2=u.s2,l}function o(u,l){var c=new r(u),h=l&&l.state,d=c.next;return d.int32=function(){return c.next()*4294967296|0},d.double=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.quick=d,h&&(typeof h=="object"&&i(h,c),d.state=function(){return i(c,{})}),d}function a(){var u=4022871197,l=function(c){c=String(c);for(var h=0;h<c.length;h++){u+=c.charCodeAt(h);var d=.02519603282416938*u;u=d>>>0,d-=u,d*=u,u=d>>>0,d-=u,u+=d*4294967296}return(u>>>0)*23283064365386963e-26};return l}e&&e.exports?e.exports=o:s&&s.amd?s(function(){return o}):this.alea=o})(ks,n,!1)})(W0);var D_=W0.exports,G0={exports:{}};G0.exports;(function(n){(function(t,e,s){function r(a){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var h=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^h^h>>>8},a===(a|0)?u.x=a:l+=a;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,u.next()}function i(a,u){return u.x=a.x,u.y=a.y,u.z=a.z,u.w=a.w,u}function o(a,u){var l=new r(a),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=l.next()>>>11,f=(l.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&i(c,l),h.state=function(){return i(l,{})}),h}e&&e.exports?e.exports=o:s&&s.amd?s(function(){return o}):this.xor128=o})(ks,n,!1)})(G0);var O_=G0.exports,j0={exports:{}};j0.exports;(function(n){(function(t,e,s){function r(a){var u=this,l="";u.next=function(){var h=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(h^h<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,a===(a|0)?u.x=a:l+=a;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(a,u){return u.x=a.x,u.y=a.y,u.z=a.z,u.w=a.w,u.v=a.v,u.d=a.d,u}function o(a,u){var l=new r(a),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=l.next()>>>11,f=(l.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&i(c,l),h.state=function(){return i(l,{})}),h}e&&e.exports?e.exports=o:s&&s.amd?s(function(){return o}):this.xorwow=o})(ks,n,!1)})(j0);var F_=j0.exports,H0={exports:{}};H0.exports;(function(n){(function(t,e,s){function r(a){var u=this;u.next=function(){var c=u.x,h=u.i,d,f;return d=c[h],d^=d>>>7,f=d^d<<24,d=c[h+1&7],f^=d^d>>>10,d=c[h+3&7],f^=d^d>>>3,d=c[h+4&7],f^=d^d<<7,d=c[h+7&7],d=d^d<<13,f^=d^d<<9,c[h]=f,u.i=h+1&7,f};function l(c,h){var d,f=[];if(h===(h|0))f[0]=h;else for(h=""+h,d=0;d<h.length;++d)f[d&7]=f[d&7]<<15^h.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&f[d]===0;++d);for(d==8?f[7]=-1:f[d],c.x=f,c.i=0,d=256;d>0;--d)c.next()}l(u,a)}function i(a,u){return u.x=a.x.slice(),u.i=a.i,u}function o(a,u){a==null&&(a=+new Date);var l=new r(a),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=l.next()>>>11,f=(l.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=l.next,h.quick=h,c&&(c.x&&i(c,l),h.state=function(){return i(l,{})}),h}e&&e.exports?e.exports=o:s&&s.amd?s(function(){return o}):this.xorshift7=o})(ks,n,!1)})(H0);var L_=H0.exports,K0={exports:{}};K0.exports;(function(n){(function(t,e,s){function r(a){var u=this;u.next=function(){var c=u.w,h=u.X,d=u.i,f,p;return u.w=c=c+1640531527|0,p=h[d+34&127],f=h[d=d+1&127],p^=p<<13,f^=f<<17,p^=p>>>15,f^=f>>>12,p=h[d]=p^f,u.i=d,p+(c^c>>>16)|0};function l(c,h){var d,f,p,m,g,y=[],b=128;for(h===(h|0)?(f=h,h=null):(h=h+"\0",f=0,b=Math.max(b,h.length)),p=0,m=-32;m<b;++m)h&&(f^=h.charCodeAt((m+32)%h.length)),m===0&&(g=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,m>=0&&(g=g+1640531527|0,d=y[m&127]^=f+g,p=d==0?p+1:0);for(p>=128&&(y[(h&&h.length||0)&127]=-1),p=127,m=4*128;m>0;--m)f=y[p+34&127],d=y[p=p+1&127],f^=f<<13,d^=d<<17,f^=f>>>15,d^=d>>>12,y[p]=f^d;c.w=g,c.X=y,c.i=p}l(u,a)}function i(a,u){return u.i=a.i,u.w=a.w,u.X=a.X.slice(),u}function o(a,u){a==null&&(a=+new Date);var l=new r(a),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=l.next()>>>11,f=(l.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=l.next,h.quick=h,c&&(c.X&&i(c,l),h.state=function(){return i(l,{})}),h}e&&e.exports?e.exports=o:s&&s.amd?s(function(){return o}):this.xor4096=o})(ks,n,!1)})(K0);var P_=K0.exports,q0={exports:{}};q0.exports;(function(n){(function(t,e,s){function r(a){var u=this,l="";u.next=function(){var h=u.b,d=u.c,f=u.d,p=u.a;return h=h<<25^h>>>7^d,d=d-f|0,f=f<<24^f>>>8^p,p=p-h|0,u.b=h=h<<20^h>>>12^d,u.c=d=d-f|0,u.d=f<<16^d>>>16^p,u.a=p-h|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,a===Math.floor(a)?(u.a=a/4294967296|0,u.b=a|0):l+=a;for(var c=0;c<l.length+20;c++)u.b^=l.charCodeAt(c)|0,u.next()}function i(a,u){return u.a=a.a,u.b=a.b,u.c=a.c,u.d=a.d,u}function o(a,u){var l=new r(a),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=l.next()>>>11,f=(l.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&i(c,l),h.state=function(){return i(l,{})}),h}e&&e.exports?e.exports=o:s&&s.amd?s(function(){return o}):this.tychei=o})(ks,n,!1)})(q0);var M_=q0.exports,Sw={exports:{}};const z_={},B_=Object.freeze(Object.defineProperty({__proto__:null,default:z_},Symbol.toStringTag,{value:"Module"})),V_=uN(B_);(function(n){(function(t,e,s){var r=256,i=6,o=52,a="random",u=s.pow(r,i),l=s.pow(2,o),c=l*2,h=r-1,d;function f(v,S,N){var R=[];S=S==!0?{entropy:!0}:S||{};var L=y(g(S.entropy?[v,w(e)]:v??b(),3),R),F=new p(R),B=function(){for(var H=F.g(i),z=u,G=0;H<l;)H=(H+G)*r,z*=r,G=F.g(1);for(;H>=c;)H/=2,z/=2,G>>>=1;return(H+G)/z};return B.int32=function(){return F.g(4)|0},B.quick=function(){return F.g(4)/4294967296},B.double=B,y(w(F.S),e),(S.pass||N||function(H,z,G,T){return T&&(T.S&&m(T,F),H.state=function(){return m(F,{})}),G?(s[a]=H,z):H})(B,L,"global"in S?S.global:this==s,S.state)}function p(v){var S,N=v.length,R=this,L=0,F=R.i=R.j=0,B=R.S=[];for(N||(v=[N++]);L<r;)B[L]=L++;for(L=0;L<r;L++)B[L]=B[F=h&F+v[L%N]+(S=B[L])],B[F]=S;(R.g=function(H){for(var z,G=0,T=R.i,K=R.j,ht=R.S;H--;)z=ht[T=h&T+1],G=G*r+ht[h&(ht[T]=ht[K=h&K+z])+(ht[K]=z)];return R.i=T,R.j=K,G})(r)}function m(v,S){return S.i=v.i,S.j=v.j,S.S=v.S.slice(),S}function g(v,S){var N=[],R=typeof v,L;if(S&&R=="object")for(L in v)try{N.push(g(v[L],S-1))}catch{}return N.length?N:R=="string"?v:v+"\0"}function y(v,S){for(var N=v+"",R,L=0;L<N.length;)S[h&L]=h&(R^=S[h&L]*19)+N.charCodeAt(L++);return w(S)}function b(){try{var v;return d&&(v=d.randomBytes)?v=v(r):(v=new Uint8Array(r),(t.crypto||t.msCrypto).getRandomValues(v)),w(v)}catch{var S=t.navigator,N=S&&S.plugins;return[+new Date,t,N,t.screen,w(e)]}}function w(v){return String.fromCharCode.apply(0,v)}if(y(s.random(),e),n.exports){n.exports=f;try{d=V_}catch{}}else s["seed"+a]=f})(typeof self<"u"?self:ks,[],Math)})(Sw);var U_=Sw.exports,W_=D_,G_=O_,j_=F_,H_=L_,K_=P_,q_=M_,eu=U_;eu.alea=W_;eu.xor128=G_;eu.xorwow=j_;eu.xorshift7=H_;eu.xor4096=K_;eu.tychei=q_;var om=eu;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X_=.001,Iw=.1;function Y_(n,t,e){return e==null&&(e=X0()),n1(n,t,(s,r)=>Y0(s,r,e))}function X0(){return it.backend.floatPrecision()===32?X_:Iw}function n1(n,t,e){let s=!0;if((ts(n)||ts(t))&&(s=!1),ts(n)&&ts(t)&&(s=!0),s){const o=n.constructor.name,a=t.constructor.name;if(o!==a)throw new Error(`Arrays are of different type. Actual: ${o}. Expected: ${a}`)}if(Array.isArray(n)&&Array.isArray(t)){const o=Mi(n),a=Mi(t);if(!Ve(o,a))throw new Error(`Arrays have different shapes. Actual: [${o}]. Expected: [${a}]`)}const r=ts(n)?n:Pi(n),i=ts(t)?t:Pi(t);if(r.length!==i.length)throw new Error(`Arrays have different lengths actual: ${r.length} vs expected: ${i.length}.
Actual:   ${r}.
Expected: ${i}.`);for(let o=0;o<i.length;++o){const a=r[o],u=i[o];if(!e(a,u))throw new Error(`Arrays differ: actual[${o}] = ${a}, expected[${o}] = ${u}.
Actual:   ${r}.
Expected: ${i}.`)}typeof expect<"u"&&expect().nothing()}function Z_(n,t){n().then(()=>t.fail(),()=>t()),typeof expect<"u"&&expect().nothing()}function J_(n,t){const e=typeof t=="string"||typeof t=="number"||typeof t=="boolean"?[t]:t;return $i(n)||$i(n[0])||$i(t)||$i(t[0])?n1(n,e,(s,r)=>s==r):n1(n,t,(s,r)=>Y0(s,r,0))}function Q_(n,t,e){if(e==null&&(e=X0()),!Y0(n,t,e))throw new Error(`Numbers differ: actual === ${n}, expected === ${t}`);typeof expect<"u"&&expect().nothing()}function Y0(n,t,e){return!isFinite(n)&&!isFinite(t)?!0:!(isNaN(n)||isNaN(t)||Math.abs(n-t)>e)}function tA(n,t,e){for(let s=0;s<n.length;s++)if(n[s]<t||n[s]>e)throw new Error(`Value out of range:${n[s]} low: ${t}, high: ${e}`)}function eA(n,t){const e=new Float32Array(n),s=new Float32Array(t);if(e.length!==s.length)throw new Error(`Expected ArrayBuffer to be of length ${s.length}, but it was ${e.length}`);for(let r=0;r<s.length;r++)if(e[r]!==s[r])throw new Error(`Expected ArrayBuffer value at ${r} to be ${s[r]} but got ${e[r]} instead`)}function Cw(n){for(let t=0;t<n.length;t++){const e=n[t];Array.isArray(e)?Cw(e):n[t]=Ai(e)}return n}function nA(n){const t=document.createElement("video");return"playsInline"in t&&(t.playsInline=!0),t.muted=!0,t.loop=!0,t.style.position="fixed",t.style.left="0px",t.style.top="0px",t.preload="auto",t.appendChild(n),new Promise(e=>{t.addEventListener("loadeddata",s=>e(t)),t.load()})}async function sA(n){await n.play(),"requestVideoFrameCallback"in n&&await new Promise(t=>{n.requestVideoFrameCallback(t)})}const rA=Object.freeze(Object.defineProperty({__proto__:null,TEST_EPSILON_FLOAT16:Iw,createVideoElement:nA,encodeStrings:Cw,expectArrayBuffersEqual:eA,expectArraysClose:Y_,expectArraysEqual:J_,expectNumbersClose:Q_,expectPromiseToFail:Z_,expectValuesInRange:tA,play:sA,testEpsilon:X0},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Z0{constructor(t,e,s,r,i){this.mean=t,this.stdDev=e,this.dtype=s,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const o=i||Math.random();this.random=om.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let t,e,s=!1;for(;!s;){let r,i,o;do r=2*this.random()-1,i=2*this.random()-1,o=r*r+i*i;while(o>=1||o===0);const a=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*r*a,e=this.mean+this.stdDev*i*a,(!this.truncated||this.isValidTruncated(t))&&(s=!0)}return(!this.truncated||this.isValidTruncated(e))&&(this.nextVal=this.convertValue(e)),this.convertValue(t)}convertValue(t){return this.dtype==null||this.dtype==="float32"?t:Math.round(t)}isValidTruncated(t){return t<=this.upper&&t>=this.lower}}class iA{constructor(t,e,s,r){this.alpha=t,this.beta=1/e,this.dtype=s;const i=r||Math.random();this.randu=om.alea(i.toString()),this.randn=new Z0(0,1,s,!1,this.randu()),t<1?this.d=t+2/3:this.d=t-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let t,e,s,r,i,o;for(;;){do r=this.randn.nextValue(),o=1+this.c*r;while(o<=0);if(o*=o*o,t=r*r,e=1-.331*t*t,s=.5*t+this.d*(1-o+Math.log(o)),i=this.randu(),i<e||Math.log(i)<s)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)}convertValue(t){return this.dtype==="float32"?t:Math.round(t)}}class oA{constructor(t=0,e=1,s,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=t,this.range=e-t,this.dtype=s,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${t} - ${e} <= 1 and dtype is not float`);this.random=om.alea(r)}convertValue(t){return this.canReturnFloat()?t:Math.round(t)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aA(n,t,e=1,s="float32",r){if(fr(n),e==null&&(e=1),s==null&&(s="float32"),s!=="float32"&&s!=="int32")throw new Error(`Unsupported data type ${s}`);const i=new iA(t,e,s,r),o=Fe(n,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const Nw=ot({randomGamma_:aA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uA(n,t=0,e=1,s,r){if(fr(n),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const i=new Z0(t,e,s,!1,r),o=Fe(n,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const am=ot({randomNormal_:uA});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lA(n,t,e){if(t!=null&&t==="bool")throw new Error(`Unsupported data type ${t}`);return am(n,0,1,t,e)}const Tw=ot({randomStandardNormal_:lA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cA(n,t=0,e=1,s="float32",r){fr(n);const i=Fe(n,s),o=new oA(t,e,null,r);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const sa=ot({randomUniform_:cA});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hA(n,t,e,s){return sa(n,t,e,"int32",s)}const $w=ot({randomUniformInt_:hA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oo(n,t,e=1,s="float32"){if(e===0)throw new Error("Cannot have a step of zero");const r={start:n,stop:t,step:e,dtype:s};return it.runKernel(Ip,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dA(n){const e={input:U(n,"input","real")};return it.runKernel(Cp,e)}const Ou=ot({real_:dA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fA(n){const e={x:U(n,"x","reciprocal")};return it.runKernel(wl,e)}const J0=ot({reciprocal_:fA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pA(n){const e={x:U(n,"x","relu")};return it.runKernel(vl,e)}const fi=ot({relu_:pA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mA(n){const e={x:U(n,"x","relu6")};return it.runKernel(kl,e)}const um=ot({relu6_:mA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gA(n,t){const s={x:U(n,"x","reverse")},r={dims:t};return it.runKernel(_h,s,r)}const Tr=ot({reverse_:gA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yA(n){const t=U(n,"x","reverse");return V(t.rank===1,()=>`Error in reverse1D: x must be rank 1 but got rank ${t.rank}.`),Tr(t,0)}const Ew=ot({reverse1d_:yA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bA(n,t){const e=U(n,"x","reverse");return V(e.rank===2,()=>`Error in reverse2D: x must be rank 2 but got rank ${e.rank}.`),Tr(e,t)}const _w=ot({reverse2d_:bA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xA(n,t){const e=U(n,"x","reverse");return V(e.rank===3,()=>`Error in reverse3D: x must be rank 3 but got rank ${e.rank}.`),Tr(e,t)}const Aw=ot({reverse3d_:xA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wA(n,t){const e=U(n,"x","reverse");return V(e.rank===4,()=>`Error in reverse4D: x must be rank 4 but got rank ${e.rank}.`),Tr(e,t)}const Rw=ot({reverse4d_:wA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vA(n){const e={x:U(n,"x","round")};return it.runKernel(Sl,e)}const lm=ot({round_:vA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kA(n){const e={x:U(n,"x","rsqrt","float32")};return it.runKernel(Il,e)}const cm=ot({rsqrt_:kA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SA(n){const e={x:U(n,"x","selu")};return it.runKernel(Cl,e)}const hm=ot({selu_:SA});function IA(n,t,e,s,r,i=[1,1],o="NHWC"){const a=U(n,"x","separableConv2d"),u=U(t,"depthwiseFilter","separableConv2d"),l=U(e,"pointwiseFilter","separableConv2d");let c=a,h=!1;if(a.rank===3&&(h=!0,c=ct(a,[1,a.shape[0],a.shape[1],a.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");V(c.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${c.rank}.`),V(u.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${u.rank}.`),V(l.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${u.rank}.`),V(l.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${l.shape[0]}.`),V(l.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${l.shape[1]}.`);const d=u.shape[2],f=u.shape[3];V(l.shape[2]===d*f,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${d*f}, but got ${l.shape[2]}.`);const p=zl(c,u,s,r,o,i),g=ro(p,l,1,"valid",o);return h?ct(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const dm=ot({separableConv2d_:IA});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function CA(n,t){const e=U(n,"x","setdiff1d"),s=U(t,"y","setdiff1d");V(e.dtype===s.dtype,()=>`x and y should have the same dtype, but got x (${e.dtype}) and y (${s.dtype}).`),V(e.rank===1,()=>`x should be 1D tensor, but got x (${e.shape}).`),V(s.rank===1,()=>`y should be 1D tensor, but got y (${s.shape}).`);const r=await e.data(),i=await s.data(),o=new Set(i);let a=0;for(let c=0;c<r.length;c++)o.has(r[c])||a++;const u=new Vn([a],e.dtype),l=new Vn([a],"int32");for(let c=0,h=0;c<r.length;c++)o.has(r[c])||(u.values[h]=r[c],l.values[h]=c,h++);return[u.toTensor(),l.toTensor()]}const Dw=CA;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NA(n){const e={x:U(n,"x","sign")};return it.runKernel($l,e)}const Q0=ot({sign_:NA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TA(n){const e={x:U(n,"x","sin","float32")};return it.runKernel(Nl,e)}const fm=ot({sin_:TA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $A(n){const e={x:U(n,"x","sinh")};return it.runKernel(Tl,e)}const pm=ot({sinh_:$A});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EA(n,t,e){const s=U(n,"x","slice1d");return V(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),xe(s,[t],[e])}const ed=ot({slice1d_:EA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _A(n,t,e){const s=U(n,"x","slice2d");return V(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),xe(s,t,e)}const mm=ot({slice2d_:_A});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AA(n,t,e){const s=U(n,"x","slice3d");return V(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),xe(s,t,e)}const nd=ot({slice3d_:AA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RA(n,t,e){const s=U(n,"x","slice4d");return V(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),xe(s,t,e)}const Fu=ot({slice4d_:RA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DA(n,t=-1){const e=U(n,"logits","softmax","float32");if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${e.rank} and dim was ${t}`);const s={logits:e},r={dim:t};return it.runKernel(Lh,s,r)}const sd=ot({softmax_:DA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OA(n){V(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);const t={input:n};return it.runKernel(op,t)}const rd=ot({fft_:OA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FA(n){V(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);const t={input:n};return it.runKernel(cp,t)}const Lu=ot({ifft_:FA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LA(n){const t=n.shape[n.shape.length-1],e=n.size/t;let s;if(t<=2){const r=ct(n,[e,t]);s=Lu(r)}else{const r=[e,2*(t-1)],i=ct(Ou(n),[e,t]),o=ct(Kh(n),[e,t]),a=Tr(xe(i,[0,1],[e,t-2]),1),u=ut(Tr(xe(o,[0,1],[e,t-2]),1),fe(-1)),l=Cn([i,a],1),c=Cn([o,u],1),h=ct(so(l,c),[r[0],r[1]]);s=Lu(h)}if(s=Ou(s),n.rank===3&&n.shape[0]!==0){const r=s,i=n.shape[0];s=ct(s,[i,s.shape[0]/i,s.shape[1]]),r.dispose()}return s}const gm=ot({irfft_:LA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PA(n,t,e=0){const r={x:U(n,"x","split")},i={numOrSizeSplits:t,axis:e};return it.runKernel(Fh,r,i)}const Ks=ot({split_:PA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MA(n,t){V(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let e=n.shape[n.shape.length-1];const s=n.size/e;let r;if(t!=null&&t<e){const p=n.shape.map(g=>0),m=n.shape.map(g=>g);m[n.shape.length-1]=t,r=xe(n,p,m),e=t}else if(t!=null&&t>e){const p=n.shape.map(m=>m);p[n.shape.length-1]=t-e,r=Cn([n,Mn(p)],n.shape.length-1),e=t}else r=n;const i=je(r),o=ct(so(r,i),[s,e]),a=rd(o),u=Math.floor(e/2)+1,l=Ou(a),c=Kh(a),h=Ks(l,[u,e-u],l.shape.length-1),d=Ks(c,[u,e-u],c.shape.length-1),f=r.shape.slice();return f[r.shape.length-1]=u,ct(so(h[0],d[0]),f)}const id=ot({rfft_:MA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zA(n,t){let e=U(n,"a","squaredDifference"),s=U(t,"b","squaredDifference");[e,s]=Nn(e,s),Ee(e.shape,s.shape);const r={a:e,b:s},i={};return it.runKernel(Rl,r,i)}const ym=ot({squaredDifference_:zA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BA(n,t){const e=U(n,"x","squeeze","string_or_numeric");return ct(e,ho(e.shape,t).newShape)}const tn=ot({squeeze_:BA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VA(n,t=0){const e=Ic(n,"tensors","stack","string_or_numeric");V(e.length>=1,()=>"Pass at least one tensor to tf.stack"),e.length>0&&V(t<=e[0].rank,()=>"Axis must be <= rank of the tensor");const s=e,r={axis:t};return it.runKernel(Sh,s,r)}const cr=ot({stack_:VA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UA(n,t=0){const s={x:U(n,"x","step")},r={alpha:t};return it.runKernel(Pl,s,r)}const nu=ot({step_:UA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WA(n,t,e,s,r=0,i=0,o=0,a=0,u=0){const c={x:U(n,"x","stridedSlice","string_or_numeric")},h={begin:t,end:e,strides:s,beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:u};return it.runKernel(Pp,c,h)}const t2=ot({stridedSlice_:WA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GA(n){const e={x:U(n,"x","tan","float32")};return it.runKernel(Ol,e)}const e2=ot({tan_:GA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zn(n,t){qa(n);const e=Mi(n,t);if(e.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Qo(n,null,e,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Di(n,t,e){if(qa(n),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=Mi(n,e);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Qo(n,t,s,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n2(n,t,e){if(qa(n),t!=null&&t.length!==3)throw new Error("tensor3d() requires shape to have three numbers");const s=Mi(n,e);if(s.length!==3&&s.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(s.length===1&&t==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Qo(n,t,s,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ow(n,t,e){if(qa(n),t!=null&&t.length!==4)throw new Error("tensor4d() requires shape to have four numbers");const s=Mi(n,e);if(s.length!==4&&s.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(s.length===1&&t==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Qo(n,t,s,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fw(n,t,e){if(qa(n),t!=null&&t.length!==5)throw new Error("tensor5d() requires shape to have five numbers");const s=Mi(n,e);if(s.length!==5&&s.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(s.length===1&&t==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Qo(n,t,s,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lw(n,t,e){if(qa(n),t!=null&&t.length!==6)throw new Error("tensor6d() requires shape to have six numbers");const s=Mi(n,e);if(s.length!==6&&s.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(s.length===1&&t==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return t=t||s,Qo(n,t,s,e)}function s2(n,t,e){const s=t.rank>1?t.shape[t.rank-1]:1,r=t.rank>1?t.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${e.shape}, indices.shape: ${t.shape}, shape: ${n}, sliceDim: ${s}, and batchDim: ${r}.`;if(e.rank<r)throw new Error(i+` update.rank < ${r}. `);if(n.length<s+(e.rank-r))throw new Error(i+` Output shape length < ${s+(e.rank-r)}`);if(e.rank!==r+n.length-s)throw new Error(i+` update.rank != ${r+n.length-s}`);for(let o=0;o<r;++o)if(e.shape[o]!==t.shape[o])throw new Error(i+` updates.shape[${o}] (${e.shape[o]}) != indices.shape[${o}] (${t.shape[o]}).`);for(let o=0;o<e.rank-r;++o)if(e.shape[o+r]!==n[o+s])throw new Error(i+` updates.shape[${o+r}] (${e.shape[o+r]}) != shape[${o+r}] (${n[o+r]})`)}function bm(n,t,e){if(t.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${t.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(t.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${t.dtype}`);if(e.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${e}`);if(e.length===0){if(t.size===0)throw new Error(`Indices specified for empty output. indices shape: ${t.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}s2(e,t,n)}function ra(n,t,e){const s=t.shape.length,r=s>1?t.shape[s-1]:1,i=e.length;let o=1;for(let h=r;h<i;++h)o*=e[h];const a=r<1?1:r,u=Et(t.shape)/a,l=[...ge(e.slice(0,r)),1],c=Et(e);return{sliceRank:r,numUpdates:u,sliceSize:o,strides:l,outputSize:c}}const jA=Object.freeze(Object.defineProperty({__proto__:null,calculateShapes:ra,validateInput:bm,validateUpdateShape:s2},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HA(n,t,e){const s=U(n,"tensor","tensorScatterupdate"),r=U(t,"indices","tensorScatterupdate","int32"),i=U(e,"updates","tensorScatterupdate");if(bm(i,r,s.shape),s.dtype!==i.dtype)throw new Error(`tensor and updates must have the same dtype, instead they are ${s.dtype} and ${i.dtype}.`);const o={tensor:s,indices:r,updates:i},a={};return it.runKernel(Ep,o,a)}const Pw=ot({tensorScatterUpdate_:HA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KA(n,t=1,e=!0){const s=U(n,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=s.shape[s.shape.length-1];if(t<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${t}`);if(t>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${t}`);const i={x:s},o={k:t,sorted:e},[a,u]=it.runKernel(Vp,i,o);return{values:a,indices:u}}const r2=ot({topk_:KA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qA(n,t=0,e=1,s,r){if(fr(n),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const i=new Z0(t,e,s,!0,r),o=Fe(n,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const xm=ot({truncatedNormal_:qA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XA(n,t=0){const e=U(n,"x","unique","string_or_numeric");V(e.rank>0,()=>"The input tensor must be at least 1D");const s={x:e},r={axis:t},[i,o]=it.runKernel(Wp,s,r);return{values:i,indices:o}}const i2=ot({unique_:XA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YA(n,t,e){const s=U(n,"x","unsortedSegmentSum"),r=U(t,"segmentIds","unsortedSegmentSum","int32");V(Oa(e),()=>"numSegments must be of dtype int");const i={x:s,segmentIds:r},o={numSegments:e};return it.runKernel(zh,i,o)}const wm=ot({unsortedSegmentSum_:YA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZA(n,t=0){const e=U(n,"x","unstack","string_or_numeric");V(t>=-e.shape.length&&t<e.shape.length,()=>`Axis = ${t} is not in [-${e.shape.length}, ${e.shape.length})`);const s={value:e},r={axis:t};return it.runKernel(Mh,s,r)}const $r=ot({unstack_:ZA});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mw(n,t){return rm(n,t,"right")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o2(n,t=!0,e,s){return it.makeVariable(n,t,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vm(n,t){const e=[];for(let i=0;i<t.length;i++)t[i]&&e.push(i);const s=Fe(n,"int32"),r=Fe([e.length,n.length],"int32");for(let i=0;i<e.length;i++){const o=s.indexToLoc(e[i]),a=i*n.length;r.values.set(o,a)}return r.toTensor()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function JA(n){const t=U(n,"condition","whereAsync","bool"),e=await t.data(),s=vm(t.shape,e);return n!==t&&t.dispose(),s}const a2=JA;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function QA(n,t,e){const s=U(n,"tensor","boolMask"),r=U(t,"mask","boolMask","bool"),i=e??0,o=r.rank,a=s.shape;V(o>0,()=>"mask cannot be scalar"),hs(a.slice(i,i+o),r.shape,"mask's shape must match the first K dimensions of tensor's shape,");let u=1;for(let m=i;m<i+o;m++)u*=a[m];const l=a.slice(0,i).concat([u],a.slice(i+o)),c=ct(s,l),h=ct(r,[-1]),d=await a2(h),f=tn(d,[1]),p=Wl(c,f,i);return n!==s&&s.dispose(),t!==r&&r.dispose(),f.dispose(),c.dispose(),h.dispose(),d.dispose(),p}const zw=QA;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tR(n,t,e){const s=U(n,"x","transpose");if(t==null&&(t=s.shape.map((o,a)=>a).reverse()),V(s.rank===t.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${t}.`),t.forEach(o=>{V(o>=0&&o<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${t}`)}),s.rank<=1)return s.clone();const r={x:s},i={perm:t};return s.dtype==="complex64"?pt(()=>{let o=Ou(s),a=Kh(s);return o=it.runKernel(_a,{x:o},i),a=it.runKernel(_a,{x:a},i),e&&(a=dn(a)),so(o,a)}):it.runKernel(_a,r,i)}const Ue=ot({transpose_:tR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eR(n,t,e,s,r=!0){const i=U(n,"v","movingAverage"),o=U(t,"x","movingAverage"),a=U(e,"decay","movingAverage");Ox(i,o),V(Ve(i.shape,o.shape),()=>"Shape mismatch in v and x");const u=fe(1),l=oe(u,a);let c=ut(oe(o,i),l);if(r){V(s!=null,()=>"When using zeroDebias: true, step is required.");const h=U(s,"step","movingAverage");c=ie(c,oe(u,io(a,h)))}return Lt(i,c)}const Bw=ot({movingAverage_:eR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nR(n,t,e){fr(e);const s=U(n,"indices","scatterND","int32"),r=U(t,"updates","scatterND");bm(r,s,e);const i={indices:s,updates:r},o={shape:e};return it.runKernel($p,i,o)}const Vw=ot({scatterND_:nR});function sR(n,t,e,s){if(n.dtype!=="int32")throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${n.dtype}.`);if(n.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${n.shape}.`);const r=n.rank>0?n.shape[0]:1,i=n.rank>1?n.shape[1]:1;if(e.length!==i)throw new Error(`outputShape has incorrect number of elements:, ${e.length}, should be: ${i}.`);const o=t.size;if(!(t.rank===0||t.rank===1&&o===r))throw new Error(`sparseValues has incorrect shape ${t.shape}, should be [] or [${r}]`);if(t.dtype!==s.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rR(n,t,e,s=0){fr(e);const r=U(n,"sparseIndices","sparseToDense","int32"),i=U(t,"sparseValues","sparseToDense","string_or_numeric"),o=U(s,"defaultValue","sparseToDense",i.dtype);sR(r,i,e,o);const a={sparseIndices:r,sparseValues:i,defaultValue:o},u={outputShape:e};return it.runKernel(Fp,a,u)}const Uw=ot({sparseToDense_:rR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iR(n,t){const e=U(t,"indices","gatherND","int32"),r={params:U(n,"x","gatherND","string_or_numeric"),indices:e};return it.runKernel(lp,r)}const Ww=ot({gatherND_:iR});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oR(n,t){if(t==null)return n.shape.slice();if(Ve(n.shape,t))return t;if(n.shape.length===t.length){const e=[];for(let s=0;s<n.shape.length;s++)t[s]==null&&n.shape[s]!=null?e.push(n.shape[s]):e.push(t[s]);return e}return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aR(n,t,e,s){const r=U(n,"x","dropout");if(V(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),V(t>=0&&t<1,()=>`rate must be a float in the range [0, 1), but got ${t}.`),t===0)return n instanceof $e?r.clone():r;const i=oR(r,e),o=1-t,a=ie(Ul(Lt(sa(i,0,1,"float32",s),o)),o);return ut(r,a)}const u2=ot({dropout_:aR});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l2(n){return Math.floor(Math.pow(2,Math.ceil(Math.log(n)/Math.log(2))))}function km(n,t,e){const s=1-n%2,r=new Float32Array(n);for(let i=0;i<n;++i){const o=2*Math.PI*i/(n+s-1);r[i]=t-e*Math.cos(o)}return zn(r,"float32")}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function uR(n,t,e=1){const s=U(n,"predictions","inTopK"),r=U(t,"targets","inTopK");V(s.rank>1,()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${s.rank}`),V(s.rank-1===r.rank,()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${s.rank} and targets rank ${r.rank}`),hs(s.shape.slice(0,s.shape.length-1),r.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const i=s.shape[s.shape.length-1];V(e>0&&e<=i,()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${i}), but got ${e}`);const o=await s.data(),a=await r.data(),[u,l]=[o.length/i,i],c=ss("bool",u);for(let h=0;h<u;h++){const d=h*l,f=o.subarray(d,d+l),p=[];for(let m=0;m<f.length;m++)p.push({value:f[m],index:m});p.sort((m,g)=>g.value-m.value),c[h]=0;for(let m=0;m<e;m++)if(p[m].index===a[h]){c[h]=1;break}}return n!==s&&s.dispose(),t!==r&&r.dispose(),Cr(c,r.shape,"bool")}const Gw=uR;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lR(n,t,e,s,r,i="NHWC",o){let a=n;n.rank===3&&(a=ct(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let u=t;u.rank===3&&(u=ct(t,[1,t.shape[0],t.shape[1],t.shape[2]])),V(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),V(u.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`),V(e.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${e}.`);const l=i==="NHWC"?a.shape[3]:a.shape[1],c=i==="NHWC"?u.shape[3]:u.shape[1];V(l===e[2],()=>`Error in conv2dDerFilter: depth of input ${l}) must match input depth in filter (${e[2]}.`),V(c===e[3],()=>`Error in conv2dDerFilter: depth of dy (${c}) must match output depth for filter (${e[3]}).`),Ps("conv2dDerFilter",r,o);const h={x:a,dy:u},d={strides:s,pad:r,dataFormat:i,dimRoundingMode:o,filterShape:e};return it.runKernel(Kf,h,d)}const c2=ot({conv2DBackpropFilter_:lR});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sm(n,t,e){if(e==null||e==="linear")return n;if(e==="relu")return ut(n,nu(t));throw new Error(`Cannot compute gradient for fused activation ${e}.`)}function Im(n,t){let e=t;const s=Un(n.shape,t.shape);return s.length>0&&(e=he(e,s)),ct(e,n.shape)}function Cm(n,t,e,s){if(t==="linear")return n;if(t==="relu")return fi(n);if(t==="elu")return Bl(n);if(t==="relu6")return um(n);if(t==="prelu")return td(n,e);if(t==="leakyrelu")return qh(n,s);if(t==="sigmoid")return Hs(n);throw new Error(`Unknown fused activation ${t}.`)}const Nm=(n,t)=>!(n>0)||t==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cR({x:n,filter:t,strides:e,pad:s,dataFormat:r="NHWC",dilations:i=[1,1],dimRoundingMode:o,bias:a,activation:u="linear",preluActivationWeights:l,leakyreluAlpha:c}){if(u=u||"linear",Nm(it.state.gradientDepth,u)===!1){V(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let N=ro(n,t,e,s,r,i,o);return a!=null&&(N=Lt(N,a)),Cm(N,u,l,c)}const h=U(n,"x","conv2d","float32"),d=U(t,"filter","conv2d","float32");let f=h,p=!1;h.rank===3&&(p=!0,f=ct(h,[1,h.shape[0],h.shape[1],h.shape[2]])),V(f.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${f.rank}.`),V(d.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${d.rank}.`),Ps("fused conv2d",s,o);const m=r==="NHWC"?f.shape[3]:f.shape[1];V(d.shape[2]===m,()=>`Error in conv2d: depth of input (${m}) must match input depth for filter ${d.shape[2]}.`),V(ds(e,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`);const g=rs(f.shape,d.shape,e,i,s,o);let y;a!=null&&(y=U(a,"bias","fused conv2d"),[y]=Nn(y,h),r==="NHWC"?Ee(g.outShape,y.shape):(V(y.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${y.shape.length}.`),V(y.shape.length===0||y.shape[0]===g.outChannels||y.shape[0]===1,()=>`Error in fused conv2d: bias shape (${y.shape}) is not compatible with the number of output channels (${g.outChannels})`)));let b;if(l!=null){const N=l.shape;if(V(N.length<=1||N.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${N.length}.`),N.length===1)V(N[0]===1||N[0]===g.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${N}) is not compatible with the number of output channels (${g.outChannels}).`);else if(N.length===3)try{Ee(N,g.outShape)}catch{const L=`Error in fused conv2d: PReLU activation weights (${N}) is not compatible with the output shape of the conv2d (${g.outShape}).`;throw Error(L)}b=U(l,"prelu weights","fused conv2d")}const w=(N,R)=>{V(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[L,F,B,H]=R,z=Sm(N,B,u);V(Go(i),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);const G=v0(F.shape,z,L,e,s),T=c2(F,z,L.shape,e,s),K=[G,T];if(H!=null){const ht=Im(H,z);K.push(ht)}return K},v={x:f,filter:d,bias:y,preluActivationWeights:b},S={strides:e,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o,activation:u,leakyreluAlpha:c};return a==null?zi((R,L,F)=>{let B=it.runKernel(xc,v,S);return F([L,R,B]),p&&(B=ct(B,[B.shape[1],B.shape[2],B.shape[3]])),{value:B,gradFunc:w}})(f,d):zi((R,L,F,B)=>{let H=it.runKernel(xc,v,S);return B([L,R,H,F]),p&&(H=ct(H,[H.shape[1],H.shape[2],H.shape[3]])),{value:H,gradFunc:w}})(f,d,y)}const jw=ot({fusedConv2d_:cR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hR(n,t,e,s,r,i=[1,1],o){let a=n;n.rank===3&&(a=ct(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let u=t;u.rank===3&&(u=ct(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const l={x:a,dy:u},c={strides:s,pad:r,dimRoundingMode:o,dilations:i,filterShape:e};return it.runKernel(tp,l,c)}const Hw=ot({depthwiseConv2dNativeBackpropFilter_:hR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dR(n,t,e,s,r,i=[1,1],o){let a=t,u=!1;t.rank===3&&(u=!0,a=ct(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const l={dy:a,filter:e},c={strides:s,pad:r,dimRoundingMode:o,dilations:i,inputShape:n},h=it.runKernel(ep,l,c);return u?ct(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const Kw=ot({depthwiseConv2dNativeBackpropInput_:dR});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fR({x:n,filter:t,strides:e,pad:s,dataFormat:r="NHWC",dilations:i=[1,1],dimRoundingMode:o,bias:a,activation:u="linear",preluActivationWeights:l,leakyreluAlpha:c}){if(Nm(it.state.gradientDepth,u)===!1){let S=zl(n,t,e,s,r,i,o);return a!=null&&(S=Lt(S,a)),Cm(S,u,l,c)}const h=U(n,"x","depthwiseConv2d","float32"),d=U(t,"filter","depthwiseConv2d","float32");let f=h,p=!1;h.rank===3&&(p=!0,f=ct(h,[1,h.shape[0],h.shape[1],h.shape[2]])),V(f.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${f.rank}.`),V(d.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${d.rank}.`),V(f.shape[3]===d.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${f.shape[3]}) must match the inChannels dimension in filter ${d.shape[2]}.`),i==null&&(i=[1,1]),V(ds(e,i),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`),Ps("fused depthwiseConv2d",s,o);const m=rs(f.shape,d.shape,e,i,s,o,!0);let g;a!=null&&(g=U(a,"bias","fused conv2d"),[g]=Nn(g,h),Ee(m.outShape,g.shape));let y;l!=null&&(y=U(l,"prelu weights","fused depthwiseConv2d"));const b=(S,N)=>{V(Go(i),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${i}'`);const[R,L,F,B]=N,H=Sm(S,F,u),z=Kw(L.shape,H,R,e,s,i,o),G=Hw(L,H,R.shape,e,s,i,o);if(B!=null){const T=Im(g,H);return[z,G,T]}return[z,G]},w={x:f,filter:d,bias:g,preluActivationWeights:y},v={strides:e,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o,activation:u,leakyreluAlpha:c};return a==null?zi((N,R,L)=>{let F=it.runKernel(wc,w,v);return L([R,N,F]),p&&(F=ct(F,[F.shape[1],F.shape[2],F.shape[3]])),{value:F,gradFunc:b}})(f,d):zi((N,R,L,F)=>{let B=it.runKernel(wc,w,v);return F([R,N,B,L]),p&&(B=ct(B,[B.shape[1],B.shape[2],B.shape[3]])),{value:B,gradFunc:b}})(f,d,g)}const pR=ot({fusedDepthwiseConv2d_:fR});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mR({a:n,b:t,transposeA:e=!1,transposeB:s=!1,bias:r,activation:i="linear",preluActivationWeights:o,leakyreluAlpha:a=.2}){if(Nm(it.state.gradientDepth,i)===!1){let H=De(n,t,e,s);return r!=null&&(H=Lt(H,r)),Cm(H,i,o,a)}let u=U(n,"a","fused matMul"),l=U(t,"b","fused matMul");[u,l]=Nn(u,l);const c=e?u.shape[u.rank-2]:u.shape[u.rank-1],h=s?l.shape[l.rank-1]:l.shape[l.rank-2],d=e?u.shape[u.rank-1]:u.shape[u.rank-2],f=s?l.shape[l.rank-2]:l.shape[l.rank-1],p=u.shape.slice(0,-2),m=l.shape.slice(0,-2),g=Et(p),y=Et(m);V(c===h,()=>`Error in fused matMul: inner shapes (${c}) and (${h}) of Tensors with shapes ${u.shape} and ${l.shape} and transposeA=${e} and transposeB=${s} must match.`);const w=Ee(u.shape.slice(0,-2),l.shape.slice(0,-2)).concat([d,f]),v=e?ct(u,[g,c,d]):ct(u,[g,d,c]),S=s?ct(l,[y,f,h]):ct(l,[y,h,f]);let N;r!=null&&(N=U(r,"bias","fused matMul"),[N]=Nn(N,u),Ee(w,N.shape));let R;o!=null&&(R=U(o,"prelu weights","fused matMul"));const L=(H,z)=>{const[G,T,K,ht]=z,rt=Sm(ct(H,K.shape),K,i);let gt,at;if(!e&&!s?(gt=De(rt,T,!1,!0),at=De(G,rt,!0,!1)):!e&&s?(gt=De(rt,T,!1,!1),at=De(rt,G,!0,!1)):e&&!s?(gt=De(T,rt,!1,!0),at=De(G,rt,!1,!1)):(gt=De(T,rt,!0,!0),at=De(rt,G,!0,!0)),r!=null){const It=Im(ht,rt);return[gt,at,It]}else return[gt,at]},F={a:v,b:S,bias:N,preluActivationWeights:R},B={transposeA:e,transposeB:s,activation:i,leakyreluAlpha:a};return r==null?zi((z,G,T)=>{const K=it.runKernel(bc,F,B);return T([z,G,K]),{value:ct(K,w),gradFunc:L}})(v,S):zi((z,G,T,K)=>{const ht=it.runKernel(bc,F,B);return K([z,G,ht,T]),{value:ct(ht,w),gradFunc:L}})(v,S,N)}const s1=ot({fusedMatMul_:mR});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qw=Object.freeze(Object.defineProperty({__proto__:null,conv2d:jw,depthwiseConv2d:pR,matMul:s1},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gR(n){return km(n,.54,.46)}const yR=ot({hammingWindow_:gR});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bR(n){return km(n,.5,.5)}const Xw=ot({hannWindow_:bR});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xR(n,t,e,s=!1,r=0){let i=0;const o=[];for(;i+t<=n.size;)o.push(xe(n,i,t)),i+=e;if(s)for(;i<n.size;){const a=i+t-n.size,u=Cn([xe(n,i,t-a),Qa([a],r)]);o.push(u),i+=e}return o.length===0?Di([],[0,t]):ct(Cn(o),[o.length,t])}const Yw=ot({frame_:xR});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wR(n,t,e,s,r=Xw){s==null&&(s=l2(t));const i=Yw(n,t,e),o=ut(i,r(t));return id(o,s)}const vR=ot({stft_:wR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kR(n,t,e,s,r="bilinear",i=0){const o=U(n,"image","cropAndResize"),a=U(t,"boxes","cropAndResize","float32"),u=U(e,"boxInd","cropAndResize","int32"),l=a.shape[0];V(o.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),V(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${l},4] but had shape ${a.shape}.`),V(u.rank===1&&u.shape[0]===l,()=>`Error in cropAndResize: boxInd must be have size [${l}] but had shape ${a.shape}.`),V(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),V(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),V(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const c={image:o,boxes:a,boxInd:u},h={method:r,extrapolationValue:i,cropSize:s};return it.runKernel(Zf,c,h)}const SR=ot({cropAndResize_:kR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IR(n){const t=U(n,"image","flipLeftRight","float32");V(t.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${t.rank}.`);const e={image:t};return it.runKernel(up,e,{})}const CR=ot({flipLeftRight_:IR});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NR(n){const t=U(n,"image","grayscaleToRGB"),e=t.rank-1,s=t.shape[e];V(t.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${t.rank}.`),V(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const r=new Array(t.rank);return r.fill(1,0,e),r[e]=3,kr(t,r)}const TR=ot({grayscaleToRGB_:NR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $R(n,t,e=0,s=.5){const r=U(n,"image","rotateWithOffset","float32");V(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const i={image:r},o={radians:t,fillValue:e,center:s};return it.runKernel(Gp,i,o)}const ER=ot({rotateWithOffset_:$R});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gl(n,t,e,s,r,i){s==null&&(s=.5),r==null&&(r=Number.NEGATIVE_INFINITY),i==null&&(i=0);const o=n.shape[0];return e=Math.min(e,o),V(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),V(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),V(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),V(t.rank===1,()=>"scores must be a 1D tensor"),V(t.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${t.shape[0]}`),V(0<=i&&i<=1,()=>`softNmsSigma must be in [0, 1], but was '${i}'`),{maxOutputSize:e,iouThreshold:s,scoreThreshold:r,softNmsSigma:i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _R(n,t,e,s=.5,r=Number.NEGATIVE_INFINITY){const i=U(n,"boxes","nonMaxSuppression","float32"),o=U(t,"scores","nonMaxSuppression","float32"),a=Gl(i,o,e,s,r);e=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const u={maxOutputSize:e,iouThreshold:s,scoreThreshold:r};return it.runKernel(bp,{boxes:i,scores:o},u)}const AR=ot({nonMaxSuppression_:_R});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RR(n,t,e){const s=DR(n,t,e),r=s<0?-(s+1):s;n.splice(r,0,t)}function DR(n,t,e){return FR(n,t,e||OR)}function OR(n,t){return n>t?1:n<t?-1:0}function FR(n,t,e){let s=0,r=n.length,i=0,o=!1;for(;s<r;){i=s+(r-s>>>1);const a=e(t,n[i]);a>0?s=i+1:(r=i,o=!a)}return o?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tm(n,t,e,s,r){return h2(n,t,e,s,r,0)}function $m(n,t,e,s,r,i){return h2(n,t,e,s,r,0,!1,i,!0)}function Em(n,t,e,s,r,i){return h2(n,t,e,s,r,i,!0)}function h2(n,t,e,s,r,i,o=!1,a=!1,u=!1){const l=[];for(let g=0;g<t.length;g++)t[g]>r&&l.push({score:t[g],boxIndex:g,suppressBeginIndex:0});l.sort(tb);const c=i>0?-.5/i:0,h=[],d=[];for(;h.length<e&&l.length>0;){const g=l.pop(),{score:y,boxIndex:b,suppressBeginIndex:w}=g;if(y<r)break;let v=!1;for(let S=h.length-1;S>=w;--S){const N=LR(n,b,h[S]);if(N>=s){v=!0;break}if(g.score=g.score*PR(s,c,N),g.score<=r)break}g.suppressBeginIndex=h.length,v||(g.score===y?(h.push(b),d.push(g.score)):g.score>r&&RR(l,g,tb))}const f=h.length,p=e-f;a&&p>0&&(h.push(...new Array(p).fill(0)),d.push(...new Array(p).fill(0)));const m={selectedIndices:h};return o&&(m.selectedScores=d),u&&(m.validOutputs=f),m}function LR(n,t,e){const s=n.subarray(t*4,t*4+4),r=n.subarray(e*4,e*4+4),i=Math.min(s[0],s[2]),o=Math.min(s[1],s[3]),a=Math.max(s[0],s[2]),u=Math.max(s[1],s[3]),l=Math.min(r[0],r[2]),c=Math.min(r[1],r[3]),h=Math.max(r[0],r[2]),d=Math.max(r[1],r[3]),f=(a-i)*(u-o),p=(h-l)*(d-c);if(f<=0||p<=0)return 0;const m=Math.max(i,l),g=Math.max(o,c),y=Math.min(a,h),b=Math.min(u,d),w=Math.max(y-m,0)*Math.max(b-g,0);return w/(f+p-w)}function PR(n,t,e){const s=Math.exp(t*e*e);return e<=n?s:0}function tb(n,t){return n.score-t.score||n.score===t.score&&t.boxIndex-n.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function MR(n,t,e,s=.5,r=Number.NEGATIVE_INFINITY){const i=U(n,"boxes","nonMaxSuppressionAsync"),o=U(t,"scores","nonMaxSuppressionAsync"),a=Gl(i,o,e,s,r);e=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const u=await Promise.all([i.data(),o.data()]),l=u[0],c=u[1],{selectedIndices:h}=Tm(l,c,e,s,r);return i!==n&&i.dispose(),o!==t&&o.dispose(),zn(h,"int32")}const zR=MR;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BR(n,t,e,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=U(n,"boxes","nonMaxSuppression"),a=U(t,"scores","nonMaxSuppression"),u=Gl(o,a,e,s,r,i);e=u.maxOutputSize,s=u.iouThreshold,r=u.scoreThreshold,i=u.softNmsSigma;const l={boxes:o,scores:a},c={maxOutputSize:e,iouThreshold:s,scoreThreshold:r,softNmsSigma:i},h=it.runKernel(wp,l,c);return{selectedIndices:h[0],selectedScores:h[1]}}const VR=ot({nonMaxSuppressionWithScore_:BR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function UR(n,t,e,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=U(n,"boxes","nonMaxSuppressionAsync"),a=U(t,"scores","nonMaxSuppressionAsync"),u=Gl(o,a,e,s,r,i);e=u.maxOutputSize,s=u.iouThreshold,r=u.scoreThreshold,i=u.softNmsSigma;const l=await Promise.all([o.data(),a.data()]),c=l[0],h=l[1],{selectedIndices:d,selectedScores:f}=Em(c,h,e,s,r,i);return o!==n&&o.dispose(),a!==t&&a.dispose(),{selectedIndices:zn(d,"int32"),selectedScores:zn(f)}}const WR=UR;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GR(n,t,e,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=U(n,"boxes","nonMaxSuppression"),a=U(t,"scores","nonMaxSuppression"),u=Gl(o,a,e,s,r,null),l=u.maxOutputSize,c=u.iouThreshold,h=u.scoreThreshold,d={boxes:o,scores:a},f={maxOutputSize:l,iouThreshold:c,scoreThreshold:h,padToMaxOutputSize:i},p=it.runKernel(xp,d,f);return{selectedIndices:p[0],validOutputs:p[1]}}const jR=ot({nonMaxSuppressionPadded_:GR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function HR(n,t,e,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=U(n,"boxes","nonMaxSuppressionAsync"),a=U(t,"scores","nonMaxSuppressionAsync"),u=Gl(o,a,e,s,r,null),l=u.maxOutputSize,c=u.iouThreshold,h=u.scoreThreshold,[d,f]=await Promise.all([o.data(),a.data()]),{selectedIndices:p,validOutputs:m}=$m(d,f,l,c,h,i);return o!==n&&o.dispose(),a!==t&&a.dispose(),{selectedIndices:zn(p,"int32"),validOutputs:fe(m,"int32")}}const KR=HR;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qR(n,t,e=!1,s=!1){const r=U(n,"images","resizeBilinear");V(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),V(t.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${t}.`),V(s===!1||e===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=ct(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:i},u={alignCorners:e,halfPixelCenters:s,size:t},l=it.runKernel(Eh,a,u);return o?ct(l,[l.shape[1],l.shape[2],l.shape[3]]):l}const Zw=ot({resizeBilinear_:qR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XR(n,t,e=!1,s=!1){const r=U(n,"images","resizeNearestNeighbor");V(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),V(t.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${t}.`),V(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),V(s===!1||e===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=ct(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:i},u={alignCorners:e,halfPixelCenters:s,size:t},l=it.runKernel($h,a,u);return o?ct(l,[l.shape[1],l.shape[2],l.shape[3]]):l}const Jw=ot({resizeNearestNeighbor_:XR});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YR(n,t="binary",e=!1,s=.5){const r=U(n,"image","threshold"),i=.2989,o=.587,a=.114,u=r.shape[0]*r.shape[1];let l=ut(zn([s]),255),c,h,d,f;if(V(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),V(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),V(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),V(t==="otsu"||t==="binary",()=>`Method must be binary or otsu, but was ${t}`),r.shape[2]===3){[c,h,d]=Ks(r,[1,1,1],-1);const g=ut(c,i),y=ut(h,o),b=ut(d,a);f=Lt(Lt(g,y),b)}else f=n;if(t==="otsu"){const g=m0(Kt(lm(f),"int32"),Cr([]),256);l=ZR(g,u)}const p=e?na(f,l):Ms(f,l);return Kt(ut(p,255),"int32")}function ZR(n,t){let e=zn([-1]),s=zn([0]),r=zn([0]),i,o,a,u,l,c;for(let h=0;h<n.size-1;h++){i=xe(n,0,h+1),o=xe(n,h+1),l=ie(he(i),t),c=ie(he(o),t);const d=he(ut(i,oo(0,i.size)));a=ie(d,he(i));const f=Qa(o.shape,i.size),p=Lt(oo(0,o.size),f),m=ut(o,p);u=ie(he(m),he(o));const g=oe(a,u),y=oe(a,u),b=ut(l,c);r=ut(ut(b,g),y);const w=Ms(r,s);s=us(w,r,s),e=us(w,zn([h]),e)}return e}const JR=ot({threshold_:YR});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QR(n,t,e="nearest",s="constant",r=0,i){const o=U(n,"image","transform","float32"),a=U(t,"transforms","transform","float32");V(o.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`),V(a.rank===2&&(a.shape[0]===o.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),V(i==null||i.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${i}.`);const u={image:o,transforms:a},l={interpolation:e,fillMode:s,fillValue:r,outputShape:i};return it.runKernel(Up,u,l)}const t5=ot({transform_:QR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e5(n,t,e){const s=U(n,"a","bandPart");V(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const r=s.shape,[i,o]=s.shape.slice(-2);let a,u;typeof t=="number"?(V(t%1===0,()=>`bandPart(): numLower must be an integer, got ${t}.`),V(t<=i,()=>`bandPart(): numLower (${t}) must not be greater than the number of rows (${i}).`),a=U(t<0?i:t,"numLower","bandPart")):(V(t.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=us(Du(t,0),i,jo(t,i))),typeof e=="number"?(V(e%1===0,()=>`bandPart(): numUpper must be an integer, got ${e}.`),V(e<=o,()=>`bandPart(): numUpper (${e}) must not be greater than the number of columns (${o}).`),u=U(e<0?o:e,"numUpper","bandPart")):(V(e.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),u=us(Du(e,0),o,jo(e,o)));const l=ct(oo(0,i,1,"int32"),[-1,1]),c=oo(0,o,1,"int32"),h=oe(l,c),d=ai(na(h,a),go(h,dn(u))),f=Mn([i,o],s.dtype);return ct(cr($r(ct(s,[-1,i,o])).map(p=>us(d,p,f))),r)}const n5=ot({bandPart_:e5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s5(n){let t;if(Array.isArray(n)){t=!1,V(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=n[0].shape[0];for(let i=1;i<n.length;++i)V(n[i].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[i].shape[0]} vs. ${r})`)}else t=!0,n=Ks(n,n.shape[0],0).map(r=>tn(r,[0]));V(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);const e=[],s=n;for(let r=0;r<n.length;++r)e.push(it.tidy(()=>{let i=s[r];if(r>0)for(let o=0;o<r;++o){const a=ut(he(ut(e[o],i)),e[o]);i=oe(i,a)}return ie(i,Vl(i,"euclidean"))}));return t?cr(e,0):e}const r5=ot({gramSchmidt_:s5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i5(n,t=!1){if(V(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return eb(n,t);{const e=n.shape.slice(0,n.shape.length-2).reduce((u,l)=>u*l),s=$r(ct(n,[e,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),r=[],i=[];s.forEach(u=>{const[l,c]=eb(u,t);r.push(l),i.push(c)});const o=ct(cr(r,0),n.shape),a=ct(cr(i,0),n.shape);return[o,a]}}function eb(n,t=!1){return it.tidy(()=>{V(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);const e=n.shape[0],s=n.shape[1];let r=Qp(e),i=Ri(n);const o=Di([[1]],[1,1]);let a=Ri(o);const u=e>=s?s:e;for(let l=0;l<u;++l){const c=i,h=a,d=r;[a,i,r]=it.tidy(()=>{const f=xe(i,[l,l],[e-l,1]),p=Vl(f),m=xe(i,[l,l],[1,1]),g=us(Ms(m,0),Di([[-1]]),Di([[1]])),y=oe(m,ut(g,p)),b=ie(f,y);b.shape[0]===1?a=Ri(o):a=Cn([o,xe(b,[1,0],[b.shape[0]-1,b.shape[1]])],0);const w=dn(ie(De(g,y),p)),v=xe(i,[l,0],[e-l,s]),S=ut(w,a),N=Ue(a);if(l===0)i=oe(v,De(S,De(N,v)));else{const F=oe(v,De(S,De(N,v)));i=Cn([xe(i,[0,0],[l,s]),F],0)}const R=Ue(S),L=xe(r,[0,l],[e,r.shape[1]-l]);if(l===0)r=oe(L,De(De(L,a),R));else{const F=oe(L,De(De(L,a),R));r=Cn([xe(r,[0,0],[e,l]),F],1)}return[a,i,r]}),Se([c,h,d])}return!t&&e>s&&(r=xe(r,[0,0],[e,s]),i=xe(i,[0,0],[s,s])),[r,i]})}const o5=ot({qr_:i5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var As;(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(As||(As={}));function a5(n,t,e=As.SUM_BY_NONZERO_WEIGHTS){const s=U(n,"losses","computeWeightedLoss");let r=null;t!=null&&(r=U(t,"weights","computeWeightedLoss"));const i=r==null?s:ut(s,r);if(e===As.NONE)return i;if(e===As.SUM)return he(i);if(e===As.MEAN){if(r==null)return wn(i);{const o=s.size/r.size,a=ie(he(i),he(r));return o>1?ie(a,fe(o)):a}}if(e===As.SUM_BY_NONZERO_WEIGHTS){if(r==null)return ie(he(i),fe(s.size));{const o=ut(r,or(s.shape)),a=Kt(he(Ba(o,fe(0))),"float32");return ie(he(i),a)}}throw Error(`Unknown reduction: ${e}`)}const yo=ot({computeWeightedLoss_:a5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u5(n,t,e,s=As.SUM_BY_NONZERO_WEIGHTS){const r=U(n,"labels","absoluteDifference"),i=U(t,"predictions","absoluteDifference");let o=null;e!=null&&(o=U(e,"weights","absoluteDifference")),hs(r.shape,i.shape,"Error in absoluteDifference: ");const a=Pn(oe(r,i));return yo(a,o,s)}const l5=ot({absoluteDifference_:u5});function c5(n,t,e,s,r=As.SUM_BY_NONZERO_WEIGHTS){const i=U(n,"labels","cosineDistance"),o=U(t,"predictions","cosineDistance");let a=null;s!=null&&(a=U(s,"weights","cosineDistance")),hs(i.shape,o.shape,"Error in cosineDistance: ");const u=fe(1),l=oe(u,he(ut(i,o),e,!0));return yo(l,a,r)}const h5=ot({cosineDistance_:c5});function d5(n,t,e,s=As.SUM_BY_NONZERO_WEIGHTS){let r=U(n,"labels","hingeLoss");const i=U(t,"predictions","hingeLoss");let o=null;e!=null&&(o=U(e,"weights","hingeLoss")),hs(r.shape,i.shape,"Error in hingeLoss: ");const a=fe(1);r=oe(ut(fe(2),r),a);const u=fi(oe(a,ut(r,i)));return yo(u,o,s)}const f5=ot({hingeLoss_:d5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p5(n,t,e,s=1,r=As.SUM_BY_NONZERO_WEIGHTS){const i=U(n,"labels","huberLoss"),o=U(t,"predictions","huberLoss");let a=null;e!=null&&(a=U(e,"weights","huberLoss")),hs(i.shape,o.shape,"Error in huberLoss: ");const u=fe(s),l=Pn(oe(o,i)),c=jo(l,u),h=oe(l,c),d=Lt(ut(fe(.5),an(c)),ut(u,h));return yo(d,a,r)}const m5=ot({huberLoss_:p5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g5(n,t,e,s=1e-7,r=As.SUM_BY_NONZERO_WEIGHTS){const i=U(n,"labels","logLoss"),o=U(t,"predictions","logLoss");let a=null;e!=null&&(a=U(e,"weights","logLoss")),hs(i.shape,o.shape,"Error in logLoss: ");const u=fe(1),l=fe(s),c=dn(ut(i,ur(Lt(o,l)))),h=ut(oe(u,i),ur(Lt(oe(u,o),l))),d=oe(c,h);return yo(d,a,r)}const y5=ot({logLoss_:g5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b5(n,t,e,s=As.SUM_BY_NONZERO_WEIGHTS){const r=U(n,"labels","meanSquaredError"),i=U(t,"predictions","meanSquaredError");let o=null;e!=null&&(o=U(e,"weights","meanSquaredError")),hs(r.shape,i.shape,"Error in meanSquaredError: ");const a=ym(r,i);return yo(a,o,s)}const x5=ot({meanSquaredError_:b5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w5(n,t){const e=U(n,"labels","sigmoidCrossEntropyWithLogits"),s=U(t,"logits","sigmoidCrossEntropyWithLogits");hs(e.shape,s.shape,"Error in sigmoidCrossEntropyWithLogits: ");const r=fi(s),i=ut(s,e),o=Xh(Fs(dn(Pn(s))));return Lt(oe(r,i),o)}function v5(n,t,e,s=0,r=As.SUM_BY_NONZERO_WEIGHTS){let i=U(n,"multiClassLabels","sigmoidCrossEntropy");const o=U(t,"logits","sigmoidCrossEntropy");let a=null;if(e!=null&&(a=U(e,"weights","sigmoidCrossEntropy")),hs(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),s>0){const l=fe(s),c=fe(1),h=fe(.5);i=Lt(ut(i,oe(c,l)),ut(h,l))}const u=w5(i,o);return yo(u,a,r)}const k5=ot({sigmoidCrossEntropy_:v5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S5(n,t,e=-1){if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${t.rank} and dim was ${e}`);return zi((r,i,o)=>{const u=nm(i,[e],!0),l=oe(Kt(i,"float32"),u);o([r,l]);const c=dn(ut(l,r));return{value:he(c,[e]),gradFunc:(f,p)=>{const[m,g]=p,y=An(f.shape,[e]);return[ut(ct(f,y),oe(Kt(m,"float32"),Fs(g))),ut(ct(f,y),oe(Fs(g),Kt(m,"float32")))]}}})(n,t)}function I5(n,t,e,s=0,r=As.SUM_BY_NONZERO_WEIGHTS){let i=U(n,"onehotLabels","softmaxCrossEntropy");const o=U(t,"logits","softmaxCrossEntropy");let a=null;if(e!=null&&(a=U(e,"weights","softmaxCrossEntropy")),hs(i.shape,o.shape,"Error in softmaxCrossEntropy: "),s>0){const l=fe(s),c=fe(1),h=fe(i.shape[1]);i=Lt(ut(i,oe(c,l)),ie(l,h))}const u=S5(i,o);return yo(u,a,r)}const C5=ot({softmaxCrossEntropy_:I5});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N5(n,t,e,s){const r=U(n,"indices","sparseFillEmptyRows","int32"),i=U(t,"values","sparseFillEmptyRows"),o=U(e,"denseShape","sparseFillEmptyRows","int32"),a=U(s,"defaultValue","sparseFillEmptyRows",i.dtype);if(r.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        ${r.shape}`);if(i.rank!==1)throw new Error(`Values should be Tensor1D but received shape ${i.shape}`);if(o.rank!==1)throw new Error(`Dense shape should be Tensor1D but received shape ${o.shape}`);if(a.rank!==0)throw new Error(`Default value should be a scalar but received shape ${a.shape}`);const u={indices:r,values:i,denseShape:o,defaultValue:a},l=it.runKernel(Ap,u);return{outputIndices:l[0],outputValues:l[1],emptyRowIndicator:l[2],reverseIndexMap:l[3]}}const T5=ot({sparseFillEmptyRows_:N5});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $5(n,t,e){const s=U(n,"inputIndices","sparseReshape","int32"),r=U(t,"inputShape","sparseReshape","int32"),i=U(e,"newShape","sparseReshape","int32");if(s.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        ${s.shape}`);if(r.rank!==1)throw new Error(`Input shape should be Tensor1D but received shape ${r.shape}`);if(i.rank!==1)throw new Error(`New shape should be Tensor1D but received shape ${i.shape}`);const o={inputIndices:s,inputShape:r,newShape:i},a=it.runKernel(Rp,o);return{outputIndices:a[0],outputShape:a[1]}}const E5=ot({sparseReshape_:$5});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _5(n,t,e){const s=U(n,"data","sparseSegmentMean"),r=U(t,"indices","sparseSegmentMean","int32"),i=U(e,"segmentIds","sparseSegmentMean","int32");if(s.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          ${r.shape}`);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          ${i.shape}`);const o={data:s,indices:r,segmentIds:i};return it.runKernel(Dp,o)}const A5=ot({sparseSegmentMean_:_5});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R5(n,t,e){const s=U(n,"data","sparseSegmentSum"),r=U(t,"indices","sparseSegmentSum","int32"),i=U(e,"segmentIds","sparseSegmentSum","int32");if(s.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         ${r.shape}`);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         ${i.shape}`);const o={data:s,indices:r,segmentIds:i};return it.runKernel(Op,o)}const D5=ot({sparseSegmentSum_:R5});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O5(n,t,e,s,r,i,o,a){const u=U(n,"data","stringNGrams","string");if(u.dtype!=="string")throw new Error("Data must be of datatype string");if(u.shape.length!==1)throw new Error(`Data must be a vector, saw: ${u.shape}`);const l=U(t,"dataSplits","stringNGrams");if(l.dtype!=="int32")throw new Error("Data splits must be of datatype int32");const c={separator:e,nGramWidths:s,leftPad:r,rightPad:i,padWidth:o,preserveShortSequences:a},h={data:u,dataSplits:l},d=it.runKernel(Mp,h,c);return{nGrams:d[0],nGramsSplits:d[1]}}const F5=ot({stringNGrams_:O5});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L5(n,t,e=!0){const s=U(n,"input","stringSplit","string"),r=U(t,"delimiter","stringSplit","string");if(s.rank!==1)throw new Error(`Input should be Tensor1D but received shape ${s.shape}`);if(r.rank!==0)throw new Error(`Delimiter should be a scalar but received shape ${r.shape}`);const i={skipEmpty:e},o={input:s,delimiter:r},a=it.runKernel(zp,o,i);return{indices:a[0],values:a[1],shape:a[2]}}const P5=ot({stringSplit_:L5});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M5(n,t){const e=U(n,"input","stringToHashBucketFast","string"),s={numBuckets:t};if(t<=0)throw new Error("Number of buckets must be at least 1");const r={input:e};return it.runKernel(Bp,r,s)}const z5=ot({stringToHashBucketFast_:M5});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B5(n,t,e,s=!0){const r=U(n,"input","staticRegexReplace","string"),i={pattern:t,rewrite:e,replaceGlobal:s};return it.runKernel(Ph,{x:r},i)}const V5=ot({staticRegexReplace_:B5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qw={fft:rd,ifft:Lu,rfft:id,irfft:gm},tv={hammingWindow:yR,hannWindow:Xw,frame:Yw,stft:vR},Bn={flipLeftRight:CR,grayscaleToRGB:TR,resizeNearestNeighbor:Jw,resizeBilinear:Zw,rotateWithOffset:ER,cropAndResize:SR,nonMaxSuppression:AR,nonMaxSuppressionAsync:zR,nonMaxSuppressionWithScore:VR,nonMaxSuppressionWithScoreAsync:WR,nonMaxSuppressionPadded:jR,nonMaxSuppressionPaddedAsync:KR,threshold:JR,transform:t5},d2={bandPart:n5,gramSchmidt:r5,qr:o5},ev={absoluteDifference:l5,computeWeightedLoss:yo,cosineDistance:h5,hingeLoss:f5,huberLoss:m5,logLoss:y5,meanSquaredError:x5,sigmoidCrossEntropy:k5,softmaxCrossEntropy:C5},nv={sparseFillEmptyRows:T5,sparseReshape:E5,sparseSegmentMean:A5,sparseSegmentSum:D5},sv={stringNGrams:F5,stringSplit:P5,stringToHashBucketFast:z5,staticRegexReplace:V5};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U5=new Map,r1=new Map;class su{getClassName(){return this.constructor.className}static fromConfig(t,e){return new t(e)}}class vr{constructor(){this.classNameMap={}}static getMap(){return vr.instance==null&&(vr.instance=new vr),vr.instance}static register(t){vr.getMap().classNameMap[t.className]=[t,t.fromConfig]}}function Vt(n,t,e){V(n.className!=null,()=>"Class being registered does not have the static className property defined."),V(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),V(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof t>"u"&&(t="Custom"),typeof e>"u"&&(e=n.className);const s=e,r=t+">"+s;return vr.register(n),U5.set(r,n),r1.set(n,r),n}function W5(n){return r1.has(n)?r1.get(n):n.className}const G5=Object.freeze(Object.defineProperty({__proto__:null,Serializable:su,SerializationMap:vr,getRegisteredName:W5,registerClass:Vt},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bo extends su{minimize(t,e=!1,s){const{value:r,grads:i}=this.computeGradients(t,s);if(s!=null){const o=s.map(a=>({name:a.name,tensor:i[a.name]}));this.applyGradients(o)}else this.applyGradients(i);return Se(i),e?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(t,e){return lw(t,e)}dispose(){this.iterations_!=null&&Se(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:fe(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(t){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(t){return this.iterations_=(await t[0].tensor.data())[0],t.slice(1)}}Object.defineProperty(bo,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class f2 extends bo{static get className(){return"Adadelta"}constructor(t,e,s=null){super(),this.learningRate=t,this.rho=e,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=it.backend.epsilon())}applyGradients(t){(Array.isArray(t)?t.map(s=>s.name):Object.keys(t)).forEach((s,r)=>{const i=it.registeredVariables[s],o=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accum_grad`,variable:pt(()=>je(i).variable(o))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${s}/accum_var`,variable:pt(()=>je(i).variable(o))});const a=Array.isArray(t)?t[r].tensor:t[s];if(a==null)return;const u=this.accumulatedGrads[r].variable,l=this.accumulatedUpdates[r].variable;pt(()=>{const c=Lt(ut(u,this.rho),ut(an(a),1-this.rho)),h=ut(ie(cs(Lt(l,this.epsilon)),cs(Lt(u,this.epsilon))),a),d=Lt(ut(l,this.rho),ut(an(h),1-this.rho));u.assign(c),l.assign(d);const f=Lt(ut(h,-this.learningRate),i);i.assign(f)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Se(this.accumulatedGrads.map(t=>t.variable)),Se(this.accumulatedUpdates.map(t=>t.variable)))}async getWeights(){const t=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(t.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(t){t=await this.extractIterations(t);const e=t.length/2,s=!1;this.accumulatedGrads=t.slice(0,e).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedUpdates=t.slice(e,e*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.rho,e.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class p2 extends bo{static get className(){return"Adagrad"}constructor(t,e=.1){super(),this.learningRate=t,this.initialAccumulatorValue=e,this.accumulatedGrads=[]}applyGradients(t){(Array.isArray(t)?t.map(s=>s.name):Object.keys(t)).forEach((s,r)=>{const i=it.registeredVariables[s];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accumulator`,variable:pt(()=>Qa(i.shape,this.initialAccumulatorValue).variable(!1))});const o=Array.isArray(t)?t[r].tensor:t[s];if(o==null)return;const a=this.accumulatedGrads[r].variable;pt(()=>{const u=Lt(a,an(o));a.assign(u);const l=Lt(ut(ie(o,cs(Lt(u,it.backend.epsilon()))),-this.learningRate),i);i.assign(l)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Se(this.accumulatedGrads.map(t=>t.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(t){t=await this.extractIterations(t);const e=!1;this.accumulatedGrads=t.map(s=>({originalName:s.name,variable:s.tensor.variable(e)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(t,e){return new t(e.learningRate,e.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class m2 extends bo{static get className(){return"Adam"}constructor(t,e,s,r=null){super(),this.learningRate=t,this.beta1=e,this.beta2=s,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],pt(()=>{this.accBeta1=fe(e).variable(),this.accBeta2=fe(s).variable()}),r==null&&(this.epsilon=it.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map(s=>s.name):Object.keys(t);pt(()=>{const s=oe(1,this.accBeta1),r=oe(1,this.accBeta2);e.forEach((i,o)=>{const a=it.registeredVariables[i],u=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:pt(()=>je(a).variable(u))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${i}/v`,variable:pt(()=>je(a).variable(u))});const l=Array.isArray(t)?t[o].tensor:t[i];if(l==null)return;const c=this.accumulatedFirstMoment[o].variable,h=this.accumulatedSecondMoment[o].variable,d=Lt(ut(c,this.beta1),ut(l,1-this.beta1)),f=Lt(ut(h,this.beta2),ut(an(l),1-this.beta2)),p=ie(d,s),m=ie(f,r);c.assign(d),h.assign(f);const g=Lt(ut(ie(p,Lt(cs(m),this.epsilon)),-this.learningRate),a);a.assign(g)}),this.accBeta1.assign(ut(this.accBeta1,this.beta1)),this.accBeta2.assign(ut(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Se(this.accumulatedFirstMoment.map(t=>t.variable)),this.accumulatedSecondMoment!=null&&Se(this.accumulatedSecondMoment.map(t=>t.variable))}async getWeights(){const t=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(t.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(t){t=await this.extractIterations(t),pt(()=>{this.accBeta1.assign(io(this.beta1,this.iterations_+1)),this.accBeta2.assign(io(this.beta2,this.iterations_+1))});const e=t.length/2,s=!1;this.accumulatedFirstMoment=t.slice(0,e).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedSecondMoment=t.slice(e,e*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class g2 extends bo{static get className(){return"Adamax"}constructor(t,e,s,r=null,i=0){super(),this.learningRate=t,this.beta1=e,this.beta2=s,this.epsilon=r,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],pt(()=>{this.iteration=fe(0).variable(),this.accBeta1=fe(e).variable()}),r==null&&(this.epsilon=it.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map(s=>s.name):Object.keys(t);pt(()=>{const s=oe(1,this.accBeta1),r=ie(-this.learningRate,Lt(ut(this.iteration,this.decay),1));e.forEach((i,o)=>{const a=it.registeredVariables[i],u=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:je(a).variable(u)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${i}/v`,variable:je(a).variable(u)});const l=Array.isArray(t)?t[o].tensor:t[i];if(l==null)return;const c=this.accumulatedFirstMoment[o].variable,h=this.accumulatedWeightedInfNorm[o].variable,d=Lt(ut(c,this.beta1),ut(l,1-this.beta1)),f=ut(h,this.beta2),p=Pn(l),m=Vi(f,p);c.assign(d),h.assign(m);const g=Lt(ut(ie(r,s),ie(d,Lt(m,this.epsilon))),a);a.assign(g)}),this.iteration.assign(Lt(this.iteration,1)),this.accBeta1.assign(ut(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Se(this.accumulatedFirstMoment.map(t=>t.variable)),this.accumulatedWeightedInfNorm!=null&&Se(this.accumulatedWeightedInfNorm.map(t=>t.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(t){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _m extends bo{static get className(){return"SGD"}constructor(t){super(),this.learningRate=t,this.setLearningRate(t)}applyGradients(t){(Array.isArray(t)?t.map(s=>s.name):Object.keys(t)).forEach((s,r)=>{const i=Array.isArray(t)?t[r].tensor:t[s];if(i==null)return;const o=it.registeredVariables[s];pt(()=>{const a=Lt(ut(this.c,i),o);o.assign(a)})}),this.incrementIterations()}setLearningRate(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=es(fe(-t))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(t){if(t=await this.extractIterations(t),t.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(t,e){return new t(e.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class y2 extends _m{static get className(){return"Momentum"}constructor(t,e,s=!1){super(t),this.learningRate=t,this.momentum=e,this.useNesterov=s,this.accumulations=[],this.m=fe(this.momentum)}applyGradients(t){(Array.isArray(t)?t.map(s=>s.name):Object.keys(t)).forEach((s,r)=>{const i=it.registeredVariables[s];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${s}/momentum`,variable:pt(()=>je(i).variable(!1))});const o=this.accumulations[r].variable,a=Array.isArray(t)?t[r].tensor:t[s];a!=null&&pt(()=>{let u;const l=Lt(ut(this.m,o),a);this.useNesterov?u=Lt(ut(this.c,Lt(a,ut(l,this.m))),i):u=Lt(ut(this.c,l),i),o.assign(l),i.assign(u)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Se(this.accumulations.map(t=>t.variable))}setMomentum(t){this.momentum=t}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(t){t=await this.extractIterations(t);const e=!1;this.accumulations=t.map(s=>({originalName:s.name,variable:s.tensor.variable(e)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class b2 extends bo{static get className(){return"RMSProp"}constructor(t,e=.9,s=0,r=null,i=!1){if(super(),this.learningRate=t,this.decay=e,this.momentum=s,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,r==null&&(this.epsilon=it.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(t){(Array.isArray(t)?t.map(s=>s.name):Object.keys(t)).forEach((s,r)=>{const i=it.registeredVariables[s],o=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${s}/rms`,variable:pt(()=>je(i).variable(o))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${s}/momentum`,variable:pt(()=>je(i).variable(o))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${s}/mg`,variable:pt(()=>je(i).variable(o))});const a=Array.isArray(t)?t[r].tensor:t[s];if(a==null)return;const u=this.accumulatedMeanSquares[r].variable,l=this.accumulatedMoments[r].variable;pt(()=>{const c=Lt(ut(u,this.decay),ut(an(a),1-this.decay));if(this.centered){const h=this.accumulatedMeanGrads[r].variable,d=Lt(ut(h,this.decay),ut(a,1-this.decay)),f=ie(ut(a,this.learningRate),cs(oe(c,Lt(an(d),this.epsilon)))),p=Lt(ut(l,this.momentum),f);u.assign(c),h.assign(d),l.assign(p);const m=oe(i,p);i.assign(m)}else{const h=Lt(ut(u,this.decay),ut(an(a),1-this.decay)),d=Lt(ut(l,this.momentum),ie(ut(a,this.learningRate),cs(Lt(h,this.epsilon))));u.assign(h),l.assign(d);const f=oe(i,d);i.assign(f)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Se(this.accumulatedMeanSquares.map(t=>t.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Se(this.accumulatedMeanGrads.map(t=>t.variable)),this.accumulatedMoments!=null&&Se(this.accumulatedMoments.map(t=>t.variable))}async getWeights(){const t=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&t.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(t.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(t){t=await this.extractIterations(t);const e=this.centered?t.length/3:t.length/2,s=!1;this.accumulatedMeanSquares=t.slice(0,e).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedMoments=t.slice(e,e*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=t.slice(e*2,e*3).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j5=[f2,p2,m2,g2,y2,b2,_m];function H5(){for(const n of j5)Vt(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K5="model",q5=".json",X5=".weights.bin";function nb(n){return new Promise(t=>setTimeout(t)).then(n)}class Ua{constructor(t){if(!vt().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(Ua.URL_SCHEME)&&(t=t.slice(Ua.URL_SCHEME.length)),(t==null||t.length===0)&&(t=K5),this.modelJsonFileName=t+q5,this.weightDataFileName=t+X5}async save(t){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");const e=di.join(t.weightData),s=window.URL.createObjectURL(new Blob([e],{type:"application/octet-stream"}));if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const r=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],i=Bx(t,r),o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),a=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(a.download=this.modelJsonFileName,a.href=o,await nb(()=>a.dispatchEvent(new MouseEvent("click"))),t.weightData!=null){const u=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;u.download=this.weightDataFileName,u.href=s,await nb(()=>u.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:Uh(t)}}}}Ua.URL_SCHEME="downloads://";class Y5{constructor(t){if(t==null||t.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${t}`);this.jsonFile=t[0],this.weightsFiles=t.slice(1)}async load(){return new Promise((t,e)=>{const s=new FileReader;s.onload=r=>{const i=JSON.parse(r.target.result),o=i.modelTopology;if(o==null){e(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));return}if(i.weightsManifest==null){e(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));return}if(this.weightsFiles.length===0){t({modelTopology:o});return}const u=J1(i,l=>this.loadWeights(l));t(u)},s.onerror=r=>e(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),s.readAsText(this.jsonFile)})}loadWeights(t){const e=[],s=[];for(const o of t)e.push(...o.weights),s.push(...o.paths);const r=this.checkManifestAndWeightFiles(t),i=s.map(o=>this.loadWeightsFile(o,r[o]));return Promise.all(i).then(o=>[e,o])}loadWeightsFile(t,e){return new Promise((s,r)=>{const i=new FileReader;i.onload=o=>{const a=o.target.result;s(a)},i.onerror=o=>r(`Failed to weights data from file of path '${t}'.`),i.readAsArrayBuffer(e)})}checkManifestAndWeightFiles(t){const e=[],s=this.weightsFiles.map(i=>Qy(i.name)),r={};for(const i of t)i.paths.forEach(o=>{const a=Qy(o);if(e.indexOf(a)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${a}'`);if(e.push(a),s.indexOf(a)===-1)throw new Error(`Weight file with basename '${a}' is not provided.`);r[o]=this.weightsFiles[s.indexOf(a)]});if(e.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${e.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return r}}const Z5=n=>vt().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Ua.URL_SCHEME)?J5(n.slice(Ua.URL_SCHEME.length)):null;Sn.registerSaveRouter(Z5);function J5(n="model"){return new Ua(n)}function Q5(n){return new Y5(n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sb(n,t,e,s){o(n),e=e??0,s=s??1,a(e,s);let r=0;const i=u=>(u.then(l=>{const c=e+ ++r/n.length*(s-e);return t(c),l}),u);function o(u){V(u!=null&&Array.isArray(u)&&u.length>0,()=>"promises must be a none empty array")}function a(u,l){V(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${u}`),V(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${l}`),V(l>=u,()=>`startFraction must be no more than endFraction, but got startFraction ${u} and endFraction ${l}`)}return Promise.all(n.map(i))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function rv(n,t){t==null&&(t={});const e=t.fetchFunc==null?vt().platform.fetch:t.fetchFunc,s=n.map(h=>e(h,t.requestInit,{isBinary:!0})),r=0,i=.5,a=(t.onProgress==null?await Promise.all(s):await sb(s,t.onProgress,r,i)).map(h=>h.arrayBuffer()),u=.5,l=1;return t.onProgress==null?await Promise.all(a):await sb(a,t.onProgress,u,l)}async function t6(n,t="",e,s){return iv(o=>rv(o,{requestInit:s}))(n,t,e)}function iv(n){return async(t,e="",s)=>{const r=t.map(()=>!1),i={},o=s!=null?s.map(()=>!1):[],a=[];if(t.forEach((f,p)=>{let m=0;f.weights.forEach(g=>{const y="quantization"in g?g.quantization.dtype:g.dtype,b=Yg[y]*Et(g.shape),w=()=>{r[p]=!0,i[p]==null&&(i[p]=[]),i[p].push({manifestEntry:g,groupOffset:m,sizeBytes:b})};s!=null?s.forEach((v,S)=>{v===g.name&&(w(),o[S]=!0)}):w(),a.push(g.name),m+=b})}),!o.every(f=>f)){const f=s.filter((p,m)=>!o[m]);throw new Error(`Could not find weights in manifest with names: ${f.join(", ")}. 
Manifest JSON has weights with names: ${a.join(", ")}.`)}const u=r.reduce((f,p,m)=>(p&&f.push(m),f),[]),l=[];u.forEach(f=>{t[f].paths.forEach(p=>{const m=e+(e.endsWith("/")?"":"/")+p;l.push(m)})});const c=await n(l),h={};let d=0;return u.forEach(f=>{const p=t[f].paths.length,m=new di(c.slice(d,d+p));i[f].forEach(y=>{const b=m.slice(y.groupOffset,y.groupOffset+y.sizeBytes),w=Mx(b,[y.manifestEntry]);for(const v in w)h[v]=w[v]}),d+=p}),h}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e6="application/octet-stream",n6="application/json";class x2{constructor(t,e){if(this.DEFAULT_METHOD="POST",e==null&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,this.weightUrlConverter=e.weightUrlConverter,e.fetchFunc!=null?(V(typeof e.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=e.fetchFunc):this.fetch=vt().platform.fetch,V(t!=null&&t.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(t)&&V(t.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${t.length}).`),this.path=t,e.requestInit!=null&&e.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);e.body=new FormData;const s=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],r=Bx(t,s);if(e.body.append("model.json",new Blob([JSON.stringify(r)],{type:n6}),"model.json"),t.weightData!=null){const o=di.join(t.weightData);e.body.append("model.weights.bin",new Blob([o],{type:e6}),"model.weights.bin")}const i=await this.fetch(this.path,e);if(i.ok)return{modelArtifactsInfo:Uh(t),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)}async load(){const t=await this.fetch(this.path,this.requestInit);if(!t.ok)throw new Error(`Request to ${this.path} failed with status code ${t.status}. Please verify this URL points to the model JSON of the model to load.`);let e;try{e=await t.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}const s=e.modelTopology,r=e.weightsManifest;if(s==null&&r==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return J1(e,i=>this.loadWeights(i))}async loadWeights(t){const e=Array.isArray(this.path)?this.path[1]:this.path,[s,r]=s6(e),i=this.weightPathPrefix||s,o=Ux(t),a=[],u=[];for(const c of t)for(const h of c.paths)this.weightUrlConverter!=null?u.push(this.weightUrlConverter(h)):a.push(i+h+r);this.weightUrlConverter&&a.push(...await Promise.all(u));const l=await rv(a,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[o,l]}}x2.URL_SCHEME_REGEX=/^https?:\/\//;function s6(n){const t=n.lastIndexOf("/"),e=n.lastIndexOf("?"),s=n.substring(0,t),r=e>t?n.substring(e):"";return[s+"/",r]}function i1(n){return n.match(x2.URL_SCHEME_REGEX)!=null}const ov=(n,t)=>{if(typeof fetch>"u"&&(t==null||t.fetchFunc==null))return null;{let e=!0;if(Array.isArray(n)?e=n.every(s=>i1(s)):e=i1(n),e)return w2(n,t)}return null};Sn.registerSaveRouter(ov);Sn.registerLoadRouter(ov);function w2(n,t){return new x2(n,t)}function r6(n,t){return w2(n,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lg{constructor(t){this.modelArtifacts=t}load(){return this.modelArtifacts}}class av{constructor(t){this.saveHandler=t}save(t){return this.saveHandler(t)}}class i6{constructor(t){t.load&&(this.load=()=>Promise.resolve(t.load())),t.save&&(this.save=e=>Promise.resolve(t.save(e)))}}function o6(n,t,e,s){const r=arguments;return new i6(uv(...r))}function uv(n,t,e,s){return arguments.length===1?n.modelTopology!=null||n.weightSpecs!=null?new lg(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new lg({modelTopology:n})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new lg({modelTopology:n,weightSpecs:t,weightData:e,trainingConfig:s}))}function a6(n){return new av(n)}function u6(n){return new av(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v2=Object.freeze(Object.defineProperty({__proto__:null,CompositeArrayBuffer:di,browserFiles:Q5,browserHTTPRequest:r6,concatenateArrayBuffers:zx,copyModel:_T,decodeWeights:Mx,encodeWeights:Zg,fromMemory:o6,fromMemorySync:uv,getLoadHandlers:gT,getModelArtifactsForJSON:J1,getModelArtifactsForJSONSync:Vx,getModelArtifactsInfoForJSON:Uh,getSaveHandlers:Wx,getWeightSpecs:Ux,http:w2,isHTTPScheme:i1,listModels:$T,loadWeights:t6,moveModel:AT,registerLoadRouter:mT,registerSaveRouter:pT,removeModel:ET,weightsLoaderFactory:iv,withSaveHandler:a6,withSaveHandlerSync:u6},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l6(n,t,e){const s=U(n,"labels","confusionMatrix"),r=U(t,"predictions","confusionMatrix");V(e==null||e>0&&Number.isInteger(e),()=>`If provided, numClasses must be a positive integer, but got ${e}`),V(s.rank===1,()=>`Expected the rank of labels to be 1, but got ${s.rank}`),V(r.rank===1,()=>`Expected the rank of predictions to be 1, but got ${r.rank}`),V(s.shape[0]===r.shape[0],()=>`Mismatch in the number of examples: ${s.shape[0]} vs. ${r.shape[0]}. Labels and predictions should have the same number of elements.`),V(e>0&&Number.isInteger(e),()=>`numClasses is required to be a positive integer, but got ${e}`);const i=Va(Kt(s,"int32"),e),o=Va(Kt(r,"int32"),e),a=Ue(i),u=De(a,o);return Kt(u,"int32")}const c6=ot({confusionMatrix_:l6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h6=Object.freeze(Object.defineProperty({__proto__:null,confusionMatrix:c6},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let ga,rb=!1;function lv(n,t=3){if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(n==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let e=!1,s=!1,r=!1,i=!1,o=!1,a=!1;if(n.data instanceof Uint8Array)e=!0;else if(typeof ImageData<"u"&&n instanceof ImageData)s=!0;else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)r=!0;else if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)i=!0;else if(n.getContext!=null)o=!0;else if(typeof ImageBitmap<"u"&&n instanceof ImageBitmap)a=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${n.constructor.name}`);if(kc(af,it.backendName)!=null){const p={pixels:n},m={numChannels:t};return it.runKernel(af,p,m)}const[l,c]=r?[n.videoWidth,n.videoHeight]:[n.width,n.height];let h;if(o)h=n.getContext("2d").getImageData(0,0,l,c).data;else if(s||e)h=n.data;else if(i||r||a){if(ga==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")ga=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else ga=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});ga.canvas.width=l,ga.canvas.height=c,ga.drawImage(n,0,0,l,c),h=ga.getImageData(0,0,l,c).data}let d;if(t===4)d=new Int32Array(h);else{const p=l*c;d=new Int32Array(p*t);for(let m=0;m<p;m++)for(let g=0;g<t;++g)d[m*t+g]=h[m*4+g]}return n2(d,[c,l,t],"int32")}function d6(n){return n!=null&&n.data instanceof Uint8Array}function f6(){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")}function p6(n){return n!=null&&n.width!==0&&n.height!==0}function m6(n){return f6()&&!(n instanceof ImageBitmap)&&p6(n)&&!d6(n)}async function g6(n,t=3){let e=null;if(vt().getBool("WRAP_TO_IMAGEBITMAP")&&m6(n)){let s;try{s=await createImageBitmap(n,{premultiplyAlpha:"none"})}catch{s=null}s!=null&&s.width===n.width&&s.height===n.height?e=s:e=n}else e=n;return lv(e,t)}function cv(n){if(n.rank!==2&&n.rank!==3)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${n.rank}.`);const t=n.rank===2?1:n.shape[2];if(t>4||t===2)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${t}`);if(n.dtype!=="float32"&&n.dtype!=="int32")throw new Error(`Unsupported type for toPixels: ${n.dtype}. Please use float32 or int32 tensors.`)}function y6(n){const t=(n==null?void 0:n.alpha)||1;if(t>1||t<0)throw new Error(`Alpha value ${t} is suppoed to be in range [0 - 1].`)}async function ru(n,t){let e=U(n,"img","toPixels");if(!(n instanceof $e)){const l=e;e=Kt(l,"int32"),l.dispose()}cv(e);const[s,r]=e.shape.slice(0,2),i=e.rank===2?1:e.shape[2],o=await e.data(),a=e.dtype==="float32"?255:1,u=new Uint8ClampedArray(r*s*4);for(let l=0;l<s*r;++l){const c=[0,0,0,255];for(let d=0;d<i;d++){const f=o[l*i+d];if(e.dtype==="float32"){if(f<0||f>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${f}.`)}else if(e.dtype==="int32"&&(f<0||f>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${f}.`);i===1?(c[0]=f*a,c[1]=f*a,c[2]=f*a):c[d]=f*a}const h=l*4;u[h+0]=Math.round(c[0]),u[h+1]=Math.round(c[1]),u[h+2]=Math.round(c[2]),u[h+3]=Math.round(c[3])}if(t!=null){rb||kc(sp,it.backendName)!=null&&(console.warn("tf.browser.toPixels is not efficient to draw tensor on canvas. Please try tf.browser.draw instead."),rb=!0),t.width=r,t.height=s;const l=t.getContext("2d"),c=new ImageData(u,r,s);l.putImageData(c,0,0)}return e!==n&&e.dispose(),u}function b6(n,t,e){let s=U(n,"img","draw");if(!(n instanceof $e)){const o=s;s=Kt(o,"int32"),o.dispose()}cv(s),y6(e==null?void 0:e.imageOptions);const r={image:s},i={canvas:t,options:e};it.runKernel(sp,r,i)}const iu=ot({fromPixels_:lv}),x6=Object.freeze(Object.defineProperty({__proto__:null,draw:b6,fromPixels:iu,fromPixelsAsync:g6,toPixels:ru},Symbol.toStringTag,{value:"Module"}));function Am(n,t){const e=n.shape.length,s=t.shape.length;if(e<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${e}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(t.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.shape[s-1]>e)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${t.shape[s-1]} vs. ${e}`);if(Et(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);const r=t.shape,i=r[r.length-1];let o=1;for(let h=0;h<r.length-1;++h)o*=r[h];const a=n.shape,u=r.slice();u.pop();let l=1;for(let h=i;h<e;++h)l*=a[h],u.push(a[h]);const c=[...ge(n.shape).map(h=>h/l),1].slice(0,i);return[u,o,l,c]}const w6=Object.freeze(Object.defineProperty({__proto__:null,prepareAndValidate:Am},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o1=-2,v6=-1;function k2(n,t,e){const s=n.shape.length;V(s===t.length,()=>`Error in slice${s}D: Length of begin ${t} must match the rank of the array (${s}).`),V(s===e.length,()=>`Error in slice${s}D: Length of size ${e} must match the rank of the array (${s}).`);for(let r=0;r<s;++r)V(t[r]+e[r]<=n.shape[r],()=>`Error in slice${s}D: begin[${r}] + size[${r}] (${t[r]+e[r]}) would overflow input.shape[${r}] (${n.shape[r]})`)}function k6(n){const t=[];let e=0;for(;n>0;)n&1&&t.push(e),n/=2,e++;return t}function S2(n,t,e){const s=[];for(let r=0;r<n.length;r++)s[r]=Math.ceil((t[r]-n[r])/e[r]);return s}function hv(n,t,e,s){const r=[...n];for(let i=r.length;i<s.length;i++)r.push(1);for(let i=0;i<e;i++)i===0?r[t]=1:(r.splice(t,0,1),r.pop());return r}function dv(n,t,e){return e<=n?e:e-(t-1)}function fv(n,t){const e=[];for(let s=0;s<n;s++)e.push(t+s);return e}function S6(n,t,e,s,r,i,o,a,u){const l=n.length;let c=new Array(l),h=new Array(l),d=new Array(l);if(t.length&&e>0){const f=t[0],p=e+1;c=pv(o,f,p,s,n),h=mv(a,f,p,r,n),d=hv(i,f,p,n)}else for(let f=0;f<l;f++)c[f]=yv(o,s,i,n,f,u),h[f]=bv(a,r,i,n,f,u),d[f]=gv(i,f,u);return{begin:c,end:h,strides:d}}function pv(n,t,e,s,r){const i=[...r],o=fv(e,t);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=0;else{const u=dv(t,e,a);let l=s[u];n&1<<u&&(l=0),i[a]=l}return i}function mv(n,t,e,s,r){const i=[...r],o=fv(e,t);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=Number.MAX_SAFE_INTEGER;else{const u=dv(t,e,a);let l=s[u];n&1<<u&&(l=Number.MAX_SAFE_INTEGER),i[a]=l}for(let a=0;a<i.length;a++){const u=r[a];i[a]<0&&(i[a]+=u),i[a]=Bo(0,i[a],r[a])}return i}function gv(n,t,e){let s=n[t];return(e&1<<t||s==null)&&(s=1),s}function yv(n,t,e,s,r,i){let o=t[r];const a=e[r]||1;(n&1<<r||i&1<<r||o==null)&&(a>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);const u=s[r];return o<0&&(o+=u),o=Bo(0,o,u-1),o}function bv(n,t,e,s,r,i){let o=t[r];const a=e[r]||1;(n&1<<r||i&1<<r||o==null)&&(a>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);const u=s[r];return o<0&&(o+=u),a>0?o=Bo(0,o,u):o=Bo(-1,o,u-1),o}function I2(n,t,e){let s=e.length;for(let r=0;r<e.length;r++)if(e[r]>1){s=r;break}for(let r=s+1;r<e.length;r++)if(t[r]>0||e[r]!==n[r])return!1;return!0}function C2(n,t){let e=n.length>0?n[n.length-1]:1;for(let s=0;s<n.length-1;s++)e+=n[s]*t[s];return e}function Rm(n,t,e){let s;const r=n.shape.length;typeof t=="number"?s=[t,...new Array(r-1).fill(0)]:t.length<r?s=t.concat(new Array(r-t.length).fill(0)):s=t.slice(),s.forEach(o=>{V(o!==-1,()=>"slice() does not support negative begin indexing.")});let i;return e==null?i=new Array(r).fill(-1):typeof e=="number"?i=[e,...new Array(r-1).fill(-1)]:e.length<r?i=e.concat(new Array(r-e.length).fill(-1)):i=e,i=i.map((o,a)=>o>=0?o:(V(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${a}.`),n.shape[a]-s[a])),[s,i]}function N2(n,t,e,s,r,i,o,a,u){let l;if(s==null?(l=new Array(t.length),l.fill(1)):l=s,o!=null&&o&o-1)throw new Error("Multiple ellipses in slice is not allowed.");let c=!1;const h={dims:l.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:e.slice(),strides:l.slice(),beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:u};for(let w=0;w<h.dims;w++)c&&1<<w&a&&h.numAddAxisAfterEllipsis++,1<<w&o&&(c=!0);c||(h.ellipsisMask|=1<<h.dims,h.dims++);const d={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};I6(h,d);let f=!0,p=!0,m=!0;const g=[],y=[];for(let w=0;w<n.length;++w){if(d.strides[w]===0)throw Error(`strides[${w}] must be non-zero`);const v=!!(d.shrinkAxisMask&1<<w),S=n[w];if(S===-1){g.push(v?1:-1);continue}const N=[d.beginMask&1<<w,d.endMask&1<<w],R=[d.strides[w]>0?0:-1,d.strides[w]>0?S:S-1];if(v&&d.strides[w]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&d.strides[w]===1;const L=!!(d.beginMask&1<<w&&d.endMask&1<<w);if(d.beginValid&&d.endValid){if(v){const z=d.begin[w]<0?S+d.begin[w]:d.begin[w];if(d.begin[w]=z,d.end[w]=d.begin[w]+1,z<0||z>=S)throw Error(`slice index ${d.begin[w]} of dimension ${w} out of bounds.`)}else d.begin[w]=ib(d.begin[w],0,d.strides[w],S,N,R),d.end[w]=ib(d.end[w],1,d.strides[w],S,N,R);const H=d.strides[w]===1&&d.begin[w]===0&&d.end[w]===S;f=f&&H,p=p&&(w===0&&d.strides[w]===1||H)}else f=f&&d.strides[w]===1&&L,p=p&&(w===0&&d.strides[w]===1||L);let F,B=!1;if(d.beginValid&&d.endValid?(F=d.end[w]-d.begin[w],B=!0):v?(F=1,B=!0):L&&S>=0&&(d.strides[w]<0?F=-S:F=S,B=!0),B){let H;F===0||F<0!=d.strides[w]<0?H=0:H=Math.trunc(F/d.strides[w])+(F%d.strides[w]!==0?1:0),g.push(H)}else g.push(-1)}for(let w=0;w<d.finalShapeGatherIndices.length;++w){const v=d.finalShapeGatherIndices[w];v>=0?y.push(g[v]):v===o1&&y.push(1)}return{finalShapeSparse:y.filter((w,v)=>d.finalShapeGatherIndices[v]!==o1),finalShape:y,isIdentity:f,sliceDim0:p,isSimpleSlice:m,begin:d.begin,end:d.end,strides:d.strides}}function I6(n,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;let e=0;t.beginValid=n.begin!=null,t.endValid=n.end!=null,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(let s=0;s<n.dims;s++)if(1<<s&n.ellipsisMask){const r=Math.min(t.dims-(n.dims-s)+1+n.numAddAxisAfterEllipsis,t.dims);for(;e<r;e++)t.begin[e]=0,t.end[e]=0,t.strides[e]=1,t.beginMask|=1<<e,t.endMask|=1<<e,t.finalShapeGatherIndices.push(e),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[e]=s}else if(1<<s&n.newAxisMask)t.finalShapeGatherIndices.push(o1),t.finalShapeGatherIndicesSparse.push(-1);else{if(e===t.begin.length)throw Error(`Index out of range using input dim ${e}; input has only ${t.dims} dims, ${t.begin.length}.`);n.begin!=null&&(t.begin[e]=n.begin[s]),n.end!=null&&(t.end[e]=n.end[s]),t.strides[e]=n.strides[s],n.beginMask&1<<s&&(t.beginMask|=1<<e),n.endMask&1<<s&&(t.endMask|=1<<e),n.shrinkAxisMask&1<<s?(t.finalShapeGatherIndices.push(v6),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<e):(t.finalShapeGatherIndices.push(e),t.finalShapeGatherIndicesSparse.push(s)),t.inputShapeGatherIndicesSparse[e]=s,e++}}function ib(n,t,e,s,r,i){if(r[t])return e>0?i[t]:i[t+1&1];{const o=n<0?s+n:n;return o<i[0]?i[0]:o>i[1]?i[1]:o}}const xv=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:k2,computeFlatOffset:C2,computeOutShape:S2,getNormalizedAxes:S6,isSliceContinous:I2,maskToAxes:k6,parseSliceParams:Rm,sliceInfo:N2,startForAxis:yv,startIndicesWithElidedDims:pv,stopForAxis:bv,stopIndicesWithElidedDims:mv,stridesForAxis:gv,stridesWithElidedDims:hv},Symbol.toStringTag,{value:"Module"}));/** @license See the LICENSE file. */const C6="4.8.0";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wv{static sgd(t){return new _m(t)}static momentum(t,e,s=!1){return new y2(t,e,s)}static rmsprop(t,e=.9,s=0,r=null,i=!1){return new b2(t,e,s,r,i)}static adam(t=.001,e=.9,s=.999,r=null){return new m2(t,e,s,r)}static adadelta(t=.001,e=.95,s=null){return new f2(t,e,s)}static adamax(t=.002,e=.9,s=.999,r=null,i=0){return new g2(t,e,s,r,i)}static adagrad(t,e=.1){return new p2(t,e)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const va=wv;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N6=(()=>typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n())();function T2(){return new Promise(n=>N6(()=>n()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $2(n,t){const e=n[0].length;n.forEach((r,i)=>{V(r.length===e,()=>`Error in concat${e}D: rank of tensors[${i}] must be the same as the rank of the rest (${e})`)}),V(t>=0&&t<e,()=>`Error in concat${e}D: axis must be between 0 and ${e-1}.`);const s=n[0];n.forEach((r,i)=>{for(let o=0;o<e;o++)V(o===t||r[o]===s[o],()=>`Error in concat${e}D: Shape of tensors[${i}] (${r}) does not match the shape of the rest (${s}) along the non-concatenated axis ${i}.`)})}function Oi(n,t){const e=n[0].slice();for(let s=1;s<n.length;s++)e[t]+=n[s][t];return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ni;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(ni||(ni={}));function vv(n,t,e){let s=new Array;if(e==null&&t==null)return s;if(t==null)for(;s.length<n+e.length;)s.push(-1);else s=t.slice();if(e==null)return s;if(n+e.length!==s.length)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.rank = ${n+e.length}, but shape.rank = ${s.length}`);for(let r=1;r<e.length;++r){const i=e[r],o=s[s.length-e.length+r],a=s[o];if(i>=0)if(a>=0){if(a!==i)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.shape[${r+n}] = ${i} but shape[${r+n}] = ${a}`)}else s[o]=i}return s}function kv(n){const t={FIRST_DIM_SIZE:ni.FIRST_DIM_SIZE,VALUE_ROWIDS:ni.VALUE_ROWIDS,ROW_LENGTHS:ni.ROW_LENGTHS,ROW_SPLITS:ni.ROW_SPLITS,ROW_LIMITS:ni.ROW_LIMITS,ROW_STARTS:ni.ROW_STARTS},e=[];for(const s of n)if(s in t)e.push(t[s]);else break;return e}function Sv(n){return n.length===0?0:n[0]===ni.FIRST_DIM_SIZE?n.length-1:n.length}function Iv(n,t){if(n==null||t==null)return;const e=n.length,s=t.length;if(e>=s)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${t}, are incompatible: defaultValue.rank = ${e} must be less than ragged tensor input flatValues.rank = ${s})`);for(let r=0;r<Math.min(e,s-1);++r){const i=n[r],o=t[r+1];if(i>=0&&o>=0&&i!==1&&i!==o)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${t} are incompatible: defaultValue.shape[${r-n.length}] = ${i} but ragged tensor input.flatValues.shape[${r-n.length}] = ${o}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E2=30;function Dm(n){return n<=E2?n:sf(n,Math.floor(Math.sqrt(n)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _2(n,t,e){const s=e*(typeof n=="number"?n:n[0]),r=t*(typeof n=="number"?n:n[1]);return[s,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function od(n,t,e,s=!0){let r=[];if(s)r=r.concat(t.slice(0)),r.push(n[0]/e),r=r.concat(n.slice(1));else{r=r.concat(n[0]);const i=t.length;for(let o=0;o<i;++o)r=r.concat([n[o+1]/t[o],t[o]]);r=r.concat(n.slice(i+1))}return r}function ad(n,t,e=!0){const s=[];if(e){s.push(t);for(let r=t+1;r<n;++r)r<=2*t?(s.push(r),s.push(r-(t+1))):s.push(r)}else{const r=[],i=[];for(let o=1;o<n;++o)o>=t*2+1||o%2===1?i.push(o):r.push(o);s.push(...r),s.push(0),s.push(...i)}return s}function ud(n,t,e,s=!0){const r=[];s?r.push(n[0]/e):r.push(n[0]*e);for(let i=1;i<n.length;++i)i<=t.length?s?r.push(t[i-1]*n[i]):r.push(n[i]/t[i-1]):r.push(n[i]);return r}function A2(n,t){const e=[0];for(let s=0;s<t;++s)e.push(n[s][0]);return e}function R2(n,t,e){const s=n.slice(0,1);for(let r=0;r<e;++r)s.push(n[r+1]-t[r][0]-t[r][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Om=1.7580993408473768,Fm=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D2=.3275911,O2=.254829592,F2=-.284496736,L2=1.421413741,P2=-1.453152027,M2=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ao(n,t){if(n.length!==t.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${t.length}.`);const e=new Float32Array(n.length*2);for(let s=0;s<e.length;s+=2)e[s]=n[s/2],e[s+1]=t[s/2];return e}function Cv(n){const t=new Float32Array(n.length/2),e=new Float32Array(n.length/2);for(let s=0;s<n.length;s+=2)t[s/2]=n[s],e[s/2]=n[s+1];return{real:t,imag:e}}function Nv(n){const t=Math.ceil(n.length/4),e=new Float32Array(t),s=new Float32Array(t);for(let r=0;r<n.length;r+=4)e[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:e,imag:s}}function Tv(n){const t=Math.floor(n.length/4),e=new Float32Array(t),s=new Float32Array(t);for(let r=2;r<n.length;r+=4)e[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:e,imag:s}}function z2(n,t){const e=n[t*2],s=n[t*2+1];return{real:e,imag:s}}function $v(n,t,e,s){n[s*2]=t,n[s*2+1]=e}function Ev(n,t){const e=new Float32Array(n/2),s=new Float32Array(n/2);for(let r=0;r<Math.ceil(n/2);r++){const i=(t?2:-2)*Math.PI*(r/n);e[r]=Math.cos(i),s[r]=Math.sin(i)}return{real:e,imag:s}}function _v(n,t,e){const s=(e?2:-2)*Math.PI*(n/t),r=Math.cos(s),i=Math.sin(s);return{real:r,imag:i}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cg="->",T6=/->/g,ob=",",ab="...";function B2(n,t){n=n.replace(/\s/g,"");const e=(n.length-n.replace(T6,"").length)/cg.length;if(e<1)throw new Error("Equations without an arrow are not supported.");if(e>1)throw new Error(`Equation must contain exactly one arrow ("${cg}").`);const[s,r]=n.split(cg);V(s.indexOf(ab)===-1,()=>`The ellipsis notation ("${ab}") is not supported yet.`);const i=s.split(ob),o=i.length;if(t!==o)throw new Error(`Expected ${o} input tensors, received ${t}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let d=0;d<r.length;++d){const f=r[d];if(!i.some(p=>p.indexOf(f)!==-1))throw new Error(`Output subscripts contain the label ${f} not present in the input subscripts.`);a.indexOf(f)===-1&&a.push(f)}for(let d=0;d<s.length;++d){const f=s[d];a.indexOf(f)===-1&&f!==ob&&a.push(f)}const u=new Array(i.length);for(let d=0;d<o;++d){if(new Set(i[d].split("")).size!==i[d].length)throw new Error(`Found duplicate axes in input component ${i[d]}. Support for duplicate axes in input is not implemented yet.`);u[d]=[];for(let f=0;f<i[d].length;++f)u[d].push(a.indexOf(i[d][f]))}const l=a.length,c=r.length,h=[];for(let d=c;d<l;++d)h.push(d);return{allDims:a,summedDims:h,idDims:u}}function V2(n,t){let e=new Array(n);e.fill(-1);for(let r=0;r<t.length;++r)e[t[r]]=r;const s=[];for(let r=0;r<n;++r)e[r]===-1&&s.push(r);return e=e.filter(r=>r!==-1),{permutationIndices:e,expandDims:s}}function U2(n,t,e){const s=new Array(n);for(let r=0;r<e.length;++r){const i=e[r].shape;for(let o=0;o<t[r].length;++o)s[t[r][o]]===void 0?s[t[r][o]]=i[o]:V(s[t[r][o]]===i[o],()=>`Expected dimension ${s[t[r][o]]} at axis ${o} of input shaped ${JSON.stringify(i)}, but got dimension ${i[o]}`)}}function W2(n,t){const e=n,s=[];let r=0;n.length===0&&e.push(-1),r=n.length+1;for(let o=0;o<r;++o)s.push([]);const i=[];for(let o=0;o<e.length;++o){const a=e[o],u=$6(t,a);for(const l of u)i.indexOf(l)===-1&&(s[o].push(l),i.push(l))}return{path:e,steps:s}}function G2(n){return n.every((t,e)=>t===e)}function $6(n,t){const e=[];for(let s=0;s<n.length;++s)(n[s].length===0||n[s].indexOf(t)!==-1||t===-1)&&e.push(s);return e}function j2(n,t,e=0){let s=[];if(typeof t=="number")V(n.shape[e]%t===0,()=>"Number of splits must evenly divide the axis."),s=new Array(t).fill(n.shape[e]/t);else{const r=t.reduce((o,a)=>(a===-1&&(o+=1),o),0);V(r<=1,()=>"There should be only one negative value in split array.");const i=t.indexOf(-1);if(i!==-1){const o=t.reduce((a,u)=>u>0?a+u:a);t[i]=n.shape[e]-o}V(n.shape[e]===t.reduce((o,a)=>o+a),()=>"The sum of sizes must match the size of the axis dimension."),s=t}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Av(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function Rv(n,t){return`indices(${n}, 0) is invalid: ${t} < 0`}function Dv(n,t,e){return`indices(${n}, 0) is invalid: ${t} >= ${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ov(n,t){return`only one output dimension may be -1, not both ${n} and ${t}`}function Fv(n,t){return`size ${n} must be non-negative, not ${t}`}function Lv(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function Pv(n,t){const e=Et(n),s=Et(t);return`Input to reshape is a SparseTensor with ${e}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${n} outputShape= ${t}`}function Mv(n,t){const e=Et(n),s=Et(t);return`Input to reshape is a tensor with ${e} dense values, but the requested shape has ${s}. inputShape=${n} outputShape=${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a1(){return"segment ids must be >= 0"}function zv(){return"segment ids are not increasing"}function Bv(n,t){return`Segment id ${n} out of range [0, ${t}), possibly because segmentIds input is not sorted.`}function Vv(n,t,e){return`Bad: indices[${n}] == ${t} out of range [0, ${e})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uv(n,t){let e=!1,s;for(n<=E2?(s=n,e=!0):s=sf(n,Math.floor(Math.sqrt(n)));!e;)s>t||s===n?e=!0:s=sf(n,s+1);return s}function Wv(n,t,e){const s=[],r=n.length;for(let i=0;i<r;i++)i!==t?s.push(n[i]):s.push(e);return s}function H2(n,t,e,s){const r=t.shape.length,i=n.shape.length;if(s!==0&&(s<-r||s>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${s}`);if(s<0&&(s+=r),s>i)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${i}).`);if(e<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${e}).`);for(let h=0;h<s;++h)if(n.shape[h]!==t.shape[h])throw new Error(`x.shape[${h}]: ${n.shape[h]} should be equal to indices.shape[${h}]: ${t.shape[h]}.`);const o=n.shape[e],a=[];let u=1,l=1,c=1;for(let h=0;h<s;++h)a.push(n.shape[h]),u*=n.shape[h];for(let h=s;h<e;h++)a.push(n.shape[h]),l*=n.shape[h];for(let h=s;h<r;h++)a.push(t.shape[h]);for(let h=e+1;h<i;h++)a.push(n.shape[h]),c*=n.shape[h];return{batchSize:u,sliceSize:c,outerSize:l,dimSize:o,outputShape:a}}const E6=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:H2,computeOutShape:Wv,segOpComputeOptimalWindowSize:Uv},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uo(n){try{return n.map(t=>no(t))}catch(t){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${t}`)}}function Gv(n){return n.map(t=>Ai(t))}const jv=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:O2,ERF_A2:F2,ERF_A3:L2,ERF_A4:P2,ERF_A5:M2,ERF_P:D2,PARALLELIZE_THRESHOLD:E2,get RowPartitionType(){return ni},SELU_SCALE:Fm,SELU_SCALEALPHA:Om,applyActivation:Cm,assertAndGetBroadcastShape:Ee,assertAxesAreInnerMostDims:fs,assertParamsConsistent:$2,assignToTypedArray:$v,axesAreInnerMostDims:E0,calculateShapes:ra,checkEinsumDimSizes:U2,checkPadOnDimRoundingMode:Ps,combineLocations:ow,combineRaggedTensorToTensorShapes:vv,complexWithEvenIndex:Nv,complexWithOddIndex:Tv,computeConv2DInfo:rs,computeConv3DInfo:ta,computeDefaultPad:c0,computeDilation2DInfo:Wh,computeOptimalWindowSize:Dm,computeOutAndReduceShapes:is,computeOutShape:Oi,computePool2DInfo:jr,computePool3DInfo:po,convertConv2DDataFormat:mo,decodeEinsumEquation:B2,eitherStridesOrDilationsAreOne:ds,expandShapeToKeepDim:An,exponent:_v,exponents:Ev,fromStringArrayToUint8:Gv,fromUint8ToStringArray:uo,getAxesPermutation:Tn,getBroadcastDims:za,getComplexWithIndex:z2,getEinsumComputePath:W2,getEinsumPermutation:V2,getFusedBiasGradient:Im,getFusedDyActivation:Sm,getImageCenter:_2,getInnerMostAxes:Rn,getPermuted:ad,getRaggedRank:Sv,getReductionAxes:Un,getReshaped:od,getReshapedPermuted:ud,getRowPartitionTypesHelper:kv,getSliceBeginCoords:A2,getSliceSize:R2,getSparseFillEmptyRowsIndicesDenseShapeMismatch:Av,getSparseFillEmptyRowsNegativeIndexErrorMessage:Rv,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:Dv,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:Lv,getSparseReshapeInputOutputMismatchErrorMessage:Mv,getSparseReshapeInputOutputMultipleErrorMessage:Pv,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:Ov,getSparseReshapeNegativeOutputDimErrorMessage:Fv,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:Vv,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:a1,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:zv,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:Bv,getUndoAxesPermutation:ea,isIdentityPermutation:G2,log:$N,mergeRealAndImagArrays:ao,prepareAndValidate:Am,prepareSplitSize:j2,segment_util:E6,shouldFuse:Nm,slice_util:xv,splitRealAndImagArrays:Cv,stridesOrDilationsArePositive:Pa,tupleValuesAreOne:Go,upcastType:qs,validateDefaultValueShape:Iv,validateInput:bm,validateUpdateShape:s2,warn:wr},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _6=Object.freeze(Object.defineProperty({__proto__:null,nonMaxSuppressionV3Impl:Tm,nonMaxSuppressionV4Impl:$m,nonMaxSuppressionV5Impl:Em,whereImpl:vm},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H5();const Hv=Object.freeze(Object.defineProperty({__proto__:null,Abs:Mc,Acos:Wu,Acosh:Gu,AdadeltaOptimizer:f2,AdagradOptimizer:p2,AdamOptimizer:m2,AdamaxOptimizer:g2,Add:Za,AddN:zc,All:Bf,Any:Vf,ArgMax:Bc,ArgMin:Vc,Asin:ju,Asinh:Hu,Atan:Ku,Atan2:Xu,Atanh:qu,AvgPool:Uc,AvgPool3D:Wc,AvgPool3DGrad:Wf,AvgPoolGrad:Uf,BatchMatMul:Gc,BatchToSpaceND:jc,Bincount:Gf,BitwiseAnd:Hc,BroadcastArgs:jf,BroadcastTo:bx,Cast:Yu,Ceil:Zu,ClipByValue:Ju,Complex:Hf,ComplexAbs:Kc,Concat:qc,Conv2D:Xc,Conv2DBackpropFilter:Kf,Conv2DBackpropInput:Yc,Conv3D:Zc,Conv3DBackpropFilterV2:qf,Conv3DBackpropInputV2:Xf,Cos:Qu,Cosh:tl,CropAndResize:Zf,Cumprod:Yf,Cumsum:Jc,DataStorage:M1,DenseBincount:Jf,DepthToSpace:Qf,DepthwiseConv2dNative:Qc,DepthwiseConv2dNativeBackpropFilter:tp,DepthwiseConv2dNativeBackpropInput:ep,Diag:np,Dilation2D:th,Dilation2DBackpropFilter:of,Dilation2DBackpropInput:rf,Draw:sp,get ENV(){return W1},Einsum:rp,Elu:nl,EluGrad:ip,Environment:gx,Equal:eh,Erf:sl,Exp:rl,ExpandDims:nh,Expm1:il,FFT:op,Fill:ap,FlipLeftRight:up,Floor:ol,FloorDiv:al,FromPixels:af,FusedBatchNorm:sh,FusedConv2D:xc,FusedDepthwiseConv2D:wc,GatherNd:lp,GatherV2:rh,Greater:ih,GreaterEqual:ul,IFFT:cp,Identity:ll,Imag:hp,IsFinite:cl,IsInf:hl,IsNan:dl,KernelBackend:Pf,LRN:dh,LRNGrad:fp,LeakyRelu:oh,Less:ah,LessEqual:uh,LinSpace:dp,Log:fl,Log1p:pl,LogSoftmax:xx,LogicalAnd:lh,LogicalNot:ch,LogicalOr:hh,LogicalXor:SN,LowerBound:IN,MatrixBandPart:CN,Max:fh,MaxPool:ph,MaxPool3D:mh,MaxPool3DGrad:mp,MaxPoolGrad:pp,MaxPoolWithArgmax:gp,Maximum:ml,Mean:gh,Min:yh,Minimum:gl,MirrorPad:bh,Mod:yl,MomentumOptimizer:y2,Multinomial:yp,Multiply:bl,Neg:xh,NonMaxSuppressionV3:bp,NonMaxSuppressionV4:xp,NonMaxSuppressionV5:wp,NotEqual:wh,OP_SCOPE_SUFFIX:Y1,OneHot:kh,OnesLike:vh,Optimizer:bo,OptimizerConstructors:wv,Pack:Sh,PadV2:Ih,Pool:NN,Pow:xl,Prelu:Ch,Prod:Nh,RMSPropOptimizer:b2,RaggedGather:vp,RaggedRange:kp,RaggedTensorToTensor:Sp,Range:Ip,get Rank(){return Gg},Real:Cp,RealDiv:el,Reciprocal:wl,get Reduction(){return As},Relu:vl,Relu6:kl,Reshape:Th,ResizeBilinear:Eh,ResizeBilinearGrad:Tp,ResizeNearestNeighbor:$h,ResizeNearestNeighborGrad:Np,Reverse:_h,RotateWithOffset:Gp,Round:Sl,Rsqrt:Il,SGDOptimizer:_m,ScatterNd:$p,SearchSorted:_p,Select:Ah,Selu:Cl,Sigmoid:El,Sign:$l,Sin:Nl,Sinh:Tl,Slice:Rh,Softmax:Lh,Softplus:_l,SpaceToBatchND:Oh,SparseFillEmptyRows:Ap,SparseReshape:Rp,SparseSegmentMean:Dp,SparseSegmentSum:Op,SparseToDense:Fp,SplitV:Fh,Sqrt:Al,Square:Lp,SquaredDifference:Rl,StaticRegexReplace:Ph,Step:Pl,StridedSlice:Pp,StringNGrams:Mp,StringSplit:zp,StringToHashBucketFast:Bp,Sub:Dl,Sum:Dh,Tan:Ol,Tanh:Fl,Tensor:$e,TensorBuffer:Vn,TensorScatterUpdate:Ep,Tile:Ll,TopK:Vp,Transform:Up,Transpose:_a,Unique:Wp,Unpack:Mh,UnsortedSegmentSum:zh,UpperBound:TN,Variable:Sc,ZerosLike:Bh,_FusedMatMul:bc,abs:Pn,acos:n0,acosh:s0,add:Lt,addN:Jx,all:qp,any:Cc,argMax:Wo,argMin:r0,asin:i0,asinh:o0,atan:a0,atan2:u0,atanh:l0,avgPool:Gh,avgPool3d:h0,backend:e0,backend_util:jv,basicLSTMCell:Qx,batchNorm:Ml,batchNorm2d:d0,batchNorm3d:f0,batchNorm4d:p0,batchToSpaceND:jh,bincount:m0,bitwiseAnd:tw,booleanMaskAsync:zw,broadcastArgs:ew,broadcastTo:Aa,broadcast_util:iE,browser:x6,buffer:Fe,cast:Kt,ceil:g0,clipByValue:Os,clone:Ri,complex:so,concat:Cn,concat1d:y0,concat2d:b0,concat3d:x0,concat4d:w0,conv1d:Xp,conv2d:ro,conv2dTranspose:Yp,conv3d:k0,conv3dTranspose:S0,copyRegisteredKernels:AN,cos:Hh,cosh:Zp,cosineWindow:km,cumprod:$c,cumsum:Jp,customGrad:zi,denseBincount:df,deprecationWarn:VT,depthToSpace:I0,depthwiseConv2d:zl,device_util:rT,diag:sw,dilation2d:C0,disableDeprecationWarnings:BT,dispose:Se,disposeVariables:UT,div:ie,divNoNan:N0,dot:T0,dropout:u2,einsum:rw,elu:Bl,enableDebugMode:zT,enableProdMode:MT,enclosingPowerOfTwo:l2,engine:xr,ensureShape:iw,env:vt,equal:ar,erf:$0,euclideanNorm:_0,exp:Fs,expandDims:gn,expm1:A0,eye:Qp,fft:rd,fill:Qa,findBackend:qT,findBackendFactory:XT,floor:Ul,floorDiv:Kp,fused:qw,gather:Wl,gatherND:Ww,gather_util:w6,getBackend:Zx,getGradient:Vg,getKernel:kc,getKernelsForBackend:uf,grad:UE,grads:WE,greater:Ms,greaterEqual:go,ifft:Lu,imag:Kh,image:Bn,inTopKAsync:Gw,io:v2,irfft:gm,isFinite:R0,isInf:D0,isNaN:O0,keep:es,kernel_impls:_6,leakyRelu:qh,less:Du,lessEqual:na,linalg:d2,linspace:uw,localResponseNormalization:F0,log:ur,log1p:Xh,logSigmoid:L0,logSoftmax:em,logSumExp:nm,logicalAnd:ai,logicalNot:Yh,logicalOr:sm,logicalXor:P0,losses:ev,lowerBound:cw,matMul:De,math:h6,max:Nr,maxPool:Zh,maxPool3d:M0,maxPoolWithArgmax:hw,maximum:Vi,mean:wn,memory:hf,meshgrid:dw,min:Ru,minimum:jo,mirrorPad:im,mod:z0,moments:Jh,movingAverage:Bw,mul:ut,multiRNNCell:fw,multinomial:pw,neg:dn,nextFrame:T2,norm:Vl,notEqual:Ba,oneHot:Va,ones:or,onesLike:lr,op:ot,outerProduct:mw,pad:Ui,pad1d:gw,pad2d:yw,pad3d:B0,pad4d:bw,pool:V0,pow:io,prelu:td,print:Q1,prod:U0,profile:WT,raggedGather:xw,raggedRange:ww,raggedTensorToTensor:vw,rand:kw,randomGamma:Nw,randomNormal:am,randomStandardNormal:Tw,randomUniform:sa,randomUniformInt:$w,range:oo,ready:HT,real:Ou,reciprocal:J0,registerBackend:t0,registerGradient:wx,registerKernel:jp,relu:fi,relu6:um,removeBackend:KT,reshape:ct,reverse:Tr,reverse1d:Ew,reverse2d:_w,reverse3d:Aw,reverse4d:Rw,rfft:id,round:lm,rsqrt:cm,scalar:fe,scatterND:Vw,scatter_util:jA,searchSorted:rm,selu:hm,separableConv2d:dm,serialization:G5,setBackend:jT,setPlatform:YT,setdiff1dAsync:Dw,sigmoid:Hs,sign:Q0,signal:tv,sin:fm,sinh:pm,slice:xe,slice1d:ed,slice2d:mm,slice3d:nd,slice4d:Fu,slice_util:xv,softmax:sd,softplus:tu,spaceToBatchND:Qh,sparse:nv,sparseToDense:Uw,spectral:Qw,split:Ks,sqrt:cs,square:an,squaredDifference:ym,squeeze:tn,stack:cr,step:nu,stridedSlice:t2,string:sv,sub:oe,sum:he,sumOutType:Hp,tan:e2,tanh:Ma,tensor:Cr,tensor1d:zn,tensor2d:Di,tensor3d:n2,tensor4d:Ow,tensor5d:Fw,tensor6d:Lw,tensorScatterUpdate:Pw,tensor_util:QN,test_util:rA,tidy:pt,tile:kr,time:GT,topk:r2,train:va,transpose:Ue,truncatedNormal:xm,unique:i2,unregisterGradient:_N,unregisterKernel:EN,unsortedSegmentSum:wm,unstack:$r,upcastType:qs,upperBound:Mw,util:BN,valueAndGrad:GE,valueAndGrads:jE,variable:o2,variableGrads:lw,version_core:C6,where:us,whereAsync:a2,zeros:Mn,zerosLike:je},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sa={},Ed={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function A6(n,t){Sa[n]=t}function ui(n,t){if(!(n in Sa)||t!=null){const s=D6(n,t);if(s!==null)Sa[n]=s;else return console.log("Could not get context for WebGL version",n),null}const e=Sa[n];return e==null||e.isContextLost()?(delete Sa[n],ui(n)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),Sa[n])}function R6(n){if(!vt().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function D6(n,t){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const e=t??R6(n);return e.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete Sa[n]},!1),vt().getBool("SOFTWARE_WEBGL_ENABLED")&&(Ed.failIfMajorPerformanceCaveat=!1),n===1?e.getContext("webgl",Ed)||e.getContext("experimental-webgl",Ed):e.getContext("webgl2",Ed)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Ec;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(Ec||(Ec={}));var Sr;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(Sr||(Sr={}));var as;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(as||(as={}));function ld(n,t){return[t,n]}function O6(n,t){return n*t}function _d(n){const t=Et(n),e=Math.ceil(t/4);return ef(e)}function jl(n,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(n/2))]}function F6(n,t){const[e,s]=jl(n,t);return e*s*4}function K2(n,t){const e=n;let s,r,i,o,a,u,l,c,h,d;return vt().getNumber("WEBGL_VERSION")===2?(s=e.R32F,r=e.R16F,i=e.RGBA16F,o=e.RGBA32F,a=e.RED,l=4,c=1,h=e.HALF_FLOAT,d=e.FLOAT,u=e.RGBA8):(s=n.RGBA,r=n.RGBA,i=n.RGBA,o=e.RGBA,a=n.RGBA,l=4,c=4,h=t!=null?t.HALF_FLOAT_OES:null,d=n.FLOAT,u=n.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:u,downloadUnpackNumChannels:l,defaultNumChannels:c,textureTypeHalfFloat:h,textureTypeFloat:d}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function re(n,t){const e=t();return vt().getBool("DEBUG")&&L6(n),e}function L6(n){const t=n.getError();if(t!==n.NO_ERROR)throw new Error("WebGL Error: "+B6(n,t))}const P6=596e-10,M6=65504;function z6(n){return!!(vt().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||P6<Math.abs(n)&&Math.abs(n)<M6)}function B6(n,t){switch(t){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${t}`}}function Ad(n,t){return xo(n,()=>n.getExtension(t),'Extension "'+t+'" not supported on this browser.')}function V6(n,t){const e=xo(n,()=>n.createShader(n.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(re(n,()=>n.shaderSource(e,t)),re(n,()=>n.compileShader(e)),n.getShaderParameter(e,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(e)),new Error("Failed to compile vertex shader.");return e}function U6(n,t){const e=xo(n,()=>n.createShader(n.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(re(n,()=>n.shaderSource(e,t)),re(n,()=>n.compileShader(e)),vt().get("ENGINE_COMPILE_ONLY"))return e;if(n.getShaderParameter(e,n.COMPILE_STATUS)===!1)throw Kv(t,n.getShaderInfoLog(e)),new Error("Failed to compile fragment shader.");return e}const W6=/ERROR: [0-9]+:([0-9]+):/g;function Kv(n,t){const e=W6.exec(t);if(e==null){console.log(`Couldn't parse line number in error: ${t}`),console.log(n);return}const s=+e[1],r=n.split(`
`),i=r.length.toString().length+2,o=r.map((h,d)=>Ea((d+1).toString(),i)+h);let a=0;for(let h=0;h<o.length;h++)a=Math.max(o[h].length,a);const u=o.slice(0,s-1),l=o.slice(s-1,s),c=o.slice(s);console.log(u.join(`
`)),console.log(t.split(`
`)[0]),console.log(`%c ${Ea(l[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(c.join(`
`))}function G6(n){return xo(n,()=>n.createProgram(),"Unable to create WebGLProgram.")}function j6(n,t){if(re(n,()=>n.linkProgram(t)),!vt().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(t,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function hg(n,t){if(re(n,()=>n.validateProgram(t)),n.getProgramParameter(t,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function H6(n,t){const e=xo(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return re(n,()=>n.bindBuffer(n.ARRAY_BUFFER,e)),re(n,()=>n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW)),e}function K6(n,t){const e=xo(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return re(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e)),re(n,()=>n.bufferData(n.ELEMENT_ARRAY_BUFFER,t,n.STATIC_DRAW)),e}function q6(n){return xo(n,()=>n.createTexture(),"Unable to create WebGLTexture.")}function X6(n,t){const e=vt().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||t<=0){const s=`[${n}x${t}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(n>e||t>e){const s=`[${n}x${t}]`,r=`[${e}x${e}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+r+".")}}function Y6(n){return xo(n,()=>n.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function ub(n,t,e,s,r,i,o){const a=n.getAttribLocation(t,e);return a===-1?!1:(re(n,()=>n.bindBuffer(n.ARRAY_BUFFER,s)),re(n,()=>n.vertexAttribPointer(a,r,n.FLOAT,!1,i,o)),re(n,()=>n.enableVertexAttribArray(a)),!0)}function Z6(n,t,e){nD(n,e),re(n,()=>n.activeTexture(n.TEXTURE0+e)),re(n,()=>n.bindTexture(n.TEXTURE_2D,t))}function J6(n,t,e){return xo(n,()=>n.getUniformLocation(t,e),'uniform "'+e+'" not present in program.')}function Q6(n,t,e){return n.getUniformLocation(t,e)}function tD(n,t,e,s){re(n,()=>Z6(n,t,s)),re(n,()=>n.uniform1i(e,s))}function dg(n,t,e){re(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,e)),re(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0))}function lb(n,t){re(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,t)),re(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0))}function Rd(n){const t=n.checkFramebufferStatus(n.FRAMEBUFFER);if(t!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+eD(n,t))}function eD(n,t){switch(t){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${t}`}}function xo(n,t,e){const s=re(n,()=>t());if(s==null)throw new Error(e);return s}function nD(n,t){const e=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=t+n.TEXTURE0;if(s<n.TEXTURE0||s>e){const r=`[gl.TEXTURE0, gl.TEXTURE${e}]`;throw new Error(`textureUnit must be in ${r}.`)}}function Pu(n,t=2){return Et(n.slice(0,n.length-t))}function Mu(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function Dd(n){let t=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(t=[Pu(n),...Mu(n)]),t}function sD(n,t=!1){let e=vt().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=vt().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&vt().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=e/2),t&&(e=e*2,s=s*2,n=n.map((a,u)=>u>=n.length-2?Mf(n[u]):n[u]),n.length===1&&(n=[2,n[0]])),n.length!==2&&(n=ho(n).newShape);let r=Et(n),i=null;n.length<=1&&r<=e?i=[1,r]:n.length===2&&n[0]<=e&&n[1]<=e?i=n:n.length===3&&n[0]*n[1]<=e&&n[2]<=e?i=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=e&&n[1]*n[2]<=e?i=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=e&&n[3]<=e?i=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=e&&n[1]*n[2]*n[3]<=e&&(i=[n[0],n[1]*n[2]*n[3]]);const o=i!=null&&Math.max(...i)>s&&Math.min(...i)<=(t?2:1)&&Math.min(...i)>0;if(i==null||o)if(t){const a=Pu(n);let u=2,l=2;n.length&&([u,l]=Mu(n)),r=a*(u/2)*(l/2),i=ef(r).map(c=>c*2)}else i=ef(r);return i}function Od(n){return n%2===0}function ff(n,t){if(n=n.slice(-2),t=t.slice(-2),Ve(n,t)||!n.length||!t.length||n[0]===0||n[1]===0||t[0]===0||t[1]===0)return!0;if(n.length!==t.length){const e=n[n.length-1],s=t[t.length-1];if(e===s||Od(e)&&Od(s)&&(n[0]===1||t[0]===1))return!0}return n[1]===t[1]&&Od(n[0])&&Od(t[0])}let fg,pg;function rD(n){if(fg==null){const t=ui(n);fg=t.getParameter(t.MAX_TEXTURE_SIZE)}return fg}function iD(n){if(pg==null){const t=ui(n);pg=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,pg)}function oD(n){if(n===0)return 0;let t;const e=ui(n);return Wr(e,"EXT_disjoint_timer_query_webgl2")&&n===2?t=2:Wr(e,"EXT_disjoint_timer_query")?t=1:t=0,t}function Wr(n,t){return n.getExtension(t)!=null}function cb(n){try{if(ui(n)!=null)return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function aD(n){if(n===0)return!1;const t=ui(n);if(n===1){if(!Wr(t,"OES_texture_float"))return!1}else if(!Wr(t,"EXT_color_buffer_float"))return!1;return u1(t)}function uD(n){if(n===0)return!1;const t=ui(n);if(n===1){if(!Wr(t,"OES_texture_float")||!Wr(t,"WEBGL_color_buffer_float"))return!1}else{if(Wr(t,"EXT_color_buffer_float"))return u1(t);const s="EXT_color_buffer_half_float";if(Wr(t,s)){const r=t.getExtension(s);return lD(t,r)}return!1}return u1(t)}function u1(n){const t=K2(n),e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);const s=1,r=1;n.texImage2D(n.TEXTURE_2D,0,t.internalFormatFloat,s,r,0,t.textureFormatFloat,t.textureTypeFloat,null);const i=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0);const o=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(e),n.deleteFramebuffer(i),o}function lD(n,t){const e=K2(n,t),s=n.createTexture();n.bindTexture(n.TEXTURE_2D,s);const r=1,i=1;n.texImage2D(n.TEXTURE_2D,0,e.internalFormatHalfFloat,r,i,0,e.textureFormatFloat,e.textureTypeHalfFloat,null);const o=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,s,0);const a=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(s),n.deleteFramebuffer(o),a}function cD(n){return n!==2?!1:ui(n).fenceSync!=null}function cd(n,t){Array.isArray(n)||(n=[n]),n.forEach(e=>{e!=null&&V(e.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pe=vt();pe.registerFlag("HAS_WEBGL",()=>pe.getNumber("WEBGL_VERSION")>0);pe.registerFlag("WEBGL_VERSION",()=>cb(2)?2:cb(1)?1:0);pe.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);pe.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>pe.get("WEBGL_VERSION")===2);pe.registerFlag("WEBGL_CPU_FORWARD",()=>!0);pe.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);pe.registerFlag("WEBGL_PACK",()=>pe.getBool("HAS_WEBGL"));pe.registerFlag("WEBGL_PACK_NORMALIZATION",()=>pe.getBool("WEBGL_PACK"));pe.registerFlag("WEBGL_PACK_CLIP",()=>pe.getBool("WEBGL_PACK"));pe.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>pe.getBool("WEBGL_PACK"));pe.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>pe.getBool("WEBGL_PACK"));pe.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>pe.getBool("WEBGL_PACK"));pe.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>pe.getBool("WEBGL_PACK"));pe.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>pe.getBool("WEBGL_PACK"));pe.registerFlag("WEBGL_PACK_REDUCE",()=>pe.getBool("WEBGL_PACK"));pe.registerFlag("WEBGL_LAZILY_UNPACK",()=>pe.getBool("WEBGL_PACK"));pe.registerFlag("WEBGL_CONV_IM2COL",()=>pe.getBool("WEBGL_PACK"));pe.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>rD(pe.getNumber("WEBGL_VERSION")));pe.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>iD(pe.getNumber("WEBGL_VERSION")));pe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const n=pe.getNumber("WEBGL_VERSION");return n===0?0:oD(n)});pe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>pe.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!q1());pe.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>aD(pe.getNumber("WEBGL_VERSION")));pe.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>pe.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:pe.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));pe.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>uD(pe.getNumber("WEBGL_VERSION")));pe.registerFlag("WEBGL_FENCE_API_ENABLED",()=>cD(pe.getNumber("WEBGL_VERSION")));pe.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>pe.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);pe.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,n=>{if(n<0&&n!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${n}.`)});pe.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>q1()?1:-1,n=>{if(n<0&&n!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${n}.`)});pe.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);pe.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);pe.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);pe.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);pe.registerFlag("WEBGL_EXP_CONV",()=>!1);pe.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>pe.getBool("IS_TEST"));pe.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);pe.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);pe.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);pe.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zs(){let n,t,e,s,r,i,o,a,u,l;return vt().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",t="in",e="out",s="in",r="texture",i="outputColor",o="out vec4 outputColor;",a=vt().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",u="",l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",t="attribute",e="varying",s="varying",r="texture2D",i="gl_FragColor",o="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:t,varyingVs:e,varyingFs:s,texture2D:r,output:i,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:u,defineRound:l}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ou(n,t,e="index"){const s=ge(t);return s.map((r,i)=>{const o=`int ${n[i]} = ${e} / ${r}`,a=i===s.length-1?`int ${n[i+1]} = ${e} - ${n[i]} * ${r}`:`index -= ${n[i]} * ${r}`;return`${o}; ${a};`}).join("")}function Lm(n,t,e="index"){const s=ge(t);return s.map((r,i)=>{const o=`int ${n[i]} = ${e} / outShapeStrides[${i}]`,a=i===s.length-1?`int ${n[i+1]} = ${e} - ${n[i]} * outShapeStrides[${i}]`:`index -= ${n[i]} * outShapeStrides[${i}]`;return`${o}; ${a};`}).join("")}function hD(n,t){const e=n.length,s=n.map(i=>`${t}[${i}]`),r=new Array(e-1);r[e-2]=s[e-1];for(let i=e-3;i>=0;--i)r[i]=`(${r[i+1]} * ${s[i+1]})`;return r}function dD(n,t,e="index"){const s=n.map((i,o)=>o),r=hD(s,t);return r.map((i,o)=>{const a=`int ${n[o]} = ${e} / ${r[o]}`,u=o===r.length-1?`int ${n[o+1]} = ${e} - ${n[o]} * ${r[o]}`:`index -= ${n[o]} * ${r[o]}`;return`${a}; ${u};`}).join("")}function q2(n){const t=ge(n).map(e=>e.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${t[0]} + coords.y * ${t[1]} + coords.z;
  }
`}function X2(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const qv=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:Xv}=jv;function fD(n,t,e){const s=[];if(n.forEach(f=>{const p=Et(f.shapeInfo.logicalShape);if(f.shapeInfo.isUniform?s.push(`uniform float ${f.name}${p>1?`[${p}]`:""};`):(s.push(`uniform sampler2D ${f.name};`),s.push(`uniform int offset${f.name};`)),e.enableShapeUniforms){const{uniformShape:m}=Y2(e.packedInputs,f.shapeInfo.logicalShape,f.shapeInfo.texShape);switch(m.length){case 1:s.push(`uniform int ${f.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${f.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${f.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${f.name}Shape;`);break}s.push(`uniform ivec2 ${f.name}TexShape;`)}}),e.enableShapeUniforms){switch(t.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}e.customUniforms&&e.customUniforms.forEach(f=>{s.push(`uniform ${f.type} ${f.name}${f.arrayIndex?`[${f.arrayIndex}]`:""};`)});const r=s.join(`
`),i=n.map(f=>pD(f,t,e.packedInputs,e.enableShapeUniforms)).join(`
`),o=t.texShape,a=zs(),u=yD(a);let l,c,h=wD(a);return t.isPacked?(l=mD(t.logicalShape,o,e.enableShapeUniforms),c=xD(a)):(l=gD(t.logicalShape,o,e.enableShapeUniforms),c=bD(a)),e.packedInputs&&(h+=ID),[h,u,c,r,l,i,e.userCode].join(`
`)}function Hl(n,t=!1){const e=n.shapeInfo.logicalShape;switch(e.length){case 0:return LD(n,t);case 1:return MD(n,t);case 2:return BD(n,t);case 3:return UD(n,t);case 4:return GD(n,t);case 5:return jD(n);case 6:return HD(n);default:throw new Error(`${e.length}-D input sampling is not yet supported`)}}function Yv(n,t){switch(n.shapeInfo.logicalShape.length){case 0:return FD(n);case 1:return PD(n,t);case 2:return zD(n,t);case 3:return VD(n,t);default:return WD(n,t)}}function pD(n,t,e=!1,s){let r="";e?r+=Yv(n,s):r+=Hl(n,s);const i=n.shapeInfo.logicalShape,o=t.logicalShape;return i.length<=o.length&&(e?r+=KD(n,t):r+=qD(n,t)),r}function mD(n,t,e){switch(n.length){case 0:return Zv();case 1:return CD(n,t,e);case 2:return DD(n,t,e);case 3:return TD(n,t,e);default:return ED(n,t,e)}}function gD(n,t,e){switch(n.length){case 0:return Zv();case 1:return ND(n,t,e);case 2:return OD(n,t,e);case 3:return $D(n,t,e);case 4:return _D(n,t,e);case 5:return AD(n,t);case 6:return RD(n,t);default:throw new Error(`${n.length}-D output sampling is not yet supported`)}}function yD(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${n.texture2D}(textureSampler, uv).r;
    }
  `}function bD(n){return`
    void setOutput(float val) {
      ${n.output} = vec4(val, 0, 0, 0);
    }
  `}function xD(n){return`
    void setOutput(vec4 val) {
      ${n.output} = val;
    }
  `}function wD(n){return`${n.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${n.varyingFs} vec2 resultUV;
    ${n.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${n.defineSpecialNaN}
    ${n.defineSpecialInf}
    ${n.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${vD}
    ${kD}
    ${SD}
  `}const vD=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,kD=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,SD=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,ID=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Zv(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function CD(n,t,e){const s=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return s[0]===1?e?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?e?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:e?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function ND(n,t,e){return t[0]===1?e?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${t[1]}.0);
      }
    `:t[1]===1?e?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${t[0]}.0);
      }
    `:e?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      return resTexRC.x * ${t[1]} + resTexRC.y;
    }
  `}function TD(n,t,e){if(e)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(n[2]/2),i=r*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function $D(n,t,e){if(e)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${Lm(["r","c","d"],n)}
    return ivec3(r, c, d);
  }
`;const s=ou(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function ED(n,t,e){if(e)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(n[n.length-1]/2),i=r*Math.ceil(n[n.length-2]/2);let o=i,a="",u="b, r, c";for(let l=2;l<n.length-1;l++)o*=n[n.length-l-1],a=`
      int b${l} = index / ${o};
      index -= b${l} * ${o};
    `+a,u=`b${l}, `+u;return`
    ivec${n.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${a}

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${n.length}(${u});
    }
  `}function _D(n,t,e){if(e)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${Lm(["r","c","d","d2"],n)}
      return ivec4(r, c, d, d2);
    }
  `;const s=ou(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function AD(n,t){const e=ou(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${t[0]},
                             ${t[1]}));

      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${e}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function RD(n,t){const e=ou(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${e}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function DD(n,t,e){const s=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(Ve(n,t))return e?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const r=Math.ceil(n[1]/2);return e?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function OD(n,t,e){return Ve(n,t)?e?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${t[0]}, ${t[1]}));
      }
    `:n[1]===1?e?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?e?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:e?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      int r = index / ${n[1]};
      int c = index - r * ${n[1]};
      return ivec2(r, c);
    }
  `}function au(n){return`offset${n}`}function FD(n){const t=n.name,e="get"+t.charAt(0).toUpperCase()+t.slice(1),s=zs();return`
    vec4 ${e}() {
      return ${s.texture2D}(${t}, halfCR);
    }
  `}function LD(n,t){const e=n.name,s="get"+e.charAt(0).toUpperCase()+e.slice(1);if(n.shapeInfo.isUniform)return`float ${s}() {return ${e};}`;const[r,i]=n.shapeInfo.texShape;if(r===1&&i===1)return`
      float ${s}() {
        return sampleTexture(${e}, halfCR);
      }
    `;const o=au(e);if(t)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${e}TexShape[0], ${e}TexShape[1], ${o});
      return sampleTexture(${e}, uv);
    }
  `;const[a,u]=n.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${a}, ${u}, ${o});
      return sampleTexture(${e}, uv);
    }
  `}function PD(n,t){const e=n.name,s="get"+e.charAt(0).toUpperCase()+e.slice(1),r=n.shapeInfo.texShape,i=zs();if(t)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${e}TexShape[0]) / 2.0), ceil(float(${e}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${i.texture2D}(${e}, uv);
    }
  `;const o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${i.texture2D}(${e}, uv);
    }
  `}function MD(n,t){const e=n.name,s="get"+e.charAt(0).toUpperCase()+e.slice(1);if(n.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${Kl(n)}
      }
    `;const r=n.shapeInfo.texShape,i=r[0],o=r[1];if(o===1&&i===1)return`
      float ${s}(int index) {
        return sampleTexture(${e}, halfCR);
      }
    `;const a=au(e);return o===1?t?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${e}TexShape[0]));
        return sampleTexture(${e}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${i}.0);
        return sampleTexture(${e}, uv);
      }
    `:i===1?t?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${e}TexShape[1]), 0.5);
        return sampleTexture(${e}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${o}.0, 0.5);
        return sampleTexture(${e}, uv);
      }
    `:t?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${e}TexShape[0], ${e}TexShape[1], index + ${a});
      return sampleTexture(${e}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${i}, ${o}, index + ${a});
      return sampleTexture(${e}, uv);
    }
  `}function zD(n,t){const e=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n.shapeInfo.texShape,o=i[0],a=i[1],u=zs();if(i!=null&&Ve(e,i))return t?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${u.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${o}.0);

        return ${u.texture2D}(${s}, uv);
      }
    `;if(t)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${u.texture2D}(${s}, uv);
    }
  `;const l=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],c=Math.ceil(e[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${c}, ${l[0]}, ${l[1]}, row, col);
      return ${u.texture2D}(${s}, uv);
    }
  `}function BD(n,t){const e=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n.shapeInfo.texShape;if(i!=null&&Ve(e,i)){if(t)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const d=i[0],f=i[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${f}.0, ${d}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:o,keptDims:a}=ho(e),u=o;if(u.length<e.length){const d=ql(n,u),f=["row","col"];return`
      ${Hl(d,t)}
      float ${r}(int row, int col) {
        return ${r}(${Xl(f,a)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${e[1]}, 1)));
        ${Kl(n)}
      }
    `;const l=i[0],c=i[1],h=au(s);return c===1?t?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${e[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${l}.0);
      return sampleTexture(${s}, uv);
    }
  `:l===1?t?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${e[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${c}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:t?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${h};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${e[1]} + col + ${h};
    vec2 uv = uvFromFlat(${l}, ${c}, index);
    return sampleTexture(${s}, uv);
  }
`}function VD(n,t){const e=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(e[0]===1){const d=e.slice(1),f=[1,2],p=ql(n,d),m=["b","row","col"];return`
        ${Yv(p,t)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${Xl(m,f)});
        }
      `}const a=zs();if(t)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `;const u=o[0],l=o[1],c=Math.ceil(e[2]/2),h=c*Math.ceil(e[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${u}, ${l}, ${h}, ${c}, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `}function UD(n,t){const e=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=e[1]*e[2],o=e[2],{newShape:a,keptDims:u}=ho(e),l=a;if(l.length<e.length){const m=ql(n,l),g=["row","col","depth"];return`
        ${Hl(m,t)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${Xl(g,u)});
        }
      `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${i}, ${o}, 1)));
        ${Kl(n)}
      }
    `;const c=n.shapeInfo.texShape,h=c[0],d=c[1],f=n.shapeInfo.flatOffset;if(d===i&&f==null)return t?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${o}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${d}.0, ${h}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(d===o&&f==null)return t?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${e[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}.0, ${h}.0);
      return sampleTexture(${s}, uv);
    }
  `;const p=au(s);return t?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${p};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${i} + col * ${o} + depth + ${p};
        vec2 uv = uvFromFlat(${h}, ${d}, index);
        return sampleTexture(${s}, uv);
      }
  `}function WD(n,t){const e=n.name,s="get"+e.charAt(0).toUpperCase()+e.slice(1),r=zs();if(t)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${e}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${e}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${e}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${e}TexShape[0]) / 2.0), ceil(float(${e}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${e}, uv);
    }
  `;const i=n.shapeInfo.logicalShape,o=i.length,a=n.shapeInfo.texShape,u=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],l=u[0],c=u[1],h=Math.ceil(i[o-1]/2);let d=h*Math.ceil(i[o-2]/2),f="int b, int row, int col",p=`b * ${d} + (row / 2) * ${h} + (col / 2)`;for(let m=2;m<o-1;m++)f=`int b${m}, `+f,d*=i[o-m-1],p=`b${m} * ${d} + `+p;return`
    vec4 ${s}(${f}) {
      int index = ${p};
      int texR = index / ${c};
      int texC = index - texR * ${c};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${c}, ${l});
      return ${r.texture2D}(${e}, uv);
    }
  `}function GD(n,t){const e=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=e[3],o=e[2]*i,a=e[1]*o,{newShape:u,keptDims:l}=ho(e);if(u.length<e.length){const b=ql(n,u),w=["row","col","depth","depth2"];return`
      ${Hl(b,t)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${Xl(w,l)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${o}, ${i}, 1)));
        ${Kl(n)}
      }
    `;const c=n.shapeInfo.flatOffset,h=n.shapeInfo.texShape,d=h[0],f=h[1],p=`int stride2 = ${s}Shape[3];`,m=`int stride1 = ${s}Shape[2] * stride2;`,g=`int stride0 = ${s}Shape[1] * stride1;`;if(f===a&&c==null)return t?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${p}
        ${m}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${o}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${d}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(f===i&&c==null)return t?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${e[1]*e[2]}, ${e[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${d}.0);
        return sampleTexture(${s}, uv);
      }
    `;const y=au(s);return t?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${p}
      ${m}
      ${g}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${y});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} +
          depth * ${i} + depth2;
      vec2 uv = uvFromFlat(${d}, ${f}, index + ${y});
      return sampleTexture(${s}, uv);
    }
  `}function jD(n){const t=n.shapeInfo.logicalShape,e=n.name,s="get"+e.charAt(0).toUpperCase()+e.slice(1),r=t[4],i=t[3]*r,o=t[2]*i,a=t[1]*o,{newShape:u,keptDims:l}=ho(t);if(u.length<t.length){const m=ql(n,u),g=["row","col","depth","depth2","depth3"];return`
      ${Hl(m)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${Xl(g,l)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${o}, ${i}, ${r})) +
          depth3;
        ${Kl(n)}
      }
    `;const c=n.shapeInfo.flatOffset,h=n.shapeInfo.texShape,d=h[0],f=h[1];if(f===a&&c==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${o}, ${i}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${d}.0);
        return sampleTexture(${e}, uv);
      }
    `;if(f===r&&c==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]},
               ${t[2]*t[3]}, ${t[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${d}.0);
        return sampleTexture(${e}, uv);
      }
    `;const p=au(e);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} + depth * ${i} +
          depth2 * ${r} + depth3 + ${p};
      vec2 uv = uvFromFlat(${d}, ${f}, index);
      return sampleTexture(${e}, uv);
    }
  `}function HD(n){const t=n.shapeInfo.logicalShape,e=n.name,s="get"+e.charAt(0).toUpperCase()+e.slice(1),{newShape:r,keptDims:i}=ho(t);if(r.length<t.length){const g=ql(n,r),y=["row","col","depth","depth2","depth3","depth4"];return`
      ${Hl(g)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${Xl(y,i)});
      }
    `}const o=t[5],a=t[4]*o,u=t[3]*a,l=t[2]*u,c=t[1]*l;if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${c}, ${l}, ${u}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${o}, 1)));
        ${Kl(n)}
      }
    `;const h=n.shapeInfo.flatOffset,d=n.shapeInfo.texShape,f=d[0],p=d[1];if(p===c&&h==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${l}, ${u}, ${a}, ${o})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${f}.0);
        return sampleTexture(${e}, uv);
      }
    `;if(p===o&&h==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]*t[4]},
               ${t[2]*t[3]*t[4]},
               ${t[3]*t[4]},
               ${t[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${f}.0);
        return sampleTexture(${e}, uv);
      }
    `;const m=au(e);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${c} + col * ${l} + depth * ${u} +
          depth2 * ${a} + depth3 * ${o} + depth4 + ${m};
      vec2 uv = uvFromFlat(${f}, ${p}, index);
      return sampleTexture(${e}, uv);
    }
  `}function Kl(n){const t=n.name,e=Et(n.shapeInfo.logicalShape);return e<2?`return ${t};`:`
    for (int i = 0; i < ${e}; i++) {
      if (i == index) {
        return ${t}[i];
      }
    }
  `}function KD(n,t){const e=n.name,s=e.charAt(0).toUpperCase()+e.slice(1),r="get"+s+"AtOutCoords",i=n.shapeInfo.logicalShape.length,o=t.logicalShape.length,a=Xv(n.shapeInfo.logicalShape,t.logicalShape),u=un(o),l=o-i;let c;const h=["x","y","z","w","u","v"];i===0?c="":o<2&&a.length>=1?c="coords = 0;":c=a.map(b=>`coords.${h[b+l]} = 0;`).join(`
`);let d="";o<2&&i>0?d="coords":d=n.shapeInfo.logicalShape.map((b,w)=>`coords.${h[w+l]}`).join(", ");let f="return outputValue;";const m=Et(n.shapeInfo.logicalShape)===1,y=Et(t.logicalShape)===1;if(i===1&&!m&&!y)f=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(m&&!y)o===1?f=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:f=`
        return vec4(outputValue.x);
      `;else if(a.length){const b=i-2,w=i-1;a.indexOf(b)>-1&&a.indexOf(w)>-1?f="return vec4(outputValue.x);":a.indexOf(b)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(w)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${u} coords = getOutputCoords();
      ${c}
      vec4 outputValue = get${s}(${d});
      ${f}
    }
  `}function qD(n,t){const e=n.name,s=e.charAt(0).toUpperCase()+e.slice(1),r="get"+s+"AtOutCoords",i=t.texShape,o=n.shapeInfo.texShape,a=n.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!n.shapeInfo.isUniform&&a===u&&n.shapeInfo.flatOffset==null&&Ve(o,i))return`
      float ${r}() {
        return sampleTexture(${e}, resultUV);
      }
    `;const l=un(u),c=Xv(n.shapeInfo.logicalShape,t.logicalShape),h=u-a;let d;const f=["x","y","z","w","u","v"];a===0?d="":u<2&&c.length>=1?d="coords = 0;":d=c.map(m=>`coords.${f[m+h]} = 0;`).join(`
`);let p="";return u<2&&a>0?p="coords":p=n.shapeInfo.logicalShape.map((m,g)=>`coords.${f[g+h]}`).join(", "),`
    float ${r}() {
      ${l} coords = getOutputCoords();
      ${d}
      return get${s}(${p});
    }
  `}function un(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error(`GPU for rank ${n} is not yet supported`)}function Y2(n,t,e){const{newShape:s,keptDims:r}=ho(t),i=t.length,o=n&&i===3&&t[0]===1,a=o?t.slice(1):s,u=!n&&i>1&&!Ve(t,e)&&s.length<i||o;return{useSqueezeShape:u,uniformShape:u?a:t,keptDims:r}}function ql(n,t){const e=JSON.parse(JSON.stringify(n));return e.shapeInfo.logicalShape=t,e}function Xl(n,t){return t.map(e=>n[e]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XD(n,t,e,s){const r=e.map((c,h)=>{const d={logicalShape:c.shape,texShape:c.isUniform?null:c.texData.texShape,isUniform:c.isUniform,isPacked:c.isUniform?!1:c.texData.isPacked,flatOffset:null};return c.texData!=null&&c.texData.slice!=null&&c.texData.slice.flatOffset>0&&(d.flatOffset=c.texData.slice.flatOffset),{name:t.variableNames[h],shapeInfo:d}}),i=r.map(c=>c.shapeInfo),o={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},a=fD(r,o,t),u=U6(n.gl,a),l=n.createProgram(u);return vt().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:u,source:a,webGLProgram:l,inShapeInfos:i,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(n.buildVao(l),Object.assign({program:t,fragmentShader:u,source:a,webGLProgram:l,inShapeInfos:i,outShapeInfo:o},Jv(n,t,l)))}function Jv(n,t,e){const s=[],r=[];let i,o,a,u=null,l=null;l=n.getUniformLocation(e,"NAN",!1),vt().getNumber("WEBGL_VERSION")===1&&(u=n.getUniformLocation(e,"INFINITY",!1));const c=!1;for(const h of t.variableNames){const d={name:h,uniform:n.getUniformLocation(e,h,c),offset:n.getUniformLocation(e,`offset${h}`,c)};t.enableShapeUniforms&&(d.shape=n.getUniformLocation(e,`${h}Shape`,c),d.texShape=n.getUniformLocation(e,`${h}TexShape`,c)),s.push(d)}if(t.enableShapeUniforms&&(i=n.getUniformLocation(e,"outShape",c),a=n.getUniformLocation(e,"outShapeStrides",c),o=n.getUniformLocation(e,"outTexShape",c)),t.customUniforms)for(const h of t.customUniforms)r.push(n.getUniformLocation(e,h.name,c));return{variablesLocations:s,customUniformLocations:r,infLoc:u,nanLoc:l,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:o}}function hb(n,t){if(n.length!==t.length)throw Error(`Binary was compiled with ${n.length} inputs, but was executed with ${t.length} inputs`);n.forEach((e,s)=>{const r=e.logicalShape,i=t[s],o=i.shape;if(!Ve(r,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${o} must match`);if(e.isUniform&&i.isUniform)return;const a=e.texShape,u=i.isUniform?null:i.texData.texShape;if(!Ve(a,u))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${u} must match`)})}function YD(n,t,e,s,r){t.program.enableShapeUniforms||(hb(t.inShapeInfos,e),hb([t.outShapeInfo],[s]));const i=s.texData.texture,o=s.texData.texShape;s.texData.isPacked?n.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):n.setOutputMatrixTexture(i.texture,o[0],o[1]),n.setProgram(t.webGLProgram),n.bindVertexArray(t.webGLProgram.vao),vt().getNumber("WEBGL_VERSION")===1&&t.infLoc!==null&&n.gl.uniform1f(t.infLoc,1/0),t.nanLoc!==null&&n.gl.uniform1f(t.nanLoc,NaN);for(let u=0;u<e.length;++u){const l=e[u],{uniform:c,offset:h,shape:d,texShape:f}=t.variablesLocations[u];if(d){const{uniformShape:p}=Y2(t.program.packedInputs,l.shape,l.texData.texShape);switch(p.length){case 1:n.gl.uniform1iv(d,new Int32Array(p));break;case 2:n.gl.uniform2iv(d,new Int32Array(p));break;case 3:n.gl.uniform3iv(d,new Int32Array(p));break;case 4:n.gl.uniform4iv(d,new Int32Array(p));break}}if(f&&n.gl.uniform2i(f,l.texData.texShape[0],l.texData.texShape[1]),c!=null){if(l.isUniform){if(Et(l.shape)<2)n.gl.uniform1f(c,l.uniformValues[0]);else{let p=l.uniformValues;p instanceof Float32Array||(p=new Float32Array(p)),n.gl.uniform1fv(c,p)}continue}l.texData.slice!=null&&h!=null&&n.gl.uniform1i(h,l.texData.slice.flatOffset),n.setInputMatrixTexture(l.texData.texture.texture,c,u)}}const a=t.outShapeLocation;if(a)switch(s.shape.length){case 1:n.gl.uniform1iv(a,new Int32Array(s.shape));break;case 2:n.gl.uniform2iv(a,new Int32Array(s.shape));break;case 3:n.gl.uniform3iv(a,new Int32Array(s.shape));break;case 4:n.gl.uniform4iv(a,new Int32Array(s.shape));break}if(t.outShapeStridesLocation){const u=ge(s.shape);switch(s.shape.length){case 2:n.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(u));break;case 3:n.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(u));break;case 4:n.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(u));break}}if(t.outTexShapeLocation&&n.gl.uniform2i(t.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),t.program.customUniforms&&r)for(let u=0;u<t.program.customUniforms.length;++u){const l=t.program.customUniforms[u],c=t.customUniformLocations[u],h=r[u];if(l.type==="float")n.gl.uniform1fv(c,h);else if(l.type==="vec2")n.gl.uniform2fv(c,h);else if(l.type==="vec3")n.gl.uniform3fv(c,h);else if(l.type==="vec4")n.gl.uniform4fv(c,h);else if(l.type==="int")n.gl.uniform1iv(c,h);else if(l.type==="ivec2")n.gl.uniform2iv(c,h);else if(l.type==="ivec3")n.gl.uniform3iv(c,h);else if(l.type==="ivec4")n.gl.uniform4iv(c,h);else throw Error(`uniform type ${l.type} is not supported yet.`)}n.executeProgram()}function ZD(n,t,e){let s="";t.concat(e).forEach(o=>{const a=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!o.isUniform){const u=o.texData.texShape,{useSqueezeShape:l,uniformShape:c,keptDims:h}=Y2(n.packedInputs,o.shape,u);let d="",f="",p="";if(c.length===1&&n.packedInputs){const S=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];d=`${S[0]>1}_${S[1]>1}`}else if(c.length===2&&!n.packedInputs)f=`${c[0]>1}_${c[1]>1}`;else if(c.length>2&&!n.packedInputs){const S=ge(c);p=`${S[0]===u[1]}_${S[S.length-1]===u[1]}`}const m=o.shape.length,g=c.length===2&&Ve(o.shape,u),y=Et(o.shape)===1,b=za(o.shape,e.shape),w=!n.packedInputs&&m===e.shape.length&&Ve(u,e.texData.texShape),v=n.packedInputs||c.length>2?"":`${u[0]>1}_${u[1]>1}`;s+=`${m}_${w}_${l?h:""}_${c.length}_${y}_${b}_${g}_${d}_${f}_${p}_${v}_${a}`}else{const u=o.isUniform?"uniform":o.texData.texShape;s+=`${o.shape}_${u}_${a}`}});const r=n.userCode;let i=n.constructor.name;return i+="_"+s+"_"+r+`${vt().getNumber("WEBGL_VERSION")}`,i}function Ss(n){return vt().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JD{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Ec.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const e=zs();this.outputShape=t,this.enableShapeUniforms=Ss(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Lm(["r","c","d"],t):ou(["r","c","d"],t)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${e.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QD{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Ec.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const e=zs();this.outputShape=t,this.enableShapeUniforms=Ss(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Lm(["r","c","d"],t):ou(["r","c","d"],t)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${e.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tO{constructor(t){this.variableNames=["A"],this.outTexUsage=Sr.DOWNLOAD;const e=zs();this.outputShape=t,this.userCode=`
      ${qv}

      void main() {
        float x = getAAtOutCoords();
        ${e.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eO{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Sr.DOWNLOAD;const e=zs();this.outputShape=t,this.userCode=`
      ${qv}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${e.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nO={R:0,G:1,B:2,A:3};class db{constructor(t,e=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=zs();this.outputShape=t,this.enableShapeUniforms=Ss(this.outputShape.length);let i="result";e&&(i="floor(result * 255. + 0.5)");let o="";for(let a=0;a<s.length;a++){const u=s[a];o+=`
          if(offset == ${a}) {
            result = values[${nO[u]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?X2():q2(t)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${o}
        }
        ${r.output} = vec4(${i}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sO{constructor(t,e=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=zs();this.outputShape=t,this.enableShapeUniforms=Ss(this.outputShape.length);let r="",i="result";e&&(i="floor(result * 255. + 0.5)");for(let o=0;o<=1;o++)for(let a=0;a<=1;a++){const u=o*2+a;r+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${t[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${o} < ${this.enableShapeUniforms?"outShape[1]":`${t[1]}`}) {
            localCoords[1] += ${o};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${u}] = values[0];
            } else if (offset == 1) {
              result[${u}] = values[1];
            } else if (offset == 2) {
              result[${u}] = values[2];
            } else {
              result[${u}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?X2():q2(t)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${s.output} = ${i};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rO(n){const t=zs(),e=`${t.version}
    precision highp float;
    ${t.attribute} vec3 clipSpacePos;
    ${t.attribute} vec2 uv;
    ${t.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return V6(n,e)}function iO(n){const t=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return H6(n,t)}function oO(n){const t=new Uint16Array([0,1,2,2,1,3]);return K6(n,t)}function hd(n,t,e,s,r,i){X6(t,e);const o=q6(n),a=n.TEXTURE_2D;return re(n,()=>n.bindTexture(a,o)),re(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)),re(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),re(n,()=>n.texParameteri(a,n.TEXTURE_MIN_FILTER,n.NEAREST)),re(n,()=>n.texParameteri(a,n.TEXTURE_MAG_FILTER,n.NEAREST)),vt().getNumber("WEBGL_VERSION")===1?re(n,()=>n.texImage2D(a,0,s,t,e,0,r,i,null)):re(n,()=>n.texStorage2D(a,1,s,t,e)),re(n,()=>n.bindTexture(n.TEXTURE_2D,null)),{texture:o,texShape:[e,t]}}function Qv(n){return n.internalFormatFloat}function aO(n,t,e,s){const[r,i]=ld(t,e);return hd(n,r,i,Qv(s),s.textureFormatFloat,n.FLOAT)}function t4(n){return n.internalFormatHalfFloat}function uO(n,t,e,s){const[r,i]=ld(t,e);return hd(n,r,i,t4(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function e4(n){return n.downloadTextureFormat}function lO(n,t,e,s){const[r,i]=ld(t,e);return hd(n,r,i,e4(s),n.RGBA,n.UNSIGNED_BYTE)}function n4(n){return n.internalFormatPackedFloat}function cO(n,t,e,s){const[r,i]=jl(t,e);return hd(n,r,i,n4(s),n.RGBA,n.FLOAT)}function s4(n){return n.internalFormatPackedHalfFloat}function hO(n,t,e,s){const[r,i]=jl(t,e);return hd(n,r,i,s4(s),n.RGBA,s.textureTypeHalfFloat)}function dO(n,t,e){return re(n,()=>n.bindBuffer(n.ARRAY_BUFFER,e)),ub(n,t,"clipSpacePos",e,3,20,0)&&ub(n,t,"uv",e,2,20,12)}function fO(n,t,e,s,r,i){re(n,()=>n.bindTexture(n.TEXTURE_2D,t));let o,a,u;r instanceof Uint8Array?(o=new Uint8Array(e*s*4),a=n.UNSIGNED_BYTE,u=n.RGBA):(o=new Float32Array(e*s*4),a=n.FLOAT,u=i.internalFormatPackedFloat),o.set(r),vt().getNumber("WEBGL_VERSION")===2?re(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,e,s,n.RGBA,a,o)):re(n,()=>n.texImage2D(n.TEXTURE_2D,0,u,e,s,0,n.RGBA,a,o)),re(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function pO(n,t,e){re(n,()=>n.bindTexture(n.TEXTURE_2D,t)),e.data instanceof Uint8Array?vt().getNumber("WEBGL_VERSION")===2?re(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,e.width,e.height,n.RGBA,n.UNSIGNED_BYTE,e.data)):re(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e.width,e.height,0,n.RGBA,n.UNSIGNED_BYTE,e.data)):vt().getNumber("WEBGL_VERSION")===2?re(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,e)):re(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e)),re(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function mO(n,t,e,s){const r=n.createBuffer();re(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,r));const a=4*4*t*e;return re(n,()=>n.bufferData(n.PIXEL_PACK_BUFFER,a,n.STREAM_READ)),re(n,()=>n.readPixels(0,0,e,t,n.RGBA,n.FLOAT,0)),re(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,null)),r}function gO(n,t,e){const s=n,r=new Float32Array(e);return s.bindBuffer(s.PIXEL_PACK_BUFFER,t),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,r),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),r}function yO(n,t,e,s){const[r,i]=ld(t,e),o=4,a=new Uint8Array(O6(t*e,o));return re(n,()=>n.readPixels(0,0,r,i,s.downloadTextureFormat,n.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function bO(n,t,e,s,r,i,o,a){const u=n,l=new Float32Array(F6(i,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function xO(n,t,e){const s=new Float32Array(t*e*4);return re(n,()=>n.readPixels(0,0,e,t,n.RGBA,n.FLOAT,s)),s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mg{constructor(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const e=vt().getNumber("WEBGL_VERSION");if(t!=null?(this.gl=t,A6(e,t)):this.gl=ui(e),t=this.gl,vt().getNumber("WEBGL_VERSION")===2){const i=t;this.createVertexArray=()=>re(i,()=>i.createVertexArray()),this.bindVertexArray=o=>re(i,()=>i.bindVertexArray(o)),this.deleteVertexArray=o=>re(i,()=>i.deleteVertexArray(o)),this.getVertexArray=()=>re(i,()=>i.getParameter(i.VERTEX_ARRAY_BINDING))}else if(t!=null){const i=t.getExtension("OES_vertex_array_object");if(i==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>re(t,()=>i.createVertexArrayOES()),this.bindVertexArray=o=>re(t,()=>i.bindVertexArrayOES(o)),this.deleteVertexArray=o=>re(t,()=>i.deleteVertexArrayOES(o)),this.getVertexArray=()=>re(t,()=>t.getParameter(i.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),vt().getNumber("WEBGL_VERSION")===1){const i="OES_texture_float",o="OES_texture_half_float";if(this.textureFloatExtension=Ad(this.gl,i),Wr(this.gl,o))this.textureHalfFloatExtension=Ad(this.gl,o);else if(vt().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),Wr(this.gl,r))this.colorBufferHalfFloatExtension=Ad(this.gl,r);else if(vt().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",Wr(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(Wr(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=iO(this.gl),this.indexBuffer=oO(this.gl),this.framebuffer=Y6(this.gl),this.textureConfig=K2(this.gl,this.textureHalfFloatExtension)}get debug(){return vt().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const t=this.gl;re(t,()=>t.finish()),re(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,null)),re(t,()=>t.deleteFramebuffer(this.framebuffer)),re(t,()=>t.bindBuffer(t.ARRAY_BUFFER,null)),re(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)),re(t,()=>t.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(t,e){return this.throwIfDisposed(),aO(this.gl,t,e,this.textureConfig)}createFloat16MatrixTexture(t,e){return this.throwIfDisposed(),uO(this.gl,t,e,this.textureConfig)}createUnsignedBytesMatrixTexture(t,e){return this.throwIfDisposed(),lO(this.gl,t,e,this.textureConfig)}uploadPixelDataToTexture(t,e){this.throwIfDisposed(),pO(this.gl,t,e)}uploadDenseMatrixToTexture(t,e,s,r){this.throwIfDisposed(),fO(this.gl,t,e,s,r,this.textureConfig)}createFloat16PackedMatrixTexture(t,e){return this.throwIfDisposed(),hO(this.gl,t,e,this.textureConfig)}createPackedMatrixTexture(t,e){return this.throwIfDisposed(),cO(this.gl,t,e,this.textureConfig)}deleteMatrixTexture(t){this.throwIfDisposed(),this.outputTexture===t&&(lb(this.gl,this.framebuffer),this.outputTexture=null),re(this.gl,()=>this.gl.deleteTexture(t))}downloadByteEncodedFloatMatrixFromOutputTexture(t,e,s){return this.downloadMatrixDriver(t,()=>yO(this.gl,e,s,this.textureConfig))}downloadPackedMatrixFromBuffer(t,e,s,r,i,o){return bO(this.gl,t,e,s,r,i,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(t,e){return gO(this.gl,t,e)}createBufferFromTexture(t,e,s){this.bindTextureToFrameBuffer(t);const r=mO(this.gl,e,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const t=this.createFence(this.gl);return this.pollFence(t)}createFence(t){let e,s;if(vt().getBool("WEBGL_FENCE_API_ENABLED")){const r=t,i=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),s=()=>{const o=r.clientWaitSync(i,0,0);return o===r.ALREADY_SIGNALED||o===r.CONDITION_SATISFIED},e=i}else vt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(e,vt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:e,isFencePassed:s}}downloadMatrixFromPackedTexture(t,e,s){return this.downloadMatrixDriver(t,()=>xO(this.gl,e,s))}createProgram(t){this.throwIfDisposed();const e=this.gl;this.vertexShader==null&&(this.vertexShader=rO(e));const s=G6(e);re(e,()=>e.attachShader(s,this.vertexShader)),re(e,()=>e.attachShader(s,t)),j6(e,s);const r=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&hg(e,r),r}buildVao(t){this.setProgram(t),this.bindVertexArray(t.vao);const e=this.gl;re(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),dO(e,t,this.vertexBuffer)}deleteProgram(t){this.throwIfDisposed(),t===this.program&&(this.program=null),t!=null&&(re(this.gl,()=>this.gl.deleteProgram(t)),this.deleteVertexArray(t.vao))}setProgram(t){this.throwIfDisposed(),this.program=t,this.program!=null&&this.debug&&hg(this.gl,this.program),re(this.gl,()=>this.gl.useProgram(t))}getUniformLocation(t,e,s=!0){return this.throwIfDisposed(),s?J6(this.gl,t,e):Q6(this.gl,t,e)}getAttributeLocation(t,e){return this.throwIfDisposed(),re(this.gl,()=>this.gl.getAttribLocation(t,e))}getUniformLocationNoThrow(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)}setInputMatrixTexture(t,e,s){this.throwIfDisposed(),this.throwIfNoProgram(),tD(this.gl,t,e,s)}setOutputMatrixTexture(t,e,s){this.setOutputMatrixTextureDriver(t,s,e)}setOutputPackedMatrixTexture(t,e,s){this.throwIfDisposed();const[r,i]=jl(e,s);this.setOutputMatrixTextureDriver(t,r,i)}setOutputMatrixWriteRegion(t,e,s,r){this.setOutputMatrixWriteRegionDriver(s,t,r,e)}setOutputPackedMatrixWriteRegion(t,e,s,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&hg(this.gl,this.program),Rd(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const t=this.gl;if(this.debug){const e=this.getVertexArray();console.assert(e===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}re(t,()=>t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),re(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Ad(this.gl,vt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(vt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=s.createQuery();return s.beginQuery(r.TIME_ELAPSED_EXT,i),i}const t=this.getQueryTimerExtensionWebGL1(),e=t.createQueryEXT();return t.beginQueryEXT(t.TIME_ELAPSED_EXT,e),e}endQuery(){if(vt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const e=this.gl,s=this.getQueryTimerExtensionWebGL2();e.endQuery(s.TIME_ELAPSED_EXT);return}const t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(t){return await Bg(()=>this.disposed||this.isQueryAvailable(t,vt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(t,vt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(t,e){if(e===0)return null;if(e===2){const s=this.gl;return s.getQueryParameter(t,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(t,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(t,e){if(e===0)return!0;if(e===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=s.getQueryParameter(t,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),r=s.getQueryObjectEXT(t,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(t){return new Promise(e=>{this.addItemToPoll(()=>t.isFencePassed(),()=>e())})}pollItems(){const t=wO(this.itemsToPoll.map(e=>e.isDoneFn));for(let e=0;e<=t;++e){const{resolveFn:s}=this.itemsToPoll[e];s()}this.itemsToPoll=this.itemsToPoll.slice(t+1)}addItemToPoll(t,e){if(this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in vt().platform&&(s=vt().platform.setTimeoutCustom.bind(vt().platform)),Bg(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(t){this.throwIfDisposed(),dg(this.gl,t,this.framebuffer),this.debug&&Rd(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(dg(this.gl,this.outputTexture,this.framebuffer),this.debug&&Rd(this.gl)):lb(this.gl,this.framebuffer)}downloadMatrixDriver(t,e){this.bindTextureToFrameBuffer(t);const s=e();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(t,e,s){this.throwIfDisposed();const r=this.gl;dg(r,t,this.framebuffer),this.debug&&Rd(r),this.outputTexture=t,re(r,()=>r.viewport(0,0,e,s)),re(r,()=>r.scissor(0,0,e,s))}setOutputMatrixWriteRegionDriver(t,e,s,r){this.throwIfDisposed(),re(this.gl,()=>this.gl.scissor(t,e,s,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function wO(n){let t=0;for(;t<n.length&&n[t]();++t);return t-1}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function de(n,t){Array.isArray(n)||(n=[n]),n.forEach(e=>{e!=null&&V(e.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r4(n){const t=new Float32Array(n.length);for(let e=0;e<n.length;++e)t[e]=Math.abs(n[e]);return t}const vO=n=>{const{x:t}=n.inputs,e=n.backend;de(t,"abs");let s=new Float32Array(Et(t.shape));const r=e.data.get(t.dataId).values;return s=r4(r),e.makeOutput(s,t.shape,t.dtype)},kO={kernelName:Mc,backendName:"cpu",kernelFunc:vO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dn(n){return(t,e,s,r,i)=>{const o=Ee(t,e),a=o.length,u=ge(o),l=Et(o),c=ss(i,l),h=t.length,d=e.length,f=ge(t),p=ge(e),m=za(t,o),g=za(e,o);if(m.length+g.length===0)for(let y=0;y<c.length;++y)c[y]=n(s[y%s.length],r[y%r.length]);else for(let y=0;y<c.length;++y){const b=Ya(y,a,u),w=b.slice(-h);m.forEach(R=>w[R]=0);const v=ri(w,h,f),S=b.slice(-d);g.forEach(R=>S[R]=0);const N=ri(S,d,p);c[y]=n(s[v],r[N])}return[c,o]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rr(n){const{inputs:t,backend:e}=n,{real:s,imag:r}=t,i=e.data.get(s.dataId).values,o=e.data.get(r.dataId).values,a=e.makeTensorInfo(s.shape,"complex64"),u=e.data.get(a.dataId);return u.complexTensorInfos={real:e.makeTensorInfo(s.shape,"float32",i),imag:e.makeTensorInfo(r.shape,"float32",o)},a}const SO={kernelName:Hf,backendName:"cpu",kernelFunc:rr};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pf(n,t,e="float32"){if(e==="complex64"){const r=pf(n,t,"float32"),i=pf(n,t,"float32");return rr({inputs:{real:r,imag:i},backend:n})}const s=ls(Et(t),e);return n.makeTensorInfo(t,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bi(n){const{inputs:t,backend:e}=n,{x:s}=t;return e.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const IO={kernelName:ll,backendName:"cpu",kernelFunc:Bi};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wa(n){const{inputs:t,backend:e}=n,{input:s}=t,r=e.data.get(s.dataId).complexTensorInfos.real,i=e.data.get(r.dataId).values;return e.makeTensorInfo(r.shape,r.dtype,i)}const CO={kernelName:Cp,backendName:"cpu",kernelFunc:Wa};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i4(n,t,e,s){if(s==="int32"){const r=Int32Array.from(n);return[t,"int32",r]}if(s==="bool"){const r=Jo([0],e),[i,o]=Dn((a,u)=>a!==u?1:0)(t,[],n,r,"bool");return[o,"bool",i]}throw new Error(`Error in Cast: failed to cast ${e} to ${s}`)}function Ho(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{dtype:i}=s;if(i==="complex64"){if(r.dtype==="complex64")return Bi({inputs:{x:r},backend:e});const c=pf(e,r.shape,r.dtype),h=Ho({inputs:{x:r},backend:e,attrs:{dtype:"float32"}}),d=rr({inputs:{real:h,imag:c},backend:e});return e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(h),d}if(r.dtype==="complex64"){const c=Wa({inputs:{input:r},backend:e}),h=Ho({inputs:{x:c},backend:e,attrs:{dtype:i}});return e.disposeIntermediateTensorInfo(c),h}if(!V1(r.dtype,i)){const c=Bi({inputs:{x:r},backend:e});return{dataId:c.dataId,shape:c.shape,dtype:i}}const o=e.data.get(r.dataId).values,[a,u,l]=i4(o,r.shape,r.dtype,i);return e.makeTensorInfo(a,u,l)}const NO={kernelName:Yu,backendName:"cpu",kernelFunc:Ho};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qn(n,t,e,s){return e==null?({inputs:r,backend:i})=>{const{a:o,b:a}=r,u=i;de([o,a],n);const l=u.data.get(o.dataId).values,c=u.data.get(a.dataId).values,h=o.dtype==="string"?uo(l):l,d=o.dtype==="string"?uo(c):c,f=s||o.dtype,[p,m]=t(o.shape,a.shape,h,d,f);return u.makeTensorInfo(m,f,p)}:({inputs:r,backend:i})=>{const{a:o,b:a}=r,u=i;if(o.dtype==="complex64"||a.dtype==="complex64"){const l=Ho({inputs:{x:o},backend:u,attrs:{dtype:"complex64"}}),c=u.data.get(l.dataId),h=c.complexTensorInfos.real,d=c.complexTensorInfos.imag,f=u.data.get(h.dataId).values,p=u.data.get(d.dataId).values,m=Ho({inputs:{x:a},backend:u,attrs:{dtype:"complex64"}}),g=u.data.get(m.dataId),y=g.complexTensorInfos.real,b=g.complexTensorInfos.imag,w=u.data.get(y.dataId).values,v=u.data.get(b.dataId).values,[S,N,R]=e(o.shape,a.shape,f,p,w,v),L=u.makeTensorInfo(R,"float32",S),F=u.makeTensorInfo(R,"float32",N),B=rr({inputs:{real:L,imag:F},backend:u});return u.disposeIntermediateTensorInfo(l),u.disposeIntermediateTensorInfo(m),u.disposeIntermediateTensorInfo(L),u.disposeIntermediateTensorInfo(F),B}else{const l=u.data.get(o.dataId).values,c=u.data.get(a.dataId).values,h=s||o.dtype,[d,f]=t(o.shape,a.shape,l,c,h);return u.makeTensorInfo(f,h,d)}}}function Z2(n){return(t,e,s,r,i,o)=>{const a=Ee(t,e),u=Et(a),l=a.length,c=ge(a),h=ss("float32",u),d=ss("float32",u),f=za(t,a),p=za(e,a),m=ao(s,r),g=ao(i,o),y=t.length,b=ge(t),w=e.length,v=ge(e);if(f.length+p.length===0)for(let S=0;S<h.length;S++){const N=S%m.length,R=S%g.length,L=n(m[N*2],m[N*2+1],g[R*2],g[R*2+1]);h[S]=L.real,d[S]=L.imag}else for(let S=0;S<h.length;S++){const N=Ya(S,l,c),R=N.slice(-y);f.forEach(z=>R[z]=0);const L=ri(R,y,b),F=N.slice(-w);p.forEach(z=>F[z]=0);const B=ri(F,w,v),H=n(m[L*2],m[L*2+1],g[B*2],g[B*2+1]);h[S]=H.real,d[S]=H.imag}return[h,d,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o4=Dn((n,t)=>n+t),TO=Z2((n,t,e,s)=>({real:n+e,imag:t+s})),zu=qn(Za,o4,TO),$O={kernelName:Za,backendName:"cpu",kernelFunc:zu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J2(n,t,e,s,r){const i=Et(s),o=ls(r,e);for(let a=0;a<n.length;a++){const u=n[a];if(u<0)throw new Error("Input x must be non-negative!");u>=r||(i>0?o[u]+=t[a]:o[u]+=1)}return o}function a4(n,t,e,s=!1){const r=n.shape[0],i=n.shape[1],o=Fe([r,e],t.dtype);for(let a=0;a<r;a++)for(let u=0;u<i;u++){const l=n.get(a,u);if(l<0)throw new Error("Input x must be non-negative!");l>=e||(s?o.set(1,a,l):t.size>0?o.set(o.get(a,l)+t.get(a,u),a,l):o.set(o.get(a,l)+1,a,l))}return o}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u4=Dn((n,t)=>n&t),EO=qn(Hc,u4),_O={kernelName:Hc,backendName:"cpu",kernelFunc:EO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wi(n){return(t,e,s)=>{const r=En(e,t.length);for(let i=0;i<t.length;++i)r[i]=n(t[i],s);return r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rn(n,t,e){const s=Wi(t);return ia(n,s,e)}function ia(n,t,e){return({inputs:s,attrs:r,backend:i})=>{const{x:o}=s;de(o,n);const a=i,u=a.data.get(o.dataId).values;let l;if(o.dtype==="string"){if(!Array.isArray(u))throw new Error("String tensor's value was not an instance of Array");l=uo(u)}else l=u;const c=e||o.dtype,h=t(l,c,r);return a.makeTensorInfo(o.shape,c,h)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l4=Wi(n=>Math.ceil(n)),AO=ia(Zu,l4),RO={kernelName:Zu,backendName:"cpu",kernelFunc:AO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c4(n,t,e,s){const r=En(e,Et(t));if(s&&e!=="string"){let i=0;n.forEach(o=>{const a=Et(o.shape);r.set(o.vals,i),i+=a})}else{let i=0;n.forEach(o=>{const a=e==="string"?uo(o.vals):o.vals;let u=0;for(let l=0;l<o.shape[0];++l){const c=l*t[1]+i;for(let h=0;h<o.shape[1];++h)r[c+h]=a[u++]}i+=o.shape[1]})}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h4=Dn((n,t)=>n===t?1:0),d4=qn(eh,h4,null,"bool"),DO={kernelName:eh,backendName:"cpu",kernelFunc:d4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f4=Wi(n=>Math.exp(n)),p4=ia(rl,f4,"float32"),OO={kernelName:rl,backendName:"cpu",kernelFunc:p4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m4=Wi(n=>Math.expm1(n)),FO=ia(il,m4),LO={kernelName:il,backendName:"cpu",kernelFunc:FO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g4=Wi(n=>Math.floor(n)),PO=ia(ol,g4),MO={kernelName:ol,backendName:"cpu",kernelFunc:PO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y4=Dn((n,t)=>Math.floor(n/t)),zO=qn(al,y4,null,"int32"),BO={kernelName:al,backendName:"cpu",kernelFunc:zO};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b4(n,t,e,s,r,i,o,a,u){const l=Fe([s,i],e);for(let c=0;c<s;c++){const h=[];let d=0;for(let f=0;f<r;f++){const p=n[c*r+f];d+=p*o[f],h.push(p)}if(d<0||d>=u/i)throw new Error(`Invalid indices: ${h} does not index into ${a}`);for(let f=0;f<i;f++)l.values[c*i+f]=t.get(...t.indexToLoc(d*i+f))}return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x4(n,t,e){const s=Fe(e,n.dtype);for(let r=0;r<s.size;++r){const o=s.indexToLoc(r).slice(),a=o[0],u=o[2],l=t.locToIndex([a,u]);o[2]=t.values[l];const c=n.locToIndex(o);0<=c&&c<n.values.length&&(s.values[r]=n.values[c])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w4=Dn((n,t)=>n>t?1:0),VO=qn(ih,w4,null,"bool"),UO={kernelName:ih,backendName:"cpu",kernelFunc:VO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v4=Dn((n,t)=>n>=t?1:0),WO=qn(ul,v4,null,"bool"),GO={kernelName:ul,backendName:"cpu",kernelFunc:WO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k4=Dn((n,t)=>n<t?1:0),jO=qn(ah,k4,null,"bool"),HO={kernelName:ah,backendName:"cpu",kernelFunc:jO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S4=Dn((n,t)=>n<=t?1:0),KO=qn(uh,S4,null,"bool"),qO={kernelName:uh,backendName:"cpu",kernelFunc:KO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I4(n,t,e){const s=(t-n)/(e-1),r=ls(e,"float32");r[0]=n;for(let i=1;i<r.length;i++)r[i]=r[i-1]+s;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C4=Wi(n=>Math.log(n)),XO=ia(fl,C4),YO={kernelName:fl,backendName:"cpu",kernelFunc:XO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N4(n,t,e,s){const r=ss(s,Et(e));for(let i=0;i<r.length;++i){const o=i*t;let a=n[o];for(let u=0;u<t;++u){const l=n[o+u];(Number.isNaN(l)||l>a)&&(a=l)}r[i]=a}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T4=Dn((n,t)=>Math.max(n,t)),ZO=qn(ml,T4),JO={kernelName:ml,backendName:"cpu",kernelFunc:ZO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $4=Dn((n,t)=>Math.min(n,t)),QO=qn(gl,$4),tF={kernelName:gl,backendName:"cpu",kernelFunc:QO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q2=Dn((n,t)=>n*t),eF=Z2((n,t,e,s)=>({real:n*e-t*s,imag:n*s+t*e})),Pm=qn(bl,Q2,eF),nF={kernelName:bl,backendName:"cpu",kernelFunc:Pm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E4(n,t,e){const s=fo(-1,e);return Q2([],t,s,n,e)}function sF(n){const{inputs:t,backend:e}=n,{x:s}=t;de(s,"neg");const r=e.data.get(s.dataId).values,[i,o]=E4(r,s.shape,s.dtype);return e.makeTensorInfo(o,s.dtype,i)}const rF={kernelName:xh,backendName:"cpu",kernelFunc:sF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _4=Dn((n,t)=>n!==t?1:0),iF=qn(wh,_4,null,"bool"),oF={kernelName:wh,backendName:"cpu",kernelFunc:iF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ty(n,t,e,s,r){const i=t.length,o=Et(t),a=ge(t),u=ge(r),l=ss(e,Et(r));for(let c=0;c<o;++c){const h=Ya(c,i,a),d=new Array(h.length);for(let p=0;p<d.length;p++)d[p]=h[s[p]];const f=ri(d,i,u);l[f]=n[c]}return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ys(n){const{inputs:t,attrs:e,backend:s}=n,{x:r}=t,{perm:i}=e;de(r,"transpose");const o=r.shape.length,a=new Array(o);for(let h=0;h<a.length;h++)a[h]=r.shape[i[h]];const u=s.data.get(r.dataId).values,l=ty(u,r.shape,r.dtype,i,a);return{dataId:s.write(l,a,r.dtype),shape:a,dtype:r.dtype}}const aF={kernelName:_a,backendName:"cpu",kernelFunc:Ys};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A4(n,t,e,s){const[r,i]=is(n,s),o=qs(t,"int32"),a=ls(Et(r),o),u=Et(i);for(let l=0;l<a.length;++l){const c=l*u;let h=1;for(let d=0;d<u;++d)h*=e[c+d];a[l]=h}return{outVals:a,outShape:r,outDtype:o}}function uF(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i,keepDims:o}=s;de(r,"prod");const a=r.shape.length,u=Pe(i,r.shape),l=Tn(u,a);let c=u,h=r;const d=[];l!=null&&(h=Ys({inputs:{x:r},backend:e,attrs:{perm:l}}),d.push(h),c=Rn(c.length,a));const f=e.data.get(h.dataId).values,{outVals:p,outShape:m,outDtype:g}=A4(h.shape,h.dtype,f,c);let y=m;return o&&(y=An(m,u)),d.forEach(b=>e.disposeIntermediateTensorInfo(b)),e.makeTensorInfo(y,g,p)}const lF={kernelName:Nh,backendName:"cpu",kernelFunc:uF};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cF(n,t,e){n.forEach((s,r)=>{if(s<0||s>=e){const i=Ya(r,t.length,ge(t)).join(",");throw new Error(`indices[${i}] = ${s} is not in [0, ${e})`)}})}function hF(n,t){for(let e=0;e<n.length;++e){const s=n[e],r=e===n.length-1?t:n[e+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>r)throw new Error("Ragged splits must not point past values");for(let i=1;i<s.length;++i)if(s[i-1]>s[i])throw new Error("Ragged splits must be sorted in ascending order")}}function dF(n,t,e,s){const r=[];let i=0;const o=t.length-1+e.length,a=new Array(o).fill(null).map(()=>[0]);hF(e,s);let u=1;for(let l=0;l<t.length-1;++l){u*=t[l];const c=t[l+1];for(let h=1;h<u+1;++h)a[l].push(h*c)}for(let l=0;l<n.length;++l){let c=n[l],h=n[l]+1;for(let d=0;d<e.length;++d){const f=e[d],p=d+t.length-1;if(p>=0){const m=a[p],g=m[m.length-1]-f[c];for(let y=c;y<h;++y)a[p].push(f[y+1]+g)}c=f[c],h=f[h]}h!==c&&(r.push([c,h]),i+=h-c)}return{outSplits:a,valueSlices:r,numValues:i}}function fF(n){const t=[];for(let e=0;e<n.length;++e){const s=n[e].length,r=En("int32",s);t.push(r),n[e].forEach((i,o)=>r[o]=i)}return t}function fb(n,t){const e=n.slice(0,t);for(;e.length<t;)e.push(1);for(let s=t;s<n.length;s++)e[t-1]*=n[s];return e}function pF(n,t,e,s,r,i){const o=fb(t,2)[1],a=fb(i,2)[1];let u=0;for(const l of e)for(let c=l[0];c<l[1];++c){for(let h=0;h<s;++h)r[u*a+h]=n[c*o+h];++u}}function mF(n,t,e,s,r){const i=t.slice();i[0]=r;const o=En(e,Et(i)),a=n.length,u=a===0?0:a/t[0];return pF(n,t,s,u,o,i),[o,i]}function R4(n,t,e,s,r,i,o,a){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(t[0].length===0)throw new Error("Split tensors must not be scalars");const u=t[0][0]-1;if(cF(i,o,u),s.length===0)throw new Error("params.rank must be nonzero");const l=s[0],{outSplits:c,valueSlices:h,numValues:d}=dF(i,o,n,l),f=fF(c),p=mF(e,s,r,h,d);return[f,p[0],p[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pb=2147483647;function D4(n,t,e,s,r,i,o){if(t.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");const a=t.length===0,u=r.length===0,l=o.length===0,c=[];a||c.push(t[0]),u||c.push(r[0]),l||c.push(o[0]);for(let g=1;g<c.length;++g)if(c[g]!==c[g-1])throw new Error("starts, limits, and deltas must have the same shape");const h=c.length===0?1:c[0],d=En("int32",h+1);d[0]=0;for(let g=0;g<h;++g){const y=a?n[0]:n[g],b=u?s[0]:s[g],w=l?i[0]:i[g];if(w===0)throw new Error("Requires delta != 0");let v;if(w>0&&b<y||w<0&&b>y)v=0;else if(v=Math.ceil(Math.abs((b-y)/w)),v>pb)throw new Error(`Requires ((limit - start) / delta) <= ${pb}`);d[g+1]=d[g]+v}const f=d[h],p=En(e,f);let m=0;for(let g=0;g<h;++g){const y=d[g+1]-d[g];let b=a?n[0]:n[g];const w=l?i[0]:i[g];for(let v=0;v<y;++v)p[m++]=b,b+=w}return[d,p]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Fr=ni;class mf{constructor(t,e,s,r,i,o,a,u,l,c){this.shape=t,this.shapeShape=e,this.values=s,this.valuesShape=r,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=a,this.rowPartitionValues=u,this.rowPartitionValuesShapes=l,this.rowPartitionTypes=kv(c),this.raggedRank=Sv(this.rowPartitionTypes)}getRowPartitionTypeByDimension(t){return this.rowPartitionTypes[0]===Fr.FIRST_DIM_SIZE?this.rowPartitionTypes[t+1]:this.rowPartitionTypes[t]}getRowPartitionTensor(t){return this.rowPartitionTypes[0]===Fr.FIRST_DIM_SIZE?this.rowPartitionValues[t+1]:this.rowPartitionValues[t]}getMaxWidth(t){const e=this.getRowPartitionTensor(t-1);switch(this.getRowPartitionTypeByDimension(t-1)){case Fr.VALUE_ROWIDS:return mf.getMaxWidthValueRowID(e);case Fr.ROW_SPLITS:return mf.getMaxWidthRowSplit(e);default:throw new Error(`Cannot handle partition type ${Fr[this.getRowPartitionTypeByDimension(t-1)]}`)}}static getMaxWidthRowSplit(t){const e=t.length;if(e===0||e===1)return 0;let s=0;for(let r=0;r<e-1;++r){const i=t[r+1]-t[r];i>s&&(s=i)}return s}static getMaxWidthValueRowID(t){const e=t.length;if(e===0)return 0;let s=0,r=t[0],i=0;for(let o=1;o<e;++o){const a=t[o];a!==r&&(r=a,i=Math.max(o-s,i),s=o)}return Math.max(e-s,i)}tensorShapeFromTensor(t,e,s=!0){if(e.length===0){if(t[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return gb(t,s)}calculateOutputSize(t){const e=this.valuesShape,s=this.defaultValueShape;Iv(s,e);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=vv(this.raggedRank,r,e);o[0]<0&&(o[0]=t);for(let a=1;a<=this.raggedRank;++a)o[a]<0&&(o[a]=this.getMaxWidth(a));return o}calculateFirstParentOutputIndex(t,e,s){const r=Math.min(t,s),i=[];let o=0;for(let a=0;a<r;++a,o+=e)i.push(o);for(let a=r;a<t;++a)i.push(-1);return V(i.length===t,()=>"Final length of result must be equal to firstDimension."),i}calculateOutputIndexRowSplit(t,e,s,r){const i=t.length,o=[];for(let a=0;a<i-1;++a){const u=t[a+1]-t[a];let l=Math.min(r,u),c=e[a];c===-1&&(l=0);for(let h=0;h<l;++h)o.push(c),c+=s;for(let h=0;h<u-l;++h)o.push(-1)}if(i>0&&o.length!==t[i-1])throw new Error("Invalid row split size.");return o}calculateOutputIndexValueRowID(t,e,s,r){const i=t.length,o=[];if(i===0)return[];let a=0,u=t[0];if(u>=e.length)throw new Error(`Got currentValueRowId=${u}, which is not less than ${e.length}`);let l=e[u];o.push(l);for(let c=1;c<i;++c){const h=t[c];if(h===u)l>=0&&(++a,a<r?l+=s:l=-1);else{if(a=0,u=h,h>=e.length)throw new Error(`Got nextValueRowId=${h} which is not less than ${e.length}`);l=e[h]}o.push(l)}if(o.length!==t.length)throw new Error("Invalid row ids.");return o}calculateOutputIndex(t,e,s,r){const i=this.getRowPartitionTensor(t),o=this.getRowPartitionTypeByDimension(t);switch(o){case Fr.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,e,s,r);case Fr.ROW_SPLITS:if(i.length-1>e.length)throw new Error(`Row partition size is greater than output size: ${i.length-1} > ${e.length}`);return this.calculateOutputIndexRowSplit(i,e,s,r);default:throw new Error(`Unsupported partition type: ${Fr[o]}`)}}getFirstDimensionSize(){const t=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const e=this.rowPartitionTypes[0];switch(e){case Fr.FIRST_DIM_SIZE:return t[0];case Fr.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Fr.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${Fr[e]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const e=this.getFirstDimensionSize(),s=this.calculateOutputSize(e),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let u=r.length-2;u>=0;--u)r[u]=r[u+1]*s[u+1];const i=gb(s,!1),o=En(this.valuesDType,Et(i));if(r[0]*s[0]>0){let u=this.calculateFirstParentOutputIndex(e,r[0],s[0]);for(let l=1;l<=this.raggedRank;++l)u=this.calculateOutputIndex(l-1,u,r[l],s[l]);this.setOutput(this.raggedRank,u,o,i)}return[i,o]}setOutput(t,e,s,r){if(s.length===0)return;const i=this.values,o=s;let a=r.slice();a=a.slice(t+1);const u=Et(a),l=e.length;let c=this.defaultValue;if(c.length!==u&&c.length!==1){const p=this.defaultValueShape;pt(()=>{const m=ct(c,p);c=Aa(m,a).dataSync()})}let h=0,d=0,f=0;for(let p=0;p<=l;++p){let m=p<l?e[p]:-1;if(m===f){++f;continue}if(d<f){const g=i.subarray(h*u),y=o.subarray(d*u),b=(f-d)*u;mb(y,g,b)}if(p>=l){const g=s.length;m=Math.floor(g/u)}if(m>f)if(this.defaultValue.length===1)o.subarray(f*u,m*u).fill(this.defaultValue[0]),f=m;else for(;m>f;){const g=o.slice(f*u);mb(g,c,u),++f}m<0?(h=p+1,d=f):(h=p,d=f,f=d+1)}}}function mb(n,t,e){for(let s=0;s<e;s++)n[s]=t[s]}function gb(n,t){const e=[];for(let s of n){if(s<0){if(!t)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}e.push(s)}return e}function O4(n,t,e,s,r,i,o,a,u,l){return new mf(n,t,e,s,r,i,o,a,u,l).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F4(n,t,e,s){const r=n===t,i=n<t&&e<0,o=t<n&&e>1;if(r||i||o)return ls(0,s);const a=Math.abs(Math.ceil((t-n)/e)),u=ls(a,s);t<n&&e===1&&(e=-1),u[0]=n;for(let l=1;l<u.length;l++)u[l]=u[l-1]+e;return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L4=Wi(n=>1/Math.sqrt(n)),gF=ia(Il,L4),yF={kernelName:Il,backendName:"cpu",kernelFunc:gF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $a(n,t,e,s,r,i,o,a,u,l){const c=[s/r,r],h=n.values,d=t.values;if(s===0)return Fe(e,t.dtype);const f=u instanceof Vn?u:Fe(c,t.dtype);typeof u=="string"||typeof u=="number"?f.values.fill(u):typeof u=="boolean"&&f.values.fill(+u);for(let p=0;p<i;p++){const m=[];let g=0;for(let y=0;y<o;y++){const b=h[p*o+y];m.push(b),g+=b*a[y]}if(g<0||g>=s/r)throw new Error(`Invalid indices: ${m} does not index into ${e}`);for(let y=0;y<r;y++)l?f.values[g*r+y]+=d[p*r+y]:f.values[g*r+y]=t.rank===0?d[0]:d[p*r+y]}return f}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bF=Wi(n=>1/(1+Math.exp(-n))),P4=rn(El,n=>1/(1+Math.exp(-n))),xF={kernelName:El,backendName:"cpu",kernelFunc:P4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M4(n,t,e,s,r){const i=I2(s,t,e),o=Et(e),a=ge(s);if(i){const h=C2(t,a);return r==="string"?n.slice(h,h+o):n.subarray(h,h+o)}const u=r==="string"?uo(n):n,l=Fe(s,r,u),c=Fe(e,r);for(let h=0;h<c.size;++h){const d=c.indexToLoc(h),f=d.map((p,m)=>p+t[m]);c.set(l.get(...f),...d)}return r==="string"?Gv(c.values):c.values}function Ga(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{begin:i,size:o}=s;de(r,"slice");const[a,u]=Rm(r,i,o);k2(r,a,u);const l=e.data.get(r.dataId).values,c=M4(l,a,u,r.shape,r.dtype);return e.makeTensorInfo(u,r.dtype,c)}const wF={kernelName:Rh,backendName:"cpu",kernelFunc:Ga};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z4(n,t,e,s,r,i,o){const a=t[0],u=i[0],l=new Array(u),c=new Array(a),h=t[1];if(u===0){if(a!==0)throw new Error(Av(a));const g=En(e,0),y=En(r,0);return[g,[0,h],y,l,c]}let d=!0,f=0;const p=new Array(u).fill(0);for(let g=0;g<a;++g){const y=n[g*h];if(y<0)throw new Error(Rv(g,y));if(y>=u)throw new Error(Dv(g,y,u));++p[y],d=d&&y>=f,f=y}let m=!0;for(let g=0;g<u;++g){const y=p[g]===0;l[g]=y,m=m&&!y,p[g]=Math.max(p[g],1),g>0&&(p[g]+=p[g-1])}if(m&&d){const g=n,y=s;for(let b=0;b<a;++b)c[b]=b;return[g,[a,h],y,l,c]}else{const g=p[u-1],y=En(e,g*h),b=En(r,g),w=new Array(u).fill(0);for(let v=0;v<a;++v){const S=n[v*h],N=w[S],R=(S===0?0:p[S-1])+N;w[S]++;for(let L=0;L<h;++L)y[R*h+L]=n[v*h+L];b[R]=s[v],c[v]=R}for(let v=0;v<u;++v)if(w[v]===0){const N=v===0?0:p[v-1];y[N*h+0]=v;for(let R=1;R<h;++R)y[N*h+R]=0;b[N]=o}return[y,[g,h],b,l,c]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B4(n,t,e,s,r){const i=Et(s),o=t[0],a=r.length,u=[];let l=1,c=-1;for(let g=0;g<a;++g){const y=r[g];if(y===-1){if(c!==-1)throw new Error(Ov(c,g));c=g,u.push(1)}else{if(y<0)throw new Error(Fv(g,y));l*=y,u.push(y)}}if(c!==-1){if(l<=0)throw new Error(Lv());const g=Math.trunc(i/l);if(l*g!==i)throw new Error(Pv(s,u));u[c]=g}if(Et(u)!==i)throw new Error(Mv(s,u));const d=s.length,f=[];if(d>0){f[d-1]=1;for(let g=d-2;g>=0;--g)f[g]=f[g+1]*s[g+1]}const p=[];if(a>0){p[a-1]=1;for(let g=a-2;g>=0;--g)p[g]=p[g+1]*u[g+1]}const m=En(e,o*a);for(let g=0;g<o;++g){let y=0;for(let b=0;b<d;++b)y+=n[g*d+b]*f[b];for(let b=0;b<a;++b)m[g*a+b]=Math.trunc(y/p[b]),y%=p[b]}return[m,[o,a],u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ey(n,t,e,s,r,i=!1,o=0){const a=s.length,u=[t[0],n.length/t[0]],l=u[1],h=a>0?r[a-1]+1:0;if(h<0)throw new Error(a1());const d=t.slice();d[0]=h;const f=d.reduce((w,v)=>w*v,1),p=En(e,f);if(a===0)return h>0&&p.fill(o),[p,d];if(h<=0)throw new Error(a1());let m=0,g=1,y=0,b=r[m];for(;;){let w=0;if(g<a){if(w=r[g],b===w){++g;continue}if(b>=w)throw new Error(zv())}if(b<0||b>=h)throw new Error(Bv(b,h));b>y&&p.fill(o,y*l,b*l);for(let v=m;v<g;++v){const S=s[v];if(S<0||S>=u[0])throw new Error(Vv(v,s[v],u[0]));for(let N=0;N<l;N++)p[b*l+N]+=n[S*l+N]}if(i)for(let v=0;v<l;v++)p[b*l+v]/=g-m;if(m=g,++g,y=b+1,b=w,g>a)break}return y<h&&p.fill(o,y*l,h*l),[p,d]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vF=Wi(n=>Math.sqrt(n)),kF=rn(Al,n=>Math.sqrt(n)),SF={kernelName:Al,backendName:"cpu",kernelFunc:kF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V4=Dn((n,t)=>{const e=n-t;return e*e}),IF=qn(Rl,V4),CF={kernelName:Rl,backendName:"cpu",kernelFunc:IF};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U4=Wi((n,t)=>{const{pattern:e,replaceGlobal:s,rewrite:r}=t;return n.replace(new RegExp(e,s?"g":""),r)}),NF=ia(Ph,U4),TF={kernelName:Ph,backendName:"cpu",kernelFunc:NF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W4(n,t,e,s){const r=Fe(n,t.dtype);for(let i=0;i<r.size;i++){const o=r.indexToLoc(i),a=new Array(o.length);for(let u=0;u<a.length;u++)a[u]=o[u]*e[u]+s[u];r.set(t.get(...a),...o)}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $F{constructor(t,e,s,r,i,o){this.separator=Ai(t),this.nGramWidths=e,this.leftPad=Ai(s),this.rightPad=Ai(r),this.padWidth=i,this.preserveShort=o}getPadWidth(t){return Math.min(this.padWidth<0?t-1:this.padWidth,t-1)}getNumNGrams(t,e){const s=this.getPadWidth(e);return Math.max(0,t+2*s-e+1)}createNGrams(t,e,s,r,i,o){for(let a=0;a<i;++a){const u=this.getPadWidth(o),l=Math.max(0,u-a),c=Math.max(0,u-(i-(a+1))),h=o-(l+c),d=e+(l>0?0:a-u);let f=0;f+=l*this.leftPad.length;for(let b=0;b<h;++b)f+=t[d+b].length;f+=c*this.rightPad.length;const p=l+c+h-1;f+=p*this.separator.length,s[r+a]=new Uint8Array(f);const m=s[r+a];let g=0;const y=b=>b.forEach(w=>m[g++]=w);for(let b=0;b<l;++b)y(this.leftPad),y(this.separator);for(let b=0;b<h-1;++b)y(t[d+b]),y(this.separator);if(h>0){y(t[d+h-1]);for(let b=0;b<c;++b)y(this.separator),y(this.rightPad)}else{for(let b=0;b<c-1;++b)y(this.rightPad),y(this.separator);y(this.rightPad)}}}compute(t,e){const s=t.length,r=e.length;if(r>0){let u=e[0];if(u!==0)throw new Error(`First split value must be 0, got ${u}`);for(let l=1;l<r;++l){let c=e[l]>=u;if(c=c&&e[l]<=s,!c)throw new Error(`Invalid split value ${e[l]}, must be in [${u}, ${s}]`);u=e[l]}if(u!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${u}`)}const i=r-1,o=En("int32",r);if(s===0||r===0){const u=new Array(s);for(let l=0;l<=i;++l)o[l]=0;return[u,o]}o[0]=0;for(let u=1;u<=i;++u){const l=e[u]-e[u-1];let c=0;this.nGramWidths.forEach(h=>{c+=this.getNumNGrams(l,h)}),this.preserveShort&&l>0&&c===0&&(c=1),o[u]=o[u-1]+c}const a=new Array(o[i]);for(let u=0;u<i;++u){const l=e[u];let c=o[u];if(this.nGramWidths.forEach(h=>{const d=e[u+1]-e[u],f=this.getNumNGrams(d,h);this.createNGrams(t,l,a,c,f,h),c+=f}),this.preserveShort&&c===o[u]){const h=e[u+1]-e[u];if(h===0)continue;const d=h+2*this.padWidth,f=1;this.createNGrams(t,l,a,c,f,d)}}return[a,o]}}function G4(n,t,e,s,r,i,o,a){return new $F(e,s,r,i,o,a).compute(n,t)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EF(n,t,e,s){if(!n.length)return;if(t.length===0){for(let i=0;i<n.length;++i)s.push(n.subarray(i,i+1));return}if(t.length===1){const i=t[0];let o=n.indexOf(i);for(;o!==-1;){const a=n.subarray(0,o);(!e||a.length!==0)&&s.push(a),n=n.subarray(o+1),o=n.indexOf(i)}(!e||n.length!==0)&&s.push(n);return}let r=0;for(let i=0;i<n.length+1;i++)if(i===n.length||t.indexOf(n[i])!==-1){const o=n.subarray(r,i);(!e||o.length!==0)&&s.push(o),r=i+1}}function j4(n,t,e){const s=n.length,r=[];let i=0,o=0;const a=new Array(s);for(let d=0;d<s;++d){const f=r.length;EF(n[d],t,e,r);const p=r.length-f;a[d]=p,i+=p,o=Math.max(o,p)}const u=En("int32",i*2),l=new Array(i),c=[s,o];let h=0;for(let d=0;d<s;++d)for(let f=0;f<a[d];++f)u[h*2]=d,u[h*2+1]=f,l[h]=r[h],++h;return[u,l,c]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H4(n,t){const e=En("int32",n.length);for(let s=0;s<n.length;++s)e[s]=_x(n[s]).modulo(t).getLowBitsUnsigned();return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K4=Dn((n,t)=>n-t),_F=Z2((n,t,e,s)=>({real:n-e,imag:t-s})),ny=qn(Dl,K4,_F),AF={kernelName:Dl,backendName:"cpu",kernelFunc:ny};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q4(n,t){const e=new Array(n.rank);for(let r=0;r<e.length;r++)e[r]=n.shape[r]*t[r];const s=Fe(e,n.dtype);for(let r=0;r<s.values.length;++r){const i=s.indexToLoc(r),o=new Array(n.rank);for(let u=0;u<o.length;u++)o[u]=i[u]%n.shape[u];const a=n.locToIndex(o);s.values[r]=n.values[a]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lc=(n,t)=>{const e=t.value-n.value;return e===0?n.index-t.index:e};function X4(n,t,e=0,s=n.length-1){for(;s>e;){if(s-e>600){const a=s-e+1,u=t-e+1,l=Math.log(a),c=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*c*(a-c)/a)*Math.sign(u-a/2),d=Math.max(e,Math.floor(t-u*c/a+h)),f=Math.min(s,Math.floor(t+(a-u)*c/a+h));X4(n,t,d,f)}const r=n[t];let i=e,o=s;for(Zi(n,e,t),lc(n[s],r)>0&&Zi(n,e,s);i<o;){for(Zi(n,i,o),i++,o--;lc(n[i],r)<0;)i=i+1;for(;lc(n[o],r)>0;)o=o-1}lc(n[e],r)===0?Zi(n,e,o):(o=o+1,Zi(n,o,s)),o<=t&&(e=o+1),t<=o&&(s=o-1)}}function Y4(n,t,e,s,r){const i=t[t.length-1],[o,a]=[n.length/i,i],u=ss(e,o*s),l=ss("int32",o*s);for(let h=0;h<o;h++){const d=h*a,f=n.subarray(d,d+a);let p=new Array(f.length);f.forEach((b,w)=>p[w]={value:b,index:w}),s<p.length&&(X4(p,s),p=p.slice(0,s)),r&&p.sort(lc);const m=h*s,g=u.subarray(m,m+s),y=l.subarray(m,m+s);for(let b=0;b<s;b++)g[b]=p[b].value,y[b]=p[b].index}const c=t.slice();return c[c.length-1]=s,[Fe(c,e,u),Fe(c,"int32",l)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z4(n,t,e,s){const r=Pe(t,e)[0],i=[1,e[0],1];for(let p=0;p<r;p++)i[0]*=e[p];i[1]=e[r];for(let p=r+1;p<e.length;p++)i[2]*=e[p];const o=new Map,a=new Int32Array(e[r]),u=new Vn(i,s,n),l=[],c=i[0]===1&&i[2]===1;for(let p=0;p<e[r];p++){let m;if(c)m=n[p].toString();else{const y=[];for(let b=0;b<i[0];b++)for(let w=0;w<i[2];w++)y.push(u.get(b,p,w));m=y.join(",")}const g=o.get(m);if(g!=null)a[p]=g;else{const y=o.size;o.set(m,y),a[p]=y,l.push(p)}}const h=i.slice();h[1]=o.size;const d=new Vn(h,s);l.forEach((p,m)=>{for(let g=0;g<i[0];g++)for(let y=0;y<i[2];y++)d.set(u.get(g,p,y),g,m,y)});const f=e.slice();return f[r]=h[1],{outputValues:d.values,outputShape:f,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RF=Object.freeze(Object.defineProperty({__proto__:null,addImpl:o4,bincountImpl:J2,bincountReduceImpl:a4,bitwiseAndImpl:u4,castImpl:i4,ceilImpl:l4,concatImpl:c4,equalImpl:h4,expImpl:f4,expm1Impl:m4,floorDivImpl:y4,floorImpl:g4,gatherNdImpl:b4,gatherV2Impl:x4,greaterEqualImpl:v4,greaterImpl:w4,lessEqualImpl:S4,lessImpl:k4,linSpaceImpl:I4,logImpl:C4,maxImpl:N4,maximumImpl:T4,minimumImpl:$4,multiplyImpl:Q2,negImpl:E4,notEqualImpl:_4,prodImpl:A4,raggedGatherImpl:R4,raggedRangeImpl:D4,raggedTensorToTensorImpl:O4,rangeImpl:F4,rsqrtImpl:L4,scatterImpl:$a,sigmoidImpl:bF,simpleAbsImpl:r4,sliceImpl:M4,sparseFillEmptyRowsImpl:z4,sparseReshapeImpl:B4,sparseSegmentReductionImpl:ey,sqrtImpl:vF,squaredDifferenceImpl:V4,staticRegexReplaceImpl:U4,stridedSliceImpl:W4,stringNGramsImpl:G4,stringSplitImpl:j4,stringToHashBucketFastImpl:H4,subImpl:K4,tileImpl:q4,topKImpl:Y4,transposeImpl:ty,uniqueImpl:Z4},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:DF,bincountImpl:J4,bincountReduceImpl:OF,bitwiseAndImpl:FF,castImpl:LF,ceilImpl:PF,concatImpl:MF,equalImpl:zF,expImpl:BF,expm1Impl:VF,floorImpl:UF,gatherNdImpl:WF,gatherV2Impl:GF,greaterImpl:jF,greaterEqualImpl:HF,lessImpl:KF,lessEqualImpl:qF,linSpaceImpl:XF,logImpl:YF,maxImpl:ZF,maximumImpl:JF,minimumImpl:QF,multiplyImpl:t8,negImpl:e8,notEqualImpl:n8,prodImpl:s8,raggedGatherImpl:r8,raggedRangeImpl:i8,raggedTensorToTensorImpl:o8,rangeImpl:a8,rsqrtImpl:u8,scatterImpl:l8,sigmoidImpl:c8,simpleAbsImpl:Q4,sliceImpl:h8,sparseFillEmptyRowsImpl:d8,sparseReshapeImpl:f8,sparseSegmentReductionImpl:tk,sqrtImpl:p8,staticRegexReplaceImpl:m8,stridedSliceImpl:g8,stringNGramsImpl:y8,stringSplitImpl:b8,stringToHashBucketFastImpl:x8,subImpl:w8,tileImpl:v8,topKImpl:k8,transposeImpl:sy,uniqueImpl:S8}=RF;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ek(n,t){return["x","y","z","w","u","v"].slice(0,t).map(e=>`${n}.${e}`)}function Rs(n,t){return t===1?[n]:ek(n,t)}function I8(n,t){if(n===1)return"rc";let e="";for(let s=0;s<n;s++)e+=t[s],s<n-1&&(e+=",");return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class C8{constructor(t){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.enableShapeUniforms=Ss(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const e=Rs("rc",this.rank),s=un(this.rank),r=this.getOutOfBoundsCondition(e),i=this.getSetup(e),o=this.getOutput(e);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${i}

            setOutput(vec4(${o}));
          }
        }
      `}}getSourceCoordsArr(t){const e=[];for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){let i=`${s===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let o=2;o<this.rank;o++)i=`${t[t.length-1-o]},`+i;e.push(i)}return e}getOutOfBoundsCondition(t){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let e="";for(let s=this.rank-2;s<this.rank;s++)e+=`${t[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(e+="||");return e}getSetup(t){if(this.rank===1)return"";const e=t.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${e[0]};
      int c = ${e[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${r};
    `}getOutput(t){const e=this.getSourceCoordsArr(t);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${e[0]}),
            cEdge ? 0. : getA(${e[1]}),
            rEdge ? 0. : getA(${e[2]}),
            rEdge || cEdge ? 0. : getA(${e[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nk{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=t,this.enableShapeUniforms=Ss(this.outputShape.length);let s="";for(let r=0;r<4;r++){let i="thisRC = rc;";r%2===1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),s+=`
        ${i}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${N8(e,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?X2():q2(t)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":t[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":t[2]};

        ${s}

        setOutput(result);
      }
    `}}function N8(n,t){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${t?dD(["r","c","d"],"inputShape"):ou(["r","c","d"],n)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class T8{constructor(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(t,e,s){const r=bb(e,s),i=xb(t,r,s);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);const o=yb(t,r,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const u=this.freeTextures[i].pop();return this.usedTextures[i].push(u),u}let a;return r===as.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):r===as.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):r===as.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):r===as.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):r===as.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[i].push(a),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),a}releaseTexture(t,e,s,r){if(this.freeTextures==null)return;const i=bb(s,r),o=xb(e,i,r);o in this.freeTextures||(this.freeTextures[o]=[]);const a=yb(e,i,this.gpgpu.gl,this.gpgpu.textureConfig,r),u=vt().get("WEBGL_DELETE_TEXTURE_THRESHOLD");u!==-1&&this._numBytesAllocated>u?(this.gpgpu.deleteMatrixTexture(t.texture),this._numBytesAllocated-=a):(this.freeTextures[o].push(t),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const l=this.usedTextures[o],c=l&&l.indexOf(t);if(c==null||c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l[c]=l[l.length-1],l.pop(),this.log()}log(){if(!this.logEnabled)return;const t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${t})`);const e=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*e)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const t in this.freeTextures)this.freeTextures[t].forEach(e=>{this.gpgpu.deleteMatrixTexture(e.texture)});for(const t in this.usedTextures)this.usedTextures[t].forEach(e=>{this.gpgpu.deleteMatrixTexture(e.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function $8(n,t){const e=n;if(t===e.R32F)return 4;if(t===e.R16F)return 2;if(t===e.RGBA32F)return 16;if(t===n.RGBA)return 16;if(t===e.RGBA16F)return 8;if(t===e.RGBA8)return 4;throw new Error(`Unknown internal format ${t}`)}function yb(n,t,e,s,r){const i=E8(t,s);let o;if(r){const[u,l]=jl(n[0],n[1]);o=u*l}else{const[u,l]=ld(n[0],n[1]);o=u*l}const a=$8(e,i);return o*a}function E8(n,t){switch(n){case as.PACKED_2X2_FLOAT32:return n4(t);case as.PACKED_2X2_FLOAT16:return s4(t);case as.UNPACKED_FLOAT32:return Qv(t);case as.UNPACKED_FLOAT16:return t4(t);case as.PACKED_4X1_UNSIGNED_BYTE:return e4(t);default:throw new Error(`Unknown physical texture type ${n}`)}}function _8(n){return vt().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?as.PACKED_2X2_FLOAT32:as.UNPACKED_FLOAT32:n?as.PACKED_2X2_FLOAT16:as.UNPACKED_FLOAT16}function bb(n,t){if(n===Sr.UPLOAD)return as.PACKED_2X2_FLOAT32;if(n===Sr.RENDER||n==null)return _8(t);if(n===Sr.DOWNLOAD||n===Sr.PIXELS)return as.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${n}`)}function xb(n,t,e){return`${n[0]}_${n[1]}_${t}_${e}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ei{constructor(t,e){this.variableNames=["A"],this.outputShape=t,this.enableShapeUniforms=Ss(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${e}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const Hr="if (isnan(x)) return x;",A8="return x;",wb="return abs(x);",R8="return (x >= 0.0) ? x : (exp(x) - 1.0);",D8=Hr+`
  return (x < 0.0) ? 0.0 : x;
`,O8=Hr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Do="return x;",F8="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L8="return x;",P8=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,M8=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,z8=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,B8="return 1.0 / (1.0 + exp(-1.0 * x));";class Fo{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.enableShapeUniforms=Ss(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${e}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class V8{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t,this.enableShapeUniforms=Ss(this.outputShape.length);const e=t.length,s=Rs("rc",e),r=un(e),i=I8(e,s),o=s.slice(-2),a=e<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${i});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U8=vm,W8=1e-7,G8=1e-4,Fd={};function j8(n){return n in Fd||(Fd[n]={}),Fd[n]}const H8=vt().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),K8=600;function q8(){return vt().global.screen==null?1024:vt().global.screen.height*vt().global.screen.width*window.devicePixelRatio*K8/1024/1024}class Mm extends Pf{nextDataId(){return Mm.nextDataId++}constructor(t){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!vt().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let e;if(t!=null){if(t instanceof mg)e=t;else{const s=ui(vt().getNumber("WEBGL_VERSION"),t);e=new mg(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=ui(vt().getNumber("WEBGL_VERSION"));e=new mg(s),this.binaryCache=j8(vt().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=e,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new T8(this.gpgpu),this.numMBBeforeWarning=q8(),this.texData=new M1(this,xr())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(t,e,s,r,i,o){const a=this.makeTensorInfo(e,s),u=this.texData.get(a.dataId);u.isPacked=!1,u.texture={texture:t,texShape:[r,i]},u.texShape=[r,i];const l=Dd(e),c=new db(l,!1,o),h=this.runWebGLProgram(c,[a],s,[[r,i]]);return h.shape=e,u.texture=null,this.disposeIntermediateTensorInfo(a),h.dataId}write(t,e,s){if((vt().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||vt().getBool("DEBUG"))&&this.checkNumericalProblems(t),s==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:e,dtype:s,values:t,usage:Sr.UPLOAD,refCount:1}),r}refCount(t){return this.texData.has(t)?this.texData.get(t).refCount:0}incRef(t){const e=this.texData.get(t);e.refCount++}decRef(t){if(this.texData.has(t)){const e=this.texData.get(t);e.refCount--}}move(t,e,s,r,i){if(vt().getBool("DEBUG")&&this.checkNumericalProblems(e),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:s,dtype:r,values:e,usage:Sr.UPLOAD,refCount:i})}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}readSync(t){const e=this.texData.get(t),{values:s,dtype:r,complexTensorInfos:i,slice:o,shape:a,isPacked:u}=e;if(o!=null){let d;u?d=new Fo(a,Do):d=new Ei(a,Do);const f=this.runWebGLProgram(d,[{dataId:t,shape:a,dtype:r}],r),p=this.readSync(f.dataId);return this.disposeIntermediateTensorInfo(f),p}if(s!=null)return this.convertAndCacheOnCPU(t);if(r==="string")return s;const l=this.activeTimers!=null;let c;l&&(c=$s());let h;if(r==="complex64"){const d=this.readSync(i.real.dataId),f=this.readSync(i.imag.dataId);h=ao(d,f)}else h=this.getValuesFromTexture(t);return l&&(this.downloadWaitMs+=$s()-c),this.convertAndCacheOnCPU(t,h)}async read(t){if(this.pendingRead.has(t)){const p=this.pendingRead.get(t);return new Promise(m=>p.push(m))}const e=this.texData.get(t),{values:s,shape:r,slice:i,dtype:o,complexTensorInfos:a,isPacked:u}=e;if(i!=null){let p;u?p=new Fo(r,Do):p=new Ei(r,Do);const m=this.runWebGLProgram(p,[{dataId:t,shape:r,dtype:o}],o),g=this.read(m.dataId);return this.disposeIntermediateTensorInfo(m),g}if(s!=null)return this.convertAndCacheOnCPU(t);if(vt().getBool("DEBUG")&&!vt().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&vt().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let l=null,c;if(o!=="complex64"&&vt().get("WEBGL_BUFFER_SUPPORTED")){c=this.decode(t);const p=this.texData.get(c.dataId);l=this.gpgpu.createBufferFromTexture(p.texture.texture,..._d(r))}this.pendingRead.set(t,[]),o!=="complex64"&&await this.gpgpu.createAndWaitForFence();let h;if(o==="complex64"){const p=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),m=p[0],g=p[1];h=ao(m,g)}else if(l==null)h=this.getValuesFromTexture(t);else{const p=Et(r);h=this.gpgpu.downloadFloat32MatrixFromBuffer(l,p)}if(c!=null&&this.disposeIntermediateTensorInfo(c),l!=null){const p=this.gpgpu.gl;re(p,()=>p.deleteBuffer(l))}const d=this.convertAndCacheOnCPU(t,h),f=this.pendingRead.get(t);return this.pendingRead.delete(t),f.forEach(p=>p(d)),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&xr().removeDataId(t,this),this.pendingDeletes--),d}readToGPU(t,e={}){const s=this.texData.get(t),{values:r,shape:i,slice:o,dtype:a,isPacked:u,texture:l}=s;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(o!=null){let f;u?f=new Fo(i,Do):f=new Ei(i,Do);const p=this.runWebGLProgram(f,[{dataId:t,shape:i,dtype:a}],a),m=this.readToGPU(p,e);return this.disposeIntermediateTensorInfo(p),m}if(l==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const c=this.decode(t,e.customTexShape),h=xr().makeTensorFromTensorInfo(c),d=this.texData.get(c.dataId);return Object.assign({tensorRef:h},d.texture)}bufferSync(t){const e=this.readSync(t.dataId);if(t.dtype==="string")try{const s=e.map(r=>no(r));return Fe(t.shape,t.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Fe(t.shape,t.dtype,e)}checkNumericalProblems(t){if(t!=null)for(let e=0;e<t.length;e++){const s=t[e];if(!z6(s))throw vt().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(t){const{shape:e,dtype:s,isPacked:r}=this.texData.get(t),i=Et(e);if(vt().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const d=this.decode(t),f=this.texData.get(d.dataId),p=this.gpgpu.downloadMatrixFromPackedTexture(f.texture.texture,..._d(e)).subarray(0,i);return this.disposeIntermediateTensorInfo(d),p}const o=vt().getBool("WEBGL_PACK")&&r===!0,a=o?Dd(e):e,u=o?new eO(a):new tO(a),l=this.runWebGLProgram(u,[{shape:a,dtype:s,dataId:t}],"float32"),c=this.texData.get(l.dataId),h=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(c.texture.texture,c.texShape[0],c.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(l),h}timerAvailable(){return vt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(t){const e=this.activeTimers,s=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=s,r=!0):this.activeTimers.push(s),this.activeTimers=s,t();const i=Pi(this.activeTimers.map(u=>u.query)).filter(u=>u!=null),o=Pi(this.activeTimers.map(u=>u.name)).filter(u=>u!=null);this.activeTimers=e,r&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(vt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const u=await Promise.all(i);a.kernelMs=ux(u),a.getExtraProfileInfo=()=>u.map((l,c)=>({name:o[c],ms:l})).map(l=>`${l.name}: ${l.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return vt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:$s(),endMs:null}}endTimer(t){return vt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=$s(),t)}async getQueryTime(t){if(vt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(t);const e=t;return e.endMs-e.startMs}disposeData(t,e=!1){if(this.pendingDisposal.has(t))return!1;if(!this.texData.has(t))return!0;if(e?this.texData.get(t).refCount=0:this.texData.get(t).refCount--,!e&&this.texData.get(t).refCount>0)return!1;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),this.pendingDeletes++,!1;this.releaseGPUData(t);const{complexTensorInfos:s}=this.texData.get(t);return s!=null&&(this.disposeData(s.real.dataId,e),this.disposeData(s.imag.dataId,e)),this.texData.delete(t),!0}releaseGPUData(t){const{texture:e,dtype:s,texShape:r,usage:i,isPacked:o,slice:a}=this.texData.get(t),u=a&&a.origDataId||t,l=this.dataRefCount.get(u);l>1?this.dataRefCount.set(u,l-1):(this.dataRefCount.delete(u),e!=null&&(this.numBytesInGPU-=this.computeBytes(r,s),this.textureManager.releaseTexture(e,r,i,o)));const c=this.texData.get(t);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null}getTexture(t){return this.uploadToGPU(t),this.texData.get(t).texture.texture}getDataInfo(t){return this.texData.get(t)}shouldExecuteOnCPU(t,e=H8){return vt().getBool("WEBGL_CPU_FORWARD")&&t.every(s=>this.texData.get(s.dataId).texture==null&&Et(s.shape)<e)}getGPGPUContext(){return this.gpgpu}where(t){wr("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const e=t.dataSync();return U8(t.shape,e)}packedUnaryOp(t,e,s){const r=new Fo(t.shape,e),i=this.compileAndRun(r,[t],s);return xr().makeTensorFromTensorInfo(i)}abs(t){if(this.shouldExecuteOnCPU([t])&&t.dtype!=="complex64"){const r=Q4(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,r)}if(vt().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,wb,t.dtype);const e=new Ei(t.shape,wb),s=this.compileAndRun(e,[t]);return xr().makeTensorFromTensorInfo(s)}makeTensorInfo(t,e,s){let r;if(e==="string"&&s!=null&&s.length>0&&$i(s[0])){const i=s.map(o=>Ai(o));r=this.write(i,t,e)}else r=this.write(s,t,e);return this.texData.get(r).usage=null,{dataId:r,shape:t,dtype:e}}makeOutput(t,e,s){return xr().makeTensorFromTensorInfo(this.makeTensorInfo(t,e,s),this)}unpackTensor(t){const e=new V8(t.shape);return this.runWebGLProgram(e,[t],t.dtype)}packTensor(t){const e=new C8(t.shape),s=!0;return this.runWebGLProgram(e,[t],t.dtype,null,s)}packedReshape(t,e){const s=[Pu(t.shape),...Mu(t.shape)],r={dtype:t.dtype,shape:s,dataId:t.dataId},i=[Pu(e),...Mu(e)],o=new nk(i,s),a=!0,u=[s],l=this.runWebGLProgram(o,[r],t.dtype,u,a);return{dataId:l.dataId,shape:e,dtype:l.dtype}}decode(t,e){const s=this.texData.get(t),{isPacked:r,shape:i,dtype:o}=s;if(e!=null){const d=Et(i),f=e[0]*e[1]*4;V(d<=f,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=Dd(i);let u;r?u=new QD(a):u=new JD(a);const l=!0,c=[e??_d(a)],h=this.runWebGLProgram(u,[{shape:a,dtype:o,dataId:t}],o,c,l,e);return{dtype:o,shape:i,dataId:h.dataId}}runWebGLProgram(t,e,s,r,i=!1,o){const a=this.makeTensorInfo(t.outputShape,s),u=this.texData.get(a.dataId);if(t.packedOutput&&(u.isPacked=!0),t.outPackingScheme===Ec.DENSE){const y=o??_d(t.outputShape);u.texShape=y.map(b=>b*2)}if(t.outTexUsage!=null&&(u.usage=t.outTexUsage),Et(a.shape)===0)return u.values=ss(a.dtype,0),a;const l=[],c=e.map(y=>{if(y.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let b=this.texData.get(y.dataId);if(b.texture==null){if(!t.packedInputs&&Et(y.shape)<=vt().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:y.shape,texData:null,isUniform:!0,uniformValues:b.values};t.packedInputs&&(b.isPacked=!0,b.shape=y.shape)}if(this.uploadToGPU(y.dataId),!!b.isPacked!=!!t.packedInputs)y=b.isPacked?this.unpackTensor(y):this.packTensor(y),l.push(y),b=this.texData.get(y.dataId);else if(b.isPacked&&!ff(b.shape,y.shape)){const w=y,v=y.shape;y.shape=b.shape,y=this.packedReshape(y,v),l.push(y),b=this.texData.get(y.dataId),w.shape=v}return{shape:y.shape,texData:b,isUniform:!1}});this.uploadToGPU(a.dataId);const h={shape:a.shape,texData:u,isUniform:!1},d=ZD(t,c,h),f=this.getAndSaveBinary(d,()=>XD(this.gpgpu,t,c,h)),p=this.activeTimers!=null;let m;p&&(m=this.startTimer()),vt().get("ENGINE_COMPILE_ONLY")||YD(this.gpgpu,f,c,h,r),l.forEach(y=>this.disposeIntermediateTensorInfo(y)),p&&(m=this.endTimer(m),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(m)}));const g=vt().get("WEBGL_FLUSH_THRESHOLD");if(g>0){const y=$s();y-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=y)}if(!vt().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&i===!1){const y=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),y}return a}compileAndRun(t,e,s,r,i=!1){return s=s||e[0].dtype,this.runWebGLProgram(t,e,s,r,i)}getAndSaveBinary(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(vt().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(e=>{this.gpgpu.deleteProgram(this.binaryCache[e].webGLProgram),delete this.binaryCache[e]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=pt(()=>{if(!vt().get("WEBGL_RENDER_FLOAT32_ENABLED")){const t=vt().getBool("DEBUG");vt().set("DEBUG",!1);const e=this.abs(fe(1e-8)).dataSync()[0];if(vt().set("DEBUG",t),e>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?W8:G8}uploadToGPU(t){const e=this.texData.get(t),{shape:s,dtype:r,values:i,texture:o,usage:a,isPacked:u}=e;if(o!=null)return;const l=this.activeTimers!=null;let c;l&&(c=$s());let h=e.texShape;if(h==null&&(h=sD(s,u),e.texShape=h),i!=null){const d=Dd(s);let f,p=h[1],m=h[0];const g=i instanceof Uint8Array||i instanceof Uint8ClampedArray;(u||!g)&&([p,m]=jl(h[0],h[1])),u?f=new sO(d,g):f=new db(d,g);const y=g?[m,p]:h,b=this.makeTensorInfo(y,r),w=this.texData.get(b.dataId);g?w.usage=Sr.PIXELS:w.usage=Sr.UPLOAD,w.texShape=y,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(b.dataId),p,m,i);const v=[[m,p]],S=!0,N=this.runWebGLProgram(f,[b],r,v,S),R=this.texData.get(N.dataId);e.texShape=R.texShape,e.isPacked=R.isPacked,e.usage=R.usage,vt().get("ENGINE_COMPILE_ONLY")?this.disposeData(N.dataId):(e.texture=R.texture,e.values=null,this.texData.delete(N.dataId)),this.disposeIntermediateTensorInfo(b),l&&(this.uploadWaitMs+=$s()-c)}else{const d=this.acquireTexture(h,a,r,u);e.texture=d}}convertAndCacheOnCPU(t,e){const s=this.texData.get(t),{dtype:r}=s;return e!=null&&(s.values=X8(e,r)),s.values}acquireTexture(t,e,s,r){if(this.numBytesInGPU+=this.computeBytes(t,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${i} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(t,e,r)}computeBytes(t,e){return t[0]*t[1]*yc(e)}checkCompileCompletion(){for(const[,t]of Object.entries(this.binaryCache))this.checkCompletion_(t)}async checkCompileCompletionAsync(){const t=[];if(this.gpgpu.parallelCompilationExtension){for(const[,e]of Object.entries(this.binaryCache))t.push(this.checkCompletionAsync_(e));return Promise.all(t)}else{for(const[,e]of Object.entries(this.binaryCache)){const s=new Promise(r=>{try{this.checkCompletion_(e),r(!0)}catch(i){throw i}});t.push(s)}return Promise.all(t)}}async checkCompletionAsync_(t){return this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(t):(await T2(),this.checkCompletionAsync_(t))}checkCompletion_(t){if(this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(t.webGLProgram)),this.gpgpu.gl.getShaderParameter(t.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(Kv(t.source,this.gpgpu.gl.getShaderInfoLog(t.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const t of Object.values(this.binaryCache)){this.gpgpu.buildVao(t.webGLProgram);const{variablesLocations:e,customUniformLocations:s,infLoc:r,nanLoc:i,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:u}=Jv(this.gpgpu,t.program,t.webGLProgram);t.variablesLocations=e,t.customUniformLocations=s,t.infLoc=r,t.nanLoc=i,t.outShapeLocation=o,t.outShapeStridesLocation=a,t.outTexShapeLocation=u}}createTensorFromGPUData(t,e,s){t.channels=t.channels||"RGBA";const{texture:r,height:i,width:o,channels:a}=t,u=xr().backend;if(!u.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const l=u.writeTexture(r,e,s,i,o,a);return xr().makeTensorFromDataId(l,e,s,u)}}Mm.nextDataId=0;function X8(n,t){if(t==="float32"||t==="complex64")return n;if(t==="int32"||t==="bool"){const e=t==="int32"?new Int32Array(n.length):new Uint8Array(n.length);for(let s=0;s<e.length;++s)e[s]=Math.round(n[s]);return e}else throw new Error(`Unknown dtype ${t}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */X1()&&t0("webgl",()=>new Mm,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ry=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class ja{constructor(t,e,s){this.variableNames=["A","B"],this.outputShape=Ee(e,s),this.enableShapeUniforms=Ss(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${t}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uu=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class Yl{constructor(t,e,s,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Ee(e,s);const i=this.outputShape.length;this.enableShapeUniforms=Ss(i);let o="";if(r)if(i===0||Et(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          ${un(i)} coords = getOutputCoords();
        `,i===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const u=Rs("coords",i);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (${u[i-2]} + 1) >= outShape[${i} - 2];
            bool nextColOutOfBounds =
              (${u[i-1]} + 1) >= outShape[${i} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:o+=`
            bool nextRowOutOfBounds =
              (${u[i-2]} + 1) >= ${this.outputShape[i-2]};
            bool nextColOutOfBounds =
              (${u[i-1]} + 1) >= ${this.outputShape[i-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${t}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${o}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hr(n){const{inputs:t,backend:e}=n,{x:s}=t;return e.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const Y8={kernelName:ll,backendName:"webgl",kernelFunc:hr};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oa(n){const{inputs:t,backend:e}=n,{real:s,imag:r}=t,i=e.makeTensorInfo(s.shape,"complex64"),o=e.texData.get(i.dataId),a=hr({inputs:{x:s},backend:e}),u=hr({inputs:{x:r},backend:e});return o.complexTensorInfos={real:a,imag:u},i}const Z8={kernelName:Hf,backendName:"webgl",kernelFunc:oa};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sk="return (a < 0.) ? b * a : a;",rk=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function J8(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{alpha:i}=s,o=e.makeTensorInfo([],"float32",fo(i,"float32")),a=vt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Yl(rk,r.shape,o.shape):new ja(sk,r.shape,o.shape),u=e.runWebGLProgram(a,[r,o],"float32");return e.disposeIntermediateTensorInfo(o),u}const Q8={kernelName:oh,backendName:"webgl",kernelFunc:J8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ik="return (a < 0.) ? b * a : a;",ok=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function t7(n){const{inputs:t,backend:e}=n,{x:s,alpha:r}=t,i=vt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Yl(ok,s.shape,r.shape):new ja(ik,s.shape,r.shape);return e.runWebGLProgram(i,[s,r],"float32")}const e7={kernelName:Ch,backendName:"webgl",kernelFunc:t7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zl="if (isnan(x)) return x;";function qe({opSnippet:n,packedOpSnippet:t,cpuKernelImpl:e,dtype:s}){return({inputs:r,backend:i})=>{const{x:o}=r,a=i,u=s||o.dtype;if(a.shouldExecuteOnCPU([o])&&e!=null){const h=a.texData.get(o.dataId),d=e(h.values,u);return a.makeTensorInfo(o.shape,u,d)}const l=vt().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&t!=null;let c;return l?c=new Fo(o.shape,t):c=new Ei(o.shape,n),a.runWebGLProgram(c,[o],u)}}function ps({opSnippet:n,packedOpSnippet:t,checkOutOfBounds:e=!1,supportsComplex:s=!1,cpuKernelImpl:r,dtype:i}){return({inputs:o,backend:a})=>{const{a:u,b:l}=o,c=a;if(s&&u.dtype==="complex64"){const p=c.texData.get(u.dataId),m=c.texData.get(l.dataId),[g,y]=[[p.complexTensorInfos.real,m.complexTensorInfos.real],[p.complexTensorInfos.imag,m.complexTensorInfos.imag]].map(w=>{const[v,S]=w,N={dataId:v.dataId,dtype:v.dtype,shape:u.shape},R={dataId:S.dataId,dtype:S.dtype,shape:l.shape},L=new ja(n,u.shape,l.shape);return c.runWebGLProgram(L,[N,R],qs(v.dtype,S.dtype))}),b=oa({inputs:{real:g,imag:y},backend:c});return c.disposeIntermediateTensorInfo(g),c.disposeIntermediateTensorInfo(y),b}const h=i||qs(u.dtype,l.dtype);if((u.dtype==="string"||l.dtype==="string"||c.shouldExecuteOnCPU([u,l]))&&r!=null){const p=c.texData.get(u.dataId).values,m=c.texData.get(l.dataId).values,g=u.dtype==="string"?uo(p):p,y=u.dtype==="string"?uo(m):m,[b,w]=r(u.shape,l.shape,g,y,h),v=c.makeTensorInfo(w,h),S=c.texData.get(v.dataId);return S.values=b,v}const d=vt().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&t!=null;let f;return d?f=new Yl(t,u.shape,l.shape,e):f=new ja(n,u.shape,l.shape),c.runWebGLProgram(f,[u,l],h)}}function _c(n,t=!1){if(n==="linear")return t?L8:A8;if(n==="relu")return t?M8:D8;if(n==="elu")return t?P8:R8;if(n==="relu6")return t?z8:O8;if(n==="prelu")return t?ok:ik;if(n==="leakyrelu")return t?rk:sk;if(n==="sigmoid")return t?B8:F8;throw new Error(`Activation ${n} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ak{constructor(t,e,s,r=!1,i=!1,o=!1,a=null,u=!1,l=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=Ss(this.outputShape.length);const c=r?t[1]:t[2],h=Math.ceil(c/2),d=r?"i * 2, rc.y":"rc.y, i * 2",f=i?"rc.z, i * 2":"i * 2, rc.z",p=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let g="",y="";a&&(u?g=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:l?g=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:g=`vec4 activation(vec4 x) {
          ${a}
        }`,y="result = activation(result);");const b=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha");let w="rc.x",v="rc.x";t[0]<e[0]?w=`imod(rc.x, ${t[0]})`:e[0]<t[0]&&(v=`imod(rc.x, ${e[0]})`),this.userCode=`
      ${g}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${h}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${w};
        int batchB = ${v};
        for (int i = 0; i < ${h}; i++) {
          vec4 a = getMatrixA(batchA, ${d});
          vec4 b = getMatrixB(batchB, ${f});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${p[0]} * ${m[0]});
          result += (${p[1]} * ${m[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${b}

        ${y}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vb={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class kb{constructor(t,e,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Ee(e,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${t}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sb="return a * b;";function iy(n){const{inputs:t,backend:e}=n,{a:s,b:r}=t,i=qs(s.dtype,r.dtype);if(s.dtype==="complex64"){const a=e.texData.get(s.dataId),u=e.texData.get(r.dataId),l=new kb(vb.REAL,s.shape,r.shape),c=new kb(vb.IMAG,s.shape,r.shape),h=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:s.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:u.complexTensorInfos.real.dataId,dtype:u.complexTensorInfos.real.dtype,shape:r.shape},{dataId:u.complexTensorInfos.imag.dataId,dtype:u.complexTensorInfos.imag.dtype,shape:r.shape}],d=e.runWebGLProgram(l,h,"float32"),f=e.runWebGLProgram(c,h,"float32"),p=oa({inputs:{real:d,imag:f},backend:e});return e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(f),p}if(e.shouldExecuteOnCPU([s,r])){const a=e.texData.get(s.dataId),u=e.texData.get(r.dataId),[l,c]=t8(s.shape,r.shape,a.values,u.values,i),h=e.makeTensorInfo(c,i),d=e.texData.get(h.dataId);return d.values=l,h}let o;return vt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?o=new Yl(Sb,s.shape,r.shape):o=new ja(Sb,s.shape,r.shape),e.runWebGLProgram(o,[s,r],i)}const n7={kernelName:bl,backendName:"webgl",kernelFunc:iy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s7(n,t,e){const s=[Pu(n.shape),...Mu(n.shape)],r={dtype:n.dtype,shape:s,dataId:n.dataId},i=[Pu(t),...Mu(t)],o=new nk(i,s),a=!0,u=[s],l=e.runWebGLProgram(o,[r],n.dtype,u,a);return{dataId:l.dataId,shape:t,dtype:l.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{shape:i}=s,o=e,a=Et(r.shape),u=B1(i,a),l=Et(u);V(a===l,()=>`The new shape (${u}) has ${l} elements and the old shape (${r.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const c=o.texData.get(r.dataId);return c.isPacked&&!ff(r.shape,u)&&!(c.texture!==null&&ff(c.shape,u))?s7(r,u,o):(o.incRef(r.dataId),{dataId:r.dataId,shape:u,dtype:r.dtype})}const r7={kernelName:Th,backendName:"webgl",kernelFunc:Qt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ib{constructor(t,e){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:i,outSize:o}=t;this.outputShape=[r,o];const a=Math.floor(s/4)*4,u=s%4;let l="sumValue += dot(values, ones);";if(e!=null){const h=1/e;l=`sumValue += dot(values * ${Oa(h)?h.toPrecision(2):h}, ones);`}let c="";i%s>0&&(c=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${c}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${l}
        }

        int inIdx = inOffset + ${a};
        if (${u===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${l}
        } else if (${u===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${l}
        } else if (${u===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${l}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class i7{constructor(t,e){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:i,outSize:o}=t;this.outputShape=[r,o];let a="0.0",u="";e==="prod"?a="1.0":e==="min"?(a="1.0 / 1e-20",u="min"):e==="max"&&(a="-1.0 / 1e-20",u="max");let l=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="sum"?l="sumValue":e==="prod"?l="prodValue":e==="all"?l="allValue":e==="any"&&(l="anyValue");const c=Math.floor(s/4)*4,h=s%4;let d=`
      if (${e==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${e==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${u}(values, minMaxValue);
        if (${e==="min"} || ${e==="max"}) {
          minMaxValue = ${u}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,f="vec4";e==="all"?(a="1.0",d=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):e==="any"&&(a="0.0",d=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");let p="";i%s>0&&(p=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${c}; i += 4) {
          int inIdx = inOffset + i;
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${d}
        }

        int inIdx = inOffset + ${c};
        if (${h===1}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${d}
        } else if (${h===2}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${d}
        } else if (${h===3}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${d}
        }
        setOutput(${l});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o7(n){const t=[];for(;t.length===0||t[t.length-1].outSize!==1;){const e=t.length?t[t.length-1].outSize:n[1],s=Dm(e);t.push({inSize:e,windowSize:s,outSize:Math.ceil(e/s)})}return t}function lu(n,t,e,s){const r=o7(n.shape);let i=n;for(let o=0;o<r.length;o++){const{inSize:a,windowSize:u,outSize:l}=r[o];let c,h;e==="mean"?c=o===0?new Ib({windowSize:u,inSize:a,batchSize:n.shape[0],outSize:l},a):new Ib({windowSize:u,inSize:a,batchSize:n.shape[0],outSize:l}):c=new i7({windowSize:u,inSize:a,batchSize:n.shape[0],outSize:l},e),h=i,i=s.runWebGLProgram(c,[i],t),h.dataId!==n.dataId&&s.disposeIntermediateTensorInfo(h)}return i}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class a7{constructor(t,e){this.variableNames=["A"];const s=new Array(t.length);for(let o=0;o<s.length;o++)s[o]=t[e[o]];this.outputShape=s,this.rank=s.length;const r=un(this.rank),i=u7(e);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${i}));
    }
    `}}function u7(n){const t=n.length;if(t>6)throw Error(`Transpose for rank ${t} is not yet supported`);const e=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(t);for(let r=0;r<n.length;r++)s[n[r]]=e[r];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class l7{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(t.length);for(let c=0;c<s.length;c++)s[c]=t[e[c]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=un(this.rank),i=ek("rc",this.rank),o=new Array(this.rank);for(let c=0;c<e.length;c++)o[e[c]]=i[c];const a=`vec2(${o.slice(-2).join()})`,u=`++${i[this.rank-1]} < ${s[this.rank-1]}`,l=`getChannel(getA(${o.join()}), ${a})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${l};
      if(${u}) {
        result[1] = ${l};
      }
      --${i[this.rank-1]};
      if(++${i[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${l};
        if(${u}) {
          result[3] = ${l};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zm(n,t,e){const s=vt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new l7(n.shape,t):new a7(n.shape,t);return e.runWebGLProgram(s,[n],n.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c7(n,t,e,s){const r=t,i=n.shape.length,o=Pe(r,n.shape);let a=o;const u=Tn(a,i),l=u!=null;let c=n;l&&(c=zm(n,u,s),a=Rn(a.length,i)),fs("sum",a,i);const[h,d]=is(c.shape,a);let f=h;e&&(f=An(h,o));const p=Et(d),g=Et(n.shape)/p,y=Qt({inputs:{x:c},attrs:{shape:[g,p]},backend:s}),b=Hp(n.dtype),w=lu(y,b,"sum",s),v=Qt({inputs:{x:w},attrs:{shape:f},backend:s});return s.disposeIntermediateTensorInfo(y),s.disposeIntermediateTensorInfo(w),l&&s.disposeIntermediateTensorInfo(c),v}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bm(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i,keepDims:o}=s;return c7(r,i,o,e)}const h7={kernelName:Dh,backendName:"webgl",kernelFunc:Bm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ls(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{perm:i}=s,o=e,a=r.shape.length,u=new Array(a);for(let c=0;c<u.length;c++)u[c]=r.shape[i[c]];let l;if(o.shouldExecuteOnCPU([r])){const h=o.texData.get(r.dataId).values,d=sy(h,r.shape,r.dtype,i,u);l=o.makeTensorInfo(u,r.dtype);const f=o.texData.get(l.dataId);f.values=d}else l=zm(r,i,o);return l}const d7={kernelName:_a,backendName:"webgl",kernelFunc:Ls};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uk=1e3;function gf({a:n,b:t,transposeA:e,transposeB:s,backend:r,bias:i=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:u=null}){const l=n.shape.length,c=t.shape.length,h=e?n.shape[l-2]:n.shape[l-1],d=s?t.shape[c-1]:t.shape[c-2],f=e?n.shape[l-1]:n.shape[l-2],p=s?t.shape[c-2]:t.shape[c-1],m=n.shape.slice(0,-2),g=t.shape.slice(0,-2),y=Et(m),b=Et(g),v=Ee(n.shape.slice(0,-2),t.shape.slice(0,-2)).concat([f,p]);V(h===d,()=>`Error in matMul: inner shapes (${h}) and (${d}) of Tensors with shapes ${n.shape} and ${t.shape} and transposeA=${e} and transposeB=${s} must match.`);const S=e?[y,h,f]:[y,f,h],N=s?[b,p,d]:[b,d,p],R=Qt({inputs:{x:n},backend:r,attrs:{shape:S}}),L=Qt({inputs:{x:t},backend:r,attrs:{shape:N}}),F=[R,L],B=Math.max(y,b),H=e?R.shape[1]:R.shape[2],z=i!=null,G=o!=null,T=u==="leakyrelu",K=u!=null?_c(u,!0):null,ht=z||G||T||K!=null;let rt;if((f===1||p===1)&&H>uk&&ht===!1){let at=R,It=L;e&&(at=Ls({inputs:{x:R},backend:r,attrs:{perm:[0,2,1]}}),F.push(at)),s&&(It=Ls({inputs:{x:L},backend:r,attrs:{perm:[0,2,1]}}),F.push(It));const et=p!==1,st=p===1;let St=at;et&&(St=Qt({inputs:{x:at},backend:r,attrs:{shape:[B,H,1]}}),F.push(St));const kt=p===1?2:1;let yt=It;st&&(yt=Qt({inputs:{x:It},backend:r,attrs:{shape:[B,1,H]}}),F.push(yt));const Pt=iy({inputs:{a:St,b:yt},backend:r});rt=Bm({inputs:{x:Pt},backend:r,attrs:{axis:kt,keepDims:!0}}),F.push(Pt)}else{const at=qs(n.dtype,t.dtype),It=new ak(S,N,[B,f,p],e,s,z,K,G,T),et=[R,L];if(i!=null&&et.push(i),G&&et.push(o),T){const st=r.makeTensorInfo([],"float32",fo(a,"float32"));et.push(st),F.push(st)}rt=r.runWebGLProgram(It,et,at)}const gt=Qt({inputs:{x:rt},backend:r,attrs:{shape:v}});F.push(rt);for(const at of F)r.disposeIntermediateTensorInfo(at);return gt}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f7(n){const{inputs:t,backend:e,attrs:s}=n,{a:r,b:i,bias:o,preluActivationWeights:a}=t,{transposeA:u,transposeB:l,activation:c,leakyreluAlpha:h}=s;return gf({a:r,b:i,transposeA:u,transposeB:l,backend:e,bias:o,preluActivationWeights:a,leakyreluAlpha:h,activation:c})}const p7={kernelName:bc,backendName:"webgl",kernelFunc:f7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cb="return abs(x);";function m7(n){const{inputs:t,backend:e}=n,{x:s}=t;if(e.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const i=e.texData.get(s.dataId),o=Q4(i.values);return e.makeTensorInfo(s.shape,s.dtype,o)}let r;return vt().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new Fo(s.shape,Cb):r=new Ei(s.shape,Cb),e.runWebGLProgram(r,[s],s.dtype)}const g7={kernelName:Mc,backendName:"webgl",kernelFunc:m7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y7=Hr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,b7=qe({opSnippet:y7}),x7={kernelName:Wu,backendName:"webgl",kernelFunc:b7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w7=Hr+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,v7=qe({opSnippet:w7}),k7={kernelName:Gu,backendName:"webgl",kernelFunc:v7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nb="return a + b;",S7=ps({opSnippet:Nb,packedOpSnippet:Nb,supportsComplex:!0,cpuKernelImpl:DF}),I7={kernelName:Za,backendName:"webgl",kernelFunc:S7};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class C7{constructor(t,e){this.outputShape=[],this.outputShape=t,this.variableNames=e.map((i,o)=>`T${o}`);const s=[];this.variableNames.forEach(i=>{s.push(`float v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class N7{constructor(t,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=e.map((i,o)=>`T${o}`);const s=[];this.variableNames.forEach(i=>{s.push(`vec4 v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qd(n){const{inputs:t,backend:e}=n,s=t;if(s.length===1)return hr({inputs:{x:s[0]},backend:e});if(s.length>vt().get("WEBGL_MAX_TEXTURES_IN_SHADER")){const u=Math.floor(s.length/2),l=Qd({inputs:s.slice(0,u),backend:e}),c=Qd({inputs:s.slice(u),backend:e});return Qd({inputs:[l,c],backend:e})}const r=s.map(u=>u.dtype).reduce((u,l)=>qs(u,l)),i=s.map(u=>u.shape),a=vt().getBool("WEBGL_PACK")?new N7(s[0].shape,i):new C7(s[0].shape,i);return e.runWebGLProgram(a,s,r)}const T7={kernelName:zc,backendName:"webgl",kernelFunc:Qd};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $7(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i,keepDims:o}=s,a=r.shape.length,u=Pe(i,r.shape);let l=u;const c=Tn(l,a);let h=r;c!=null&&(h=Ls({inputs:{x:r},backend:e,attrs:{perm:c}}),l=Rn(l.length,a)),fs("all",l,a);const[d,f]=is(h.shape,l),p=Et(f),m=Qt({inputs:{x:h},backend:e,attrs:{shape:[-1,p]}}),g=lu(m,m.dtype,"all",e);let y;if(o){const b=An(d,u);y=Qt({inputs:{x:g},backend:e,attrs:{shape:b}})}else y=Qt({inputs:{x:g},backend:e,attrs:{shape:d}});return e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(g),c!=null&&e.disposeIntermediateTensorInfo(h),y}const E7={kernelName:Bf,backendName:"webgl",kernelFunc:$7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _7(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i,keepDims:o}=s,a=r.shape.length,u=Pe(i,r.shape);let l=u;const c=Tn(l,a);let h=r;c!=null&&(h=Ls({inputs:{x:r},backend:e,attrs:{perm:c}}),l=Rn(l.length,a)),fs("any",l,a);const[d,f]=is(h.shape,l),p=Et(f),m=Qt({inputs:{x:h},backend:e,attrs:{shape:[-1,p]}}),g=lu(m,m.dtype,"any",e);let y;if(o){const b=An(d,u);y=Qt({inputs:{x:g},backend:e,attrs:{shape:b}})}else y=Qt({inputs:{x:g},backend:e,attrs:{shape:d}});return e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(g),c!=null&&e.disposeIntermediateTensorInfo(h),y}const A7={kernelName:Vf,backendName:"webgl",kernelFunc:_7};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class R7{constructor(t,e,s){this.variableNames=["A"];const{windowSize:r,batchSize:i,outSize:o}=t;s||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];const a=e==="max"?">":"<",u=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${u};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class D7{constructor(t,e,s,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,V(t.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const i=t[t.length-1],o=Math.ceil(i/e);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");const a=this.outputShape,u=a.length,l=un(u),c=Rs("coords",u);let h,d;if(o===1){d=u+1;const L=un(d);h=`
        ${L} sourceLocR = ${L}(${c.join()}, 0);
        ++${c[u-1]};
        ${L} sourceLocG = ${L}(${c.join()}, 0);
        ++${c[u-2]};
        ${L} sourceLocA = ${L}(${c.join()}, 0);
        --${c[u-1]};
        ${L} sourceLocB = ${L}(${c.join()}, 0);
        --${c[u-2]};`}else d=u,h=`
        ${l} sourceLocR = coords;
        ++${c[u-1]};
        ${l} sourceLocG = coords;
        ++${c[u-2]};
        ${l} sourceLocA = coords;
        --${c[u-1]};
        ${l} sourceLocB = coords;
        --${c[u-2]};`;const f=["x","y","z","w","u","v"].slice(0,d),p="."+f[d-1],m=f.map(L=>"int "+L),g=Rs("sourceLocR",d-1).concat("inIdx.r"),y=Rs("sourceLocG",d-1).concat("inIdx.g"),b=Rs("sourceLocB",d-1).concat("inIdx.b"),w=Rs("sourceLocA",d-1).concat("inIdx.a"),v=s==="max"?"greaterThan":"lessThan",S=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${g.join()}),
                             getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${b.join()}),
                             getBestIndicesAChannel(${w.join()})));`,N=`vec4(
            getAChannel(${g.join()}),
            hasNextCol ? getAChannel(${y.join()}) : 0.,
            hasNextRow ? getAChannel(${b.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${w.join()}) : 0.)`,R=r?"":`
      float getBestIndicesAChannel(${m.join()}) {
        return getChannel(getBestIndicesA(${f.join()}),
                                          vec2(${f.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${m.join()}) {
        return getChannel(getA(${f.join()}),
                               vec2(${f.slice(-2).join()}));
      }
      ${R}
      void main() {
        ${l} coords = getOutputCoords();
        bool hasNextCol = ${c[u-1]} < ${a[u-1]-1};
        bool hasNextRow = ${c[u-2]} < ${a[u-2]-1};
        ${h}
        ivec4 srcIdx = ivec4(sourceLocR${p}, sourceLocG${p},
          sourceLocB${p}, sourceLocA${p}) * ${e};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${N};

        for (int i = 0; i < ${e}; i++) {
          inIdx = srcIdx;
          ${S}
          vec4 candidate = ${N};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${v}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lk(n,t,e,s=null){let r=t.shape[0],i=t.shape[1];s!=null&&(r=s.shape[0],i=s.shape[1]);const o=Dm(i),a={windowSize:o,inSize:i,batchSize:r,outSize:Math.ceil(i/o)},u=new R7(a,e,s==null),l=[t];s!=null&&l.push(s);const c=n.runWebGLProgram(u,l,"int32");if(c.shape[1]===1)return c;const h=lk(n,t,e,c);return n.disposeIntermediateTensorInfo(c),h}function ck(n,t,e,s=null){const r=s!=null?s.shape:t.shape,i=r[r.length-1],o=Dm(i),a=new D7(r,o,e,s==null),u=s==null?[t]:[t,s],l=n.runWebGLProgram(a,u,"int32");if(l.shape.length===t.shape.length){const c=ck(n,t,e,l);return n.disposeIntermediateTensorInfo(l),c}return l}function hk(n,t,e,s){const r=[e];if(fs("arg"+s.charAt(0).toUpperCase()+s.slice(1),r,t.shape.length),!vt().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){const i=[],o=n.texData.get(t.dataId),a=o!==null&&o.isPacked;let u=t;a&&(u=n.unpackTensor(t),i.push(u));const[l,c]=is(u.shape,r),h=Et(c),d=Qt({inputs:{x:u},backend:n,attrs:{shape:[-1,h]}});i.push(d);const f=lk(n,d,s);i.push(f);const p=Qt({inputs:{x:f},backend:n,attrs:{shape:l}});return i.forEach(m=>n.disposeIntermediateTensorInfo(m)),p}return ck(n,t,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O7(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i}=s;let o=Pe(i,r.shape);const a=Tn(o,r.shape.length);let u=r;const l=[];a!=null&&(u=Ls({inputs:{x:r},backend:e,attrs:{perm:a}}),l.push(u),o=Rn(o.length,u.shape.length)),fs("argMax",[o[0]],u.shape.length);const c=hk(e,u,o[0],"max");return l.forEach(h=>e.disposeIntermediateTensorInfo(h)),c}const F7={kernelName:Bc,backendName:"webgl",kernelFunc:O7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L7(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i}=s;let o=Pe(i,r.shape);const a=Tn(o,r.shape.length);let u=r;const l=[];a!=null&&(u=Ls({inputs:{x:r},backend:e,attrs:{perm:a}}),l.push(u),o=Rn(o.length,u.shape.length)),fs("argMin",[o[0]],u.shape.length);const c=hk(e,u,o[0],"min");return l.forEach(h=>e.disposeIntermediateTensorInfo(h)),c}const P7={kernelName:Vc,backendName:"webgl",kernelFunc:L7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M7=Hr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,z7=qe({opSnippet:M7}),B7={kernelName:ju,backendName:"webgl",kernelFunc:z7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V7=Hr+"return log(x + sqrt(x * x + 1.0));",U7=qe({opSnippet:V7}),W7={kernelName:Hu,backendName:"webgl",kernelFunc:U7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G7=Hr+`
  return atan(x);
`,j7=qe({opSnippet:G7}),H7={kernelName:Ku,backendName:"webgl",kernelFunc:j7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K7=ry+`
  return atan(a, b);
`,q7=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+uu+`
  return result;
`,X7=ps({opSnippet:K7,packedOpSnippet:q7}),Y7={kernelName:Xu,backendName:"webgl",kernelFunc:X7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z7=Hr+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,J7=qe({opSnippet:Z7}),Q7={kernelName:qu,backendName:"webgl",kernelFunc:J7};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ac{constructor(t,e,s,r=!1,i=!1){if(this.variableNames=["x"],e==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=t.filterWidth,a=t.strideHeight,u=t.strideWidth,l=t.dilationHeight,c=t.dilationWidth,h=t.effectiveFilterHeight,d=t.effectiveFilterWidth,f=t.padInfo.top,p=t.padInfo.left;this.outputShape=t.outShape;const m=e==="avg",g=`((batch  * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + d`,y=`(xR * ${t.inWidth} + xC) * ${t.inChannels} + d`;let b="0.0";if(m||(b="-1.0 / 1e-20"),s){const L=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${u});
        const ivec2 pads = ivec2(${f}, ${p});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${h};
              wR += ${l}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${d};
                wC += ${c}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${L} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?i?g:y:`wR * ${d} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const w="max";let v=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="avg"&&(v="avgValue / max(count, 1.0)");const S=Math.floor(o/4)*4,N=o%4,R=`
      if (${m}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${w}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${u});
      const ivec2 pads = ivec2(${f}, ${p});
      const float initializationValue = ${b};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${t.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${b});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${h};
            wR += ${l}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${t.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${S}; wC += 4) {
            int xC = xCCorner + wC * ${c};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              getValue(batch, xR, xC + 2 * ${c}, d),
              getValue(batch, xR, xC + 3 * ${c}, d)
            );

            ${R}
          }

          int xC = xCCorner + ${S};
          if (${N===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${R}
          } else if (${N===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              initializationValue,
              initializationValue
            );

            ${R}
          } else if (${N===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              getValue(batch, xR, xC + 2 * ${c}, d),
              initializationValue
            );

            ${R}
          }
        }
        setOutput(${v});
      }
    `}}class oy{constructor(t,e,s,r=!1,i=!1){if(this.variableNames=["x"],e==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=t.filterWidth,a=t.strideDepth,u=t.strideHeight,l=t.strideWidth,c=t.dilationDepth,h=t.dilationHeight,d=t.dilationWidth,f=t.effectiveFilterDepth,p=t.effectiveFilterHeight,m=t.effectiveFilterWidth,g=t.padInfo.front,y=t.padInfo.top,b=t.padInfo.left;this.outputShape=t.outShape;const w=e==="avg";let v="0.0";if(w||(v="-1.0 / 1e-20"),s){const B=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${u}, ${l});
        const ivec3 pads = ivec3(${g}, ${y}, ${b});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${f};
              wD += ${c}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${t.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${p};
                wR += ${h}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${t.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${m};
                  wC += ${d}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${t.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${B} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?i?`(((batch * ${t.inDepth} + xD) * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`((xD * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`wD * ${p} * ${m} +
                      wR * ${m} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const S="max";let N=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="avg"&&(N="avgValue / max(count, 1.0)");const R=Math.floor(o/4)*4,L=o%4,F=`
      if (${w}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${S}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${u}, ${l});
      const ivec3 pads = ivec3(${g}, ${y}, ${b});
      const float initializationValue = ${v};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${t.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${v});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${f};
            wD += ${c}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${t.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p};
            wR += ${h}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${R}; wC += 4) {
              int xC = xCCorner + wC * ${d};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${d}, ch),
                getValue(batch, xD, xR, xC + 2 * ${d}, ch),
                getValue(batch, xD, xR, xC + 3 * ${d}, ch)
              );

              ${F}
            }

            int xC = xCCorner + ${R};
            if (${L===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${F}
            } else if (${L===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${d}, ch),
                initializationValue,
                initializationValue
              );

              ${F}
            } else if (${L===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${d}, ch),
                getValue(batch, xD, xR, xC + 2 * ${d}, ch),
                initializationValue
              );

              ${F}
            }
          }
        }
        setOutput(${N});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tL(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t;cd(r,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:u}=s,l=1;V(ds(o,l),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${l}'`);const c=jr(r.shape,i,o,l,a,u);if(c.filterWidth===1&&c.filterHeight===1&&Ve(c.inShape,c.outShape))return hr({inputs:{x:r},backend:e});const h=new Ac(c,"avg",!1);return e.runWebGLProgram(h,[r],"float32")}const eL={kernelName:Uc,backendName:"webgl",kernelFunc:tL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nL(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{filterSize:i,strides:o,pad:a,dimRoundingMode:u,dataFormat:l}=s,c=[1,1,1],h=po(r.shape,i,o,c,a,u,l),d=new oy(h,"avg",!1);return e.runWebGLProgram(d,[r],"float32")}const sL={kernelName:Wc,backendName:"webgl",kernelFunc:nL};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rL{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const e=t.filterHeight,s=t.filterWidth,r=t.strideHeight,i=t.strideWidth,o=t.dilationHeight,a=t.dilationWidth,u=t.effectiveFilterHeight,l=t.effectiveFilterWidth,c=u-1-t.padInfo.top,h=l-1-t.padInfo.left,d=1/(e*s);this.userCode=`
      const ivec2 pads = ivec2(${c}, ${h});
      const float avgMultiplier = float(${d});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${u};
            wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${l};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class iL{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const e=t.filterDepth,s=t.filterHeight,r=t.filterWidth,i=t.strideDepth,o=t.strideHeight,a=t.strideWidth,u=t.dilationDepth,l=t.dilationHeight,c=t.dilationWidth,h=t.effectiveFilterDepth,d=t.effectiveFilterHeight,f=t.effectiveFilterWidth,p=h-1-t.padInfo.front,m=d-1-t.padInfo.top,g=f-1-t.padInfo.left,y=1/(e*s*r);this.userCode=`
      const ivec3 pads = ivec3(${p}, ${m}, ${g});
      const float avgMultiplier = float(${y});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${h};
            wD += ${u}) {
          float dyD = float(dyDCorner + wD) / ${i}.0;

          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${d};
              wR += ${l}) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${f};
                wC += ${c}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oL(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,input:i}=t,o=i,{filterSize:a,strides:u,pad:l,dimRoundingMode:c}=s,h=[1,1,1],d=po(o.shape,a,u,h,l,c),f=new iL(d);return e.runWebGLProgram(f,[r],o.dtype)}const aL={kernelName:Wf,backendName:"webgl",kernelFunc:oL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uL(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,input:i}=t,o=i;cd([r,i],"avgPoolGrad");const{filterSize:a,strides:u,pad:l}=s,c=jr(o.shape,a,u,1,l),h=new rL(c);return e.runWebGLProgram(h,[r],o.dtype)}const lL={kernelName:Uf,backendName:"webgl",kernelFunc:uL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cL(n){const{inputs:t,backend:e,attrs:s}=n,{a:r,b:i}=t,{transposeA:o,transposeB:a}=s;return gf({a:r,b:i,transposeA:o,transposeB:a,backend:e})}const hL={kernelName:Gc,backendName:"webgl",kernelFunc:cL};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dL{constructor(t,e,s,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],Ee(t,e),Ee(t,s);let a="0.0";r!=null&&(Ee(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let u="1.0";i!=null&&(Ee(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${u};
        float inv = scale * inversesqrt(variance + float(${o}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fL{constructor(t,e,s,r,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Ee(t,e),Ee(t,s);let a="vec4(0.0)";r!=null&&(Ee(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let u="vec4(1.0)";i!=null&&(Ee(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${u};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${o}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pL=({inputs:n,backend:t,attrs:e})=>{const{x:s,mean:r,variance:i,offset:o,scale:a}=n;V(r.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),V(o==null||r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),V(a==null||r.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:u}=e;u==null&&(u=.001);const l=[s,r,i];let c=null;o!=null&&(c=o.shape,l.push(o));let h=null;a!=null&&(h=a.shape,l.push(a));const d=vt().getBool("WEBGL_PACK_NORMALIZATION")?new fL(s.shape,r.shape,i.shape,c,h,u):new dL(s.shape,r.shape,i.shape,c,h,u);return t.runWebGLProgram(d,l,l[0].dtype)},mL={kernelName:sh,backendName:"webgl",kernelFunc:pL};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gL{constructor(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;const e=un(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=yL(this.rank);let r;const i=t.map((o,a)=>`sourceLoc.${l1[a]} = start[${a}] + coords.${l1[a]};`);r=`
        ${e} sourceLoc;
        ${e} coords = getOutputCoords();
        ${i.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${s}));
      }
    `}}const l1=["x","y","z","w","u","v"];function yL(n){if(n===1)return"sourceLoc";if(n<=6)return l1.slice(0,n).map(t=>"sourceLoc."+t).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bL{constructor(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const e=un(this.rank),s=Rs("coords",this.rank),r=Rs("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,o=`getChannel(getSource(${r.join()}), ${i})`,a=`
      result.x = ${o};
      if (++${s[this.rank-1]} < ${t[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${o};
        --${r[this.rank-1]};
      }
    `,u=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${t[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${o};
        if (++${s[this.rank-1]} < ${t[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${o};
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            ${e}(${t.map((c,h)=>`start[${h}]`).join()});`:t.map((c,h)=>`${r[h]} = ${s[h]} + start[${h}];`).join(`
`);this.userCode=`
      void main() {
        ${e} coords = getOutputCoords();
        ${e} sourceLoc;
        ${l}
        vec4 result = vec4(0.);
        ${a}
        ${u}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xL(n,t,e,s){const r=s.texData.get(n.dataId),i=s.makeTensorInfo(e,n.dtype),o=s.texData.get(i.dataId);Object.assign(o,r),o.refCount=1,o.shape=e,o.dtype=n.dtype;let a=C2(t,ge(n.shape));r.slice&&(a+=r.slice.flatOffset),o.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||n.dataId};const u=s.dataRefCount.get(o.slice.origDataId)||1;return s.dataRefCount.set(o.slice.origDataId,u+1),i}function Jl(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{begin:i,size:o}=s,[a,u]=Rm(r,i,o);if(k2(r,a,u),Et(u)===0)return e.makeTensorInfo(u,r.dtype,[]);if(e.shouldExecuteOnCPU([r])||r.dtype==="string"){const h=e.texData.get(r.dataId),d=h8(h.values,a,u,r.shape,r.dtype);return e.makeTensorInfo(u,r.dtype,d)}const{isPacked:l}=e.texData.get(r.dataId),c=I2(r.shape,a,u);if(l||!c){const h=vt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new bL(u):new gL(u),d=[a];return e.runWebGLProgram(h,[r],r.dtype,d)}return e.uploadToGPU(r.dataId),xL(r,a,u,e)}const wL={kernelName:Rh,backendName:"webgl",kernelFunc:Jl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vL=n=>{const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{blockShape:i,crops:o}=s;V(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((b,w)=>b*w),u=od(r.shape,i,a),l=ad(u.length,i.length),c=ud(r.shape,i,a),h=A2(o,i.length),d=R2(c,o,i.length),f=[],p=Qt({inputs:{x:r},backend:e,attrs:{shape:u}}),m=Ls({inputs:{x:p},backend:e,attrs:{perm:l}}),g=Qt({inputs:{x:m},backend:e,attrs:{shape:c}}),y=Jl({inputs:{x:g},backend:e,attrs:{begin:h,size:d}});return f.push(p),f.push(m),f.push(g),f.forEach(b=>e.disposeIntermediateTensorInfo(b)),y},kL={kernelName:jc,backendName:"webgl",kernelFunc:vL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SL(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,weights:i}=t,{size:o}=s,a=e.readSync(r.dataId),u=e.readSync(i.dataId),l=J4(a,u,i.dtype,i.shape,o);return e.makeTensorInfo([o],i.dtype,l)}const IL={kernelName:Gf,backendName:"webgl",kernelFunc:SL};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CL=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,NL=`
  return float(int(a.r) & int(b.r));
`;function TL(n){const{inputs:t,backend:e}=n,{a:s,b:r}=t,i=vt().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=vt().getNumber("WEBGL_VERSION");if(e.shouldExecuteOnCPU([s,r])||o===1){const u=e.texData.get(s.dataId).values,l=e.texData.get(r.dataId).values,[c,h]=FF(s.shape,r.shape,u,l,s.dtype),d=e.makeTensorInfo(h,s.dtype),f=e.texData.get(d.dataId);return f.values=c,d}let a;return i?a=new Yl(CL,s.shape,r.shape,!1):a=new ja(NL,s.shape,r.shape),e.runWebGLProgram(a,[s,r],s.dtype)}const $L={kernelName:Hc,backendName:"webgl",kernelFunc:TL};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EL(n){const{inputs:t,backend:e}=n,{s0:s,s1:r}=t,i=e.readSync(s.dataId),o=e.readSync(r.dataId),a=Ee(Array.from(i),Array.from(o));return e.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const _L={kernelName:jf,backendName:"webgl",kernelFunc:EL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AL="return float(a != b);",dk=ps({opSnippet:AL,cpuKernelImpl:n8,dtype:"bool"}),RL={kernelName:wh,backendName:"webgl",kernelFunc:dk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dd(n){const{inputs:t,backend:e}=n,{input:s}=t,r=e.texData.get(s.dataId);return hr({inputs:{x:r.complexTensorInfos.real},backend:e})}const DL={kernelName:Cp,backendName:"webgl",kernelFunc:dd};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OL="return float(int(x));";function FL(n,t){const e=new Ei(n.shape,OL),s=t.runWebGLProgram(e,[n],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c1(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{dtype:i}=s;if(i==="complex64"){if(r.dtype==="complex64")return hr({inputs:{x:r},backend:e});const o=Mn(r.shape),a=c1({inputs:{x:r},backend:e,attrs:{dtype:"float32"}}),u=oa({inputs:{real:a,imag:o},backend:e});return o.dispose(),e.disposeIntermediateTensorInfo(a),u}if(r.dtype==="complex64"){const o=dd({inputs:{input:r},backend:e}),a=c1({inputs:{x:o},backend:e,attrs:{dtype:i}});return e.disposeIntermediateTensorInfo(o),a}if(!V1(r.dtype,i)){const o=hr({inputs:{x:r},backend:e});return{dataId:o.dataId,shape:o.shape,dtype:i}}if(e.shouldExecuteOnCPU([r])){const o=e.texData.get(r.dataId).values,[a,u,l]=LF(o,r.shape,r.dtype,i);return e.makeTensorInfo(a,u,l)}if(i==="int32")return FL(r,e);if(i==="bool"){const o=e.makeTensorInfo([],"bool",ss("bool",1)),u=dk({inputs:{a:r,b:o},backend:e});return e.disposeIntermediateTensorInfo(o),u}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${i}`)}const LL={kernelName:Yu,backendName:"webgl",kernelFunc:c1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tb="return ceil(x);",PL=qe({opSnippet:Tb,packedOpSnippet:Tb,cpuKernelImpl:PF}),ML={kernelName:Zu,backendName:"webgl",kernelFunc:PL};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zL{constructor(t){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class BL{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VL(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{clipValueMin:i,clipValueMax:o}=s;let a;vt().getBool("WEBGL_PACK_CLIP")?a=new BL(r.shape):a=new zL(r.shape);const u=[[i],[o]];return e.runWebGLProgram(a,[r],r.dtype,u)}const UL={kernelName:Ju,backendName:"webgl",kernelFunc:VL};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WL{constructor(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $b(n,t){return{dataId:t.dataId,dtype:t.dtype,shape:n.shape}}function GL(n){const{inputs:t,backend:e}=n,{x:s}=t,r=e.texData.get(s.dataId),i=new WL(s.shape),o=[$b(s,r.complexTensorInfos.real),$b(s,r.complexTensorInfos.imag)];return e.runWebGLProgram(i,o,o[0].dtype)}const jL={kernelName:Kc,backendName:"webgl",kernelFunc:GL};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HL{constructor(t){this.outputShape=[],this.outputShape=Oi(t,1),this.variableNames=t.map((o,a)=>`T${a}`);const e=new Array(t.length-1);e[0]=t[0][1];for(let o=1;o<e.length;o++)e[o]=e[o-1]+t[o][1];const s=[`if (yC < ${e[0]}) setOutput(getT0(yR, yC));`];for(let o=1;o<e.length;o++){const a=e[o-1];s.push(`else if (yC < ${e[o]}) setOutput(getT${o}(yR, yC-${a}));`)}const r=e.length,i=e[e.length-1];s.push(`else setOutput(getT${r}(yR, yC-${i}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KL{constructor(t,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Oi(t,e);const s=this.outputShape,r=s.length,i=un(r),o=Rs("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=t.map((m,g)=>`T${g}`);const u=new Array(t.length-1);u[0]=t[0][e];for(let m=1;m<u.length;m++)u[m]=u[m-1]+t[m][e];const l=a[e],c=a.slice(-2),h=a.join();let d=`if (${l} < ${u[0]}) {
        return getChannel(
            getT0(${h}), vec2(${c.join()}));
        }`;for(let m=1;m<u.length;m++){const g=u[m-1];d+=`
        if (${l} < ${u[m]}  && ${l} >= ${u[m-1]}) {
          return getChannel(
            getT${m}(${Ld(a,l,g)}),
            vec2(${Ld(c,l,g)}));
        }`}const f=u.length,p=u[u.length-1];d+=`
        return getChannel(
          getT${f}(${Ld(a,l,p)}),
          vec2(${Ld(c,l,p)}));`,this.userCode=`
      float getValue(${a.map(m=>"int "+m)}) {
        ${d}
      }

      void main() {
        ${i} coords = getOutputCoords();
        vec4 result = vec4(getValue(${o}), 0., 0., 0.);

        ${o[r-1]} = ${o[r-1]} + 1;
        if (${o[r-1]} < ${s[r-1]}) {
          result.g = getValue(${o});
        }

        ${o[r-2]} = ${o[r-2]} + 1;
        if (${o[r-2]} < ${s[r-2]}) {
          result.a = getValue(${o});
        }

        ${o[r-1]} = ${o[r-1]} - 1;
        if (${o[r-2]} < ${s[r-2]} &&
            ${o[r-1]} < ${s[r-1]}) {
          result.b = getValue(${o});
        }
        setOutput(result);
      }
    `}}function Ld(n,t,e){const s=n.indexOf(t);return n.map((i,o)=>o===s?`${i} - ${e}`:i).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vm(n){const{inputs:t,backend:e}=n,{input:s}=t,r=e.texData.get(s.dataId);return hr({inputs:{x:r.complexTensorInfos.imag},backend:e})}const qL={kernelName:hp,backendName:"webgl",kernelFunc:Vm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cc(n,t,e){const s=n[0].dtype;if(s==="complex64"){const f=n.map(b=>dd({inputs:{input:b},backend:e})),p=n.map(b=>Vm({inputs:{input:b},backend:e})),m=cc(f,t,e),g=cc(p,t,e),y=oa({inputs:{real:m,imag:g},backend:e});return f.forEach(b=>e.disposeIntermediateTensorInfo(b)),p.forEach(b=>e.disposeIntermediateTensorInfo(b)),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(g),y}let r=e.shouldExecuteOnCPU(n);if(s==="string"&&(r=!0),r){const f=n.map(v=>{const N=[-1,Et(v.shape.slice(t))];return Qt({inputs:{x:v},backend:e,attrs:{shape:N}})}),p=f.map(v=>({vals:e.readSync(v.dataId),shape:v.shape})),m=Oi(f.map(v=>v.shape),1),g=f[0].shape[0]===1,y=MF(p,m,s,g),b=Oi(n.map(v=>v.shape),t),w=e.makeTensorInfo(b,s,y);return f.forEach(v=>e.disposeIntermediateTensorInfo(v)),w}const i=n.filter(f=>Et(f.shape)>0),o=vt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&i[0].shape.length>1;if(i.length===1){const f=o?new Ei(n[0].shape,Do):new Fo(n[0].shape,Do);return e.runWebGLProgram(f,n,s)}const a=vt().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(i.length>a){const f=[];for(let m=0;m<i.length;m+=a){const g=i.slice(m,m+a);f.push(cc(g,t,e))}const p=cc(f,t,e);for(const m of f)e.disposeIntermediateTensorInfo(m);return p}if(o){const f=new KL(i.map(p=>p.shape),t);return e.runWebGLProgram(f,i,s)}const{tensors2D:u,outShape:l}=XL(i,t,e),c=new HL(u.map(f=>f.shape)),h=e.runWebGLProgram(c,u,s);u.forEach(f=>e.disposeIntermediateTensorInfo(f));const d=Qt({inputs:{x:h},attrs:{shape:l},backend:e});return e.disposeIntermediateTensorInfo(h),d}function XL(n,t,e){const s=Oi(n.map(i=>i.shape),t);return{tensors2D:n.map(i=>Qt({inputs:{x:i},attrs:{shape:[-1,Et(i.shape.slice(t))]},backend:e})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fk(n){const{inputs:t,backend:e,attrs:s}=n,{axis:r}=s,i=Pe(r,t[0].shape)[0],o=t.map(l=>l.shape);$2(o,i);const a=Oi(t.map(l=>l.shape),i);if(Et(a)===0)return e.makeTensorInfo(a,t[0].dtype,[]);const u=t.filter(l=>Et(l.shape)>0);return u.length===1?hr({inputs:{x:u[0]},backend:e}):cc(u,i,e)}const YL={kernelName:qc,backendName:"webgl",kernelFunc:fk};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pk{constructor(t,e=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.outputShape=t.outShape;const o=t.padInfo.top,a=t.padInfo.left,u=t.strideHeight,l=t.strideWidth,c=t.dilationHeight,h=t.dilationWidth,d=t.filterHeight,f=t.filterWidth,p=Math.floor(t.inChannels/4)*4,m=t.inChannels%4,g=t.dataFormat==="channelsLast",y=g?1:2,b=g?2:3,w=g?3:1;let v="",S="";s&&(r?v=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?v=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:v=`
          float activation(float x) {
            ${s}
          }
        `,S="result = activation(result);");const N=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${v}

      const ivec2 strides = ivec2(${u}, ${l});
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${w}];

        ivec2 xRCCorner =
            ivec2(coords[${y}], coords[${b}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${d}; wR++) {
          int xR = xRCorner + wR * ${c};

          if (xR < 0 || xR >= ${t.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${f}; wC++) {
            int xC = xCCorner + wC * ${h};

            if (xC < 0 || xC >= ${t.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${p}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${g}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${m===1}) {

              if (${g}) {
                dotProd +=
                    getX(batch, xR, xC, ${p}) *
                    getW(wR, wC, ${p}, d2);
              } else {
                dotProd +=
                    getX(batch, ${p}, xR, xC) *
                    getW(wR, wC, ${p}, d2);
              }

            } else if (${m===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2)
              );

              if (${g}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${m===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2),
                getW(wR, wC, ${p} + 2, d2)
              );

              if (${g}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1),
                  getX(batch, xR, xC, ${p} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC),
                  getX(batch, ${p} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${N}
        ${S}
        setOutput(result);
      }
    `}}class ZL{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const e=t.padInfo.front,s=t.padInfo.top,r=t.padInfo.left,i=t.strideDepth,o=t.strideHeight,a=t.strideWidth,u=t.dilationDepth,l=t.dilationHeight,c=t.dilationWidth,h=t.filterDepth,d=t.filterHeight,f=t.filterWidth,p=Math.floor(t.inChannels/4)*4,m=t.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${i}, ${o}, ${a});
      const ivec3 pads = ivec3(${e}, ${s}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${h}; wF++) {
          int xF = xFCorner + wF * ${u};

          if (xF < 0 || xF >= ${t.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${d}; wR++) {
            int xR = xRCorner + wR * ${l};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f}; wC++) {
              int xC = xCCorner + wC * ${c};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${p}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${m===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${p}) *
                  getW(wF, wR, wC, ${p}, d2);
              } else if (${m===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${m===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1),
                  getX(batch, xF, xR, xC, ${p} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2),
                  getW(wF, wR, wC, ${p} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mk{constructor(t,e=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Ss(this.outputShape.length);const o=t.padInfo.left,a=t.strideWidth,u=t.dilationWidth,l=t.filterHeight,c=t.filterWidth,h=c;let d=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let g=0;g<c;g++)d+=`
           vec4 xTexelC${g*2};
           int xTexelC${g*2}Ready;
           vec4 xTexelC${g*2+1};
           int xTexelC${g*2+1}Ready;
           vec4 xC${g};`;d+=`
     for (int r = 0; r < ${l}; r++) {
      for (int d1 = 0; d1 < ${t.inChannels}; d1 += 2) {
       `;for(let g=0;g<c;g++)d+=`
           xTexelC${g*2} = vec4(0.0);
           xTexelC${g*2}Ready = 0;
           xTexelC${g*2+1} = vec4(0.0);
           xTexelC${g*2+1}Ready = 0;
           xC${g} = vec4(0.0);`;d+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let g=0;g<(h+1)/2;g++){const y=g*2;if(d+=`
           xC = xCCorner + ${y*u};
           `,a===1){if(y<c&&(o%2===1?(d+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }
               `,u===1&&y>0?d+=`
                 xC${y} = vec4(xTexelC${y-2}.zw, xTexelC${y}.xy);
                 `:d+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${y} = vec4(previous.zw, xTexelC${y}.xy);
                   } else {
                     xC${y} = vec4(0.0, 0.0, xTexelC${y}.xy);
                   }
                   `):d+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xC${y} = xTexelC${y};
                 `,y+1<c)){const b=o%2===0?Mf(u):u;u%2===0&&o%2===1||u%2!==0&&o%2!==1?(d+=`
                   xCOffset = xC + imod(pads[1], 2) + ${b};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                     xTexelC${y+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${y+1}.zw = vec2(0.0);
                     }
                     xTexelC${y+1}Ready = 1;
                   }
                   `,u>1?d+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${y+1} = vec4(previous.zw, xTexelC${y+1}.xy);
                     } else {
                      xC${y+1} = vec4(0.0, 0.0, xTexelC${y+1}.xy);
                     }
                     `:d+=`
                     xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.xy);
                     `):b===1?d+=`
                     xC${y+1} = xTexelC${y};
                     `:d+=`
                     xCOffset = xC + ${b};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                       xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${y+1}.zw = vec2(0.0);
                       }
                       xTexelC${y+1}Ready = 1;
                     }

                     xC${y+1} = xTexelC${y+1};
                     `}}else y<c&&(o%2===1?(d+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.0);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
               `,y+1<c&&(d+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${y+1} = vec4(xTexelC${y+1}.xy, final.xy);
                 `)):(d+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(
                   xTexelC${y}.xy, xTexelC${y+1}.xy);
               `,y+1<c&&(d+=`
                   xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
                 `)));y<c&&(d+=`
             wTexel = getW(r, ${y}, d1, d2);
             dotProd += xC${y}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${t.inChannels}) {
               dotProd += xC${y}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,y+1<c&&(d+=`
               wTexel = getW(r, ${y+1}, d1, d2);
               dotProd += xC${y+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${t.inChannels}) {
                 dotProd += xC${y+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}d+=`
     }
   `,d+=`
     }
   `,d+=`
     }
   `;let f="",p="";s&&(r?f=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:i?f=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:f=`vec4 activation(vec4 x) {
           ${s}
         }`,p="result = activation(result);");const m=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${f}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${d}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${m}
         ${p}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JL{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=Ss(this.outputShape.length);const{dataFormat:s}=e,r=zs(),i=s==="channelsLast",o=i?1:2,a=i?2:3,u=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${t[2]} && pos < ${t[1]}) {`;let l="";for(let c=0;c<=1;c++)for(let h=0;h<=1;h++)l+=`
          blockIndex = rc.z + ${h};
          pos = rc.y + ${c};

          ${u}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${o}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${i}) {
                  innerDims = vec2(d1, ch);
                  result[${c*2+h}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${c*2+h}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${l}

        ${r.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yf(n,t){const e=n.length;return e>=3?t?[...n.slice(0,-3),n[e-3]*n[e-2],n[e-1]]:[...n.slice(0,-3),n[e-3],n[e-2]*n[e-1]]:!t&&e===1&&n[0]>1?[n[0],1]:null}function gk({x:n,filter:t,convInfo:e,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const u=n.shape,l=s.texData.get(n.dataId),c=e.inChannels,h=u[0]*u[1]*u[2],d=e.outChannels,f=e.dataFormat==="channelsLast",p=!1,m=!1;let g;const y=[];if(i!=null){const v=yf(i.shape,f);v!=null&&(i=Qt({inputs:{x:i},backend:s,attrs:{shape:v}}),y.push(i))}if(r!=null){const v=yf(r.shape,f);v!=null&&(r=Qt({inputs:{x:r},backend:s,attrs:{shape:v}}),y.push(r))}if(!((h===1||d===1)&&c>uk)&&l.isPacked&&f&&l.texture!=null&&u[2]%2!==0&&Ve(l.shape.slice(-3),u.slice(-3))){const v=u[0]*u[1]*(u[2]+1),S={dataId:n.dataId,shape:[1,v,e.inChannels],dtype:n.dtype},N=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,V(ff(l.shape,S.shape),()=>`packed reshape ${l.shape} to ${S.shape} isn't free`);const R=Qt({inputs:{x:t},backend:s,attrs:{shape:[1,e.inChannels,e.outChannels]}});y.push(R);const L=gf({a:S,b:R,backend:s,transposeA:p,transposeB:m,bias:r,activation:a,preluActivationWeights:i,leakyreluAlpha:o}),F=s.texData.get(L.dataId);V(F.isPacked,()=>"batchMatMul result is expected to be packed"),l.shape=N,F.shape=e.outShape,g=hr({inputs:{x:L},backend:s}),g.shape=e.outShape,y.push(L)}else{const v=e.outHeight*e.outWidth,S=Qt({inputs:{x:n},backend:s,attrs:{shape:f?[e.batchSize,v,e.inChannels]:[e.batchSize,e.inChannels,v]}}),N=Qt({inputs:{x:t},backend:s,attrs:{shape:[1,e.inChannels,e.outChannels]}}),R=gf({a:f?S:N,b:f?N:S,transposeA:!f,transposeB:m,backend:s,bias:r,activation:a,preluActivationWeights:i,leakyreluAlpha:o});g=Qt({inputs:{x:R},backend:s,attrs:{shape:e.outShape}}),y.push(S),y.push(N),y.push(R)}for(const v of y)s.disposeIntermediateTensorInfo(v);return g}function yk({x:n,filter:t,convInfo:e,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const{filterWidth:u,filterHeight:l,inChannels:c,outWidth:h,outHeight:d,dataFormat:f}=e,p=f==="channelsLast",m=u*l*c,g=d*h,y=[e.batchSize,m,g],b=!0,w=!1,v=[];if(i!=null){const gt=yf(i.shape,p);gt!=null&&(i=Qt({inputs:{x:i},backend:s,attrs:{shape:gt}}),v.push(i))}if(r!=null){const gt=yf(r.shape,p);gt!=null&&(r=Qt({inputs:{x:r},backend:s,attrs:{shape:gt}}),v.push(r))}const S=Qt({inputs:{x:t},backend:s,attrs:{shape:[1,m,Et(t.shape)/m]}});v.push(S);const N=new JL(y,e),R=[n.shape,[e.padInfo.top,e.padInfo.left],[e.strideHeight,e.strideWidth],[e.dilationHeight,e.dilationWidth],[e.inChannels],[e.filterWidth*e.inChannels],[e.outWidth]],L=s.runWebGLProgram(N,[n],"float32",R),F=Qt({inputs:{x:L},backend:s,attrs:{shape:y}});v.push(L),v.push(F);const B=r!=null,H=i!=null,z=a==="leakyrelu",G=a?_c(a,!0):null,T=new ak(p?F.shape:S.shape,p?S.shape:F.shape,p?[e.batchSize,g,e.outChannels]:[e.batchSize,e.outChannels,g],b,w,B,G,H,z),K=p?[F,S]:[S,F];if(r&&K.push(r),H&&K.push(i),z){const gt=s.makeTensorInfo([],"float32",fo(o,"float32"));K.push(gt),v.push(gt)}const ht=s.runWebGLProgram(T,K,"float32"),rt=Qt({inputs:{x:ht},backend:s,attrs:{shape:e.outShape}});v.push(ht);for(const gt of v)s.disposeIntermediateTensorInfo(gt);return rt}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QL(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,filter:i}=t,{strides:o,pad:a,dataFormat:u,dilations:l,dimRoundingMode:c}=s,h=mo(u),d=rs(r.shape,i.shape,o,l,a,c,!1,h);let f;if(d.filterHeight===1&&d.filterWidth===1&&d.dilationHeight===1&&d.dilationWidth===1&&d.strideHeight===1&&d.strideWidth===1&&(d.padInfo.type==="SAME"||d.padInfo.type==="VALID"))f=gk({x:r,filter:i,convInfo:d,backend:e});else if(d.strideWidth<=2&&h==="channelsLast"&&vt().getBool("WEBGL_EXP_CONV")){const m=new mk(d),g=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];f=e.runWebGLProgram(m,[r,i],"float32",g)}else if(vt().getBool("WEBGL_CONV_IM2COL"))f=yk({x:r,filter:i,convInfo:d,backend:e});else{const m=new pk(d);f=e.runWebGLProgram(m,[r,i],"float32")}const p=Qt({inputs:{x:f},backend:e,attrs:{shape:d.outShape}});return e.disposeIntermediateTensorInfo(f),p}const t9={kernelName:Xc,backendName:"webgl",kernelFunc:QL};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class e9{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideHeight,s=t.strideWidth,r=t.padInfo.top,i=t.padInfo.left,o=t.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yR = 0; yR < ${t.outHeight}; yR++) {
            int xR = wR + yR * ${e} - ${r};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${t.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${i};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              ${o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class n9{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterHeight,s=t.filterWidth,r=t.strideHeight,i=t.strideWidth,o=t.dataFormat==="channelsLast",a=e-1-t.padInfo.top,u=s-1-t.padInfo.left,l=o?1:2,c=o?2:3,h=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${u});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${h}];

        ivec2 dyCorner = ivec2(coords[${l}], coords[${c}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${e}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${e} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${t.outChannels}; d2++) {

              if (${o}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class s9{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideDepth,s=t.strideHeight,r=t.strideWidth,i=t.padInfo.front,o=t.padInfo.top,a=t.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yF = 0; yF < ${t.outDepth}; yF++) {
            int xF = wF + yF * ${e} - ${i};

            if (xF < 0 || xF >= ${t.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${t.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${o};

              if (xR < 0 || xR >= ${t.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${t.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${a};

                if (xC < 0 || xC >= ${t.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class r9{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterDepth,s=t.filterHeight,r=t.filterWidth,i=t.strideDepth,o=t.strideHeight,a=t.strideWidth,u=e-1-t.padInfo.front,l=s-1-t.padInfo.top,c=r-1-t.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${u}, ${l}, ${c});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${e}; wF++) {
          float dyF = float(dyFCorner + wF) / ${i}.0;

          if (dyF < 0.0 || dyF >= ${t.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${e} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${t.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i9(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,dy:i}=t,{strides:o,pad:a,dataFormat:u,dimRoundingMode:l,filterShape:c}=s,h=mo(u),d=rs(r.shape,c,o,1,a,l,!1,h),f=new e9(d);return e.runWebGLProgram(f,[r,i],"float32")}const o9={kernelName:Kf,backendName:"webgl",kernelFunc:i9};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class a9{constructor(t){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=t.inShape,this.enableShapeUniforms=Ss(this.outputShape.length);const e=t.filterHeight,s=t.filterWidth,r=e-1-t.padInfo.top,i=s-1-t.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${i});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${e}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${e} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${t.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${t.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u9(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,filter:i}=t,{inputShape:o,strides:a,pad:u,dataFormat:l,dimRoundingMode:c}=s,h=mo(l),d=rs(o,i.shape,a,1,u,c,!1,h);if(vt().getBool("WEBGL_PACK")&&h==="channelsLast"){const f=[[d.strideHeight,d.strideWidth]],p=new a9(d);return e.runWebGLProgram(p,[r,i],"float32",f)}else{const f=new n9(d);return e.runWebGLProgram(f,[r,i],"float32")}}const l9={kernelName:Yc,backendName:"webgl",kernelFunc:u9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c9(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,filter:i}=t,{strides:o,pad:a,dilations:u}=s,l=ta(r.shape,i.shape,o,u,a),c=new ZL(l);return e.runWebGLProgram(c,[r,i],"float32")}const h9={kernelName:Zc,backendName:"webgl",kernelFunc:c9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d9(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,dy:i}=t,{strides:o,pad:a,filterShape:u}=s,l=ta(r.shape,u,o,1,a),c=new s9(l);return e.runWebGLProgram(c,[r,i],"float32")}const f9={kernelName:qf,backendName:"webgl",kernelFunc:d9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p9(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,filter:i}=t,{pad:o,strides:a,inputShape:u}=s,l=ta(u,i.shape,a,1,o),c=new r9(l);return e.runWebGLProgram(c,[r,i],"float32")}const m9={kernelName:Xf,backendName:"webgl",kernelFunc:p9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g9=Zl+`
  return cos(x);
`,y9=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${uu}
  return result;
`,b9=qe({opSnippet:g9,packedOpSnippet:y9}),x9={kernelName:Qu,backendName:"webgl",kernelFunc:b9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w9=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,v9=qe({opSnippet:w9}),k9={kernelName:tl,backendName:"webgl",kernelFunc:v9};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class S9{constructor(t,e,s,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,a,u,l]=t,[c]=e,[h,d]=s;this.outputShape=[c,h,d,l];const f=r==="bilinear"?1:0,[p,m]=[`${a-1}.0`,`${u-1}.0`],[g,y,b]=h>1?[`${(a-1)/(h-1)}`,"(y2-y1) * height_ratio",`y1*${p} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${p}`],[w,v,S]=d>1?[`${(u-1)/(d-1)}`,"(x2-x1) * width_ratio",`x1*${m} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${m}`];this.userCode=`
      const float height_ratio = float(${g});
      const float width_ratio = float(${w});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${o}) {
          return;
        }

        float height_scale = ${y};
        float width_scale = ${v};

        float in_y = ${b};
        if( in_y < 0.0 || in_y > ${p} ) {
          setOutput(float(${i}));
          return;
        }
        float in_x = ${S};
        if( in_x < 0.0 || in_x > ${m} ) {
          setOutput(float(${i}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${f} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I9=n=>{const{inputs:t,backend:e,attrs:s}=n,{image:r,boxes:i,boxInd:o}=t,{cropSize:a,method:u,extrapolationValue:l}=s,c=new S9(r.shape,i.shape,a,u,l);return e.runWebGLProgram(c,[r,i,o],"float32")},C9={kernelName:Zf,backendName:"webgl",kernelFunc:I9};var Rc;(function(n){n.Prod="*",n.Sum="+"})(Rc||(Rc={}));class Eb{constructor(t,e,s,r){this.op=t,this.outputShape=e,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const i=this.outputShape.length,o=this.op===Rc.Prod?"1.0":"0.0",a=s?o:`getX(${_b(i,"coords",this.op)})`,u=this.outputShape[this.outputShape.length-1];let l="",c="";s?(l=r?`end != ${u-1}`:"end != 0",c=r?"end + 1":"end - 1"):(l=r?`end + pow2 < ${u}`:"end >= pow2",c=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${un(i)} coords = getOutputCoords();
        int end = ${Ab(i,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${l}) {
          int idx = ${c};
          ${Ab(i,"coords",this.op)} = idx;
          val ${this.op}= getX(${_b(i,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function _b(n,t,e){if(n===1)return`${t}`;if(n===2)return`${t}.x, ${t}.y`;if(n===3)return`${t}.x, ${t}.y, ${t}.z`;if(n===4)return`${t}.x, ${t}.y, ${t}.z, ${t}.w`;throw new Error(`Cumulative ${e} for rank ${n} is not yet supported`)}function Ab(n,t,e){if(n===1)return`${t}`;if(n===2)return`${t}.y`;if(n===3)return`${t}.z`;if(n===4)return`${t}.w`;throw new Error(`Cumulative ${e} for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bk(n,t,e,s,r,i){const o=t.shape.length,a=Tn([s],o);let u=t;a!=null&&(u=Ls({inputs:{x:t},backend:e,attrs:{perm:a}}));const l=Rn(1,o)[0];if(l!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${t.shape.length-1} but got axis=${s}`);const c=u.shape[l];let h=hr({inputs:{x:u},backend:e});for(let d=0;d<=Math.ceil(Math.log2(c))-1;d++){const f=new Eb(n,u.shape,!1,i),p=[[d]],m=h;h=e.runWebGLProgram(f,[h],h.dtype,p),e.disposeIntermediateTensorInfo(m)}if(r){const d=new Eb(n,u.shape,r,i),f=h;h=e.runWebGLProgram(d,[h],h.dtype),e.disposeIntermediateTensorInfo(f)}if(a!=null){const d=ea(a),f=Ls({inputs:{x:h},backend:e,attrs:{perm:d}});return e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(u),f}return h}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N9(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i,exclusive:o,reverse:a}=s;return bk(Rc.Prod,r,e,i,o,a)}const T9={kernelName:Yf,backendName:"webgl",kernelFunc:N9};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $9(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i,exclusive:o,reverse:a}=s;return bk(Rc.Sum,r,e,i,o,a)}const E9={kernelName:Jc,backendName:"webgl",kernelFunc:$9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _9(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,weights:i}=t,{size:o,binaryOutput:a}=s;if(r.shape.length===1){const u=e.readSync(r.dataId),l=e.readSync(i.dataId),c=J4(u,l,i.dtype,i.shape,o);return e.makeTensorInfo([o],i.dtype,c)}else if(r.shape.length===2){const u=e.bufferSync(r),l=e.bufferSync(i),c=OF(u,l,o,a);return e.makeTensorInfo(c.shape,i.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const A9={kernelName:Jf,backendName:"webgl",kernelFunc:_9};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class R9{constructor(t,e,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${e};
      int offset_h = imod(h, ${e});
      int in_w = w / ${e};
      int offset_w = imod(w, ${e});
      int offset_d = (offset_h * ${e} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D9(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{blockSize:i,dataFormat:o}=s,a=r.shape[0],u=o==="NHWC"?r.shape[1]:r.shape[2],l=o==="NHWC"?r.shape[2]:r.shape[3],c=o==="NHWC"?r.shape[3]:r.shape[1],h=u*i,d=l*i,f=c/(i*i),p=o==="NHWC"?[a,h,d,f]:[a,f,h,d],m=new R9(p,i,o);return e.runWebGLProgram(m,[r],r.dtype)}const O9={kernelName:Qf,backendName:"webgl",kernelFunc:D9};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xk{constructor(t,e=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Ss(this.outputShape.length);const o=t.filterHeight,a=t.filterWidth,u=t.outChannels/t.inChannels;let l="",c="";s&&(r?l=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?l=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:l=`
          float activation(float x) {
            ${s}
          }
        `,c="result = activation(result);");const h=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${l}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${u};
        int q = d2 - d1 * ${u};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${o}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${h}
        ${c}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wk{constructor(t,e=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Ss(this.outputShape.length);const o=t.outChannels/t.inChannels,a=t.padInfo.left,u=t.strideWidth,l=t.dilationWidth,c=t.filterHeight,h=t.filterWidth,d=h;let f=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let y=0;y<h;y++)f+=`
          vec4 xTexelC${y*2};
          int xTexelC${y*2}Ready;
          vec4 xTexelC${y*2+1};
          int xTexelC${y*2+1}Ready;
          vec4 xC${y};`;f+=`
    for (int r = 0; r < ${c}; r++) {
      `;for(let y=0;y<h;y++)f+=`
          xTexelC${y*2} = vec4(0.0);
          xTexelC${y*2}Ready = 0;
          xTexelC${y*2+1} = vec4(0.0);
          xTexelC${y*2+1}Ready = 0;
          xC${y} = vec4(0.0);`;f+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let y=0;y<(d+1)/2;y++){const b=y*2;if(f+=`
          xC = xCCorner + ${b*l};
          `,u===1){if(b<h&&(a%2===1?(f+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }
              `,l===1&&b>0?f+=`
                xC${b} = vec4(xTexelC${b-2}.zw, xTexelC${b}.xy);
                `:f+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${b} = vec4(previous.zw, xTexelC${b}.xy);
                  } else {
                    xC${b} = vec4(0.0, 0.0, xTexelC${b}.xy);
                  }
                  `):f+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                xC${b} = xTexelC${b};
                `,b+1<h)){const w=a%2===0?Mf(l):l;l%2===0&&a%2===1||l%2!==0&&a%2!==1?(f+=`
                  xCOffset = xC + imod(pads[1], 2) + ${w};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                    xTexelC${b+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${b+1}.zw = vec2(0.0);
                    }
                    xTexelC${b+1}Ready = 1;
                  }
                  `,l>1?f+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${b+1} = vec4(previous.zw, xTexelC${b+1}.xy);
                    } else {
                     xC${b+1} = vec4(0.0, 0.0, xTexelC${b+1}.xy);
                    }
                    `:f+=`
                    xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.xy);
                    `):w===1?f+=`
                    xC${b+1} = xTexelC${b};
                    `:f+=`
                    xCOffset = xC + ${w};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                      xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${b+1}.zw = vec2(0.0);
                      }
                      xTexelC${b+1}Ready = 1;
                    }

                    xC${b+1} = xTexelC${b+1};
                    `}}else b<h&&(a%2===1?(f+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${b+1}Ready == 0) {
                  xTexelC${b+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${b+1}.zw = vec2(0.0);
                  }
                  xTexelC${b+1}Ready = 1;
                }

                xC${b} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
              `,b+1<h&&(f+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${b+1} = vec4(xTexelC${b+1}.xy, final.xy);
                `)):(f+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                  xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b+1}.zw = vec2(0.);
                  }
                  xTexelC${b+1}Ready = 1;
                }

                xC${b} = vec4(
                  xTexelC${b}.xy, xTexelC${b+1}.xy);
              `,b+1<h&&(f+=`
                  xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
                `)));b<h&&(f+=`
            wTexel = getW(r, ${b}, d1, q);
            dotProd += xC${b} * vec4(wTexel.xz, wTexel.xz);
          `,b+1<h&&(f+=`
              wTexel = getW(r, ${b+1}, d1, q);
              dotProd += xC${b+1} * vec4(wTexel.xz, wTexel.xz);
            `))}f+=`
    }
  `,f+=`
      }
    `;let p="",m="";s&&(r?p=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?p=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:p=`vec4 activation(vec4 x) {
          ${s}
        }`,m="result = activation(result);");const g=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${p}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${o};
        int q = d2 - d1 * ${o};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${f}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${g}
        ${m}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F9(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,filter:i}=t,{strides:o,pad:a,dilations:u,dimRoundingMode:l}=s;let c=u;c==null&&(c=[1,1]),V(ds(o,c),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const h=rs(r.shape,i.shape,o,c,a,l,!0);let d;vt().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels===1?d=new wk(h):d=new xk(h);const f=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return e.runWebGLProgram(d,[r,i],"float32",f)}const L9={kernelName:Qc,backendName:"webgl",kernelFunc:F9};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class P9{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideHeight,s=t.strideWidth,r=t.padInfo.top,i=t.padInfo.left,o=t.outChannels/t.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${o} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yR = 0; yR < ${t.outHeight}; yR++) {
            int xR = wR + yR * ${e} - ${r};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${t.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${i};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class M9{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterHeight,s=t.filterWidth,r=t.strideHeight,i=t.strideWidth,o=e-1-t.padInfo.top,a=s-1-t.padInfo.left,u=t.outChannels/t.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${e}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${e} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${u}; dm++) {
              int d2 = d1 * ${u} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z9(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,dy:i}=t,{strides:o,dilations:a,pad:u,dimRoundingMode:l,filterShape:c}=s,h=rs(r.shape,c,o,a,u,l,!0),d=new P9(h);return e.runWebGLProgram(d,[r,i],"float32")}const B9={kernelName:tp,backendName:"webgl",kernelFunc:z9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V9(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,filter:i}=t,{strides:o,dilations:a,pad:u,dimRoundingMode:l,inputShape:c}=s,h=rs(c,i.shape,o,a,u,l,!0),d=new M9(h);return e.runWebGLProgram(d,[r,i],"float32")}const U9={kernelName:ep,backendName:"webgl",kernelFunc:V9};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class W9{constructor(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G9(n){const{inputs:t,backend:e}=n,{x:s}=t,r=[...s.shape,...s.shape],i=Et(s.shape),o=Qt({inputs:{x:s},backend:e,attrs:{shape:[i]}}),a=new W9(i),u=e.runWebGLProgram(a,[o],o.dtype),l=Qt({inputs:{x:u},backend:e,attrs:{shape:r}});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(u),l}const j9={kernelName:np,backendName:"webgl",kernelFunc:G9};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class H9{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const{inHeight:e,inWidth:s,padInfo:r,strideHeight:i,strideWidth:o,filterHeight:a,filterWidth:u,dilationHeight:l,dilationWidth:c}=t,{top:h,left:d}=r;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${o});
      const ivec2 pads = ivec2(${h}, ${d});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${l};

          if (hIn >= 0 && hIn < ${e}) {
            for (int w = 0; w < ${u}; w++) {
              int wIn = wBeg + w * ${c};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K9(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,filter:i}=t,{strides:o,pad:a,dilations:u}=s,l=Wh(r.shape,i.shape,o,a,"NHWC",u);let c;const h=new H9(l);c=e.runWebGLProgram(h,[r,i],"float32");const d=Qt({inputs:{x:c},backend:e,attrs:{shape:l.outShape}});return e.disposeIntermediateTensorInfo(c),d}const q9={kernelName:th,backendName:"webgl",kernelFunc:K9};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X9(n){const{inputs:t,backend:e,attrs:s}=n,{equation:r}=s,i=t,{allDims:o,summedDims:a,idDims:u}=B2(r,i.length);U2(o.length,u,i);const{path:l,steps:c}=W2(a,u),h=c.length;let d=null,f=o.length;const p=[];for(let m=0;m<h;++m){for(const g of c[m]){const{permutationIndices:y,expandDims:b}=V2(f,u[g]);let w;G2(y)?w=i[g]:(w=Ls({inputs:{x:i[g]},backend:e,attrs:{perm:y}}),p.push(w));const v=w.shape.slice();for(let S=0;S<b.length;++S)v.splice(b[S],0,1);Ve(w.shape,v)||(w=Qt({inputs:{x:w},backend:e,attrs:{shape:v}}),p.push(w)),d===null?d=w:(d=iy({inputs:{a:w,b:d},backend:e}),p.push(d))}m<h-1&&(l[m]>=0&&(d=Bm({inputs:{x:d},backend:e,attrs:{axis:l[m]-(o.length-f),keepDims:!1}}),p.push(d)),f--)}for(const m of p)m!==d&&e.disposeIntermediateTensorInfo(m);return d}const Y9={kernelName:rp,backendName:"webgl",kernelFunc:X9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z9="return (x >= 0.0) ? x : (exp(x) - 1.0);",J9=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Q9=qe({opSnippet:Z9,packedOpSnippet:J9}),tP={kernelName:nl,backendName:"webgl",kernelFunc:Q9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eP="return (b >= 0.0) ? a : a * (b + 1.0);",nP=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,sP=n=>{const{inputs:t,backend:e}=n,{dy:s,y:r}=t,i=vt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Yl(nP,s.shape,r.shape):new ja(eP,s.shape,r.shape);return e.runWebGLProgram(i,[s,r],s.dtype)},rP={kernelName:ip,backendName:"webgl",kernelFunc:sP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iP=`
  return vec4(equal(a, b));
`,oP="return float(a == b);",aP=ps({opSnippet:oP,packedOpSnippet:iP,dtype:"bool",cpuKernelImpl:zF}),uP={kernelName:eh,backendName:"webgl",kernelFunc:aP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lP=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${D2};
  float a1 = ${O2};
  float a2 = ${F2};
  float a3 = ${L2};
  float a4 = ${P2};
  float a5 = ${M2};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,cP=qe({opSnippet:lP}),hP={kernelName:sl,backendName:"webgl",kernelFunc:cP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dP=Zl+`
  return exp(x);
`,fP=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,vk=qe({opSnippet:dP,packedOpSnippet:fP,cpuKernelImpl:BF,dtype:"float32"}),pP={kernelName:rl,backendName:"webgl",kernelFunc:vk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h1(n){const{inputs:t,attrs:e,backend:s}=n,{dim:r}=e,{input:i}=t,o=i.shape.length,a=i.shape.slice();let u=r;return r<0&&(V(-(o+1)<=r,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),u=o+r+1),a.splice(u,0,1),Qt({inputs:{x:i},backend:s,attrs:{shape:a}})}const mP={kernelName:nh,backendName:"webgl",kernelFunc:h1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rb="return exp(x) - 1.0;",gP=qe({opSnippet:Rb,packedOpSnippet:Rb,cpuKernelImpl:VF}),yP={kernelName:il,backendName:"webgl",kernelFunc:gP};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Db{constructor(t,e,s){this.variableNames=["real","imag"];const r=e[1];this.outputShape=e;const i=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=s?`${r}.0`:"1.0";let a;if(t==="real")a="return real * expR - imag * expI;";else if(t==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${t}.`);this.userCode=`
      const float exponentMultiplier = ${i};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${o};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kk(n,t,e){const s=e.texData.get(n.dataId),r=Et(n.shape),i=n.shape[n.shape.length-1],o=r/i,a=Qt({inputs:{x:n},backend:e,attrs:{shape:[o,i]}}),u=a.shape,l=new Db("real",u,t),c=new Db("imag",u,t),h=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:u},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:u}],d=e.runWebGLProgram(l,h,"float32"),f=e.runWebGLProgram(c,h,"float32"),p=oa({inputs:{real:d,imag:f},backend:e});e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(f);const m=Qt({inputs:{x:p},backend:e,attrs:{shape:n.shape}});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(p),m}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bP(n){const{inputs:t,backend:e}=n,{input:s}=t;return kk(s,!1,e)}const xP={kernelName:op,backendName:"webgl",kernelFunc:bP};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wP{constructor(t,e){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fd(n){const{backend:t,attrs:e}=n,{shape:s,value:r}=e;let{dtype:i}=e;if(i=i||Xa(r),i==="string"){const o=En(i,Et(s));return o.fill(r),t.makeTensorInfo(s,i,o)}else{const o=new wP(s,r),a=[[r]];return t.runWebGLProgram(o,[],i,a)}}const vP={kernelName:ap,backendName:"webgl",kernelFunc:fd};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kP{constructor(t){this.variableNames=["Image"],this.outputShape=[];const e=t[2];this.outputShape=t,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${e} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${e}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SP={kernelName:up,backendName:"webgl",kernelFunc:({inputs:n,backend:t})=>{const{image:e}=n,s=t,r=new kP(e.shape);return s.runWebGLProgram(r,[e],e.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ob="return floor(x);",IP=qe({opSnippet:Ob,packedOpSnippet:Ob,cpuKernelImpl:UF}),CP={kernelName:ol,backendName:"webgl",kernelFunc:IP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NP=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,TP=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,$P=ps({opSnippet:NP,packedOpSnippet:TP,dtype:"int32"}),EP={kernelName:al,backendName:"webgl",kernelFunc:$P};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _P{constructor(t){this.variableNames=["A"];const e=zs(),[s,r]=t;this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${s}.0);

        vec4 values = ${e.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AP{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const e=zs(),[s,r]=t;this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${s}.0);
            vec4 values = ${e.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${e.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RP={kernelName:af,backendName:"webgl",kernelFunc:DP};let xu,gg=vt().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function DP(n){const{inputs:t,backend:e,attrs:s}=n;let{pixels:r}=t;const{numChannels:i}=s,o=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[u,l]=o?[r.videoWidth,r.videoHeight]:[r.width,r.height],c=[l,u],h=[l,u,i];if(a||o){const m=vt().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(xu==null||m!==gg)&&(gg=m,xu=document.createElement("canvas").getContext("2d",{willReadFrequently:gg})),xu.canvas.width=u,xu.canvas.height=l,xu.drawImage(r,0,0,u,l),r=xu.canvas}const d=e.makeTensorInfo(c,"int32");e.texData.get(d.dataId).usage=Sr.PIXELS,e.gpgpu.uploadPixelDataToTexture(e.getTexture(d.dataId),r);const f=vt().getBool("WEBGL_PACK")?new AP(h):new _P(h),p=e.runWebGLProgram(f,[d],"int32");return e.disposeData(d.dataId),p}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OP(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=t,{strides:u,pad:l,dataFormat:c,dilations:h,dimRoundingMode:d,activation:f,leakyreluAlpha:p}=s,m=mo(c),g=rs(r.shape,i.shape,u,h,l,d,!1,m);let y;const b=[],w=o!=null,v=a!=null,S=f==="leakyrelu",N=()=>{const L=[r,i],F=(B,H)=>{if(H==="NCHW"&&B.shape.length===1&&B.shape[0]!==1){const z=Qt({inputs:{x:B},backend:e,attrs:{shape:[B.shape[0],1,1]}});return b.push(z),z}return B};if(w&&L.push(F(o,c)),v&&L.push(F(a,c)),S){const B=e.makeTensorInfo([],"float32",fo(p,"float32"));L.push(B),b.push(B)}return L};if(g.filterHeight===1&&g.filterWidth===1&&g.dilationHeight===1&&g.dilationWidth===1&&g.strideHeight===1&&g.strideWidth===1&&(g.padInfo.type==="SAME"||g.padInfo.type==="VALID"))y=gk({x:r,filter:i,convInfo:g,backend:e,bias:o,activation:f,preluActivationWeights:a,leakyreluAlpha:p});else if(g.strideWidth<=2&&m==="channelsLast"&&vt().getBool("WEBGL_EXP_CONV")){const L=f?_c(f,!0):null,F=new mk(g,w,L,v,S),B=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],H=N();y=e.runWebGLProgram(F,H,"float32",B)}else if(vt().getBool("WEBGL_CONV_IM2COL"))y=yk({x:r,filter:i,convInfo:g,backend:e,bias:o,activation:f,preluActivationWeights:a,leakyreluAlpha:p});else{const L=f?_c(f,!1):null,F=new pk(g,w,L,v,S),B=N();y=e.runWebGLProgram(F,B,"float32")}const R=Qt({inputs:{x:y},backend:e,attrs:{shape:g.outShape}});return b.push(y),b.forEach(L=>e.disposeIntermediateTensorInfo(L)),R}const FP={kernelName:xc,backendName:"webgl",kernelFunc:OP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LP(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=t,{strides:u,pad:l,dilations:c,dimRoundingMode:h,activation:d,leakyreluAlpha:f}=s,p=[];let m=c;m==null&&(m=[1,1]),V(ds(u,m),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${u} and dilations '${m}'`);const g=rs(r.shape,i.shape,u,m,l,h,!0),y=vt().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,b=d?_c(d,y):null,w=[r,i],v=o!=null,S=a!=null,N=d==="leakyrelu";if(v&&w.push(o),S&&w.push(a),N){const B=e.makeTensorInfo([],"float32",fo(f,"float32"));w.push(B),p.push(B)}let R;y?R=new wk(g,v,b,S,N):R=new xk(g,v,b,S,N);const L=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],F=e.runWebGLProgram(R,w,"float32",L);return p.forEach(B=>e.disposeIntermediateTensorInfo(B)),F}const PP={kernelName:wc,backendName:"webgl",kernelFunc:LP};class MP{constructor(t,e,s,r){this.sliceDim=t,this.strides=e,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=s;const i=un(s.length);let o=`
    int index;`;for(let a=0;a<this.sliceDim;a++)o+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${i} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${o}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zP(n){const{inputs:t,backend:e}=n,{params:s,indices:r}=t,i=r.shape,o=i[i.length-1],a=Et(s.shape),[u,l,c,h]=Am(s,r),d=Qt({inputs:{x:r},backend:e,attrs:{shape:[l,o]}}),f=Qt({inputs:{x:s},backend:e,attrs:{shape:[Et(s.shape)/c,c]}});if(e.shouldExecuteOnCPU([s,r])||s.dtype==="string"){const y=e.readSync(r.dataId),b=e.bufferSync(s),w=WF(y,b,s.dtype,l,o,c,h,s.shape,a);return e.makeTensorInfo(u,s.dtype,w.values)}const p=new MP(o,h,[l,c],s.shape),m=e.runWebGLProgram(p,[f,d],f.dtype),g=Qt({inputs:{x:m},backend:e,attrs:{shape:u}});return e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(m),g}const BP={kernelName:lp,backendName:"webgl",kernelFunc:zP};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VP{constructor(t,e){this.variableNames=["A","indices"],this.outputShape=e,this.rank=e.length;const s=un(this.rank),r=UP(t);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${t[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function UP(n,t){const e=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let r=0;r<n.length;r++)r===2?s.push("index"):s.push(`${e[r]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sk(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,indices:i}=t,{axis:o,batchDims:a}=s,u=Pe(o,r.shape)[0];if(vt().get("DEBUG")){const b=e.readSync(i.dataId),w=r.shape[u];for(let v=0;v<b.length;++v){const S=b[v];V(S<=w-1&&S>=0,()=>`GatherV2: the index value ${S} is not in [0, ${w-1}]`)}}const l=H2(r,i,u,a),c=Et(i.shape),h=[],d=Qt({inputs:{x:r},backend:e,attrs:{shape:[l.batchSize,l.outerSize,l.dimSize,l.sliceSize]}}),f=Qt({inputs:{x:i},backend:e,attrs:{shape:[l.batchSize,c/l.batchSize]}});h.push(d),h.push(f);const p=[l.batchSize,l.outerSize,c/l.batchSize,l.sliceSize];if(e.shouldExecuteOnCPU([r,i])||r.dtype==="string"){const b=e.bufferSync(f),w=e.bufferSync(d),v=GF(w,b,p);return h.forEach(S=>e.disposeIntermediateTensorInfo(S)),e.makeTensorInfo(l.outputShape,v.dtype,v.values)}const m=new VP(d.shape,p),g=e.runWebGLProgram(m,[d,f],d.dtype);h.push(g);const y=Qt({inputs:{x:g},backend:e,attrs:{shape:l.outputShape}});return h.forEach(b=>e.disposeIntermediateTensorInfo(b)),y}const WP={kernelName:rh,backendName:"webgl",kernelFunc:Sk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GP="return float(a > b);",jP=`
  return vec4(greaterThan(a, b));
`,HP=ps({opSnippet:GP,packedOpSnippet:jP,cpuKernelImpl:jF,dtype:"bool"}),KP={kernelName:ih,backendName:"webgl",kernelFunc:HP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qP="return float(a >= b);",XP=`
  return vec4(greaterThanEqual(a, b));
`,YP=ps({opSnippet:qP,packedOpSnippet:XP,dtype:"bool",cpuKernelImpl:HF}),ZP={kernelName:ul,backendName:"webgl",kernelFunc:YP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JP(n){const{inputs:t,backend:e}=n,{input:s}=t;return kk(s,!0,e)}const QP={kernelName:cp,backendName:"webgl",kernelFunc:JP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tM="return float(!isnan(x) && !isinf(x));",eM=qe({opSnippet:tM,dtype:"bool"}),nM={kernelName:cl,backendName:"webgl",kernelFunc:eM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sM="return float(isinf(x));",rM=qe({opSnippet:sM,dtype:"bool"}),iM={kernelName:hl,backendName:"webgl",kernelFunc:rM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oM="return float(isnan(x));",aM=qe({opSnippet:oM,dtype:"bool"}),uM={kernelName:dl,backendName:"webgl",kernelFunc:aM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lM="return float(a < b);",cM=`
  return vec4(lessThan(a, b));
`,hM=ps({opSnippet:lM,packedOpSnippet:cM,cpuKernelImpl:KF,dtype:"bool"}),dM={kernelName:ah,backendName:"webgl",kernelFunc:hM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fM="return float(a <= b);",pM=`
  return vec4(lessThanEqual(a, b));
`,mM=ps({opSnippet:fM,packedOpSnippet:pM,cpuKernelImpl:qF,dtype:"bool"}),gM={kernelName:uh,backendName:"webgl",kernelFunc:mM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yM(n){const{backend:t,attrs:e}=n,{start:s,stop:r,num:i}=e,o=XF(s,r,i);return t.makeTensorInfo([o.length],"float32",o)}const bM={kernelName:dp,backendName:"webgl",kernelFunc:yM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xM=Zl+`
  return x < 0.0 ? 0./0. : log(x);
`,wM=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,vM=qe({opSnippet:xM,packedOpSnippet:wM,cpuKernelImpl:YF}),kM={kernelName:fl,backendName:"webgl",kernelFunc:vM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SM=Zl+`
  return log(1.0 + x);
`,IM=qe({opSnippet:SM}),CM={kernelName:pl,backendName:"webgl",kernelFunc:IM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NM="return float(a >= 1.0 && b >= 1.0);",TM=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,$M=ps({opSnippet:NM,packedOpSnippet:TM,dtype:"bool"}),EM={kernelName:lh,backendName:"webgl",kernelFunc:$M};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _M="return float(!(x >= 1.0));",AM=qe({opSnippet:_M}),RM={kernelName:ch,backendName:"webgl",kernelFunc:AM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DM="return float(a >= 1.0 || b >= 1.0);",OM=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,FM=ps({opSnippet:DM,packedOpSnippet:OM,dtype:"bool"}),LM={kernelName:hh,backendName:"webgl",kernelFunc:FM};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PM{constructor(t,e,s,r,i){this.variableNames=["x"],this.outputShape=[];const o=e,a=t[3]-1;this.outputShape=t;let u;const l=`float(${s}) + float(${r}) * sum`;i===.5?u=`inversesqrt(${l})`:i===1?u=`1.0/(${l})`:u=`exp(log(${l}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${o}; j <= ${o}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${u};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class MM{constructor(t,e,s,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=e,a=t[3]-1;this.outputShape=t;let u;const l=`float(${s}) + float(${r}) * sum`;i===.5?u=`inversesqrt(${l})`:i===1?u=`1.0/(${l})`:u=`exp(log(${l}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${o};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${o}; j <= ${o}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${u};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zM=n=>{const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{depthRadius:i,bias:o,alpha:a,beta:u}=s,l=vt().getBool("WEBGL_PACK_NORMALIZATION")?new MM(r.shape,i,o,a,u):new PM(r.shape,i,o,a,u);return e.runWebGLProgram(l,[r],r.dtype)},BM={kernelName:dh,backendName:"webgl",kernelFunc:zM};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VM{constructor(t,e,s,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=e,this.bias=s,this.alpha=r,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${e})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${e} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${i})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${i});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UM=n=>{const{inputs:t,backend:e,attrs:s}=n,{x:r,y:i,dy:o}=t,{depthRadius:a,bias:u,alpha:l,beta:c}=s,h=new VM(r.shape,a,u,l,c);return e.runWebGLProgram(h,[r,i,o],r.dtype)},WM={kernelName:fp,backendName:"webgl",kernelFunc:UM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GM(n,t,e,s){const r=Et(t),o=Et(n.shape)/r,a=Qt({inputs:{x:n},attrs:{shape:[o,r]},backend:s}),u=lu(a,n.dtype,"max",s),l=Qt({inputs:{x:u},attrs:{shape:e},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(u),l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ik(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{reductionIndices:i,keepDims:o}=s,a=r.shape.length,u=Pe(i,r.shape);let l=u;const c=Tn(l,a),h=c!=null,d=e.shouldExecuteOnCPU([r]);let f=r;if(h){if(d){const w=e.texData.get(f.dataId).values,v=new Array(a);for(let R=0;R<v.length;R++)v[R]=r.shape[c[R]];const S=sy(w,r.shape,r.dtype,c,v);f=e.makeTensorInfo(v,r.dtype);const N=e.texData.get(f.dataId);N.values=S}else f=zm(r,c,e);l=Rn(l.length,a)}fs("max",l,a);const[p,m]=is(f.shape,l);let g=p;o&&(g=An(p,u));let y;if(d){const w=e.texData.get(f.dataId).values,v=ZF(w,Et(m),g,r.dtype);y=e.makeTensorInfo(g,r.dtype);const S=e.texData.get(y.dataId);S.values=v}else y=GM(f,m,g,e);return h&&e.disposeIntermediateTensorInfo(f),y}const jM={kernelName:fh,backendName:"webgl",kernelFunc:Ik};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HM=ry+`
  return max(a, b);
`,KM=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+uu+`
  return result;
`,qM=ps({opSnippet:HM,packedOpSnippet:KM,cpuKernelImpl:JF}),XM={kernelName:ml,backendName:"webgl",kernelFunc:qM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YM(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t;cd(r,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:u}=s,l=1;V(ds(o,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${l}'`);const c=jr(r.shape,i,o,l,a,u);if(c.filterWidth===1&&c.filterHeight===1&&Ve(c.inShape,c.outShape))return hr({inputs:{x:r},backend:e});const h=new Ac(c,"max",!1);return e.runWebGLProgram(h,[r],r.dtype)}const ZM={kernelName:ph,backendName:"webgl",kernelFunc:YM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JM(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{filterSize:i,strides:o,pad:a,dataFormat:u,dimRoundingMode:l}=s,c=[1,1,1],h=po(r.shape,i,o,c,a,l,u),d=new oy(h,"max",!1);return e.runWebGLProgram(d,[r],r.dtype)}const QM={kernelName:mh,backendName:"webgl",kernelFunc:JM};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tz{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const e=t.strideHeight,s=t.strideWidth,r=t.dilationHeight,i=t.effectiveFilterHeight,o=t.effectiveFilterWidth,a=i-1-t.padInfo.top,u=o-1-t.padInfo.left,l=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${u});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${i};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${e}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${o}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${l} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${o} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class ez{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const e=t.strideDepth,s=t.strideHeight,r=t.strideWidth,i=t.dilationDepth,o=t.dilationHeight,a=t.dilationWidth,u=t.effectiveFilterDepth,l=t.effectiveFilterHeight,c=t.effectiveFilterWidth,h=u-1-t.padInfo.front,d=l-1-t.padInfo.top,f=c-1-t.padInfo.left,p=u*l*c-1;this.userCode=`
      const ivec3 pads = ivec3(${h}, ${d}, ${f});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${u};
           wD += ${i}) {
          float dyD = float(dyDCorner + wD) / ${e}.0;

          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${l};
              wR += ${o}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${c};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${p} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${l} * ${c} +
                  wR * ${c} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nz(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,input:i}=t,o=i,{filterSize:a,strides:u,pad:l,dimRoundingMode:c}=s,h=[1,1,1],d=po(o.shape,a,u,h,l,c),f=new oy(d,"max",!0),p=e.runWebGLProgram(f,[o],o.dtype),m=new ez(d),g=e.runWebGLProgram(m,[r,p],o.dtype);return e.disposeIntermediateTensorInfo(p),g}const sz={kernelName:mp,backendName:"webgl",kernelFunc:nz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rz(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,input:i,output:o}=t,a=i;cd([i,o],"maxPoolGrad");const{filterSize:u,strides:l,pad:c,dimRoundingMode:h}=s,d=jr(a.shape,u,l,1,c,h),f=!0,p=new Ac(d,"max",f),m=e.runWebGLProgram(p,[a],a.dtype),g=new tz(d),y=e.runWebGLProgram(g,[r,m],a.dtype);return e.disposeIntermediateTensorInfo(m),y}const iz={kernelName:pp,backendName:"webgl",kernelFunc:rz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oz(n,t,e,s){let r=new Ac(e,"max",!1);const i=s.runWebGLProgram(r,[n],"float32");r=new Ac(e,"max",!0,!0,t);const o=s.runWebGLProgram(r,[n],"float32");return[i,o]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const az={kernelName:gp,backendName:"webgl",kernelFunc:({inputs:n,attrs:t,backend:e})=>{const{x:s}=n,{filterSize:r,strides:i,pad:o,includeBatchInIndex:a}=t,u=e;V(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const l=[1,1];V(ds(i,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${l}'`);const c=jr(s.shape,r,i,l,o),[h,d]=oz(s,a,c,u);return[h,d]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uz(n,t,e,s){const r=Et(t),o=Et(n.shape)/r,a=Qt({inputs:{x:n},attrs:{shape:[o,r]},backend:s}),u=lu(a,"float32","mean",s),l=Qt({inputs:{x:u},attrs:{shape:e},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(u),l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lz={kernelName:gh,backendName:"webgl",kernelFunc:({inputs:n,attrs:t,backend:e})=>{const{x:s}=n,{keepDims:r,axis:i}=t,o=e,a=s.shape.length,u=Pe(i,s.shape);let l=u;const c=Tn(l,a),h=c!=null,d=o.shouldExecuteOnCPU([s]),f=[];let p=s;if(h){if(d){const v=o.texData.get(p.dataId).values,S=new Array(a);for(let L=0;L<S.length;L++)S[L]=s.shape[c[L]];const N=sy(v,s.shape,s.dtype,c,S);p=o.makeTensorInfo(S,s.dtype);const R=o.texData.get(p.dataId);R.values=N}else p=zm(s,c,o);f.push(p),l=Rn(l.length,a)}fs("sum",l,a);const[m,g]=is(p.shape,l);let y=m;r&&(y=An(m,u));const b=uz(p,g,y,o);for(const w of f)o.disposeIntermediateTensorInfo(w);return b}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cz(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i,keepDims:o}=s,a=r.shape.length,u=Pe(i,r.shape);let l=u;const c=Tn(l,a);let h=r;c!=null&&(h=Ls({inputs:{x:r},backend:e,attrs:{perm:c}}),l=Rn(l.length,r.shape.length)),fs("min",l,a);const[d,f]=is(h.shape,l),p=Et(f),m=Qt({inputs:{x:h},backend:e,attrs:{shape:[-1,p]}}),g=lu(m,m.dtype,"min",e);let y;if(o){const b=An(d,u);y=Qt({inputs:{x:g},backend:e,attrs:{shape:b}})}else y=Qt({inputs:{x:g},backend:e,attrs:{shape:d}});return e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(g),c!=null&&e.disposeIntermediateTensorInfo(h),y}const hz={kernelName:yh,backendName:"webgl",kernelFunc:cz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dz=ry+`
  return min(a, b);
`,fz=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+uu+`
  return result;
`,pz=ps({opSnippet:dz,packedOpSnippet:fz,cpuKernelImpl:QF}),mz={kernelName:gl,backendName:"webgl",kernelFunc:pz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gz{constructor(t,e,s){this.variableNames=["x"],this.outputShape=e.map((c,h)=>c[0]+t[h]+c[1]);const r=t.length,i=un(r),o=e.map(c=>c[0]).join(","),a=e.map((c,h)=>c[0]+t[h]).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),l=s==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${l};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${l};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${l};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${l};
          }
        }
        ${i} coords = outC - start;
        setOutput(getX(${u}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yz{constructor(t,e,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map((p,m)=>p[0]+t[m]+p[1]);const r=t.length,i=un(r),o=e.map(p=>p[0]).join(","),a=e.map((p,m)=>p[0]+t[m]).join(","),u=Rs("rc",r),l=Rs("source",r),c=`${u[r-1]} < ${this.outputShape[r-1]}`,h=r===1?"source":`vec2(${l.slice(-2).join()})`,d=s==="reflect"?0:1;let f="";if(r===1){const p=`
        ${i} source = rc;
        if (source < start) {
          source = start * 2 - source - ${d};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${d};
        }
        source -= start;
      `;f=`
        ${i} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${l.join()}), ${h});
        ${u[r-1]} += 1;
        if(${c}) {
          ${p}
          result[1] = getChannel(getX(${l.join()}), ${h});
        }
      `}else{const p=`
        ${i} source = rc;
        ${i} lt = ${i}(lessThan(source, start));
        ${i} gte = ${i}(greaterThanEqual(source, end));
        ${i} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${d}) +
                gte * ((end - 1) * 2 - source + ${d});
        source -= start;
      `;f=`
        ${i} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${l.join()}), ${h});
        ${u[r-1]} += 1;
        if(${c}) {
          ${p}
          result[1] = getChannel(getX(${l.join()}), ${h});
        }
        rc = outputLoc;
        ${u[r-2]} += 1;
        if(${u[r-2]} < ${this.outputShape[r-2]}) {
          ${p}
          result[2] = getChannel(getX(${l.join()}), ${h});
          ${u[r-1]} += 1;
          if(${c}) {
            ${p}
            result[3] = getChannel(getX(${l.join()}), ${h});
          }
        }
      `}this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${f}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bz=({inputs:n,backend:t,attrs:e})=>{const{x:s}=n,{paddings:r,mode:i}=e,o=vt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new yz(s.shape,r,i):new gz(s.shape,r,i);return t.runWebGLProgram(o,[s],s.dtype)},xz={kernelName:bh,backendName:"webgl",kernelFunc:bz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wz=`if (b == 0.0) return NAN;
  return mod(a, b);`,vz=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+uu+`
  return result;
`,kz=ps({opSnippet:wz,packedOpSnippet:vz}),Sz={kernelName:yl,backendName:"webgl",kernelFunc:kz};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Iz{constructor(t,e,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[t,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${e-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${e-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cz=`
if (a == b) {
  return 1.0;
};
return a / b;`,Nz=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,Ck=ps({opSnippet:Cz,packedOpSnippet:Nz,checkOutOfBounds:!0}),Tz={kernelName:el,backendName:"webgl",kernelFunc:Ck};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fb="return a - b;",Nk=ps({opSnippet:Fb,packedOpSnippet:Fb,supportsComplex:!0,cpuKernelImpl:w8}),$z={kernelName:Dl,backendName:"webgl",kernelFunc:Nk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tk(n){const{inputs:t,backend:e,attrs:s}=n,{logits:r}=t,{dim:i}=s,o=Pe([i],r.shape),a=Ik({inputs:{x:r},backend:e,attrs:{reductionIndices:o,keepDims:!1}}),u=An(a.shape,o),l=Qt({inputs:{x:a},backend:e,attrs:{shape:u}}),c=Nk({inputs:{a:r,b:l},backend:e}),h=vk({inputs:{x:c},backend:e}),d=Bm({inputs:{x:h},backend:e,attrs:{axis:o,keepDims:!1}}),f=Qt({inputs:{x:d},backend:e,attrs:{shape:u}}),p=Ck({inputs:{a:h,b:f},backend:e});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(l),e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(f),p}const Ez={kernelName:Lh,backendName:"webgl",kernelFunc:Tk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _z(n){const{inputs:t,backend:e,attrs:s}=n,{logits:r}=t,{numSamples:i,seed:o,normalized:a}=s,u=a?r:Tk({inputs:{logits:r},backend:e,attrs:{dim:r.shape.length-1}}),l=u.shape[0],c=u.shape[1],h=new Iz(l,c,i),d=[[o]],f=e.runWebGLProgram(h,[u],"int32",d);return a||e.disposeIntermediateTensorInfo(u),f}const Az={kernelName:yp,backendName:"webgl",kernelFunc:_z};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rz=Hr+`
  return -x;
`,Dz=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function Oz(n){const{inputs:t,backend:e}=n,{x:s}=t;if(e.shouldExecuteOnCPU([s])){const i=e.texData.get(s.dataId),[o,a]=e8(i.values,s.shape,s.dtype);return e.makeTensorInfo(a,s.dtype,o)}let r;return vt().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new Fo(s.shape,Dz):r=new Ei(s.shape,Rz),e.runWebGLProgram(r,[s],s.dtype)}const Fz={kernelName:xh,backendName:"webgl",kernelFunc:Oz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lz=Tm;function Pz(n){wr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:e,attrs:s}=n,{boxes:r,scores:i}=t,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u}=s,l=e.readSync(r.dataId),c=e.readSync(i.dataId),{selectedIndices:h}=Lz(l,c,o,a,u);return e.makeTensorInfo([h.length],"int32",new Int32Array(h))}const Mz={kernelName:bp,backendName:"webgl",kernelFunc:Pz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zz=$m;function Bz(n){wr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:e,attrs:s}=n,{boxes:r,scores:i}=t,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u,padToMaxOutputSize:l}=s,c=e.readSync(r.dataId),h=e.readSync(i.dataId),{selectedIndices:d,validOutputs:f}=zz(c,h,o,a,u,l);return[e.makeTensorInfo([d.length],"int32",new Int32Array(d)),e.makeTensorInfo([],"int32",new Int32Array([f]))]}const Vz={kernelName:xp,backendName:"webgl",kernelFunc:Bz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uz=Em;function Wz(n){wr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:e,attrs:s}=n,{boxes:r,scores:i}=t,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u,softNmsSigma:l}=s,c=e.readSync(r.dataId),h=e.readSync(i.dataId),d=o,f=a,p=u,m=l,{selectedIndices:g,selectedScores:y}=Uz(c,h,d,f,p,m);return[e.makeTensorInfo([g.length],"int32",new Int32Array(g)),e.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const Gz={kernelName:wp,backendName:"webgl",kernelFunc:Wz};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jz{constructor(t,e,s,r){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hz=n=>{const{inputs:t,backend:e,attrs:s}=n,{indices:r}=t,{dtype:i,depth:o,onValue:a,offValue:u}=s,l=Et(r.shape),c=new jz(l,o,a,u),h=Qt({inputs:{x:r},backend:e,attrs:{shape:[l]}}),d=e.runWebGLProgram(c,[h],i);e.disposeIntermediateTensorInfo(h);const f=[...r.shape,o],p=Qt({inputs:{x:d},backend:e,attrs:{shape:f}});return e.disposeIntermediateTensorInfo(d),p},Kz={kernelName:kh,backendName:"webgl",kernelFunc:Hz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bf(n){const{inputs:t,backend:e}=n,{x:s}=t;if(s.dtype==="complex64"){const r=dd({inputs:{input:s},backend:e}),i=bf({inputs:{x:r},backend:e}),o=Vm({inputs:{input:s},backend:e}),a=bf({inputs:{x:o},backend:e}),u=oa({inputs:{real:i,imag:a},backend:e});return e.disposeIntermediateTensorInfo(r),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(a),u}else return fd({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:e})}const qz={kernelName:Bh,backendName:"webgl",kernelFunc:bf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $k(n){const{inputs:t,backend:e}=n,{x:s}=t;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const r=dd({inputs:{input:s},backend:e}),i=$k({inputs:{x:r},backend:e}),o=Vm({inputs:{input:s},backend:e}),a=bf({inputs:{x:o},backend:e}),u=oa({inputs:{real:i,imag:a},backend:e});return e.disposeIntermediateTensorInfo(r),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(a),u}else return fd({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:e})}const Xz={kernelName:vh,backendName:"webgl",kernelFunc:$k};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yz(n){const{inputs:t,backend:e,attrs:s}=n,{axis:r}=s;if(t.length===1)return h1({inputs:{input:t[0]},backend:e,attrs:{dim:r}});const i=t[0].shape,o=t[0].dtype;t.forEach(c=>{hs(i,c.shape,"All tensors passed to stack must have matching shapes"),V(o===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],u=t.map(c=>{const h=h1({inputs:{input:c},backend:e,attrs:{dim:r}});return a.push(h),h}),l=fk({inputs:u,backend:e,attrs:{axis:r}});return a.forEach(c=>e.disposeIntermediateTensorInfo(c)),l}const Zz={kernelName:Sh,backendName:"webgl",kernelFunc:Yz};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jz{constructor(t,e,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=e.map((l,c)=>l[0]+t[c]+l[1]);const r=t.length,i=un(r),o=e.map(l=>l[0]).join(","),a=e.map((l,c)=>l[0]+t[c]).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${i} coords = outC - start;
          setOutput(getX(${u}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qz{constructor(t,e,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=e.map((m,g)=>m[0]+t[g]+m[1]);const r=t.length,i=un(r),o=e.map(m=>m[0]).join(","),a=e.map((m,g)=>m[0]+t[g]).join(","),u=Rs("rc",r),l=Rs("source",r),c=`${u[r-1]} < ${this.outputShape[r-1]}`,h=r===1?"source":`vec2(${l.slice(-2).join()})`,d=[`${i} rc = outputLoc;`,`${u[r-1]} += 1;
       if(${c}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${u[r-2]} += 1;
       if(${u[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${u[r-1]} += 1;
         if(${c}) {`],f=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let p="";for(let m=0,g=r===1?2:4;m<g;m++)p+=`
        ${d[m]}
        if (${f}) {
          result[${m}] = float(value);
        } else {
          ${i} source = rc - start;
          result[${m}] = getChannel(getX(${l.join()}), ${h});
        }
      `;p+=r===1?"} ":"}}",this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${p}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ek=n=>{const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{paddings:i,constantValue:o}=s;if(Et(r.shape)===0){const l=i.map((c,h)=>c[0]+r.shape[h]+c[1]);return fd({backend:e,attrs:{shape:l,value:o,dtype:r.dtype}})}const a=vt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Qz(r.shape,i,o):new Jz(r.shape,i,o),u=[[o]];return e.runWebGLProgram(a,[r],r.dtype,u)},tB={kernelName:Ih,backendName:"webgl",kernelFunc:Ek};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eB=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,nB=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+uu+`
  return result;
`,sB=ps({opSnippet:eB,packedOpSnippet:nB}),rB={kernelName:xl,backendName:"webgl",kernelFunc:sB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iB(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i,keepDims:o}=s,a=r.shape.length,u=[],l=Pe(i,r.shape);let c=l;const h=Tn(c,a);let d=r;h!=null&&(d=Ls({inputs:{x:r},backend:e,attrs:{perm:h}}),c=Rn(c.length,a),u.push(d)),fs("prod",c,a);let f;if(e.shouldExecuteOnCPU([d])){const p=e.texData.get(d.dataId).values,{outVals:m,outShape:g,outDtype:y}=s8(d.shape,d.dtype,p,c);f=e.makeTensorInfo(g,y,m)}else{const[p,m]=is(d.shape,c),g=Et(m),y=Qt({inputs:{x:d},backend:e,attrs:{shape:[-1,g]}}),b=Hp(r.dtype),w=lu(y,b,"prod",e);f=Qt({inputs:{x:w},backend:e,attrs:{shape:p}}),u.push(y),u.push(w)}if(o){u.push(f);const p=An(f.shape,l);f=Qt({inputs:{x:f},backend:e,attrs:{shape:p}})}return u.forEach(p=>e.disposeIntermediateTensorInfo(p)),f}const oB={kernelName:Nh,backendName:"webgl",kernelFunc:iB};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aB(n){const{inputs:t,backend:e,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:i,indices:o}=t,{outputRaggedRank:a}=s,u=r.map(y=>e.readSync(y.dataId)),l=r.map(y=>y.shape),c=e.readSync(i.dataId),h=e.readSync(o.dataId),[d,f,p]=r8(u,l,c,i.shape,i.dtype,h,o.shape,a),m=d.map(y=>e.makeTensorInfo([y.length],"int32",y)),g=e.makeTensorInfo(p,i.dtype,f);return m.concat([g])}const uB={kernelName:vp,backendName:"webgl",kernelFunc:aB};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lB(n){const{inputs:t,backend:e}=n,{starts:s,limits:r,deltas:i}=t,o=e.readSync(s.dataId),a=e.readSync(r.dataId),u=e.readSync(i.dataId),[l,c]=i8(o,s.shape,s.dtype,a,r.shape,u,i.shape),h=e.makeTensorInfo([l.length],"int32",l),d=e.makeTensorInfo([c.length],s.dtype,c);return[h,d]}const cB={kernelName:kp,backendName:"webgl",kernelFunc:lB};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hB(n){const{inputs:t,backend:e,attrs:s}=n,{shape:r,values:i,defaultValue:o,rowPartitionTensors:a}=t,{rowPartitionTypes:u}=s,l=e.readSync(r.dataId),c=e.readSync(i.dataId),h=e.readSync(o.dataId),d=a.map(g=>e.readSync(g.dataId)),f=a.map(g=>g.shape),[p,m]=o8(l,r.shape,c,i.shape,i.dtype,h,o.shape,d,f,u);return e.makeTensorInfo(p,i.dtype,m)}const dB={kernelName:Sp,backendName:"webgl",kernelFunc:hB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _k=n=>{const{backend:t,attrs:e}=n,{start:s,stop:r,step:i,dtype:o}=e,a=a8(s,r,i,o);return t.makeTensorInfo([a.length],o,a)},fB={kernelName:Ip,backendName:"webgl",kernelFunc:_k};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pB="return 1.0 / x;",mB=qe({opSnippet:pB}),gB={kernelName:wl,backendName:"webgl",kernelFunc:mB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yB=Hr+`
  return (x < 0.0) ? 0.0 : x;
`,bB=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,xB=qe({opSnippet:yB,packedOpSnippet:bB}),wB={kernelName:vl,backendName:"webgl",kernelFunc:xB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vB=Hr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,kB=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,SB=qe({opSnippet:vB,packedOpSnippet:kB}),IB={kernelName:kl,backendName:"webgl",kernelFunc:SB};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CB{constructor(t,e,s,r,i){this.variableNames=["A"],this.outputShape=[];const[o,a,u,l]=t;this.outputShape=[o,e,s,l];const c=[r&&e>1?a-1:a,r&&s>1?u-1:u],h=[r&&e>1?e-1:e,r&&s>1?s-1:s];let d;i?d="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":d="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${c[0]/h[0]},
          ${c[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${u}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${d};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NB{constructor(t,e,s,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,u,l]=t;this.outputShape=[o,e,s,l];const c=[r&&e>1?a-1:a,r&&s>1?u-1:u],h=[r&&e>1?e-1:e,r&&s>1?s-1:s];let d;i?d="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":d="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${c[0]/h[0]},
          ${c[1]/h[1]},
          ${c[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${u}.0,
                                     ${u}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${d};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${l-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TB(n){const{inputs:t,backend:e,attrs:s}=n,{images:r}=t,{alignCorners:i,halfPixelCenters:o,size:a}=s,[u,l]=a,c=vt().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new NB(r.shape,u,l,i,o):new CB(r.shape,u,l,i,o);return e.runWebGLProgram(c,[r],"float32")}const $B={kernelName:Eh,backendName:"webgl",kernelFunc:TB};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class EB{constructor(t,e,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;const[,r,i]=e,[,o,a]=t,u=[s&&o>1?r-1:r,s&&a>1?i-1:i],l=[s&&o>1?o-1:o,s&&a>1?a-1:a],c=u[0]/l[0],h=u[1]/l[1],d=1/c,f=1/h,p=Math.ceil(d)*2+2,m=Math.ceil(f)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${c});
        const float widthScale = float(${h});

        const float invHeightScale = float(${d});
        const float invWidthScale = float(${f});

        const int winHeight = int(${p});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _B(n){const{inputs:t,backend:e,attrs:s}=n,{images:r,dy:i}=t,{alignCorners:o}=s,a=new EB(i.shape,r.shape,o);return e.runWebGLProgram(a,[i],i.dtype)}const AB={kernelName:Tp,backendName:"webgl",kernelFunc:_B};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class RB{constructor(t,e,s,r,i){this.variableNames=["A"],this.outputShape=[];const[o,a,u,l]=t;this.outputShape=[o,e,s,l];const c=[r&&e>1?a-1:a,r&&s>1?u-1:u],h=[r&&e>1?e-1:e,r&&s>1?s-1:s],d=r?"0.5":"0.0";let f;i?f="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${c[0]/h[0]},
          ${c[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${u}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${d})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DB{constructor(t,e,s,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,u,l]=t;this.outputShape=[o,e,s,l];const c=[r&&e>1?a-1:a,r&&s>1?u-1:u],h=[r&&e>1?e-1:e,r&&s>1?s-1:s],d=r?"0.5":"0.0";let f;i?f="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${c[0]/h[0]},
          ${c[1]/h[1]},
          ${c[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${u}.0,
                                     ${u}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${d})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${l-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OB(n){const{inputs:t,backend:e,attrs:s}=n,{images:r}=t,{alignCorners:i,halfPixelCenters:o,size:a}=s,[u,l]=a,c=vt().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new DB(r.shape,u,l,i,o):new RB(r.shape,u,l,i,o);return e.runWebGLProgram(c,[r],r.dtype)}const FB={kernelName:$h,backendName:"webgl",kernelFunc:OB};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LB{constructor(t,e,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;const[,r,i]=e,[,o,a]=t,u=[s&&o>1?r-1:r,s&&a>1?i-1:i],l=[s&&o>1?o-1:o,s&&a>1?a-1:a],c=u[0]/l[0],h=u[1]/l[1],d=1/c,f=1/h,p=Math.ceil(d)*2+2,m=Math.ceil(f)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${c});
        const float widthScale = float(${h});

        const float invHeightScale = float(${d});
        const float invWidthScale = float(${f});

        const int winHeight = int(${p});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${u[0]}) *
                (float(dyR) / float(${l[0]}));

            float sourceFracCol =
                float(${u[1]}) *
                  (float(dyC) / float(${l[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${i}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PB(n){const{inputs:t,backend:e,attrs:s}=n,{images:r,dy:i}=t,{alignCorners:o}=s,a=new LB(i.shape,r.shape,o);return e.runWebGLProgram(a,[i],i.dtype)}const MB={kernelName:Np,backendName:"webgl",kernelFunc:PB};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zB{constructor(t,e){this.variableNames=["x"];const s=t.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=t,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${t[0]} - coord - 1));
        }
      `;return}const r=a=>e.indexOf(a)!==-1&&t[a]!==1?`${t[a]} - coords[${a}] - 1`:`coords[${a}]`,i=t.map((a,u)=>r(u)).join(","),o=un(s);this.userCode=`
      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class BB{constructor(t,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=t.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=t;const r=Rs("rc",s),i=`${r[s-1]} + 1 < ${this.outputShape[s-1]}`,o=`${r[s-2]} + 1 < ${this.outputShape[s-2]}`,a=un(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${t[0]} - rc - 1),
            ${t[0]} - rc - 1);
          if(${i}){
              result.g = getChannel(getX(${t[0]} - (rc  + 1) - 1),
                ${t[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${u(r.slice())};
          if(${i}){
            result.g = ${l(r.slice())};
          }
          if(${o}) {
            result.b = ${c(r.slice())};
            if(${i}) {
              result.a = ${h(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function u(p){return d(p)}function l(p){return p[s-1]="("+p[s-1]+" + 1)",d(p)}function c(p){return p[s-2]="("+p[s-2]+" + 1)",d(p)}function h(p){return p[s-1]="("+p[s-1]+" + 1)",p[s-2]="("+p[s-2]+" + 1)",d(p)}function d(p){const m=t.map((b,w)=>f(w,p)),g=m.join(","),y=m.slice(-2).join(",");return`getChannel(getX(${g}), vec2(${y}))`}function f(p,m){return e.indexOf(p)!==-1&&t[p]!==1?`${t[p]} - ${m[p]} - 1`:`${m[p]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VB(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{dims:i}=s,o=r.shape.length,a=Pe(i,r.shape);if(o===0)return hr({inputs:{x:r},backend:e});const u=vt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new BB(r.shape,a):new zB(r.shape,a);return e.runWebGLProgram(u,[r],r.dtype)}const UB={kernelName:_h,backendName:"webgl",kernelFunc:VB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WB{constructor(t,e){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=t[1],r=t[2];this.outputShape=t;let i="";typeof e=="number"?i=`float outputValue = ${e.toFixed(2)};`:i=`
        vec3 fill = vec3(${e.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${i}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GB={kernelName:Gp,backendName:"webgl",kernelFunc:({inputs:n,attrs:t,backend:e})=>{const{image:s}=n,{radians:r,fillValue:i,center:o}=t,a=e,u=new WB(s.shape,i),[l,c]=_2(o,s.shape[1],s.shape[2]),h=[[l,c,Math.sin(r),Math.cos(r)]];return a.runWebGLProgram(u,[s],s.dtype,h)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jB=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,HB=qe({opSnippet:jB}),KB={kernelName:Sl,backendName:"webgl",kernelFunc:HB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qB="return inversesqrt(x);",XB=qe({opSnippet:qB,cpuKernelImpl:u8}),YB={kernelName:Il,backendName:"webgl",kernelFunc:XB};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ay{constructor(t,e,s,r,i,o,a=!0,u=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const l=un(i.length),c=un(o.length);let h="";s===1?h="i":s===2&&(h="i, j");const d=`getIndices(${h})`;let f="";r===1?f="i":r===2&&(f="i, coords[1]");const p=`getUpdates(${f})`;let m="";u&&(m="coords[0], coords[1]");const g=`getDefaultValue(${m})`,y=e>1?"strides[j]":"strides";this.userCode=`
        ${l} strides = ${l}(${i});

        void main() {
          ${c} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${t}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${e}; j++) {
              int index = round(${d});
              flattenedIndex += index * ${y};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${p};
              found = true;
            }
          }
          setOutput(mix(${g}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ZB{constructor(t,e,s,r,i,o,a=!0,u=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;const l=un(i.length),c=un(o.length);let h="";s===1?h="i":s===2&&(h="i, j");const d=`getIndices(${h})`;let f="";r===1?f="i":r===2&&(f="i, coords[1]");const p=`getUpdates(${f})`;let m="";u&&(m="coords[0], coords[1]");const g=`getDefaultValue(${m})`,y=e>1?"strides[j]":"strides",b=e>1?"strides[j + 1]":"strides";this.userCode=`
        ${l} strides = ${l}(${i});

        void main() {
          ${c} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${t}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${e}; j+=2) {
              ivec4 index = round(${d});
              flattenedIndex += index.xz * ${y};
              if (j + 1 < ${e}) {
                flattenedIndex += index.yw * ${b};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${p};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${g}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JB(n){const{inputs:t,backend:e,attrs:s}=n,{indices:r,updates:i}=t,{shape:o}=s,{sliceRank:a,numUpdates:u,sliceSize:l,strides:c,outputSize:h}=ra(i,r,o),d=[h/l,l];if(h===0)return e.makeTensorInfo(o,r.dtype);const f=Qt({inputs:{x:r},backend:e,attrs:{shape:[u,a]}}),p=Qt({inputs:{x:i},backend:e,attrs:{shape:[u,l]}}),m=e.makeTensorInfo([],"float32",new Float32Array([0]));let g;vt().getBool("WEBGL_PACK")?g=new ZB(u,a,f.shape.length,p.shape.length,c,d):g=new ay(u,a,f.shape.length,p.shape.length,c,d);const y=e.runWebGLProgram(g,[p,f,m],p.dtype),b=Qt({inputs:{x:y},backend:e,attrs:{shape:o}});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(y),e.disposeIntermediateTensorInfo(m),b}const QB={kernelName:$p,backendName:"webgl",kernelFunc:JB};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tV{constructor(t,e,s,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[t,s];const i="while (left < right) {",o=`for (int i = 0; i < ${Math.ceil(Math.log2(e+1))}; ++i) { if (left >= right) break;`,a=vt().getNumber("WEBGL_VERSION")===2?i:o,u=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${u} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eV(n){const{inputs:t,backend:e,attrs:s}=n,{sortedSequence:r,values:i}=t,{side:o}=s,a=new tV(r.shape[0],r.shape[1],i.shape[1],o),u=[[r.shape[1]]];return e.runWebGLProgram(a,[r,i],"int32",u)}const nV={kernelName:_p,backendName:"webgl",kernelFunc:eV};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sV{constructor(t,e,s){this.variableNames=["c","a","b"],this.outputShape=e;let r,i;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)i="resRC",r="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],u=[],l=[];for(let c=0;c<e.length;c++)l.push(`${a[c]}`),c<t&&u.push(`${a[c]}`);r=u.join(),i=l.join()}const o=un(s);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${i}));
        } else {
          setOutput(getB(${i}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rV(n){const{inputs:t,backend:e}=n,{condition:s,t:r,e:i}=t,o=new sV(s.shape.length,r.shape,r.shape.length);return e.runWebGLProgram(o,[s,r,i],qs(r.dtype,i.dtype))}const iV={kernelName:Ah,backendName:"webgl",kernelFunc:rV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oV=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${Om};
  float scale = ${Fm};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,aV=qe({opSnippet:oV}),uV={kernelName:Cl,backendName:"webgl",kernelFunc:aV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lV=Zl+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,cV=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,hV=qe({opSnippet:lV,packedOpSnippet:cV,cpuKernelImpl:c8}),dV={kernelName:El,backendName:"webgl",kernelFunc:hV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fV=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,pV=qe({opSnippet:fV}),mV={kernelName:$l,backendName:"webgl",kernelFunc:pV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gV=Zl+`
  return sin(x);
`,yV=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${uu}
  return result;
`,bV=qe({opSnippet:gV,packedOpSnippet:yV}),xV={kernelName:Nl,backendName:"webgl",kernelFunc:bV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wV=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,vV=qe({opSnippet:wV}),kV={kernelName:Tl,backendName:"webgl",kernelFunc:vV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SV=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,IV=qe({opSnippet:SV}),CV={kernelName:_l,backendName:"webgl",kernelFunc:IV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NV=n=>{const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{blockShape:i,paddings:o}=s;V(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((y,b)=>y*b),u=[[0,0]];u.push(...o);for(let y=1+i.length;y<r.shape.length;++y)u.push([0,0]);const l=[],c=Ek({inputs:{x:r},backend:e,attrs:{paddings:u,constantValue:0}}),h=od(c.shape,i,a,!1),d=ad(h.length,i.length,!1),f=ud(c.shape,i,a,!1),p=Qt({inputs:{x:c},backend:e,attrs:{shape:h}}),m=Ls({inputs:{x:p},backend:e,attrs:{perm:d}}),g=Qt({inputs:{x:m},backend:e,attrs:{shape:f}});return l.push(c),l.push(p),l.push(m),l.forEach(y=>e.disposeIntermediateTensorInfo(y)),g},TV={kernelName:Oh,backendName:"webgl",kernelFunc:NV};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $V(n){const{inputs:t,backend:e}=n,{indices:s,values:r,denseShape:i,defaultValue:o}=t;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${i.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=e.readSync(s.dataId),u=e.readSync(r.dataId),l=e.readSync(i.dataId),c=e.readSync(o.dataId)[0],[h,d,f,p,m]=d8(a,s.shape,s.dtype,u,r.dtype,l,c);return[e.makeTensorInfo(d,s.dtype,h),e.makeTensorInfo([d[0]],r.dtype,f),e.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(g=>Number(g)))),e.makeTensorInfo([m.length],s.dtype,new Int32Array(m))]}const EV={kernelName:Ap,backendName:"webgl",kernelFunc:$V};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _V(n){const{inputs:t,backend:e}=n,{inputIndices:s,inputShape:r,newShape:i}=t;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(e.readSync(r.dataId)),a=e.readSync(s.dataId),u=Array.from(e.readSync(i.dataId)),[l,c,h]=f8(a,s.shape,s.dtype,o,u);return[e.makeTensorInfo(c,s.dtype,l),e.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}const AV={kernelName:Rp,backendName:"webgl",kernelFunc:_V};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RV(n){const{inputs:t,backend:e}=n,{data:s,indices:r,segmentIds:i}=t;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${i.shape}`);const o=e.readSync(s.dataId),a=e.readSync(r.dataId),u=e.readSync(i.dataId),[l,c]=tk(o,s.shape,s.dtype,a,u,!0);return e.makeTensorInfo(c,s.dtype,l)}const DV={kernelName:Dp,backendName:"webgl",kernelFunc:RV};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OV(n){const{inputs:t,backend:e}=n,{data:s,indices:r,segmentIds:i}=t;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${i.shape}`);const o=e.readSync(s.dataId),a=e.readSync(r.dataId),u=e.readSync(i.dataId),[l,c]=tk(o,s.shape,s.dtype,a,u);return e.makeTensorInfo(c,s.dtype,l)}const FV={kernelName:Op,backendName:"webgl",kernelFunc:OV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LV(n){const{inputs:t,backend:e,attrs:s}=n,{sparseIndices:r,sparseValues:i,defaultValue:o}=t,{outputShape:a}=s,{sliceRank:u,numUpdates:l,sliceSize:c,strides:h,outputSize:d}=ra(i,r,a),f=!1;if(i.dtype==="string"){const y=e.bufferSync(r),b=e.bufferSync(i),w=no(e.readSync(o.dataId)[0]),v=l8(y,b,a,d,c,l,u,h,w,f);return e.makeTensorInfo(a,v.dtype,v.values)}const p=new ay(l,u,r.shape.length,i.shape.length,h,[d,1],f),m=e.runWebGLProgram(p,[i,r,o],i.dtype),g=Qt({inputs:{x:m},backend:e,attrs:{shape:a}});return e.disposeIntermediateTensorInfo(m),g}const PV={kernelName:Fp,backendName:"webgl",kernelFunc:LV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MV(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{numOrSizeSplits:i,axis:o}=s,a=Pe(o,r.shape)[0],u=j2(r,i,a),l=r.shape.length,c=new Array(l).fill(0),h=r.shape.slice();return u.map(d=>{const f=[...h];f[a]=d;const p=Jl({inputs:{x:r},backend:e,attrs:{begin:c,size:f}});return c[a]+=d,p})}const zV={kernelName:Fh,backendName:"webgl",kernelFunc:MV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lb="return sqrt(x);",BV=qe({opSnippet:Lb,packedOpSnippet:Lb,cpuKernelImpl:p8}),VV={kernelName:Al,backendName:"webgl",kernelFunc:BV};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UV="return x * x;",WV=qe({opSnippet:UV}),GV={kernelName:Lp,backendName:"webgl",kernelFunc:WV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pb="return (a - b) * (a - b);",jV=ps({opSnippet:Pb,packedOpSnippet:Pb}),HV={kernelName:Rl,backendName:"webgl",kernelFunc:jV};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KV(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t;if(r.dtype!=="string")throw new Error("Input must be of datatype string");const i=e.readSync(r.dataId),o=uo(i),a=m8(o,"string",s);return e.makeTensorInfo(r.shape,"string",a)}const qV={kernelName:Ph,backendName:"webgl",kernelFunc:KV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XV({inputs:n,attrs:t,backend:e}){const{x:s}=n,r=Hr+`
    return x > 0.0 ? 1.0 : float(${t.alpha});
  `,i=new Ei(s.shape,r);return e.runWebGLProgram(i,[s],s.dtype)}const YV={kernelName:Pl,backendName:"webgl",kernelFunc:XV};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ZV{constructor(t,e,s){this.variableNames=["x"],this.outputShape=s;const r=s.length,i=un(s.length),o=un(s.length);let a="";if(r===1)a="coords * strides + begin";else{let u=0;a=s.map((l,c)=>(u++,s.length===1?`coords * strides[${c}] + begin[${c}]`:`coords[${u-1}] * strides[${c}] + begin[${c}]`)).join(",")}this.userCode=`
      ${i} begin = ${i}(${t});
      ${i} strides = ${i}(${e});

      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JV(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{begin:i,end:o,strides:a,beginMask:u,endMask:l,ellipsisMask:c,newAxisMask:h,shrinkAxisMask:d}=s,{finalShapeSparse:f,finalShape:p,isIdentity:m,sliceDim0:g,isSimpleSlice:y,begin:b,end:w,strides:v}=N2(r.shape,i,o,a,u,l,c,h,d);let S;if(m)S=Qt({inputs:{x:r},backend:e,attrs:{shape:p}});else if(g||y){V(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const R=S2(b,w,v),L=Jl({inputs:{x:r},backend:e,attrs:{begin:b,size:R}});S=Qt({inputs:{x:L},backend:e,attrs:{shape:p}}),e.disposeIntermediateTensorInfo(L)}else if(e.shouldExecuteOnCPU([r])){const L=e.readSync(r.dataId),F=Fe(r.shape,r.dtype,L),B=g8(f,F,v,b);S=e.makeTensorInfo(p,r.dtype,B.values)}else{const L=new ZV(b,v,f);S=e.runWebGLProgram(L,[r],r.dtype)}const N=Qt({inputs:{x:S},backend:e,attrs:{shape:p}});return e.disposeIntermediateTensorInfo(S),N}const QV={kernelName:Pp,backendName:"webgl",kernelFunc:JV};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tU(n){const{inputs:t,backend:e,attrs:s}=n,{separator:r,nGramWidths:i,leftPad:o,rightPad:a,padWidth:u,preserveShortSequences:l}=s,{data:c,dataSplits:h}=t,d=e.readSync(c.dataId),f=e.readSync(h.dataId),[p,m]=y8(d,f,r,i,o,a,u,l);return[e.makeTensorInfo([p.length],"string",p),e.makeTensorInfo(h.shape,"int32",m)]}const eU={kernelName:Mp,backendName:"webgl",kernelFunc:tU};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nU(n){const{inputs:t,backend:e,attrs:s}=n,{skipEmpty:r}=s,{input:i,delimiter:o}=t;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=e.readSync(i.dataId),u=e.readSync(o.dataId)[0],[l,c,h]=b8(a,u,r),d=c.length;return[e.makeTensorInfo([d,2],"int32",l),e.makeTensorInfo([d],"string",c),e.makeTensorInfo([2],"int32",new Int32Array(h))]}const sU={kernelName:zp,backendName:"webgl",kernelFunc:nU};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rU(n){const{inputs:t,backend:e,attrs:s}=n,{numBuckets:r}=s,{input:i}=t;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=e.readSync(i.dataId),a=x8(o,r);return e.makeTensorInfo(i.shape,"int32",a)}const iU={kernelName:Bp,backendName:"webgl",kernelFunc:rU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oU="return tan(x);",aU=qe({opSnippet:oU}),uU={kernelName:Ol,backendName:"webgl",kernelFunc:aU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lU=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,cU=qe({opSnippet:lU}),hU={kernelName:Fl,backendName:"webgl",kernelFunc:cU};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dU(n){const{inputs:t,backend:e,attrs:s}=n,{tensor:r,indices:i,updates:o}=t,{sliceRank:a,numUpdates:u,sliceSize:l,strides:c,outputSize:h}=ra(o,i,r.shape),d=[h/l,l];if(h===0)return e.makeTensorInfo(r.shape,i.dtype);const f=Qt({inputs:{x:i},backend:e,attrs:{shape:[u,a]}}),p=Qt({inputs:{x:o},backend:e,attrs:{shape:[u,l]}}),m=Qt({inputs:{x:r},backend:e,attrs:{shape:d}}),g=new ay(u,a,f.shape.length,p.shape.length,c,d,!1,!0),y=e.runWebGLProgram(g,[p,f,m],m.dtype),b=Qt({inputs:{x:y},backend:e,attrs:{shape:r.shape}});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(y),b}const fU={kernelName:Ep,backendName:"webgl",kernelFunc:dU};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pU{constructor(t,e){this.variableNames=["A"];const s=new Array(t.length);for(let o=0;o<s.length;o++)s[o]=t[o]*e[o];this.outputShape=s,this.rank=s.length;const r=un(this.rank),i=mU(t);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${i}));
      }
    `}}function mU(n){const t=n.length;if(t>5)throw Error(`Tile for rank ${t} is not yet supported`);if(t===1)return`imod(resRC, ${n[0]})`;const e=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let r=0;r<n.length;r++)s.push(`imod(${e[r]}, ${n[r]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ak(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{reps:i}=s;if(r.dtype==="string"||r.shape.length>5){const u=e.readSync(r.dataId),l=r.dtype==="string"?u.map(d=>no(d)):u,c=Fe(r.shape,r.dtype,l),h=v8(c,i);return e.makeTensorInfo(h.shape,h.dtype,h.values)}const o=new pU(r.shape,i);return e.runWebGLProgram(o,[r],r.dtype)}const gU={kernelName:Ll,backendName:"webgl",kernelFunc:Ak};class yU{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=t,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class bU{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=t,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ya(n,t){t!==null&&n.disposeIntermediateTensorInfo(t)}function Mb(n){let t=1;for(;t<n;)t*=2;return t}function xU(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{k:i,sorted:o}=s,a=vt().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=vt().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),l=r.shape,c=l[l.length-1];if(e.shouldExecuteOnCPU([r])||c<a||i>u){const B=e.readSync(r.dataId),[H,z]=k8(B,l,r.dtype,i,o);return[e.makeTensorInfo(H.shape,H.dtype,H.values),e.makeTensorInfo(z.shape,z.dtype,z.values)]}if(i===0)return l[l.length-1]=0,[e.makeTensorInfo(l,r.dtype,[]),e.makeTensorInfo(l,"int32",[])];if(c===1)return[r,fd({attrs:{shape:l,dtype:"int32",value:0},backend:e})];const h=e.texData.get(r.dataId),d=h!==null&&h.isPacked,f=d?e.unpackTensor(r):r,m=Et(l)/c,g=Qt({inputs:{x:f},attrs:{shape:[m,c]},backend:e});d&&ya(e,f);const y=Mb(i),b=Mb(c);let w=null;const v=()=>w===null?[g,g]:[g,w],S=(B,H,z)=>{const G=v(),T=new yU(z),ht=[[c],[w===null?1:0],[Number.NEGATIVE_INFINITY],[B],[H]],rt=w;w=e.runWebGLProgram(T,G,"int32",ht),ya(e,rt)};for(let B=1;B<y;B*=2){const H=B*2;for(let z=B;z>=1;z/=2)S(H,z,[m,b])}for(let B=b;B>y;B/=2){const H=v(),z=new bU([m,B/2]),T=[[c],[w===null?1:0],[y]],K=w;w=e.runWebGLProgram(z,H,"int32",T),ya(e,K);const ht=y/2,rt=ht*2;for(let gt=ht;gt>=1;gt/=2)S(rt,gt,w.shape)}let N=w;w=Jl({inputs:{x:w},backend:e,attrs:{begin:0,size:[m,i]}}),ya(e,N);let R=Sk({inputs:{x:g,indices:w},backend:e,attrs:{axis:1,batchDims:1}});ya(e,g);const L=l.slice(0,-1);L.push(i),N=w,w=Qt({inputs:{x:w},attrs:{shape:L},backend:e}),ya(e,N);const F=R;return R=Qt({inputs:{x:R},attrs:{shape:L},backend:e}),ya(e,F),[R,w]}const wU={kernelName:Vp,backendName:"webgl",kernelFunc:xU};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vU{constructor(t,e,s,r,i,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const a=s==="nearest"?1:2;let u;switch(r){case"constant":u=1;break;case"reflect":u=2;break;case"wrap":u=3;break;case"nearest":u=4;break;default:u=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${u} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${u} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${u} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${t} && 0 <= coordX && coordX < ${e}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${i});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${i});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${e}));
                float mapY = mapCoord(inY, float(${t}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kU(n){const{inputs:t,backend:e,attrs:s}=n,{image:r,transforms:i}=t,{interpolation:o,fillMode:a,fillValue:u,outputShape:l}=s,[c,h,d,f]=r.shape,[p,m]=l??[h,d],g=[c,p,m,f],y=new vU(h,d,o,a,u,g);return e.runWebGLProgram(y,[r,i],"float32")}const SU={kernelName:Up,backendName:"webgl",kernelFunc:kU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IU(n){const{inputs:t,attrs:e,backend:s}=n,{axis:r}=e,{x:i}=t;cd(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=s.readSync(i.dataId),{outputValues:a,outputShape:u,indices:l}=S8(o,r,i.shape,i.dtype);return[s.makeTensorInfo(u,i.dtype,a),s.makeTensorInfo([l.length],"int32",l)]}const CU={kernelName:Wp,backendName:"webgl",kernelFunc:IU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NU(n){const{inputs:t,backend:e,attrs:s}=n,{value:r}=t;let{axis:i}=s;i<0&&(i+=r.shape.length);const o=r,a=o.shape.length,u=r.shape[i],l=new Array(a-1);let c=0;for(let m=0;m<a;m++)m!==i&&(l[c++]=o.shape[m]);const h=[],d=new Array(a).fill(0),f=o.shape.slice();f[i]=1;const p=new Array(u);for(let m=0;m<p.length;m++){d[i]=m;const g=Jl({inputs:{x:o},backend:e,attrs:{begin:d,size:f}}),y=Qt({inputs:{x:g},backend:e,attrs:{shape:l}});p[m]=y,h.push(g)}return h.forEach(m=>e.disposeIntermediateTensorInfo(m)),p}const TU={kernelName:Mh,backendName:"webgl",kernelFunc:NU};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $U{constructor(t,e){this.variableNames=["x","segmentIds"];const s=t.windowSize,r=t.batchSize,i=t.inSize,o=t.numSegments,a=o*Math.ceil(i/s);this.outputShape=[r,a];const u="0.0",l="sumValue",c=Math.floor(s/4)*4,h=s%4,d=`
        sumValue += dot(values, segFilter);
    `;let f="";i%s>0&&(f=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `);let p="";i%s>0&&(p=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${u};

      float getValue(int batch, int inIdx) {
        ${f}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${p}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${o})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${o})));

        float sumValue = 0.0;

        for (int i = 0; i < ${c}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${d}
        }

        int inIdx = inOffset + ${c};
        if (${h===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${d}
        } else if (${h===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${d}
        } else if (${h===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${d}
        }
        setOutput(${l});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EU(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,segmentIds:i}=t,{numSegments:o}=s,a=r.shape.length,u=[];let l=0;const c=Tn([l],a);let h=r;c!=null&&(h=Ls({inputs:{x:r},backend:e,attrs:{perm:c}}),u.push(h),l=Rn(1,a)[0]);const d=Wv(h.shape,l,o),f=Et([h.shape[l]]),p=Qt({inputs:{x:h},backend:e,attrs:{shape:[-1,f]}});u.push(p);const m=Hp(r.dtype),g=(v,S,N,R,L)=>{const F=v.shape[0],B=v.shape[1],H=Uv(B,L),z={windowSize:H,inSize:B,batchSize:F,numSegments:L},G=new $U(z,S),T=e.compileAndRun(G,[v,N],R);if(u.push(T),T.shape[1]===L)return T;const K=_k({backend:e,attrs:{start:0,stop:L,step:1,dtype:"float32"}}),ht=Ak({inputs:{x:K},backend:e,attrs:{reps:[B/H]}});return u.push(K),u.push(ht),g(T,S,ht,R,L)},y=g(p,"unsortedSegmentSum",i,m,o),b=Qt({inputs:{x:y},backend:e,attrs:{shape:d}});let w=b;if(c!=null){u.push(b);const v=ea(c);w=Ls({inputs:{x:w},backend:e,attrs:{perm:v}})}return u.forEach(v=>e.disposeIntermediateTensorInfo(v)),w}const _U={kernelName:zh,backendName:"webgl",kernelFunc:EU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AU=[p7,g7,x7,k7,I7,T7,E7,A7,F7,P7,B7,W7,H7,Y7,Q7,eL,sL,aL,lL,hL,mL,kL,IL,$L,_L,LL,ML,UL,Z8,jL,YL,t9,o9,l9,h9,f9,m9,x9,k9,C9,T9,E9,A9,O9,L9,B9,U9,j9,q9,Y9,tP,rP,uP,hP,pP,mP,yP,xP,vP,SP,CP,EP,RP,FP,PP,BP,WP,KP,ZP,Y8,QP,qL,nM,iM,uM,Q8,dM,gM,bM,kM,CM,EM,RM,LM,BM,WM,jM,XM,ZM,QM,sz,iz,az,lz,hz,mz,xz,Sz,Az,n7,Fz,Mz,Vz,Gz,RL,Kz,Xz,Zz,tB,rB,e7,oB,uB,cB,dB,fB,DL,Tz,gB,wB,IB,r7,$B,AB,FB,MB,UB,GB,KB,YB,QB,nV,iV,uV,dV,mV,xV,kV,wL,Ez,CV,TV,EV,AV,DV,FV,PV,zV,VV,GV,HV,qV,YV,QV,eU,sU,iU,$z,h7,uU,hU,fU,gU,wU,SU,d7,CU,TU,_U,qz];for(const n of AU)jp(n);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RU=vt();RU.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var Pr;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(Pr||(Pr={}));var zb;(function(n){(function(t){t[t.LEGACY=0]="LEGACY",t[t.V1=1]="V1",t[t.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(zb||(zb={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DU={};function Rk(n){return DU[n]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _(n,t,e,s,r){const i=t.inputParams[n];if(i&&i.inputIndexStart!==void 0){const a=i.inputIndexStart,u=i.inputIndexEnd===0?void 0:i.inputIndexEnd===void 0?a+1:i.inputIndexEnd;if(i.type==="tensor")return Ds(t.inputNames[i.inputIndexStart],e,s,r);if(i.type==="tensors")return t.inputNames.slice(a,u).map(d=>Ds(d,e,s,r));const l=Ds(t.inputNames.slice(a)[0],e,s,r),c=l.dataSync();return i.type==="number"?c[0]:Ir(l.shape,c)}const o=t.attrParams[n];return o&&o.value}function Ds(n,t,e,s){const[r,i]=sr(n);if(s!=null){const a=s.getHashTableHandleByName(r);if(a!=null)return a}const o=e.currentContextIds.find(a=>!!t[xf(r,a)]);return o!==void 0?t[xf(r,o)][i]:void 0}function OU(n,t,e){return t[xf(n,e.currentContextId)]}function Si(n,t){const[e,s,r]=sr(n);return[xf(e,t&&t.currentContextId),s,r]}function xf(n,t){return t?`${n}-${t}`:n}function sr(n){const t=n.split(":");if(t.length===1)return[n,0,void 0];const e=t[0],s=t.length===3?t[1]:void 0,r=Number(t[t.length-1]);return[e,r,s]}function tf(n,t,e){let s=_("pad",n,t,e);if(s==="explicit"){s=_("explicitPaddings",n,t,e);const r=[[0,0],[0,0],[0,0],[0,0]];for(let i=0;i<4;i++)r[i][0]=s[i*2],r[i][1]=s[i*2+1];return r}return s}function qi(n){return n.kept?n:Ri(n)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FU=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],LU=Object.freeze(Object.defineProperty({__proto__:null,json:FU},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PU=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],MU=Object.freeze(Object.defineProperty({__proto__:null,json:PU},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zU=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],BU=Object.freeze(Object.defineProperty({__proto__:null,json:zU},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VU=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],UU=Object.freeze(Object.defineProperty({__proto__:null,json:VU},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WU=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],GU=Object.freeze(Object.defineProperty({__proto__:null,json:WU},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jU=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],HU=Object.freeze(Object.defineProperty({__proto__:null,json:jU},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KU=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],qU=Object.freeze(Object.defineProperty({__proto__:null,json:KU},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XU=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],YU=Object.freeze(Object.defineProperty({__proto__:null,json:XU},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZU=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]}],JU=Object.freeze(Object.defineProperty({__proto__:null,json:ZU},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QU=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],tW=Object.freeze(Object.defineProperty({__proto__:null,json:QU},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eW=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],nW=Object.freeze(Object.defineProperty({__proto__:null,json:eW},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sW=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]}],rW=Object.freeze(Object.defineProperty({__proto__:null,json:sW},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iW=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}],oW=Object.freeze(Object.defineProperty({__proto__:null,json:iW},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aW=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],uW=Object.freeze(Object.defineProperty({__proto__:null,json:aW},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lW=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}],cW=Object.freeze(Object.defineProperty({__proto__:null,json:lW},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hW=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],dW=Object.freeze(Object.defineProperty({__proto__:null,json:hW},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fW=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],pW=Object.freeze(Object.defineProperty({__proto__:null,json:fW},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mW=[{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],gW=Object.freeze(Object.defineProperty({__proto__:null,json:mW},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yW=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],bW=Object.freeze(Object.defineProperty({__proto__:null,json:yW},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Bb{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const t=[LU,MU,BU,UU,GU,HU,qU,YU,JU,tW,nW,rW,oW,uW,cW,dW,pW,gW,bW],e=[].concat(...t.map(s=>s.json));this.opMappers=e.reduce((s,r)=>(s[r.tfOpName]=r,s),{})}transformGraph(t,e={}){const s=t.node,r=[],i=[],o=[],a=s.reduce((m,g)=>(m[g.name]=this.mapNode(g),g.op.startsWith("Placeholder")?r.push(m[g.name]):g.op==="Const"?i.push(m[g.name]):(g.input==null||g.input.length===0)&&o.push(m[g.name]),m),{});let u=[];const l=[];let c={},h={};e!=null&&(c=this.mapSignatureEntries(e.inputs),h=this.mapSignatureEntries(e.outputs));const d=Object.keys(a);d.forEach(m=>{const g=a[m];g.inputNames.forEach((y,b)=>{const[w,,v]=Si(y),S=a[w];if(S.outputs!=null){const N=S.outputs.indexOf(v);if(N!==-1){const R=`${w}:${N}`;g.inputNames[b]=R}}g.inputs.push(S),S.children.push(g)})}),Object.keys(h).length===0?d.forEach(m=>{const g=a[m];g.children.length===0&&l.push(g)}):Object.keys(h).forEach(m=>{const[g]=Si(m),y=a[g];y!=null&&(y.signatureKey=h[m],l.push(y))}),Object.keys(c).length>0?Object.keys(c).forEach(m=>{const[g]=Si(m),y=a[g];y&&(y.signatureKey=c[m],u.push(y))}):u=r;let f={};t.library!=null&&t.library.function!=null&&(f=t.library.function.reduce((m,g)=>(m[g.signature.name]=this.mapFunction(g),m),{}));const p={nodes:a,inputs:u,outputs:l,weights:i,placeholders:r,signature:e,functions:f};return o.length>0&&(p.initNodes=o),p}mapSignatureEntries(t){return Object.keys(t||{}).reduce((e,s)=>(e[t[s].name]=s,e),{})}mapNode(t){const e=Rk(t.op)||this.opMappers[t.op]||{};t.attr==null&&(t.attr={});const s={name:t.name,op:t.op,category:e.category,inputNames:(t.input||[]).map(r=>r.startsWith("^")?r.slice(1):r),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:t.attr,outputs:e.outputs};return e.inputs!=null&&(s.inputParams=e.inputs.reduce((r,i)=>(r[i.name]={type:i.type,inputIndexStart:i.start,inputIndexEnd:i.end},r),{})),e.attrs!=null&&(s.attrParams=e.attrs.reduce((r,i)=>{const o=i.type;let a;switch(i.type){case"string":a=d1(t.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=d1(t.attr,i.tfDeprecatedName,i.defaultValue));break;case"string[]":a=x1(t.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=x1(t.attr,i.tfDeprecatedName,i.defaultValue));break;case"number":a=p1(t.attr,i.tfName,i.defaultValue||0),a===void 0&&i.tfDeprecatedName&&(a=p1(t.attr,i.tfDeprecatedName,i.defaultValue));break;case"number[]":a=b1(t.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=b1(t.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool":a=f1(t.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=f1(t.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool[]":a=v1(t.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=v1(t.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape":a=y1(t.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=y1(t.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape[]":a=w1(t.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=w1(t.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype":a=m1(t.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=m1(t.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype[]":a=g1(t.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=g1(t.attr,i.tfDeprecatedName,i.defaultValue));break;case"func":a=Vb(t.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=Vb(t.attr,i.tfDeprecatedName,i.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${i.type} for op: ${t.op}`)}return r[i.name]={value:a,type:o},r},{})),s}mapFunction(t){const e=t.nodeDef,s=[],r=[];let i={};e!=null&&(i=e.reduce((h,d)=>(h[d.name]=this.mapNode(d),d.op==="Const"&&r.push(h[d.name]),h),{}));const o=[],a=[];t.signature.inputArg.forEach(h=>{const[d]=Si(h.name),f={name:d,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:uy(h.type),type:"dtype"}},children:[]};f.signatureKey=h.name,o.push(f),i[d]=f}),Object.keys(i).forEach(h=>{const d=i[h];d.inputNames.forEach((f,p)=>{const[m,,g]=Si(f),y=i[m];if(y.outputs!=null){const b=y.outputs.indexOf(g);if(b!==-1){const w=`${m}:${b}`;d.inputNames[p]=w}}d.inputs.push(y),y.children.push(d)})});const l=t.ret;t.signature.outputArg.forEach(h=>{const[d,f]=Si(l[h.name]),p=i[d];p!=null&&(p.defaultOutput=f,a.push(p))});const c=this.mapArgsToSignature(t);return{nodes:i,inputs:o,outputs:a,weights:r,placeholders:s,signature:c}}mapArgsToSignature(t){return{methodName:t.signature.name,inputs:t.signature.inputArg.reduce((e,s)=>(e[s.name]=this.mapArgToTensorInfo(s),e),{}),outputs:t.signature.outputArg.reduce((e,s)=>(e[s.name]=this.mapArgToTensorInfo(s,t.ret),e),{})}}mapArgToTensorInfo(t,e){let s=t.name;return e!=null&&(s=e[s]),{name:s,dtype:t.type}}}function xW(n){if(vt().global,typeof globalThis.atob<"u")return globalThis.atob(n);if(typeof Buffer<"u")return new Buffer(n,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function Dk(n,t){const e=Array.isArray(n)?String.fromCharCode.apply(null,n):xW(n);return t?e:e.toLowerCase()}function d1(n,t,e,s=!1){const r=n[t];return r!=null?Dk(r.s,s):e}function f1(n,t,e){const s=n[t];return s?s.b:e}function p1(n,t,e){const s=n[t]||{},r=s.i!=null?s.i:s.f!=null?s.f:e;return typeof r=="number"?r:parseInt(r,10)}function uy(n){switch(typeof n=="string"&&(n=Pr[n]),n){case Pr.DT_FLOAT:case Pr.DT_HALF:return"float32";case Pr.DT_INT32:case Pr.DT_INT64:case Pr.DT_INT8:case Pr.DT_UINT8:return"int32";case Pr.DT_BOOL:return"bool";case Pr.DT_DOUBLE:return"float32";case Pr.DT_STRING:return"string";default:return null}}function Vb(n,t,e){const s=n[t];return s&&s.func?s.func.name:e}function m1(n,t,e){const s=n[t];return s&&s.type?uy(s.type):e}function g1(n,t,e){const s=n[t];return s&&s.list&&s.list.type?s.list.type.map(r=>uy(r)):e}function Ok(n){if(!n.unknownRank)return n.dim!=null?n.dim.map(t=>typeof t.size=="number"?t.size:parseInt(t.size,10)):[]}function y1(n,t,e){const s=n[t];return s&&s.shape?Ok(s.shape):e}function b1(n,t,e){const s=n[t];return s?((s.list.f&&s.list.f.length?s.list.f:s.list.i)||[]).map(r=>typeof r=="number"?r:parseInt(r,10)):e}function x1(n,t,e,s=!1){const r=n[t];return r&&r.list&&r.list.s?r.list.s.map(i=>Dk(i,s)):e}function w1(n,t,e){const s=n[t];return s&&s.list&&s.list.shape?s.list.shape.map(r=>Ok(r)):e}function v1(n,t,e){const s=n[t];return s&&s.list&&s.list.b?s.list.b:e}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wW{constructor(t,e,s){this.node=t,this.tensorMap=e,this.context=s,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map(r=>this.getInput(r)),t.rawAttrs!=null&&(this.attrs=Object.keys(t.rawAttrs).reduce((r,i)=>(r[i]=this.getAttr(i),r),{}))}getInput(t){return Ds(t,this.tensorMap,this.context)}getAttr(t,e){const s=this.node.rawAttrs[t];if(s.tensor!=null)return Ds(t,this.tensorMap,this.context);if(s.i!=null||s.f!=null)return p1(this.node.rawAttrs,t,e);if(s.s!=null)return d1(this.node.rawAttrs,t,e);if(s.b!=null)return f1(this.node.rawAttrs,t,e);if(s.shape!=null)return y1(this.node.rawAttrs,t,e);if(s.type!=null)return m1(this.node.rawAttrs,t,e);if(s.list!=null){if(s.list.i!=null||s.list.f!=null)return b1(this.node.rawAttrs,t,e);if(s.list.s!=null)return x1(this.node.rawAttrs,t,e);if(s.list.shape!=null)return w1(this.node.rawAttrs,t,e);if(s.list.b!=null)return v1(this.node.rawAttrs,t,e);if(s.list.type!=null)return g1(this.node.rawAttrs,t,e)}return e}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Is=Object.freeze(Object.defineProperty({__proto__:null,OP_SCOPE_SUFFIX:Y1,abs:Pn,acos:n0,acosh:s0,add:Lt,addN:Jx,all:qp,any:Cc,argMax:Wo,argMin:r0,asin:i0,asinh:o0,atan:a0,atan2:u0,atanh:l0,avgPool:Gh,avgPool3d:h0,basicLSTMCell:Qx,batchNorm:Ml,batchNorm2d:d0,batchNorm3d:f0,batchNorm4d:p0,batchToSpaceND:jh,bincount:m0,bitwiseAnd:tw,booleanMaskAsync:zw,broadcastArgs:ew,broadcastTo:Aa,buffer:Fe,cast:Kt,ceil:g0,clipByValue:Os,clone:Ri,complex:so,concat:Cn,concat1d:y0,concat2d:b0,concat3d:x0,concat4d:w0,conv1d:Xp,conv2d:ro,conv2dTranspose:Yp,conv3d:k0,conv3dTranspose:S0,cos:Hh,cosh:Zp,cosineWindow:km,cumprod:$c,cumsum:Jp,denseBincount:df,depthToSpace:I0,depthwiseConv2d:zl,diag:sw,dilation2d:C0,div:ie,divNoNan:N0,dot:T0,dropout:u2,einsum:rw,elu:Bl,enclosingPowerOfTwo:l2,ensureShape:iw,equal:ar,erf:$0,euclideanNorm:_0,exp:Fs,expandDims:gn,expm1:A0,eye:Qp,fft:rd,fill:Qa,floor:Ul,floorDiv:Kp,fused:qw,gather:Wl,gatherND:Ww,greater:Ms,greaterEqual:go,ifft:Lu,imag:Kh,image:Bn,inTopKAsync:Gw,irfft:gm,isFinite:R0,isInf:D0,isNaN:O0,leakyRelu:qh,less:Du,lessEqual:na,linalg:d2,linspace:uw,localResponseNormalization:F0,log:ur,log1p:Xh,logSigmoid:L0,logSoftmax:em,logSumExp:nm,logicalAnd:ai,logicalNot:Yh,logicalOr:sm,logicalXor:P0,losses:ev,lowerBound:cw,matMul:De,max:Nr,maxPool:Zh,maxPool3d:M0,maxPoolWithArgmax:hw,maximum:Vi,mean:wn,meshgrid:dw,min:Ru,minimum:jo,mirrorPad:im,mod:z0,moments:Jh,movingAverage:Bw,mul:ut,multiRNNCell:fw,multinomial:pw,neg:dn,norm:Vl,notEqual:Ba,oneHot:Va,ones:or,onesLike:lr,op:ot,outerProduct:mw,pad:Ui,pad1d:gw,pad2d:yw,pad3d:B0,pad4d:bw,pool:V0,pow:io,prelu:td,print:Q1,prod:U0,raggedGather:xw,raggedRange:ww,raggedTensorToTensor:vw,rand:kw,randomGamma:Nw,randomNormal:am,randomStandardNormal:Tw,randomUniform:sa,randomUniformInt:$w,range:oo,real:Ou,reciprocal:J0,relu:fi,relu6:um,reshape:ct,reverse:Tr,reverse1d:Ew,reverse2d:_w,reverse3d:Aw,reverse4d:Rw,rfft:id,round:lm,rsqrt:cm,scalar:fe,scatterND:Vw,searchSorted:rm,selu:hm,separableConv2d:dm,setdiff1dAsync:Dw,sigmoid:Hs,sign:Q0,signal:tv,sin:fm,sinh:pm,slice:xe,slice1d:ed,slice2d:mm,slice3d:nd,slice4d:Fu,softmax:sd,softplus:tu,spaceToBatchND:Qh,sparse:nv,sparseToDense:Uw,spectral:Qw,split:Ks,sqrt:cs,square:an,squaredDifference:ym,squeeze:tn,stack:cr,step:nu,stridedSlice:t2,string:sv,sub:oe,sum:he,tan:e2,tanh:Ma,tensor:Cr,tensor1d:zn,tensor2d:Di,tensor3d:n2,tensor4d:Ow,tensor5d:Fw,tensor6d:Lw,tensorScatterUpdate:Pw,tile:kr,topk:r2,transpose:Ue,truncatedNormal:xm,unique:i2,unsortedSegmentSum:wm,unstack:$r,upperBound:Mw,variable:o2,where:us,whereAsync:a2,zeros:Mn,zerosLike:je},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vW=(n,t,e,s=Is)=>{switch(n.op){case"BiasAdd":case"AddV2":case"Add":return[s.add(_("a",n,t,e),_("b",n,t,e))];case"AddN":return[s.addN(_("tensors",n,t,e))];case"FloorMod":case"Mod":return[s.mod(_("a",n,t,e),_("b",n,t,e))];case"Mul":return[s.mul(_("a",n,t,e),_("b",n,t,e))];case"RealDiv":case"Div":return[s.div(_("a",n,t,e),_("b",n,t,e))];case"DivNoNan":return[s.divNoNan(_("a",n,t,e),_("b",n,t,e))];case"FloorDiv":return[s.floorDiv(_("a",n,t,e),_("b",n,t,e))];case"Sub":return[s.sub(_("a",n,t,e),_("b",n,t,e))];case"Minimum":return[s.minimum(_("a",n,t,e),_("b",n,t,e))];case"Maximum":return[s.maximum(_("a",n,t,e),_("b",n,t,e))];case"Pow":return[s.pow(_("a",n,t,e),_("b",n,t,e))];case"SquaredDifference":return[s.squaredDifference(_("a",n,t,e),_("b",n,t,e))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kW=(n,t,e,s=Is)=>{switch(n.op){case"Abs":case"ComplexAbs":return[s.abs(_("x",n,t,e))];case"Acos":return[s.acos(_("x",n,t,e))];case"Acosh":return[s.acosh(_("x",n,t,e))];case"Asin":return[s.asin(_("x",n,t,e))];case"Asinh":return[s.asinh(_("x",n,t,e))];case"Atan":return[s.atan(_("x",n,t,e))];case"Atan2":return[s.atan2(_("x",n,t,e),_("y",n,t,e))];case"Atanh":return[s.atanh(_("x",n,t,e))];case"Ceil":return[s.ceil(_("x",n,t,e))];case"Complex":return[s.complex(_("real",n,t,e),_("imag",n,t,e))];case"Cos":return[s.cos(_("x",n,t,e))];case"Cosh":return[s.cosh(_("x",n,t,e))];case"Elu":return[s.elu(_("x",n,t,e))];case"Erf":return[s.erf(_("x",n,t,e))];case"Exp":return[s.exp(_("x",n,t,e))];case"Expm1":return[s.expm1(_("x",n,t,e))];case"Floor":return[s.floor(_("x",n,t,e))];case"Log":return[s.log(_("x",n,t,e))];case"Log1p":return[s.log1p(_("x",n,t,e))];case"Imag":return[s.imag(_("x",n,t,e))];case"Neg":return[s.neg(_("x",n,t,e))];case"Reciprocal":return[s.reciprocal(_("x",n,t,e))];case"Real":return[s.real(_("x",n,t,e))];case"Relu":return[s.relu(_("x",n,t,e))];case"Round":return[s.round(_("x",n,t,e))];case"Selu":return[s.selu(_("x",n,t,e))];case"Sigmoid":return[s.sigmoid(_("x",n,t,e))];case"Sin":return[s.sin(_("x",n,t,e))];case"Sign":return[s.sign(_("x",n,t,e))];case"Sinh":return[s.sinh(_("x",n,t,e))];case"Softplus":return[s.softplus(_("x",n,t,e))];case"Sqrt":return[s.sqrt(_("x",n,t,e))];case"Square":return[s.square(_("x",n,t,e))];case"Tanh":return[s.tanh(_("x",n,t,e))];case"Tan":return[s.tan(_("x",n,t,e))];case"ClipByValue":return[s.clipByValue(_("x",n,t,e),_("clipValueMin",n,t,e),_("clipValueMax",n,t,e))];case"Relu6":return[s.relu6(_("x",n,t,e))];case"Rsqrt":return[s.rsqrt(Ds(n.inputNames[0],t,e))];case"Prod":return[s.prod(_("x",n,t,e),_("axes",n,t,e))];case"LeakyRelu":return[s.leakyRelu(_("x",n,t,e),_("alpha",n,t,e))];case"Prelu":return[s.prelu(_("x",n,t,e),_("alpha",n,t,e))];case"IsNan":return[s.isNaN(Ds(n.inputNames[0],t,e))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zr(n,t,e=""){if(!(typeof n=="number"||typeof t=="number")){V(n.length===t.length,()=>e+` Shapes ${n} and ${t} must match`);for(let s=0;s<n.length;s++){const r=n[s],i=t[s];V(r<0||i<0||r===i,()=>e+` Shapes ${n} and ${t} must match`)}}}function Ub(n){return!(typeof n=="number"||n.some(t=>t<0))}function sc(n,t,e){let s=k1(n,e);const r=!Ub(s);if(r&&t.length===0)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${s}`);if(r&&t.forEach(i=>{s=k1(i.shape,s)}),!Ub(s))throw new Error(`Non-fully-defined elementShape: ${s}`);return s}function k1(n,t){if(typeof n=="number")return t;if(typeof t=="number")return n;if(n.length!==t.length)throw new Error(`Incompatible ranks during merge: ${n} vs. ${t}`);const e=[];for(let s=0;s<n.length;++s){const r=n[s],i=t[s];if(r>=0&&i>=0&&r!==i)throw new Error(`Incompatible shape during merge: ${n} vs. ${t}`);e[s]=r>=0?r:i}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SW{constructor(t,e,s,r,i,o,a){this.name=t,this.dtype=e,this.maxSize=s,this.elementShape=r,this.identicalElementShapes=i,this.dynamicSize=o,this.clearAfterRead=a,this.tensors=[],this.closed_=!1,this.idTensor=fe(0),es(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(t){this.tensors.forEach(e=>{(t==null||!t.has(e.tensor.id))&&e.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||t>=this.size())throw new Error(`Tried to read from index ${t}, but array size is: ${this.size()}`);const e=this.tensors[t];if(e.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${t} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(e.cleared=!0),e.read=!0,e.tensor}readMany(t){return t.map(e=>this.read(e))}write(t,e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||!this.dynamicSize&&t>=this.maxSize)throw new Error(`Tried to write to index ${t}, but array is not resizeable and size is: ${this.maxSize}`);const s=this.tensors[t]||{};if(e.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t},
          because the value dtype is ${e.dtype}, but TensorArray dtype is ${this.dtype}.`);if(this.size()===0&&(this.elementShape==null||this.elementShape.length===0)&&(this.elementShape=e.shape),zr(this.elementShape,e.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${t}.`),s.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been read.`);if(s.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been written.`);s.tensor=e,es(e),s.written=!0,this.tensors[t]=s}writeMany(t,e){if(t.length!==e.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${t.length} is not the same as tensors size: ${e.length}.`);t.forEach((s,r)=>this.write(s,e[r]))}gather(t,e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${e}`);if(t)t=t.slice(0,this.size());else{t=[];for(let r=0;r<this.size();r++)t.push(r)}if(t.length===0)return Cr([],[0].concat(this.elementShape));const s=this.readMany(t);return zr(this.elementShape,s[0].shape,"TensorArray shape mismatch: "),cr(s,0)}concat(t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${t}`);if(this.size()===0)return Cr([],[0].concat(this.elementShape));const e=[];for(let r=0;r<this.size();r++)e.push(r);const s=this.readMany(e);return zr(this.elementShape,s[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${s[0].shape})`),Cn(s,0)}scatter(t,e){if(e.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${e.dtype}`);if(t.length!==e.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${t.length} vs. ${e.shape[0]}`);const s=Math.max(...t);if(!this.dynamicSize&&s>=this.maxSize)throw new Error(`Max index must be < array size (${s}  vs. ${this.maxSize})`);this.writeMany(t,$r(e,0))}split(t,e){if(e.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${e.dtype}`);let s=0;const r=t.map(u=>(s+=u,s));if(s!==e.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${s}, and tensor's shape is: ${e.shape}`);if(!this.dynamicSize&&t.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${t.length}), and the TensorArray is not marked as dynamically resizeable`);const i=s===0?0:e.size/s,o=[];pt(()=>{e=ct(e,[1,s,i]);for(let u=0;u<t.length;++u){const c=[0,u===0?0:r[u-1],0],h=[1,t[u],i];o[u]=ct(xe(e,c,h),this.elementShape)}return o});const a=[];for(let u=0;u<t.length;u++)a[u]=u;this.writeMany(a,o)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ha{constructor(t,e,s,r=-1){this.tensors=t,this.elementShape=e,this.elementDtype=s,t!=null&&t.forEach(i=>{if(s!==i.dtype)throw new Error(`Invalid data types; op elements ${s}, but list elements ${i.dtype}`);zr(e,i.shape,"TensorList shape mismatch: "),es(i)}),this.idTensor=fe(0),this.maxNumElements=r,es(this.idTensor)}get id(){return this.idTensor.id}copy(){return new Ha([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(t){this.tensors.forEach(e=>{(t==null||!t.has(e.id))&&e.dispose()}),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(t,e,s=-1){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);if(s!==-1&&this.tensors.length!==s)throw new Error(`Operation expected a list with ${s} elements but got a list with ${this.tensors.length} elements.`);zr(t,this.elementShape,"TensorList shape mismatch: ");const r=sc(this.elementShape,this.tensors,t);return pt(()=>{const i=this.tensors.map(o=>ct(o,r));return cr(i,0)})}popBack(t,e){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);if(this.size()===0)throw new Error("Trying to pop from an empty list.");const s=sc(this.elementShape,this.tensors,t),r=this.tensors.pop();return r.kept=!1,zr(r.shape,t,"TensorList shape mismatch: "),ct(r,s)}pushBack(t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(zr(t.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");es(t),this.tensors.push(t)}resize(t){if(t<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${t}`);if(this.maxNumElements!==-1&&t>this.maxNumElements)throw new Error(`TensorListResize input size ${t} is greater maxNumElement ${this.maxNumElements}.`);const e=new Ha([],this.elementShape,this.elementDtype,this.maxNumElements);e.tensors.length=t;for(let s=0;s<Math.min(this.tensors.length,t);++s)e.tensors[s]=this.tensors[s];return e}getItem(t,e,s){if(s!==this.elementDtype)throw new Error(`Invalid data types; op elements ${s}, but list elements ${this.elementDtype}`);if(t<0||t>this.tensors.length)throw new Error(`Trying to access element ${t} in a list with ${this.tensors.length} elements.`);if(this.tensors[t]==null)throw new Error(`element at index ${t} is null.`);zr(this.tensors[t].shape,e,"TensorList shape mismatch: ");const r=sc(this.elementShape,this.tensors,e);return ct(this.tensors[t],r)}setItem(t,e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(t<0||this.maxNumElements!==-1&&t>=this.maxNumElements)throw new Error(`Trying to set element ${t} in a list with max ${this.maxNumElements} elements.`);zr(this.elementShape,e.shape,"TensorList shape mismatch: "),es(e),this.tensors[t]!=null&&(this.tensors[t].kept=!1),this.tensors[t]=e}gather(t,e,s){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);zr(this.elementShape,s,"TensorList shape mismatch: "),t=t.slice(0,this.size());const r=sc(this.elementShape,this.tensors,s);return t.length===0?Cr([],[0].concat(r)):pt(()=>{const i=t.map(o=>ct(this.tensors[o],r));return cr(i,0)})}concat(t,e){if(t&&t!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${t}`);zr(this.elementShape,e,"TensorList shape mismatch: ");const s=sc(this.elementShape,this.tensors,e);return this.size()===0?Cr([],[0].concat(s)):pt(()=>{const r=this.tensors.map(i=>ct(i,s));return Cn(r,0)})}}function IW(n,t,e){const s=n.dtype;if(n.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${n.shape}`);if(n.dtype!==e)throw new Error(`Invalid data types; op elements ${n.dtype}, but list elements ${e}`);const r=n.shape.slice(1);zr(r,t,"TensorList shape mismatch: ");const i=$r(n);return new Ha(i,t,s)}function CW(n,t,e,s){return new Ha([],n,t,s)}function NW(n,t,e,s){if(t.length!==n.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${t.length} vs. ${n.shape[0]}`);const r=Math.max(...t);if(s!=null&&s!==-1&&r>=s)throw new Error(`Max index must be < array size (${r}  vs. ${s})`);const i=new Ha([],e,n.dtype,s),o=$r(n,0);return t.forEach((a,u)=>{i.setItem(a,o[u])}),i}function TW(n,t,e){let s=0;const r=t.map(c=>(s+=c,s));if(s!==n.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${s}, and tensor's shape is: ${n.shape}`);const i=n.shape.slice(1),o=k1(i,e),a=s===0?0:n.size/s,u=pt(()=>{const c=[];n=ct(n,[1,s,a]);for(let h=0;h<t.length;++h){const f=[0,h===0?0:r[h-1],0],p=[1,t[h],a];c[h]=ct(xe(n,f,p),o)}return n.dispose(),c}),l=new Ha([],e,n.dtype,t.length);for(let c=0;c<u.length;c++)l.setItem(c,u[c]);return l}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $W=async(n,t,e)=>{switch(n.op){case"If":case"StatelessIf":{const s=_("thenBranch",n,t,e),r=_("elseBranch",n,t,e),i=_("cond",n,t,e),o=_("args",n,t,e);return(await i.data())[0]?e.functionMap[s].executeFunctionAsync(o,e.tensorArrayMap,e.tensorListMap):e.functionMap[r].executeFunctionAsync(o,e.tensorArrayMap,e.tensorListMap)}case"While":case"StatelessWhile":{const s=_("body",n,t,e),r=_("cond",n,t,e),i=_("args",n,t,e),o=await e.functionMap[r].executeFunctionAsync(i,e.tensorArrayMap,e.tensorListMap),a=i.map(c=>c.id);let u=await o[0].data();o.forEach(c=>{!c.kept&&a.indexOf(c.id)===-1&&c.dispose()});let l=i;for(;u[0];){const c=l;l=await e.functionMap[s].executeFunctionAsync(l,e.tensorArrayMap,e.tensorListMap);const h=l.map(f=>f.id);c.forEach(f=>{!f.kept&&a.indexOf(f.id)===-1&&h.indexOf(f.id)===-1&&f.dispose()});const d=await e.functionMap[r].executeFunctionAsync(l,e.tensorArrayMap,e.tensorListMap);u=await d[0].data(),d.forEach(f=>{!f.kept&&a.indexOf(f.id)===-1&&h.indexOf(f.id)===-1&&f.dispose()})}return l}case"LoopCond":{const s=_("pred",n,t,e);return[qi(s)]}case"Switch":{const s=_("pred",n,t,e);let r=_("data",n,t,e);return r.kept||(r=qi(r)),(await s.data())[0]?[void 0,r]:[r,void 0]}case"Merge":{const s=n.inputNames.find(r=>Ds(r,t,e)!==void 0);if(s){const r=Ds(s,t,e);return[qi(r)]}return}case"Enter":{const s=_("frameName",n,t,e),r=_("tensor",n,t,e);return e.enterFrame(s),[qi(r)]}case"Exit":{const s=_("tensor",n,t,e);return e.exitFrame(),[qi(s)]}case"NextIteration":{const s=_("tensor",n,t,e);return e.nextIteration(),[qi(s)]}case"TensorArrayV3":{const s=_("size",n,t,e),r=_("dtype",n,t,e),i=_("elementShape",n,t,e),o=_("dynamicSize",n,t,e),a=_("clearAfterRead",n,t,e),u=_("identicalElementShapes",n,t,e),l=_("name",n,t,e),c=new SW(l,r,s,i,u,o,a);return e.addTensorArray(c),[c.idTensor,fe(1)]}case"TensorArrayWriteV3":{const s=_("tensorArrayId",n,t,e),r=_("index",n,t,e),i=_("tensor",n,t,e),o=e.getTensorArray(s.id);return o.write(r,i),[o.idTensor]}case"TensorArrayReadV3":{const s=_("tensorArrayId",n,t,e),r=_("index",n,t,e);return[e.getTensorArray(s.id).read(r)]}case"TensorArrayGatherV3":{const s=_("tensorArrayId",n,t,e),r=_("indices",n,t,e),i=_("dtype",n,t,e);return[e.getTensorArray(s.id).gather(r,i)]}case"TensorArrayScatterV3":{const s=_("tensorArrayId",n,t,e),r=_("indices",n,t,e),i=_("tensor",n,t,e),o=e.getTensorArray(s.id);return o.scatter(r,i),[o.idTensor]}case"TensorArrayConcatV3":{const s=_("tensorArrayId",n,t,e),r=e.getTensorArray(s.id),i=_("dtype",n,t,e);return[r.concat(i)]}case"TensorArraySplitV3":{const s=_("tensorArrayId",n,t,e),r=_("tensor",n,t,e),i=_("lengths",n,t,e),o=e.getTensorArray(s.id);return o.split(i,r),[o.idTensor]}case"TensorArraySizeV3":{const s=_("tensorArrayId",n,t,e),r=e.getTensorArray(s.id);return[fe(r.size(),"int32")]}case"TensorArrayCloseV3":{const s=_("tensorArrayId",n,t,e),r=e.getTensorArray(s.id);return r.clearAndClose(),[r.idTensor]}case"TensorListSetItem":{const s=_("tensorListId",n,t,e),r=_("index",n,t,e),i=_("tensor",n,t,e),o=e.getTensorList(s.id);return o.setItem(r,i),[o.idTensor]}case"TensorListGetItem":{const s=_("tensorListId",n,t,e),r=_("index",n,t,e),i=_("elementShape",n,t,e),o=_("elementDType",n,t,e);return[e.getTensorList(s.id).getItem(r,i,o)]}case"TensorListScatterV2":case"TensorListScatter":{const s=_("indices",n,t,e),r=_("tensor",n,t,e),i=_("elementShape",n,t,e),o=_("numElements",n,t,e),a=NW(r,s,i,o);return e.addTensorList(a),[a.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const s=_("elementShape",n,t,e),r=_("elementDType",n,t,e);let i;n.op==="TensorListReserve"?i="numElements":i="maxNumElements";const o=_(i,n,t,e),a=n.op==="TensorListReserve"?-1:o,u=CW(s,r,o,a);return e.addTensorList(u),[u.idTensor]}case"TensorListGather":{const s=_("tensorListId",n,t,e),r=_("indices",n,t,e),i=_("elementShape",n,t,e),o=_("elementDType",n,t,e);return[e.getTensorList(s.id).gather(r,o,i)]}case"TensorListStack":{const s=_("tensorListId",n,t,e),r=_("elementShape",n,t,e),i=_("elementDType",n,t,e),o=_("numElements",n,t,e);return[e.getTensorList(s.id).stack(r,i,o)]}case"TensorListFromTensor":{const s=_("tensor",n,t,e),r=_("elementShape",n,t,e),i=_("elementDType",n,t,e),o=IW(s,r,i);return e.addTensorList(o),[o.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{const s=_("tensorListId",n,t,e),r=e.getTensorList(s.id),i=_("dtype",n,t,e),o=_("elementShape",n,t,e);return[r.concat(i,o)]}case"TensorListPushBack":{const s=_("tensorListId",n,t,e),r=_("tensor",n,t,e),i=e.getTensorList(s.id);return i.pushBack(r),[i.idTensor]}case"TensorListPopBack":{const s=_("tensorListId",n,t,e),r=_("elementShape",n,t,e),i=_("elementDType",n,t,e);return[e.getTensorList(s.id).popBack(r,i)]}case"TensorListSplit":{const s=_("tensor",n,t,e),r=_("elementShape",n,t,e),i=_("lengths",n,t,e),o=TW(s,i,r);return e.addTensorList(o),[o.idTensor]}case"TensorListLength":{const s=_("tensorListId",n,t,e),r=e.getTensorList(s.id);return[fe(r.size(),"int32")]}case"TensorListResize":{const s=_("tensorListId",n,t,e),r=_("size",n,t,e),o=e.getTensorList(s.id).resize(r);return e.addTensorList(o),[o.idTensor]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wb(n,t,e){const[s,r]=_("fusedOps",n,t,e),i=s==="biasadd",o=!i,a=r==="prelu",u=s==="fusedbatchnorm",l=_("numArgs",n,t,e);if(i){if(a&&l!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&i&&l!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(u)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const c=_("strides",n,t,e),h=tf(n,t,e),d=_("dataFormat",n,t,e).toUpperCase(),f=_("dilations",n,t,e);let[p,m]=_("args",n,t,e);o&&(m=p,p=void 0);const g=_("leakyreluAlpha",n,t,e);return{stride:c,pad:h,dataFormat:d,dilations:f,biasArg:p,preluArg:m,activationFunc:r,leakyreluAlpha:g}}const EW=(n,t,e,s=Is)=>{switch(n.op){case"Conv1D":{const r=_("stride",n,t,e),i=_("pad",n,t,e),o=_("dataFormat",n,t,e).toUpperCase(),a=_("dilation",n,t,e);return[s.conv1d(_("x",n,t,e),_("filter",n,t,e),r,i,o,a)]}case"Conv2D":{const r=_("strides",n,t,e),i=tf(n,t,e),o=_("dataFormat",n,t,e).toUpperCase(),a=_("dilations",n,t,e);return[s.conv2d(_("x",n,t,e),_("filter",n,t,e),[r[1],r[2]],i,o,[a[1],a[2]])]}case"_FusedConv2D":{const{stride:r,pad:i,dataFormat:o,dilations:a,biasArg:u,preluArg:l,activationFunc:c,leakyreluAlpha:h}=Wb(n,t,e);return[s.fused.conv2d({x:_("x",n,t,e),filter:_("filter",n,t,e),strides:[r[1],r[2]],pad:i,dataFormat:o,dilations:[a[1],a[2]],bias:u,activation:c,preluActivationWeights:l,leakyreluAlpha:h})]}case"FusedDepthwiseConv2dNative":{const{stride:r,pad:i,dataFormat:o,dilations:a,biasArg:u,preluArg:l,activationFunc:c,leakyreluAlpha:h}=Wb(n,t,e);return[s.fused.depthwiseConv2d({x:_("x",n,t,e),filter:_("filter",n,t,e),strides:[r[1],r[2]],pad:i,dataFormat:o,dilations:[a[1],a[2]],bias:u,activation:c,preluActivationWeights:l,leakyreluAlpha:h})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const r=_("outputShape",n,t,e),i=_("strides",n,t,e),o=tf(n,t,e);return[s.conv2dTranspose(_("x",n,t,e),_("filter",n,t,e),r,[i[1],i[2]],o)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const r=_("strides",n,t,e),i=tf(n,t,e),o=_("dilations",n,t,e),a=_("dataFormat",n,t,e).toUpperCase();return[s.depthwiseConv2d(_("input",n,t,e),_("filter",n,t,e),[r[1],r[2]],i,a,[o[1],o[2]])]}case"Conv3D":{const r=_("strides",n,t,e),i=_("pad",n,t,e),o=_("dataFormat",n,t,e).toUpperCase(),a=_("dilations",n,t,e);return[s.conv3d(_("x",n,t,e),_("filter",n,t,e),[r[1],r[2],r[3]],i,o,[a[1],a[2],a[3]])]}case"AvgPool":{const r=_("strides",n,t,e),i=_("pad",n,t,e),o=_("kernelSize",n,t,e);return[s.avgPool(_("x",n,t,e),[o[1],o[2]],[r[1],r[2]],i)]}case"MaxPool":{const r=_("strides",n,t,e),i=_("pad",n,t,e),o=_("kernelSize",n,t,e);return[s.maxPool(_("x",n,t,e),[o[1],o[2]],[r[1],r[2]],i)]}case"MaxPoolWithArgmax":{const r=_("strides",n,t,e),i=_("pad",n,t,e),o=_("kernelSize",n,t,e),a=_("includeBatchInIndex",n,t,e),{result:u,indexes:l}=s.maxPoolWithArgmax(_("x",n,t,e),[o[1],o[2]],[r[1],r[2]],i,a);return[u,l]}case"AvgPool3D":{const r=_("strides",n,t,e),i=_("pad",n,t,e),o=_("kernelSize",n,t,e);return[s.avgPool3d(_("x",n,t,e),[o[1],o[2],o[3]],[r[1],r[2],r[3]],i)]}case"MaxPool3D":{const r=_("strides",n,t,e),i=_("pad",n,t,e),o=_("kernelSize",n,t,e);return[s.maxPool3d(_("x",n,t,e),[o[1],o[2],o[3]],[r[1],r[2],r[3]],i)]}case"Dilation2D":{const r=_("strides",n,t,e),i=_("pad",n,t,e),o=_("dilations",n,t,e),a=r[1],u=r[2],l=o[1],c=o[2];return[s.dilation2d(_("x",n,t,e),_("filter",n,t,e),[a,u],i,[l,c],"NHWC")]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _W=(n,t,e,s=Is)=>{switch(n.op){case"Fill":{const r=_("shape",n,t,e),i=_("dtype",n,t,e),o=_("value",n,t,e);return[s.fill(r,o,i)]}case"LinSpace":{const r=_("start",n,t,e),i=_("stop",n,t,e),o=_("num",n,t,e);return[s.linspace(r,i,o)]}case"Multinomial":{const r=_("logits",n,t,e),i=_("numSamples",n,t,e),o=_("seed",n,t,e);return[s.multinomial(r,i,o)]}case"OneHot":{const r=_("indices",n,t,e),i=_("depth",n,t,e),o=_("onValue",n,t,e),a=_("offValue",n,t,e),u=_("dtype",n,t,e);return[s.oneHot(r,i,o,a,u)]}case"Ones":return[s.ones(_("shape",n,t,e),_("dtype",n,t,e))];case"OnesLike":return[s.onesLike(_("x",n,t,e))];case"RandomStandardNormal":return[s.randomStandardNormal(_("shape",n,t,e),_("dtype",n,t,e),_("seed",n,t,e))];case"RandomUniform":return[s.randomUniform(_("shape",n,t,e),_("minval",n,t,e),_("maxval",n,t,e),_("dtype",n,t,e))];case"Range":{const r=_("start",n,t,e),i=_("stop",n,t,e),o=_("step",n,t,e);return[s.range(r,i,o,_("dtype",n,t,e))]}case"TruncatedNormal":{const r=_("shape",n,t,e),i=_("mean",n,t,e),o=_("stdDev",n,t,e),a=_("seed",n,t,e);return[s.truncatedNormal(r,i,o,_("dtype",n,t,e),a)]}case"Zeros":return[s.zeros(_("shape",n,t,e),_("dtype",n,t,e))];case"ZerosLike":return[s.zerosLike(_("x",n,t,e))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yg(n,t,e){const s=_("boxes",n,t,e),r=_("scores",n,t,e),i=_("maxOutputSize",n,t,e),o=_("iouThreshold",n,t,e),a=_("scoreThreshold",n,t,e),u=_("softNmsSigma",n,t,e);return{boxes:s,scores:r,maxOutputSize:i,iouThreshold:o,scoreThreshold:a,softNmsSigma:u}}const AW=async(n,t,e,s,r=Is)=>{switch(n.op){case"NonMaxSuppressionV5":{const{boxes:i,scores:o,maxOutputSize:a,iouThreshold:u,scoreThreshold:l,softNmsSigma:c}=yg(n,t,e),h=await r.image.nonMaxSuppressionWithScoreAsync(i,o,a,u,l,c);return[h.selectedIndices,h.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:i,scores:o,maxOutputSize:a,iouThreshold:u,scoreThreshold:l}=yg(n,t,e),c=_("padToMaxOutputSize",n,t,e),h=await r.image.nonMaxSuppressionPaddedAsync(i,o,a,u,l,c);return[h.selectedIndices,h.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:i,scores:o,maxOutputSize:a,iouThreshold:u,scoreThreshold:l}=yg(n,t,e);return[await r.image.nonMaxSuppressionAsync(i,o,a,u,l)]}case"Where":{const i=r.cast(_("condition",n,t,e),"bool"),o=[await r.whereAsync(i)];return i.dispose(),o}case"ListDiff":return r.setdiff1dAsync(_("x",n,t,e),_("y",n,t,e));default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RW=(n,t,e,s=Is)=>{switch(n.op){case"LowerBound":{const r=_("sortedSequence",n,t,e),i=_("values",n,t,e);return[s.lowerBound(r,i)]}case"TopKV2":{const r=_("x",n,t,e),i=_("k",n,t,e),o=_("sorted",n,t,e),a=s.topk(r,i,o);return[a.values,a.indices]}case"UpperBound":{const r=_("sortedSequence",n,t,e),i=_("values",n,t,e);return[s.upperBound(r,i)]}case"Unique":{const r=_("x",n,t,e),i=s.unique(r);return[i.values,i.indices]}case"UniqueV2":{const r=_("x",n,t,e),i=_("axis",n,t,e),o=s.unique(r,i);return[o.values,o.indices]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DW=(n,t,e,s=Is)=>{switch(n.op){case"Const":return t[n.name];case"PlaceholderWithDefault":const r=_("default",n,t,e);return[Ds(n.name,t,e)||r];case"Placeholder":return[Ds(n.name,t,e)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":{const c=_("x",n,t,e);return[qi(c)]}case"IdentityN":return _("x",n,t,e).map(c=>qi(c));case"Snapshot":const i=_("x",n,t,e);return[qi(i)];case"Shape":return[s.tensor1d(_("x",n,t,e).shape,"int32")];case"ShapeN":return _("x",n,t,e).map(c=>s.tensor1d(c.shape));case"Size":return[s.scalar(_("x",n,t,e).size,"int32")];case"Rank":return[s.scalar(_("x",n,t,e).rank,"int32")];case"NoOp":return[s.scalar(1)];case"Print":const o=_("x",n,t,e),a=_("data",n,t,e),u=_("message",n,t,e),l=_("summarize",n,t,e);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(u);for(let c=0;c<a.length;c++)console.log(Array.prototype.slice.call(a[c].dataSync()).slice(0,l));return[o];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class OW{constructor(t,e){this.keyDType=t,this.valueDType=e,this.handle=fe(0),this.tensorMap=new Map,es(this.handle)}get id(){return this.handle.id}clearAndClose(){this.tensorMap.forEach(t=>t.dispose()),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return fe(this.size(),"int32")}async import(t,e){this.checkKeyAndValueTensor(t,e);const s=await t.data();return this.tensorMap.forEach(r=>r.dispose()),this.tensorMap.clear(),pt(()=>{const r=$r(e),i=s.length,o=r.length;V(i===o,()=>`The number of elements doesn't match, keys has ${i} elements, the values has ${o} elements.`);for(let a=0;a<i;a++){const u=s[a],l=r[a];es(l),this.tensorMap.set(u,l)}return this.handle})}async find(t,e){this.checkKeyAndValueTensor(t,e);const s=await t.data();return pt(()=>{const r=[];for(let i=0;i<s.length;i++){const o=s[i],a=this.findWithDefault(o,e);r.push(a)}return cr(r)})}findWithDefault(t,e){const s=this.tensorMap.get(t);return s??e}checkKeyAndValueTensor(t,e){if(t.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${t.dtype}`);if(e.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${e.dtype}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FW=async(n,t,e,s)=>{switch(n.op){case"HashTable":case"HashTableV2":{const r=_("keyDType",n,t,e),i=_("valueDType",n,t,e),o=new OW(r,i);return s.addHashTable(n.name,o),[o.handle]}case"LookupTableImport":case"LookupTableImportV2":{const r=_("tableHandle",n,t,e,s),i=_("keys",n,t,e),o=_("values",n,t,e);return[await s.getHashTableById(r.id).import(i,o)]}case"LookupTableFind":case"LookupTableFindV2":{const r=_("tableHandle",n,t,e,s),i=_("keys",n,t,e),o=_("defaultValue",n,t,e);return[await s.getHashTableById(r.id).find(i,o)]}case"LookupTableSize":case"LookupTableSizeV2":{const r=_("tableHandle",n,t,e,s);return[s.getHashTableById(r.id).tensorSize()]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LW=(n,t,e,s=Is)=>{switch(n.op){case"ResizeBilinear":{const r=_("images",n,t,e),i=_("size",n,t,e),o=_("alignCorners",n,t,e),a=_("halfPixelCenters",n,t,e);return[s.image.resizeBilinear(r,[i[0],i[1]],o,a)]}case"ResizeNearestNeighbor":{const r=_("images",n,t,e),i=_("size",n,t,e),o=_("alignCorners",n,t,e),a=_("halfPixelCenters",n,t,e);return[s.image.resizeNearestNeighbor(r,[i[0],i[1]],o,a)]}case"CropAndResize":{const r=_("image",n,t,e),i=_("boxes",n,t,e),o=_("boxInd",n,t,e),a=_("cropSize",n,t,e),u=_("method",n,t,e),l=_("extrapolationValue",n,t,e);return[s.image.cropAndResize(r,i,o,a,u,l)]}case"ImageProjectiveTransformV3":{const r=_("images",n,t,e),i=_("transforms",n,t,e),o=_("outputShape",n,t,e),a=_("fillValue",n,t,e),u=_("interpolation",n,t,e),l=_("fillMode",n,t,e);return[s.image.transform(r,i,u.toLowerCase(),l.toLowerCase(),a,o)]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PW=(n,t,e,s=Is)=>{switch(n.op){case"Equal":return[s.equal(_("a",n,t,e),_("b",n,t,e))];case"NotEqual":return[s.notEqual(_("a",n,t,e),_("b",n,t,e))];case"Greater":return[s.greater(_("a",n,t,e),_("b",n,t,e))];case"GreaterEqual":return[s.greaterEqual(_("a",n,t,e),_("b",n,t,e))];case"Less":return[s.less(_("a",n,t,e),_("b",n,t,e))];case"LessEqual":return[s.lessEqual(_("a",n,t,e),_("b",n,t,e))];case"LogicalAnd":return[s.logicalAnd(_("a",n,t,e),_("b",n,t,e))];case"LogicalNot":return[s.logicalNot(_("a",n,t,e))];case"LogicalOr":return[s.logicalOr(_("a",n,t,e),_("b",n,t,e))];case"Select":case"SelectV2":return[s.where(_("condition",n,t,e),_("a",n,t,e),_("b",n,t,e))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MW=(n,t,e,s=Is)=>{switch(n.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[s.matMul(_("a",n,t,e),_("b",n,t,e),_("transposeA",n,t,e),_("transposeB",n,t,e))];case"Einsum":return[s.einsum(_("equation",n,t,e),..._("tensors",n,t,e))];case"Transpose":return[s.transpose(_("x",n,t,e),_("perm",n,t,e))];case"_FusedMatMul":const[r,i]=_("fusedOps",n,t,e),o=r==="biasadd",a=i==="prelu",u=_("numArgs",n,t,e),l=_("leakyreluAlpha",n,t,e);if(o){if(a&&u!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&u!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[c,h]=_("args",n,t,e);return[s.fused.matMul({a:_("a",n,t,e),b:_("b",n,t,e),transposeA:_("transposeA",n,t,e),transposeB:_("transposeB",n,t,e),bias:c,activation:i,preluActivationWeights:h,leakyreluAlpha:l})];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zW=(n,t,e,s=Is)=>{switch(n.op){case"EuclideanNorm":return[s.euclideanNorm(_("x",n,t,e),_("axis",n,t,e),_("keepDims",n,t,e))];case"FusedBatchNorm":case"FusedBatchNormV2":return[s.batchNorm(_("x",n,t,e),_("mean",n,t,e),_("variance",n,t,e),_("offset",n,t,e),_("scale",n,t,e),_("epsilon",n,t,e))];case"FusedBatchNormV3":return[s.batchNorm(_("x",n,t,e),_("mean",n,t,e),_("variance",n,t,e),_("offset",n,t,e),_("scale",n,t,e),_("epsilon",n,t,e))];case"LRN":return[s.localResponseNormalization(_("x",n,t,e),_("radius",n,t,e),_("bias",n,t,e),_("alpha",n,t,e),_("beta",n,t,e))];case"Softmax":return[s.softmax(_("x",n,t,e))];case"LogSoftmax":return[s.logSoftmax(_("x",n,t,e))];case"SparseToDense":return[s.sparseToDense(_("sparseIndices",n,t,e),_("outputShape",n,t,e),_("sparseValues",n,t,e),_("defaultValue",n,t,e))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BW=(n,t,e,s=Is)=>{switch(n.op){case"Max":{const a=_("axis",n,t,e),u=_("keepDims",n,t,e);return[s.max(_("x",n,t,e),a,u)]}case"Mean":{const a=_("axis",n,t,e),u=_("keepDims",n,t,e);return[s.mean(_("x",n,t,e),a,u)]}case"Min":{const a=_("axis",n,t,e),u=_("keepDims",n,t,e);return[s.min(_("x",n,t,e),a,u)]}case"Sum":{const a=_("axis",n,t,e),u=_("keepDims",n,t,e);return[s.sum(_("x",n,t,e),a,u)]}case"All":{const a=_("axis",n,t,e),u=_("keepDims",n,t,e);return[s.all(_("x",n,t,e),a,u)]}case"Any":{const a=_("axis",n,t,e),u=_("keepDims",n,t,e);return[s.any(_("x",n,t,e),a,u)]}case"ArgMax":{const a=_("axis",n,t,e);return[s.argMax(_("x",n,t,e),a)]}case"ArgMin":{const a=_("axis",n,t,e);return[s.argMin(_("x",n,t,e),a)]}case"Prod":{const a=_("axis",n,t,e),u=_("keepDims",n,t,e);return[s.prod(_("x",n,t,e),a,u)]}case"Cumprod":{const a=_("axis",n,t,e),u=_("exclusive",n,t,e),l=_("reverse",n,t,e);return[s.cumprod(_("x",n,t,e),a,u,l)]}case"Cumsum":{const a=_("axis",n,t,e),u=_("exclusive",n,t,e),l=_("reverse",n,t,e);return[s.cumsum(_("x",n,t,e),a,u,l)]}case"Bincount":const r=_("x",n,t,e),i=_("weights",n,t,e),o=_("size",n,t,e);return[s.bincount(r,i,o)];case"DenseBincount":{const a=_("x",n,t,e),u=_("weights",n,t,e),l=_("size",n,t,e),c=_("binaryOutput",n,t,e);return[s.denseBincount(a,u,l,c)]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VW=(n,t,e,s=Is)=>{switch(n.op){case"ConcatV2":case"Concat":{const r=_("n",n,t,e),i=_("axis",n,t,e);let o=_("tensors",n,t,e);return o=o.slice(0,r),[s.concat(o,i)]}case"Gather":{const r=_("x",n,t,e),i=_("indices",n,t,e);return[s.gather(r,s.cast(i,"int32"),0)]}case"GatherV2":{const r=_("axis",n,t,e),i=_("batchDims",n,t,e),o=_("x",n,t,e),a=_("indices",n,t,e);return[s.gather(o,s.cast(a,"int32"),r,i)]}case"Reverse":{const r=_("dims",n,t,e),i=[];for(let a=0;a<r.length;a++)r[a]&&i.push(a);const o=_("x",n,t,e);return[s.reverse(o,i)]}case"ReverseV2":{const r=_("axis",n,t,e),i=_("x",n,t,e);return[s.reverse(i,r)]}case"Slice":{const r=_("begin",n,t,e),i=_("size",n,t,e);return[s.slice(_("x",n,t,e),r,i)]}case"StridedSlice":{const r=_("begin",n,t,e),i=_("end",n,t,e),o=_("strides",n,t,e),a=_("beginMask",n,t,e),u=_("endMask",n,t,e),l=_("ellipsisMask",n,t,e),c=_("newAxisMask",n,t,e),h=_("shrinkAxisMask",n,t,e),d=_("x",n,t,e);return[s.stridedSlice(d,r,i,o,a,u,l,c,h)]}case"Pack":return pt(()=>{const r=_("axis",n,t,e),i=_("tensors",n,t,e),o=i[0].shape,a=s.squeeze(i[0]).shape,u=i.map(l=>{const c=Ve(l.shape,o);if(!c&&!Ve(s.squeeze(l).shape,a))throw new Error("the input tensors shape does not match");return c?l:s.reshape(l,o)});return[s.stack(u,r)]});case"Unpack":{const r=_("axis",n,t,e),i=_("tensor",n,t,e);return s.unstack(i,r)}case"Tile":{const r=_("reps",n,t,e);return[s.tile(_("x",n,t,e),r)]}case"Split":case"SplitV":{const r=_("axis",n,t,e),i=_("numOrSizeSplits",n,t,e),o=_("x",n,t,e);return s.split(o,i,r)}case"ScatterNd":{const r=_("indices",n,t,e),i=_("values",n,t,e),o=_("shape",n,t,e);return[s.scatterND(r,i,o)]}case"GatherNd":{const r=_("x",n,t,e),i=_("indices",n,t,e);return[s.gatherND(r,i)]}case"SparseToDense":{const r=_("sparseIndices",n,t,e),i=_("outputShape",n,t,e),o=_("sparseValues",n,t,e),a=_("defaultValue",n,t,e);return[s.sparseToDense(r,o,i,o.dtype===a.dtype?a:s.cast(a,o.dtype))]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UW=(n,t,e,s=Is)=>{switch(n.op){case"SparseFillEmptyRows":{const{outputIndices:r,outputValues:i,emptyRowIndicator:o,reverseIndexMap:a}=s.sparse.sparseFillEmptyRows(_("indices",n,t,e),_("values",n,t,e),_("denseShape",n,t,e),_("defaultValue",n,t,e));return[r,i,o,a]}case"SparseReshape":{const{outputIndices:r,outputShape:i}=s.sparse.sparseReshape(_("inputIndices",n,t,e),_("inputShape",n,t,e),_("newShape",n,t,e));return[r,i]}case"SparseSegmentMean":return[s.sparse.sparseSegmentMean(_("data",n,t,e),_("indices",n,t,e),_("segmentIds",n,t,e))];case"SparseSegmentSum":return[s.sparse.sparseSegmentSum(_("data",n,t,e),_("indices",n,t,e),_("segmentIds",n,t,e))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WW=(n,t,e,s=Is)=>{switch(n.op){case"FFT":return[s.fft(_("x",n,t,e))];case"IFFT":return[s.ifft(_("x",n,t,e))];case"RFFT":return[s.rfft(_("x",n,t,e))];case"IRFFT":return[s.irfft(_("x",n,t,e))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GW=(n,t,e,s=Is)=>{switch(n.op){case"StringNGrams":{const{nGrams:r,nGramsSplits:i}=s.string.stringNGrams(_("data",n,t,e),_("dataSplits",n,t,e),_("separator",n,t,e),_("nGramWidths",n,t,e),_("leftPad",n,t,e),_("rightPad",n,t,e),_("padWidth",n,t,e),_("preserveShortSequences",n,t,e));return[r,i]}case"StringSplit":{const{indices:r,values:i,shape:o}=s.string.stringSplit(_("input",n,t,e),_("delimiter",n,t,e),_("skipEmpty",n,t,e));return[r,i,o]}case"StringToHashBucketFast":return[s.string.stringToHashBucketFast(_("input",n,t,e),_("numBuckets",n,t,e))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jW=(n,t,e,s=Is)=>{switch(n.op){case"Cast":return[s.cast(_("x",n,t,e),_("dtype",n,t,e))];case"ExpandDims":{const r=_("axis",n,t,e);return[s.expandDims(_("x",n,t,e),r)]}case"Squeeze":{const r=_("axis",n,t,e);return[s.squeeze(_("x",n,t,e),r)]}case"Reshape":return[s.reshape(_("x",n,t,e),_("shape",n,t,e))];case"MirrorPad":return[s.mirrorPad(_("x",n,t,e),_("padding",n,t,e),_("mode",n,t,e))];case"PadV2":case"Pad":return[s.pad(_("x",n,t,e),_("padding",n,t,e),_("constantValue",n,t,e))];case"SpaceToBatchND":{const r=_("blockShape",n,t,e),i=_("paddings",n,t,e);return[s.spaceToBatchND(_("x",n,t,e),r,i)]}case"BatchToSpaceND":{const r=_("blockShape",n,t,e),i=_("crops",n,t,e);return[s.batchToSpaceND(_("x",n,t,e),r,i)]}case"DepthToSpace":{const r=_("blockSize",n,t,e),i=_("dataFormat",n,t,e).toUpperCase();return[s.depthToSpace(_("x",n,t,e),r,i)]}case"BroadcastTo":return[s.broadcastTo(_("x",n,t,e),_("shape",n,t,e))];case"BroadcastArgs":return[s.broadcastArgs(_("s0",n,t,e),_("s1",n,t,e))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gb(n,t,e,s,r=pt){const i=((o,a,u)=>{switch(o.category){case"arithmetic":return r(()=>vW(o,a,u));case"basic_math":return r(()=>kW(o,a,u));case"control":return $W(o,a,u);case"convolution":return r(()=>EW(o,a,u));case"creation":return r(()=>_W(o,a,u));case"dynamic":return AW(o,a,u);case"evaluation":return r(()=>RW(o,a,u));case"image":return r(()=>LW(o,a,u));case"graph":return r(()=>DW(o,a,u));case"logical":return r(()=>PW(o,a,u));case"matrices":return r(()=>MW(o,a,u));case"normalization":return r(()=>zW(o,a,u));case"reduction":return r(()=>BW(o,a,u));case"slice_join":return r(()=>VW(o,a,u));case"sparse":return r(()=>UW(o,a,u));case"spectral":return r(()=>WW(o,a,u));case"string":return r(()=>GW(o,a,u));case"transformation":return r(()=>jW(o,a,u));case"hash_table":return FW(o,a,u,s);case"custom":const l=Rk(o.op);if(l&&l.customExecutor)return l.customExecutor(new wW(o,a,u));throw TypeError(`Custom op ${o.op} is not registered.`);default:throw TypeError(`Unknown op '${o.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(n,t,e);return Uo(i)?i.then(o=>[].concat(o)):[].concat(i)}class jb{constructor(t={},e={},s={},r={}){this.weightMap=t,this.tensorArrayMap=e,this.tensorListMap=s,this.functionMap=r,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(t,e){return{id:t,frameName:e,iterationId:0}}set currentContext(t){this.contexts!==t&&(this.contexts=t,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const t=[];for(let e=0;e<this.contexts.length-1;e++){const s=this.contexts.slice(0,this.contexts.length-e);t.push(this.contextIdforContexts(s))}t.push(""),this._currentContextIds=t}contextIdforContexts(t){return t?t.map(e=>e.id===0&&e.iterationId===0?"":`${e.frameName}-${e.iterationId}`).join("/"):""}enterFrame(t){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,t)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(this.contexts&&this.contexts.length>1)this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift();else throw new Error("Cannot exit frame, the context is empty")}nextIteration(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice(),this.lastId++;const t=Object.assign({},this.contexts[this.contexts.length-1]);t.iterationId+=1,t.id=this.lastId,this.contexts.splice(-1,1,t),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else throw new Error("Cannot increase frame iteration, the context is empty")}getWeight(t){return this.weightMap[t]}addTensorArray(t){this.tensorArrayMap[t.id]=t}getTensorArray(t){return this.tensorArrayMap[t]}addTensorList(t){this.tensorListMap[t.id]=t}getTensorList(t){return this.tensorListMap[t]}dispose(t){for(const e in this.tensorArrayMap)this.tensorArrayMap[e].clearAndClose(t);for(const e in this.tensorListMap)this.tensorListMap[e].clearAndClose(t)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hb(n,t,e,s){const r=new Set,i=[];let o=null,a=null;const u=new Set,l=Object.keys(n).map(d=>sr(d)[0]);let c=[];s!=null&&(c=s.map(d=>sr(d.name)[0]));const h=[...t];for(;h.length>0;){const d=h.pop();if((Fk(d)||YW(d)||ZW(d))&&o==null&&(o=d,a=o.children.map(f=>f.name).filter(f=>r.has(f))),r.add(d.name),e[d.name]==null&&l.indexOf(d.name)===-1&&c.indexOf(d.name)===-1){if(d.inputs.length===0){i.push(d.name);continue}d.inputs.forEach(f=>{u.has(f.name)||(u.add(f.name),h.push(f))})}}return{inputs:n,outputs:t,usedNodes:r,missingInputs:i,dynamicNode:o,syncInputs:a}}function HW(n,t,e){const{usedNodes:s,inputs:r}=e,i=[],o=Object.keys(r).map(c=>sr(c)[0]).map(c=>n.nodes[c]),a=n.initNodes;o.forEach(c=>{s.has(c.name)&&i.push(c)}),n.weights.forEach(c=>{s.has(c.name)&&i.push(c)}),a!=null&&a.forEach(c=>{s.has(c.name)&&i.push(c)});const u=new Set,l=[];for(;i.length>0;){const c=i.pop();u.add(c.name),t[c.name]||l.push(c),c.children.forEach(h=>{!u.has(h.name)&&s.has(h.name)&&h.inputs.every(d=>u.has(d.name))&&i.push(h)})}return l}const KW=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],qW=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],XW=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"];function Fk(n){return KW.indexOf(n.op)>=0}function YW(n){return qW.indexOf(n.op)>=0}function ZW(n){return XW.indexOf(n.op)>=0}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wf{constructor(t,e){this.graph=t,this.parent=e,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this.intermediateTensors={},this.keepTensorForDebug=!1,this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,t.functions!=null&&Object.keys(t.functions).forEach(s=>{this._functionExecutorMap[s]=new wf(t.functions[s],this)})}get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(t){const e=Object.keys(t).map(s=>t[s].map(r=>r.id));this._weightIds=[].concat(...e),this._weightMap=t}set resourceManager(t){this._resourceManager=t}get inputs(){return this._inputs.map(t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0}))}get outputs(){return this._outputs.map(t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0}))}get inputNodes(){return this._inputs.map(t=>t.signatureKey||t.name)}get outputNodes(){return this._outputs.map(t=>{const e=t.signatureKey||t.name;return t.defaultOutput?`${e}:${t.defaultOutput}`:e})}get functions(){return Object.keys(this._functions).reduce((t,e)=>(t[e]=this._functions[e].signature,t),{})}getCompilationKey(t,e){const s=t.map(i=>i.name).sort(),r=e.map(i=>i.name).sort();return s.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)}compile(t,e){const s=Hb(t,e,this.weightMap,this._initNodes),{missingInputs:r,dynamicNode:i,syncInputs:o}=s;if(i!=null)throw new Error(`This execution contains the node '${i.name}', which has the dynamic op '${i.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${o}]`);if(r.length>0){const a=e.map(l=>l.name),u=Object.keys(t);throw new Error(`Cannot compute the outputs [${a}] from the provided inputs [${u}]. Missing the following inputs: [${r}]`)}return HW(this.graph,this.weightMap,s)}execute(t,e){t=this.mapInputs(t);const s=Object.keys(t).sort();this.checkInputs(t),this.checkInputShapeAndType(t),e=this.mapOutputs(e),this.checkOutputs(e);const r=s.map(h=>this.graph.nodes[sr(h)[0]]),i=e.map(h=>sr(h)[0]);let o=i.map(h=>this.graph.nodes[h]);this.resetIntermediateTensors(),o.length===0&&(o=this._outputs);const a=this.getCompilationKey(r,o);let u=this.compiledMap.get(a);u==null&&(u=this.compile(t,o),this.compiledMap.set(a,u));const l={},c={};return pt(()=>{const h=new jb(this.weightMap,l,c,this.functionExecutorMap),d=Object.assign({},this.weightMap);Object.keys(t).forEach(m=>{const[g,y]=sr(m),b=[];b[y]=t[m],d[g]=b});const f=this.getFrozenTensorIds(d),p={};for(let m=0;m<u.length;m++){const g=u[m];if(!d[g.name]){const y=Gb(g,d,h,this._resourceManager);if(Uo(y))throw new Error(`The execution of the op '${g.op}' returned a promise. Please use model.executeAsync() instead.`);d[g.name]=y,this.checkTensorForDisposal(g.name,g,d,h,f,i,p)}}return this.parent==null&&h.dispose(f),e.map(m=>Ds(m,d,h))})}getFrozenTensorIds(t){const e=[].concat.apply([],Object.keys(t).map(s=>t[s]).map(s=>s.map(r=>r.id)));return new Set(e)}checkTensorForDisposal(t,e,s,r,i,o,a){e.category==="control"||o.indexOf(t)!==-1||(s[t].forEach(u=>{u!=null&&(a[u.id]=(a[u.id]||0)+e.children.length)}),e.inputs.forEach(u=>{if(u.category!=="control"){const l=OU(u.name,s,r);l!=null&&l.forEach(c=>{if(c&&!c.kept&&!i.has(c.id)){const h=a[c.id];if(h===1){if(!this.keepTensorForDebug)c.dispose();else{const[d,f]=Si(e.name,r);this.intermediateTensors[d]?this.intermediateTensors[d][f]=c:(this.intermediateTensors[d]=[],this.intermediateTensors[d][f]=c)}delete a[c.id]}else h!=null&&a[c.id]--}})}}))}async executeAsync(t,e){return this._executeAsync(t,e)}disposeIntermediateTensors(){this.intermediateTensors&&(Object.keys(this.intermediateTensors).forEach(t=>this.intermediateTensors[t].forEach(e=>e.dispose())),this.disposeTensorsMap())}disposeTensorsMap(){this.tensorsMap&&Object.keys(this.tensorsMap).forEach(t=>{this.tensorsMap[t].forEach(s=>{s&&!s.kept&&!s.isDisposed&&!this.keepIds.has(s.id)&&s.dispose()})})}getIntermediateTensors(){return this.tensorsMap}resetIntermediateTensors(){for(const t in this.intermediateTensors)this.intermediateTensors[t].forEach(e=>e.dispose()),delete this.intermediateTensors[t]}async _executeAsync(t,e,s=!1,r={},i={}){s||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),e=this.mapOutputs(e),this.checkOutputs(e));try{this.keepTensorForDebug=vt().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(c){console.warn(c.message)}this.resetIntermediateTensors();const o=new jb(this.weightMap,r,i,this.functionExecutorMap);this.tensorsMap=await this.executeWithControlFlow(t,o,e,s);const a=e.map(c=>Ds(c,this.tensorsMap,o)),u=a.map(c=>c.id),l=Object.keys(t).map(c=>t[c].id);return this.keepIds=new Set([...u,...l,...this.weightIds]),this.keepTensorForDebug||this.disposeTensorsMap(),this.parent==null&&o.dispose(this.keepIds),a}async executeFunctionAsync(t,e,s){const r=t.reduce((i,o,a)=>(i[this.inputs[a].name]=o,i),{});return this._executeAsync(r,this.outputNodes,!0,e,s)}async executeWithControlFlow(t,e,s,r){const i=Object.keys(t),o=i.map(w=>this.graph.nodes[sr(w)[0]]),a=s.map(w=>sr(w)[0]);let u=a.map(w=>this.graph.nodes[w]);u.length===0&&(u=this._outputs);const{usedNodes:l,missingInputs:c,dynamicNode:h,syncInputs:d}=Hb(t,u,this.weightMap,this._initNodes),f=[...o,...this.graph.weights,...this._initNodes||[]].map(w=>({node:w,contexts:e.currentContext})),p=Object.assign({},this.weightMap);Object.keys(t).forEach(w=>{const[v,S]=sr(w),N=[];N[S]=t[w],p[v]=N});const m={},g=this.getFrozenTensorIds(p),y={};for(;f.length>0;){const w=this.processStack(o,f,e,p,y,g,a,m,l);await Promise.all(w)}h==null&&!r&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const b=u.filter(w=>!Fk(w)&&!Ds(w.name,p,e)).map(w=>w.name);if(b.length>0){let w="";throw h!=null&&(w=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${d}]`),new Error(`Cannot compute the outputs [${b}] from the provided inputs [${i}]. Consider providing the following inputs: [${c}]. ${w}`)}return p}processStack(t,e,s,r,i,o,a,u,l){const c=[];for(;e.length>0;){const h=e.pop();s.currentContext=h.contexts;let d="";if(h.node.op==="Enter"&&_("isConstant",h.node,r,s)&&([d]=Si(h.node.name,s)),r[h.node.name]==null){const f=Gb(h.node,r,s,this._resourceManager);d||([d]=Si(h.node.name,s));const p=s.currentContext;Uo(f)?c.push(f.then(m=>(r[d]=m,s.currentContext=p,this.checkTensorForDisposal(d,h.node,r,s,o,a,u),this.processChildNodes(h.node,e,s,r,i,l),m))):(r[d]=f,this.checkTensorForDisposal(d,h.node,r,s,o,a,u),this.processChildNodes(h.node,e,s,r,i,l))}else this.processChildNodes(h.node,e,s,r,i,l)}return c}processChildNodes(t,e,s,r,i,o){t.children.forEach(a=>{const[u]=Si(a.name,s);i[u]||!o.has(a.name)||(a.op==="Merge"?a.inputNames.some(l=>!!Ds(l,r,s))&&(i[u]=!0,e.push({contexts:s.currentContext,node:a})):a.inputNames.every(l=>!!Ds(l,r,s))&&(i[u]=!0,e.push({contexts:s.currentContext,node:a})))})}dispose(){Object.keys(this.weightMap).forEach(t=>this.weightMap[t].forEach(e=>e.dispose()))}checkInputShapeAndType(t){Object.keys(t).forEach(e=>{const s=t[e],[r]=sr(e),i=this.graph.nodes[r];if(i.attrParams.shape&&i.attrParams.shape.value){const o=i.attrParams.shape.value,a=o.length===s.shape.length&&s.shape.every((u,l)=>o[l]===-1||o[l]===u);V(a,()=>`The shape of dict['${i.name}'] provided in model.execute(dict) must be [${o}], but was [${s.shape}]`)}i.attrParams.dtype&&i.attrParams.dtype.value&&V(s.dtype===i.attrParams.dtype.value,()=>`The dtype of dict['${i.name}'] provided in model.execute(dict) must be ${i.attrParams.dtype.value}, but was ${s.dtype}`)})}mapInputs(t){const e={};for(const s in t)if(this._signature!=null&&this._signature.inputs!=null&&this._signature.inputs[s]!=null){const r=this._signature.inputs[s];e[r.name]=t[s]}else e[s]=t[s];return e}checkInputs(t){const e=Object.keys(t).filter(s=>{const[r]=sr(s);return this.graph.nodes[r]==null});if(e.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${e}] that are not part of graph`)}mapOutputs(t){return t.map(e=>this._signature!=null&&this._signature.outputs!=null&&this._signature.outputs[e]!=null?this._signature.outputs[e].name:e,{})}checkOutputs(t){t.forEach(e=>{const[s]=sr(e);if(!this.graph.nodes[s])throw new Error(`The output '${e}' is not found in the graph`)})}}class JW{constructor(t={},e={}){this.hashTableNameToHandle=t,this.hashTableMap=e}addHashTable(t,e){this.hashTableNameToHandle[t]=e.handle,this.hashTableMap[e.id]=e}getHashTableHandleByName(t){return this.hashTableNameToHandle[t]}getHashTableById(t){return this.hashTableMap[t]}dispose(){for(const t in this.hashTableMap)this.hashTableMap[t].clearAndClose(),delete this.hashTableMap[t];for(const t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QW="?tfjs-format=file",tG="model.json";class eG{constructor(t,e={},s=v2){this.modelUrl=t,this.loadOptions=e,this.version="n/a",this.io=s,e==null&&(this.loadOptions={}),this.resourceManager=new JW}get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}get modelStructuredOutputKeys(){return this.structuredOutputKeys}findIOHandler(){const t=this.modelUrl;if(t.load!=null)this.handler=t;else if(this.loadOptions.requestInit!=null)this.handler=this.io.browserHTTPRequest(t,this.loadOptions);else{const e=this.io.getLoadHandlers(t,this.loadOptions);if(e.length===0)e.push(this.io.browserHTTPRequest(t,this.loadOptions));else if(e.length>1)throw new Error(`Found more than one (${e.length}) load handlers for URL '${[t]}'`);this.handler=e[0]}}load(){if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const t=this.handler.load();return Uo(t)?t.then(e=>this.loadSync(e)):this.loadSync(t)}loadSync(t){this.artifacts=t;const e=this.artifacts.modelTopology;let s=this.artifacts.signature;if(this.artifacts.userDefinedMetadata!=null){const i=this.artifacts.userDefinedMetadata;i.signature!=null&&(s=i.signature),i.structuredOutputKeys!=null&&(this.structuredOutputKeys=i.structuredOutputKeys)}this.signature=s,this.version=`${e.versions.producer}.${e.versions.minConsumer}`;const r=this.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new wf(Bb.Instance.transformGraph(e,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),this.executor.resourceManager=this.resourceManager,t.modelInitializer!=null&&t.modelInitializer.node!=null){const i=Bb.Instance.transformGraph(t.modelInitializer);this.initializer=new wf(i),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializer.executeAsync({},[])}return!0}async save(t,e){if(typeof t=="string"){const s=this.io.getSaveHandlers(t);if(s.length===0)throw new Error(`Cannot find any save handlers for URL '${t}'`);if(s.length>1)throw new Error(`Found more than one (${s.length}) save handlers for URL '${t}'`);t=s[0]}if(t.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return t.save(this.artifacts)}predict(t,e){const s=this.execute(t,this.outputNodes);if(this.structuredOutputKeys){const r=s instanceof $e?[s]:s,i={};return r.forEach((o,a)=>i[this.structuredOutputKeys[a]]=o),i}return s}normalizeInputs(t){if(!(t instanceof $e)&&!Array.isArray(t))return t;if(t=Array.isArray(t)?t:[t],t.length!==this.inputNodes.length)throw new Error(`Input tensor count mismatch,the graph model has ${this.inputNodes.length} placeholders, while there are ${t.length} input tensors.`);return this.inputNodes.reduce((e,s,r)=>(e[s]=t[r],e),{})}normalizeOutputs(t){return t=t||this.outputNodes,Array.isArray(t)?t:[t]}execute(t,e){t=this.normalizeInputs(t),e=this.normalizeOutputs(e);const s=this.executor.execute(t,e);return s.length>1?s:s[0]}async executeAsync(t,e){t=this.normalizeInputs(t),e=this.normalizeOutputs(e);const s=await this.executor.executeAsync(t,e);return s.length>1?s:s[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(t){return Object.keys(t).reduce((e,s)=>(e[s]=[t[s]],e),{})}dispose(){this.executor.dispose(),this.initializer&&this.initializer.dispose(),this.resourceManager.dispose()}}async function pd(n,t={},e=v2){if(n==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");t==null&&(t={}),t.fromTFHub&&typeof n=="string"&&(n=nG(n));const s=new eG(n,t,e);return await s.load(),s}function nG(n){return n.endsWith("/")||(n=n+"/"),`${n}${tG}${QW}`}/**
    * @license
    * Copyright 2022 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */var ii=function(){return ii=Object.assign||function(n){for(var t,e=1,s=arguments.length;e<s;e++)for(var r in t=arguments[e])Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n},ii.apply(this,arguments)};function Qi(n,t,e,s){return new(e||(e=Promise))(function(r,i){function o(l){try{u(s.next(l))}catch(c){i(c)}}function a(l){try{u(s.throw(l))}catch(c){i(c)}}function u(l){var c;l.done?r(l.value):(c=l.value,c instanceof e?c:new e(function(h){h(c)})).then(o,a)}u((s=s.apply(n,t||[])).next())})}function to(n,t){var e,s,r,i,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function a(u){return function(l){return function(c){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,s&&(r=2&c[0]?s.return:c[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,c[1])).done)return r;switch(s=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,s=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(r=o.trys,!((r=r.length>0&&r[r.length-1])||c[0]!==6&&c[0]!==2)){o=0;continue}if(c[0]===3&&(!r||c[1]>r[0]&&c[1]<r[3])){o.label=c[1];break}if(c[0]===6&&o.label<r[1]){o.label=r[1],r=c;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(c);break}r[2]&&o.ops.pop(),o.trys.pop();continue}c=t.call(n,o)}catch(h){c=[6,h],s=0}finally{e=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([u,l])}}}function Ro(n){var t=n.map(function(e){return e[0]});return t.push(n[n.length-1][1]),t}var sG={lips:Ro([[61,146],[146,91],[91,181],[181,84],[84,17],[17,314],[314,405],[405,321],[321,375],[375,291],[61,185],[185,40],[40,39],[39,37],[37,0],[0,267],[267,269],[269,270],[270,409],[409,291],[78,95],[95,88],[88,178],[178,87],[87,14],[14,317],[317,402],[402,318],[318,324],[324,308],[78,191],[191,80],[80,81],[81,82],[82,13],[13,312],[312,311],[311,310],[310,415],[415,308]]),leftEye:Ro([[263,249],[249,390],[390,373],[373,374],[374,380],[380,381],[381,382],[382,362],[263,466],[466,388],[388,387],[387,386],[386,385],[385,384],[384,398],[398,362]]),leftEyebrow:Ro([[276,283],[283,282],[282,295],[295,285],[300,293],[293,334],[334,296],[296,336]]),leftIris:Ro([[474,475],[475,476],[476,477],[477,474]]),rightEye:Ro([[33,7],[7,163],[163,144],[144,145],[145,153],[153,154],[154,155],[155,133],[33,246],[246,161],[161,160],[160,159],[159,158],[158,157],[157,173],[173,133]]),rightEyebrow:Ro([[46,53],[53,52],[52,65],[65,55],[70,63],[63,105],[105,66],[66,107]]),rightIris:Ro([[469,470],[470,471],[471,472],[472,469]]),faceOval:Ro([[10,338],[338,297],[297,332],[332,284],[284,251],[251,389],[389,356],[356,454],[454,323],[323,361],[361,288],[288,397],[397,365],[365,379],[379,378],[378,400],[400,377],[377,152],[152,148],[148,176],[176,149],[149,150],[150,136],[136,172],[172,58],[58,132],[132,93],[93,234],[234,127],[127,162],[162,21],[21,54],[54,103],[103,67],[67,109],[109,10]])},rG=Object.entries(sG).map(function(n){var t=n[0];return n[1].map(function(e){return[e,t]})}).flat(),Lk=new Map(rG);function S1(n){for(var t={locationData:{relativeKeypoints:[]}},e=Number.MAX_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER,o=0;o<n.length;++o){var a=n[o];e=Math.min(e,a.x),s=Math.max(s,a.x),r=Math.min(r,a.y),i=Math.max(i,a.y),t.locationData.relativeKeypoints.push({x:a.x,y:a.y})}return t.locationData.relativeBoundingBox={xMin:e,yMin:r,xMax:s,yMax:i,width:s-e,height:i-r},t}var bg={runtime:"mediapipe",maxFaces:1,refineLandmarks:!1},iG=function(){function n(t){var e=this;this.width=0,this.height=0,this.selfieMode=!1,this.faceMeshSolution=new lN.FaceMesh({locateFile:function(s,r){return t.solutionPath?t.solutionPath.replace(/\/+$/,"")+"/"+s:r+"/"+s}}),this.faceMeshSolution.setOptions({refineLandmarks:t.refineLandmarks,selfieMode:this.selfieMode,maxNumFaces:t.maxFaces}),this.faceMeshSolution.onResults(function(s){if(e.height=s.image.height,e.width=s.image.width,e.faces=[],s.multiFaceLandmarks!==null)for(var r=s.multiFaceLandmarks,i=0;i<r.length;i++){var o=e.translateOutput(r[i]);e.faces.push({keypoints:o,box:S1(o).locationData.relativeBoundingBox})}})}return n.prototype.translateOutput=function(t){var e=this;return t.map(function(s,r){var i={x:s.x*e.width,y:s.y*e.height,z:s.z*e.width},o=Lk.get(r);return o!=null&&(i.name=o),i})},n.prototype.estimateFaces=function(t,e){return Qi(this,void 0,void 0,function(){var s,r;return to(this,function(i){switch(i.label){case 0:return e&&e.flipHorizontal&&e.flipHorizontal!==this.selfieMode&&(this.selfieMode=e.flipHorizontal,this.faceMeshSolution.setOptions({selfieMode:this.selfieMode})),t instanceof $e?(r=ImageData.bind,[4,ru(t)]):[3,2];case 1:return s=new(r.apply(ImageData,[void 0,i.sent(),t.shape[1],t.shape[0]])),[3,3];case 2:s=t,i.label=3;case 3:return t=s,[4,this.faceMeshSolution.send({image:t})];case 4:return i.sent(),[2,this.faces]}})})},n.prototype.dispose=function(){this.faceMeshSolution.close()},n.prototype.reset=function(){this.faceMeshSolution.reset(),this.width=0,this.height=0,this.faces=null,this.selfieMode=!1},n.prototype.initialize=function(){return this.faceMeshSolution.initialize()},n}();function oG(n){return Qi(this,void 0,void 0,function(){var t,e;return to(this,function(s){switch(s.label){case 0:return t=function(r){if(r==null)return ii({},bg);var i=ii({},r);return i.runtime="mediapipe",i.maxFaces==null&&(i.maxFaces=bg.maxFaces),i.refineLandmarks==null&&(i.refineLandmarks=bg.refineLandmarks),i}(n),[4,(e=new iG(t)).initialize()];case 1:return s.sent(),[2,e]}})})}var xg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},aG={};(function(){var n;function t(k){var A=0;return function(){return A<k.length?{done:!1,value:k[A++]}:{done:!0}}}var e=typeof Object.defineProperties=="function"?Object.defineProperty:function(k,A,P){return k==Array.prototype||k==Object.prototype||(k[A]=P.value),k},s=function(k){k=[typeof globalThis=="object"&&globalThis,k,typeof window=="object"&&window,typeof self=="object"&&self,typeof xg=="object"&&xg];for(var A=0;A<k.length;++A){var P=k[A];if(P&&P.Math==Math)return P}throw Error("Cannot find global object")}(this);function r(k,A){if(A)t:{var P=s;k=k.split(".");for(var W=0;W<k.length-1;W++){var Z=k[W];if(!(Z in P))break t;P=P[Z]}(A=A(W=P[k=k[k.length-1]]))!=W&&A!=null&&e(P,k,{configurable:!0,writable:!0,value:A})}}function i(k){return(k={next:k})[Symbol.iterator]=function(){return this},k}function o(k){var A=typeof Symbol<"u"&&Symbol.iterator&&k[Symbol.iterator];return A?A.call(k):{next:t(k)}}function a(k){if(!(k instanceof Array)){k=o(k);for(var A,P=[];!(A=k.next()).done;)P.push(A.value);k=P}return k}r("Symbol",function(k){function A(Z,X){this.g=Z,e(this,"description",{configurable:!0,writable:!0,value:X})}if(k)return k;A.prototype.toString=function(){return this.g};var P="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",W=0;return function Z(X){if(this instanceof Z)throw new TypeError("Symbol is not a constructor");return new A(P+(X||"")+"_"+W++,X)}}),r("Symbol.iterator",function(k){if(k)return k;k=Symbol("Symbol.iterator");for(var A="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),P=0;P<A.length;P++){var W=s[A[P]];typeof W=="function"&&typeof W.prototype[k]!="function"&&e(W.prototype,k,{configurable:!0,writable:!0,value:function(){return i(t(this))}})}return k});var u,l=typeof Object.create=="function"?Object.create:function(k){function A(){}return A.prototype=k,new A};if(typeof Object.setPrototypeOf=="function")u=Object.setPrototypeOf;else{var c;t:{var h={};try{h.__proto__={a:!0},c=h.a;break t}catch{}c=!1}u=c?function(k,A){if(k.__proto__=A,k.__proto__!==A)throw new TypeError(k+" is not extensible");return k}:null}var d=u;function f(k,A){if(k.prototype=l(A.prototype),k.prototype.constructor=k,d)d(k,A);else for(var P in A)if(P!="prototype")if(Object.defineProperties){var W=Object.getOwnPropertyDescriptor(A,P);W&&Object.defineProperty(k,P,W)}else k[P]=A[P];k.na=A.prototype}function p(){this.l=!1,this.i=null,this.h=void 0,this.g=1,this.u=this.o=0,this.j=null}function m(k){if(k.l)throw new TypeError("Generator is already running");k.l=!0}function g(k,A){k.j={da:A,ea:!0},k.g=k.o||k.u}function y(k,A,P){return k.g=P,{value:A}}function b(k){this.g=new p,this.h=k}function w(k,A,P,W){try{var Z=A.call(k.g.i,P);if(!(Z instanceof Object))throw new TypeError("Iterator result "+Z+" is not an object");if(!Z.done)return k.g.l=!1,Z;var X=Z.value}catch(Q){return k.g.i=null,g(k.g,Q),v(k)}return k.g.i=null,W.call(k.g,X),v(k)}function v(k){for(;k.g.g;)try{var A=k.h(k.g);if(A)return k.g.l=!1,{value:A.value,done:!1}}catch(P){k.g.h=void 0,g(k.g,P)}if(k.g.l=!1,k.g.j){if(A=k.g.j,k.g.j=null,A.ea)throw A.da;return{value:A.return,done:!0}}return{value:void 0,done:!0}}function S(k){this.next=function(A){return m(k.g),k.g.i?A=w(k,k.g.i.next,A,k.g.s):(k.g.s(A),A=v(k)),A},this.throw=function(A){return m(k.g),k.g.i?A=w(k,k.g.i.throw,A,k.g.s):(g(k.g,A),A=v(k)),A},this.return=function(A){return function(P,W){m(P.g);var Z=P.g.i;return Z?w(P,"return"in Z?Z.return:function(X){return{value:X,done:!0}},W,P.g.return):(P.g.return(W),v(P))}(k,A)},this[Symbol.iterator]=function(){return this}}function N(k){return function(A){function P(Z){return A.next(Z)}function W(Z){return A.throw(Z)}return new Promise(function(Z,X){(function Q(lt){lt.done?Z(lt.value):Promise.resolve(lt.value).then(P,W).then(Q,X)})(A.next())})}(new S(new b(k)))}p.prototype.s=function(k){this.h=k},p.prototype.return=function(k){this.j={return:k},this.g=this.u},r("Promise",function(k){function A(Q){this.h=0,this.i=void 0,this.g=[],this.s=!1;var lt=this.j();try{Q(lt.resolve,lt.reject)}catch(Tt){lt.reject(Tt)}}function P(){this.g=null}function W(Q){return Q instanceof A?Q:new A(function(lt){lt(Q)})}if(k)return k;P.prototype.h=function(Q){if(this.g==null){this.g=[];var lt=this;this.i(function(){lt.l()})}this.g.push(Q)};var Z=s.setTimeout;P.prototype.i=function(Q){Z(Q,0)},P.prototype.l=function(){for(;this.g&&this.g.length;){var Q=this.g;this.g=[];for(var lt=0;lt<Q.length;++lt){var Tt=Q[lt];Q[lt]=null;try{Tt()}catch(Ot){this.j(Ot)}}}this.g=null},P.prototype.j=function(Q){this.i(function(){throw Q})},A.prototype.j=function(){function Q(Ot){return function(Mt){Tt||(Tt=!0,Ot.call(lt,Mt))}}var lt=this,Tt=!1;return{resolve:Q(this.D),reject:Q(this.l)}},A.prototype.D=function(Q){if(Q===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(Q instanceof A)this.H(Q);else{t:switch(typeof Q){case"object":var lt=Q!=null;break t;case"function":lt=!0;break t;default:lt=!1}lt?this.A(Q):this.o(Q)}},A.prototype.A=function(Q){var lt=void 0;try{lt=Q.then}catch(Tt){return void this.l(Tt)}typeof lt=="function"?this.I(lt,Q):this.o(Q)},A.prototype.l=function(Q){this.u(2,Q)},A.prototype.o=function(Q){this.u(1,Q)},A.prototype.u=function(Q,lt){if(this.h!=0)throw Error("Cannot settle("+Q+", "+lt+"): Promise already settled in state"+this.h);this.h=Q,this.i=lt,this.h===2&&this.G(),this.B()},A.prototype.G=function(){var Q=this;Z(function(){if(Q.C()){var lt=s.console;lt!==void 0&&lt.error(Q.i)}},1)},A.prototype.C=function(){if(this.s)return!1;var Q=s.CustomEvent,lt=s.Event,Tt=s.dispatchEvent;return Tt===void 0||(typeof Q=="function"?Q=new Q("unhandledrejection",{cancelable:!0}):typeof lt=="function"?Q=new lt("unhandledrejection",{cancelable:!0}):(Q=s.document.createEvent("CustomEvent")).initCustomEvent("unhandledrejection",!1,!0,Q),Q.promise=this,Q.reason=this.i,Tt(Q))},A.prototype.B=function(){if(this.g!=null){for(var Q=0;Q<this.g.length;++Q)X.h(this.g[Q]);this.g=null}};var X=new P;return A.prototype.H=function(Q){var lt=this.j();Q.M(lt.resolve,lt.reject)},A.prototype.I=function(Q,lt){var Tt=this.j();try{Q.call(lt,Tt.resolve,Tt.reject)}catch(Ot){Tt.reject(Ot)}},A.prototype.then=function(Q,lt){function Tt(Zt,se){return typeof Zt=="function"?function(ke){try{Ot(Zt(ke))}catch(Re){Mt(Re)}}:se}var Ot,Mt,Yt=new A(function(Zt,se){Ot=Zt,Mt=se});return this.M(Tt(Q,Ot),Tt(lt,Mt)),Yt},A.prototype.catch=function(Q){return this.then(void 0,Q)},A.prototype.M=function(Q,lt){function Tt(){switch(Ot.h){case 1:Q(Ot.i);break;case 2:lt(Ot.i);break;default:throw Error("Unexpected state: "+Ot.h)}}var Ot=this;this.g==null?X.h(Tt):this.g.push(Tt),this.s=!0},A.resolve=W,A.reject=function(Q){return new A(function(lt,Tt){Tt(Q)})},A.race=function(Q){return new A(function(lt,Tt){for(var Ot=o(Q),Mt=Ot.next();!Mt.done;Mt=Ot.next())W(Mt.value).M(lt,Tt)})},A.all=function(Q){var lt=o(Q),Tt=lt.next();return Tt.done?W([]):new A(function(Ot,Mt){function Yt(ke){return function(Re){Zt[ke]=Re,--se==0&&Ot(Zt)}}var Zt=[],se=0;do Zt.push(void 0),se++,W(Tt.value).M(Yt(Zt.length-1),Mt),Tt=lt.next();while(!Tt.done)})},A});var R=typeof Object.assign=="function"?Object.assign:function(k,A){for(var P=1;P<arguments.length;P++){var W=arguments[P];if(W)for(var Z in W)Object.prototype.hasOwnProperty.call(W,Z)&&(k[Z]=W[Z])}return k};r("Object.assign",function(k){return k||R}),r("Object.is",function(k){return k||function(A,P){return A===P?A!==0||1/A==1/P:A!=A&&P!=P}}),r("Array.prototype.includes",function(k){return k||function(A,P){var W=this;W instanceof String&&(W=String(W));var Z=W.length;for(0>(P=P||0)&&(P=Math.max(P+Z,0));P<Z;P++){var X=W[P];if(X===A||Object.is(X,A))return!0}return!1}}),r("String.prototype.includes",function(k){return k||function(A,P){if(this==null)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(A instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return this.indexOf(A,P||0)!==-1}}),r("Array.prototype.keys",function(k){return k||function(){return function(A,P){A instanceof String&&(A+="");var W=0,Z=!1,X={next:function(){if(!Z&&W<A.length){var Q=W++;return{value:P(Q,A[Q]),done:!1}}return Z=!0,{done:!0,value:void 0}}};return X[Symbol.iterator]=function(){return X},X}(this,function(A){return A})}});var L=this||self;function F(k,A){k=k.split(".");var P,W=L;for((k[0]in W)||W.execScript===void 0||W.execScript("var "+k[0]);k.length&&(P=k.shift());)k.length||A===void 0?W=W[P]&&W[P]!==Object.prototype[P]?W[P]:W[P]={}:W[P]=A}function B(){throw Error("Invalid UTF8")}function H(k,A){return A=String.fromCharCode.apply(null,A),k==null?A:k+A}var z,G,T=typeof TextDecoder<"u",K=typeof TextEncoder<"u",ht={},rt=null;function gt(k){var A;A===void 0&&(A=0),It(),A=ht[A];for(var P=Array(Math.floor(k.length/3)),W=A[64]||"",Z=0,X=0;Z<k.length-2;Z+=3){var Q=k[Z],lt=k[Z+1],Tt=k[Z+2],Ot=A[Q>>2];Q=A[(3&Q)<<4|lt>>4],lt=A[(15&lt)<<2|Tt>>6],Tt=A[63&Tt],P[X++]=Ot+Q+lt+Tt}switch(Ot=0,Tt=W,k.length-Z){case 2:Tt=A[(15&(Ot=k[Z+1]))<<2]||W;case 1:k=k[Z],P[X]=A[k>>2]+A[(3&k)<<4|Ot>>4]+Tt+W}return P.join("")}function at(k){var A=k.length,P=3*A/4;P%3?P=Math.floor(P):"=.".indexOf(k[A-1])!=-1&&(P="=.".indexOf(k[A-2])!=-1?P-2:P-1);var W=new Uint8Array(P),Z=0;return function(X,Q){function lt(se){for(;Tt<X.length;){var ke=X.charAt(Tt++),Re=rt[ke];if(Re!=null)return Re;if(!/^[\s\xa0]*$/.test(ke))throw Error("Unknown base64 encoding at char: "+ke)}return se}It();for(var Tt=0;;){var Ot=lt(-1),Mt=lt(0),Yt=lt(64),Zt=lt(64);if(Zt===64&&Ot===-1)break;Q(Ot<<2|Mt>>4),Yt!=64&&(Q(Mt<<4&240|Yt>>2),Zt!=64&&Q(Yt<<6&192|Zt))}}(k,function(X){W[Z++]=X}),Z!==P?W.subarray(0,Z):W}function It(){if(!rt){rt={};for(var k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),A=["+/=","+/","-_=","-_.","-_"],P=0;5>P;P++){var W=k.concat(A[P].split(""));ht[P]=W;for(var Z=0;Z<W.length;Z++){var X=W[Z];rt[X]===void 0&&(rt[X]=Z)}}}}var et,st=typeof Uint8Array=="function";function St(k){return st&&k!=null&&k instanceof Uint8Array}function kt(k){if(this.L=k,k!==null&&k.length===0)throw Error("ByteString should be constructed with non-empty values")}var yt=typeof Uint8Array.prototype.slice=="function",Pt=0;function Xt(k,A){return Error("Invalid wire type: "+k+" (at position "+A+")")}function Wt(){return Error("Failed to read varint, encoding is invalid.")}function Bt(k,A){A=(A=A===void 0?{}:A).v!==void 0&&A.v,this.h=null,this.g=this.i=this.j=0,this.v=A,k&&Jt(this,k)}function Jt(k,A){k.h=function(P,W){if(P.constructor===Uint8Array)return P;if(P.constructor===ArrayBuffer)return new Uint8Array(P);if(P.constructor===Array)return new Uint8Array(P);if(P.constructor===String)return at(P);if(P.constructor===kt)return!W&&(W=P.L)&&W.constructor===Uint8Array?W:(W=(W=P.L)==null||St(W)?W:typeof W=="string"?at(W):null,(P=P.L=W)?new Uint8Array(P):et||(et=new Uint8Array(0)));if(P instanceof Uint8Array)return new Uint8Array(P.buffer,P.byteOffset,P.byteLength);throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, or Array of numbers")}(A,k.v),k.j=0,k.i=k.h.length,k.g=k.j}function jt(k){if(k.g>k.i)throw Error("Tried to read past the end of the data "+k.g+" > "+k.i)}function be(k){var A=k.h,P=A[k.g],W=127&P;if(128>P)return k.g+=1,jt(k),W;if(W|=(127&(P=A[k.g+1]))<<7,128>P)return k.g+=2,jt(k),W;if(W|=(127&(P=A[k.g+2]))<<14,128>P)return k.g+=3,jt(k),W;if(W|=(127&(P=A[k.g+3]))<<21,128>P)return k.g+=4,jt(k),W;if(P=A[k.g+4],k.g+=5,W|=(15&P)<<28,128>P)return jt(k),W;if(128<=A[k.g++]&&128<=A[k.g++]&&128<=A[k.g++]&&128<=A[k.g++]&&128<=A[k.g++])throw Wt();return jt(k),W}Bt.prototype.reset=function(){this.g=this.j};var ce=[];function O(){this.g=[]}function Nt(k,A){for(;127<A;)k.g.push(127&A|128),A>>>=7;k.g.push(A)}function xt(k){var A={},P=A.W!==void 0&&A.W;this.l={v:A.v!==void 0&&A.v},this.W=P,A=this.l,ce.length?(P=ce.pop(),A&&(P.v=A.v),k&&Jt(P,k),k=P):k=new Bt(k,A),this.g=k,this.j=this.g.g,this.h=this.i=-1}function q(k){var A=k.g;if(A.g==A.i)return!1;k.j=k.g.g;var P=be(k.g)>>>0;if(A=P>>>3,!(0<=(P&=7)&&5>=P))throw Xt(P,k.j);if(1>A)throw Error("Invalid field number: "+A+" (at position "+k.j+")");return k.i=A,k.h=P,!0}function j(k){switch(k.h){case 0:if(k.h!=0)j(k);else t:{for(var A=(k=k.g).g,P=A+10;A<P;)if(!(128&k.h[A++])){k.g=A,jt(k);break t}throw Wt()}break;case 1:(k=k.g).g+=8,jt(k);break;case 2:k.h!=2?j(k):(A=be(k.g)>>>0,(k=k.g).g+=A,jt(k));break;case 5:(k=k.g).g+=4,jt(k);break;case 3:for(A=k.i;;){if(!q(k))throw Error("Unmatched start-group tag: stream EOF");if(k.h==4){if(k.i!=A)throw Error("Unmatched end-group tag");break}j(k)}break;default:throw Xt(k.h,k.j)}}O.prototype.length=function(){return this.g.length},O.prototype.end=function(){var k=this.g;return this.g=[],k},xt.prototype.reset=function(){this.g.reset(),this.j=this.g.g,this.h=this.i=-1};var ft=[];function At(){this.i=[],this.h=0,this.g=new O}function Rt(k,A){A.length!==0&&(k.i.push(A),k.h+=A.length)}var bt=typeof Symbol=="function"&&typeof Symbol()=="symbol"?Symbol(void 0):void 0;function Ut(k,A){Object.isFrozen(k)||(bt?k[bt]|=A:k.N!==void 0?k.N|=A:Object.defineProperties(k,{N:{value:A,configurable:!0,writable:!0,enumerable:!1}}))}function qt(k){var A;return(A=bt?k[bt]:k.N)==null?0:A}function zt(k){return Ut(k,1),k}function ne(k){return!!Array.isArray(k)&&!!(2&qt(k))}function Te(k){if(!Array.isArray(k))throw Error("cannot mark non-array as immutable");Ut(k,2)}function me(k){return k!==null&&typeof k=="object"&&!Array.isArray(k)&&k.constructor===Object}var on=Object.freeze(zt([]));function ms(k){if(ne(k.m))throw Error("Cannot mutate an immutable Message")}var $n,Bs=typeof Symbol<"u"&&Symbol.hasInstance!==void 0;function We(k){return{value:k,configurable:!1,writable:!1,enumerable:!1}}function ln(k,A,P){return A===-1?null:A>=k.i?k.g?k.g[A]:void 0:P!==void 0&&P&&k.g&&(P=k.g[A])!=null?P:k.m[A+k.h]}function en(k,A,P,W){W=W!==void 0&&W,ms(k),A<k.i&&!W?k.m[A+k.h]=P:(k.g||(k.g=k.m[k.i+k.h]={}))[A]=P}function Ye(k,A,P,W){P=P===void 0||P;var Z=ln(k,A,W=W!==void 0&&W);return Z==null&&(Z=on),ne(k.m)?P&&(Te(Z),Object.freeze(Z)):(Z===on||ne(Z))&&en(k,A,Z=zt(Z.slice()),W),Z}function Fn(k,A,P){return(k=(k=ln(k,A))==null?k:+k)==null?P===void 0?0:P:k}function mr(k,A,P,W){k.j||(k.j={});var Z=ne(k.m),X=k.j[P];if(!X){W=Ye(k,P,!0,W!==void 0&&W),X=[],Z=Z||ne(W);for(var Q=0;Q<W.length;Q++)X[Q]=new A(W[Q]),Z&&Te(X[Q].m);Z&&(Te(X),Object.freeze(X)),k.j[P]=X}return X}function Ge(k,A,P,W,Z){var X=X!==void 0&&X;return ms(k),X=mr(k,P,A,X),P=W||new P,k=Ye(k,A),Z!=null?(X.splice(Z,0,P),k.splice(Z,0,P.m)):(X.push(P),k.push(P.m)),P}function Vs(k,A){return(k=ln(k,A))==null?0:k}function qr(k,A){return(k=ln(k,A))==null?"":k}function Xn(k){var A=_r;return Le(k,A=A===void 0?mi:A)}function _n(k,A){if(k!=null){if(Array.isArray(k))k=Le(k,A);else if(me(k)){var P,W={};for(P in k)W[P]=_n(k[P],A);k=W}else k=A(k);return k}}function Le(k,A){for(var P=k.slice(),W=0;W<P.length;W++)P[W]=_n(P[W],A);return Array.isArray(k)&&1&qt(k)&&zt(P),P}function _r(k){return k&&typeof k=="object"&&k.toJSON?k.toJSON():(k=function(A){switch(typeof A){case"number":return isFinite(A)?A:String(A);case"object":if(A&&!Array.isArray(A)){if(St(A))return gt(A);if(A instanceof kt){var P=A.L;return P=P==null||typeof P=="string"?P:st&&P instanceof Uint8Array?gt(P):null,(A.L=P)||""}}}return A}(k),Array.isArray(k)?Xn(k):k)}function mi(k){return St(k)?new Uint8Array(k):k}function gi(k,A,P){k||(k=$n),$n=null;var W=this.constructor.h;if(k||(k=W?[W]:[]),this.h=(W?0:-1)-(this.constructor.g||0),this.j=void 0,this.m=k,k=(W=this.m.length)-1,W&&me(W=this.m[k])?(this.i=k-this.h,this.g=W):A!==void 0&&-1<A?(this.i=Math.max(A,k+1-this.h),this.g=void 0):this.i=Number.MAX_VALUE,P)for(A=0;A<P.length;A++)if((k=P[A])<this.i)k+=this.h,(W=this.m[k])?Array.isArray(W)&&zt(W):this.m[k]=on;else{var Z=(W=this.g||(this.g=this.m[this.i+this.h]={}))[k];Z?Array.isArray(Z)&&zt(Z):W[k]=on}}function Ar(){gi.apply(this,arguments)}if(gi.prototype.toJSON=function(){return Xn(this.m)},gi.prototype.toString=function(){return this.m.toString()},f(Ar,gi),Bs){var Us={};Object.defineProperties(Ar,(Us[Symbol.hasInstance]=We(function(){throw Error("Cannot perform instanceof checks for MutableMessage")}),Us))}function wo(k,A,P){if(P){var W,Z={};for(W in P){var X=P[W],Q=X.ha;Q||(Z.F=X.la||X.fa.P,X.aa?(Z.U=Ws(X.aa),Q=function(lt){return function(Tt,Ot,Mt){return lt.F(Tt,Ot,Mt,lt.U)}}(Z)):X.ca?(Z.T=yi(X.X.g,X.ca),Q=function(lt){return function(Tt,Ot,Mt){return lt.F(Tt,Ot,Mt,lt.T)}}(Z)):Q=Z.F,X.ha=Q),Q(A,k,X.X),Z={F:Z.F,U:Z.U,T:Z.T}}}(function(lt,Tt){if(Tt=Tt.ba){Rt(lt,lt.g.end());for(var Ot=0;Ot<Tt.length;Ot++)Rt(lt,Tt[Ot])}})(A,k)}var Wn=Symbol();function Rr(k,A,P){return k[Wn]||(k[Wn]=function(W,Z){return A(W,Z,P)})}function Js(k){var A=k[Wn];if(!A){var P=wi(k);A=function(W,Z){return ji(W,Z,P)},k[Wn]=A}return A}function Xr(k){var A=function(Z){var X=Z.aa;return X?Js(X):(X=Z.ka)?Rr(Z.X.g,X,Z.ca):void 0}(k),P=k.X,W=k.fa.O;return A?function(Z,X){return W(Z,X,P,A)}:function(Z,X){return W(Z,X,P)}}function Ln(k,A,P,W,Z,X){var Q=0;for((k=k()).length&&typeof k[0]!="number"&&(P(A,k[0]),Q++);Q<k.length;){P=k[Q++];for(var lt=Q+1;lt<k.length&&typeof k[lt]!="number";)lt++;var Tt=k[Q++];switch(lt-=Q){case 0:W(A,P,Tt);break;case 1:W(A,P,Tt,k[Q++]);break;case 2:Z(A,P,Tt,k[Q++],k[Q++]);break;case 3:lt=k[Q++];var Ot=k[Q++],Mt=k[Q++];Array.isArray(Mt)?Z(A,P,Tt,lt,Ot,Mt):X(A,P,Tt,lt,Ot,Mt);break;case 4:X(A,P,Tt,k[Q++],k[Q++],k[Q++],k[Q++]);break;default:throw Error("unexpected number of binary field arguments: "+lt)}}return A}var Je=Symbol();function Ws(k){var A=k[Je];if(!A){var P=la(k);A=function(W,Z){return vo(W,Z,P)},k[Je]=A}return A}function yi(k,A){var P=k[Je];return P||(P=function(W,Z){return wo(W,Z,A)},k[Je]=P),P}var du=Symbol();function gr(k,A){k.push(A)}function ua(k,A,P){k.push(A,P.P)}function Gi(k,A,P,W,Z){var X=Ws(Z),Q=P.P;k.push(A,function(lt,Tt,Ot){return Q(lt,Tt,Ot,W,X)})}function bi(k,A,P,W,Z,X){var Q=yi(W,X),lt=P.P;k.push(A,function(Tt,Ot,Mt){return lt(Tt,Ot,Mt,W,Q)})}function la(k){var A=k[du];return A||Ln(k,k[du]=[],gr,ua,Gi,bi)}var xi=Symbol();function yr(k,A){k[0]=A}function fu(k,A,P,W){var Z=P.O;k[A]=W?function(X,Q,lt){return Z(X,Q,lt,W)}:Z}function Gs(k,A,P,W,Z,X){var Q=P.O,lt=Js(Z);k[A]=function(Tt,Ot,Mt){return Q(Tt,Ot,Mt,W,lt,X)}}function gs(k,A,P,W,Z,X,Q){var lt=P.O,Tt=Rr(W,Z,X);k[A]=function(Ot,Mt,Yt){return lt(Ot,Mt,Yt,W,Tt,Q)}}function wi(k){var A=k[xi];return A||Ln(k,k[xi]={},yr,fu,Gs,gs)}function ji(k,A,P){for(;q(A)&&A.h!=4;){var W=A.i,Z=P[W];if(!Z){var X=P[0];X&&(X=X[W])&&(Z=P[W]=Xr(X))}if(!(Z&&Z(A,k,W)||(Z=A,W=k,X=Z.j,j(Z),Z.W))){var Q=Z.g.h;Z=X===(Z=Z.g.g)?et||(et=new Uint8Array(0)):yt?Q.slice(X,Z):new Uint8Array(Q.subarray(X,Z)),(X=W.ba)?X.push(Z):W.ba=[Z]}}return k}function Hi(k,A,P){if(ft.length){var W=ft.pop();k&&(Jt(W.g,k),W.i=-1,W.h=-1),k=W}else k=new xt(k);try{return ji(new A,k,wi(P))}finally{(A=k.g).h=null,A.j=0,A.i=0,A.g=0,A.v=!1,k.i=-1,k.h=-1,100>ft.length&&ft.push(k)}}function vo(k,A,P){for(var W=P.length,Z=W%2==1,X=Z?1:0;X<W;X+=2)(0,P[X+1])(A,k,P[X]);wo(k,A,Z?P[0]:void 0)}function Yr(k,A){var P=new At;vo(k,P,la(A)),Rt(P,P.g.end()),k=new Uint8Array(P.h);for(var W=(A=P.i).length,Z=0,X=0;X<W;X++){var Q=A[X];k.set(Q,Z),Z+=Q.length}return P.i=[k],k}function Yn(k,A){return{O:k,P:A}}var Cs=Yn(function(k,A,P){if(k.h!==5)return!1;var W=(k=k.g).h[k.g],Z=k.h[k.g+1],X=k.h[k.g+2],Q=k.h[k.g+3];return k.g+=4,jt(k),k=2*((Z=(W<<0|Z<<8|X<<16|Q<<24)>>>0)>>31)+1,W=Z>>>23&255,Z&=8388607,en(A,P,W==255?Z?NaN:1/0*k:W==0?k*Math.pow(2,-149)*Z:k*Math.pow(2,W-150)*(Z+Math.pow(2,23))),!0},function(k,A,P){if((A=ln(A,P))!=null){Nt(k.g,8*P+5),k=k.g;var W=A;(W=(P=0>W?1:0)?-W:W)===0?0<1/W?Pt=0:Pt=2147483648:isNaN(W)?Pt=2147483647:34028234663852886e22<W?Pt=(P<<31|2139095040)>>>0:11754943508222875e-54>W?(W=Math.round(W/Math.pow(2,-149)),Pt=(P<<31|W)>>>0):(A=Math.floor(Math.log(W)/Math.LN2),W*=Math.pow(2,-A),16777216<=(W=Math.round(8388608*W))&&++A,Pt=(P<<31|A+127<<23|8388607&W)>>>0),P=Pt,k.g.push(P>>>0&255),k.g.push(P>>>8&255),k.g.push(P>>>16&255),k.g.push(P>>>24&255)}}),ko=Yn(function(k,A,P){if(k.h!==0)return!1;for(var W=k.g,Z=128,X=0,Q=k=0;4>Q&&128<=Z;Q++)Z=W.h[W.g++],jt(W),X|=(127&Z)<<7*Q;if(128<=Z&&(Z=W.h[W.g++],jt(W),X|=(127&Z)<<28,k|=(127&Z)>>4),128<=Z)for(Q=0;5>Q&&128<=Z;Q++)Z=W.h[W.g++],jt(W),k|=(127&Z)<<7*Q+3;if(!(128>Z))throw Wt();return W=X>>>0,(k=2147483648&(Z=k>>>0))&&(Z=~Z>>>0,(W=1+~W>>>0)==0&&(Z=Z+1>>>0)),W=4294967296*Z+(W>>>0),en(A,P,k?-W:W),!0},function(k,A,P){if((A=ln(A,P))!=null&&A!=null){Nt(k.g,8*P),k=k.g;var W=A;for(P=0>W,A=(W=Math.abs(W))>>>0,W=Math.floor((W-A)/4294967296),W>>>=0,P&&(W=~W>>>0,4294967295<(A=1+(~A>>>0))&&(A=0,4294967295<++W&&(W=0))),P=Pt=A,A=W;0<A||127<P;)k.g.push(127&P|128),P=(P>>>7|A<<25)>>>0,A>>>=7;k.g.push(P)}}),Qs=Yn(function(k,A,P){return k.h===0&&(en(A,P,be(k.g)),!0)},function(k,A,P){if((A=ln(A,P))!=null&&A!=null)if(Nt(k.g,8*P),k=k.g,0<=(P=A))Nt(k,P);else{for(A=0;9>A;A++)k.g.push(127&P|128),P>>=7;k.g.push(1)}}),Ki=Yn(function(k,A,P){if(k.h!==2)return!1;var W,Z=be(k.g)>>>0,X=(k=k.g).g;if(k.g+=Z,jt(k),k=k.h,T)(W=z)||(W=z=new TextDecoder("utf-8",{fatal:!0})),W=W.decode(k.subarray(X,X+Z));else{Z=X+Z;for(var Q,lt,Tt,Ot=[],Mt=null;X<Z;)128>(Q=k[X++])?Ot.push(Q):224>Q?X>=Z?B():(lt=k[X++],194>Q||(192&lt)!=128?(X--,B()):Ot.push((31&Q)<<6|63&lt)):240>Q?X>=Z-1?B():(192&(lt=k[X++]))!=128||Q===224&&160>lt||Q===237&&160<=lt||(192&(W=k[X++]))!=128?(X--,B()):Ot.push((15&Q)<<12|(63&lt)<<6|63&W):244>=Q?X>=Z-2?B():(192&(lt=k[X++]))!=128||lt-144+(Q<<28)>>30||(192&(W=k[X++]))!=128||(192&(Tt=k[X++]))!=128?(X--,B()):(Q=(7&Q)<<18|(63&lt)<<12|(63&W)<<6|63&Tt,Q-=65536,Ot.push(55296+(Q>>10&1023),56320+(1023&Q))):B(),8192<=Ot.length&&(Mt=H(Mt,Ot),Ot.length=0);W=H(Mt,Ot)}return en(A,P,W),!0},function(k,A,P){if((A=ln(A,P))!=null){var W=!1;if(W=W!==void 0&&W,K){if(W&&/(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])/.test(A))throw Error("Found an unpaired surrogate");A=(G||(G=new TextEncoder)).encode(A)}else{for(var Z=0,X=new Uint8Array(3*A.length),Q=0;Q<A.length;Q++){var lt=A.charCodeAt(Q);if(128>lt)X[Z++]=lt;else{if(2048>lt)X[Z++]=lt>>6|192;else{if(55296<=lt&&57343>=lt){if(56319>=lt&&Q<A.length){var Tt=A.charCodeAt(++Q);if(56320<=Tt&&57343>=Tt){lt=1024*(lt-55296)+Tt-56320+65536,X[Z++]=lt>>18|240,X[Z++]=lt>>12&63|128,X[Z++]=lt>>6&63|128,X[Z++]=63&lt|128;continue}Q--}if(W)throw Error("Found an unpaired surrogate");lt=65533}X[Z++]=lt>>12|224,X[Z++]=lt>>6&63|128}X[Z++]=63&lt|128}}A=X.subarray(0,Z)}Nt(k.g,8*P+2),Nt(k.g,A.length),Rt(k,k.g.end()),Rt(k,A)}}),ca=Yn(function(k,A,P,W,Z){if(k.h!==2)return!1;A=Ge(A,P,W),P=k.g.i,W=be(k.g)>>>0;var X=k.g.g+W,Q=X-P;if(0>=Q&&(k.g.i=X,Z(A,k),Q=X-k.g.g),Q)throw Error("Message parsing ended unexpectedly. Expected to read "+W+" bytes, instead read "+(W-Q)+" bytes, either the data ended unexpectedly or the message misreported its own length");return k.g.g=X,k.g.i=P,!0},function(k,A,P,W,Z){if((A=mr(A,W,P))!=null)for(W=0;W<A.length;W++){var X=k;Nt(X.g,8*P+2);var Q=X.g.end();Rt(X,Q),Q.push(X.h),X=Q,Z(A[W],k),Q=k;var lt=X.pop();for(lt=Q.h+Q.g.length()-lt;127<lt;)X.push(127&lt|128),lt>>>=7,Q.h++;X.push(lt),Q.h++}});function ys(){Ar.apply(this,arguments)}if(f(ys,Ar),Bs){var So={};Object.defineProperties(ys,(So[Symbol.hasInstance]=We(Object[Symbol.hasInstance]),So))}function Zr(k){ys.call(this,k)}function pu(){return[1,Qs,2,Cs,3,Ki,4,Ki]}function Io(k){ys.call(this,k,-1,gu)}function mu(){return[1,ca,Zr,pu]}f(Zr,ys),f(Io,ys),Io.prototype.addClassification=function(k,A){return Ge(this,1,Zr,k,A),this};var gu=[1];function Jr(k){ys.call(this,k)}function Zn(){return[1,Cs,2,Cs,3,Cs,4,Cs,5,Cs]}function ha(k){ys.call(this,k,-1,Co)}function yu(){return[1,ca,Jr,Zn]}f(Jr,ys),f(ha,ys);var Co=[1];function No(k){ys.call(this,k)}function To(){return[1,Cs,2,Cs,3,Cs,4,Cs,5,Cs,6,ko]}f(No,ys);var da=[[61,146],[146,91],[91,181],[181,84],[84,17],[17,314],[314,405],[405,321],[321,375],[375,291],[61,185],[185,40],[40,39],[39,37],[37,0],[0,267],[267,269],[269,270],[270,409],[409,291],[78,95],[95,88],[88,178],[178,87],[87,14],[14,317],[317,402],[402,318],[318,324],[324,308],[78,191],[191,80],[80,81],[81,82],[82,13],[13,312],[312,311],[311,310],[310,415],[415,308]],fa=[[263,249],[249,390],[390,373],[373,374],[374,380],[380,381],[381,382],[382,362],[263,466],[466,388],[388,387],[387,386],[386,385],[385,384],[384,398],[398,362]],$o=[[276,283],[283,282],[282,295],[295,285],[300,293],[293,334],[334,296],[296,336]],Eo=[[33,7],[7,163],[163,144],[144,145],[145,153],[153,154],[154,155],[155,133],[33,246],[246,161],[161,160],[160,159],[159,158],[158,157],[157,173],[173,133]],vi=[[46,53],[53,52],[52,65],[65,55],[70,63],[63,105],[105,66],[66,107]],pa=[[10,338],[338,297],[297,332],[332,284],[284,251],[251,389],[389,356],[356,454],[454,323],[323,361],[361,288],[288,397],[397,365],[365,379],[379,378],[378,400],[400,377],[377,152],[152,148],[148,176],[176,149],[149,150],[150,136],[136,172],[172,58],[58,132],[132,93],[93,234],[234,127],[127,162],[162,21],[21,54],[54,103],[103,67],[67,109],[109,10]],ma=[].concat(a(da),a(fa),a($o),a(Eo),a(vi),a(pa));function I(k,A,P){if(P=k.createShader(P===0?k.VERTEX_SHADER:k.FRAGMENT_SHADER),k.shaderSource(P,A),k.compileShader(P),!k.getShaderParameter(P,k.COMPILE_STATUS))throw Error(`Could not compile WebGL shader.

`+k.getShaderInfoLog(P));return P}function $(k){return mr(k,Zr,1).map(function(A){return{index:Vs(A,1),ga:Fn(A,2),label:ln(A,3)!=null?qr(A,3):void 0,displayName:ln(A,4)!=null?qr(A,4):void 0}})}function D(k){return{x:Fn(k,1),y:Fn(k,2),z:Fn(k,3),visibility:ln(k,4)!=null?Fn(k,4):void 0}}function J(k,A){this.h=k,this.g=A,this.l=0}function wt(k,A,P){return function(W,Z){var X=W.g;if(W.o===void 0){var Q=I(X,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,0),lt=I(X,`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D sampler0;
  void main(){
    gl_FragColor = texture2D(sampler0, vTex);
  }`,1),Tt=X.createProgram();if(X.attachShader(Tt,Q),X.attachShader(Tt,lt),X.linkProgram(Tt),!X.getProgramParameter(Tt,X.LINK_STATUS))throw Error(`Could not compile WebGL program.

`+X.getProgramInfoLog(Tt));Q=W.o=Tt,X.useProgram(Q),lt=X.getUniformLocation(Q,"sampler0"),W.j={K:X.getAttribLocation(Q,"aVertex"),J:X.getAttribLocation(Q,"aTex"),ma:lt},W.u=X.createBuffer(),X.bindBuffer(X.ARRAY_BUFFER,W.u),X.enableVertexAttribArray(W.j.K),X.vertexAttribPointer(W.j.K,2,X.FLOAT,!1,0,0),X.bufferData(X.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),X.STATIC_DRAW),X.bindBuffer(X.ARRAY_BUFFER,null),W.s=X.createBuffer(),X.bindBuffer(X.ARRAY_BUFFER,W.s),X.enableVertexAttribArray(W.j.J),X.vertexAttribPointer(W.j.J,2,X.FLOAT,!1,0,0),X.bufferData(X.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),X.STATIC_DRAW),X.bindBuffer(X.ARRAY_BUFFER,null),X.uniform1i(lt,0)}Q=W.j,X.useProgram(W.o),X.canvas.width=Z.width,X.canvas.height=Z.height,X.viewport(0,0,Z.width,Z.height),X.activeTexture(X.TEXTURE0),W.h.bindTexture2d(Z.glName),X.enableVertexAttribArray(Q.K),X.bindBuffer(X.ARRAY_BUFFER,W.u),X.vertexAttribPointer(Q.K,2,X.FLOAT,!1,0,0),X.enableVertexAttribArray(Q.J),X.bindBuffer(X.ARRAY_BUFFER,W.s),X.vertexAttribPointer(Q.J,2,X.FLOAT,!1,0,0),X.bindFramebuffer(X.DRAW_FRAMEBUFFER?X.DRAW_FRAMEBUFFER:X.FRAMEBUFFER,null),X.clearColor(0,0,0,0),X.clear(X.COLOR_BUFFER_BIT),X.colorMask(!0,!0,!0,!0),X.drawArrays(X.TRIANGLE_FAN,0,4),X.disableVertexAttribArray(Q.K),X.disableVertexAttribArray(Q.J),X.bindBuffer(X.ARRAY_BUFFER,null),W.h.bindTexture2d(0)}(k,A),typeof k.g.canvas.transferToImageBitmap=="function"?Promise.resolve(k.g.canvas.transferToImageBitmap()):P?Promise.resolve(k.g.canvas):typeof createImageBitmap=="function"?createImageBitmap(k.g.canvas):(k.i===void 0&&(k.i=document.createElement("canvas")),new Promise(function(W){k.i.height=k.g.canvas.height,k.i.width=k.g.canvas.width,k.i.getContext("2d",{}).drawImage(k.g.canvas,0,0,k.g.canvas.width,k.g.canvas.height),W(k.i)}))}function Dt(k){this.g=k}var Ct=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function Ft(k,A){return A+k}function Ht(k,A){window[k]=A}function ae(k){if(this.g=k,this.listeners={},this.j={},this.H={},this.o={},this.u={},this.I=this.s=this.Z=!0,this.D=Promise.resolve(),this.Y="",this.C={},this.locateFile=k&&k.locateFile||Ft,typeof window=="object")var A=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else{if(typeof location>"u")throw Error("solutions can only be loaded on a web page or in a web worker");A=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/"}if(this.$=A,k.options)for(var P=(A=o(Object.keys(k.options))).next();!P.done;P=A.next()){P=P.value;var W=k.options[P].default;W!==void 0&&(this.j[P]=typeof W=="function"?W():W)}}function ve(k){var A,P,W,Z,X,Q,lt,Tt,Ot,Mt,Yt;return N(function(Zt){switch(Zt.g){case 1:return k.Z?(A=k.g.files===void 0?[]:typeof k.g.files=="function"?k.g.files(k.j):k.g.files,y(Zt,N(function(se){switch(se.g){case 1:return se.o=2,y(se,WebAssembly.instantiate(Ct),4);case 4:se.g=3,se.o=0;break;case 2:return se.o=0,se.j=null,se.return(!1);case 3:return se.return(!0)}}),2)):Zt.return();case 2:if(P=Zt.h,typeof window=="object")return Ht("createMediapipeSolutionsWasm",{locateFile:k.locateFile}),Ht("createMediapipeSolutionsPackedAssets",{locateFile:k.locateFile}),Q=A.filter(function(se){return se.data!==void 0}),lt=A.filter(function(se){return se.data===void 0}),Tt=Promise.all(Q.map(function(se){var ke=ze(k,se.url);if(se.path!==void 0){var Re=se.path;ke=ke.then(function(sn){return k.overrideFile(Re,sn),Promise.resolve(sn)})}return ke})),Ot=Promise.all(lt.map(function(se){return se.simd===void 0||se.simd&&P||!se.simd&&!P?function(ke){var Re=document.createElement("script");return Re.setAttribute("src",ke),Re.setAttribute("crossorigin","anonymous"),new Promise(function(sn){Re.addEventListener("load",function(){sn()},!1),Re.addEventListener("error",function(){sn()},!1),document.body.appendChild(Re)})}(k.locateFile(se.url,k.$)):Promise.resolve()})).then(function(){var se,ke,Re;return N(function(sn){if(sn.g==1)return se=window.createMediapipeSolutionsWasm,ke=window.createMediapipeSolutionsPackedAssets,Re=k,y(sn,se(ke),2);Re.h=sn.h,sn.g=0})}),Mt=N(function(se){return k.g.graph&&k.g.graph.url?se=y(se,ze(k,k.g.graph.url),0):(se.g=0,se=void 0),se}),y(Zt,Promise.all([Ot,Tt,Mt]),7);if(typeof importScripts!="function")throw Error("solutions can only be loaded on a web page or in a web worker");return W=A.filter(function(se){return se.simd===void 0||se.simd&&P||!se.simd&&!P}).map(function(se){return k.locateFile(se.url,k.$)}),importScripts.apply(null,a(W)),Z=k,y(Zt,createMediapipeSolutionsWasm(Module),6);case 6:Z.h=Zt.h,k.l=new OffscreenCanvas(1,1),k.h.canvas=k.l,X=k.h.GL.createContext(k.l,{antialias:!1,alpha:!1,ja:typeof WebGL2RenderingContext<"u"?2:1}),k.h.GL.makeContextCurrent(X),Zt.g=4;break;case 7:if(k.l=document.createElement("canvas"),!(Yt=k.l.getContext("webgl2",{}))&&!(Yt=k.l.getContext("webgl",{})))return alert("Failed to create WebGL canvas context when passing video frame."),Zt.return();k.G=Yt,k.h.canvas=k.l,k.h.createContext(k.l,!0,!0,{});case 4:k.i=new k.h.SolutionWasm,k.Z=!1,Zt.g=0}})}function ze(k,A){var P,W;return N(function(Z){return A in k.H?Z.return(k.H[A]):(P=k.locateFile(A,""),W=fetch(P).then(function(X){return X.arrayBuffer()}),k.H[A]=W,Z.return(W))})}function Ae(k,A,P){var W,Z,X,Q,lt,Tt,Ot,Mt,Yt,Zt,se,ke,Re,sn;return N(function(nn){switch(nn.g){case 1:if(!P)return nn.return(A);for(W={},Z=0,X=o(Object.keys(P)),Q=X.next();!Q.done;Q=X.next())lt=Q.value,typeof(Tt=P[lt])!="string"&&Tt.type==="texture"&&A[Tt.stream]!==void 0&&++Z;1<Z&&(k.I=!1),Ot=o(Object.keys(P)),Q=Ot.next();case 2:if(Q.done){nn.g=4;break}if(Mt=Q.value,typeof(Yt=P[Mt])=="string")return Re=W,sn=Mt,y(nn,function(ki,Id,_o){var bu;return N(function(ec){return typeof _o=="number"||_o instanceof Uint8Array||_o instanceof ki.h.Uint8BlobList?ec.return(_o):_o instanceof ki.h.Texture2dDataOut?((bu=ki.u[Id])||(bu=new J(ki.h,ki.G),ki.u[Id]=bu),ec.return(wt(bu,_o,ki.I))):ec.return(void 0)})}(k,Mt,A[Yt]),14);if(Zt=A[Yt.stream],Yt.type==="detection_list"){if(Zt){for(var os=Zt.getRectList(),tr=Zt.getLandmarksList(),bs=Zt.getClassificationsList(),Ze=[],Jn=0;Jn<os.size();++Jn){var Dr=Hi(os.get(Jn),No,To);Dr={boundingBox:{xCenter:Fn(Dr,1),yCenter:Fn(Dr,2),height:Fn(Dr,3),width:Fn(Dr,4),rotation:Fn(Dr,5,0),rectId:Vs(Dr,6)},landmarks:mr(Hi(tr.get(Jn),ha,yu),Jr,1).map(D),V:$(Hi(bs.get(Jn),Io,mu))},Ze.push(Dr)}os=Ze}else os=[];W[Mt]=os,nn.g=7;break}if(Yt.type==="proto_list"){if(Zt){for(os=Array(Zt.size()),tr=0;tr<Zt.size();tr++)os[tr]=Zt.get(tr);Zt.delete()}else os=[];W[Mt]=os,nn.g=7;break}if(Zt===void 0){nn.g=3;break}if(Yt.type==="float_list"){W[Mt]=Zt,nn.g=7;break}if(Yt.type==="proto"){W[Mt]=Zt,nn.g=7;break}if(Yt.type!=="texture")throw Error("Unknown output config type: '"+Yt.type+"'");return(se=k.u[Mt])||(se=new J(k.h,k.G),k.u[Mt]=se),y(nn,wt(se,Zt,k.I),13);case 13:ke=nn.h,W[Mt]=ke;case 7:Yt.transform&&W[Mt]&&(W[Mt]=Yt.transform(W[Mt])),nn.g=3;break;case 14:Re[sn]=nn.h;case 3:Q=Ot.next(),nn.g=2;break;case 4:return nn.return(W)}})}function Ie(k,A){for(var P=A.name||"$",W=[].concat(a(A.wants)),Z=new k.h.StringList,X=o(A.wants),Q=X.next();!Q.done;Q=X.next())Z.push_back(Q.value);X=k.h.PacketListener.implement({onResults:function(lt){for(var Tt={},Ot=0;Ot<A.wants.length;++Ot)Tt[W[Ot]]=lt.get(Ot);var Mt=k.listeners[P];Mt&&(k.D=Ae(k,Tt,A.outs).then(function(Yt){Yt=Mt(Yt);for(var Zt=0;Zt<A.wants.length;++Zt){var se=Tt[W[Zt]];typeof se=="object"&&se.hasOwnProperty&&se.hasOwnProperty("delete")&&se.delete()}Yt&&(k.D=Yt)}))}}),k.i.attachMultiListener(Z,X),Z.delete()}function le(k){var A=this;k=k||{};var P={url:"face_detection_short.binarypb"},W={type:1,graphOptionXref:{calculatorType:"TensorsToDetectionsCalculator",calculatorName:"facedetectionshortrangegpu__facedetectionshortrangecommon__TensorsToDetectionsCalculator",fieldName:"min_score_thresh"}};this.g=new ae({locateFile:k.locateFile,files:[{data:!0,url:"face_detection_short.binarypb"},{data:!0,url:"face_detection_short_range.tflite"},{simd:!0,url:"face_detection_solution_simd_wasm_bin.js"},{simd:!1,url:"face_detection_solution_wasm_bin.js"}],graph:P,listeners:[{wants:["detections","image_transformed"],outs:{image:"image_transformed",detections:{type:"detection_list",stream:"detections"}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:typeof window=="object"&&window.navigator!==void 0&&("iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document)},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},model:{type:0,onChange:function(Z){var X,Q,lt,Tt,Ot;return N(function(Mt){switch(Mt.g){case 1:X=o(Z==="short"?["face_detection_short_range.tflite"]:["face_detection_full_range_sparse.tflite"]),Q=X.next();case 2:if(Q.done){Mt.g=4;break}return lt=Q.value,Tt="third_party/mediapipe/modules/face_detection/"+lt,y(Mt,ze(A.g,lt),5);case 5:Ot=Mt.h,A.g.overrideFile(Tt,Ot),Q=X.next(),Mt.g=2;break;case 4:return P.url=Z==="short"?"face_detection_short.binarypb":"face_detection_full.binarypb",W.graphOptionXref.calculatorName=Z==="short"?"facedetectionshortrangegpu__facedetectionshortrangecommon__TensorsToDetectionsCalculator":"facedetectionfullrangegpu__facedetectionfullrangecommon__TensorsToDetectionsCalculator",Mt.return(!0)}})}},minDetectionConfidence:W}})}(n=ae.prototype).close=function(){return this.i&&this.i.delete(),Promise.resolve()},n.reset=function(){var k=this;return N(function(A){k.i&&(k.i.reset(),k.o={},k.u={}),A.g=0})},n.setOptions=function(k,A){var P=this;if(A=A||this.g.options){for(var W=[],Z=[],X={},Q=o(Object.keys(k)),lt=Q.next();!lt.done;X={R:X.R,S:X.S},lt=Q.next()){var Tt=lt.value;Tt in this.j&&this.j[Tt]===k[Tt]||(this.j[Tt]=k[Tt],(lt=A[Tt])!==void 0&&(lt.onChange&&(X.R=lt.onChange,X.S=k[Tt],W.push(function(Ot){return function(){return N(function(Mt){if(Mt.g==1)return y(Mt,Ot.R(Ot.S),2);Mt.h===!0&&(P.s=!0),Mt.g=0})}}(X))),lt.graphOptionXref&&(Tt={valueNumber:lt.type===1?k[Tt]:0,valueBoolean:lt.type===0&&k[Tt],valueString:lt.type===2?k[Tt]:""},lt=Object.assign(Object.assign(Object.assign({},{calculatorName:"",calculatorIndex:0}),lt.graphOptionXref),Tt),Z.push(lt))))}W.length===0&&Z.length===0||(this.s=!0,this.B=(this.B===void 0?[]:this.B).concat(Z),this.A=(this.A===void 0?[]:this.A).concat(W))}},n.initialize=function(){var k=this;return N(function(A){return A.g==1?y(A,ve(k),2):A.g!=3?y(A,function(P){var W,Z,X,Q,lt,Tt,Ot,Mt;return N(function(Yt){if(Yt.g==1)return P.g.graph&&P.g.graph.url&&P.Y===P.g.graph.url?Yt.return():(P.s=!0,P.g.graph&&P.g.graph.url?(P.Y=P.g.graph.url,y(Yt,ze(P,P.g.graph.url),3)):void(Yt.g=2));for(Yt.g!=2&&(W=Yt.h,P.i.loadGraph(W)),Z=o(Object.keys(P.C)),X=Z.next();!X.done;X=Z.next())Q=X.value,P.i.overrideFile(Q,P.C[Q]);if(P.C={},P.g.listeners)for(lt=o(P.g.listeners),Tt=lt.next();!Tt.done;Tt=lt.next())Ot=Tt.value,Ie(P,Ot);Mt=P.j,P.j={},P.setOptions(Mt),Yt.g=0})}(k),3):y(A,function(P){var W,Z,X,Q,lt,Tt;return N(function(Ot){switch(Ot.g){case 1:if(!P.s)return Ot.return();if(!P.A){Ot.g=2;break}W=o(P.A),Z=W.next();case 3:if(Z.done){Ot.g=5;break}return y(Ot,(0,Z.value)(),4);case 4:Z=W.next(),Ot.g=3;break;case 5:P.A=void 0;case 2:if(P.B){for(X=new P.h.GraphOptionChangeRequestList,Q=o(P.B),lt=Q.next();!lt.done;lt=Q.next())Tt=lt.value,X.push_back(Tt);P.i.changeOptions(X),X.delete(),P.B=void 0}P.s=!1,Ot.g=0}})}(k),0)})},n.overrideFile=function(k,A){this.i?this.i.overrideFile(k,A):this.C[k]=A},n.clearOverriddenFiles=function(){this.C={},this.i&&this.i.clearOverriddenFiles()},n.send=function(k,A){var P,W,Z,X,Q,lt,Tt,Ot,Mt,Yt=this;return N(function(Zt){switch(Zt.g){case 1:return Yt.g.inputs?(P=1e3*(A??performance.now()),y(Zt,Yt.D,2)):Zt.return();case 2:return y(Zt,Yt.initialize(),3);case 3:for(W=new Yt.h.PacketDataList,Z=o(Object.keys(k)),X=Z.next();!X.done;X=Z.next())if(Q=X.value,lt=Yt.g.inputs[Q]){t:{var se=k[Q];switch(lt.type){case"video":var ke=Yt.o[lt.stream];if(ke||(ke=new J(Yt.h,Yt.G),Yt.o[lt.stream]=ke),ke.l===0&&(ke.l=ke.h.createTexture()),typeof HTMLVideoElement<"u"&&se instanceof HTMLVideoElement)var Re=se.videoWidth,sn=se.videoHeight;else typeof HTMLImageElement<"u"&&se instanceof HTMLImageElement?(Re=se.naturalWidth,sn=se.naturalHeight):(Re=se.width,sn=se.height);sn={glName:ke.l,width:Re,height:sn},(Re=ke.g).canvas.width=sn.width,Re.canvas.height=sn.height,Re.activeTexture(Re.TEXTURE0),ke.h.bindTexture2d(ke.l),Re.texImage2D(Re.TEXTURE_2D,0,Re.RGBA,Re.RGBA,Re.UNSIGNED_BYTE,se),ke.h.bindTexture2d(0),ke=sn;break t;case"detections":for((ke=Yt.o[lt.stream])||(ke=new Dt(Yt.h),Yt.o[lt.stream]=ke),ke.data||(ke.data=new ke.g.DetectionListData),ke.data.reset(se.length),sn=0;sn<se.length;++sn){Re=se[sn];var nn=ke.data,os=nn.setBoundingBox,tr=sn,bs=Re.boundingBox,Ze=new No;if(en(Ze,1,bs.xCenter),en(Ze,2,bs.yCenter),en(Ze,3,bs.height),en(Ze,4,bs.width),en(Ze,5,bs.rotation),en(Ze,6,bs.rectId),bs=Yr(Ze,To),os.call(nn,tr,bs),Re.landmarks)for(nn=0;nn<Re.landmarks.length;++nn){var Jn=!!(Ze=Re.landmarks[nn]).visibility;tr=(os=ke.data).addNormalizedLandmark,bs=sn,Ze=Object.assign(Object.assign({},Ze),{visibility:Jn?Ze.visibility:0}),en(Jn=new Jr,1,Ze.x),en(Jn,2,Ze.y),en(Jn,3,Ze.z),Ze.visibility&&en(Jn,4,Ze.visibility),Ze=Yr(Jn,Zn),tr.call(os,bs,Ze)}if(Re.V)for(nn=0;nn<Re.V.length;++nn)tr=(os=ke.data).addClassification,bs=sn,Ze=Re.V[nn],en(Jn=new Zr,2,Ze.ga),Ze.index&&en(Jn,1,Ze.index),Ze.label&&en(Jn,3,Ze.label),Ze.displayName&&en(Jn,4,Ze.displayName),Ze=Yr(Jn,pu),tr.call(os,bs,Ze)}ke=ke.data;break t;default:ke={}}}switch(Tt=ke,Ot=lt.stream,lt.type){case"video":W.pushTexture2d(Object.assign(Object.assign({},Tt),{stream:Ot,timestamp:P}));break;case"detections":(Mt=Tt).stream=Ot,Mt.timestamp=P,W.pushDetectionList(Mt);break;default:throw Error("Unknown input config type: '"+lt.type+"'")}}return Yt.i.send(W),y(Zt,Yt.D,4);case 4:W.delete(),Zt.g=0}})},n.onResults=function(k,A){this.listeners[A||"$"]=k},F("Solution",ae),F("OptionType",{BOOL:0,NUMBER:1,ia:2,0:"BOOL",1:"NUMBER",2:"STRING"}),(n=le.prototype).close=function(){return this.g.close(),Promise.resolve()},n.onResults=function(k){this.g.onResults(k)},n.initialize=function(){var k=this;return N(function(A){return y(A,k.g.initialize(),0)})},n.reset=function(){this.g.reset()},n.send=function(k){var A=this;return N(function(P){return y(P,A.g.send(k),0)})},n.setOptions=function(k){this.g.setOptions(k)},F("FaceDetection",le),F("FACEDETECTION_LIPS",da),F("FACEDETECTION_LEFT_EYE",fa),F("FACEDETECTION_LEFT_EYEBROW",$o),F("FACEDETECTION_RIGHT_EYE",Eo),F("FACEDETECTION_RIGHT_EYEBROW",vi),F("FACEDETECTION_FACE_OVAL",pa),F("FACEDETECTION_CONTOURS",ma),F("FACEDETECTION_TESSELATION",[[127,34],[34,139],[139,127],[11,0],[0,37],[37,11],[232,231],[231,120],[120,232],[72,37],[37,39],[39,72],[128,121],[121,47],[47,128],[232,121],[121,128],[128,232],[104,69],[69,67],[67,104],[175,171],[171,148],[148,175],[118,50],[50,101],[101,118],[73,39],[39,40],[40,73],[9,151],[151,108],[108,9],[48,115],[115,131],[131,48],[194,204],[204,211],[211,194],[74,40],[40,185],[185,74],[80,42],[42,183],[183,80],[40,92],[92,186],[186,40],[230,229],[229,118],[118,230],[202,212],[212,214],[214,202],[83,18],[18,17],[17,83],[76,61],[61,146],[146,76],[160,29],[29,30],[30,160],[56,157],[157,173],[173,56],[106,204],[204,194],[194,106],[135,214],[214,192],[192,135],[203,165],[165,98],[98,203],[21,71],[71,68],[68,21],[51,45],[45,4],[4,51],[144,24],[24,23],[23,144],[77,146],[146,91],[91,77],[205,50],[50,187],[187,205],[201,200],[200,18],[18,201],[91,106],[106,182],[182,91],[90,91],[91,181],[181,90],[85,84],[84,17],[17,85],[206,203],[203,36],[36,206],[148,171],[171,140],[140,148],[92,40],[40,39],[39,92],[193,189],[189,244],[244,193],[159,158],[158,28],[28,159],[247,246],[246,161],[161,247],[236,3],[3,196],[196,236],[54,68],[68,104],[104,54],[193,168],[168,8],[8,193],[117,228],[228,31],[31,117],[189,193],[193,55],[55,189],[98,97],[97,99],[99,98],[126,47],[47,100],[100,126],[166,79],[79,218],[218,166],[155,154],[154,26],[26,155],[209,49],[49,131],[131,209],[135,136],[136,150],[150,135],[47,126],[126,217],[217,47],[223,52],[52,53],[53,223],[45,51],[51,134],[134,45],[211,170],[170,140],[140,211],[67,69],[69,108],[108,67],[43,106],[106,91],[91,43],[230,119],[119,120],[120,230],[226,130],[130,247],[247,226],[63,53],[53,52],[52,63],[238,20],[20,242],[242,238],[46,70],[70,156],[156,46],[78,62],[62,96],[96,78],[46,53],[53,63],[63,46],[143,34],[34,227],[227,143],[123,117],[117,111],[111,123],[44,125],[125,19],[19,44],[236,134],[134,51],[51,236],[216,206],[206,205],[205,216],[154,153],[153,22],[22,154],[39,37],[37,167],[167,39],[200,201],[201,208],[208,200],[36,142],[142,100],[100,36],[57,212],[212,202],[202,57],[20,60],[60,99],[99,20],[28,158],[158,157],[157,28],[35,226],[226,113],[113,35],[160,159],[159,27],[27,160],[204,202],[202,210],[210,204],[113,225],[225,46],[46,113],[43,202],[202,204],[204,43],[62,76],[76,77],[77,62],[137,123],[123,116],[116,137],[41,38],[38,72],[72,41],[203,129],[129,142],[142,203],[64,98],[98,240],[240,64],[49,102],[102,64],[64,49],[41,73],[73,74],[74,41],[212,216],[216,207],[207,212],[42,74],[74,184],[184,42],[169,170],[170,211],[211,169],[170,149],[149,176],[176,170],[105,66],[66,69],[69,105],[122,6],[6,168],[168,122],[123,147],[147,187],[187,123],[96,77],[77,90],[90,96],[65,55],[55,107],[107,65],[89,90],[90,180],[180,89],[101,100],[100,120],[120,101],[63,105],[105,104],[104,63],[93,137],[137,227],[227,93],[15,86],[86,85],[85,15],[129,102],[102,49],[49,129],[14,87],[87,86],[86,14],[55,8],[8,9],[9,55],[100,47],[47,121],[121,100],[145,23],[23,22],[22,145],[88,89],[89,179],[179,88],[6,122],[122,196],[196,6],[88,95],[95,96],[96,88],[138,172],[172,136],[136,138],[215,58],[58,172],[172,215],[115,48],[48,219],[219,115],[42,80],[80,81],[81,42],[195,3],[3,51],[51,195],[43,146],[146,61],[61,43],[171,175],[175,199],[199,171],[81,82],[82,38],[38,81],[53,46],[46,225],[225,53],[144,163],[163,110],[110,144],[52,65],[65,66],[66,52],[229,228],[228,117],[117,229],[34,127],[127,234],[234,34],[107,108],[108,69],[69,107],[109,108],[108,151],[151,109],[48,64],[64,235],[235,48],[62,78],[78,191],[191,62],[129,209],[209,126],[126,129],[111,35],[35,143],[143,111],[117,123],[123,50],[50,117],[222,65],[65,52],[52,222],[19,125],[125,141],[141,19],[221,55],[55,65],[65,221],[3,195],[195,197],[197,3],[25,7],[7,33],[33,25],[220,237],[237,44],[44,220],[70,71],[71,139],[139,70],[122,193],[193,245],[245,122],[247,130],[130,33],[33,247],[71,21],[21,162],[162,71],[170,169],[169,150],[150,170],[188,174],[174,196],[196,188],[216,186],[186,92],[92,216],[2,97],[97,167],[167,2],[141,125],[125,241],[241,141],[164,167],[167,37],[37,164],[72,38],[38,12],[12,72],[38,82],[82,13],[13,38],[63,68],[68,71],[71,63],[226,35],[35,111],[111,226],[101,50],[50,205],[205,101],[206,92],[92,165],[165,206],[209,198],[198,217],[217,209],[165,167],[167,97],[97,165],[220,115],[115,218],[218,220],[133,112],[112,243],[243,133],[239,238],[238,241],[241,239],[214,135],[135,169],[169,214],[190,173],[173,133],[133,190],[171,208],[208,32],[32,171],[125,44],[44,237],[237,125],[86,87],[87,178],[178,86],[85,86],[86,179],[179,85],[84,85],[85,180],[180,84],[83,84],[84,181],[181,83],[201,83],[83,182],[182,201],[137,93],[93,132],[132,137],[76,62],[62,183],[183,76],[61,76],[76,184],[184,61],[57,61],[61,185],[185,57],[212,57],[57,186],[186,212],[214,207],[207,187],[187,214],[34,143],[143,156],[156,34],[79,239],[239,237],[237,79],[123,137],[137,177],[177,123],[44,1],[1,4],[4,44],[201,194],[194,32],[32,201],[64,102],[102,129],[129,64],[213,215],[215,138],[138,213],[59,166],[166,219],[219,59],[242,99],[99,97],[97,242],[2,94],[94,141],[141,2],[75,59],[59,235],[235,75],[24,110],[110,228],[228,24],[25,130],[130,226],[226,25],[23,24],[24,229],[229,23],[22,23],[23,230],[230,22],[26,22],[22,231],[231,26],[112,26],[26,232],[232,112],[189,190],[190,243],[243,189],[221,56],[56,190],[190,221],[28,56],[56,221],[221,28],[27,28],[28,222],[222,27],[29,27],[27,223],[223,29],[30,29],[29,224],[224,30],[247,30],[30,225],[225,247],[238,79],[79,20],[20,238],[166,59],[59,75],[75,166],[60,75],[75,240],[240,60],[147,177],[177,215],[215,147],[20,79],[79,166],[166,20],[187,147],[147,213],[213,187],[112,233],[233,244],[244,112],[233,128],[128,245],[245,233],[128,114],[114,188],[188,128],[114,217],[217,174],[174,114],[131,115],[115,220],[220,131],[217,198],[198,236],[236,217],[198,131],[131,134],[134,198],[177,132],[132,58],[58,177],[143,35],[35,124],[124,143],[110,163],[163,7],[7,110],[228,110],[110,25],[25,228],[356,389],[389,368],[368,356],[11,302],[302,267],[267,11],[452,350],[350,349],[349,452],[302,303],[303,269],[269,302],[357,343],[343,277],[277,357],[452,453],[453,357],[357,452],[333,332],[332,297],[297,333],[175,152],[152,377],[377,175],[347,348],[348,330],[330,347],[303,304],[304,270],[270,303],[9,336],[336,337],[337,9],[278,279],[279,360],[360,278],[418,262],[262,431],[431,418],[304,408],[408,409],[409,304],[310,415],[415,407],[407,310],[270,409],[409,410],[410,270],[450,348],[348,347],[347,450],[422,430],[430,434],[434,422],[313,314],[314,17],[17,313],[306,307],[307,375],[375,306],[387,388],[388,260],[260,387],[286,414],[414,398],[398,286],[335,406],[406,418],[418,335],[364,367],[367,416],[416,364],[423,358],[358,327],[327,423],[251,284],[284,298],[298,251],[281,5],[5,4],[4,281],[373,374],[374,253],[253,373],[307,320],[320,321],[321,307],[425,427],[427,411],[411,425],[421,313],[313,18],[18,421],[321,405],[405,406],[406,321],[320,404],[404,405],[405,320],[315,16],[16,17],[17,315],[426,425],[425,266],[266,426],[377,400],[400,369],[369,377],[322,391],[391,269],[269,322],[417,465],[465,464],[464,417],[386,257],[257,258],[258,386],[466,260],[260,388],[388,466],[456,399],[399,419],[419,456],[284,332],[332,333],[333,284],[417,285],[285,8],[8,417],[346,340],[340,261],[261,346],[413,441],[441,285],[285,413],[327,460],[460,328],[328,327],[355,371],[371,329],[329,355],[392,439],[439,438],[438,392],[382,341],[341,256],[256,382],[429,420],[420,360],[360,429],[364,394],[394,379],[379,364],[277,343],[343,437],[437,277],[443,444],[444,283],[283,443],[275,440],[440,363],[363,275],[431,262],[262,369],[369,431],[297,338],[338,337],[337,297],[273,375],[375,321],[321,273],[450,451],[451,349],[349,450],[446,342],[342,467],[467,446],[293,334],[334,282],[282,293],[458,461],[461,462],[462,458],[276,353],[353,383],[383,276],[308,324],[324,325],[325,308],[276,300],[300,293],[293,276],[372,345],[345,447],[447,372],[352,345],[345,340],[340,352],[274,1],[1,19],[19,274],[456,248],[248,281],[281,456],[436,427],[427,425],[425,436],[381,256],[256,252],[252,381],[269,391],[391,393],[393,269],[200,199],[199,428],[428,200],[266,330],[330,329],[329,266],[287,273],[273,422],[422,287],[250,462],[462,328],[328,250],[258,286],[286,384],[384,258],[265,353],[353,342],[342,265],[387,259],[259,257],[257,387],[424,431],[431,430],[430,424],[342,353],[353,276],[276,342],[273,335],[335,424],[424,273],[292,325],[325,307],[307,292],[366,447],[447,345],[345,366],[271,303],[303,302],[302,271],[423,266],[266,371],[371,423],[294,455],[455,460],[460,294],[279,278],[278,294],[294,279],[271,272],[272,304],[304,271],[432,434],[434,427],[427,432],[272,407],[407,408],[408,272],[394,430],[430,431],[431,394],[395,369],[369,400],[400,395],[334,333],[333,299],[299,334],[351,417],[417,168],[168,351],[352,280],[280,411],[411,352],[325,319],[319,320],[320,325],[295,296],[296,336],[336,295],[319,403],[403,404],[404,319],[330,348],[348,349],[349,330],[293,298],[298,333],[333,293],[323,454],[454,447],[447,323],[15,16],[16,315],[315,15],[358,429],[429,279],[279,358],[14,15],[15,316],[316,14],[285,336],[336,9],[9,285],[329,349],[349,350],[350,329],[374,380],[380,252],[252,374],[318,402],[402,403],[403,318],[6,197],[197,419],[419,6],[318,319],[319,325],[325,318],[367,364],[364,365],[365,367],[435,367],[367,397],[397,435],[344,438],[438,439],[439,344],[272,271],[271,311],[311,272],[195,5],[5,281],[281,195],[273,287],[287,291],[291,273],[396,428],[428,199],[199,396],[311,271],[271,268],[268,311],[283,444],[444,445],[445,283],[373,254],[254,339],[339,373],[282,334],[334,296],[296,282],[449,347],[347,346],[346,449],[264,447],[447,454],[454,264],[336,296],[296,299],[299,336],[338,10],[10,151],[151,338],[278,439],[439,455],[455,278],[292,407],[407,415],[415,292],[358,371],[371,355],[355,358],[340,345],[345,372],[372,340],[346,347],[347,280],[280,346],[442,443],[443,282],[282,442],[19,94],[94,370],[370,19],[441,442],[442,295],[295,441],[248,419],[419,197],[197,248],[263,255],[255,359],[359,263],[440,275],[275,274],[274,440],[300,383],[383,368],[368,300],[351,412],[412,465],[465,351],[263,467],[467,466],[466,263],[301,368],[368,389],[389,301],[395,378],[378,379],[379,395],[412,351],[351,419],[419,412],[436,426],[426,322],[322,436],[2,164],[164,393],[393,2],[370,462],[462,461],[461,370],[164,0],[0,267],[267,164],[302,11],[11,12],[12,302],[268,12],[12,13],[13,268],[293,300],[300,301],[301,293],[446,261],[261,340],[340,446],[330,266],[266,425],[425,330],[426,423],[423,391],[391,426],[429,355],[355,437],[437,429],[391,327],[327,326],[326,391],[440,457],[457,438],[438,440],[341,382],[382,362],[362,341],[459,457],[457,461],[461,459],[434,430],[430,394],[394,434],[414,463],[463,362],[362,414],[396,369],[369,262],[262,396],[354,461],[461,457],[457,354],[316,403],[403,402],[402,316],[315,404],[404,403],[403,315],[314,405],[405,404],[404,314],[313,406],[406,405],[405,313],[421,418],[418,406],[406,421],[366,401],[401,361],[361,366],[306,408],[408,407],[407,306],[291,409],[409,408],[408,291],[287,410],[410,409],[409,287],[432,436],[436,410],[410,432],[434,416],[416,411],[411,434],[264,368],[368,383],[383,264],[309,438],[438,457],[457,309],[352,376],[376,401],[401,352],[274,275],[275,4],[4,274],[421,428],[428,262],[262,421],[294,327],[327,358],[358,294],[433,416],[416,367],[367,433],[289,455],[455,439],[439,289],[462,370],[370,326],[326,462],[2,326],[326,370],[370,2],[305,460],[460,455],[455,305],[254,449],[449,448],[448,254],[255,261],[261,446],[446,255],[253,450],[450,449],[449,253],[252,451],[451,450],[450,252],[256,452],[452,451],[451,256],[341,453],[453,452],[452,341],[413,464],[464,463],[463,413],[441,413],[413,414],[414,441],[258,442],[442,441],[441,258],[257,443],[443,442],[442,257],[259,444],[444,443],[443,259],[260,445],[445,444],[444,260],[467,342],[342,445],[445,467],[459,458],[458,250],[250,459],[289,392],[392,290],[290,289],[290,328],[328,460],[460,290],[376,433],[433,435],[435,376],[250,290],[290,392],[392,250],[411,416],[416,433],[433,411],[341,463],[463,464],[464,341],[453,464],[464,465],[465,453],[357,465],[465,412],[412,357],[343,412],[412,399],[399,343],[360,363],[363,440],[440,360],[437,399],[399,456],[456,437],[420,456],[456,363],[363,420],[401,435],[435,288],[288,401],[372,383],[383,353],[353,372],[339,255],[255,249],[249,339],[448,261],[261,255],[255,448],[133,243],[243,190],[190,133],[133,155],[155,112],[112,133],[33,246],[246,247],[247,33],[33,130],[130,25],[25,33],[398,384],[384,286],[286,398],[362,398],[398,414],[414,362],[362,463],[463,341],[341,362],[263,359],[359,467],[467,263],[263,249],[249,255],[255,263],[466,467],[467,260],[260,466],[75,60],[60,166],[166,75],[238,239],[239,79],[79,238],[162,127],[127,139],[139,162],[72,11],[11,37],[37,72],[121,232],[232,120],[120,121],[73,72],[72,39],[39,73],[114,128],[128,47],[47,114],[233,232],[232,128],[128,233],[103,104],[104,67],[67,103],[152,175],[175,148],[148,152],[119,118],[118,101],[101,119],[74,73],[73,40],[40,74],[107,9],[9,108],[108,107],[49,48],[48,131],[131,49],[32,194],[194,211],[211,32],[184,74],[74,185],[185,184],[191,80],[80,183],[183,191],[185,40],[40,186],[186,185],[119,230],[230,118],[118,119],[210,202],[202,214],[214,210],[84,83],[83,17],[17,84],[77,76],[76,146],[146,77],[161,160],[160,30],[30,161],[190,56],[56,173],[173,190],[182,106],[106,194],[194,182],[138,135],[135,192],[192,138],[129,203],[203,98],[98,129],[54,21],[21,68],[68,54],[5,51],[51,4],[4,5],[145,144],[144,23],[23,145],[90,77],[77,91],[91,90],[207,205],[205,187],[187,207],[83,201],[201,18],[18,83],[181,91],[91,182],[182,181],[180,90],[90,181],[181,180],[16,85],[85,17],[17,16],[205,206],[206,36],[36,205],[176,148],[148,140],[140,176],[165,92],[92,39],[39,165],[245,193],[193,244],[244,245],[27,159],[159,28],[28,27],[30,247],[247,161],[161,30],[174,236],[236,196],[196,174],[103,54],[54,104],[104,103],[55,193],[193,8],[8,55],[111,117],[117,31],[31,111],[221,189],[189,55],[55,221],[240,98],[98,99],[99,240],[142,126],[126,100],[100,142],[219,166],[166,218],[218,219],[112,155],[155,26],[26,112],[198,209],[209,131],[131,198],[169,135],[135,150],[150,169],[114,47],[47,217],[217,114],[224,223],[223,53],[53,224],[220,45],[45,134],[134,220],[32,211],[211,140],[140,32],[109,67],[67,108],[108,109],[146,43],[43,91],[91,146],[231,230],[230,120],[120,231],[113,226],[226,247],[247,113],[105,63],[63,52],[52,105],[241,238],[238,242],[242,241],[124,46],[46,156],[156,124],[95,78],[78,96],[96,95],[70,46],[46,63],[63,70],[116,143],[143,227],[227,116],[116,123],[123,111],[111,116],[1,44],[44,19],[19,1],[3,236],[236,51],[51,3],[207,216],[216,205],[205,207],[26,154],[154,22],[22,26],[165,39],[39,167],[167,165],[199,200],[200,208],[208,199],[101,36],[36,100],[100,101],[43,57],[57,202],[202,43],[242,20],[20,99],[99,242],[56,28],[28,157],[157,56],[124,35],[35,113],[113,124],[29,160],[160,27],[27,29],[211,204],[204,210],[210,211],[124,113],[113,46],[46,124],[106,43],[43,204],[204,106],[96,62],[62,77],[77,96],[227,137],[137,116],[116,227],[73,41],[41,72],[72,73],[36,203],[203,142],[142,36],[235,64],[64,240],[240,235],[48,49],[49,64],[64,48],[42,41],[41,74],[74,42],[214,212],[212,207],[207,214],[183,42],[42,184],[184,183],[210,169],[169,211],[211,210],[140,170],[170,176],[176,140],[104,105],[105,69],[69,104],[193,122],[122,168],[168,193],[50,123],[123,187],[187,50],[89,96],[96,90],[90,89],[66,65],[65,107],[107,66],[179,89],[89,180],[180,179],[119,101],[101,120],[120,119],[68,63],[63,104],[104,68],[234,93],[93,227],[227,234],[16,15],[15,85],[85,16],[209,129],[129,49],[49,209],[15,14],[14,86],[86,15],[107,55],[55,9],[9,107],[120,100],[100,121],[121,120],[153,145],[145,22],[22,153],[178,88],[88,179],[179,178],[197,6],[6,196],[196,197],[89,88],[88,96],[96,89],[135,138],[138,136],[136,135],[138,215],[215,172],[172,138],[218,115],[115,219],[219,218],[41,42],[42,81],[81,41],[5,195],[195,51],[51,5],[57,43],[43,61],[61,57],[208,171],[171,199],[199,208],[41,81],[81,38],[38,41],[224,53],[53,225],[225,224],[24,144],[144,110],[110,24],[105,52],[52,66],[66,105],[118,229],[229,117],[117,118],[227,34],[34,234],[234,227],[66,107],[107,69],[69,66],[10,109],[109,151],[151,10],[219,48],[48,235],[235,219],[183,62],[62,191],[191,183],[142,129],[129,126],[126,142],[116,111],[111,143],[143,116],[118,117],[117,50],[50,118],[223,222],[222,52],[52,223],[94,19],[19,141],[141,94],[222,221],[221,65],[65,222],[196,3],[3,197],[197,196],[45,220],[220,44],[44,45],[156,70],[70,139],[139,156],[188,122],[122,245],[245,188],[139,71],[71,162],[162,139],[149,170],[170,150],[150,149],[122,188],[188,196],[196,122],[206,216],[216,92],[92,206],[164,2],[2,167],[167,164],[242,141],[141,241],[241,242],[0,164],[164,37],[37,0],[11,72],[72,12],[12,11],[12,38],[38,13],[13,12],[70,63],[63,71],[71,70],[31,226],[226,111],[111,31],[36,101],[101,205],[205,36],[203,206],[206,165],[165,203],[126,209],[209,217],[217,126],[98,165],[165,97],[97,98],[237,220],[220,218],[218,237],[237,239],[239,241],[241,237],[210,214],[214,169],[169,210],[140,171],[171,32],[32,140],[241,125],[125,237],[237,241],[179,86],[86,178],[178,179],[180,85],[85,179],[179,180],[181,84],[84,180],[180,181],[182,83],[83,181],[181,182],[194,201],[201,182],[182,194],[177,137],[137,132],[132,177],[184,76],[76,183],[183,184],[185,61],[61,184],[184,185],[186,57],[57,185],[185,186],[216,212],[212,186],[186,216],[192,214],[214,187],[187,192],[139,34],[34,156],[156,139],[218,79],[79,237],[237,218],[147,123],[123,177],[177,147],[45,44],[44,4],[4,45],[208,201],[201,32],[32,208],[98,64],[64,129],[129,98],[192,213],[213,138],[138,192],[235,59],[59,219],[219,235],[141,242],[242,97],[97,141],[97,2],[2,141],[141,97],[240,75],[75,235],[235,240],[229,24],[24,228],[228,229],[31,25],[25,226],[226,31],[230,23],[23,229],[229,230],[231,22],[22,230],[230,231],[232,26],[26,231],[231,232],[233,112],[112,232],[232,233],[244,189],[189,243],[243,244],[189,221],[221,190],[190,189],[222,28],[28,221],[221,222],[223,27],[27,222],[222,223],[224,29],[29,223],[223,224],[225,30],[30,224],[224,225],[113,247],[247,225],[225,113],[99,60],[60,240],[240,99],[213,147],[147,215],[215,213],[60,20],[20,166],[166,60],[192,187],[187,213],[213,192],[243,112],[112,244],[244,243],[244,233],[233,245],[245,244],[245,128],[128,188],[188,245],[188,114],[114,174],[174,188],[134,131],[131,220],[220,134],[174,217],[217,236],[236,174],[236,198],[198,134],[134,236],[215,177],[177,58],[58,215],[156,143],[143,124],[124,156],[25,110],[110,7],[7,25],[31,228],[228,25],[25,31],[264,356],[356,368],[368,264],[0,11],[11,267],[267,0],[451,452],[452,349],[349,451],[267,302],[302,269],[269,267],[350,357],[357,277],[277,350],[350,452],[452,357],[357,350],[299,333],[333,297],[297,299],[396,175],[175,377],[377,396],[280,347],[347,330],[330,280],[269,303],[303,270],[270,269],[151,9],[9,337],[337,151],[344,278],[278,360],[360,344],[424,418],[418,431],[431,424],[270,304],[304,409],[409,270],[272,310],[310,407],[407,272],[322,270],[270,410],[410,322],[449,450],[450,347],[347,449],[432,422],[422,434],[434,432],[18,313],[313,17],[17,18],[291,306],[306,375],[375,291],[259,387],[387,260],[260,259],[424,335],[335,418],[418,424],[434,364],[364,416],[416,434],[391,423],[423,327],[327,391],[301,251],[251,298],[298,301],[275,281],[281,4],[4,275],[254,373],[373,253],[253,254],[375,307],[307,321],[321,375],[280,425],[425,411],[411,280],[200,421],[421,18],[18,200],[335,321],[321,406],[406,335],[321,320],[320,405],[405,321],[314,315],[315,17],[17,314],[423,426],[426,266],[266,423],[396,377],[377,369],[369,396],[270,322],[322,269],[269,270],[413,417],[417,464],[464,413],[385,386],[386,258],[258,385],[248,456],[456,419],[419,248],[298,284],[284,333],[333,298],[168,417],[417,8],[8,168],[448,346],[346,261],[261,448],[417,413],[413,285],[285,417],[326,327],[327,328],[328,326],[277,355],[355,329],[329,277],[309,392],[392,438],[438,309],[381,382],[382,256],[256,381],[279,429],[429,360],[360,279],[365,364],[364,379],[379,365],[355,277],[277,437],[437,355],[282,443],[443,283],[283,282],[281,275],[275,363],[363,281],[395,431],[431,369],[369,395],[299,297],[297,337],[337,299],[335,273],[273,321],[321,335],[348,450],[450,349],[349,348],[359,446],[446,467],[467,359],[283,293],[293,282],[282,283],[250,458],[458,462],[462,250],[300,276],[276,383],[383,300],[292,308],[308,325],[325,292],[283,276],[276,293],[293,283],[264,372],[372,447],[447,264],[346,352],[352,340],[340,346],[354,274],[274,19],[19,354],[363,456],[456,281],[281,363],[426,436],[436,425],[425,426],[380,381],[381,252],[252,380],[267,269],[269,393],[393,267],[421,200],[200,428],[428,421],[371,266],[266,329],[329,371],[432,287],[287,422],[422,432],[290,250],[250,328],[328,290],[385,258],[258,384],[384,385],[446,265],[265,342],[342,446],[386,387],[387,257],[257,386],[422,424],[424,430],[430,422],[445,342],[342,276],[276,445],[422,273],[273,424],[424,422],[306,292],[292,307],[307,306],[352,366],[366,345],[345,352],[268,271],[271,302],[302,268],[358,423],[423,371],[371,358],[327,294],[294,460],[460,327],[331,279],[279,294],[294,331],[303,271],[271,304],[304,303],[436,432],[432,427],[427,436],[304,272],[272,408],[408,304],[395,394],[394,431],[431,395],[378,395],[395,400],[400,378],[296,334],[334,299],[299,296],[6,351],[351,168],[168,6],[376,352],[352,411],[411,376],[307,325],[325,320],[320,307],[285,295],[295,336],[336,285],[320,319],[319,404],[404,320],[329,330],[330,349],[349,329],[334,293],[293,333],[333,334],[366,323],[323,447],[447,366],[316,15],[15,315],[315,316],[331,358],[358,279],[279,331],[317,14],[14,316],[316,317],[8,285],[285,9],[9,8],[277,329],[329,350],[350,277],[253,374],[374,252],[252,253],[319,318],[318,403],[403,319],[351,6],[6,419],[419,351],[324,318],[318,325],[325,324],[397,367],[367,365],[365,397],[288,435],[435,397],[397,288],[278,344],[344,439],[439,278],[310,272],[272,311],[311,310],[248,195],[195,281],[281,248],[375,273],[273,291],[291,375],[175,396],[396,199],[199,175],[312,311],[311,268],[268,312],[276,283],[283,445],[445,276],[390,373],[373,339],[339,390],[295,282],[282,296],[296,295],[448,449],[449,346],[346,448],[356,264],[264,454],[454,356],[337,336],[336,299],[299,337],[337,338],[338,151],[151,337],[294,278],[278,455],[455,294],[308,292],[292,415],[415,308],[429,358],[358,355],[355,429],[265,340],[340,372],[372,265],[352,346],[346,280],[280,352],[295,442],[442,282],[282,295],[354,19],[19,370],[370,354],[285,441],[441,295],[295,285],[195,248],[248,197],[197,195],[457,440],[440,274],[274,457],[301,300],[300,368],[368,301],[417,351],[351,465],[465,417],[251,301],[301,389],[389,251],[394,395],[395,379],[379,394],[399,412],[412,419],[419,399],[410,436],[436,322],[322,410],[326,2],[2,393],[393,326],[354,370],[370,461],[461,354],[393,164],[164,267],[267,393],[268,302],[302,12],[12,268],[312,268],[268,13],[13,312],[298,293],[293,301],[301,298],[265,446],[446,340],[340,265],[280,330],[330,425],[425,280],[322,426],[426,391],[391,322],[420,429],[429,437],[437,420],[393,391],[391,326],[326,393],[344,440],[440,438],[438,344],[458,459],[459,461],[461,458],[364,434],[434,394],[394,364],[428,396],[396,262],[262,428],[274,354],[354,457],[457,274],[317,316],[316,402],[402,317],[316,315],[315,403],[403,316],[315,314],[314,404],[404,315],[314,313],[313,405],[405,314],[313,421],[421,406],[406,313],[323,366],[366,361],[361,323],[292,306],[306,407],[407,292],[306,291],[291,408],[408,306],[291,287],[287,409],[409,291],[287,432],[432,410],[410,287],[427,434],[434,411],[411,427],[372,264],[264,383],[383,372],[459,309],[309,457],[457,459],[366,352],[352,401],[401,366],[1,274],[274,4],[4,1],[418,421],[421,262],[262,418],[331,294],[294,358],[358,331],[435,433],[433,367],[367,435],[392,289],[289,439],[439,392],[328,462],[462,326],[326,328],[94,2],[2,370],[370,94],[289,305],[305,455],[455,289],[339,254],[254,448],[448,339],[359,255],[255,446],[446,359],[254,253],[253,449],[449,254],[253,252],[252,450],[450,253],[252,256],[256,451],[451,252],[256,341],[341,452],[452,256],[414,413],[413,463],[463,414],[286,441],[441,414],[414,286],[286,258],[258,441],[441,286],[258,257],[257,442],[442,258],[257,259],[259,443],[443,257],[259,260],[260,444],[444,259],[260,467],[467,445],[445,260],[309,459],[459,250],[250,309],[305,289],[289,290],[290,305],[305,290],[290,460],[460,305],[401,376],[376,435],[435,401],[309,250],[250,392],[392,309],[376,411],[411,433],[433,376],[453,341],[341,464],[464,453],[357,453],[453,465],[465,357],[343,357],[357,412],[412,343],[437,343],[343,399],[399,437],[344,360],[360,440],[440,344],[420,437],[437,456],[456,420],[360,420],[420,363],[363,360],[361,401],[401,288],[288,361],[265,372],[372,353],[353,265],[390,339],[339,249],[249,390],[339,448],[448,255],[255,339]]),F("VERSION","0.4.1646425229")}).call(xg);var Ko=function(){return Ko=Object.assign||function(n){for(var t,e=1,s=arguments.length;e<s;e++)for(var r in t=arguments[e])Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n},Ko.apply(this,arguments)};function lo(n,t,e,s){return new(e||(e=Promise))(function(r,i){function o(l){try{u(s.next(l))}catch(c){i(c)}}function a(l){try{u(s.throw(l))}catch(c){i(c)}}function u(l){var c;l.done?r(l.value):(c=l.value,c instanceof e?c:new e(function(h){h(c)})).then(o,a)}u((s=s.apply(n,t||[])).next())})}function co(n,t){var e,s,r,i,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function a(u){return function(l){return function(c){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,s&&(r=2&c[0]?s.return:c[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,c[1])).done)return r;switch(s=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,s=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||c[0]!==6&&c[0]!==2)){o=0;continue}if(c[0]===3&&(!r||c[1]>r[0]&&c[1]<r[3])){o.label=c[1];break}if(c[0]===6&&o.label<r[1]){o.label=r[1],r=c;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(c);break}r[2]&&o.ops.pop(),o.trys.pop();continue}c=t.call(n,o)}catch(h){c=[6,h],s=0}finally{e=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([u,l])}}}var Pk=["rightEye","leftEye","noseTip","mouthCenter","rightEarTragion","leftEarTragion"],wg={modelType:"short",runtime:"mediapipe",maxFaces:1},uG=function(){function n(t){var e=this;this.width=0,this.height=0,this.selfieMode=!1,this.faceDetectorSolution=new aG.FaceDetection({locateFile:function(s,r){return t.solutionPath?t.solutionPath.replace(/\/+$/,"")+"/"+s:r+"/"+s}}),this.faceDetectorSolution.setOptions({selfieMode:this.selfieMode,model:t.modelType}),this.faceDetectorSolution.onResults(function(s){if(e.height=s.image.height,e.width=s.image.width,e.faces=[],s.detections!==null)for(var r=0,i=s.detections;r<i.length;r++){var o=i[r];e.faces.push(e.normalizedToAbsolute(o.landmarks,{xMin:u=(a=o.boundingBox).xCenter-a.width/2,xMax:u+a.width,yMin:l=a.yCenter-a.height/2,yMax:l+a.height,width:a.width,height:a.height}))}var a,u,l})}return n.prototype.normalizedToAbsolute=function(t,e){var s=this;return{keypoints:t.map(function(r,i){return{x:r.x*s.width,y:r.y*s.height,name:Pk[i]}}),box:{xMin:e.xMin*this.width,yMin:e.yMin*this.height,xMax:e.xMax*this.width,yMax:e.yMax*this.height,width:e.width*this.width,height:e.height*this.height}}},n.prototype.estimateFaces=function(t,e){return lo(this,void 0,void 0,function(){var s,r;return co(this,function(i){switch(i.label){case 0:return e&&e.flipHorizontal&&e.flipHorizontal!==this.selfieMode&&(this.selfieMode=e.flipHorizontal,this.faceDetectorSolution.setOptions({selfieMode:this.selfieMode})),t instanceof $e?(r=ImageData.bind,[4,ru(t)]):[3,2];case 1:return s=new(r.apply(ImageData,[void 0,i.sent(),t.shape[1],t.shape[0]])),[3,3];case 2:s=t,i.label=3;case 3:return t=s,[4,this.faceDetectorSolution.send({image:t})];case 4:return i.sent(),[2,this.faces]}})})},n.prototype.dispose=function(){this.faceDetectorSolution.close()},n.prototype.reset=function(){this.faceDetectorSolution.reset(),this.width=0,this.height=0,this.faces=null,this.selfieMode=!1},n.prototype.initialize=function(){return this.faceDetectorSolution.initialize()},n}();function lG(n){return lo(this,void 0,void 0,function(){var t,e;return co(this,function(s){switch(s.label){case 0:return t=function(r){if(r==null)return Ko({},wg);var i=Ko({},r);return i.runtime="mediapipe",i.modelType==null&&(i.modelType=wg.modelType),i.maxFaces==null&&(i.maxFaces=wg.maxFaces),i}(n),[4,(e=new uG(t)).initialize()];case 1:return s.sent(),[2,e]}})})}function Mk(n){return n instanceof $e?{height:n.shape[0],width:n.shape[1]}:{height:n.height,width:n.width}}function zk(n){return n instanceof $e?n:iu(n)}function vg(n,t){V(n.width!==0,function(){return t+" width cannot be 0."}),V(n.height!==0,function(){return t+" height cannot be 0."})}function cG(n,t,e){var s=t.outputTensorSize,r=t.keepAspectRatio,i=t.borderMode,o=t.outputTensorFloatRange,a=Mk(n),u=function(d,f){return f?{xCenter:f.xCenter*d.width,yCenter:f.yCenter*d.height,width:f.width*d.width,height:f.height*d.height,rotation:f.rotation}:{xCenter:.5*d.width,yCenter:.5*d.height,width:d.width,height:d.height,rotation:0}}(a,e),l=function(d,f,p){if(p===void 0&&(p=!1),!p)return{top:0,left:0,right:0,bottom:0};var m=f.height,g=f.width;vg(f,"targetSize"),vg(d,"roi");var y,b,w=m/g,v=d.height/d.width,S=0,N=0;return w>v?(y=d.width,b=d.width*w,N=(1-v/w)/2):(y=d.height/w,b=d.height,S=(1-w/v)/2),d.width=y,d.height=b,{top:N,left:S,right:S,bottom:N}}(u,s,r),c=function(d,f,p,m){var g=d.width,y=d.height,b=m?-1:1,w=Math.cos(d.rotation),v=Math.sin(d.rotation),S=d.xCenter,N=d.yCenter,R=1/f,L=1/p,F=new Array(16);return F[0]=g*w*b*R,F[1]=-y*v*R,F[2]=0,F[3]=(-.5*g*w*b+.5*y*v+S)*R,F[4]=g*v*b*L,F[5]=y*w*L,F[6]=0,F[7]=(-.5*y*w-.5*g*v*b+N)*L,F[8]=0,F[9]=0,F[10]=g*R,F[11]=0,F[12]=0,F[13]=0,F[14]=0,F[15]=1,function(B){if(B.length!==16)throw new Error("Array length must be 16 but got "+B.length);return[[B[0],B[1],B[2],B[3]],[B[4],B[5],B[6],B[7]],[B[8],B[9],B[10],B[11]],[B[12],B[13],B[14],B[15]]]}(F)}(u,a.width,a.height,!1),h=pt(function(){var d=zk(n),f=Di(function(g,y,b){return vg(b,"inputResolution"),[1/b.width*g[0][0]*y.width,1/b.height*g[0][1]*y.width,g[0][3]*y.width,1/b.width*g[1][0]*y.height,1/b.height*g[1][1]*y.height,g[1][3]*y.height,0,0]}(c,a,s),[1,8]),p=i==="zero"?"constant":"nearest",m=Bn.transform(gn(Kt(d,"float32")),f,"bilinear",p,0,[s.height,s.width]);return o!=null?function(g,y){var b=function(w,v,S,N){var R=(N-S)/255;return{scale:R,offset:S-0*R}}(0,0,y[0],y[1]);return pt(function(){return Lt(ut(g,b.scale),b.offset)})}(m,o):m});return{imageTensor:h,padding:l,transformationMatrix:c}}function Kb(n){n.reduceBoxesInLowestLayer==null&&(n.reduceBoxesInLowestLayer=!1),n.interpolatedScaleAspectRatio==null&&(n.interpolatedScaleAspectRatio=1),n.fixedAnchorSize==null&&(n.fixedAnchorSize=!1);for(var t=[],e=0;e<n.numLayers;){for(var s=[],r=[],i=[],o=[],a=e;a<n.strides.length&&n.strides[a]===n.strides[e];){var u=qb(n.minScale,n.maxScale,a,n.strides.length);if(a===0&&n.reduceBoxesInLowestLayer)i.push(1),i.push(2),i.push(.5),o.push(.1),o.push(u),o.push(u);else{for(var l=0;l<n.aspectRatios.length;++l)i.push(n.aspectRatios[l]),o.push(u);if(n.interpolatedScaleAspectRatio>0){var c=a===n.strides.length-1?1:qb(n.minScale,n.maxScale,a+1,n.strides.length);o.push(Math.sqrt(u*c)),i.push(n.interpolatedScaleAspectRatio)}}a++}for(var h=0;h<i.length;++h){var d=Math.sqrt(i[h]);s.push(o[h]/d),r.push(o[h]*d)}var f=0,p=0;if(n.featureMapHeight.length>0)f=n.featureMapHeight[e],p=n.featureMapWidth[e];else{var m=n.strides[e];f=Math.ceil(n.inputSizeHeight/m),p=Math.ceil(n.inputSizeWidth/m)}for(var g=0;g<f;++g)for(var y=0;y<p;++y)for(var b=0;b<s.length;++b){var w={xCenter:(y+n.anchorOffsetX)/p,yCenter:(g+n.anchorOffsetY)/f,width:0,height:0};n.fixedAnchorSize?(w.width=1,w.height=1):(w.width=r[b],w.height=s[b]),t.push(w)}e=a}return t}function qb(n,t,e,s){return s===1?.5*(n+t):n+(t-n)*e/(s-1)}function Xb(n,t){var e=t[0],s=t[1];return[e*n[0]+s*n[1]+n[3],e*n[4]+s*n[5]+n[7]]}function hG(n,t,e,s){return lo(this,void 0,void 0,function(){var r,i,o,a,u;return co(this,function(l){switch(l.label){case 0:return n.sort(function(c,h){return Math.max.apply(Math,h.score)-Math.max.apply(Math,c.score)}),r=Di(n.map(function(c){return[c.locationData.relativeBoundingBox.yMin,c.locationData.relativeBoundingBox.xMin,c.locationData.relativeBoundingBox.yMax,c.locationData.relativeBoundingBox.xMax]})),i=zn(n.map(function(c){return c.score[0]})),[4,Bn.nonMaxSuppressionAsync(r,i,t,e)];case 1:return[4,(o=l.sent()).array()];case 2:return a=l.sent(),u=n.filter(function(c,h){return a.indexOf(h)>-1}),Se([r,i,o]),[2,u]}})})}function dG(n,t,e){return lo(this,void 0,void 0,function(){var s,r,i,o,a;return co(this,function(u){switch(u.label){case 0:return s=n[0],r=n[1],i=function(l,c,h){return pt(function(){var d,f,p,m;h.reverseOutputOrder?(f=tn(xe(l,[0,h.boxCoordOffset+0],[-1,1])),d=tn(xe(l,[0,h.boxCoordOffset+1],[-1,1])),m=tn(xe(l,[0,h.boxCoordOffset+2],[-1,1])),p=tn(xe(l,[0,h.boxCoordOffset+3],[-1,1]))):(d=tn(xe(l,[0,h.boxCoordOffset+0],[-1,1])),f=tn(xe(l,[0,h.boxCoordOffset+1],[-1,1])),p=tn(xe(l,[0,h.boxCoordOffset+2],[-1,1])),m=tn(xe(l,[0,h.boxCoordOffset+3],[-1,1]))),f=Lt(ut(ie(f,h.xScale),c.w),c.x),d=Lt(ut(ie(d,h.yScale),c.h),c.y),h.applyExponentialOnBoxSize?(p=ut(Fs(ie(p,h.hScale)),c.h),m=ut(Fs(ie(m,h.wScale)),c.w)):(p=ut(ie(p,h.hScale),c.h),m=ut(ie(m,h.wScale),c.h));var g=oe(d,ie(p,2)),y=oe(f,ie(m,2)),b=Lt(d,ie(p,2)),w=Lt(f,ie(m,2)),v=Cn([ct(g,[h.numBoxes,1]),ct(y,[h.numBoxes,1]),ct(b,[h.numBoxes,1]),ct(w,[h.numBoxes,1])],1);if(h.numKeypoints)for(var S=0;S<h.numKeypoints;++S){var N=h.keypointCoordOffset+S*h.numValuesPerKeypoint,R=void 0,L=void 0;h.reverseOutputOrder?(R=tn(xe(l,[0,N],[-1,1])),L=tn(xe(l,[0,N+1],[-1,1]))):(L=tn(xe(l,[0,N],[-1,1])),R=tn(xe(l,[0,N+1],[-1,1])));var F=Lt(ut(ie(R,h.xScale),c.w),c.x),B=Lt(ut(ie(L,h.yScale),c.h),c.y);v=Cn([v,ct(F,[h.numBoxes,1]),ct(B,[h.numBoxes,1])],1)}return v})}(r,t,e),o=pt(function(){var l=s;return e.sigmoidScore?(e.scoreClippingThresh!=null&&(l=Os(s,-e.scoreClippingThresh,e.scoreClippingThresh)),l=Hs(l)):l}),[4,fG(i,o,e)];case 1:return a=u.sent(),Se([i,o]),[2,a]}})})}function fG(n,t,e){return lo(this,void 0,void 0,function(){var s,r,i,o,a,u,l,c,h,d,f,p;return co(this,function(m){switch(m.label){case 0:return s=[],[4,n.data()];case 1:return r=m.sent(),[4,t.data()];case 2:for(i=m.sent(),o=0;o<e.numBoxes;++o)if(!(e.minScoreThresh!=null&&i[o]<e.minScoreThresh||(a=o*e.numCoords,u=pG(r[a+0],r[a+1],r[a+2],r[a+3],i[o],e.flipVertically,o),(l=u.locationData.relativeBoundingBox).width<0||l.height<0))){if(e.numKeypoints>0)for((c=u.locationData).relativeKeypoints=[],h=e.numKeypoints*e.numValuesPerKeypoint,d=0;d<h;d+=e.numValuesPerKeypoint)f=a+e.keypointCoordOffset+d,p={x:r[f+0],y:e.flipVertically?1-r[f+1]:r[f+1]},c.relativeKeypoints.push(p);s.push(u)}return[2,s]}})})}function pG(n,t,e,s,r,i,o){return{score:[r],ind:o,locationData:{relativeBoundingBox:{xMin:t,yMin:i?1-e:n,xMax:s,yMax:i?1-n:e,width:s-t,height:e-n}}}}var vf,mG={reduceBoxesInLowestLayer:!1,interpolatedScaleAspectRatio:1,featureMapHeight:[],featureMapWidth:[],numLayers:4,minScale:.1484375,maxScale:.75,inputSizeHeight:128,inputSizeWidth:128,anchorOffsetX:.5,anchorOffsetY:.5,strides:[8,16,16,16],aspectRatios:[1],fixedAnchorSize:!0},gG={reduceBoxesInLowestLayer:!1,interpolatedScaleAspectRatio:0,featureMapHeight:[],featureMapWidth:[],numLayers:1,minScale:.1484375,maxScale:.75,inputSizeHeight:192,inputSizeWidth:192,anchorOffsetX:.5,anchorOffsetY:.5,strides:[4],aspectRatios:[1],fixedAnchorSize:!0},kg={runtime:"tfjs",modelType:"short",maxFaces:1,detectorModelUrl:"https://tfhub.dev/mediapipe/tfjs-model/face_detection/short/1"},yG={applyExponentialOnBoxSize:!1,flipVertically:!1,ignoreClasses:[],numClasses:1,numBoxes:896,numCoords:16,boxCoordOffset:0,keypointCoordOffset:4,numKeypoints:6,numValuesPerKeypoint:2,sigmoidScore:!0,scoreClippingThresh:100,reverseOutputOrder:!0,xScale:128,yScale:128,hScale:128,wScale:128,minScoreThresh:.5},bG={applyExponentialOnBoxSize:!1,flipVertically:!1,ignoreClasses:[],numClasses:1,numBoxes:2304,numCoords:16,boxCoordOffset:0,keypointCoordOffset:4,numKeypoints:6,numValuesPerKeypoint:2,sigmoidScore:!0,scoreClippingThresh:100,reverseOutputOrder:!0,xScale:192,yScale:192,hScale:192,wScale:192,minScoreThresh:.6},xG={outputTensorSize:{width:128,height:128},keepAspectRatio:!0,outputTensorFloatRange:[-1,1],borderMode:"zero"},wG={outputTensorSize:{width:192,height:192},keepAspectRatio:!0,outputTensorFloatRange:[-1,1],borderMode:"zero"},vG=function(){function n(t,e,s){this.detectorModel=e,this.maxFaces=s,t==="full"?(this.imageToTensorConfig=wG,this.tensorsToDetectionConfig=bG,this.anchors=Kb(gG)):(this.imageToTensorConfig=xG,this.tensorsToDetectionConfig=yG,this.anchors=Kb(mG));var r=zn(this.anchors.map(function(u){return u.width})),i=zn(this.anchors.map(function(u){return u.height})),o=zn(this.anchors.map(function(u){return u.xCenter})),a=zn(this.anchors.map(function(u){return u.yCenter}));this.anchorTensor={x:o,y:a,w:r,h:i}}return n.prototype.dispose=function(){this.detectorModel.dispose(),Se([this.anchorTensor.x,this.anchorTensor.y,this.anchorTensor.w,this.anchorTensor.h])},n.prototype.reset=function(){},n.prototype.detectFaces=function(t,e){return e===void 0&&(e=!1),lo(this,void 0,void 0,function(){var s,r,i,o,a,u,l,c,h,d,f;return co(this,function(p){switch(p.label){case 0:return t==null?(this.reset(),[2,[]]):(s=pt(function(){var m=Kt(zk(t),"float32");return e&&(m=tn(Bn.flipLeftRight(gn(m,0)),[0])),m}),r=cG(s,this.imageToTensorConfig),i=r.imageTensor,o=r.transformationMatrix,a=this.detectorModel.execute(i,"Identity:0"),u=function(m){return pt(function(){var g=function(w){return pt(function(){return[xe(w,[0,0,0],[1,-1,1]),xe(w,[0,0,1],[1,-1,-1])]})}(m),y=g[0],b=g[1];return{boxes:tn(b),logits:tn(y)}})}(a),l=u.boxes,[4,dG([c=u.logits,l],this.anchorTensor,this.tensorsToDetectionConfig)]);case 1:return(h=p.sent()).length===0?(Se([s,i,a,c,l]),[2,h]):[4,hG(h,this.maxFaces,.3)];case 2:return d=p.sent(),f=function(m,g){m===void 0&&(m=[]);var y,b=(y=g,[].concat.apply([],y));return m.forEach(function(w){var v=w.locationData;v.relativeKeypoints.forEach(function(B){var H=Xb(b,[B.x,B.y]),z=H[0],G=H[1];B.x=z,B.y=G});var S=v.relativeBoundingBox,N=Number.MAX_VALUE,R=Number.MAX_VALUE,L=Number.MIN_VALUE,F=Number.MIN_VALUE;[[S.xMin,S.yMin],[S.xMin+S.width,S.yMin],[S.xMin+S.width,S.yMin+S.height],[S.xMin,S.yMin+S.height]].forEach(function(B){var H=Xb(b,B),z=H[0],G=H[1];N=Math.min(N,z),L=Math.max(L,z),R=Math.min(R,G),F=Math.max(F,G)}),v.relativeBoundingBox={xMin:N,xMax:L,yMin:R,yMax:F,width:L-N,height:F-R}}),m}(d,o),Se([s,i,a,c,l]),[2,f]}})})},n.prototype.estimateFaces=function(t,e){return lo(this,void 0,void 0,function(){var s,r;return co(this,function(i){return s=Mk(t),r=!!e&&e.flipHorizontal,[2,this.detectFaces(t,r).then(function(o){return o.map(function(a){for(var u=a.locationData.relativeKeypoints.map(function(p,m){return Ko(Ko({},p),{x:p.x*s.width,y:p.y*s.height,name:Pk[m]})}),l=a.locationData.relativeBoundingBox,c=0,h=["width","xMax","xMin"];c<h.length;c++)l[h[c]]*=s.width;for(var d=0,f=["height","yMax","yMin"];d<f.length;d++)l[f[d]]*=s.height;return{keypoints:u,box:l}})})]})})},n}();function kG(n){return lo(this,void 0,void 0,function(){var t,e,s;return co(this,function(r){switch(r.label){case 0:return t=function(i){if(i==null)return Ko({},kg);var o=Ko({},i);return o.modelType==null&&(o.modelType=kg.modelType),o.maxFaces==null&&(o.maxFaces=kg.maxFaces),o.detectorModelUrl==null&&(o.modelType==="full"?o.detectorModelUrl="https://tfhub.dev/mediapipe/tfjs-model/face_detection/full/1":o.detectorModelUrl="https://tfhub.dev/mediapipe/tfjs-model/face_detection/short/1"),o}(n),e=typeof t.detectorModelUrl=="string"&&t.detectorModelUrl.indexOf("https://tfhub.dev")>-1,[4,pd(t.detectorModelUrl,{fromTFHub:e})];case 1:return s=r.sent(),[2,new vG(t.modelType,s,t.maxFaces)]}})})}function SG(n,t){return lo(this,void 0,void 0,function(){var e,s;return co(this,function(r){if(n===vf.MediaPipeFaceDetector){if(s=void 0,(e=t)!=null){if(e.runtime==="tfjs")return[2,kG(e)];if(e.runtime==="mediapipe")return[2,lG(e)];s=e.runtime}throw new Error("Expect modelConfig.runtime to be either 'tfjs' or 'mediapipe', but got "+s)}throw new Error(n+" is not a supported model name.")})})}function Sg(n){return n.width*n.height}function Yb(n){var t=n.xCenter-n.width/2,e=t+n.width,s=n.yCenter-n.height/2;return{xMin:t,xMax:e,yMin:s,yMax:s+n.height,width:n.width,height:n.height}}function IG(n,t){var e=Yb(n),s=Yb(t);if(!function(o,a){return!(o.xMax<a.xMin||a.xMax<o.xMin||o.yMax<a.yMin||a.yMax<o.yMin)}(e,s))return 0;var r=Sg(function(o,a){var u=Math.max(o.xMin,a.xMin),l=Math.min(o.xMax,a.xMax),c=Math.max(o.yMin,a.yMin),h=Math.min(o.yMax,a.yMax);return{xMin:u,xMax:l,yMin:c,yMax:h,width:Math.max(l-u,0),height:Math.max(h-c,0)}}(e,s)),i=Sg(e)+Sg(s)-r;return i>0?r/i:0}function CG(n,t,e,s){var r=n.width,i=n.height,o=s?-1:1,a=Math.cos(n.rotation),u=Math.sin(n.rotation),l=n.xCenter,c=n.yCenter,h=1/t,d=1/e,f=new Array(16);return f[0]=r*a*o*h,f[1]=-i*u*h,f[2]=0,f[3]=(-.5*r*a*o+.5*i*u+l)*h,f[4]=r*u*o*d,f[5]=i*a*d,f[6]=0,f[7]=(-.5*i*a-.5*r*u*o+c)*d,f[8]=0,f[9]=0,f[10]=r*h,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,function(p){if(p.length!==16)throw new Error("Array length must be 16 but got "+p.length);return[[p[0],p[1],p[2],p[3]],[p[4],p[5],p[6],p[7]],[p[8],p[9],p[10],p[11]],[p[12],p[13],p[14],p[15]]]}(f)}function Bk(n){return n instanceof $e?{height:n.shape[0],width:n.shape[1]}:{height:n.height,width:n.width}}function Vk(n){return n-2*Math.PI*Math.floor((n+Math.PI)/(2*Math.PI))}function Uk(n){return n instanceof $e?n:iu(n)}function Ig(n,t){V(n.width!==0,function(){return t+" width cannot be 0."}),V(n.height!==0,function(){return t+" height cannot be 0."})}function NG(n,t){var e=function(s,r,i,o){var a=r-s,u=o-i;if(a===0)throw new Error("Original min and max are both "+s+", range cannot be 0.");var l=u/a;return{scale:l,offset:i-s*l}}(0,255,t[0],t[1]);return pt(function(){return Lt(ut(n,e.scale),e.offset)})}function TG(n,t,e){var s=t.outputTensorSize,r=t.keepAspectRatio,i=t.borderMode,o=t.outputTensorFloatRange,a=Bk(n),u=function(d,f){return f?{xCenter:f.xCenter*d.width,yCenter:f.yCenter*d.height,width:f.width*d.width,height:f.height*d.height,rotation:f.rotation}:{xCenter:.5*d.width,yCenter:.5*d.height,width:d.width,height:d.height,rotation:0}}(a,e),l=function(d,f,p){if(p===void 0&&(p=!1),!p)return{top:0,left:0,right:0,bottom:0};var m=f.height,g=f.width;Ig(f,"targetSize"),Ig(d,"roi");var y,b,w=m/g,v=d.height/d.width,S=0,N=0;return w>v?(y=d.width,b=d.width*w,N=(1-v/w)/2):(y=d.height/w,b=d.height,S=(1-w/v)/2),d.width=y,d.height=b,{top:N,left:S,right:S,bottom:N}}(u,s,r),c=CG(u,a.width,a.height,!1),h=pt(function(){var d=Uk(n),f=Di(function(g,y,b){return Ig(b,"inputResolution"),[1/b.width*g[0][0]*y.width,1/b.height*g[0][1]*y.width,g[0][3]*y.width,1/b.width*g[1][0]*y.height,1/b.height*g[1][1]*y.height,g[1][3]*y.height,0,0]}(c,a,s),[1,8]),p=i==="zero"?"constant":"nearest",m=Bn.transform(gn(Kt(d,"float32")),f,"bilinear",p,0,[s.height,s.width]);return o!=null?NG(m,o):m});return{imageTensor:h,padding:l,transformationMatrix:c}}function Zb(n){return{xCenter:n.xMin+n.width/2,yCenter:n.yMin+n.height/2,width:n.width,height:n.height}}function Jb(n){var t=n.relativeKeypoints;if(t.length<=1)throw new Error("2 or more keypoints required to calculate a rect.");var e=Number.MAX_VALUE,s=Number.MAX_VALUE,r=Number.MIN_VALUE,i=Number.MIN_VALUE;return t.forEach(function(o){e=Math.min(e,o.x),r=Math.max(r,o.x),s=Math.min(s,o.y),i=Math.max(i,o.y)}),{xCenter:(e+r)/2,yCenter:(s+i)/2,width:r-e,height:i-s}}function Qb(n,t,e,s,r){var i=e==="rect"?function(o,a,u){var l,c=o.locationData;if(a==="boundingbox")l=Zb(c.boundingBox);else{l=Jb(c);var h=u.width,d=u.height;l.xCenter=Math.round(l.xCenter*h),l.yCenter=Math.round(l.yCenter*d),l.width=Math.round(l.width*h),l.height=Math.round(l.height*d)}return l}(n,t,s):function(o,a){var u=o.locationData;return a==="boundingbox"?Zb(u.relativeBoundingBox):Jb(u)}(n,t);return r&&(i.rotation=function(o,a,u){var l,c=o.locationData,h=u.rotationVectorStartKeypointIndex,d=u.rotationVectorEndKeypointIndex;l=u.rotationVectorTargetAngle?u.rotationVectorTargetAngle:Math.PI*u.rotationVectorTargetAngleDegree/180;var f=c.relativeKeypoints[h].x*a.width,p=c.relativeKeypoints[h].y*a.height,m=c.relativeKeypoints[d].x*a.width,g=c.relativeKeypoints[d].y*a.height;return Vk(l-Math.atan2(-(g-p),m-f))}(n,s,r)),i}function $G(n,t,e){for(var s=0;s<t.length;++s){var r=t[s],i=e[n[s]];i.x=r.x,i.y=r.y}}function EG(n,t,e,s){if(typeof t=="string"){if(t==="copy")for(var r=0;r<e.length;++r)s[n[r]].z=e[r].z}else{var i=function(o,a){for(var u=0,l=0;l<a.length;++l)u+=o[a[l]].z;return u/a.length}(s,t);for(r=0;r<n.length;++r)s[n[r]].z=i}}function _G(n,t){for(var e=function(a){var u=[].concat.apply([],a.map(function(f){return f.indexesMapping}));if(u.length===0)throw new Error("There should be at least one landmark in indexes mapping");var l=u[0],c=u[0],h=new Set(u);h.forEach(function(f){l=Math.min(l,f),c=Math.max(c,f)});var d=h.size;if(l!==0)throw new Error("Indexes are expected to start with 0 instead of "+l);if(c+1!==d)throw new Error("Indexes should have no gaps but "+(c-d+1)+" indexes are missing");return d}(t),s=new Array(e).fill(null).map(Object),r=0;r<n.length;++r){var i=n[r],o=t[r];if(i.length!==o.indexesMapping.length)throw new Error("There are "+i.length+" refinement landmarks while mapping has "+o.indexesMapping.length);$G(o.indexesMapping,i,s),EG(o.indexesMapping,o.zRefinement,i,s)}return s}function AG(n,t){return n.map(function(e){var s=ii(ii({},e),{x:e.x*t.width,y:e.y*t.height});return e.z!=null&&(s.z=e.z*t.width),s})}function RG(n,t){return n==="none"?t:function(e){return 1/(1+Math.exp(-e))}(t)}function ba(n,t,e,s){return Qi(this,void 0,void 0,function(){var r,i,o,a,u,l,c,h;return to(this,function(d){switch(d.label){case 0:return e=e||t.flipHorizontally||!1,s=s||t.flipVertically||!1,r=n.size,i=r/t.numLandmarks,[4,n.data()];case 1:for(o=d.sent(),a=[],u=0;u<t.numLandmarks;++u)l=u*i,(h={x:0,y:0}).x=e?t.inputImageWidth-o[l]:o[l],i>1&&(h.y=s?t.inputImageHeight-o[l+1]:o[l+1]),i>2&&(h.z=o[l+2]),i>3&&(h.score=RG(t.visibilityActivation,o[l+3])),a.push(h);for(c=0;c<a.length;++c)(h=a[c]).x=h.x/t.inputImageWidth,h.y=h.y/t.inputImageHeight,h.z=h.z/t.inputImageWidth/(t.normalizeZ||1);return[2,a]}})})}function t3(n,t,e){var s=n.width,r=n.height,i=n.rotation;if(e.rotation==null&&e.rotationDegree==null||(i=function(c,h){return h.rotation!=null?c+=h.rotation:h.rotationDegree!=null&&(c+=Math.PI*h.rotationDegree/180),Vk(c)}(i,e)),i===0)n.xCenter=n.xCenter+s*e.shiftX,n.yCenter=n.yCenter+r*e.shiftY;else{var o=(t.width*s*e.shiftX*Math.cos(i)-t.height*r*e.shiftY*Math.sin(i))/t.width,a=(t.width*s*e.shiftX*Math.sin(i)+t.height*r*e.shiftY*Math.cos(i))/t.height;n.xCenter=n.xCenter+o,n.yCenter=n.yCenter+a}if(e.squareLong){var u=Math.max(s*t.width,r*t.height);s=u/t.width,r=u/t.height}else if(e.squareShort){var l=Math.min(s*t.width,r*t.height);s=l/t.width,r=l/t.height}return n.width=s*e.scaleX,n.height=r*e.scaleY,n}(vf||(vf={})).MediaPipeFaceDetector="MediaPipeFaceDetector";var Cg={runtime:"tfjs",maxFaces:1,refineLandmarks:!1,landmarkModelUrl:"https://tfhub.dev/mediapipe/tfjs-model/face_landmarks_detection/face_mesh/1"},Ng={flipHorizontal:!1,staticImageMode:!1},e3={shiftX:0,shiftY:0,scaleX:1.5,scaleY:1.5,squareLong:!0},DG={outputTensorSize:{width:192,height:192},outputTensorFloatRange:[0,1],borderMode:"replicate"},n3={numLandmarks:468,inputImageWidth:192,inputImageHeight:192,visibilityActivation:"none",flipHorizontally:!1,flipVertically:!1},OG={numLandmarks:80,inputImageWidth:192,inputImageHeight:192,visibilityActivation:"none",flipHorizontally:!1,flipVertically:!1},s3={numLandmarks:71,inputImageWidth:192,inputImageHeight:192,visibilityActivation:"none",flipHorizontally:!1,flipVertically:!1},r3={numLandmarks:5,inputImageWidth:192,inputImageHeight:192,visibilityActivation:"none",flipHorizontally:!1,flipVertically:!1},FG={indexesMapping:Array.from(Array(468).keys()),zRefinement:"copy"},LG={indexesMapping:[61,146,91,181,84,17,314,405,321,375,291,185,40,39,37,0,267,269,270,409,78,95,88,178,87,14,317,402,318,324,308,191,80,81,82,13,312,311,310,415,76,77,90,180,85,16,315,404,320,307,306,184,74,73,72,11,302,303,304,408,62,96,89,179,86,15,316,403,319,325,292,183,42,41,38,12,268,271,272,407],zRefinement:"none"},PG={indexesMapping:[33,7,163,144,145,153,154,155,133,246,161,160,159,158,157,173,130,25,110,24,23,22,26,112,243,247,30,29,27,28,56,190,226,31,228,229,230,231,232,233,244,113,225,224,223,222,221,189,35,124,46,53,52,65,143,111,117,118,119,120,121,128,245,156,70,63,105,66,107,55,193],zRefinement:"none"},MG={indexesMapping:[263,249,390,373,374,380,381,382,362,466,388,387,386,385,384,398,359,255,339,254,253,252,256,341,463,467,260,259,257,258,286,414,446,261,448,449,450,451,452,453,464,342,445,444,443,442,441,413,265,353,276,283,282,295,372,340,346,347,348,349,350,357,465,383,300,293,334,296,336,285,417],zRefinement:"none"},zG={indexesMapping:[468,469,470,471,472],zRefinement:[33,7,163,144,145,153,154,155,133,246,161,160,159,158,157,173]},BG={indexesMapping:[473,474,475,476,477],zRefinement:[263,249,390,373,374,380,381,382,362,466,388,387,386,385,384,398]},kf,VG=function(){function n(t,e,s,r){this.detector=t,this.landmarkModel=e,this.maxFaces=s,this.withAttention=r,this.prevFaceRectsFromLandmarks=null}return n.prototype.estimateFaces=function(t,e){return Qi(this,void 0,void 0,function(){var s,r,i,o,a,u,l,c,h,d,f,p,m,g=this;return to(this,function(y){switch(y.label){case 0:return s=function(v){if(v==null)return ii({},Ng);var S=ii({},v);return S.flipHorizontal==null&&(S.flipHorizontal=Ng.flipHorizontal),S.staticImageMode==null&&(S.staticImageMode=Ng.staticImageMode),S}(e),t==null?(this.reset(),[2,[]]):(r=Bk(t),i=pt(function(){var v=Kt(Uk(t),"float32");return s.flipHorizontal&&(v=tn(Bn.flipLeftRight(gn(v,0)),[0])),v}),o=this.prevFaceRectsFromLandmarks,s.staticImageMode||o==null||o.length<this.maxFaces?[4,this.detector.detectFaces(i,!1)]:[3,2]);case 1:return(u=y.sent()).length===0?(this.reset(),i.dispose(),[2,[]]):(a=u.map(function(v){return g.faceDetectionFrontDetectionToRoi(v,r)}),[3,3]);case 2:a=[],y.label=3;case 3:return b=.5,w=[],[a,o||[]].forEach(function(v){return v.forEach(function(S){(w=w.filter(function(N){return IG(S,N)<=b})).push(S)})}),l=w,[4,Promise.all(l.map(function(v){return g.faceLandmark(v,i)}))];case 4:for(c=y.sent(),h=[],this.prevFaceRectsFromLandmarks=[],d=0;d<c.length;++d)(f=c[d])!=null&&(this.prevFaceRectsFromLandmarks.push(this.faceLandmarksToRoi(f,r)),(p=AG(f,r))!=null&&p.forEach(function(v,S){var N=Lk.get(S);N!=null&&(v.name=N)}),m=S1(p),h.push({keypoints:p,box:m.locationData.relativeBoundingBox}));return i.dispose(),[2,h]}var b,w})})},n.prototype.dispose=function(){this.detector.dispose(),this.landmarkModel.dispose()},n.prototype.reset=function(){this.detector.reset(),this.prevFaceRectsFromLandmarks=null},n.prototype.faceDetectionFrontDetectionToRoi=function(t,e){return t3(Qb(t,"boundingbox","normRect",e,{rotationVectorStartKeypointIndex:0,rotationVectorEndKeypointIndex:1,rotationVectorTargetAngleDegree:0}),e,e3)},n.prototype.faceLandmark=function(t,e){return Qi(this,void 0,void 0,function(){var s,r,i,o,a,u,l;return to(this,function(c){switch(c.label){case 0:return s=TG(e,DG,t).imageTensor,r=["output_faceflag"].concat(this.withAttention?["output_mesh_identity","output_lips","Identity_6:0","Identity_1:0","Identity_2:0","Identity_5:0"]:["output_mesh"]),i=this.landmarkModel.execute(s,r),o=i[0],a=i.slice(1),[4,o.data()];case 1:return c.sent()[0]<.5?(Se(i),Se(s),[2,null]):this.withAttention?[4,this.tensorsToFaceLandmarksWithAttention(a)]:[3,3];case 2:return u=c.sent(),[3,5];case 3:return[4,this.tensorsToFaceLandmarks(a)];case 4:u=c.sent(),c.label=5;case 5:return l=function(h,d,f){f===void 0&&(f={ignoreRotation:!1});for(var p=[],m=0,g=h;m<g.length;m++){var y=g[m],b=y.x-.5,w=y.y-.5,v=f.ignoreRotation?0:d.rotation,S=Math.cos(v)*b-Math.sin(v)*w,N=Math.sin(v)*b+Math.cos(v)*w;S=S*d.width+d.xCenter,N=N*d.height+d.yCenter;var R=y.z*d.width,L=ii({},y);L.x=S,L.y=N,L.z=R,p.push(L)}return p}(u,t),Se(i),Se(s),[2,l]}})})},n.prototype.tensorsToFaceLandmarks=function(t){return Qi(this,void 0,void 0,function(){return to(this,function(e){return[2,ba(t[0],n3)]})})},n.prototype.tensorsToFaceLandmarksWithAttention=function(t){return Qi(this,void 0,void 0,function(){var e,s,r,i,o,a;return to(this,function(u){switch(u.label){case 0:return[4,ba(t[0],n3)];case 1:return e=u.sent(),[4,ba(t[1],OG)];case 2:return s=u.sent(),[4,ba(t[3],s3)];case 3:return r=u.sent(),[4,ba(t[5],s3)];case 4:return i=u.sent(),[4,ba(t[4],r3)];case 5:return o=u.sent(),[4,ba(t[2],r3)];case 6:return a=u.sent(),[2,_G([e,s,r,i,o,a],[FG,LG,PG,MG,zG,BG])]}})})},n.prototype.faceLandmarksToRoi=function(t,e){return t3(Qb(S1(t),"boundingbox","normRect",e,{rotationVectorStartKeypointIndex:33,rotationVectorEndKeypointIndex:263,rotationVectorTargetAngleDegree:0}),e,e3)},n}();function UG(n){return Qi(this,void 0,void 0,function(){var t,e,s,r;return to(this,function(i){switch(i.label){case 0:return t=function(o){if(o==null)return ii({},Cg);var a=ii({},o);return a.runtime="tfjs",a.maxFaces==null&&(a.maxFaces=Cg.maxFaces),a.refineLandmarks==null&&(a.refineLandmarks=Cg.refineLandmarks),a.landmarkModelUrl==null&&(a.landmarkModelUrl=a.refineLandmarks?"https://tfhub.dev/mediapipe/tfjs-model/face_landmarks_detection/attention_mesh/1":"https://tfhub.dev/mediapipe/tfjs-model/face_landmarks_detection/face_mesh/1"),a}(n),e=typeof t.landmarkModelUrl=="string"&&t.landmarkModelUrl.indexOf("https://tfhub.dev")>-1,[4,pd(t.landmarkModelUrl,{fromTFHub:e})];case 1:return s=i.sent(),[4,SG(vf.MediaPipeFaceDetector,{modelType:"short",maxFaces:t.maxFaces,detectorModelUrl:t.detectorModelUrl,runtime:t.runtime})];case 2:return r=i.sent(),[2,new VG(r,s,t.maxFaces,t.refineLandmarks)]}})})}function WG(n,t){return Qi(this,void 0,void 0,function(){var e,s;return to(this,function(r){if(n===kf.MediaPipeFaceMesh){if(s=void 0,(e=t)!=null){if(e.runtime==="tfjs")return[2,UG(e)];if(e.runtime==="mediapipe")return[2,oG(e)];s=e.runtime}throw new Error("Expect modelConfig.runtime to be either 'tfjs' or 'mediapipe', but got "+s)}throw new Error(n+" is not a supported model name.")})})}(function(n){n.MediaPipeFaceMesh="MediaPipeFaceMesh"})(kf||(kf={}));var GG={};(function(){var n;function t(x){var C=0;return function(){return C<x.length?{done:!1,value:x[C++]}:{done:!0}}}var e=typeof Object.defineProperties=="function"?Object.defineProperty:function(x,C,E){return x==Array.prototype||x==Object.prototype||(x[C]=E.value),x};function s(x){x=[typeof globalThis=="object"&&globalThis,x,typeof window=="object"&&window,typeof self=="object"&&self,typeof ks=="object"&&ks];for(var C=0;C<x.length;++C){var E=x[C];if(E&&E.Math==Math)return E}throw Error("Cannot find global object")}var r=s(this);function i(x,C){if(C)t:{var E=r;x=x.split(".");for(var M=0;M<x.length-1;M++){var Y=x[M];if(!(Y in E))break t;E=E[Y]}x=x[x.length-1],M=E[x],C=C(M),C!=M&&C!=null&&e(E,x,{configurable:!0,writable:!0,value:C})}}i("Symbol",function(x){function C(nt){if(this instanceof C)throw new TypeError("Symbol is not a constructor");return new E(M+(nt||"")+"_"+Y++,nt)}function E(nt,tt){this.h=nt,e(this,"description",{configurable:!0,writable:!0,value:tt})}if(x)return x;E.prototype.toString=function(){return this.h};var M="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Y=0;return C}),i("Symbol.iterator",function(x){if(x)return x;x=Symbol("Symbol.iterator");for(var C="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),E=0;E<C.length;E++){var M=r[C[E]];typeof M=="function"&&typeof M.prototype[x]!="function"&&e(M.prototype,x,{configurable:!0,writable:!0,value:function(){return o(t(this))}})}return x});function o(x){return x={next:x},x[Symbol.iterator]=function(){return this},x}function a(x){var C=typeof Symbol<"u"&&Symbol.iterator&&x[Symbol.iterator];return C?C.call(x):{next:t(x)}}function u(x){if(!(x instanceof Array)){x=a(x);for(var C,E=[];!(C=x.next()).done;)E.push(C.value);x=E}return x}var l=typeof Object.assign=="function"?Object.assign:function(x,C){for(var E=1;E<arguments.length;E++){var M=arguments[E];if(M)for(var Y in M)Object.prototype.hasOwnProperty.call(M,Y)&&(x[Y]=M[Y])}return x};i("Object.assign",function(x){return x||l});var c=typeof Object.create=="function"?Object.create:function(x){function C(){}return C.prototype=x,new C},h;if(typeof Object.setPrototypeOf=="function")h=Object.setPrototypeOf;else{var d;t:{var f={a:!0},p={};try{p.__proto__=f,d=p.a;break t}catch{}d=!1}h=d?function(x,C){if(x.__proto__=C,x.__proto__!==C)throw new TypeError(x+" is not extensible");return x}:null}var m=h;function g(x,C){if(x.prototype=c(C.prototype),x.prototype.constructor=x,m)m(x,C);else for(var E in C)if(E!="prototype")if(Object.defineProperties){var M=Object.getOwnPropertyDescriptor(C,E);M&&Object.defineProperty(x,E,M)}else x[E]=C[E];x.za=C.prototype}function y(){this.m=!1,this.j=null,this.i=void 0,this.h=1,this.v=this.s=0,this.l=null}function b(x){if(x.m)throw new TypeError("Generator is already running");x.m=!0}y.prototype.u=function(x){this.i=x};function w(x,C){x.l={ma:C,na:!0},x.h=x.s||x.v}y.prototype.return=function(x){this.l={return:x},this.h=this.v};function v(x,C,E){return x.h=E,{value:C}}function S(x){this.h=new y,this.i=x}function N(x,C){b(x.h);var E=x.h.j;return E?R(x,"return"in E?E.return:function(M){return{value:M,done:!0}},C,x.h.return):(x.h.return(C),L(x))}function R(x,C,E,M){try{var Y=C.call(x.h.j,E);if(!(Y instanceof Object))throw new TypeError("Iterator result "+Y+" is not an object");if(!Y.done)return x.h.m=!1,Y;var nt=Y.value}catch(tt){return x.h.j=null,w(x.h,tt),L(x)}return x.h.j=null,M.call(x.h,nt),L(x)}function L(x){for(;x.h.h;)try{var C=x.i(x.h);if(C)return x.h.m=!1,{value:C.value,done:!1}}catch(E){x.h.i=void 0,w(x.h,E)}if(x.h.m=!1,x.h.l){if(C=x.h.l,x.h.l=null,C.na)throw C.ma;return{value:C.return,done:!0}}return{value:void 0,done:!0}}function F(x){this.next=function(C){return b(x.h),x.h.j?C=R(x,x.h.j.next,C,x.h.u):(x.h.u(C),C=L(x)),C},this.throw=function(C){return b(x.h),x.h.j?C=R(x,x.h.j.throw,C,x.h.u):(w(x.h,C),C=L(x)),C},this.return=function(C){return N(x,C)},this[Symbol.iterator]=function(){return this}}function B(x){function C(M){return x.next(M)}function E(M){return x.throw(M)}return new Promise(function(M,Y){function nt(tt){tt.done?M(tt.value):Promise.resolve(tt.value).then(C,E).then(nt,Y)}nt(x.next())})}function H(x){return B(new F(new S(x)))}i("Promise",function(x){function C(tt){this.i=0,this.j=void 0,this.h=[],this.u=!1;var mt=this.l();try{tt(mt.resolve,mt.reject)}catch($t){mt.reject($t)}}function E(){this.h=null}function M(tt){return tt instanceof C?tt:new C(function(mt){mt(tt)})}if(x)return x;E.prototype.i=function(tt){if(this.h==null){this.h=[];var mt=this;this.j(function(){mt.m()})}this.h.push(tt)};var Y=r.setTimeout;E.prototype.j=function(tt){Y(tt,0)},E.prototype.m=function(){for(;this.h&&this.h.length;){var tt=this.h;this.h=[];for(var mt=0;mt<tt.length;++mt){var $t=tt[mt];tt[mt]=null;try{$t()}catch(Gt){this.l(Gt)}}}this.h=null},E.prototype.l=function(tt){this.j(function(){throw tt})},C.prototype.l=function(){function tt(Gt){return function(te){$t||($t=!0,Gt.call(mt,te))}}var mt=this,$t=!1;return{resolve:tt(this.I),reject:tt(this.m)}},C.prototype.I=function(tt){if(tt===this)this.m(new TypeError("A Promise cannot resolve to itself"));else if(tt instanceof C)this.L(tt);else{t:switch(typeof tt){case"object":var mt=tt!=null;break t;case"function":mt=!0;break t;default:mt=!1}mt?this.F(tt):this.s(tt)}},C.prototype.F=function(tt){var mt=void 0;try{mt=tt.then}catch($t){this.m($t);return}typeof mt=="function"?this.M(mt,tt):this.s(tt)},C.prototype.m=function(tt){this.v(2,tt)},C.prototype.s=function(tt){this.v(1,tt)},C.prototype.v=function(tt,mt){if(this.i!=0)throw Error("Cannot settle("+tt+", "+mt+"): Promise already settled in state"+this.i);this.i=tt,this.j=mt,this.i===2&&this.K(),this.H()},C.prototype.K=function(){var tt=this;Y(function(){if(tt.D()){var mt=r.console;typeof mt<"u"&&mt.error(tt.j)}},1)},C.prototype.D=function(){if(this.u)return!1;var tt=r.CustomEvent,mt=r.Event,$t=r.dispatchEvent;return typeof $t>"u"?!0:(typeof tt=="function"?tt=new tt("unhandledrejection",{cancelable:!0}):typeof mt=="function"?tt=new mt("unhandledrejection",{cancelable:!0}):(tt=r.document.createEvent("CustomEvent"),tt.initCustomEvent("unhandledrejection",!1,!0,tt)),tt.promise=this,tt.reason=this.j,$t(tt))},C.prototype.H=function(){if(this.h!=null){for(var tt=0;tt<this.h.length;++tt)nt.i(this.h[tt]);this.h=null}};var nt=new E;return C.prototype.L=function(tt){var mt=this.l();tt.T(mt.resolve,mt.reject)},C.prototype.M=function(tt,mt){var $t=this.l();try{tt.call(mt,$t.resolve,$t.reject)}catch(Gt){$t.reject(Gt)}},C.prototype.then=function(tt,mt){function $t(ye,ue){return typeof ye=="function"?function(Ne){try{Gt(ye(Ne))}catch(Be){te(Be)}}:ue}var Gt,te,Ce=new C(function(ye,ue){Gt=ye,te=ue});return this.T($t(tt,Gt),$t(mt,te)),Ce},C.prototype.catch=function(tt){return this.then(void 0,tt)},C.prototype.T=function(tt,mt){function $t(){switch(Gt.i){case 1:tt(Gt.j);break;case 2:mt(Gt.j);break;default:throw Error("Unexpected state: "+Gt.i)}}var Gt=this;this.h==null?nt.i($t):this.h.push($t),this.u=!0},C.resolve=M,C.reject=function(tt){return new C(function(mt,$t){$t(tt)})},C.race=function(tt){return new C(function(mt,$t){for(var Gt=a(tt),te=Gt.next();!te.done;te=Gt.next())M(te.value).T(mt,$t)})},C.all=function(tt){var mt=a(tt),$t=mt.next();return $t.done?M([]):new C(function(Gt,te){function Ce(Ne){return function(Be){ye[Ne]=Be,ue--,ue==0&&Gt(ye)}}var ye=[],ue=0;do ye.push(void 0),ue++,M($t.value).T(Ce(ye.length-1),te),$t=mt.next();while(!$t.done)})},C});function z(x,C){x instanceof String&&(x+="");var E=0,M=!1,Y={next:function(){if(!M&&E<x.length){var nt=E++;return{value:C(nt,x[nt]),done:!1}}return M=!0,{done:!0,value:void 0}}};return Y[Symbol.iterator]=function(){return Y},Y}i("Array.prototype.keys",function(x){return x||function(){return z(this,function(C){return C})}}),i("Array.prototype.fill",function(x){return x||function(C,E,M){var Y=this.length||0;for(0>E&&(E=Math.max(0,Y+E)),(M==null||M>Y)&&(M=Y),M=Number(M),0>M&&(M=Math.max(0,Y+M)),E=Number(E||0);E<M;E++)this[E]=C;return this}});function G(x){return x||Array.prototype.fill}i("Int8Array.prototype.fill",G),i("Uint8Array.prototype.fill",G),i("Uint8ClampedArray.prototype.fill",G),i("Int16Array.prototype.fill",G),i("Uint16Array.prototype.fill",G),i("Int32Array.prototype.fill",G),i("Uint32Array.prototype.fill",G),i("Float32Array.prototype.fill",G),i("Float64Array.prototype.fill",G),i("Object.is",function(x){return x||function(C,E){return C===E?C!==0||1/C===1/E:C!==C&&E!==E}}),i("Array.prototype.includes",function(x){return x||function(C,E){var M=this;M instanceof String&&(M=String(M));var Y=M.length;for(E=E||0,0>E&&(E=Math.max(E+Y,0));E<Y;E++){var nt=M[E];if(nt===C||Object.is(nt,C))return!0}return!1}}),i("String.prototype.includes",function(x){return x||function(C,E){if(this==null)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(C instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return this.indexOf(C,E||0)!==-1}});var T=this||self;function K(x,C){x=x.split(".");var E=T;x[0]in E||typeof E.execScript>"u"||E.execScript("var "+x[0]);for(var M;x.length&&(M=x.shift());)x.length||C===void 0?E[M]&&E[M]!==Object.prototype[M]?E=E[M]:E=E[M]={}:E[M]=C}function ht(x){var C;t:{if((C=T.navigator)&&(C=C.userAgent))break t;C=""}return C.indexOf(x)!=-1}var rt=Array.prototype.map?function(x,C){return Array.prototype.map.call(x,C,void 0)}:function(x,C){for(var E=x.length,M=Array(E),Y=typeof x=="string"?x.split(""):x,nt=0;nt<E;nt++)nt in Y&&(M[nt]=C.call(void 0,Y[nt],nt,x));return M},gt={},at=null;function It(x){var C=x.length,E=3*C/4;E%3?E=Math.floor(E):"=.".indexOf(x[C-1])!=-1&&(E="=.".indexOf(x[C-2])!=-1?E-2:E-1);var M=new Uint8Array(E),Y=0;return et(x,function(nt){M[Y++]=nt}),Y!==E?M.subarray(0,Y):M}function et(x,C){function E($t){for(;M<x.length;){var Gt=x.charAt(M++),te=at[Gt];if(te!=null)return te;if(!/^[\s\xa0]*$/.test(Gt))throw Error("Unknown base64 encoding at char: "+Gt)}return $t}st();for(var M=0;;){var Y=E(-1),nt=E(0),tt=E(64),mt=E(64);if(mt===64&&Y===-1)break;C(Y<<2|nt>>4),tt!=64&&(C(nt<<4&240|tt>>2),mt!=64&&C(tt<<6&192|mt))}}function st(){if(!at){at={};for(var x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),C=["+/=","+/","-_=","-_.","-_"],E=0;5>E;E++){var M=x.concat(C[E].split(""));gt[E]=M;for(var Y=0;Y<M.length;Y++){var nt=M[Y];at[nt]===void 0&&(at[nt]=Y)}}}}var St=typeof Uint8Array<"u",kt=!(ht("Trident")||ht("MSIE"))&&typeof T.btoa=="function";function yt(x){if(!kt){var C;C===void 0&&(C=0),st(),C=gt[C];for(var E=Array(Math.floor(x.length/3)),M=C[64]||"",Y=0,nt=0;Y<x.length-2;Y+=3){var tt=x[Y],mt=x[Y+1],$t=x[Y+2],Gt=C[tt>>2];tt=C[(tt&3)<<4|mt>>4],mt=C[(mt&15)<<2|$t>>6],$t=C[$t&63],E[nt++]=Gt+tt+mt+$t}switch(Gt=0,$t=M,x.length-Y){case 2:Gt=x[Y+1],$t=C[(Gt&15)<<2]||M;case 1:x=x[Y],E[nt]=C[x>>2]+C[(x&3)<<4|Gt>>4]+$t+M}return E.join("")}for(C="";10240<x.length;)C+=String.fromCharCode.apply(null,x.subarray(0,10240)),x=x.subarray(10240);return C+=String.fromCharCode.apply(null,x),btoa(C)}var Pt=RegExp("[-_.]","g");function Xt(x){switch(x){case"-":return"+";case"_":return"/";case".":return"=";default:return""}}function Wt(x){if(!kt)return It(x);Pt.test(x)&&(x=x.replace(Pt,Xt)),x=atob(x);for(var C=new Uint8Array(x.length),E=0;E<x.length;E++)C[E]=x.charCodeAt(E);return C}var Bt;function Jt(){return Bt||(Bt=new Uint8Array(0))}var jt={},be=typeof Uint8Array.prototype.slice=="function",ce=0,O=0;function Nt(x){var C=0>x;x=Math.abs(x);var E=x>>>0;x=Math.floor((x-E)/4294967296),C&&(E=a(q(E,x)),C=E.next().value,x=E.next().value,E=C),ce=E>>>0,O=x>>>0}var xt=typeof BigInt=="function";function q(x,C){return C=~C,x?x=~x+1:C+=1,[x,C]}function j(x,C){this.i=x>>>0,this.h=C>>>0}function ft(x){if(!x)return At||(At=new j(0,0));if(!/^-?\d+$/.test(x))return null;if(16>x.length)Nt(Number(x));else if(xt)x=BigInt(x),ce=Number(x&BigInt(4294967295))>>>0,O=Number(x>>BigInt(32)&BigInt(4294967295));else{var C=+(x[0]==="-");O=ce=0;for(var E=x.length,M=C,Y=(E-C)%6+C;Y<=E;M=Y,Y+=6)M=Number(x.slice(M,Y)),O*=1e6,ce=1e6*ce+M,4294967296<=ce&&(O+=ce/4294967296|0,ce%=4294967296);C&&(C=a(q(ce,O)),x=C.next().value,C=C.next().value,ce=x,O=C)}return new j(ce,O)}var At;function Rt(x,C){return Error("Invalid wire type: "+x+" (at position "+C+")")}function bt(){return Error("Failed to read varint, encoding is invalid.")}function Ut(x,C){return Error("Tried to read past the end of the data "+C+" > "+x)}function qt(){throw Error("Invalid UTF8")}function zt(x,C){return C=String.fromCharCode.apply(null,C),x==null?C:x+C}var ne=void 0,Te,me=typeof TextDecoder<"u",on,ms=typeof TextEncoder<"u",$n;function Bs(x){if(x!==jt)throw Error("illegal external caller")}function We(x,C){if(Bs(C),this.V=x,x!=null&&x.length===0)throw Error("ByteString should be constructed with non-empty values")}function ln(){return $n||($n=new We(null,jt))}function en(x){Bs(jt);var C=x.V;return C=C==null||St&&C!=null&&C instanceof Uint8Array?C:typeof C=="string"?Wt(C):null,C==null?C:x.V=C}function Ye(x){if(typeof x=="string")return{buffer:Wt(x),C:!1};if(Array.isArray(x))return{buffer:new Uint8Array(x),C:!1};if(x.constructor===Uint8Array)return{buffer:x,C:!1};if(x.constructor===ArrayBuffer)return{buffer:new Uint8Array(x),C:!1};if(x.constructor===We)return{buffer:en(x)||Jt(),C:!0};if(x instanceof Uint8Array)return{buffer:new Uint8Array(x.buffer,x.byteOffset,x.byteLength),C:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}function Fn(x,C){this.i=null,this.m=!1,this.h=this.j=this.l=0,mr(this,x,C)}function mr(x,C,E){E=E===void 0?{}:E,x.S=E.S===void 0?!1:E.S,C&&(C=Ye(C),x.i=C.buffer,x.m=C.C,x.l=0,x.j=x.i.length,x.h=x.l)}Fn.prototype.reset=function(){this.h=this.l};function Ge(x,C){if(x.h=C,C>x.j)throw Ut(x.j,C)}function Vs(x){var C=x.i,E=x.h,M=C[E++],Y=M&127;if(M&128&&(M=C[E++],Y|=(M&127)<<7,M&128&&(M=C[E++],Y|=(M&127)<<14,M&128&&(M=C[E++],Y|=(M&127)<<21,M&128&&(M=C[E++],Y|=M<<28,M&128&&C[E++]&128&&C[E++]&128&&C[E++]&128&&C[E++]&128&&C[E++]&128)))))throw bt();return Ge(x,E),Y}function qr(x,C){if(0>C)throw Error("Tried to read a negative byte length: "+C);var E=x.h,M=E+C;if(M>x.j)throw Ut(C,x.j-E);return x.h=M,E}var Xn=[];function _n(){this.h=[]}_n.prototype.length=function(){return this.h.length},_n.prototype.end=function(){var x=this.h;return this.h=[],x};function Le(x,C,E){for(;0<E||127<C;)x.h.push(C&127|128),C=(C>>>7|E<<25)>>>0,E>>>=7;x.h.push(C)}function _r(x,C){for(;127<C;)x.h.push(C&127|128),C>>>=7;x.h.push(C)}function mi(x,C){if(Xn.length){var E=Xn.pop();mr(E,x,C),x=E}else x=new Fn(x,C);this.h=x,this.j=this.h.h,this.i=this.l=-1,this.setOptions(C)}mi.prototype.setOptions=function(x){x=x===void 0?{}:x,this.ca=x.ca===void 0?!1:x.ca},mi.prototype.reset=function(){this.h.reset(),this.j=this.h.h,this.i=this.l=-1};function gi(x){var C=x.h;if(C.h==C.j)return!1;x.j=x.h.h;var E=Vs(x.h)>>>0;if(C=E>>>3,E&=7,!(0<=E&&5>=E))throw Rt(E,x.j);if(1>C)throw Error("Invalid field number: "+C+" (at position "+x.j+")");return x.l=C,x.i=E,!0}function Ar(x){switch(x.i){case 0:if(x.i!=0)Ar(x);else t:{x=x.h;for(var C=x.h,E=C+10,M=x.i;C<E;)if(!(M[C++]&128)){Ge(x,C);break t}throw bt()}break;case 1:x=x.h,Ge(x,x.h+8);break;case 2:x.i!=2?Ar(x):(C=Vs(x.h)>>>0,x=x.h,Ge(x,x.h+C));break;case 5:x=x.h,Ge(x,x.h+4);break;case 3:C=x.l;do{if(!gi(x))throw Error("Unmatched start-group tag: stream EOF");if(x.i==4){if(x.l!=C)throw Error("Unmatched end-group tag");break}Ar(x)}while(1);break;default:throw Rt(x.i,x.j)}}var Us=[];function wo(){this.j=[],this.i=0,this.h=new _n}function Wn(x,C){C.length!==0&&(x.j.push(C),x.i+=C.length)}function Rr(x,C){if(C=C.R){Wn(x,x.h.end());for(var E=0;E<C.length;E++)Wn(x,en(C[E])||Jt())}}var Js=typeof Symbol=="function"&&typeof Symbol()=="symbol"?Symbol():void 0;function Xr(x,C){return Js?x[Js]|=C:x.A!==void 0?x.A|=C:(Object.defineProperties(x,{A:{value:C,configurable:!0,writable:!0,enumerable:!1}}),C)}function Ln(x,C){Js?x[Js]&&(x[Js]&=~C):x.A!==void 0&&(x.A&=~C)}function Je(x){var C;return Js?C=x[Js]:C=x.A,C??0}function Ws(x,C){Js?x[Js]=C:x.A!==void 0?x.A=C:Object.defineProperties(x,{A:{value:C,configurable:!0,writable:!0,enumerable:!1}})}function yi(x){return Xr(x,1),x}function du(x,C){Ws(C,(x|0)&-51)}function gr(x,C){Ws(C,(x|18)&-41)}var ua={};function Gi(x){return x!==null&&typeof x=="object"&&!Array.isArray(x)&&x.constructor===Object}var bi,la=[];Ws(la,23),bi=Object.freeze(la);function xi(x){if(Je(x.o)&2)throw Error("Cannot mutate an immutable Message")}function yr(x){var C=x.length;(C=C?x[C-1]:void 0)&&Gi(C)?C.g=1:(C={},x.push((C.g=1,C)))}function fu(x){var C=x.i+x.G;return x.B||(x.B=x.o[C]={})}function Gs(x,C){return C===-1?null:C>=x.i?x.B?x.B[C]:void 0:x.o[C+x.G]}function gs(x,C,E,M){xi(x),wi(x,C,E,M)}function wi(x,C,E,M){x.j&&(x.j=void 0),C>=x.i||M?fu(x)[C]=E:(x.o[C+x.G]=E,(x=x.B)&&C in x&&delete x[C])}function ji(x,C,E,M){var Y=Gs(x,C);Array.isArray(Y)||(Y=bi);var nt=Je(Y);if(nt&1||yi(Y),M)nt&2||Xr(Y,2),E&1||Object.freeze(Y);else{M=!(E&2);var tt=nt&2;E&1||!tt?M&&nt&16&&!tt&&Ln(Y,16):(Y=yi(Array.prototype.slice.call(Y)),wi(x,C,Y))}return Y}function Hi(x,C){var E=Gs(x,C),M=E==null?E:typeof E=="number"||E==="NaN"||E==="Infinity"||E==="-Infinity"?Number(E):void 0;return M!=null&&M!==E&&wi(x,C,M),M}function vo(x,C,E,M,Y){x.h||(x.h={});var nt=x.h[E],tt=ji(x,E,3,Y);if(!nt){var mt=tt;nt=[];var $t=!!(Je(x.o)&16);tt=!!(Je(mt)&2);var Gt=mt;!Y&&tt&&(mt=Array.prototype.slice.call(mt));for(var te=tt,Ce=0;Ce<mt.length;Ce++){var ye=mt[Ce],ue=C,Ne=!1;if(Ne=Ne===void 0?!1:Ne,ye=Array.isArray(ye)?new ue(ye):Ne?new ue:void 0,ye!==void 0){ue=ye.o;var Be=Ne=Je(ue);tt&&(Be|=2),$t&&(Be|=16),Be!=Ne&&Ws(ue,Be),ue=Be,te=te||!!(2&ue),nt.push(ye)}}return x.h[E]=nt,$t=Je(mt),C=$t|33,C=te?C&-9:C|8,$t!=C&&(te=mt,Object.isFrozen(te)&&(te=Array.prototype.slice.call(te)),Ws(te,C),mt=te),Gt!==mt&&wi(x,E,mt),(Y||M&&tt)&&Xr(nt,2),M&&Object.freeze(nt),nt}return Y||(Y=Object.isFrozen(nt),M&&!Y?Object.freeze(nt):!M&&Y&&(nt=Array.prototype.slice.call(nt),x.h[E]=nt)),nt}function Yr(x,C,E){var M=!!(Je(x.o)&2);if(C=vo(x,C,E,M,M),x=ji(x,E,3,M),!(M||Je(x)&8)){for(M=0;M<C.length;M++){if(E=C[M],Je(E.o)&2){var Y=Jr(E,!1);Y.j=E}else Y=E;E!==Y&&(C[M]=Y,x[M]=Y.o)}Xr(x,8)}return C}function Yn(x,C,E){if(E!=null&&typeof E!="number")throw Error("Value of float/double field must be a number|null|undefined, found "+typeof E+": "+E);gs(x,C,E)}function Cs(x,C,E,M,Y){xi(x);var nt=vo(x,E,C,!1,!1);return E=M??new E,x=ji(x,C,2,!1),Y!=null?(nt.splice(Y,0,E),x.splice(Y,0,E.o)):(nt.push(E),x.push(E.o)),E.C()&&Ln(x,8),E}function ko(x,C){return x??C}function Qs(x,C,E){return E=E===void 0?0:E,ko(Hi(x,C),E)}var Ki;function ca(x){switch(typeof x){case"number":return isFinite(x)?x:String(x);case"object":if(x)if(Array.isArray(x)){if(Je(x)&128)return x=Array.prototype.slice.call(x),yr(x),x}else{if(St&&x!=null&&x instanceof Uint8Array)return yt(x);if(x instanceof We){var C=x.V;return C==null?"":typeof C=="string"?C:x.V=yt(C)}}}return x}function ys(x,C,E,M){if(x!=null){if(Array.isArray(x))x=So(x,C,E,M!==void 0);else if(Gi(x)){var Y={},nt;for(nt in x)Y[nt]=ys(x[nt],C,E,M);x=Y}else x=C(x,M);return x}}function So(x,C,E,M){var Y=Je(x);M=M?!!(Y&16):void 0,x=Array.prototype.slice.call(x);for(var nt=0;nt<x.length;nt++)x[nt]=ys(x[nt],C,E,M);return E(Y,x),x}function Zr(x){return x.ja===ua?x.toJSON():ca(x)}function pu(x,C){x&128&&yr(C)}function Io(x,C,E){if(E=E===void 0?gr:E,x!=null){if(St&&x instanceof Uint8Array)return x.length?new We(new Uint8Array(x),jt):ln();if(Array.isArray(x)){var M=Je(x);return M&2?x:C&&!(M&32)&&(M&16||M===0)?(Ws(x,M|2),x):(x=So(x,Io,M&4?gr:E,!0),C=Je(x),C&4&&C&2&&Object.freeze(x),x)}return x.ja===ua?gu(x):x}}function mu(x,C,E,M,Y,nt,tt){if(x=x.h&&x.h[E]){if(M=Je(x),M&2?M=x:(nt=rt(x,gu),gr(M,nt),Object.freeze(nt),M=nt),xi(C),tt=M==null?bi:yi([]),M!=null){for(nt=!!M.length,x=0;x<M.length;x++){var mt=M[x];nt=nt&&!(Je(mt.o)&2),tt[x]=mt.o}nt=(nt?8:0)|1,x=Je(tt),(x&nt)!==nt&&(Object.isFrozen(tt)&&(tt=Array.prototype.slice.call(tt)),Ws(tt,x|nt)),C.h||(C.h={}),C.h[E]=M}else C.h&&(C.h[E]=void 0);wi(C,E,tt,Y)}else gs(C,E,Io(M,nt,tt),Y)}function gu(x){return Je(x.o)&2||(x=Jr(x,!0),Xr(x.o,2)),x}function Jr(x,C){var E=x.o,M=[];Xr(M,16);var Y=x.constructor.h;if(Y&&M.push(Y),Y=x.B,Y){M.length=E.length,M.fill(void 0,M.length,E.length);var nt={};M[M.length-1]=nt}Je(E)&128&&yr(M),C=C||x.C()?gr:du,nt=x.constructor,Ki=M,M=new nt(M),Ki=void 0,x.R&&(M.R=x.R.slice()),nt=!!(Je(E)&16);for(var tt=Y?E.length-1:E.length,mt=0;mt<tt;mt++)mu(x,M,mt-x.G,E[mt],!1,nt,C);if(Y)for(var $t in Y)mu(x,M,+$t,Y[$t],!0,nt,C);return M}function Zn(x,C,E){x==null&&(x=Ki),Ki=void 0;var M=this.constructor.i||0,Y=0<M,nt=this.constructor.h,tt=!1;if(x==null){x=nt?[nt]:[];var mt=48,$t=!0;Y&&(M=0,mt|=128),Ws(x,mt)}else{if(!Array.isArray(x)||nt&&nt!==x[0])throw Error();var Gt=mt=Xr(x,0);if(($t=(16&Gt)!==0)&&((tt=(32&Gt)!==0)||(Gt|=32)),Y){if(128&Gt)M=0;else if(0<x.length){var te=x[x.length-1];if(Gi(te)&&"g"in te){M=0,Gt|=128,delete te.g;var Ce=!0,ye;for(ye in te){Ce=!1;break}Ce&&x.pop()}}}else if(128&Gt)throw Error();mt!==Gt&&Ws(x,Gt)}this.G=(nt?0:-1)-M,this.h=void 0,this.o=x;t:{if(nt=this.o.length,M=nt-1,nt&&(nt=this.o[M],Gi(nt))){this.B=nt,this.i=M-this.G;break t}C!==void 0&&-1<C?(this.i=Math.max(C,M+1-this.G),this.B=void 0):this.i=Number.MAX_VALUE}if(!Y&&this.B&&"g"in this.B)throw Error('Unexpected "g" flag in sparse object of message that is not a group type.');if(E){C=$t&&!tt&&!0,Y=this.i;var ue;for($t=0;$t<E.length;$t++)tt=E[$t],tt<Y?(tt+=this.G,(M=x[tt])?ha(M,C):x[tt]=bi):(ue||(ue=fu(this)),(M=ue[tt])?ha(M,C):ue[tt]=bi)}}Zn.prototype.toJSON=function(){return So(this.o,Zr,pu)},Zn.prototype.C=function(){return!!(Je(this.o)&2)};function ha(x,C){if(Array.isArray(x)){var E=Je(x),M=1;!C||E&2||(M|=16),(E&M)!==M&&Ws(x,E|M)}}Zn.prototype.ja=ua,Zn.prototype.toString=function(){return this.o.toString()};function yu(x,C,E){if(E){var M={},Y;for(Y in E){var nt=E[Y],tt=nt.ra;tt||(M.J=nt.xa||nt.oa.W,nt.ia?(M.aa=pa(nt.ia),tt=function(mt){return function($t,Gt,te){return mt.J($t,Gt,te,mt.aa)}}(M)):nt.ka?(M.Z=ma(nt.da.P,nt.ka),tt=function(mt){return function($t,Gt,te){return mt.J($t,Gt,te,mt.Z)}}(M)):tt=M.J,nt.ra=tt),tt(C,x,nt.da),M={J:M.J,aa:M.aa,Z:M.Z}}}Rr(C,x)}var Co=Symbol();function No(x,C,E){return x[Co]||(x[Co]=function(M,Y){return C(M,Y,E)})}function To(x){var C=x[Co];if(!C){var E=ze(x);C=function(M,Y){return Ae(M,Y,E)},x[Co]=C}return C}function da(x){var C=x.ia;if(C)return To(C);if(C=x.wa)return No(x.da.P,C,x.ka)}function fa(x){var C=da(x),E=x.da,M=x.oa.U;return C?function(Y,nt){return M(Y,nt,E,C)}:function(Y,nt){return M(Y,nt,E)}}function $o(x,C){var E=x[C];return typeof E=="function"&&E.length===0&&(E=E(),x[C]=E),Array.isArray(E)&&(Ct in E||I in E||0<E.length&&typeof E[0]=="function")?E:void 0}function Eo(x,C,E,M,Y,nt){C.P=x[0];var tt=1;if(x.length>tt&&typeof x[tt]!="number"){var mt=x[tt++];E(C,mt)}for(;tt<x.length;){E=x[tt++];for(var $t=tt+1;$t<x.length&&typeof x[$t]!="number";)$t++;switch(mt=x[tt++],$t-=tt,$t){case 0:M(C,E,mt);break;case 1:($t=$o(x,tt))?(tt++,Y(C,E,mt,$t)):M(C,E,mt,x[tt++]);break;case 2:$t=tt++,$t=$o(x,$t),Y(C,E,mt,$t,x[tt++]);break;case 3:nt(C,E,mt,x[tt++],x[tt++],x[tt++]);break;case 4:nt(C,E,mt,x[tt++],x[tt++],x[tt++],x[tt++]);break;default:throw Error("unexpected number of binary field arguments: "+$t)}}return C}var vi=Symbol();function pa(x){var C=x[vi];if(!C){var E=Dt(x);C=function(M,Y){return Ie(M,Y,E)},x[vi]=C}return C}function ma(x,C){var E=x[vi];return E||(E=function(M,Y){return yu(M,Y,C)},x[vi]=E),E}var I=Symbol();function $(x,C){x.push(C)}function D(x,C,E){x.push(C,E.W)}function J(x,C,E,M){var Y=pa(M),nt=Dt(M).P,tt=E.W;x.push(C,function(mt,$t,Gt){return tt(mt,$t,Gt,nt,Y)})}function wt(x,C,E,M,Y,nt){var tt=ma(M,nt),mt=E.W;x.push(C,function($t,Gt,te){return mt($t,Gt,te,M,tt)})}function Dt(x){var C=x[I];return C||(C=Eo(x,x[I]=[],$,D,J,wt),Ct in x&&I in x&&(x.length=0),C)}var Ct=Symbol();function Ft(x,C){x[0]=C}function Ht(x,C,E,M){var Y=E.U;x[C]=M?function(nt,tt,mt){return Y(nt,tt,mt,M)}:Y}function ae(x,C,E,M,Y){var nt=E.U,tt=To(M),mt=ze(M).P;x[C]=function($t,Gt,te){return nt($t,Gt,te,mt,tt,Y)}}function ve(x,C,E,M,Y,nt,tt){var mt=E.U,$t=No(M,Y,nt);x[C]=function(Gt,te,Ce){return mt(Gt,te,Ce,M,$t,tt)}}function ze(x){var C=x[Ct];return C||(C=Eo(x,x[Ct]={},Ft,Ht,ae,ve),Ct in x&&I in x&&(x.length=0),C)}function Ae(x,C,E){for(;gi(C)&&C.i!=4;){var M=C.l,Y=E[M];if(!Y){var nt=E[0];nt&&(nt=nt[M])&&(Y=E[M]=fa(nt))}if(!Y||!Y(C,x,M)){Y=C,M=x,nt=Y.j,Ar(Y);var tt=Y;if(!tt.ca){if(Y=tt.h.h-nt,tt.h.h=nt,tt=tt.h,Y==0)Y=ln();else{if(nt=qr(tt,Y),tt.S&&tt.m)Y=tt.i.subarray(nt,nt+Y);else{tt=tt.i;var mt=nt;Y=nt+Y,Y=mt===Y?Jt():be?tt.slice(mt,Y):new Uint8Array(tt.subarray(mt,Y))}Y=Y.length==0?ln():new We(Y,jt)}(nt=M.R)?nt.push(Y):M.R=[Y]}}}return x}function Ie(x,C,E){for(var M=E.length,Y=M%2==1,nt=Y?1:0;nt<M;nt+=2)(0,E[nt+1])(C,x,E[nt]);yu(x,C,Y?E[0]:void 0)}function le(x,C){return{U:x,W:C}}var k=le(function(x,C,E){if(x.i!==5)return!1;x=x.h;var M=x.i,Y=x.h,nt=M[Y],tt=M[Y+1],mt=M[Y+2];return M=M[Y+3],Ge(x,x.h+4),tt=(nt<<0|tt<<8|mt<<16|M<<24)>>>0,x=2*(tt>>31)+1,nt=tt>>>23&255,tt&=8388607,gs(C,E,nt==255?tt?NaN:1/0*x:nt==0?x*Math.pow(2,-149)*tt:x*Math.pow(2,nt-150)*(tt+Math.pow(2,23))),!0},function(x,C,E){if(C=Hi(C,E),C!=null){_r(x.h,8*E+5),x=x.h;var M=+C;M===0?0<1/M?ce=O=0:(O=0,ce=2147483648):isNaN(M)?(O=0,ce=2147483647):(M=(E=0>M?-2147483648:0)?-M:M,34028234663852886e22<M?(O=0,ce=(E|2139095040)>>>0):11754943508222875e-54>M?(M=Math.round(M/Math.pow(2,-149)),O=0,ce=(E|M)>>>0):(C=Math.floor(Math.log(M)/Math.LN2),M*=Math.pow(2,-C),M=Math.round(8388608*M),16777216<=M&&++C,O=0,ce=(E|C+127<<23|M&8388607)>>>0)),E=ce,x.h.push(E>>>0&255),x.h.push(E>>>8&255),x.h.push(E>>>16&255),x.h.push(E>>>24&255)}}),A=le(function(x,C,E){if(x.i!==0)return!1;var M=x.h,Y=0,nt=x=0,tt=M.i,mt=M.h;do{var $t=tt[mt++];Y|=($t&127)<<nt,nt+=7}while(32>nt&&$t&128);for(32<nt&&(x|=($t&127)>>4),nt=3;32>nt&&$t&128;nt+=7)$t=tt[mt++],x|=($t&127)<<nt;if(Ge(M,mt),128>$t)M=Y>>>0,$t=x>>>0,(x=$t&2147483648)&&(M=~M+1>>>0,$t=~$t>>>0,M==0&&($t=$t+1>>>0)),M=4294967296*$t+(M>>>0);else throw bt();return gs(C,E,x?-M:M),!0},function(x,C,E){C=Gs(C,E),C!=null&&(typeof C=="string"&&ft(C),C!=null&&(_r(x.h,8*E),typeof C=="number"?(x=x.h,Nt(C),Le(x,ce,O)):(E=ft(C),Le(x.h,E.i,E.h))))}),P=le(function(x,C,E){return x.i!==0?!1:(gs(C,E,Vs(x.h)),!0)},function(x,C,E){if(C=Gs(C,E),C!=null&&C!=null)if(_r(x.h,8*E),x=x.h,E=C,0<=E)_r(x,E);else{for(C=0;9>C;C++)x.h.push(E&127|128),E>>=7;x.h.push(1)}}),W=le(function(x,C,E){if(x.i!==2)return!1;var M=Vs(x.h)>>>0;x=x.h;var Y=qr(x,M);if(x=x.i,me){var nt=x,tt;(tt=Te)||(tt=Te=new TextDecoder("utf-8",{fatal:!0})),x=Y+M,nt=Y===0&&x===nt.length?nt:nt.subarray(Y,x);try{var mt=tt.decode(nt)}catch(Ce){if(ne===void 0){try{tt.decode(new Uint8Array([128]))}catch{}try{tt.decode(new Uint8Array([97])),ne=!0}catch{ne=!1}}throw!ne&&(Te=void 0),Ce}}else{mt=Y,M=mt+M,Y=[];for(var $t=null,Gt,te;mt<M;)Gt=x[mt++],128>Gt?Y.push(Gt):224>Gt?mt>=M?qt():(te=x[mt++],194>Gt||(te&192)!==128?(mt--,qt()):Y.push((Gt&31)<<6|te&63)):240>Gt?mt>=M-1?qt():(te=x[mt++],(te&192)!==128||Gt===224&&160>te||Gt===237&&160<=te||((nt=x[mt++])&192)!==128?(mt--,qt()):Y.push((Gt&15)<<12|(te&63)<<6|nt&63)):244>=Gt?mt>=M-2?qt():(te=x[mt++],(te&192)!==128||(Gt<<28)+(te-144)>>30||((nt=x[mt++])&192)!==128||((tt=x[mt++])&192)!==128?(mt--,qt()):(Gt=(Gt&7)<<18|(te&63)<<12|(nt&63)<<6|tt&63,Gt-=65536,Y.push((Gt>>10&1023)+55296,(Gt&1023)+56320))):qt(),8192<=Y.length&&($t=zt($t,Y),Y.length=0);mt=zt($t,Y)}return gs(C,E,mt),!0},function(x,C,E){if(C=Gs(C,E),C!=null){var M=!1;if(M=M===void 0?!1:M,ms){if(M&&/(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])/.test(C))throw Error("Found an unpaired surrogate");C=(on||(on=new TextEncoder)).encode(C)}else{for(var Y=0,nt=new Uint8Array(3*C.length),tt=0;tt<C.length;tt++){var mt=C.charCodeAt(tt);if(128>mt)nt[Y++]=mt;else{if(2048>mt)nt[Y++]=mt>>6|192;else{if(55296<=mt&&57343>=mt){if(56319>=mt&&tt<C.length){var $t=C.charCodeAt(++tt);if(56320<=$t&&57343>=$t){mt=1024*(mt-55296)+$t-56320+65536,nt[Y++]=mt>>18|240,nt[Y++]=mt>>12&63|128,nt[Y++]=mt>>6&63|128,nt[Y++]=mt&63|128;continue}else tt--}if(M)throw Error("Found an unpaired surrogate");mt=65533}nt[Y++]=mt>>12|224,nt[Y++]=mt>>6&63|128}nt[Y++]=mt&63|128}}C=Y===nt.length?nt:nt.subarray(0,Y)}_r(x.h,8*E+2),_r(x.h,C.length),Wn(x,x.h.end()),Wn(x,C)}}),Z=le(function(x,C,E,M,Y){if(x.i!==2)return!1;C=Cs(C,E,M),E=x.h.j,M=Vs(x.h)>>>0;var nt=x.h.h+M,tt=nt-E;if(0>=tt&&(x.h.j=nt,Y(C,x,void 0,void 0,void 0),tt=nt-x.h.h),tt)throw Error("Message parsing ended unexpectedly. Expected to read "+(M+" bytes, instead read "+(M-tt)+" bytes, either the data ended unexpectedly or the message misreported its own length"));return x.h.h=nt,x.h.j=E,!0},function(x,C,E,M,Y){if(C=Yr(C,M,E),C!=null)for(M=0;M<C.length;M++){var nt=x;_r(nt.h,8*E+2);var tt=nt.h.end();Wn(nt,tt),tt.push(nt.i),nt=tt,Y(C[M],x),tt=x;var mt=nt.pop();for(mt=tt.i+tt.h.length()-mt;127<mt;)nt.push(mt&127|128),mt>>>=7,tt.i++;nt.push(mt),tt.i++}});function X(x){return function(C,E){t:{if(Us.length){var M=Us.pop();M.setOptions(E),mr(M.h,C,E),C=M}else C=new mi(C,E);try{var Y=ze(x),nt=Ae(new Y.P,C,Y);break t}finally{Y=C.h,Y.i=null,Y.m=!1,Y.l=0,Y.j=0,Y.h=0,Y.S=!1,C.l=-1,C.i=-1,100>Us.length&&Us.push(C)}nt=void 0}return nt}}function Q(x){return function(){var C=new wo;Ie(this,C,Dt(x)),Wn(C,C.h.end());for(var E=new Uint8Array(C.i),M=C.j,Y=M.length,nt=0,tt=0;tt<Y;tt++){var mt=M[tt];E.set(mt,nt),nt+=mt.length}return C.j=[E],E}}function lt(x){Zn.call(this,x)}g(lt,Zn);var Tt=[lt,1,P,2,k,3,W,4,W];lt.prototype.l=Q(Tt);function Ot(x){Zn.call(this,x,-1,Mt)}g(Ot,Zn),Ot.prototype.addClassification=function(x,C){return Cs(this,1,lt,x,C),this};var Mt=[1],Yt=X([Ot,1,Z,Tt]);function Zt(x){Zn.call(this,x)}g(Zt,Zn);var se=[Zt,1,k,2,k,3,k,4,k,5,k];Zt.prototype.l=Q(se);function ke(x){Zn.call(this,x,-1,Re)}g(ke,Zn);var Re=[1],sn=X([ke,1,Z,se]);function nn(x){Zn.call(this,x)}g(nn,Zn);var os=[nn,1,k,2,k,3,k,4,k,5,k,6,A],tr=X(os);nn.prototype.l=Q(os);function bs(x,C,E){if(E=x.createShader(E===0?x.VERTEX_SHADER:x.FRAGMENT_SHADER),x.shaderSource(E,C),x.compileShader(E),!x.getShaderParameter(E,x.COMPILE_STATUS))throw Error(`Could not compile WebGL shader.

`+x.getShaderInfoLog(E));return E}function Ze(x){return Yr(x,lt,1).map(function(C){var E=Gs(C,1);return{index:E??0,qa:Qs(C,2),label:Gs(C,3)!=null?ko(Gs(C,3),""):void 0,displayName:Gs(C,4)!=null?ko(Gs(C,4),""):void 0}})}function Jn(x){return{x:Qs(x,1),y:Qs(x,2),z:Qs(x,3),visibility:Hi(x,4)!=null?Qs(x,4):void 0}}function Dr(x,C){this.i=x,this.h=C,this.m=0}function ki(x,C,E){return Id(x,C),typeof x.h.canvas.transferToImageBitmap=="function"?Promise.resolve(x.h.canvas.transferToImageBitmap()):E?Promise.resolve(x.h.canvas):typeof createImageBitmap=="function"?createImageBitmap(x.h.canvas):(x.j===void 0&&(x.j=document.createElement("canvas")),new Promise(function(M){x.j.height=x.h.canvas.height,x.j.width=x.h.canvas.width,x.j.getContext("2d",{}).drawImage(x.h.canvas,0,0,x.h.canvas.width,x.h.canvas.height),M(x.j)}))}function Id(x,C){var E=x.h;if(x.s===void 0){var M=bs(E,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,0),Y=bs(E,`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D sampler0;
  void main(){
    gl_FragColor = texture2D(sampler0, vTex);
  }`,1),nt=E.createProgram();if(E.attachShader(nt,M),E.attachShader(nt,Y),E.linkProgram(nt),!E.getProgramParameter(nt,E.LINK_STATUS))throw Error(`Could not compile WebGL program.

`+E.getProgramInfoLog(nt));M=x.s=nt,E.useProgram(M),Y=E.getUniformLocation(M,"sampler0"),x.l={O:E.getAttribLocation(M,"aVertex"),N:E.getAttribLocation(M,"aTex"),ya:Y},x.v=E.createBuffer(),E.bindBuffer(E.ARRAY_BUFFER,x.v),E.enableVertexAttribArray(x.l.O),E.vertexAttribPointer(x.l.O,2,E.FLOAT,!1,0,0),E.bufferData(E.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),E.STATIC_DRAW),E.bindBuffer(E.ARRAY_BUFFER,null),x.u=E.createBuffer(),E.bindBuffer(E.ARRAY_BUFFER,x.u),E.enableVertexAttribArray(x.l.N),E.vertexAttribPointer(x.l.N,2,E.FLOAT,!1,0,0),E.bufferData(E.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),E.STATIC_DRAW),E.bindBuffer(E.ARRAY_BUFFER,null),E.uniform1i(Y,0)}M=x.l,E.useProgram(x.s),E.canvas.width=C.width,E.canvas.height=C.height,E.viewport(0,0,C.width,C.height),E.activeTexture(E.TEXTURE0),x.i.bindTexture2d(C.glName),E.enableVertexAttribArray(M.O),E.bindBuffer(E.ARRAY_BUFFER,x.v),E.vertexAttribPointer(M.O,2,E.FLOAT,!1,0,0),E.enableVertexAttribArray(M.N),E.bindBuffer(E.ARRAY_BUFFER,x.u),E.vertexAttribPointer(M.N,2,E.FLOAT,!1,0,0),E.bindFramebuffer(E.DRAW_FRAMEBUFFER?E.DRAW_FRAMEBUFFER:E.FRAMEBUFFER,null),E.clearColor(0,0,0,0),E.clear(E.COLOR_BUFFER_BIT),E.colorMask(!0,!0,!0,!0),E.drawArrays(E.TRIANGLE_FAN,0,4),E.disableVertexAttribArray(M.O),E.disableVertexAttribArray(M.N),E.bindBuffer(E.ARRAY_BUFFER,null),x.i.bindTexture2d(0)}function _o(x){this.h=x}var bu=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function ec(x,C){return C+x}function Ly(x,C){window[x]=C}function MC(x){var C=document.createElement("script");return C.setAttribute("src",x),C.setAttribute("crossorigin","anonymous"),new Promise(function(E){C.addEventListener("load",function(){E()},!1),C.addEventListener("error",function(){E()},!1),document.body.appendChild(C)})}function zC(){return H(function(x){switch(x.h){case 1:return x.s=2,v(x,WebAssembly.instantiate(bu),4);case 4:x.h=3,x.s=0;break;case 2:return x.s=0,x.l=null,x.return(!1);case 3:return x.return(!0)}})}function sg(x){if(this.h=x,this.listeners={},this.l={},this.L={},this.s={},this.v={},this.M=this.u=this.ga=!0,this.I=Promise.resolve(),this.fa="",this.D={},this.locateFile=x&&x.locateFile||ec,typeof window=="object")var C=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else if(typeof location<"u")C=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/";else throw Error("solutions can only be loaded on a web page or in a web worker");if(this.ha=C,x.options){C=a(Object.keys(x.options));for(var E=C.next();!E.done;E=C.next()){E=E.value;var M=x.options[E].default;M!==void 0&&(this.l[E]=typeof M=="function"?M():M)}}}n=sg.prototype,n.close=function(){return this.j&&this.j.delete(),Promise.resolve()};function BC(x){var C,E,M,Y,nt,tt,mt,$t,Gt,te,Ce;return H(function(ye){switch(ye.h){case 1:return x.ga?(C=x.h.files===void 0?[]:typeof x.h.files=="function"?x.h.files(x.l):x.h.files,v(ye,zC(),2)):ye.return();case 2:if(E=ye.i,typeof window=="object")return Ly("createMediapipeSolutionsWasm",{locateFile:x.locateFile}),Ly("createMediapipeSolutionsPackedAssets",{locateFile:x.locateFile}),tt=C.filter(function(ue){return ue.data!==void 0}),mt=C.filter(function(ue){return ue.data===void 0}),$t=Promise.all(tt.map(function(ue){var Ne=Cd(x,ue.url);if(ue.path!==void 0){var Be=ue.path;Ne=Ne.then(function(xn){return x.overrideFile(Be,xn),Promise.resolve(xn)})}return Ne})),Gt=Promise.all(mt.map(function(ue){return ue.simd===void 0||ue.simd&&E||!ue.simd&&!E?MC(x.locateFile(ue.url,x.ha)):Promise.resolve()})).then(function(){var ue,Ne,Be;return H(function(xn){if(xn.h==1)return ue=window.createMediapipeSolutionsWasm,Ne=window.createMediapipeSolutionsPackedAssets,Be=x,v(xn,ue(Ne),2);Be.i=xn.i,xn.h=0})}),te=function(){return H(function(ue){return x.h.graph&&x.h.graph.url?ue=v(ue,Cd(x,x.h.graph.url),0):(ue.h=0,ue=void 0),ue})}(),v(ye,Promise.all([Gt,$t,te]),7);if(typeof importScripts!="function")throw Error("solutions can only be loaded on a web page or in a web worker");return M=C.filter(function(ue){return ue.simd===void 0||ue.simd&&E||!ue.simd&&!E}).map(function(ue){return x.locateFile(ue.url,x.ha)}),importScripts.apply(null,u(M)),Y=x,v(ye,createMediapipeSolutionsWasm(Module),6);case 6:Y.i=ye.i,x.m=new OffscreenCanvas(1,1),x.i.canvas=x.m,nt=x.i.GL.createContext(x.m,{antialias:!1,alpha:!1,va:typeof WebGL2RenderingContext<"u"?2:1}),x.i.GL.makeContextCurrent(nt),ye.h=4;break;case 7:if(x.m=document.createElement("canvas"),Ce=x.m.getContext("webgl2",{}),!Ce&&(Ce=x.m.getContext("webgl",{}),!Ce))return alert("Failed to create WebGL canvas context when passing video frame."),ye.return();x.K=Ce,x.i.canvas=x.m,x.i.createContext(x.m,!0,!0,{});case 4:x.j=new x.i.SolutionWasm,x.ga=!1,ye.h=0}})}function VC(x){var C,E,M,Y,nt,tt,mt,$t;return H(function(Gt){if(Gt.h==1){if(x.h.graph&&x.h.graph.url&&x.fa===x.h.graph.url)return Gt.return();if(x.u=!0,!x.h.graph||!x.h.graph.url){Gt.h=2;return}return x.fa=x.h.graph.url,v(Gt,Cd(x,x.h.graph.url),3)}for(Gt.h!=2&&(C=Gt.i,x.j.loadGraph(C)),E=a(Object.keys(x.D)),M=E.next();!M.done;M=E.next())Y=M.value,x.j.overrideFile(Y,x.D[Y]);if(x.D={},x.h.listeners)for(nt=a(x.h.listeners),tt=nt.next();!tt.done;tt=nt.next())mt=tt.value,jC(x,mt);$t=x.l,x.l={},x.setOptions($t),Gt.h=0})}n.reset=function(){var x=this;return H(function(C){x.j&&(x.j.reset(),x.s={},x.v={}),C.h=0})},n.setOptions=function(x,C){var E=this;if(C=C||this.h.options){for(var M=[],Y=[],nt={},tt=a(Object.keys(x)),mt=tt.next();!mt.done;nt={X:nt.X,Y:nt.Y},mt=tt.next())if(mt=mt.value,!(mt in this.l&&this.l[mt]===x[mt])){this.l[mt]=x[mt];var $t=C[mt];$t!==void 0&&($t.onChange&&(nt.X=$t.onChange,nt.Y=x[mt],M.push(function(Gt){return function(){var te;return H(function(Ce){if(Ce.h==1)return v(Ce,Gt.X(Gt.Y),2);te=Ce.i,te===!0&&(E.u=!0),Ce.h=0})}}(nt))),$t.graphOptionXref&&(mt=Object.assign({},{calculatorName:"",calculatorIndex:0},$t.graphOptionXref,{valueNumber:$t.type===1?x[mt]:0,valueBoolean:$t.type===0?x[mt]:!1,valueString:$t.type===2?x[mt]:""}),Y.push(mt)))}(M.length!==0||Y.length!==0)&&(this.u=!0,this.H=(this.H===void 0?[]:this.H).concat(Y),this.F=(this.F===void 0?[]:this.F).concat(M))}};function UC(x){var C,E,M,Y,nt,tt,mt;return H(function($t){switch($t.h){case 1:if(!x.u)return $t.return();if(!x.F){$t.h=2;break}C=a(x.F),E=C.next();case 3:if(E.done){$t.h=5;break}return M=E.value,v($t,M(),4);case 4:E=C.next(),$t.h=3;break;case 5:x.F=void 0;case 2:if(x.H){for(Y=new x.i.GraphOptionChangeRequestList,nt=a(x.H),tt=nt.next();!tt.done;tt=nt.next())mt=tt.value,Y.push_back(mt);x.j.changeOptions(Y),Y.delete(),x.H=void 0}x.u=!1,$t.h=0}})}n.initialize=function(){var x=this;return H(function(C){return C.h==1?v(C,BC(x),2):C.h!=3?v(C,VC(x),3):v(C,UC(x),0)})};function Cd(x,C){var E,M;return H(function(Y){return C in x.L?Y.return(x.L[C]):(E=x.locateFile(C,""),M=fetch(E).then(function(nt){return nt.arrayBuffer()}),x.L[C]=M,Y.return(M))})}n.overrideFile=function(x,C){this.j?this.j.overrideFile(x,C):this.D[x]=C},n.clearOverriddenFiles=function(){this.D={},this.j&&this.j.clearOverriddenFiles()},n.send=function(x,C){var E=this,M,Y,nt,tt,mt,$t,Gt,te,Ce;return H(function(ye){switch(ye.h){case 1:return E.h.inputs?(M=1e3*(C??performance.now()),v(ye,E.I,2)):ye.return();case 2:return v(ye,E.initialize(),3);case 3:for(Y=new E.i.PacketDataList,nt=a(Object.keys(x)),tt=nt.next();!tt.done;tt=nt.next())if(mt=tt.value,$t=E.h.inputs[mt]){t:{var ue=x[mt];switch($t.type){case"video":var Ne=E.s[$t.stream];if(Ne||(Ne=new Dr(E.i,E.K),E.s[$t.stream]=Ne),Ne.m===0&&(Ne.m=Ne.i.createTexture()),typeof HTMLVideoElement<"u"&&ue instanceof HTMLVideoElement)var Be=ue.videoWidth,xn=ue.videoHeight;else typeof HTMLImageElement<"u"&&ue instanceof HTMLImageElement?(Be=ue.naturalWidth,xn=ue.naturalHeight):(Be=ue.width,xn=ue.height);xn={glName:Ne.m,width:Be,height:xn},Be=Ne.h,Be.canvas.width=xn.width,Be.canvas.height=xn.height,Be.activeTexture(Be.TEXTURE0),Ne.i.bindTexture2d(Ne.m),Be.texImage2D(Be.TEXTURE_2D,0,Be.RGBA,Be.RGBA,Be.UNSIGNED_BYTE,ue),Ne.i.bindTexture2d(0),Ne=xn;break t;case"detections":for(Ne=E.s[$t.stream],Ne||(Ne=new _o(E.i),E.s[$t.stream]=Ne),Ne.data||(Ne.data=new Ne.h.DetectionListData),Ne.data.reset(ue.length),xn=0;xn<ue.length;++xn){Be=ue[xn];var pn=Ne.data,xs=pn.setBoundingBox,Or=xn,er=Be.la,Qe=new nn;if(Yn(Qe,1,er.sa),Yn(Qe,2,er.ta),Yn(Qe,3,er.height),Yn(Qe,4,er.width),Yn(Qe,5,er.rotation),gs(Qe,6,er.pa),er=Qe.l(),xs.call(pn,Or,er),Be.ea)for(pn=0;pn<Be.ea.length;++pn){Qe=Be.ea[pn],xs=Ne.data,Or=xs.addNormalizedLandmark,er=xn,Qe=Object.assign({},Qe,{visibility:Qe.visibility?Qe.visibility:0});var ws=new Zt;Yn(ws,1,Qe.x),Yn(ws,2,Qe.y),Yn(ws,3,Qe.z),Qe.visibility&&Yn(ws,4,Qe.visibility),Qe=ws.l(),Or.call(xs,er,Qe)}if(Be.ba)for(pn=0;pn<Be.ba.length;++pn)xs=Ne.data,Or=xs.addClassification,er=xn,Qe=Be.ba[pn],ws=new lt,Yn(ws,2,Qe.qa),Qe.index&&gs(ws,1,Qe.index),Qe.label&&gs(ws,3,Qe.label),Qe.displayName&&gs(ws,4,Qe.displayName),Qe=ws.l(),Or.call(xs,er,Qe)}Ne=Ne.data;break t;default:Ne={}}}switch(Gt=Ne,te=$t.stream,$t.type){case"video":Y.pushTexture2d(Object.assign({},Gt,{stream:te,timestamp:M}));break;case"detections":Ce=Gt,Ce.stream=te,Ce.timestamp=M,Y.pushDetectionList(Ce);break;default:throw Error("Unknown input config type: '"+$t.type+"'")}}return E.j.send(Y),v(ye,E.I,4);case 4:Y.delete(),ye.h=0}})};function WC(x,C,E){var M,Y,nt,tt,mt,$t,Gt,te,Ce,ye,ue,Ne,Be,xn;return H(function(pn){switch(pn.h){case 1:if(!E)return pn.return(C);for(M={},Y=0,nt=a(Object.keys(E)),tt=nt.next();!tt.done;tt=nt.next())mt=tt.value,$t=E[mt],typeof $t!="string"&&$t.type==="texture"&&C[$t.stream]!==void 0&&++Y;1<Y&&(x.M=!1),Gt=a(Object.keys(E)),tt=Gt.next();case 2:if(tt.done){pn.h=4;break}if(te=tt.value,Ce=E[te],typeof Ce=="string")return Be=M,xn=te,v(pn,GC(x,te,C[Ce]),14);if(ye=C[Ce.stream],Ce.type==="detection_list"){if(ye){for(var xs=ye.getRectList(),Or=ye.getLandmarksList(),er=ye.getClassificationsList(),Qe=[],ws=0;ws<xs.size();++ws){var Ao=tr(xs.get(ws)),HC=Qs(Ao,1),KC=Qs(Ao,2),qC=Qs(Ao,3),XC=Qs(Ao,4),YC=Qs(Ao,5,0),Nd=void 0;Nd=Nd===void 0?0:Nd,Ao={la:{sa:HC,ta:KC,height:qC,width:XC,rotation:YC,pa:ko(Gs(Ao,6),Nd)},ea:Yr(sn(Or.get(ws)),Zt,1).map(Jn),ba:Ze(Yt(er.get(ws)))},Qe.push(Ao)}xs=Qe}else xs=[];M[te]=xs,pn.h=7;break}if(Ce.type==="proto_list"){if(ye){for(xs=Array(ye.size()),Or=0;Or<ye.size();Or++)xs[Or]=ye.get(Or);ye.delete()}else xs=[];M[te]=xs,pn.h=7;break}if(ye===void 0){pn.h=3;break}if(Ce.type==="float_list"){M[te]=ye,pn.h=7;break}if(Ce.type==="proto"){M[te]=ye,pn.h=7;break}if(Ce.type!=="texture")throw Error("Unknown output config type: '"+Ce.type+"'");return ue=x.v[te],ue||(ue=new Dr(x.i,x.K),x.v[te]=ue),v(pn,ki(ue,ye,x.M),13);case 13:Ne=pn.i,M[te]=Ne;case 7:Ce.transform&&M[te]&&(M[te]=Ce.transform(M[te])),pn.h=3;break;case 14:Be[xn]=pn.i;case 3:tt=Gt.next(),pn.h=2;break;case 4:return pn.return(M)}})}function GC(x,C,E){var M;return H(function(Y){return typeof E=="number"||E instanceof Uint8Array||E instanceof x.i.Uint8BlobList?Y.return(E):E instanceof x.i.Texture2dDataOut?(M=x.v[C],M||(M=new Dr(x.i,x.K),x.v[C]=M),Y.return(ki(M,E,x.M))):Y.return(void 0)})}function jC(x,C){for(var E=C.name||"$",M=[].concat(u(C.wants)),Y=new x.i.StringList,nt=a(C.wants),tt=nt.next();!tt.done;tt=nt.next())Y.push_back(tt.value);nt=x.i.PacketListener.implement({onResults:function(mt){for(var $t={},Gt=0;Gt<C.wants.length;++Gt)$t[M[Gt]]=mt.get(Gt);var te=x.listeners[E];te&&(x.I=WC(x,$t,C.outs).then(function(Ce){Ce=te(Ce);for(var ye=0;ye<C.wants.length;++ye){var ue=$t[M[ye]];typeof ue=="object"&&ue.hasOwnProperty&&ue.hasOwnProperty("delete")&&ue.delete()}Ce&&(x.I=Ce)}))}}),x.j.attachMultiListener(Y,nt),Y.delete()}n.onResults=function(x,C){this.listeners[C||"$"]=x},K("Solution",sg),K("OptionType",{BOOL:0,NUMBER:1,ua:2,0:"BOOL",1:"NUMBER",2:"STRING"});function Py(x){switch(x===void 0&&(x=0),x){case 1:return"selfie_segmentation_landscape.tflite";default:return"selfie_segmentation.tflite"}}function My(x){var C=this;x=x||{},this.h=new sg({locateFile:x.locateFile,files:function(E){return[{simd:!0,url:"selfie_segmentation_solution_simd_wasm_bin.js"},{simd:!1,url:"selfie_segmentation_solution_wasm_bin.js"},{data:!0,url:Py(E.modelSelection)}]},graph:{url:"selfie_segmentation.binarypb"},listeners:[{wants:["segmentation_mask","image_transformed"],outs:{image:{type:"texture",stream:"image_transformed"},segmentationMask:{type:"texture",stream:"segmentation_mask"}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:typeof window!="object"||window.navigator===void 0?!1:"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},modelSelection:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorModelSelection",fieldName:"int_value"},onChange:function(E){var M,Y,nt;return H(function(tt){return tt.h==1?(M=Py(E),Y="third_party/mediapipe/modules/selfie_segmentation/"+M,v(tt,Cd(C.h,M),2)):(nt=tt.i,C.h.overrideFile(Y,nt),tt.return(!0))})}}}})}n=My.prototype,n.close=function(){return this.h.close(),Promise.resolve()},n.onResults=function(x){this.h.onResults(x)},n.initialize=function(){var x=this;return H(function(C){return v(C,x.h.initialize(),0)})},n.reset=function(){this.h.reset()},n.send=function(x){var C=this;return H(function(E){return v(E,C.h.send(x),0)})},n.setOptions=function(x){this.h.setOptions(x)},K("SelfieSegmentation",My),K("VERSION","0.1.1675465747")}).call(ks);/**
    * @license
    * Copyright 2022 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */var I1=function(n,t){return I1=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,s){e.__proto__=s}||function(e,s){for(var r in s)s.hasOwnProperty(r)&&(e[r]=s[r])},I1(n,t)};function Wk(n,t){function e(){this.constructor=n}I1(n,t),n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var Ts=function(){return Ts=Object.assign||function(n){for(var t,e=1,s=arguments.length;e<s;e++)for(var r in t=arguments[e])Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n},Ts.apply(this,arguments)};function He(n,t,e,s){return new(e||(e=Promise))(function(r,i){function o(l){try{u(s.next(l))}catch(c){i(c)}}function a(l){try{u(s.throw(l))}catch(c){i(c)}}function u(l){var c;l.done?r(l.value):(c=l.value,c instanceof e?c:new e(function(h){h(c)})).then(o,a)}u((s=s.apply(n,t||[])).next())})}function Ke(n,t){var e,s,r,i,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function a(u){return function(l){return function(c){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,s&&(r=2&c[0]?s.return:c[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,c[1])).done)return r;switch(s=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,s=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(r=o.trys,!((r=r.length>0&&r[r.length-1])||c[0]!==6&&c[0]!==2)){o=0;continue}if(c[0]===3&&(!r||c[1]>r[0]&&c[1]<r[3])){o.label=c[1];break}if(c[0]===6&&o.label<r[1]){o.label=r[1],r=c;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(c);break}r[2]&&o.ops.pop(),o.trys.pop();continue}c=t.call(n,o)}catch(h){c=[6,h],s=0}finally{e=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([u,l])}}}function Sf(n){return n instanceof SVGAnimatedLength?n.baseVal.value:n}function ly(n){return He(this,void 0,void 0,function(){var t,e;return Ke(this,function(s){switch(s.label){case 0:return t=document.createElement("canvas"),n instanceof $e?[4,ru(n,t)]:[3,2];case 1:return s.sent(),[3,3];case 2:t.width=Sf(n.width),t.height=Sf(n.height),e=t.getContext("2d"),n instanceof ImageData?e.putImageData(n,0,0):e.drawImage(n,0,0),s.label=3;case 3:return[2,t]}})})}function Gk(n){return He(this,void 0,void 0,function(){var t,e,s,r,i,o;return Ke(this,function(a){switch(a.label){case 0:return n instanceof $e?(t=n.shape.slice(0,2),e=t[0],s=t[1],r=ImageData.bind,[4,ru(n)]):[3,2];case 1:return[2,new(r.apply(ImageData,[void 0,a.sent(),s,e]))];case 2:return i=document.createElement("canvas"),o=i.getContext("2d"),i.width=Sf(n.width),i.height=Sf(n.height),o.drawImage(n,0,0),[2,o.getImageData(0,0,i.width,i.height)]}})})}function jk(n){return He(this,void 0,void 0,function(){var t,e;return Ke(this,function(s){switch(s.label){case 0:return n instanceof SVGImageElement||n instanceof OffscreenCanvas?[4,ly(n)]:[3,2];case 1:return e=s.sent(),[3,3];case 2:e=n,s.label=3;case 3:return t=e,[2,iu(t,4)]}})})}function Um(n){if(n<0||n>=256)throw new Error("Mask value must be in range [0, 255] but got "+n);if(!Number.isInteger(n))throw new Error("Mask value must be an integer but got "+n)}function Hk(n){var t=n.shape[2],e=Wo(n,2),s=ct(e,[-1]);return Va(s,t)}function Pd(n,t){return pt(function(){return Kt(Ms(n,fe(t)),"int32")})}function jG(n,t){var e=t.shape,s=e[0],r=e[1],i=e[2];return pt(function(){var o=Hk(t),a=gn(oo(0,i,1,"int32"),1),u=Kt(De(o,a),"int32"),l=ct(u,[s,r]),c=Lt(l,fe(1,"int32"));return oe(function(h,d){return ut(h,d)}(c,n),fe(1,"int32"))})}var Kk=function(){function n(t,e){this.model=t,this.outputStride=e;var s=this.model.inputs[0].shape;V(s[1]===-1&&s[2]===-1,function(){return"Input shape ["+s[1]+", "+s[2]+"] must both be equal to or -1"})}return n.prototype.predict=function(t){var e=this;return pt(function(){var s=e.preprocessInput(Kt(t,"float32")),r=gn(s,0),i=e.model.predict(r).map(function(a){return tn(a,[0])}),o=e.nameOutputResults(i);return{heatmapScores:Hs(o.heatmap),offsets:o.offsets,displacementFwd:o.displacementFwd,displacementBwd:o.displacementBwd,segmentation:o.segmentation,partHeatmaps:o.partHeatmaps,longOffsets:o.longOffsets,partOffsets:o.partOffsets}})},n.prototype.dispose=function(){this.model.dispose()},n}(),HG=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return Wk(t,n),t.prototype.preprocessInput=function(e){return pt(function(){return oe(ie(e,127.5),1)})},t.prototype.nameOutputResults=function(e){return{offsets:e[0],segmentation:e[1],partHeatmaps:e[2],longOffsets:e[3],heatmap:e[4],displacementFwd:e[5],displacementBwd:e[6],partOffsets:e[7]}},t}(Kk),Wm=["nose","leftEye","rightEye","leftEar","rightEar","leftShoulder","rightShoulder","leftElbow","rightElbow","leftWrist","rightWrist","leftHip","rightHip","leftKnee","rightKnee","leftAnkle","rightAnkle"],si=Wm.length,If=Wm.reduce(function(n,t,e){return n[t]=e,n},{});[["leftHip","leftShoulder"],["leftElbow","leftShoulder"],["leftElbow","leftWrist"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["rightHip","rightShoulder"],["rightElbow","rightShoulder"],["rightElbow","rightWrist"],["rightHip","rightKnee"],["rightKnee","rightAnkle"],["leftShoulder","rightShoulder"],["leftHip","rightHip"]].map(function(n){var t=n[0],e=n[1];return[If[t],If[e]]});function cy(n,t,e){var s=n[0],r=n[1],i=t[0],o=t[1],a=e.top,u=e.bottom;return[o/(e.left+e.right+r),i/(a+u+s)]}function qk(n,t,e,s){return{y:s.get(n,t,e),x:s.get(n,t,e+si)}}function Xk(n,t,e){var s=qk(n.heatmapY,n.heatmapX,n.id,e),r=s.y,i=s.x;return{x:n.heatmapX*t+i,y:n.heatmapY*t+r}}function i3(n,t,e){return n<t?t:n>e?e:n}function o3(n,t){return{x:n.x+t.x,y:n.y+t.y}}function KG(n,t,e){e===void 0&&(e=.3);for(var s=0,r=0,i=0;i<n.length;i++)t.keypoints[i].score>e&&(r+=1,s+=Math.pow(n[i].x-t.keypoints[i].position.x,2)+Math.pow(n[i].y-t.keypoints[i].position.y,2));return r===0?s=1/0:s/=r,s}function qG(n,t,e,s,r,i,o){for(var a=o[0],u=o[1],l=e(n),c=l.y*s+l.x,h=r[si*(2*c)+t],d=r[si*(2*c+1)+t],f=n.y+h,p=n.x+d,m=0;m<i;m++){f=Math.min(f,a-1);var g=e({x:p=Math.min(p,u-1),y:f}),y=g.y*s+g.x;f+=h=r[si*(2*y)+t],p+=d=r[si*(2*y+1)+t]}return{x:p,y:f}}function Yk(n,t,e,s,r,i,o,a,u,l){for(var c=r[0],h=r[1],d=i[0],f=i[1],p=a[0],m=a[1],g=[],y=function(L){return function(F,B,H,z){var G=B[0],T=B[1],K=H[0],ht=H[1],rt=Math.round(((G+F.y+1)*ht-1)/z);return{x:Math.round(((T+F.x+1)*K-1)/z),y:rt}}(L,[c,h],[d,f],u)},b=0;b<s;b++){var w=qG(n,b,y,o,t,l,[p,m]);g.push(w)}for(var v=-1,S=1/0,N=0;N<e.length;N++){var R=KG(g,e[N]);R<S&&(v=N,S=R)}return v}function Zk(n,t){var e=n[0],s=n[1];return[Math.round((s-1)/t+1),Math.round((e-1)/t+1)]}function Jk(n,t,e,s,r,i,o,a,u,l,c){for(var h=o[0],d=o[1],f=n.shape,p=f[0],m=f[1],g=t.shape.slice(0,2),y=g[0],b=g[1],w=ct(t,[y,b,2,si]),v=new Float32Array(c*si*3).fill(0),S=0;S<e.length;S++)for(var N=S*si*3,R=e[S],L=0;L<si;L++){var F=R.keypoints[L],B=N+3*L;v[B]=F.score,v[B+1]=F.position.y,v[B+2]=F.position.x}var H=cy([s,r],[h,d],a),z=H[0],G=H[1],T=Cr(v,[c,si,3]),K=a.top,ht=a.left,rt={variableNames:["segmentation","longOffsets","poses"],outputShape:[p,m],userCode:`
    int convertToPositionInOutput(int pos, int pad, float scale, int stride) {
      return round(((float(pos + pad) + 1.0) * scale - 1.0) / float(stride));
    }

    float convertToPositionInOutputFloat(
        int pos, int pad, float scale, int stride) {
      return ((float(pos + pad) + 1.0) * scale - 1.0) / float(stride);
    }

    float dist(float x1, float y1, float x2, float y2) {
      return pow(x1 - x2, 2.0) + pow(y1 - y2, 2.0);
    }

    float sampleLongOffsets(float h, float w, int d, int k) {
      float fh = fract(h);
      float fw = fract(w);
      int clH = int(ceil(h));
      int clW = int(ceil(w));
      int flH = int(floor(h));
      int flW = int(floor(w));
      float o11 = getLongOffsets(flH, flW, d, k);
      float o12 = getLongOffsets(flH, clW, d, k);
      float o21 = getLongOffsets(clH, flW, d, k);
      float o22 = getLongOffsets(clH, clW, d, k);
      float o1 = mix(o11, o12, fw);
      float o2 = mix(o21, o22, fw);
      return mix(o1, o2, fh);
    }

    int findNearestPose(int h, int w) {
      float prob = getSegmentation(h, w);
      if (prob < 1.0) {
        return -1;
      }

      // Done(Tyler): convert from output space h/w to strided space.
      float stridedH = convertToPositionInOutputFloat(
        h, `+K+", "+G+", "+i+`);
      float stridedW = convertToPositionInOutputFloat(
        w, `+ht+", "+z+", "+i+`);

      float minDist = 1000000.0;
      int iMin = -1;
      for (int i = 0; i < `+c+`; i++) {
        float curDistSum = 0.0;
        int numKpt = 0;
        for (int k = 0; k < `+si+`; k++) {
          float dy = sampleLongOffsets(stridedH, stridedW, 0, k);
          float dx = sampleLongOffsets(stridedH, stridedW, 1, k);

          float y = float(h) + dy;
          float x = float(w) + dx;

          for (int s = 0; s < `+u+`; s++) {
            int yRounded = round(min(y, float(`+(s-1)+`)));
            int xRounded = round(min(x, float(`+(r-1)+`)));

            float yStrided = convertToPositionInOutputFloat(
              yRounded, `+K+", "+G+", "+i+`);
            float xStrided = convertToPositionInOutputFloat(
              xRounded, `+ht+", "+z+", "+i+`);

            float dy = sampleLongOffsets(yStrided, xStrided, 0, k);
            float dx = sampleLongOffsets(yStrided, xStrided, 1, k);

            y = y + dy;
            x = x + dx;
          }

          float poseScore = getPoses(i, k, 0);
          float poseY = getPoses(i, k, 1);
          float poseX = getPoses(i, k, 2);
          if (poseScore > `+l+`) {
            numKpt = numKpt + 1;
            curDistSum = curDistSum + dist(x, y, poseX, poseY);
          }
        }
        if (numKpt > 0 && curDistSum / float(numKpt) < minDist) {
          minDist = curDistSum / float(numKpt);
          iMin = i;
        }
      }
      return iMin;
    }

    void main() {
        ivec2 coords = getOutputCoords();
        int nearestPose = findNearestPose(coords[0], coords[1]);
        setOutput(float(nearestPose));
      }
  `};return e0().compileAndRun(rt,[n,w,T])}function Qk(){return Zx()==="webgl"}function XG(n,t,e,s,r,i,o,a,u,l,c,h){var d=o[0],f=o[1];return u===void 0&&(u=.2),l===void 0&&(l=8),c===void 0&&(c=.3),h===void 0&&(h=10),He(this,void 0,void 0,function(){var p,m,g,y,b;return Ke(this,function(w){switch(w.label){case 0:return p=e.filter(function(v){return v.score>=u}),Qk()?(g=pt(function(){var v=Jk(n,t,p,s,r,i,[d,f],a,l,c,h),S=xr().makeTensorFromDataId(v.dataId,v.shape,v.dtype);return p.map(function(N,R){return function(L,F){return pt(function(){return Kt(ar(L,fe(F)),"int32")})}(S,R)})}),[4,Promise.all(g.map(function(v){return v.data()}))]):[3,2];case 1:return m=w.sent(),g.forEach(function(v){return v.dispose()}),[3,5];case 2:return[4,n.data()];case 3:return y=w.sent(),[4,t.data()];case 4:b=w.sent(),m=function(v,S,N,R,L,F,B,H,z,G){var T=B[0],K=B[1];G===void 0&&(G=5);for(var ht=N.map(function(Xt){return new Uint8Array(R*L).fill(0)}),rt=H.top,gt=H.left,at=cy([R,L],[T,K],H),It=at[0],et=at[1],st=Zk([T,K],F)[0],St=0;St<R;St+=1)for(var kt=0;kt<L;kt+=1){var yt=St*L+kt;if(v[yt]===1){var Pt=Yk({x:kt,y:St},S,N,G,[rt,gt],[It,et],st,[R,L],F,z);Pt>=0&&(ht[Pt][yt]=1)}}return ht}(y,b,p,s,r,i,[d,f],a,l),w.label=5;case 5:return[2,m.map(function(v,S){return{data:v,pose:p[S],width:r,height:s}})]}})})}function YG(n,t,e,s,r,i,o,a,u,l,c,h,d){var f=a[0],p=a[1];return l===void 0&&(l=.2),c===void 0&&(c=8),h===void 0&&(h=.3),d===void 0&&(d=10),He(this,void 0,void 0,function(){var m,g,y,b,w,v;return Ke(this,function(S){switch(S.label){case 0:return m=s.filter(function(N){return N.score>=l}),Qk()?(y=pt(function(){var N=Jk(n,t,m,r,i,o,[f,p],u,c,h,d),R=xr().makeTensorFromDataId(N.dataId,N.shape,N.dtype);return m.map(function(L,F){return function(B,H,z){return pt(function(){return oe(ut(Kt(ar(B,fe(z)),"int32"),Lt(H,1)),1)})}(R,e,F)})}),[4,Promise.all(y.map(function(N){return N.data()}))]):[3,2];case 1:return g=S.sent(),y.forEach(function(N){return N.dispose()}),[3,6];case 2:return[4,n.data()];case 3:return b=S.sent(),[4,t.data()];case 4:return w=S.sent(),[4,e.data()];case 5:v=S.sent(),g=function(N,R,L,F,B,H,z,G,T,K,ht){var rt=G[0],gt=G[1];ht===void 0&&(ht=5);for(var at=F.map(function(Jt){return new Int32Array(B*H).fill(-1)}),It=T.top,et=T.left,st=cy([B,H],[rt,gt],T),St=st[0],kt=st[1],yt=Zk([rt,gt],z)[0],Pt=0;Pt<B;Pt+=1)for(var Xt=0;Xt<H;Xt+=1){var Wt=Pt*H+Xt;if(N[Wt]===1){var Bt=Yk({x:Xt,y:Pt},R,F,ht,[It,et],[St,kt],yt,[B,H],z,K);Bt>=0&&(at[Bt][Wt]=L[Wt])}}return at}(b,w,v,m,r,i,o,[f,p],u,c),S.label=6;case 6:return[2,g.map(function(N,R){return{pose:m[R],data:N,height:r,width:i}})]}})})}function Tg(n){return Math.floor(n/2)}var ZG=function(){function n(t,e){this.priorityQueue=new Array(t),this.numberOfElements=-1,this.getElementValue=e}return n.prototype.enqueue=function(t){this.priorityQueue[++this.numberOfElements]=t,this.swim(this.numberOfElements)},n.prototype.dequeue=function(){var t=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,t},n.prototype.empty=function(){return this.numberOfElements===-1},n.prototype.size=function(){return this.numberOfElements+1},n.prototype.all=function(){return this.priorityQueue.slice(0,this.numberOfElements+1)},n.prototype.max=function(){return this.priorityQueue[0]},n.prototype.swim=function(t){for(;t>0&&this.less(Tg(t),t);)this.exchange(t,Tg(t)),t=Tg(t)},n.prototype.sink=function(t){for(;2*t<=this.numberOfElements;){var e=2*t;if(e<this.numberOfElements&&this.less(e,e+1)&&e++,!this.less(t,e))break;this.exchange(t,e),t=e}},n.prototype.getValueAt=function(t){return this.getElementValue(this.priorityQueue[t])},n.prototype.less=function(t,e){return this.getValueAt(t)<this.getValueAt(e)},n.prototype.exchange=function(t,e){var s=this.priorityQueue[t];this.priorityQueue[t]=this.priorityQueue[e],this.priorityQueue[e]=s},n}();function JG(n,t,e,s,r,i){for(var o=i.shape,a=o[0],u=o[1],l=!0,c=Math.max(e-r,0),h=Math.min(e+r+1,a),d=c;d<h;++d){for(var f=Math.max(s-r,0),p=Math.min(s+r+1,u),m=f;m<p;++m)if(i.get(d,m,n)>t){l=!1;break}if(!l)break}return l}var tS=[["nose","leftEye"],["leftEye","leftEar"],["nose","rightEye"],["rightEye","rightEar"],["nose","leftShoulder"],["leftShoulder","leftElbow"],["leftElbow","leftWrist"],["leftShoulder","leftHip"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["nose","rightShoulder"],["rightShoulder","rightElbow"],["rightElbow","rightWrist"],["rightShoulder","rightHip"],["rightHip","rightKnee"],["rightKnee","rightAnkle"]].map(function(n){var t=n[0],e=n[1];return[If[t],If[e]]}),$g=tS.map(function(n){return n[1]}),a3=tS.map(function(n){return n[0]});function Eg(n,t,e,s){return{y:i3(Math.round(n.y/t),0,e-1),x:i3(Math.round(n.x/t),0,s-1)}}function u3(n,t,e,s,r,i,o,a){a===void 0&&(a=2);for(var u=s.shape,l=u[0],c=u[1],h=function(b,w,v){var S=v.shape[2]/2;return{y:v.get(w.y,w.x,b),x:v.get(w.y,w.x,S+b)}}(n,Eg(t.position,i,l,c),o),d=o3(t.position,h),f=0;f<a;f++){var p=Eg(d,i,l,c),m=qk(p.y,p.x,e,r);d=o3({x:p.x*i,y:p.y*i},{x:m.x,y:m.y})}var g=Eg(d,i,l,c),y=s.get(g.y,g.x,e);return{position:d,part:Wm[e],score:y}}function QG(n,t,e,s,r,i){var o=t.shape[2],a=$g.length,u=new Array(o),l=n.part,c=n.score,h=Xk(l,s,e);u[l.id]={score:c,part:Wm[l.id],position:h};for(var d=a-1;d>=0;--d){var f=$g[d],p=a3[d];u[f]&&!u[p]&&(u[p]=u3(d,u[f],p,t,e,s,i))}for(d=0;d<a;++d)f=a3[d],p=$g[d],u[f]&&!u[p]&&(u[p]=u3(d,u[f],p,t,e,s,r));return u}function eS(n,t,e,s){var r=e.x,i=e.y;return n.some(function(o){var a,u,l,c,h,d,f=o.keypoints[s].position;return a=i,u=r,l=f.y,c=f.x,(h=l-a)*h+(d=c-u)*d<=t})}function tj(n,t,e){var s=e.reduce(function(r,i,o){var a=i.position,u=i.score;return eS(n,t,a,o)||(r+=u),r},0);return s/e.length}function Md(n,t,e,s,r,i,o,a){o===void 0&&(o=.5),a===void 0&&(a=20);for(var u=[],l=function(p,m,g){for(var y=g.shape,b=y[0],w=y[1],v=y[2],S=new ZG(b*w*v,function(B){return B.score}),N=0;N<b;++N)for(var R=0;R<w;++R)for(var L=0;L<v;++L){var F=g.get(N,R,L);F<p||JG(L,F,N,R,m,g)&&S.enqueue({score:F,part:{heatmapY:N,heatmapX:R,id:L}})}return S}(o,1,n),c=a*a;u.length<i&&!l.empty();){var h=l.dequeue();if(!eS(u,c,Xk(h.part,r,t),h.part.id)){var d=QG(h,n,t,r,e,s),f=tj(u,c,d);u.push({keypoints:d,score:f})}}return u}var rc,ej=[-123.15,-115.9,-103.06],nj=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return Wk(t,n),t.prototype.preprocessInput=function(e){return Lt(e,ej)},t.prototype.nameOutputResults=function(e){var s=e[0],r=e[1],i=e[2],o=e[3],a=e[4],u=e[5];return{offsets:a,segmentation:e[6],partHeatmaps:u,longOffsets:o,heatmap:i,displacementFwd:r,displacementBwd:s,partOffsets:e[7]}},t}(Kk),l3="https://storage.googleapis.com/tfjs-models/savedmodel/bodypix/resnet50/",c3="https://storage.googleapis.com/tfjs-models/savedmodel/bodypix/mobilenet/";function hc(n){if(typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas||typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)return function(t){if("offsetHeight"in t&&t.offsetHeight!==0&&"offsetWidth"in t&&t.offsetWidth!==0)return[t.offsetHeight,t.offsetWidth];if(t.height!=null&&t.width!=null)return[t.height,t.width];throw new Error("HTMLImageElement must have height and width attributes set.")}(n);if(typeof ImageData<"u"&&n instanceof ImageData)return[n.height,n.width];if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)return function(t){return t.hasAttribute("height")&&t.hasAttribute("width")?[t.height,t.width]:[t.videoHeight,t.videoWidth]}(n);if(n instanceof $e)return[n.shape[0],n.shape[1]];throw new Error("error: Unknown input type: "+n+".")}function h3(n,t){return function(e,s){return(e-1)%s==0}(n,t)?n:Math.floor(n/t)*t+1}var dc={low:"low",medium:"medium",high:"high",full:"full"},sj=((rc={})[dc.low]=.25,rc[dc.medium]=.5,rc[dc.high]=.75,rc[dc.full]=1,rc);function zd(n,t,e){var s=e[0],r=e[1],i=function(o){if(typeof o=="string"){var a=sj[o];return V(typeof a=="number",function(){return"string value of inputResolution must be one of "+Object.values(dc).join(",")+" but was "+o+"."}),a}return V(typeof o=="number"&&o<=2&&o>=.1,function(){return"inputResolution must be a string or number between 0.1 and 2, but was "+o}),o}(n);return[h3(s*i,t),h3(r*i,t)]}function wu(n,t,e,s,r){var i=t[0],o=t[1],a=e[0],u=e[1],l=s[0],c=l[0],h=l[1],d=s[1],f=d[0],p=d[1];return r===void 0&&(r=!1),pt(function(){var m=Bn.resizeBilinear(n,[a,u],!0);return r&&(m=Hs(m)),function(g,y,b){var w=y[0],v=y[1],S=b[0],N=S[0],R=S[1],L=b[1],F=L[0],B=L[1];return pt(function(){var H=gn(g);return tn(Bn.cropAndResize(H,[[N/(w+N+R-1),F/(v+F+B-1),(N+w-1)/(w+N+R-1),(F+v-1)/(v+F+B-1)]],[0],[w,v]),[0])})}(m,[i,o],[[c,h],[f,p]])})}function Bd(n,t){var e=t[0],s=t[1],r=hc(n),i=r[0],o=r[1],a=s/e,u=[0,0,0,0],l=u[0],c=u[1],h=u[2],d=u[3];o/i<a?(l=0,c=0,h=Math.round(.5*(a*i-o)),d=Math.round(.5*(a*i-o))):(l=Math.round(.5*(1/a*o-i)),c=Math.round(.5*(1/a*o-i)),h=0,d=0);var f=pt(function(){var p=function(m){return m instanceof $e?m:iu(m)}(n);return p=B0(p,[[l,c],[h,d],[0,0]]),Bn.resizeBilinear(p,[e,s])});return{resized:f,padding:{top:l,left:h,right:d,bottom:c}}}function Vd(n){return He(this,void 0,void 0,function(){return Ke(this,function(t){return[2,Promise.all(n.map(function(e){return e.buffer()}))]})})}function Ud(n,t,e,s,r){var i=t[0],o=t[1],a=e[0],u=e[1],l=function(c,h,d,f,p){return f===void 0&&(f=0),p===void 0&&(p=0),d===1&&h===1&&f===0&&p===0?c:c.map(function(m){return function(g,y,b,w,v){return w===void 0&&(w=0),v===void 0&&(v=0),{score:g.score,keypoints:g.keypoints.map(function(S){var N=S.score,R=S.part,L=S.position;return{score:N,part:R,position:{x:L.x*b+v,y:L.y*y+w}}})}}(m,h,d,f,p)})}(n,(i+s.top+s.bottom)/a,(o+s.left+s.right)/u,-s.top,-s.left);return r?function(c,h){return h<=0?c:c.map(function(d){return function(f,p){return{score:f.score,keypoints:f.keypoints.map(function(m){var g=m.score,y=m.part,b=m.position;return{score:g,part:y,position:{x:p-1-b.x,y:b.y}}})}}(d,h)})}(l,o):l}var d3={architecture:"MobileNetV1",outputStride:16,quantBytes:4,multiplier:.75},f3=["MobileNetV1","ResNet50"],p3={MobileNetV1:[8,16,32],ResNet50:[32,16]},m3={MobileNetV1:[.5,.75,1],ResNet50:[1]},g3=[1,2,4],Wd={flipHorizontal:!1,internalResolution:"medium",segmentationThreshold:.7,maxDetections:10,scoreThreshold:.4,nmsRadius:20},Gd={flipHorizontal:!1,internalResolution:"medium",segmentationThreshold:.7,maxDetections:10,scoreThreshold:.4,nmsRadius:20,minKeypointScore:.3,refineSteps:10};function y3(n){var t=n.segmentationThreshold,e=n.maxDetections,s=n.scoreThreshold,r=n.nmsRadius;if(t<0||t>1)throw new Error("segmentationThreshold "+t+". Should be in range [0.0, 1.0]");if(e<=0)throw new Error("Invalid maxDetections "+e+". Should be > 0");if(s<0||s>1)throw new Error("Invalid scoreThreshold "+s+". Should be in range [0.0, 1.0]");if(r<=0)throw new Error("Invalid nmsRadius "+r+".")}function b3(n){var t=n.segmentationThreshold,e=n.maxDetections,s=n.scoreThreshold,r=n.nmsRadius,i=n.minKeypointScore,o=n.refineSteps;if(t<0||t>1)throw new Error("segmentationThreshold "+t+". Should be in range [0.0, 1.0]");if(e<=0)throw new Error("Invalid maxDetections "+e+". Should be > 0");if(s<0||s>1)throw new Error("Invalid scoreThreshold "+s+". Should be in range [0.0, 1.0]");if(r<=0)throw new Error("Invalid nmsRadius "+r+".");if(i<0||i>1)throw new Error("Invalid minKeypointScore "+i+".Should be in range [0.0, 1.0]");if(o<=0||o>20)throw new Error("Invalid refineSteps "+o+".Should be in range [1, 20]")}var nS=function(){function n(t){this.baseModel=t}return n.prototype.predictForPersonSegmentation=function(t){var e=this.baseModel.predict(t);return{segmentLogits:e.segmentation,heatmapScores:e.heatmapScores,offsets:e.offsets,displacementFwd:e.displacementFwd,displacementBwd:e.displacementBwd}},n.prototype.predictForPersonSegmentationAndPart=function(t){var e=this.baseModel.predict(t);return{segmentLogits:e.segmentation,partHeatmapLogits:e.partHeatmaps,heatmapScores:e.heatmapScores,offsets:e.offsets,displacementFwd:e.displacementFwd,displacementBwd:e.displacementBwd}},n.prototype.predictForMultiPersonInstanceSegmentationAndPart=function(t){var e=this.baseModel.predict(t);return{segmentLogits:e.segmentation,longOffsets:e.longOffsets,heatmapScores:e.heatmapScores,offsets:e.offsets,displacementFwd:e.displacementFwd,displacementBwd:e.displacementBwd,partHeatmaps:e.partHeatmaps}},n.prototype.segmentPersonActivation=function(t,e,s){var r=this;s===void 0&&(s=.5);var i=hc(t),o=i[0],a=i[1],u=zd(e,this.baseModel.outputStride,[o,a]),l=Bd(t,u),c=l.resized,h=l.padding,d=pt(function(){var b=r.predictForPersonSegmentation(c),w=b.segmentLogits,v=b.heatmapScores,S=b.offsets,N=b.displacementFwd,R=b.displacementBwd,L=c.shape,F=L[0],B=L[1],H=wu(w,[o,a],[F,B],[[h.top,h.bottom],[h.left,h.right]],!0);return{segmentation:Pd(tn(H),s),heatmapScores:v,offsets:S,displacementFwd:N,displacementBwd:R}}),f=d.segmentation,p=d.heatmapScores,m=d.offsets,g=d.displacementFwd,y=d.displacementBwd;return c.dispose(),{segmentation:f,heatmapScores:p,offsets:m,displacementFwd:g,displacementBwd:y,padding:h,internalResolutionHeightAndWidth:u}},n.prototype.segmentPerson=function(t,e){return e===void 0&&(e=Wd),He(this,void 0,void 0,function(){var s,r,i,o,a,u,l,c,h,d,f,p,m,g,y,b,w,v;return Ke(this,function(S){switch(S.label){case 0:return y3(e=Ts(Ts({},Wd),e)),s=this.segmentPersonActivation(t,e.internalResolution,e.segmentationThreshold),r=s.segmentation,i=s.heatmapScores,o=s.offsets,a=s.displacementFwd,u=s.displacementBwd,l=s.padding,c=s.internalResolutionHeightAndWidth,h=r.shape,d=h[0],f=h[1],[4,r.data()];case 1:return p=S.sent(),r.dispose(),[4,Vd([i,o,a,u])];case 2:return m=S.sent(),g=m[0],y=m[1],b=m[2],w=m[3],v=Ud(v=Md(g,y,b,w,this.baseModel.outputStride,e.maxDetections,e.scoreThreshold,e.nmsRadius),[d,f],c,l,!1),i.dispose(),o.dispose(),a.dispose(),u.dispose(),[2,{height:d,width:f,data:p,allPoses:v}]}})})},n.prototype.segmentMultiPerson=function(t,e){return e===void 0&&(e=Gd),He(this,void 0,void 0,function(){var s,r,i,o,a,u,l,c,h,d,f,p,m,g,y,b,w,v,S,N,R,L=this;return Ke(this,function(F){switch(F.label){case 0:return b3(e=Ts(Ts({},Gd),e)),s=hc(t),r=s[0],i=s[1],o=zd(e.internalResolution,this.baseModel.outputStride,[r,i]),a=Bd(t,o),u=a.resized,l=a.padding,c=pt(function(){var B,H=L.predictForMultiPersonInstanceSegmentationAndPart(u),z=H.segmentLogits,G=H.longOffsets,T=H.heatmapScores,K=H.offsets,ht=H.displacementFwd,rt=H.displacementBwd,gt=wu(z,[r,i],o,[[l.top,l.bottom],[l.left,l.right]],!0);return B=G,{segmentation:Pd(tn(gt),e.segmentationThreshold),longOffsets:B,heatmapScoresRaw:T,offsetsRaw:K,displacementFwdRaw:ht,displacementBwdRaw:rt}}),h=c.segmentation,d=c.longOffsets,f=c.heatmapScoresRaw,p=c.offsetsRaw,m=c.displacementFwdRaw,g=c.displacementBwdRaw,[4,Vd([f,p,m,g])];case 1:return y=F.sent(),b=y[0],w=y[1],v=y[2],S=y[3],N=Ud(N=Md(b,w,v,S,this.baseModel.outputStride,e.maxDetections,e.scoreThreshold,e.nmsRadius),[r,i],o,l,!1),[4,XG(h,d,N,r,i,this.baseModel.outputStride,o,l,e.scoreThreshold,e.refineSteps,e.minKeypointScore,e.maxDetections)];case 2:return R=F.sent(),u.dispose(),h.dispose(),d.dispose(),f.dispose(),p.dispose(),m.dispose(),g.dispose(),[2,R]}})})},n.prototype.segmentPersonPartsActivation=function(t,e,s){var r=this;s===void 0&&(s=.5);var i=hc(t),o=i[0],a=i[1],u=zd(e,this.baseModel.outputStride,[o,a]),l=Bd(t,u),c=l.resized,h=l.padding,d=pt(function(){var b=r.predictForPersonSegmentationAndPart(c),w=b.segmentLogits,v=b.partHeatmapLogits,S=b.heatmapScores,N=b.offsets,R=b.displacementFwd,L=b.displacementBwd,F=c.shape,B=F[0],H=F[1],z=wu(w,[o,a],[B,H],[[h.top,h.bottom],[h.left,h.right]],!0),G=wu(v,[o,a],[B,H],[[h.top,h.bottom],[h.left,h.right]],!0);return{partSegmentation:jG(Pd(tn(z),s),G),heatmapScores:S,offsets:N,displacementFwd:R,displacementBwd:L}}),f=d.partSegmentation,p=d.heatmapScores,m=d.offsets,g=d.displacementFwd,y=d.displacementBwd;return c.dispose(),{partSegmentation:f,heatmapScores:p,offsets:m,displacementFwd:g,displacementBwd:y,padding:h,internalResolutionHeightAndWidth:u}},n.prototype.segmentPersonParts=function(t,e){return e===void 0&&(e=Wd),He(this,void 0,void 0,function(){var s,r,i,o,a,u,l,c,h,d,f,p,m,g,y,b,w,v;return Ke(this,function(S){switch(S.label){case 0:return y3(e=Ts(Ts({},Wd),e)),s=this.segmentPersonPartsActivation(t,e.internalResolution,e.segmentationThreshold),r=s.partSegmentation,i=s.heatmapScores,o=s.offsets,a=s.displacementFwd,u=s.displacementBwd,l=s.padding,c=s.internalResolutionHeightAndWidth,h=r.shape,d=h[0],f=h[1],[4,r.data()];case 1:return p=S.sent(),r.dispose(),[4,Vd([i,o,a,u])];case 2:return m=S.sent(),g=m[0],y=m[1],b=m[2],w=m[3],v=Ud(v=Md(g,y,b,w,this.baseModel.outputStride,e.maxDetections,e.scoreThreshold,e.nmsRadius),[d,f],c,l,!1),i.dispose(),o.dispose(),a.dispose(),u.dispose(),[2,{height:d,width:f,data:p,allPoses:v}]}})})},n.prototype.segmentMultiPersonParts=function(t,e){return e===void 0&&(e=Gd),He(this,void 0,void 0,function(){var s,r,i,o,a,u,l,c,h,d,f,p,m,g,y,b,w,v,S,N,R,L,F=this;return Ke(this,function(B){switch(B.label){case 0:return b3(e=Ts(Ts({},Gd),e)),s=hc(t),r=s[0],i=s[1],o=zd(e.internalResolution,this.baseModel.outputStride,[r,i]),a=Bd(t,o),u=a.resized,l=a.padding,c=pt(function(){var H=F.predictForMultiPersonInstanceSegmentationAndPart(u),z=H.segmentLogits,G=H.longOffsets,T=H.heatmapScores,K=H.offsets,ht=H.displacementFwd,rt=H.displacementBwd,gt=H.partHeatmaps,at=wu(z,[r,i],o,[[l.top,l.bottom],[l.left,l.right]],!0),It=wu(gt,[r,i],o,[[l.top,l.bottom],[l.left,l.right]],!0),et=G,st=Pd(tn(at),e.segmentationThreshold),St=function(kt){var yt=kt.shape,Pt=yt[0],Xt=yt[1],Wt=yt[2];return pt(function(){var Bt=Hk(kt),Jt=gn(oo(0,Wt,1,"int32"),1),jt=Kt(De(Bt,Jt),"int32");return ct(jt,[Pt,Xt])})}(It);return{segmentation:st,longOffsets:et,heatmapScoresRaw:T,offsetsRaw:K,displacementFwdRaw:ht,displacementBwdRaw:rt,partSegmentation:St}}),h=c.segmentation,d=c.longOffsets,f=c.heatmapScoresRaw,p=c.offsetsRaw,m=c.displacementFwdRaw,g=c.displacementBwdRaw,y=c.partSegmentation,[4,Vd([f,p,m,g])];case 1:return b=B.sent(),w=b[0],v=b[1],S=b[2],N=b[3],R=Ud(R=Md(w,v,S,N,this.baseModel.outputStride,e.maxDetections,e.scoreThreshold,e.nmsRadius),[r,i],o,l,!1),[4,YG(h,d,y,R,r,i,this.baseModel.outputStride,o,l,e.scoreThreshold,e.refineSteps,e.minKeypointScore,e.maxDetections)];case 2:return L=B.sent(),u.dispose(),h.dispose(),d.dispose(),f.dispose(),p.dispose(),m.dispose(),g.dispose(),y.dispose(),[2,L]}})})},n.prototype.dispose=function(){this.baseModel.dispose()},n}();function rj(n){return He(this,void 0,void 0,function(){var t,e,s,r,i,o;return Ke(this,function(a){switch(a.label){case 0:if(t=n.outputStride,e=n.quantBytes,s=n.multiplier,Hv==null)throw new Error(`Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this
        model.`);return r=function(u,l,c){var h={1:"100",.75:"075",.5:"050"},d="model-stride"+u+".json";return c===4?c3+"float/"+h[l]+"/"+d:c3+"quant"+c+"/"+h[l]+"/"+d}(t,s,e),[4,pd(n.modelUrl||r)];case 1:return i=a.sent(),o=new HG(i,t),[2,new nS(o)]}})})}function ij(n){return He(this,void 0,void 0,function(){var t,e,s,r,i;return Ke(this,function(o){switch(o.label){case 0:if(t=n.outputStride,e=n.quantBytes,Hv==null)throw new Error(`Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this
        model.`);return s=function(a,u){var l="model-stride"+a+".json";return u===4?l3+"float/"+l:l3+"quant"+u+"/"+l}(t,e),[4,pd(n.modelUrl||s)];case 1:return r=o.sent(),i=new nj(r,t),[2,new nS(i)]}})})}function oj(n){return n===void 0&&(n=d3),He(this,void 0,void 0,function(){return Ke(this,function(t){return(n=function(e){if((e=e||d3).architecture==null&&(e.architecture="MobileNetV1"),f3.indexOf(e.architecture)<0)throw new Error("Invalid architecture "+e.architecture+". Should be one of "+f3);if(e.outputStride==null&&(e.outputStride=16),p3[e.architecture].indexOf(e.outputStride)<0)throw new Error("Invalid outputStride "+e.outputStride+". Should be one of "+p3[e.architecture]+" for architecture "+e.architecture+".");if(e.multiplier==null&&(e.multiplier=1),m3[e.architecture].indexOf(e.multiplier)<0)throw new Error("Invalid multiplier "+e.multiplier+". Should be one of "+m3[e.architecture]+" for architecture "+e.architecture+".");if(e.quantBytes==null&&(e.quantBytes=4),g3.indexOf(e.quantBytes)<0)throw new Error("Invalid quantBytes "+e.quantBytes+". Should be one of "+g3+" for architecture "+e.architecture+".");return e}(n)).architecture==="ResNet50"?[2,ij(n)]:n.architecture==="MobileNetV1"?[2,rj(n)]:[2,null]})})}var C1=["left_face","right_face","left_upper_arm_front","left_upper_arm_back","right_upper_arm_front","right_upper_arm_back","left_lower_arm_front","left_lower_arm_back","right_lower_arm_front","right_lower_arm_back","left_hand","right_hand","torso_front","torso_back","left_upper_leg_front","left_upper_leg_back","right_upper_leg_front","right_upper_leg_back","left_lower_leg_front","left_lower_leg_back","right_lower_leg_front","right_lower_leg_back","left_feet","right_feet"],x3=function(){function n(t){this.mask=t}return n.prototype.toCanvasImageSource=function(){return He(this,void 0,void 0,function(){return Ke(this,function(t){return[2,ly(this.mask)]})})},n.prototype.toImageData=function(){return He(this,void 0,void 0,function(){return Ke(this,function(t){return[2,this.mask]})})},n.prototype.toTensor=function(){return He(this,void 0,void 0,function(){return Ke(this,function(t){return[2,jk(this.mask)]})})},n.prototype.getUnderlyingType=function(){return"imagedata"},n}();function aj(n){if(Um(n),n!==255)throw new Error("Foreground id must be 255 but got "+n);return"person"}function uj(n){if(Um(n),n>=C1.length)throw new Error("Invalid body part value "+n);return C1[n]}var lj=function(){function n(t){this.bodyPixModel=t}return n.prototype.segmentPeople=function(t,e){return He(this,void 0,void 0,function(){var s,r,i,o;return Ke(this,function(a){switch(a.label){case 0:return t instanceof ImageBitmap&&((s=document.createElement("canvas")).getContext("2d").drawImage(t,0,0),t=s),e.segmentBodyParts?e.multiSegmentation?[4,this.bodyPixModel.segmentMultiPersonParts(t,e)]:[3,2]:[3,5];case 1:return i=a.sent(),[3,4];case 2:return[4,this.bodyPixModel.segmentPersonParts(t,e)];case 3:i=[a.sent()],a.label=4;case 4:return r=i.map(function(u){var l=u.data,c=u.width,h=u.height,d=new Uint8ClampedArray(c*h*4).fill(0);return l.forEach(function(f,p){f===-1?(d[4*p]=C1.length,d[4*p+3]=0):(d[4*p]=f,d[4*p+3]=255)}),{maskValueToLabel:uj,mask:new x3(new ImageData(d,c,h))}}),[3,10];case 5:return e.multiSegmentation?[4,this.bodyPixModel.segmentMultiPerson(t,e)]:[3,7];case 6:return o=a.sent(),[3,9];case 7:return[4,this.bodyPixModel.segmentPerson(t,e)];case 8:o=[a.sent()],a.label=9;case 9:r=o.map(function(u){var l=u.data,c=u.width,h=u.height,d=new Uint8ClampedArray(c*h*4).fill(0);return l.forEach(function(f,p){f===0?(d[4*p]=0,d[4*p+3]=0):(d[4*p]=255,d[4*p+3]=255)}),{maskValueToLabel:aj,mask:new x3(new ImageData(d,c,h))}}),a.label=10;case 10:return[2,r]}})})},n.prototype.dispose=function(){this.bodyPixModel.dispose()},n.prototype.reset=function(){},n}();function cj(n){return He(this,void 0,void 0,function(){return Ke(this,function(t){return[2,oj(n).then(function(e){return new lj(e)})]})})}var w3={runtime:"mediapipe",modelType:"general"},hj=function(){function n(t){this.mask=t}return n.prototype.toCanvasImageSource=function(){return He(this,void 0,void 0,function(){return Ke(this,function(t){return[2,this.mask]})})},n.prototype.toImageData=function(){return He(this,void 0,void 0,function(){return Ke(this,function(t){return[2,Gk(this.mask)]})})},n.prototype.toTensor=function(){return He(this,void 0,void 0,function(){return Ke(this,function(t){return[2,jk(this.mask)]})})},n.prototype.getUnderlyingType=function(){return"canvasimagesource"},n}();function dj(n){return Um(n),"person"}var fj=function(){function n(t){var e,s=this;this.selfieMode=!1,this.selfieSegmentationSolution=new GG.SelfieSegmentation({locateFile:function(r,i){return t.solutionPath?t.solutionPath.replace(/\/+$/,"")+"/"+r:i+"/"+r}}),t.modelType==="landscape"?e=1:e=0,this.selfieSegmentationSolution.setOptions({modelSelection:e,selfieMode:this.selfieMode}),this.selfieSegmentationSolution.onResults(function(r){s.segmentation=[{maskValueToLabel:dj,mask:new hj(r.segmentationMask)}]})}return n.prototype.segmentPeople=function(t,e){return He(this,void 0,void 0,function(){var s,r;return Ke(this,function(i){switch(i.label){case 0:return e&&e.flipHorizontal&&e.flipHorizontal!==this.selfieMode&&(this.selfieMode=e.flipHorizontal,this.selfieSegmentationSolution.setOptions({selfieMode:this.selfieMode})),t instanceof $e?(r=ImageData.bind,[4,ru(t)]):[3,2];case 1:return s=new(r.apply(ImageData,[void 0,i.sent(),t.shape[1],t.shape[0]])),[3,3];case 2:s=t,i.label=3;case 3:return t=s,[4,this.selfieSegmentationSolution.send({image:t})];case 4:return i.sent(),[2,this.segmentation]}})})},n.prototype.dispose=function(){this.selfieSegmentationSolution.close()},n.prototype.reset=function(){this.selfieSegmentationSolution.reset(),this.segmentation=null,this.selfieMode=!1},n.prototype.initialize=function(){return this.selfieSegmentationSolution.initialize()},n}();function pj(n){return He(this,void 0,void 0,function(){var t,e;return Ke(this,function(s){switch(s.label){case 0:return t=function(r){if(r==null)return Ts({},w3);var i=Ts({},r);return i.runtime="mediapipe",i.modelType==null&&(i.modelType=w3.modelType),i}(n),[4,(e=new fj(t)).initialize()];case 1:return s.sent(),[2,e]}})})}function mj(n,t,e,s){var r=n.width,i=n.height,o=s?-1:1,a=Math.cos(n.rotation),u=Math.sin(n.rotation),l=n.xCenter,c=n.yCenter,h=1/t,d=1/e,f=new Array(16);return f[0]=r*a*o*h,f[1]=-i*u*h,f[2]=0,f[3]=(-.5*r*a*o+.5*i*u+l)*h,f[4]=r*u*o*d,f[5]=i*a*d,f[6]=0,f[7]=(-.5*i*a-.5*r*u*o+c)*d,f[8]=0,f[9]=0,f[10]=r*h,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,function(p){if(p.length!==16)throw new Error("Array length must be 16 but got "+p.length);return[[p[0],p[1],p[2],p[3]],[p[4],p[5],p[6],p[7]],[p[8],p[9],p[10],p[11]],[p[12],p[13],p[14],p[15]]]}(f)}function sS(n){return n instanceof $e?{height:n.shape[0],width:n.shape[1]}:{height:n.height,width:n.width}}function _g(n,t){V(n.width!==0,function(){return t+" width cannot be 0."}),V(n.height!==0,function(){return t+" height cannot be 0."})}function gj(n,t){var e=function(s,r,i,o){var a=r-s,u=o-i;if(a===0)throw new Error("Original min and max are both "+s+", range cannot be 0.");var l=u/a;return{scale:l,offset:i-s*l}}(0,255,t[0],t[1]);return pt(function(){return Lt(ut(n,e.scale),e.offset)})}function yj(n,t,e){var s=t.outputTensorSize,r=t.keepAspectRatio,i=t.borderMode,o=t.outputTensorFloatRange,a=sS(n),u=function(d,f){return f?{xCenter:f.xCenter*d.width,yCenter:f.yCenter*d.height,width:f.width*d.width,height:f.height*d.height,rotation:f.rotation}:{xCenter:.5*d.width,yCenter:.5*d.height,width:d.width,height:d.height,rotation:0}}(a,e),l=function(d,f,p){if(p===void 0&&(p=!1),!p)return{top:0,left:0,right:0,bottom:0};var m=f.height,g=f.width;_g(f,"targetSize"),_g(d,"roi");var y,b,w=m/g,v=d.height/d.width,S=0,N=0;return w>v?(y=d.width,b=d.width*w,N=(1-v/w)/2):(y=d.height/w,b=d.height,S=(1-w/v)/2),d.width=y,d.height=b,{top:N,left:S,right:S,bottom:N}}(u,s,r),c=mj(u,a.width,a.height,!1),h=pt(function(){var d,f=(d=n)instanceof $e?d:iu(d),p=Di(function(y,b,w){return _g(w,"inputResolution"),[1/w.width*y[0][0]*b.width,1/w.height*y[0][1]*b.width,y[0][3]*b.width,1/w.width*y[1][0]*b.height,1/w.height*y[1][1]*b.height,y[1][3]*b.height,0,0]}(c,a,s),[1,8]),m=i==="zero"?"constant":"nearest",g=Bn.transform(gn(Kt(f,"float32")),p,"bilinear",m,0,[s.height,s.width]);return o!=null?gj(g,o):g});return{imageTensor:h,padding:l,transformationMatrix:c}}function bj(n,t,e){return pt(function(){var s=tn(n,[0]),r=s.shape[2];if(r===1){var i=s;switch(t.activation){case"none":break;case"sigmoid":i=Hs(i);break;case"softmax":throw new Error("Softmax activation requires two channels.");default:throw new Error("Activation not supported ("+t.activation+")")}var o=e?Bn.resizeBilinear(i,[e.height,e.width]):i;return tn(o,[2])}throw new Error("Unsupported number of tensor channels "+r)})}var v3={runtime:"tfjs",modelType:"general",modelUrl:"https://tfhub.dev/mediapipe/tfjs-model/selfie_segmentation/general/1"},k3={flipHorizontal:!1},xj={outputTensorSize:{width:256,height:256},keepAspectRatio:!1,borderMode:"zero",outputTensorFloatRange:[0,1]},wj={outputTensorSize:{width:256,height:144},keepAspectRatio:!1,borderMode:"zero",outputTensorFloatRange:[0,1]},vj={activation:"none"},kj=function(){function n(t){this.mask=t}return n.prototype.toCanvasImageSource=function(){return He(this,void 0,void 0,function(){return Ke(this,function(t){return[2,ly(this.mask)]})})},n.prototype.toImageData=function(){return He(this,void 0,void 0,function(){return Ke(this,function(t){return[2,Gk(this.mask)]})})},n.prototype.toTensor=function(){return He(this,void 0,void 0,function(){return Ke(this,function(t){return[2,this.mask]})})},n.prototype.getUnderlyingType=function(){return"tensor"},n}();function Sj(n){return Um(n),"person"}var Dc,Ij=function(){function n(t,e){this.modelType=t,this.model=e}return n.prototype.segmentPeople=function(t,e){return He(this,void 0,void 0,function(){var s,r=this;return Ke(this,function(i){return e=function(o){if(o==null)return Ts({},k3);var a=Ts({},o);return a.flipHorizontal==null&&(a.flipHorizontal=k3.flipHorizontal),a}(e),t==null?(this.reset(),[2,[]]):(s=pt(function(){var o=yj(t,r.modelType==="general"?xj:wj).imageTensor,a=xe(r.model.predict(o),[0,0,0,1],-1),u=sS(t),l=bj(a,vj,u),c=gn(l,2),h=Ui(c,[[0,0],[0,0],[0,1]]);return im(h,[[0,0],[0,0],[0,2]],"symmetric")}),[2,[{maskValueToLabel:Sj,mask:new kj(s)}]])})})},n.prototype.dispose=function(){this.model.dispose()},n.prototype.reset=function(){},n}();function Cj(n){return He(this,void 0,void 0,function(){var t,e,s;return Ke(this,function(r){switch(r.label){case 0:return t=function(i){if(i==null)return Ts({},v3);var o=Ts({},i);if(o.runtime="tfjs",o.modelType==null&&(o.modelType=v3.modelType),o.modelType!=="general"&&o.modelType!=="landscape")throw new Error("Model type must be one of general or landscape, but got "+o.modelType);return o.modelUrl==null&&(o.modelType==="general"?o.modelUrl="https://tfhub.dev/mediapipe/tfjs-model/selfie_segmentation/general/1":o.modelUrl="https://tfhub.dev/mediapipe/tfjs-model/selfie_segmentation/landscape/1"),o}(n),e=typeof t.modelUrl=="string"&&t.modelUrl.indexOf("https://tfhub.dev")>-1,[4,pd(t.modelUrl,{fromTFHub:e})];case 1:return s=r.sent(),[2,new Ij(t.modelType,s)]}})})}function Nj(n,t){return He(this,void 0,void 0,function(){var e,s;return Ke(this,function(r){switch(n){case Dc.MediaPipeSelfieSegmentation:if(e=void 0,(s=t)!=null){if(s.runtime==="tfjs")return[2,Cj(s)];if(s.runtime==="mediapipe")return[2,pj(s)];e=s.runtime}throw new Error("Expect modelConfig.runtime to be either 'tfjs' or 'mediapipe', but got "+e);case Dc.BodyPix:return[2,cj(s=t)];default:throw new Error(n+" is not a supported model name.")}})})}(function(n){n.BodyPix="BodyPix",n.MediaPipeSelfieSegmentation="MediaPipeSelfieSegmentation"})(Dc||(Dc={}));var Tj="blurred-mask",$j="mask",Ej="draw-image",Ag={};function _j(n,t,e,s){var r=n.width,i=n.height,o=t.width,a=t.height;if(r!==o||i!==a)throw new Error("error: dimensions must match. "+e+" has dimensions "+r+"x"+i+", "+s+" has dimensions "+o+"x"+a)}function Gm(n){if(typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas||typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)return function(t){if("offsetHeight"in t&&t.offsetHeight!==0&&"offsetWidth"in t&&t.offsetWidth!==0)return[t.offsetHeight,t.offsetWidth];if(t.height!=null&&t.width!=null)return[t.height,t.width];throw new Error("HTMLImageElement must have height and width attributes set.")}(n);if(typeof ImageData<"u"&&n instanceof ImageData)return[n.height,n.width];if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)return function(t){return t.hasAttribute("height")&&t.hasAttribute("width")?[t.height,t.width]:[t.videoHeight,t.videoWidth]}(n);if(n instanceof $e)return[n.shape[0],n.shape[1]];throw new Error("error: Unknown input type: "+n+".")}function rS(n){return Ag[n]||(Ag[n]=function(){if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(0,0);throw new Error("Cannot create a canvas in this context")}()),Ag[n]}function iS(n,t){var e=rS(t);return function(s,r){r.width=s.width,r.height=s.height,r.getContext("2d").putImageData(s,0,0)}(n,e),e}function jm(n,t,e,s,r,i){return He(this,void 0,void 0,function(){var o,a,u,l;return Ke(this,function(c){switch(c.label){case 0:return t instanceof $e?[4,ru(t)]:[3,2];case 1:o=c.sent(),a=Gm(t),u=a[0],l=a[1],t=new ImageData(o,l,u),c.label=2;case 2:return t instanceof ImageData&&(t=iS(t,Ej)),r==null||i==null?n.drawImage(t,e,s):n.drawImage(t,e,s,r,i),[2]}})})}function Aj(n,t){return He(this,void 0,void 0,function(){var e,s,r;return Ke(this,function(i){switch(i.label){case 0:return e=Gm(n),s=e[0],r=e[1],t.width=r,t.height=s,[4,jm(t.getContext("2d"),n,0,0,r,s)];case 1:return i.sent(),[2]}})})}function Rj(n){var t=n.getContext("2d");t.scale(-1,1),t.translate(-n.width,0)}function Dj(n,t,e){return He(this,void 0,void 0,function(){var s,r,i,o,a,u,l,c;return Ke(this,function(h){switch(h.label){case 0:for(s=n.getContext("2d"),r=0,i=5,o=1/(2*Math.PI*i*i),a=e<3?1:2,l=-e;l<=e;l+=a)for(c=-e;c<=e;c+=a)u=o*Math.exp(-(c*c+l*l)/(2*i*i)),r+=u;l=-e,h.label=1;case 1:if(!(l<=e))return[3,6];c=-e,h.label=2;case 2:return c<=e?(s.globalAlpha=o*Math.exp(-(c*c+l*l)/(2*i*i))/r*e,[4,jm(s,t,c,l)]):[3,5];case 3:h.sent(),h.label=4;case 4:return c+=a,[3,2];case 5:return l+=a,[3,1];case 6:return s.globalAlpha=1,[2]}})})}function Oj(n,t,e){return He(this,void 0,void 0,function(){var s,r,i,o;return Ke(this,function(a){switch(a.label){case 0:return s=Gm(n),r=s[0],i=s[1],o=e.getContext("2d"),e.width=i,e.height=r,o.clearRect(0,0,i,r),o.save(),/^((?!chrome|android).)*safari/i.test(navigator.userAgent)?[4,Dj(e,n,t)]:[3,2];case 1:return a.sent(),[3,4];case 2:return o.filter="blur("+t+"px)",[4,jm(o,n,0,0,i,r)];case 3:a.sent(),a.label=4;case 4:return o.restore(),[2]}})})}function Fj(n,t,e){return He(this,void 0,void 0,function(){var s;return Ke(this,function(r){switch(r.label){case 0:return s=rS(e),t!==0?[3,2]:[4,Aj(n,s)];case 1:return r.sent(),[3,4];case 2:return[4,Oj(n,t,s)];case 3:r.sent(),r.label=4;case 4:return[2,s]}})})}function Lj(n,t,e,s,r,i){i===void 0&&(i={r:0,g:255,b:255,a:255});for(var o=-r;o<=r;o++)for(var a=-r;a<=r;a++)if(o!==0&&a!==0){var u=(t+o)*s+(e+a);n[4*u+0]=i.r,n[4*u+1]=i.g,n[4*u+2]=i.b,n[4*u+3]=i.a}}function Pj(n,t,e,s,r,i,o){o===void 0&&(o=1);for(var a=0,u=-o;u<=o;u++)for(var l=-o;l<=o;l++)if(u!==0&&l!==0){var c=(t+u)*s+(e+l);(!r[n[4*c]]||n[4*c+3]<i)&&(a+=1)}return a>0}function Mj(n,t,e,s,r,i){return t===void 0&&(t={r:0,g:0,b:0,a:0}),e===void 0&&(e={r:0,g:0,b:0,a:255}),s===void 0&&(s=!1),r===void 0&&(r=.5),i===void 0&&(i=Array.from(Array(256).keys())),He(this,void 0,void 0,function(){var o,a,u,l,c,h,d,f,p,m,g,y,b,w;return Ke(this,function(v){switch(v.label){case 0:return(o=Array.isArray(n)?n:[n]).length===0?[2,null]:[4,Promise.all(o.map(function(S){return S.mask.toImageData()}))];case 1:for(a=v.sent(),u=a[0],l=u.width,c=u.height,h=new Uint8ClampedArray(l*c*4),d=Math.round(255*r),f=new Array(256).fill(!1),i.forEach(function(S){return f[S]=!0}),p=0;p<c;p++)for(m=0;m<l;m++)for(h[4*(g=p*l+m)+0]=e.r,h[4*g+1]=e.g,h[4*g+2]=e.b,h[4*g+3]=e.a,y=0,b=a;y<b.length;y++)w=b[y],f[w.data[4*g]]&&w.data[4*g+3]>=d&&(h[4*g]=t.r,h[4*g+1]=t.g,h[4*g+2]=t.b,h[4*g+3]=t.a,s&&p-1>=0&&p+1<c&&m-1>=0&&m+1<l&&Pj(w.data,p,m,l,f,d)&&Lj(h,p,m,l,1));return[2,new ImageData(h,l,c)]}})})}function zj(n,t,e,s,r,i){return s===void 0&&(s=.7),r===void 0&&(r=0),i===void 0&&(i=!1),He(this,void 0,void 0,function(){var o,a,u,l,c;return Ke(this,function(h){switch(h.label){case 0:return o=Gm(t),a=o[0],u=o[1],n.width=u,n.height=a,(l=n.getContext("2d")).save(),i&&Rj(n),[4,jm(l,t,0,0)];case 1:return h.sent(),l.globalAlpha=s,e?(_j({width:u,height:a},e,"image","mask"),[4,Fj(iS(e,$j),r,Tj)]):[3,3];case 2:c=h.sent(),l.drawImage(c,0,0,u,a),h.label=3;case 3:return l.restore(),[2]}})})}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oS={kernelName:Mc,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ut(n,nu(Kt(e,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bj={kernelName:Wu,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>{const s=an(Kt(e,"float32")),r=cs(oe(fe(1),s));return dn(ie(n,r))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vj={kernelName:Gu,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>{const s=cs(oe(an(Kt(e,"float32")),1));return ie(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uj={kernelName:Za,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,r=Ee(e.shape,s.shape);return{a:()=>{let a=n;const u=Un(e.shape,r);return u.length>0&&(a=he(a,u)),ct(a,e.shape)},b:()=>{let a=n;const u=Un(s.shape,r);return u.length>0&&(a=he(a,u)),ct(a,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wj={kernelName:zc,saveAllInputs:!0,gradFunc:(n,t)=>{const e={};return t.forEach((s,r)=>{e[r]=()=>n.clone()}),e}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gj={kernelName:Bc,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>je(e)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jj={kernelName:Vc,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>je(e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hj={kernelName:ju,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ie(n,cs(oe(fe(1),an(Kt(e,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kj={kernelName:Hu,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>{const s=cs(Lt(fe(1),an(Kt(e,"float32"))));return ie(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qj={kernelName:Xu,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,r=Ee(e.shape,s.shape);return{a:()=>{const a=Lt(an(e),an(s));let u=ut(n,ie(s,a));const l=Un(e.shape,r);return l.length>0&&(u=he(u,l)),ct(u,e.shape)},b:()=>{const a=Lt(an(e),an(s));let u=dn(ut(n,ie(e,a)));const l=Un(s.shape,r);return l.length>0&&(u=he(u,l)),ct(u,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xj={kernelName:Ku,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ie(n,Lt(an(Kt(e,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yj={kernelName:qu,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ie(n,oe(fe(1),an(Kt(e,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zj(n,t,e,s,r,i){const o=U(n,"dy","avgPool3dGrad"),a=U(t,"input","avgPool3dGrad");let u=o,l=a,c=!1;a.rank===4&&(c=!0,u=ct(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),l=ct(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),V(u.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),V(l.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${l.rank}.`),Ps("avgPool3dGrad",r,i);const h={dy:u,input:l},d={filterSize:e,strides:s,pad:r,dimRoundingMode:i},f=it.runKernel(Wf,h,d);return c?ct(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const Jj=ot({avgPool3dGrad_:Zj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qj={kernelName:Wc,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{filterSize:r,strides:i,pad:o,dimRoundingMode:a}=e;return{x:()=>Jj(n,s,r,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tH(n,t,e,s,r){const i=U(n,"dy","avgPoolGrad"),o=U(t,"input","avgPoolGrad");V(o.rank===i.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${i.rank})`);let a=o,u=i,l=!1;o.rank===3&&(l=!0,a=ct(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=ct(i,[1,i.shape[0],i.shape[1],i.shape[2]])),V(u.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${u.rank}.`),V(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const c={dy:u,input:a},h={filterSize:e,strides:s,pad:r},d=it.runKernel(Uf,c,h);return l?ct(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const eH=ot({avgPoolGrad_:tH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nH={kernelName:Uc,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{filterSize:r,strides:i,pad:o}=e;return{x:()=>eH(n,s,r,i,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sH={kernelName:Gc,inputsToSave:["a","b"],gradFunc:(n,t,e)=>{const[s,r]=t,{transposeA:i,transposeB:o}=e;return!i&&!o?{a:()=>De(n,r,!1,!0),b:()=>De(s,n,!0,!1)}:!i&&o?{a:()=>De(n,r,!1,!1),b:()=>De(n,s,!0,!1)}:i&&!o?{a:()=>De(r,n,!1,!0),b:()=>De(s,n,!1,!1)}:{a:()=>De(r,n,!0,!0),b:()=>De(n,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rH={kernelName:jc,gradFunc:(n,t,e)=>{const{blockShape:s,crops:r}=e;return{x:()=>Qh(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iH={kernelName:bx,gradFunc:(n,t,e)=>{const s=e,r=s.inputShape,i=s.shape,o=Array.from(i);for(let u=r.length-1;u>=0;u--)if(r[u]===i[u])o[u]=1;else if(r[u]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${i}].`);const a=[];for(let u=0;u<o.length;u++)o[u]>1&&a.push(u);return{x:()=>he(n,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oH={kernelName:Yu,gradFunc:n=>({x:()=>n.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aH={kernelName:Zu,gradFunc:n=>({x:()=>je(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uH={kernelName:Ju,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{clipValueMin:r,clipValueMax:i}=e;return{x:()=>us(ai(go(s,r),na(s,i)),n,je(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lH={kernelName:Kc,inputsToSave:["x"],gradFunc:oS.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cH={kernelName:qc,saveAllInputs:!0,gradFunc:(n,t,e)=>{const s=t.map(u=>u.shape),{axis:r}=e,i=Pe(r,t[0].shape)[0],o=s.map(u=>u[i]);return Ks(n,o,i).map(u=>()=>u)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hH={kernelName:Xc,inputsToSave:["x","filter"],gradFunc:(n,t,e)=>{const[s,r]=t,{dilations:i,strides:o,pad:a,dataFormat:u}=e;return V(Go(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>v0(s.shape,n,r,o,a,u),filter:()=>c2(s,n,r.shape,o,a,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dH={kernelName:Yc,inputsToSave:["dy","filter"],gradFunc:(n,t,e)=>{const[s,r]=t,{strides:i,pad:o,dataFormat:a,dimRoundingMode:u}=e;return{dy:()=>ro(n,r,i,o,a,1,u),filter:()=>c2(n,s,r.shape,i,o,a,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fH(n,t,e,s,r){let i=n;n.rank===4&&(i=ct(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let o=t;o.rank===4&&(o=ct(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),V(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),V(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),V(e.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${e}.`),V(i.shape[4]===e[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${e[3]}.`),V(o.shape[4]===e[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${e[4]}).`);const a={x:i,dy:o},u={strides:s,pad:r,filterShape:e};return it.runKernel(qf,a,u)}const pH=ot({conv3DBackpropFilter_:fH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mH={kernelName:Zc,inputsToSave:["x","filter"],gradFunc:(n,t,e)=>{const{dilations:s,strides:r,pad:i}=e;V(Go(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[o,a]=t;return{x:()=>nw(o.shape,n,a,r,i),filter:()=>pH(o,n,a.shape,r,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gH={kernelName:Qu,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ut(dn(fm(Kt(e,"float32"))),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yH={kernelName:tl,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ut(pm(Kt(e,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bH={kernelName:Jc,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{axis:r,exclusive:i,reverse:o}=e;return{x:()=>{const a=Tn([r],s.rank);let u=Jp(n,r,i,!o);return a!=null&&(u=Ue(u,a)),u}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xH={kernelName:Qc,inputsToSave:["x","filter"],gradFunc:(n,t,e)=>{const{dilations:s,strides:r,pad:i,dimRoundingMode:o}=e,a=s??[1,1];V(Go(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[u,l]=t;return V(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${u.rank}.`),V(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${l.rank}.`),V(u.shape[3]===l.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${u.shape[3]}) must match the inChannels dimension in filter ${l.shape[2]}.`),V(ds(r,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${a}'.`),Ps("depthwiseConv2d",i,o),{x:()=>Kw(u.shape,n,l,r,i,a,o),filter:()=>Hw(u,n,l.shape,r,i,a,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wH={kernelName:th,inputsToSave:["x","filter"],gradFunc:(n,t,e)=>{const[s,r]=t,i={x:s,filter:r,dy:n},o={x:s,filter:r,dy:n};return{x:()=>it.runKernel(rf,i,e),filter:()=>it.runKernel(of,o,e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vH={kernelName:nl,outputsToSave:[!0],gradFunc:(n,t)=>{const[e]=t,s={dy:n,y:e};return{x:()=>it.runKernel(ip,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kH={kernelName:sl,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t,s=ut(Fs(dn(an(e))),2/Math.sqrt(Math.PI));return{x:()=>ut(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SH={kernelName:rl,outputsToSave:[!0],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ut(n,e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IH={kernelName:nh,inputsToSave:["input"],gradFunc:(n,t)=>{const[e]=t;return{input:()=>ct(n,e.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CH={kernelName:il,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ut(n,Fs(e))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NH={kernelName:ol,gradFunc:n=>({x:()=>je(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TH={kernelName:al,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,r=Ee(e.shape,s.shape);return{a:()=>{const a=ie(n,Kt(s,"float32")),u=Un(e.shape,r);return u.length>0?ct(he(a,u),e.shape):a},b:()=>{let a=ut(n,Kt(e,"float32"));const u=Un(s.shape,r);u.length>0&&(a=ct(he(a,u),s.shape));const l=an(s);return dn(ie(a,Kt(l,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $H={kernelName:sh,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,t,e)=>{const{varianceEpsilon:s}=e,[r,i,o,a]=t,u=a??fe(1),l=Un(i.shape,r.shape),c=[];if(i.rank===1){for(let v=0;v<r.shape.length-1;++v)c.push(r.shape[v]);c.push(1)}const h=oe(r,i),d=ut(n,u),f=cm(Lt(o,fe(s))),p=ut(ut(ut(f,f),f),fe(-.5));return{x:()=>i.rank===1?ct(ut(ut(n,kr(ct(f,[1,1,1,i.shape[0]]),c)),u),r.shape):ct(ut(ut(n,f),u),r.shape),mean:()=>{let v=ut(ut(f,fe(-1)),d);return i.rank===1&&(v=he(v,l)),ct(v,i.shape)},variance:()=>{let v=ut(ut(p,h),d);return i.rank===1&&(v=he(v,l)),ct(v,i.shape)},scale:()=>{const v=ut(h,f);let S=ut(n,v);return i.rank===1&&(S=he(S,l)),ct(S,i.shape)},offset:()=>{let v=n;return i.rank===1&&(v=he(v,l)),ct(v,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EH={kernelName:rh,inputsToSave:["x","indices"],gradFunc:(n,t,e)=>{const[s,r]=t,{axis:i}=e,o=Pe(i,s.shape)[0];return{x:()=>{const u=s.shape,l=r.size,c=u.slice(0,o),h=c.length,d=u.slice(i,u.length).slice(1),f=d.length,p=S3(0,h),m=S3(h+1,h+1+f),g=I3([c,[l],d]),y=ct(n,g),b=ct(r,[l]),w=I3([[h],p,m]),v=Ue(y,w);let S=wm(v,b,s.shape[o]);const N=ea(w);return S=Ue(S,N),S},indices:()=>r}}};function S3(n,t){const e=[];for(let s=n;s<t;++s)e.push(s);return e}function I3(n){const t=[];for(let e=0;e<n.length;++e)for(let s=0;s<n[e].length;++s)t.push(n[e][s]);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _H={kernelName:ul,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t;return{a:()=>je(e),b:()=>je(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AH={kernelName:ll,gradFunc:n=>({x:()=>Kt(n,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RH={kernelName:cl,gradFunc:n=>({x:()=>je(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DH={kernelName:hl,gradFunc:n=>({x:()=>je(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OH={kernelName:dl,gradFunc:n=>({x:()=>je(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FH={kernelName:oh,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{alpha:r}=e,i=Ms(s,0);return{x:()=>us(i,n,ut(n,r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LH={kernelName:pl,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ie(n,Lt(e,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PH={kernelName:fl,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ie(n,Kt(e,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MH={kernelName:xx,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,t,e)=>{const[s]=t,{axis:r}=e;return{logits:()=>{const o=Fs(s);return oe(n,ut(he(n,r,!0),o))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zH(n,t,e,s=5,r=1,i=1,o=.5){const a={x:n,y:t,dy:e},u={depthRadius:s,bias:r,alpha:i,beta:o};return it.runKernel(fp,a,u)}const BH=ot({localResponseNormalizationBackprop_:zH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VH={kernelName:dh,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{const[s,r]=t,{depthRadius:i,bias:o,alpha:a,beta:u}=e;return{x:()=>BH(s,r,n,i,o,a,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aS(n,t,e,s){return t.rank<e.rank&&(t=ct(t,An(t.shape,s))),n.rank<e.rank&&(n=ct(n,An(n.shape,s))),{x:()=>ut(n,Kt(ar(e,t),n.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C3={kernelName:fh,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{const s=e,{reductionIndices:r}=s,i=t[0],o=t[1],a=Pe(r,i.shape),u=aS(n,o,i,a);return{x:()=>u.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UH={kernelName:ml,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t;return{a:()=>ut(n,Kt(go(e,s),"float32")),b:()=>ut(n,Kt(Du(e,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WH(n,t,e,s,r,i,o){const a=U(n,"dy","maxPool3dGrad"),u=U(t,"input","maxPool3dGrad"),l=U(e,"output","maxPool3dGrad");let c=a,h=u,d=l,f=!1;u.rank===4&&(f=!0,c=ct(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),h=ct(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),d=ct(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),V(c.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`),V(h.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${h.rank}.`),V(d.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${d.rank}.`),Ps("maxPool3dGrad",i,o);const p={dy:c,input:h,output:d},m={filterSize:s,strides:r,pad:i,dimRoundingMode:o},g=it.runKernel(mp,p,m);return f?ct(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}const GH=ot({maxPool3dGrad_:WH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jH={kernelName:mh,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{const[s,r]=t,{filterSize:i,strides:o,pad:a,dimRoundingMode:u}=e;return{x:()=>GH(n,s,r,i,o,a,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HH(n,t,e,s,r,i,o){const a=U(n,"dy","maxPoolGrad"),u=U(t,"input","maxPoolGrad"),l=U(e,"output","maxPoolGrad");V(u.rank===a.rank,()=>`Rank of input (${u.rank}) does not match rank of dy (${a.rank})`),V(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),V(u.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${u.rank}.`),Ps("maxPoolGrad",i,o);const c={dy:a,input:u,output:l},h={filterSize:s,strides:r,pad:i,dimRoundingMode:o};return it.runKernel(pp,c,h)}const KH=ot({maxPoolGrad_:HH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qH={kernelName:ph,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{const[s,r]=t,{filterSize:i,strides:o,pad:a}=e;return{x:()=>KH(n,s,r,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XH={kernelName:gh,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{axis:r}=e,i=Pe(r,s.shape),a=is(s.shape,i)[1],u=Et(a);return{x:()=>{const c=s.shape.slice();i.forEach(f=>{c[f]=1});const h=ct(n,c);return ie(ut(h,or(s.shape,"float32")),u)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YH={kernelName:yh,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{const s=e,{axis:r}=s,[i,o]=t,a=Pe(r,i.shape),u=aS(n,o,i,a);return{x:()=>u.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZH={kernelName:gl,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t;return{a:()=>ut(n,Kt(na(e,s),"float32")),b:()=>ut(n,Kt(Ms(e,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JH={kernelName:bh,inputsToSave:["x"],gradFunc:(n,t,e)=>{const s=t[0],{paddings:r}=e,i=r.map(o=>o[0]);return{x:()=>xe(n,i,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QH={kernelName:yl,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,r=Ee(e.shape,s.shape);return{a:()=>{const a=Un(e.shape,r);return a.length>0?ct(he(n,a),e.shape):n},b:()=>{const a=ut(n,dn(Ul(ie(e,s)))),u=Un(s.shape,r);return u.length>0?ct(he(a,u),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tK={kernelName:bl,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,r=Ee(e.shape,s.shape);return{a:()=>{const a=ut(n,Kt(s,"float32")),u=Un(e.shape,r);return u.length>0?ct(he(a,u),e.shape):a},b:()=>{const a=ut(n,Kt(e,"float32")),u=Un(s.shape,r);return u.length>0?ct(he(a,u),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eK={kernelName:xh,gradFunc:n=>({x:()=>dn(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nK={kernelName:kh,inputsToSave:["indices"],gradFunc:(n,t)=>{const e=t[0];return{indices:()=>Mn(e.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sK={kernelName:vh,gradFunc:n=>({x:()=>je(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rK={kernelName:Sh,saveAllInputs:!0,gradFunc:(n,t,e)=>{const{axis:s}=e;return $r(n,s).map(i=>()=>i)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N3={kernelName:Ih,inputsToSave:["x"],gradFunc:(n,t,e)=>{const s=t[0],{paddings:r}=e,i=r.map(o=>o[0]);return{x:()=>xe(n,i,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iK={kernelName:xl,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,t)=>{const[e,s,r]=t,i=e,o=s,a=Ee(i.shape,o.shape);return{a:()=>{const c=Kt(o,"float32");let h=ut(n,ut(c,io(i,oe(c,fe(1)))));const d=Un(i.shape,a);return d.length>0&&(h=he(h,d)),ct(h,i.shape)},b:()=>{const c=Ms(i,0),h=us(c,ur(i),je(i));let d=ut(n,ut(r,h));const f=Un(o.shape,a);return f.length>0&&(d=he(d,f)),ct(d,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oK={kernelName:Ch,inputsToSave:["x","alpha"],gradFunc:(n,t)=>{const[e,s]=t,r=Ms(e,0);return{x:()=>us(r,n,ut(n,s)),alpha:()=>{let i=us(r,je(n),ut(n,e));const o=Un(s.shape,n.shape);return o.length>0&&(i=he(i,o)),ct(i,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aK(n,t,e){const s=n.shape.slice();s[e]=1;const r=ct(t,s),i=$c(n,e,!0,!1),o=$c(n,e,!0,!0),a=ut(i,o);return ut(r,a)}function uK(n,t,e){const s=n.shape.length,r=s-e.length,i=Tn(e,s);let o=n;i!=null&&(o=Ue(n,i));const a=o.shape.slice(),l=a.splice(s-e.length,e.length).reduce((d,f)=>d*f,1);a.push(l);const c=o.reshape(a);let h=aK(c,t,r);if(h=h.reshape(o.shape),i!=null){const d=ea(i);h=Ue(h,d)}return h}const lK={kernelName:Nh,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{axis:r}=e;let i=[];return r==null?i=s.shape.map((o,a)=>a):typeof r=="number"?i=[r]:i=r,{x:()=>uK(s,n,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cK={kernelName:el,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,r=Ee(e.shape,s.shape);return{a:()=>{const a=ie(n,Kt(s,"float32")),u=Un(e.shape,r);return u.length>0?ct(he(a,u),e.shape):a},b:()=>{let a=ut(n,Kt(e,"float32"));const u=Un(s.shape,r);u.length>0&&(a=ct(he(a,u),s.shape));const l=an(s);return dn(ie(a,Kt(l,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hK={kernelName:wl,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ie(n,dn(an(e)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dK={kernelName:kl,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t,s=ut(na(e,6),nu(e));return{x:()=>ut(n,Kt(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fK={kernelName:vl,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ut(n,Kt(nu(e),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pK={kernelName:Th,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ct(n,e.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mK={kernelName:Eh,inputsToSave:["images"],gradFunc:(n,t,e)=>{const[s]=t,r={dy:n,images:s};return{images:()=>it.runKernel(Tp,r,e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gK={kernelName:$h,inputsToSave:["images"],gradFunc:(n,t,e)=>{const[s]=t,r={dy:n,images:s};return{images:()=>it.runKernel(Np,r,e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yK={kernelName:_h,gradFunc:(n,t,e)=>{const{dims:s}=e,r=Pe(s,n.shape);return{x:()=>Tr(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bK={kernelName:Sl,gradFunc:n=>({x:()=>je(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xK={kernelName:Il,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>dn(ie(n,ut(io(e,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wK={kernelName:Ah,inputsToSave:["condition"],gradFunc:(n,t)=>{const[e]=t;return{condition:()=>Kt(je(e),"float32"),t:()=>ut(n,Kt(e,n.dtype)),e:()=>ut(n,Kt(Yh(e),n.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vK={kernelName:Cl,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>{const s=Ms(e,fe(0)),r=fe(Om),i=fe(Fm),o=ut(n,i),a=ut(ut(n,r),Fs(Kt(e,"float32")));return us(s,o,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kK={kernelName:El,outputsToSave:[!0],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ut(n,ut(e,oe(fe(1),e)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SK={kernelName:$l,gradFunc:n=>({x:()=>je(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IK={kernelName:Nl,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ut(Hh(Kt(e,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CK={kernelName:Tl,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ut(Zp(Kt(e,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NK={kernelName:Rh,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{begin:r,size:i}=e,o=s.shape,[a,u]=Rm(s,r,i),l=[];for(let c=0;c<n.rank;c++)l.push([a[c],o[c]-a[c]-u[c]]);return{x:()=>Ui(n,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TK={kernelName:Lh,outputsToSave:[!0],gradFunc:(n,t,e)=>{const[s]=t,{dim:r}=e,i=!0,o=ut(n,s);return{logits:()=>oe(o,ut(he(o,[r],i),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $K={kernelName:_l,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ut(n,Hs(e))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T3={kernelName:Oh,gradFunc:(n,t,e)=>{const{blockShape:s,paddings:r}=e;return{x:()=>jh(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $3={kernelName:Fh,gradFunc:(n,t,e)=>{const{axis:s}=e;return{x:()=>Cn(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EK={kernelName:Al,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ie(n,ut(cs(Kt(e,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _K={kernelName:Lp,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ut(n,ut(Kt(e,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AK={kernelName:Rl,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,r=fe(2);return{a:()=>ut(n,ut(r,oe(e,s))),b:()=>ut(n,ut(r,oe(s,e)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RK={kernelName:Pl,gradFunc:n=>({x:()=>je(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DK={kernelName:Dl,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,r=Ee(e.shape,s.shape);return{a:()=>{let a=n;const u=Un(e.shape,r);return u.length>0&&(a=he(a,u)),ct(a,e.shape)},b:()=>{let a=n;const u=Un(s.shape,r);return u.length>0&&(a=he(a,u)),ct(dn(a),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OK={kernelName:Dh,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,r=s.shape.slice(),{axis:i}=e;Pe(i,s.shape).forEach(l=>{r[l]=1});const a=ct(n,r),u=ut(a,or(s.shape,"float32"));return{x:()=>u}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FK={kernelName:Ol,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ie(n,an(Hh(e)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LK={kernelName:Fl,outputsToSave:[!0],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ut(oe(fe(1),an(e)),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PK={kernelName:Ll,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{reps:r}=e;return{x:()=>{let o=je(s);if(s.rank===1)for(let a=0;a<r[0];++a)o=Lt(o,xe(n,[a*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let a=0;a<r[0];++a)for(let u=0;u<r[1];++u)o=Lt(o,xe(n,[a*s.shape[0],u*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let a=0;a<r[0];++a)for(let u=0;u<r[1];++u)for(let l=0;l<r[2];++l)o=Lt(o,xe(n,[a*s.shape[0],u*s.shape[1],l*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let a=0;a<r[0];++a)for(let u=0;u<r[1];++u)for(let l=0;l<r[2];++l)for(let c=0;c<r[3];++c)o=Lt(o,xe(n,[a*s.shape[0],u*s.shape[1],l*s.shape[2],c*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return o}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MK={kernelName:_a,gradFunc:(n,t,e)=>{const s=e,{perm:r}=s,i=ea(r);return{x:()=>Ue(n,i)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zK={kernelName:Mh,gradFunc:(n,t,e)=>{const s=e,{axis:r}=s;return{value:()=>cr(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BK={kernelName:zh,inputsToSave:["segmentIds"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>VK(n,e)}}};function VK(n,t){const e=Vi(t,je(t)),s=Wl(n,e);let r=go(t,fe(0,"int32"));const i=s.rank-r.rank;for(let a=0;a<i;++a)r=gn(r,a+1);r=ai(r,or(s.shape,"bool"));const o=je(s);return us(r,s,o)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UK={kernelName:Bh,gradFunc:n=>({x:()=>je(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WK=[oS,Bj,Vj,Uj,Wj,Gj,jj,Hj,Kj,qj,Xj,Yj,Qj,nH,sH,rH,iH,oH,aH,uH,lH,cH,dH,hH,mH,gH,yH,bH,xH,wH,cK,vH,kH,SH,IH,CH,TH,NH,$H,EH,_H,AH,RH,DH,OH,FH,LH,PH,MH,VH,C3,C3,UH,jH,qH,XH,YH,ZH,JH,QH,tK,eK,nK,sK,rK,N3,N3,iK,oK,lK,hK,dK,fK,pK,mK,gK,yK,bK,xK,wK,vK,kK,SK,IK,CK,NK,TK,$K,T3,T3,$3,$3,EK,AK,_K,RK,DK,OK,FK,LK,PK,MK,zK,BK,UK];for(const n of WK)wx(n);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.abs=function(){return this.throwIfDisposed(),Pn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.acos=function(){return this.throwIfDisposed(),n0(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.acosh=function(){return this.throwIfDisposed(),s0(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.add=function(n){return this.throwIfDisposed(),Lt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.all=function(n,t){return this.throwIfDisposed(),qp(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.any=function(n,t){return this.throwIfDisposed(),Cc(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.argMax=function(n){return this.throwIfDisposed(),Wo(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.argMin=function(n){return this.throwIfDisposed(),r0(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.asScalar=function(){return this.throwIfDisposed(),V(this.size===1,()=>"The array must have only 1 element."),ct(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.asType=function(n){return this.throwIfDisposed(),Kt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.as1D=function(){return this.throwIfDisposed(),ct(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.as2D=function(n,t){return this.throwIfDisposed(),ct(this,[n,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.as3D=function(n,t,e){return this.throwIfDisposed(),ct(this,[n,t,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.as4D=function(n,t,e,s){return this.throwIfDisposed(),ct(this,[n,t,e,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.as5D=function(n,t,e,s,r){return this.throwIfDisposed(),ct(this,[n,t,e,s,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.asin=function(){return this.throwIfDisposed(),i0(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.asinh=function(){return this.throwIfDisposed(),o0(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.atan=function(){return this.throwIfDisposed(),a0(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.atan2=function(n){return this.throwIfDisposed(),u0(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.atanh=function(){return this.throwIfDisposed(),l0(this)};_t().prototype.avgPool=function(n,t,e,s){return this.throwIfDisposed(),Gh(this,n,t,e,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.batchToSpaceND=function(n,t){return this.throwIfDisposed(),jh(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.batchNorm=function(n,t,e,s,r){return this.throwIfDisposed(),Ml(this,n,t,e,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.broadcastTo=function(n){return this.throwIfDisposed(),Aa(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.cast=function(n){return this.throwIfDisposed(),Kt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.ceil=function(){return this.throwIfDisposed(),g0(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.clipByValue=function(n,t){return this.throwIfDisposed(),Os(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.concat=function(n,t){return this.throwIfDisposed(),n instanceof $e&&(n=[n]),Cn([this,...n],t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.conv1d=function(n,t,e,s,r,i){return this.throwIfDisposed(),Xp(this,n,t,e,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.conv2dTranspose=function(n,t,e,s,r){return this.throwIfDisposed(),Yp(this,n,t,e,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.conv2d=function(n,t,e,s,r,i){return this.throwIfDisposed(),ro(this,n,t,e,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.cos=function(){return this.throwIfDisposed(),Hh(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.cosh=function(){return this.throwIfDisposed(),Zp(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.cumprod=function(n,t,e){return this.throwIfDisposed(),$c(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.cumsum=function(n,t,e){return this.throwIfDisposed(),Jp(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.depthToSpace=function(n,t){return this.throwIfDisposed(),I0(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.depthwiseConv2d=function(n,t,e,s,r,i){return this.throwIfDisposed(),zl(this,n,t,e,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.dilation2d=function(n,t,e,s,r){return this.throwIfDisposed(),C0(this,n,t,e,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.divNoNan=function(n){return this.throwIfDisposed(),N0(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.div=function(n){return this.throwIfDisposed(),ie(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.dot=function(n){return this.throwIfDisposed(),T0(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.elu=function(){return this.throwIfDisposed(),Bl(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.equal=function(n){return this.throwIfDisposed(),ar(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.erf=function(){return this.throwIfDisposed(),$0(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.euclideanNorm=function(n,t){return this.throwIfDisposed(),_0(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.exp=function(){return this.throwIfDisposed(),Fs(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.expandDims=function(n){return this.throwIfDisposed(),gn(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.expm1=function(){return this.throwIfDisposed(),A0(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.fft=function(){return this.throwIfDisposed(),rd(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.flatten=function(){return this.throwIfDisposed(),ct(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.floor=function(){return this.throwIfDisposed(),Ul(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.floorDiv=function(n){return this.throwIfDisposed(),Kp(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.gather=function(n,t,e){return this.throwIfDisposed(),Wl(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.greaterEqual=function(n){return this.throwIfDisposed(),go(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.greater=function(n){return this.throwIfDisposed(),Ms(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.ifft=function(){return this.throwIfDisposed(),Lu(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.irfft=function(){return this.throwIfDisposed(),gm(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.isFinite=function(){return this.throwIfDisposed(),R0(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.isInf=function(){return this.throwIfDisposed(),D0(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.isNaN=function(){return this.throwIfDisposed(),O0(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.leakyRelu=function(n){return this.throwIfDisposed(),qh(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.lessEqual=function(n){return this.throwIfDisposed(),na(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.less=function(n){return this.throwIfDisposed(),Du(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.localResponseNormalization=function(n,t,e,s){return this.throwIfDisposed(),F0(this,n,t,e,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.logSigmoid=function(){return this.throwIfDisposed(),L0(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.logSoftmax=function(n){return this.throwIfDisposed(),em(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.logSumExp=function(n,t){return this.throwIfDisposed(),nm(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.log=function(){return this.throwIfDisposed(),ur(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.log1p=function(){return this.throwIfDisposed(),Xh(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.logicalAnd=function(n){return this.throwIfDisposed(),ai(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.logicalNot=function(){return this.throwIfDisposed(),Yh(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.logicalOr=function(n){return this.throwIfDisposed(),sm(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.logicalXor=function(n){return this.throwIfDisposed(),P0(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.matMul=function(n,t,e){return this.throwIfDisposed(),De(this,n,t,e)};_t().prototype.maxPool=function(n,t,e,s){return this.throwIfDisposed(),Zh(this,n,t,e,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.max=function(n,t){return this.throwIfDisposed(),Nr(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.maximum=function(n){return this.throwIfDisposed(),Vi(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.mean=function(n,t){return this.throwIfDisposed(),wn(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.min=function(n,t){return this.throwIfDisposed(),Ru(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.minimum=function(n){return this.throwIfDisposed(),jo(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.mirrorPad=function(n,t){return this.throwIfDisposed(),im(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.mod=function(n){return this.throwIfDisposed(),z0(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.mul=function(n){return this.throwIfDisposed(),ut(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.neg=function(){return this.throwIfDisposed(),dn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.norm=function(n,t,e){return this.throwIfDisposed(),Vl(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.notEqual=function(n){return this.throwIfDisposed(),Ba(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.oneHot=function(n,t=1,e=0){return this.throwIfDisposed(),Va(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.onesLike=function(){return this.throwIfDisposed(),lr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.pad=function(n,t){return this.throwIfDisposed(),Ui(this,n,t)};_t().prototype.pool=function(n,t,e,s,r,i){return this.throwIfDisposed(),V0(this,n,t,e,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.pow=function(n){return this.throwIfDisposed(),io(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.prelu=function(n){return this.throwIfDisposed(),td(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.prod=function(n,t){return this.throwIfDisposed(),U0(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.reciprocal=function(){return this.throwIfDisposed(),J0(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.relu=function(){return this.throwIfDisposed(),fi(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.relu6=function(){return this.throwIfDisposed(),um(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.reshapeAs=function(n){return this.throwIfDisposed(),ct(this,n.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.reshape=function(n){return this.throwIfDisposed(),ct(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.resizeBilinear=function(n,t,e){return this.throwIfDisposed(),Zw(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.resizeNearestNeighbor=function(n,t,e){return this.throwIfDisposed(),Jw(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.reverse=function(n){return this.throwIfDisposed(),Tr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.rfft=function(){return this.throwIfDisposed(),id(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.round=function(){return this.throwIfDisposed(),lm(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.rsqrt=function(){return this.throwIfDisposed(),cm(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.selu=function(){return this.throwIfDisposed(),hm(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.separableConv2d=function(n,t,e,s,r,i){return this.throwIfDisposed(),dm(this,n,t,e,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.sigmoid=function(){return this.throwIfDisposed(),Hs(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.sign=function(){return this.throwIfDisposed(),Q0(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.sin=function(){return this.throwIfDisposed(),fm(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.sinh=function(){return this.throwIfDisposed(),pm(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.slice=function(n,t){return this.throwIfDisposed(),xe(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.softmax=function(n){return this.throwIfDisposed(),sd(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.softplus=function(){return this.throwIfDisposed(),tu(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.spaceToBatchND=function(n,t){return this.throwIfDisposed(),Qh(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.split=function(n,t){return this.throwIfDisposed(),Ks(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.sqrt=function(){return this.throwIfDisposed(),cs(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.square=function(){return this.throwIfDisposed(),an(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.squaredDifference=function(n){return this.throwIfDisposed(),ym(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.squeeze=function(n){return this.throwIfDisposed(),tn(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.stack=function(n,t){this.throwIfDisposed();const e=n instanceof $e?[this,n]:[this,...n];return cr(e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.step=function(n){return this.throwIfDisposed(),nu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.stridedSlice=function(n,t,e,s,r,i,o,a){return this.throwIfDisposed(),t2(this,n,t,e,s,r,i,o,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.sub=function(n){return this.throwIfDisposed(),oe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.sum=function(n,t){return this.throwIfDisposed(),he(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.tan=function(){return this.throwIfDisposed(),e2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.tanh=function(){return this.throwIfDisposed(),Ma(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.tile=function(n){return this.throwIfDisposed(),kr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.toBool=function(){return this.throwIfDisposed(),Kt(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.toFloat=function(){return this.throwIfDisposed(),Kt(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.toInt=function(){return this.throwIfDisposed(),Kt(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.topk=function(n,t){return this.throwIfDisposed(),r2(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.transpose=function(n){return this.throwIfDisposed(),Ue(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.unique=function(n){return this.throwIfDisposed(),i2(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.unsortedSegmentSum=function(n,t){return this.throwIfDisposed(),wm(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.unstack=function(n){return this.throwIfDisposed(),$r(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.where=function(n,t){return this.throwIfDisposed(),us(n,this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_t().prototype.zerosLike=function(){return this.throwIfDisposed(),je(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Ii extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Ii.prototype)}}class Gr extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Gr.prototype)}}class dt extends Error{constructor(t){super(t),Object.setPrototypeOf(this,dt.prototype)}}class Oe extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Oe.prototype)}}class hy extends Error{constructor(t){super(t),Object.setPrototypeOf(this,hy.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class uS{constructor(t){this.maxEntries=t||100,this.cache=new Map}get(t){let e;return this.cache.has(t)&&(e=this.cache.get(t),this.cache.delete(t),this.cache.set(t,e)),e}put(t,e){if(this.cache.has(t))this.cache.delete(t);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(t,e)}getMaxEntries(){return this.maxEntries}setMaxEntries(t){if(t<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${t}.`);if(this.maxEntries>t)for(let e=0;e<this.maxEntries-t;e++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=t}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ka(n,t){if(Array.isArray(n)){let e=[];for(let s=0;s<t;s++)e=e.concat(n);return e}else{const e=new Array(t);return e.fill(n),e}}function Ci(n,t){if(!n)throw new hy(t)}function E3(n,t){let e=0;for(const s of n)s===t&&e++;return e}function js(n){return n.length===1?n[0]:n}function mn(n){return Array.isArray(n)?n:[n]}function Xi(n){const e=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return e[0]!=="_"?e:"private"+e}function Ia(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(t,e)=>e.toUpperCase())}let Lr={};function dy(n){if(n==null)return null;const t={};return t.className=n.getClassName(),t.config=n.getConfig(),t}function N1(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(t=>N1(t));else{const t=Object.keys(n);for(const e of t){const s=n[e];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?n[e]=s.value:N1(s))}}}function md(n,t={},e={},s="object",r=!1){if(typeof n=="string"){const i=n;let o;if(i in e)o=e[i];else if(i in Lr)o=Lr[i];else if(o=t[i],o==null)throw new dt(`Unknown ${s}: ${n}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return o}else{const i=n;if(i.className==null||i.config==null)throw new dt(`${s}: Improper config format: ${JSON.stringify(i)}.
'className' and 'config' must set.`);const o=i.className;let a,u;if(o in e?[a,u]=e[o]:o in Lr?[a,u]=Lr.className:o in t&&([a,u]=t[o]),a==null)throw new dt(`Unknown ${s}: ${o}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(u!=null){const l={};for(const f of Object.keys(Lr))l[f]=Lr[f];for(const f of Object.keys(e))l[f]=e[f];const c=i.config;c.customObjects=l;const h=Object.assign({},Lr);for(const f of Object.keys(e))Lr[f]=e[f];N1(i.config);const d=u(a,i.config,e,r);return Lr=Object.assign({},h),d}else{const l=Object.assign({},Lr);for(const h of Object.keys(e))Lr[h]=e[h];const c=new a(i.config);return Lr=Object.assign({},l),c}}}function GK(n,t){return n<t?-1:n>t?1:0}function jd(n,t){return-1*GK(n,t)}function Mo(n){if(n==null)return n;const t=[];for(const e of n)t.indexOf(e)===-1&&t.push(e);return t}function jK(n){if(n==null)throw new dt(`Invalid value in obj: ${JSON.stringify(n)}`);for(const t in n)if(n.hasOwnProperty(t))return!1;return!0}function cu(n,t,e){if(e!=null&&n.indexOf(e)<0)throw new dt(`${e} is not a valid ${t}.  Valid values are ${n} or null/undefined.`)}function fy(n,t,e=0,s=1/0){return Ci(e>=0),Ci(s>=e),Array.isArray(n)&&n.length>=e&&n.length<=s&&n.every(r=>typeof r===t)}function ns(n,t){Array.isArray(n)?(V(n.length>0,()=>`${t} is unexpectedly an empty array.`),n.forEach((e,s)=>ns(e,`element ${s+1} of ${t}`))):V(Number.isInteger(n)&&n>0,()=>`Expected ${t} to be a positive integer, but got ${lS(n)}.`)}function lS(n){return n===null?"null":Array.isArray(n)?"["+n.map(t=>lS(t)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function HK(n,t,e){let s=e!=null?e():$s(),r;return(...o)=>{const a=e!=null?e():$s();return a-s<t||(s=a,r=n(...o)),r}}function cS(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let KK=0;function hS(){return KK++}const Hd={};function Hm(n=""){return n in Hd||(Hd[n]=0),Hd[n]+=1,n+Hd[n].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const qK=["channelsFirst","channelsLast"],XK=["nearest","bilinear"],YK=["valid","same","causal"],ZK=["max","avg"],JK=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const vu=new Map;function On(n){cu(qK,"DataFormat",n)}function QK(n){cu(XK,"InterpolationFormat",n)}function Er(n){cu(YK,"PaddingMode",n)}function dS(n){cu(ZK,"PoolMode",n)}const mc=[],_3="/";function Ra(n,t){mc.push(n);try{const e=t();return mc.pop(),e}catch(e){throw mc.pop(),e}}function tq(){return mc.length===0?"":mc.join(_3)+_3}function fS(n){if(!mS(n))throw new Error("Not a valid tensor name: '"+n+"'");return tq()+n}function pS(n){if(!mS(n))throw new Error("Not a valid tensor name: '"+n+"'");vu.has(n)||vu.set(n,0);const t=vu.get(n);if(vu.set(n,vu.get(n)+1),t>0){const e=`${n}_${t}`;return vu.set(e,1),e}else return n}const eq=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function mS(n){return!!n.match(eq)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function nq(n){return n===parseInt(n.toString(),10)}function zo(n,t,e){t==null&&(t=0),e==null&&(e=n.length);let s=1;for(let r=t;r<e;++r)s*=n[r];return s}function Bu(n){if(n.length===0)return Number.NaN;let t=Number.POSITIVE_INFINITY;for(let e=0;e<n.length;e++){const s=n[e];s<t&&(t=s)}return t}function qo(n){if(n.length===0)return Number.NaN;let t=Number.NEGATIVE_INFINITY;for(let e=0;e<n.length;e++){const s=n[e];s>t&&(t=s)}return t}function li(n,t){if(t<n)throw new dt(`end (${t}) < begin (${n}) is forbidden.`);const e=[];for(let s=n;s<t;++s)e.push(s);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Rg;function Gn(){return Rg==null&&(Rg=e0().epsilon()),Rg}function ci(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Fi(n,t){return Kt(n,t)}function gd(n,t=-1){const e=n.shape.slice();return t<0&&(t=e.length+t+1),e.splice(t,0,1),ct(n,e)}function sq(n,t){return pt(()=>{if(n.shape.length!==2)throw new dt(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);const e=gd(n,1);return T1(e,[1,t,1])})}function rq(n){const t=[zo(n.shape)];return ct(n,t)}function iq(n){if(n.rank<=1)throw new dt(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);const t=[n.shape[0],zo(n.shape,1)];return ct(n,t)}function Da(n,t,e){return pt(()=>{switch(n.rank){case 1:return ed(n,t,e);case 2:return mm(n,[t,0],[e,n.shape[1]]);case 3:return nd(n,[t,0,0],[e,n.shape[1],n.shape[2]]);case 4:return Fu(n,[t,0,0,0],[e,n.shape[1],n.shape[2],n.shape[3]]);case 5:return xe(n,[t,0,0,0,0],[e,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return xe(n,[t,0,0,0,0,0],[e,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new dt(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Dg(n,t,e){return pt(()=>{switch(n.rank){case 1:return ed(n,t,e);case 2:return mm(n,[0,t],[n.shape[0],e]);case 3:return nd(n,[0,0,t],[n.shape[0],n.shape[1],e]);case 4:return Fu(n,[0,0,0,t],[n.shape[0],n.shape[1],n.shape[2],e]);default:throw new dt(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Kd(n,t,e,s){return pt(()=>{switch(n.rank){case 1:return ed(n,t,e);case 2:switch(s){case 1:return Da(n,t,e);case 2:return Dg(n,t,e);default:throw new dt(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return Da(n,t,e);case 2:return nd(n,[0,t,0],[n.shape[0],e,n.shape[2]]);case 3:return Dg(n,t,e);default:throw new dt(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return Da(n,t,e);case 2:return Fu(n,[0,t,0,0],[n.shape[0],e,n.shape[2],n.shape[3]]);case 3:return Fu(n,[0,0,t,0],[n.shape[0],n.shape[1],e,n.shape[3]]);case 4:return Dg(n,t,e);default:throw new dt(`The axis is not within the rank of the tensor ${s}`)}default:throw new dt(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function py(n,t=-1){let e;return t<0&&(e=n[0].rank,e!==0?t=e:t=0),t===n[0].rank&&(t=-1),Cn(n,t)}function A3(n,t){switch(n.rank){case 1:return y0([n,t]);case 2:return b0([n,t],0);case 3:return x0([n,t],0);case 4:return w0([n,t],0);default:throw new dt(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function T1(n,t){if(Array.isArray(t)||(t=[t]),n.rank!==t.length)throw new dt(`The length of input n (${t.length}) does not match the number of dimensions in input x (${n.rank})`);return kr(n,t)}function Km(n,t=0,e=1,s,r){return am(n,t,e,s,r)}function Li(n,t,e,s){if(n.rank<2||t.rank<2)throw new Oe(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${t.shape}`);if(t.rank>=3){const r=n.shape.slice(-1)[0],i=t.shape.slice(-2)[0];if(r!==i)throw new Oe(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${t.shape}`)}if(n.rank===2&&t.rank===2)return s1({a:n,b:t,transposeA:!1,transposeB:!1,bias:s?$1(n.rank,s,ci()):null,activation:e});{const r=n.shape.slice(),i=r.pop();n=ct(n,[-1,i]);const o=t.shape.slice(),a=o.pop(),u=o.pop(),l=[...o,a],c=Array.from({length:t.rank},(p,m)=>m===0?t.rank-2:m<=t.rank-2?m-1:m);t=ct(Ue(t,c),[u,-1]);const h=[...r,...l];return ct(s1({a:n,b:t,transposeA:!1,transposeB:!1,bias:s?$1(n.rank,s,ci()):null,activation:e}),h)}}function gS(n,t,e){return pt(()=>(Array.isArray(t)?t=zn(t,"int32"):t=Kt(t,"int32"),Wl(n,t,e)))}function yd(n){return ut(n,n)}function $1(n,t,e){const s=t.shape;if(t.rank!==1&&t.rank!==n)throw new dt(`Unexpected bias dimensions: ${t.rank}; expected it to be 1 or ${n}`);if(n===5){if(e==="channelsFirst")return s.length===1?ct(t,[1,s[0],1,1,1]):ct(t,[1,s[3],s[0],s[1],s[2]]);if(e==="channelsLast")return s.length===1?ct(t,[1,1,1,1,s[0]]):ct(t,[1].concat(s))}else if(n===4){if(e==="channelsFirst")return s.length===1?ct(t,[1,s[0],1,1]):ct(t,[1,s[2],s[0],s[1]]);if(e==="channelsLast")return s.length===1?ct(t,[1,1,1,s[0]]):ct(t,[1].concat(s))}else if(n===3){if(e==="channelsFirst")return s.length===1?ct(t,[1,s[0],1]):ct(t,[1,s[1],s[0]]);if(e==="channelsLast")return s.length===1?ct(t,[1,1,s[0]]):ct(t,[1].concat(s))}else if(n<3)return t;throw new dt(`Unsupported input rank by biasAdd: ${t.rank}`)}function pi(n,t,e){return pt(()=>(e==null&&(e=ci()),On(e),Lt(n,$1(n.rank,t,e))))}function oq(n,t=1){if(t!==1)throw new Oe(`Support for alpha values other than 1 (${t}) is not implemented yet.`);return Bl(n)}function aq(n){return pt(()=>ie(n,Lt(Pn(n),1)))}function yS(n,t,e,s){return pt(()=>u2(n,t,e,s))}function uq(n){return pt(()=>{const t=Lt(.5,ut(.2,n));return Os(t,0,1)})}function bd(n,t,e=!1){return e?n():t()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const lq=["fanIn","fanOut","fanAvg"],cq=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function hq(n){cu(lq,"FanMode",n)}function dq(n){cu(cq,"Distribution",n)}class Kr extends su{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class bS extends Kr{apply(t,e){return Mn(t,e)}}bS.className="Zeros";Vt(bS);class my extends Kr{apply(t,e){return or(t,e)}}my.className="Ones";Vt(my);class xS extends Kr{constructor(t){if(super(),typeof t!="object")throw new dt(`Expected argument of type ConstantConfig but got ${t}`);if(t.value===void 0)throw new dt(`config must have value set but got ${t}`);this.value=t.value}apply(t,e){return pt(()=>ut(fe(this.value),or(t,e)))}getConfig(){return{value:this.value}}}xS.className="Constant";Vt(xS);class wS extends Kr{constructor(t){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=t.minval||this.DEFAULT_MINVAL,this.maxval=t.maxval||this.DEFAULT_MAXVAL,this.seed=t.seed}apply(t,e){return sa(t,this.minval,this.maxval,e,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}wS.className="RandomUniform";Vt(wS);class vS extends Kr{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,e){if(e=e||"float32",e!=="float32"&&e!=="int32")throw new Oe(`randomNormal does not support dType ${e}.`);return Km(t,this.mean,this.stddev,e,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}vS.className="RandomNormal";Vt(vS);class kS extends Kr{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,e){if(e=e||"float32",e!=="float32"&&e!=="int32")throw new Oe(`truncatedNormal does not support dType ${e}.`);return xm(t,this.mean,this.stddev,e,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}kS.className="TruncatedNormal";Vt(kS);class SS extends Kr{constructor(t){super(),this.gain=t.gain!=null?t.gain:1}apply(t,e){return pt(()=>{if(t.length!==2||t[0]!==t[1])throw new dt("Identity matrix initializer can only be used for 2D square matrices.");return ut(this.gain,Qp(t[0]))})}getConfig(){return{gain:this.gain}}}SS.className="Identity";Vt(SS);function fq(n,t="channelsLast"){let e,s;if(On(t),n.length===2)e=n[0],s=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(t==="channelsFirst"){const r=zo(n,2);e=n[1]*r,s=n[0]*r}else if(t==="channelsLast"){const r=zo(n,0,n.length-2);e=n[n.length-2]*r,s=n[n.length-1]*r}}else{const r=zo(n);e=Math.sqrt(r),s=Math.sqrt(r)}return[e,s]}class dr extends Kr{constructor(t){if(super(),t.scale<0)throw new dt(`scale must be a positive float. Got: ${t.scale}`);this.scale=t.scale==null?1:t.scale,this.mode=t.mode==null?"fanIn":t.mode,hq(this.mode),this.distribution=t.distribution==null?"normal":t.distribution,dq(this.distribution),this.seed=t.seed}apply(t,e){const s=fq(t),r=s[0],i=s[1];let o=this.scale;if(this.mode==="fanIn"?o/=Math.max(1,r):this.mode==="fanOut"?o/=Math.max(1,i):o/=Math.max(1,(r+i)/2),this.distribution==="normal"){const a=Math.sqrt(o);if(e=e||"float32",e!=="float32"&&e!=="int32")throw new Oe(`${this.getClassName()} does not support dType ${e}.`);return xm(t,0,a,e,this.seed)}else{const a=Math.sqrt(3*o);return sa(t,-a,a,e,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}dr.className="VarianceScaling";Vt(dr);class gy extends dr{constructor(t){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return dr.className}}gy.className="GlorotUniform";Vt(gy);class yy extends dr{constructor(t){super({scale:1,mode:"fanAvg",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return dr.className}}yy.className="GlorotNormal";Vt(yy);class by extends dr{constructor(t){super({scale:2,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return dr.className}}by.className="HeNormal";Vt(by);class xy extends dr{constructor(t){super({scale:2,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return dr.className}}xy.className="HeUniform";Vt(xy);class wy extends dr{constructor(t){super({scale:1,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return dr.className}}wy.className="LeCunNormal";Vt(wy);class vy extends dr{constructor(t){super({scale:1,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return dr.className}}vy.className="LeCunUniform";Vt(vy);class IS extends Kr{constructor(t){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=t.gain==null?this.DEFAULT_GAIN:t.gain,this.seed=t.seed}apply(t,e){return pt(()=>{if(t.length<2)throw new Oe("Shape must be at least 2D.");if(e!=="int32"&&e!=="float32"&&e!==void 0)throw new TypeError(`Unsupported data type ${e}.`);e=e;const s=Et(t.slice(0,-1)),r=t[t.length-1],i=s*r;i>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${i}) elements: Slowness may result.`);const o=[Math.max(r,s),Math.min(r,s)],a=Km(o,0,1,e,this.seed),u=d2.qr(a,!1);let l=u[0];const h=u[1].flatten().stridedSlice([0],[Math.min(r,s)*Math.min(r,s)],[Math.min(r,s)+1]);return l=ut(l,h.sign()),s<r&&(l=l.transpose()),ut(fe(this.gain),l.reshape(t))})}getConfig(){return{gain:this.gain,seed:this.seed}}}IS.className="Orthogonal";Vt(IS);const R3={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function D3(n,t={}){return md(n,vr.getMap().classNameMap,t,"initializer")}function In(n){return dy(n)}function vn(n){if(typeof n=="string"){const t=n in R3?R3[n]:n;if(t==="GlorotNormal")return new yy;if(t==="GlorotUniform")return new gy;if(t==="HeNormal")return new by;if(t==="HeUniform")return new xy;if(t==="LeCunNormal")return new wy;if(t==="LeCunUniform")return new vy;{const e={};return e.className=t,e.config={},D3(e)}}else return n instanceof Kr?n:D3(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function E1(n){return Array.isArray(n)&&Array.isArray(n[0])}function Cf(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function we(n){let t;if(Array.isArray(n)){if(n.length!==1)throw new dt(`Expected Tensor length to be 1; got ${n.length}`);t=n[0]}else t=n;return t}function Xe(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new dt(`Expected exactly 1 Shape; got ${n.length}`)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Nf(n){let t=0;for(const e of n)e.shape.length===0?t+=1:t+=e.shape.reduce((s,r)=>s*r);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const O3="Variable";class pq{constructor(t,e="float32",s=O3,r=!0,i=null){this.dtype=e??"float32",this.shape=t.shape,this.id=hS(),s=s??O3,this.originalName=fS(s),this.name=pS(this.originalName),this.trainable_=r,this.constraint=i,this.val=o2(t,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(t){return this.assertNotDisposed(),mq(this.val,t),this.val.id!==t.id&&(this.val.assign(t),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(t){this.trainable_=t,this.val.trainable=t}}function mq(n,t){if(n.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(t.shape))}function _1(n){return n.map(t=>t.read())}function ky(n){n.forEach(t=>{t[0].write(t[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class jn{constructor(t){this.dtype=t.dtype,this.shape=t.shape,t.shape!=null?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}}}class _i{constructor(t,e,s,r,i,o,a){this.dtype=t,this.shape=e,this.sourceLayer=s,this.inputs=r,this.callArgs=i,this.outputTensorIndex=a,this.id=hS(),o!=null&&(this.originalName=fS(o),this.name=pS(this.originalName)),this.rank=e.length}}let gq=0;class qm{constructor(t,e){this.callArgs=e,this.id=gq++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;for(const s of t.inboundLayers)s!=null&&s.outboundNodes.push(this);t.outboundLayer.inboundNodes.push(this)}getConfig(){const t=[];for(const e of this.inboundLayers)e!=null?t.push(e.name):t.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let yq=0;class Me extends su{constructor(t={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=yq++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let e=t.name;if(!e){const s=this.getClassName();e=Xi(s)+"_"+Hm(s)}if(this.name=e,this.trainable_=t.trainable==null?!0:t.trainable,t.inputShape!=null||t.batchInputShape!=null){let s;if(t.batchInputShape!=null)s=t.batchInputShape;else if(t.inputShape!=null){let i=null;t.batchSize!=null&&(i=t.batchSize),s=[i].concat(t.inputShape)}this.batchInputShape=s;let r=t.dtype;r==null&&(r=t.inputDType),r==null&&(r="float32"),this.dtype=r}t.weights!=null?this.initialWeights=t.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(t,e){return t.name+"_ib-"+e.toString()}getNodeAtIndex(t,e){if(this.inboundNodes.length===0)throw new Gr(`The layer has never been called and thus has no defined ${e}.`);if(this.inboundNodes.length<=t)throw new dt(`Asked to get ${e} at node ${t}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[t]}getInputAt(t){return js(this.getNodeAtIndex(t,"input").inputTensors)}getOutputAt(t){return js(this.getNodeAtIndex(t,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new Ii(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new Ii(`Layer ${this.name} is not connected, no input to return.`);return js(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new Ii(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new Ii(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return js(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(t=>t())}get updates(){return this._updates}get built(){return this._built}set built(t){this._built=t}get trainable(){return this.trainable_}set trainable(t){this._trainableWeights.forEach(e=>e.trainable=t),this.trainable_=t}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(t=>t.trainable):[]}set trainableWeights(t){this._trainableWeights=t}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(t=>!t.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(t){this._nonTrainableWeights=t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(t){if(t=mn(t),this.inputSpec==null||this.inputSpec.length===0)return;const e=mn(this.inputSpec);if(t.length!==e.length)throw new dt(`Layer ${this.name} expects ${e.length} inputs, but it received ${t.length} input tensors. Input received: ${t}`);for(let s=0;s<t.length;s++){const r=t[s],i=e[s];if(i==null)continue;const o=r.rank;if(i.ndim!=null&&o!==i.ndim)throw new dt(`Input ${s} is incompatible with layer ${this.name}: expected ndim=${i.ndim}, found ndim=${o}`);if(i.maxNDim!=null&&o>i.maxNDim)throw new dt(`Input ${s} is incompatible with layer ${this.name}: expected max_ndim=${i.maxNDim}, found ndim=${o}`);if(i.minNDim!=null&&o<i.minNDim)throw new dt(`Input ${s} is incompatible with layer ${this.name}: expected min_ndim=${i.minNDim}, found ndim=${o}.`);if(i.dtype!=null&&r.dtype!==i.dtype)throw new dt(`Input ${s} is incompatible with layer ${this.name} : expected dtype=${i.dtype}, found dtype=${r.dtype}.`);if(i.axes){const a=r.shape;for(const u in i.axes){const l=Number(u),c=i.axes[u],h=l>=0?a[l]:a[a.length+l];if(c!=null&&[c,null].indexOf(h)===-1)throw new dt(`Input ${s} is incompatible with layer ${this.name}: expected axis ${l} of input shape to have value ${c} but got shape ${a}.`)}}if(i.shape!=null)for(let a=0;a<i.shape.length;++a){const u=i.shape[a],l=r.shape[a];if(u!=null&&l!=null&&u!==l)throw new dt(`Input ${s} is incompatible with layer ${this.name}: expected shape=${i.shape}, found shape=${r.shape}.`)}}}call(t,e){return t}invokeCallHook(t,e){this._callHook!=null&&this._callHook(t,e)}setCallHook(t){this._callHook=t}clearCallHook(){this._callHook=null}apply(t,e){e=e||{},this.assertNotDisposed();const s=mn(t);let r=!0;for(const o of s)if(!(o instanceof _i)){r=!1;break}let i=!0;for(const o of s)if(o instanceof _i){i=!1;break}if(r===i)throw new dt("Arguments to apply() must be all SymbolicTensors or all Tensors");return Ra(this.name,()=>{if(!this.built){this.assertInputCompatibility(t);const o=[];for(const a of mn(t))o.push(a.shape);this.build(js(o)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&i&&(this._refCount=1)}if(this.assertInputCompatibility(t),i){let o=this.call(t,e);const a=mn(o),u=[];for(let l of a)s.indexOf(l)!==-1&&(l=l.clone()),u.push(l);if(o=js(u),this.activityRegularizer!=null)throw new Oe("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return o}else{const o=bq(t),a=this.computeOutputShape(o);let u;const l=xq(t);if(this.warnOnIncompatibleInputShape(Array.isArray(t)?o[0]:o),a!=null&&a.length>0&&Array.isArray(a[0])?u=a.map((c,h)=>new _i(l,c,this,mn(t),e,this.name,h)):u=new _i(l,a,this,mn(t),e,this.name),this.addInboundNode(t,u,null,null,o,a,e),this._refCount++,this.activityRegularizer!=null)throw new Oe("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return u}})}warnOnIncompatibleInputShape(t){if(this.batchInputShape!=null)if(t.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(t)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let e=!1;this.batchInputShape.forEach((s,r)=>{s!=null&&t[r]!=null&&t[r]!==s&&(e=!0)}),e&&console.warn(`The shape of the input tensor (${JSON.stringify(t)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Ii(`The layer ${this.name} has never been called and thus has no defined output shape.`);const t=[];for(const e of this.inboundNodes){const s=JSON.stringify(e.outputShapes);t.indexOf(s)===-1&&t.push(s)}if(t.length===1){const e=this.inboundNodes[0].outputShapes;return Array.isArray(e)&&Array.isArray(e[0])&&e.length===1?e[0]:e}else throw new Ii(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Gr(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Nf(this.weights)}build(t){this.built=!0}getWeights(t=!1){return _1(t?this.trainableWeights:this.weights)}setWeights(t){pt(()=>{const e=this.weights;if(e.length!==t.length)throw new dt(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${t.length}, but the layer was expecting ${e.length} weights. Provided weights: ${t}...`);if(e.length===0)return;const s=[],r=_1(e);for(let i=0;i<r.length;++i){const o=r[i],a=e[i],u=t[i];if(!Ve(o.shape,u.shape))throw new dt(`Layer weight shape ${o.shape} not compatible with provided weight shape ${u.shape}`);s.push([a,u])}ky(s)})}addWeight(t,e,s,r,i,o,a,u){if(this._addedWeightNames.indexOf(t)!==-1)throw new dt(`Duplicate weight name ${t} for layer ${this.name}`);this._addedWeightNames.push(t),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(r=u!=null?u():vn("zeros"));const l=r.apply(e,s),c=new pq(l,s,t,o,a);return l.dispose(),i!=null&&this.addLoss(()=>i.apply(c.read())),o==null&&(o=!0),o?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}setFastWeightInitDuringBuild(t){this.fastWeightInitDuringBuild=t}addLoss(t){t==null||Array.isArray(t)&&t.length===0||(t=mn(t),this._losses!==void 0&&this._losses!==null&&this.losses.push(...t))}computeOutputShape(t){return t}computeMask(t,e){if(!this.supportsMasking){if(e!=null)if(Array.isArray(e))e.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return e}addInboundNode(t,e,s,r,i,o,a=null){const u=mn(t);e=mn(e),s=mn(s),r=mn(r),i=Cf(i),o=Cf(o);const l=[],c=[],h=[];for(const d of u)l.push(d.sourceLayer),c.push(d.nodeIndex),h.push(d.tensorIndex);new qm({outboundLayer:this,inboundLayers:l,nodeIndices:c,tensorIndices:h,inputTensors:u,outputTensors:e,inputMasks:s,outputMasks:r,inputShapes:i,outputShapes:o},a);for(let d=0;d<e.length;d++)e[d].sourceLayer=this,e[d].nodeIndex=this.inboundNodes.length-1,e[d].tensorIndex=d}getConfig(){const t={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(t.batchInputShape=this.batchInputShape),this.dtype!=null&&(t.dtype=this.dtype),t}disposeWeights(){return this.weights.forEach(t=>t.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let t=0;return--this._refCount===0&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}}}function bq(n){n=mn(n);const t=[];for(const e of n)t.push(e.shape);return js(t)}function xq(n){return"float32"}function CS(n,t,e){if((t==null||e!=null&&e>0)&&(t=n.sourceLayer,e=n.nodeIndex),t.inboundNodes.length===0)return[n];{const s=t.inboundNodes[e];if(s.inboundLayers.length===0)return s.inputTensors;{const r=[];for(let i=0;i<s.inboundLayers.length;i++){const o=s.inputTensors[i],a=s.inboundLayers[i],u=s.nodeIndices[i],l=CS(o,a,u);for(const c of l)r.indexOf(c)===-1&&r.push(c)}return r}}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class xd extends Me{constructor(t){if(super({dtype:t.dtype,name:t.name!=null?t.name:Hm("input").toString()}),t.batchSize==null&&(t.batchSize=null),t.sparse==null&&(t.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=t.sparse,t.inputShape!=null&&t.batchInputShape!=null)throw new dt("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let e=t.batchInputShape;if(e==null){if(t.inputShape==null)throw new dt("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");e=[t.batchSize].concat(t.inputShape)}else if(t.batchSize!=null)throw new dt("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=t.dtype||"float32";this.batchInputShape=e,this.dtype=s,this.inputSpec=[{shape:e}];const r=new _i(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new qm({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[e],outputShapes:[e]})}apply(t,e){throw new dt(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}xd.className="InputLayer";Vt(xd);function wq(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new dt("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let t=n.batchShape;n.shape!=null&&t==null&&(t=[null].concat(n.shape));let e=n.dtype;return e==null&&(e="float32"),new xd({batchInputShape:t,name:n.name,dtype:e,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function vq(n,t){if(n.dtype==null||n.dtype===t.dtype)return t;try{return Kt(t,n.dtype)}catch{throw new dt(`The dtype of the feed (${t.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}class Lo{constructor(t){if(this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof Lo)for(const e in t.id2Value)this.id2Value[e]=t.id2Value[e],e in t.id2Mask&&(this.id2Mask[e]=t.id2Mask[e]);else{if(t==null)return;for(const e of t)this.add(e.key,e.value)}}add(t,e,s){if(this.id2Value[t.id]==null)this.id2Value[t.id]=vq(t,e),this.name2Id[t.name]=t.id,s!=null&&(this.id2Mask[t.id]=s);else throw new dt(`Duplicate key: name=${t.name}, id=${t.id}`);return this}addFeed(t){this.add(t.key,t.value)}hasKey(t){return this.id2Value[t.id]!=null}names(){return Object.keys(this.name2Id)}getValue(t){if(t instanceof _i){if(this.id2Value[t.id]==null)throw new dt(`Nonexistent key: ${t.name}`);return this.id2Value[t.id]}else{const e=this.name2Id[t];if(e==null)throw new dt(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Value[e]}}getMask(t){if(t instanceof _i){if(this.id2Value[t.id]==null)throw new dt(`Nonexistent key: ${t.name}`);return this.id2Mask[t.id]}else{const e=this.name2Id[t];if(e==null)throw new dt(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Mask[e]}}disposeMasks(){this.id2Mask!=null&&Se(this.id2Mask)}}const Tf=new uS,$f=new uS;function kq(n){Tf!=null&&Tf.setMaxEntries(n),$f!=null&&$f.setMaxEntries(n)}function fc(n,t,e,s){const r=e==null?!1:e.training,i=Array.isArray(n),o=i?n:[n],a=o.map(p=>p.name),u=[],l=t.names();for(const p of a)l.indexOf(p)!==-1?u.push(t.getValue(p)):u.push(null);s!=null&&(s.maxNumTensors=-1/0,s.minNumTensors=1/0);const c=a.join(",")+"|"+t.names().sort().join(",");let h=Tf.get(c),d;if(h==null){const p=Sq(o,t);h=p.sorted,d=p.recipientCounts,Tf.put(c,h),$f.put(c,d)}d={},r||Object.assign(d,$f.get(c));const f=new Lo(t);for(let p=0;p<h.length;++p){if(s!=null){const F=hf().numTensors;F>s.maxNumTensors&&(s.maxNumTensors=F),F<s.minNumTensors&&(s.minNumTensors=F)}const m=h[p],g=m.sourceLayer;if(g instanceof xd)continue;const y=[],b=[],w=[];let v=!1;for(const F of m.inputs){const B=f.getValue(F),H=f.getMask(F);y.push(B),b.push(H),H!=null&&(v=!0),r||(d[F.name]--,d[F.name]===0&&!t.hasKey(F)&&a.indexOf(F.name)===-1&&!B.isDisposed&&F.sourceLayer.stateful!==!0&&w.push(B))}v&&(e=e||{},e.mask=b[0]);const S=mn(g.apply(y,e));let N=null;g.supportsMasking&&(N=g.computeMask(y,b));const R=Cq(m),L=Array.isArray(R)?R:[R];for(let F=0;F<L.length;++F){f.hasKey(L[F])||f.add(L[F],S[F],Array.isArray(N)?N[0]:N);const B=a.indexOf(L[F].name);B!==-1&&(u[B]=S[F])}r||Se(w)}return f.disposeMasks(),i?u:u[0]}function Sq(n,t){V(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let e=[],s={};if(n.length===1){const r=F3(n[0],t);e=r.sorted,s=r.recipientMap}else{const r=new Set;for(const i of n){const{sorted:o,recipientMap:a}=F3(i,t);for(const u of o)r.has(u.name)||(e.push(u),r.add(u.name));for(const u in a)s[u]==null&&(s[u]=new Set),a[u].forEach(l=>s[u].add(l))}}return{sorted:e,recipientCounts:Iq(s)}}function Iq(n){const t={};for(const e in n)t[e]=n[e].size;return t}function F3(n,t){const e=new Set,s=[],r={};for(const a of t.names())e.add(a);const i=[],o=[];for(i.push(n);i.length>0;){const a=i[i.length-1];if(e.has(a.name)){i.pop();continue}const u=o[o.length-1]===i.length-1;if(a.inputs.length===0||u)i.pop(),s.push(a),e.add(a.name),u&&o.pop();else{o.push(i.length-1);for(const l of a.inputs)r[l.name]==null&&(r[l.name]=new Set),r[l.name].add(a.name),!e.has(l.name)&&i.push(l)}}return{sorted:s,recipientMap:r}}function Cq(n){let t;if(n.sourceLayer.inboundNodes.length===1)t=n.sourceLayer.output;else{let e=null;for(let s=0;s<n.sourceLayer.inboundNodes.length;++s)for(const r of n.sourceLayer.inboundNodes[s].outputTensors)if(r.id===n.id){e=s;break}t=n.sourceLayer.getOutputAt(e)}return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nq=vt();Nq.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,kq);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Sy(n,t){return pt(()=>cs(he(ut(n,n),t,!0)))}class wd extends su{getConfig(){return{}}}class NS extends wd{constructor(t){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=t.maxValue!=null?t.maxValue:this.defaultMaxValue,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return pt(()=>{const e=Sy(t,this.axis),s=Os(e,0,this.maxValue);return ut(t,ie(s,Lt(Gn(),e)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}NS.className="MaxNorm";Vt(NS);class TS extends wd{constructor(t){super(),this.defaultAxis=0,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return pt(()=>ie(t,Lt(Gn(),Sy(t,this.axis))))}getConfig(){return{axis:this.axis}}}TS.className="UnitNorm";Vt(TS);class $S extends wd{apply(t){return fi(t)}}$S.className="NonNeg";Vt($S);class ES extends wd{constructor(t){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=t.minValue!=null?t.minValue:this.defaultMinValue,this.maxValue=t.maxValue!=null?t.maxValue:this.defaultMaxValue,this.rate=t.rate!=null?t.rate:this.defaultRate,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return pt(()=>{const e=Sy(t,this.axis),s=Lt(ut(this.rate,Os(e,this.minValue,this.maxValue)),ut(1-this.rate,e));return ut(t,ie(s,Lt(Gn(),e)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}ES.className="MinMaxNorm";Vt(ES);const L3={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Hn(n){return dy(n)}function P3(n,t={}){return md(n,vr.getMap().classNameMap,t,"constraint")}function Kn(n){if(n==null)return null;if(typeof n=="string"){const e={className:n in L3?L3[n]:n,config:{}};return P3(e)}else return n instanceof wd?n:P3(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function xa(n){if(n==null)return;const t=[],e=[],s=[];for(const r in n){const i=n[r];if(typeof i!="number"){const o=i;t.push(o.data()),e.push(r),s.push(o)}}if(t.length>0){const r=await Promise.all(t);for(let i=0;i<r.length;++i)n[e[i]]=r[i][0];Se(s)}}function _S(n){if(n!=null)for(const t in n){const e=n[t];typeof e!="number"&&e.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var M3;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(M3||(M3={}));const Tq=125;class Oc{constructor(){this.validationData=null}setParams(t){this.params=t}async onEpochBegin(t,e){}async onEpochEnd(t,e){}async onBatchBegin(t,e){}async onBatchEnd(t,e){}async onTrainBegin(t){}async onTrainEnd(t){}setModel(t){}}class $q{constructor(t,e=10){t==null&&(t=[]),this.callbacks=t,this.queueLength=e}append(t){this.callbacks.push(t)}setParams(t){for(const e of this.callbacks)e.setParams(t)}setModel(t){for(const e of this.callbacks)e.setModel(t)}async onEpochBegin(t,e){e==null&&(e={});for(const s of this.callbacks)await s.onEpochBegin(t,e)}async onEpochEnd(t,e){e==null&&(e={});for(const s of this.callbacks)await s.onEpochEnd(t,e)}async onBatchBegin(t,e){e==null&&(e={});for(const s of this.callbacks)await s.onBatchBegin(t,e)}async onBatchEnd(t,e){e==null&&(e={});for(const s of this.callbacks)await s.onBatchEnd(t,e)}async onTrainBegin(t){t==null&&(t={});for(const e of this.callbacks)await e.onTrainBegin(t)}async onTrainEnd(t){t==null&&(t={});for(const e of this.callbacks)await e.onTrainEnd(t)}}class Eq extends Oc{constructor(){super()}async onEpochBegin(t){this.seen=0,this.totals={}}async onBatchEnd(t,e){e==null&&(e={});const s=e.size==null?0:e.size;this.seen+=s;for(const r in e){const i=e[r];if(typeof i=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+i*s;else{let o;r in this.totals?o=this.totals[r]:this.totals[r]=0;const a=pt(()=>Lt(this.totals[r],ut(i,s)));this.totals[r]=a,o!=null&&o.dispose()}}}async onEpochEnd(t,e){if(e!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?e[s]=this.totals[s]/this.seen:pt(()=>{const r=ut(ie(1,this.seen),this.totals[s]);e[s]=r,this.totals[s].dispose(),es(e[s])}))}}class _q extends Oc{async onTrainBegin(t){this.epoch=[],this.history={}}async onEpochEnd(t,e){e==null&&(e={}),this.epoch.push(t);for(const s in e)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(e[s])}async syncData(){const t=[],e=[],s=[];for(const i in this.history){const o=this.history[i];for(let a=0;a<o.length;++a)if(typeof o[a]!="number"){const u=o[a];t.push(u.data()),e.push(i),s.push(a)}}const r=await Promise.all(t);for(let i=0;i<r.length;++i)this.history[e[i]][s[i]].dispose(),this.history[e[i]][s[i]]=r[i][0]}}class Aq extends Oc{constructor(t,e){if(super(),this.currentEpoch=0,this.nowFunc=t.nowFunc,this.nextFrameFunc=t.nextFrameFunc||T2,this.yieldEvery=e||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=Tq),this.yieldEvery==="never"&&t.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");nf(this.yieldEvery)&&(this.maybeWait=HK(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=t.onTrainBegin,this.trainEnd=t.onTrainEnd,this.epochBegin=t.onEpochBegin,this.epochEnd=t.onEpochEnd,this.batchBegin=t.onBatchBegin,this.batchEnd=t.onBatchEnd,this.yield=t.onYield}async maybeWait(t,e,s){const r=[];this.yield!=null&&(await xa(s),r.push(this.yield(t,e,s))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(t,e){this.currentEpoch=t,this.epochBegin!=null&&(await xa(e),await this.epochBegin(t,e))}async onEpochEnd(t,e){const s=[];this.epochEnd!=null&&(await xa(e),s.push(this.epochEnd(t,e))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(t,e){this.batchBegin!=null&&(await xa(e),await this.batchBegin(t,e))}async onBatchEnd(t,e){const s=[];this.batchEnd!=null&&(await xa(e),s.push(this.batchEnd(t,e))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):nf(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,t,e)),await Promise.all(s)}async onTrainBegin(t){this.trainBegin!=null&&(await xa(t),await this.trainBegin(t))}async onTrainEnd(t){this.trainEnd!=null&&(await xa(t),await this.trainEnd(t))}}function AS(n,t){return n==null&&(n={}),n instanceof Oc?[n]:Array.isArray(n)&&n[0]instanceof Oc?n:mn(n).map(s=>new Aq(s,t))}class Mr{constructor(){}static registerCallbackConstructor(t,e){V(t>=0&&Number.isInteger(t),()=>`Verbosity level is expected to be an integer >= 0, but got ${t}`),Mr.checkForDuplicate(e),Mr.constructors[t]==null&&(Mr.constructors[t]=[]),Mr.constructors[t].push(e)}static checkForDuplicate(t){for(const e in Mr.constructors)Mr.constructors[+e].forEach(r=>{if(r===t)throw new dt("Duplicate callback constructor.")})}static clear(){Mr.constructors={}}static createCallbacks(t){const e=[];for(const s in Mr.constructors){const r=+s;t>=r&&e.push(...Mr.constructors[r])}return e.map(s=>new s)}}Mr.constructors={};function RS(n,t,e,s,r,i,o,a,u){const l=new _q,c=[new Eq,...Mr.createCallbacks(t)];n!=null&&c.push(...n),c.push(l);const h=new $q(c);return h.setParams({epochs:e,initialEpoch:s,samples:r,steps:i,batchSize:o,verbose:t,doValidation:a,metrics:u}),{callbackList:h,history:l}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function eo(n,t={},e=!1){return md(n,vr.getMap().classNameMap,t,"layer",e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ef(n,t){return pt(()=>{n.dtype!=="float32"&&(n=Kt(n,"float32"));const e=he(yd(n),t,!0),s=Qa(e.shape,Gn()),r=cs(Vi(e,s));return ie(n,r)})}function Xm(n,t){return pt(()=>wn(yd(oe(t,n)),-1))}function Iy(n,t){return pt(()=>wn(Pn(oe(t,n)),-1))}function Cy(n,t){return pt(()=>{const e=oe(n,t),s=Os(Pn(n),Gn(),Number.MAX_VALUE),r=Pn(ie(e,s));return ut(100,wn(r,-1))})}function Rq(n,t){return pt(()=>{const e=Os(t,Gn(),Number.MAX_VALUE),s=ur(Lt(1,e)),r=Os(n,Gn(),Number.MAX_VALUE),i=ur(Lt(1,r));return wn(yd(oe(s,i)),-1)})}function Dq(n,t){return pt(()=>{const e=Vi(0,oe(1,ut(n,t)));return wn(yd(e),-1)})}function Oq(n,t){return pt(()=>{const e=Vi(0,oe(1,ut(n,t)));return wn(e,-1)})}function Fq(n,t){return pt(()=>{const e=he(ut(n,t),-1),s=Nr(ut(oe(1,n),t),-1);return Vi(0,Lt(1,oe(s,e)))})}function Lq(n,t){return pt(()=>{const e=Math.log(2),s=oe(t,n),r=oe(Lt(s,tu(ut(-2,s))),e);return wn(r,-1)})}function Fc(n,t,e=!1){return pt(()=>{if(e)t=sd(t);else{const s=he(t,t.shape.length-1,!0);t=ie(t,s)}return t=Os(t,Gn(),1-Gn()),dn(he(ut(Kt(n,"float32"),ur(t)),t.shape.length-1))})}function _f(n,t,e=!1){return pt(()=>{const s=Kt(Ul(rq(n)),"int32");t=Os(t,Gn(),1-Gn());const r=t.shape,i=ct(Va(s,r[r.length-1]),r);return Fc(i,t,e)})}function Pq(n,t){if(!Ve(n.shape,t.shape))throw new dt(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(t.shape)}`);return pt(()=>{const e=fi(t),s=dn(Pn(t));return Lt(oe(e,ut(t,n)),Xh(Fs(s)))})}function Ym(n,t){return pt(()=>{let e;return e=Os(t,Gn(),1-Gn()),e=ur(ie(e,oe(1,e))),wn(Pq(n,e),-1)})}function Mq(n,t){return pt(()=>{const e=Os(n,Gn(),1),s=Os(t,Gn(),1);return he(ut(n,ur(ie(e,s))),-1)})}function zq(n,t){return pt(()=>{const e=ur(Lt(Gn(),t));return wn(oe(t,ut(n,e)),-1)})}function DS(n,t){return pt(()=>{const e=Ef(n,-1),s=Ef(t,-1),r=ut(e,s);return dn(he(r,-1))})}const Af={meanSquaredError:Xm,meanAbsoluteError:Iy,meanAbsolutePercentageError:Cy,meanSquaredLogarithmicError:Rq,squaredHinge:Dq,hinge:Oq,categoricalHinge:Fq,logcosh:Lq,categoricalCrossentropy:Fc,sparseCategoricalCrossentropy:_f,binaryCrossentropy:Ym,kullbackLeiblerDivergence:Mq,poisson:zq,cosineProximity:DS};function Og(n){if(typeof n=="string"){if(n in Af)return Af[n];let t=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(t=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new dt(t)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function OS(n,t){return pt(()=>{const e=ut(.5,lr(t)),s=Fi(Ms(t,e),n.dtype);return wn(ar(n,s),-1)})}function FS(n,t){return pt(()=>Fi(ar(Wo(n,-1),Wo(t,-1)),"float32"))}function Bq(n,t){return pt(()=>Kt(he(ai(ar(n,1),ar(t,1))),"float32"))}function Vq(n,t){return pt(()=>Kt(he(ai(ar(n,0),ar(t,1))),"float32"))}function Uq(n,t){return pt(()=>{const e=Bq(n,t),s=Vq(n,t),r=Lt(e,s);return Kt(us(Ms(r,0),ie(e,r),0),"float32")})}function Wq(n,t){return Ym(n,t)}function Gq(n,t){return n.rank===t.rank&&(n=tn(n,[n.rank-1])),t=Wo(t,-1),t.dtype!==n.dtype&&(t=Kt(t,n.dtype)),Kt(ar(n,t),"float32")}const jq=Xm,Hq=Xm,Kq=Iy,qq=Iy,Xq=Cy,Yq=Cy,LS=Fc,Zq=DS,PS=_f,Rf={binaryAccuracy:OS,categoricalAccuracy:FS,precision:Uq,categoricalCrossentropy:LS,sparseCategoricalCrossentropy:PS,mse:jq,MSE:Hq,mae:Kq,MAE:qq,mape:Xq,MAPE:Yq,cosine:Zq};function Jq(n){if(typeof n=="string"&&n in Rf)return Rf[n];if(typeof n!="string"&&n!=null)return n;throw new dt(`Unknown metric ${n}`)}function qd(n){if(Ci(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let t;for(const e of Object.keys(Af))if(Af[e]===n){t=e;break}if(t!==void 0)return t;for(const e of Object.keys(Rf))if(Rf[e]===n){t=e;break}return t!==void 0?t:n.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Qq(n){const t={Adagrad:()=>va.adagrad(.01),Adadelta:()=>va.adadelta(1,.95,Gn()),Adam:()=>va.adam(.001,.9,.999,Gn()),Adamax:()=>va.adamax(.002,.9,.999,Gn(),0),RMSProp:()=>va.rmsprop(.001,.9,0,Gn()),SGD:()=>va.sgd(.01)};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,n in t)return t[n]();throw new dt(`Unknown Optimizer ${n}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const z3=1*1024*1024;function B3(n,t,e=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!A1(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(e){const s=JSON.stringify(n);s.length>z3&&console.warn(`User-defined metadata of model "${t}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${z3}.`)}}function A1(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){const t=Object.keys(n);for(const e of t)if(typeof e!="string"||!A1(n[e]))return!1;return!0}else if(Array.isArray(n)){for(const t of n)if(!A1(t))return!1;return!0}else return!1;else{const t=typeof n;return t==="string"||t==="number"||t==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function tX(n,t,e,s=console.log){const r=nX(n),i=["Layer (type)","Input Shape","Output shape","Param #"];r?(t=t||90,e=e||[.32,.61,.89,1]):(t=t||115,e=e||[.24,.48,.7,.8,1]),e[e.length-1]<=1&&(e=e.map(c=>Math.floor(t*c)));let o;if(!r){i.push("Receives inputs"),o=[];for(const c in n.nodesByDepth)o.push(...n.nodesByDepth[c])}s("_".repeat(t)),Df(i,e,s),s("=".repeat(t));const a=n.layers;for(let c=0;c<a.length;++c)r?sX(a[c],e,s):rX(a[c],e,o,s),s((c===a.length-1?"=":"_").repeat(t));n.checkTrainableWeightsConsistency();const u=eX(n),l=Nf(n.nonTrainableWeights);s(`Total params: ${u+l}`),s(`Trainable params: ${u}`),s(`Non-trainable params: ${l}`),s("_".repeat(t))}function eX(n){let t;return n.collectedTrainableWeights!=null?t=Nf(n.collectedTrainableWeights):t=Nf(n.trainableWeights),t}function nX(n){let t=!0;const e=[],s=[];for(const r in n.nodesByDepth)e.push(n.nodesByDepth[r]);for(const r of e){if(r.length>1||r.length===1&&r[0].inboundLayers.length>1){t=!1;break}s.push(...r)}if(t)for(const r of n.layers){let i=!1;for(const o of r.inboundNodes)if(s.indexOf(o)!==-1)if(i){t=!1;break}else i=!0;if(!t)break}return t}function Df(n,t,e=console.log){let s="";for(let r=0;r<n.length;++r)r>0&&(s=s.slice(0,s.length-1)+" "),s+=n[r],s=s.slice(0,t[r]),s+=" ".repeat(t[r]-s.length);e(s)}function sX(n,t,e){let s,r;try{r=n.inboundNodes.map(u=>JSON.stringify(u.inputShapes)).join(",")}catch{r="multiple"}try{s=JSON.stringify(n.outputShape)}catch{s="multiple"}const i=n.name,o=n.getClassName(),a=[`${i} (${o})`,r,s,n.countParams().toString()];Df(a,t,e)}function rX(n,t,e,s){let r,i;try{i=n.inboundNodes.map(h=>JSON.stringify(h.inputShapes)).join(",")}catch{i="multiple"}try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}const o=[];for(const h of n.inboundNodes)if(!(e!=null&&e.length>0&&e.indexOf(h)===-1))for(let d=0;d<h.inboundLayers.length;++d){const f=h.inboundLayers[d].name,p=h.nodeIndices[d],m=h.tensorIndices[d];o.push(`${f}[${p}][${m}]`)}const a=n.name,u=n.getClassName(),l=o.length===0?"":o[0],c=[`${a} (${u})`,i,r,n.countParams().toString(),l];Df(c,t,s);for(let h=1;h<o.length;++h)Df(["","","","",o[h]],t,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function MS(n,t,e){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&t===0&&typeof e=="string"}function R1(n,t){if(n===null)return null;if(typeof n=="string")return Ia(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const e=[],s=n.length;for(let r=0;r<s;++r){const i=n[r];MS(t,r,i)?e.push(i):e.push(R1(i,t))}return e}else{const e={};for(const s of Object.keys(n)){const r=n[s];if(s==="name"&&typeof r=="string")e[s]=r;else{const i=Ia(s);e[i]=R1(r,i)}}return e}}function D1(n,t){if(n==null)return null;if(typeof n=="string")return Xi(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const e=[],s=n.length;for(let r=0;r<s;++r){const i=n[r];MS(t,r,i)?e.push(i):e.push(D1(i,t))}return e}else{const e={};for(const s of Object.keys(n)){const r=n[s],i=Xi(s);(s==="name"||s==="className")&&typeof r=="string"?e[i]=r:e[i]=D1(r,s)}return e}}/** @license See the LICENSE file. */const zS="4.8.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class ti extends Me{constructor(t){if(super({}),this.containerNodes=new Set,this.name=t.name,this.name==null){const b=this.getClassName().toLowerCase();this.name=Hm(b)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(t.inputs)?this.inputs=t.inputs.slice():this.inputs=[t.inputs],Array.isArray(t.outputs)?this.outputs=t.outputs.slice():this.outputs=[t.outputs],Mo(this.inputs).length!==this.inputs.length)throw new dt(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(b=>b.name)}`);Mo(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(b=>b.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const b of this.outputs){const w=b.sourceLayer,v=b.nodeIndex,S=b.tensorIndex;this.outputLayers.push(w),this.outputLayersNodeIndices.push(v),this.outputLayersTensorIndices.push(S)}for(const b of this.inputs){const w=b.sourceLayer,v=b.nodeIndex,S=b.tensorIndex;Ci(v===0,"input layer has >1 nodes"),Ci(S===0,"input layer has >1 tensors"),this.inputLayers.push(w),this.inputLayersNodeIndices.push(v),this.inputLayersTensorIndices.push(S)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let b=0;b<this.inputLayers.length;b++){const w=this.inputLayers[b];if(!(w instanceof xd))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${t.inputs}. Input ${b} (0-based) originates from layer type ${w.getClassName()}.`);this.inputNames.push(w.name),this.feedInputShapes.push(w.batchInputShape),this.feedInputNames.push(w.name)}for(const b of this.outputLayers)this.outputNames.push(b.name);this.internalInputShapes=this.inputs.map(b=>b.shape),this.internalOutputShapes=this.outputs.map(b=>b.shape);const e={},s={},r={},i={},o={},a=[],u=(b,w,v,S,N,R)=>{(S==null||N==null||R==null)&&(S=b.sourceLayer,N=b.nodeIndex,R=b.tensorIndex);const L=S.inboundNodes[N];if(v.indexOf(L)!==-1)throw new Gr(`The tensor ${b.name} at layer "${S.name}" is part of a cycle.`);if(w.indexOf(L)!==-1)return;this.containerNodes.add(ti.nodeKey(S,N)),S.id in o||(o[S.id]=Object.keys(o).length),v.indexOf(L)===-1&&v.push(L);const F=L.inboundLayers.length;for(let B=0;B<F;B++){const H=L.inputTensors[B],z=L.inboundLayers[B],G=L.nodeIndices[B],T=L.tensorIndices[B];u(H,w,v,z,G,T)}for(w.push(L);v.indexOf(L)>=0;)v.splice(v.indexOf(L),1);a.push(L)},l=[],c=[];for(const b of this.outputs)u(b,l,c);const h=a.slice().reverse();for(const b of h){s[b.id]=b,b.id in e||(e[b.id]=0);let w=e[b.id];const v=r[b.outboundLayer.id]==null?0:r[b.outboundLayer.id];w=Math.max(w,v),r[b.outboundLayer.id]=w,i[b.outboundLayer.id]=b.outboundLayer,e[b.id]=w;for(let S=0;S<b.inboundLayers.length;S++){const N=b.inboundLayers[S],R=b.nodeIndices[S],L=N.inboundNodes[R],F=e[L.id]==null?0:e[L.id];e[L.id]=Math.max(w+1,F),s[L.id]=L}}const d={};for(const b in e){const w=e[b];w in d||(d[w]=[]),d[w].push(s[b])}const f={};for(const b in r){const w=r[b];w in f||(f[w]=[]),f[w].push(i[b])}let p=Object.keys(f).map(b=>parseInt(b,10)).sort(jd);this.layers=[];for(const b of p){const w=f[b];w.sort((v,S)=>{const N=o[v.id],R=o[S.id];return N<R?-1:N>R?1:0});for(const v of w)v instanceof ti&&this.internalContainerRefs.push(v),this.layers.push(v)}this.layersByDepth=f,p=Object.keys(d).map(b=>parseInt(b,10)).sort(jd);const m=this.inputs.slice(),g=[];for(const b of p)for(const w of d[b]){const v=w.outboundLayer;if(v!=null){for(const S of w.inputTensors)if(m.indexOf(S)===-1)throw new Gr(`Graph disconnected: cannot obtain value for tensor ${S} at layer "${v.name}". The following previous layers were accessed without issue: ${g}`);for(const S of w.outputTensors)m.push(S);g.push(v.name)}}this.nodesByDepth=d;const y=this.layers.map(b=>b.name);for(const b of y){const w=y.filter(v=>v===b).length;if(w!==1)throw new Gr(`The name "${b}" is used ${w} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(y))}this.outboundNodes=[],this.inboundNodes=[],new qm({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(b=>null),outputMasks:this.outputs.map(b=>null),inputShapes:this.inputs.map(b=>b.shape),outputShapes:this.outputs.map(b=>b.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const t={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const e of this.layers)t.numDisposedVariables+=e.dispose().numDisposedVariables;for(const e of this.internalContainerRefs)t.numDisposedVariables+=e.dispose().numDisposedVariables}return t.refCountAfterDispose=this._refCount,t}get trainable(){return this.trainable_}set trainable(t){this.layers.forEach(e=>{e._trainableWeights.forEach(s=>s.trainable=t)}),this.trainable_=t}get trainableWeights(){if(this._trainableWeights.length>0)throw new dt("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let t=[];for(const e of this.layers)t=t.concat(e.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const e of this.layers)t.push(...e.nonTrainableWeights);if(!this.trainable){const e=[];for(const s of this.layers)e.push(...s.trainableWeights);return e.concat(t)}return t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(t,e=!0){const s={};let r=0;for(const o of this.layers)for(const a of o.weights){if(s[a.originalName]!=null)throw new dt(`Duplicate weight name: ${a.originalName}`);s[a.originalName]=a,r++}const i=[];for(const o in t){let a=o;if(s[o]==null){const u=o.split("/");a=u.slice(0,-2).concat([u[u.length-1]]).join("/")}if(s[a]!=null)i.push([s[a],t[o]]);else if(e)throw new dt(`Provided weight data has no target variable: ${o}`);delete s[a]}if(e){const o=[];for(const a in s)o.push(a);if(o.length>0)throw new dt(`${o.length} of ${r} weights are not set: ${o}`)}ky(i)}updatedConfig(){const t=this.getConfig(),e={};return e.className=this.getClassName(),e.config=t,e.kerasVersion=`tfjs-layers ${zS}`,e.backend="TensorFlow.js",e}toJSON(t,e=!0){const s=D1(this.updatedConfig());return e?JSON.stringify(s):s}call(t,e){return pt(()=>{t=mn(t);const s=new Lo;for(let r=0;r<this.inputs.length;++r)s.add(this.inputs[r],t[r]);return fc(this.outputs,s,e)})}computeMask(t,e){return pt(()=>{t=mn(t);let s;return e==null?s=Ka(null,t.length):s=mn(e),this.runInternalGraph(t,s)[1]})}computeOutputShape(t){const e=Cf(t);if(e.length!==this.inputLayers.length)throw new dt(`Invalid inputShape argument ${t}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let a=0;a<e.length;a++){const u=this.inputLayers[a],l=e[a],c=u.name+"_0_0";s[c]=l}const r=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(jd);if(r.length>1)for(const a of r){const u=this.nodesByDepth[a];for(const l of u){const c=l.outboundLayer;if(this.inputLayers.map(m=>m.id).indexOf(c.id)!==-1)continue;const h=[];for(let m=0;m<l.inboundLayers.length;m++){const g=l.inboundLayers[m],y=l.nodeIndices[m],b=l.tensorIndices[m],w=`${g.name}_${y}_${b}`,v=s[w];h.push(v)}const d=c.computeOutputShape(js(h)),f=Cf(d),p=c.inboundNodes.indexOf(l);for(let m=0;m<f.length;m++){const g=`${c.name}_${p}_${m}`;s[g]=f[m]}}}const i=[],o=[];for(let a=0;a<this.outputLayers.length;a++){const u=this.outputLayers[a],l=this.outputLayersNodeIndices[a],c=this.outputLayersTensorIndices[a],h=`${u.name}_${l}_${c}`;o.push(h)}for(let a=0;a<o.length;a++){const u=o[a];Ci(u in s),i.push(s[u])}return js(i)}runInternalGraph(t,e){e==null&&(e=Ka(null,t.length));const s={};for(let u=0;u<this.inputs.length;++u){const l=this.inputs[u],c=t[u],h=e[u];s[l.id]=[c,h]}const r=Object.keys(this.nodesByDepth).map(u=>parseInt(u,10)).sort(jd);for(const u of r){const l=this.nodesByDepth[u];for(const c of l){const h=c.outboundLayer,d=c.inputTensors,f=c.outputTensors,p=new Array;for(const m of d)m.id in s&&p.push(s[m.id]);if(p.length===d.length){let m={},g,y,b,w;if(c.callArgs!=null&&(m=c.callArgs),p.length===1){const[v,S]=p[0];m.mask==null&&(m.mask=S),b=mn(h.call(v,m)),w=mn(h.computeMask(v,S)),g=[v],y=[S]}else g=p.map(v=>v[0]),y=p.map(v=>v[1]),m.mask==null&&(m.mask=y),b=mn(h.call(g,m)),w=mn(h.computeMask(g,y));if(h.activityRegularizer)throw new Oe("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let v=0;v<f.length;++v){const S=f[v],N=b[v],R=w[v];s[S.id]=[N,R]}}}}const i=[],o=[],a=[];for(const u of this.outputs){Ci(u.id in s,`Could not compute output ${u.name} : ${u.id}`);const[l,c]=s[u.id];a.push(l.shape),i.push(l),o.push(c)}return[i,o,a]}buildNodeConversionMap(t){const e={};let s;for(const r of this.layers){s=r instanceof ti?1:0;for(let i=0;i<r.inboundNodes.length;i++){const o=ti.nodeKey(r,i);this.containerNodes.has(o)&&(e[o]=s,s+=1)}}return e}getLayer(t,e){if(e!=null)return this.findLayer(e);if(t==null)throw new dt("Provide either a layer name or layer index");if(typeof t=="number")return this.findLayer(t);for(const s of this.layers)if(s.name===t)return s;throw new dt(`No such layer: ${t}`)}findLayer(t){if(this.layers.length<=t)throw new dt(`Was asked to retrieve layer at index ${t}, but model only has ${this.layers.length} layer(s).`);return this.layers[t]}calculateLosses(){return pt(()=>{const t=[];for(const e of this.layers)for(let s=0;s<e.inboundNodes.length;++s){const r=ti.nodeKey(e,s);this.containerNodes.has(r)&&t.push(...e.calculateLosses())}return t})}getConfig(){const t={name:this.name},e=this.buildNodeConversionMap(this.layers),s=[];for(const o of this.layers){const a=o.getClassName(),u=o.getConfig(),l=[];for(let h=0;h<o.inboundNodes.length;h++){const d=o.inboundNodes[h],f=ti.nodeKey(o,h);let p={};if(this.containerNodes.has(f)){if(d.callArgs)try{JSON.stringify(d.callArgs),p=d.callArgs}catch{console.warn(`Layer ${o.name} was passed non-serializable keyword arguments: ${d.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),p={}}if(d.inboundLayers.length>0){const m=[];for(let g=0;g<d.inboundLayers.length;g++){const y=d.inboundLayers[g],b=d.nodeIndices[g],w=d.tensorIndices[g],v=ti.nodeKey(y,b);let S=e[v];S==null&&(S=0),m.push([y.name,S,w,p])}l.push(m)}}}const c={};c.name=o.name,c.className=a,c.config=u,c.inboundNodes=l,s.push(c)}t.layers=s;const r=[];for(let o=0;o<this.inputLayers.length;o++){const a=this.inputLayers[o],u=this.inputLayersNodeIndices[o],l=ti.nodeKey(a,u);if(!this.containerNodes.has(l))continue;let c=e[l];c==null&&(c=0);const h=this.inputLayersTensorIndices[o];r.push([a.name,c,h])}t.inputLayers=r;const i=[];for(let o=0;o<this.outputLayers.length;o++){const a=this.outputLayers[o],u=this.outputLayersNodeIndices[o],l=ti.nodeKey(a,u);if(!this.containerNodes.has(l))continue;let c=e[l];c==null&&(c=0);const h=this.outputLayersTensorIndices[o];i.push([a.name,c,h])}return t.outputLayers=i,t}static fromConfig(t,e,s={},r=!1){const i={},o={};function a(g,y){g.name in o?o[g.name].push(y):o[g.name]=[y]}function u(g,y){const b=[];let w;for(const v of y){const S=v[0],N=v[1],R=v[2];if(w=v[3]==null?{}:v[3],!(S in i)){a(g,y);return}const L=i[S];if(L.inboundNodes.length<=N){a(g,y);return}const F=L.inboundNodes[N];b.push(F.outputTensors[R])}b.length>0&&g.apply(js(b),w)}function l(g){const y=g.name,b=eo(g,e.customObjects!=null?e.customObjects:{});b.setFastWeightInitDuringBuild(r),i[y]=b,g.inboundNodes.forEach(v=>{if(!(v instanceof Array))throw new dt(`Corrupted configuration, expected array for nodeData: ${v}`);a(b,v)})}const c=e.name,h=e.layers;for(const g of h)l(g);for(;!jK(o);)for(const g of h){const y=i[g.name];if(y.name in o){const b=o[y.name];delete o[y.name];for(const w of b)u(y,w)}}const d=[],f=[],p=e.inputLayers;for(const g of p){const y=g[0],b=g[1],w=g[2];Ci(y in i);const S=i[y].inboundNodes[b].outputTensors;d.push(S[w])}const m=e.outputLayers;for(const g of m){const y=g[0],b=g[1],w=g[2];Ci(y in i);const S=i[y].inboundNodes[b].outputTensors;f.push(S[w])}return new t({inputs:d,outputs:f,name:c})}get stateful(){if(this._stateful)throw new dt("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const t of this.layers)if(t.stateful)return!0;return!1}resetStates(){pt(()=>{this.layers.forEach(t=>{t.stateful&&t.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function iX(n,t,e){const s=t.length;if(n==null||Array.isArray(n)&&n.length===0)return t.map(r=>null);if(s===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&t[0]in n?[n[t[0]]]:[n];if(Array.isArray(n)){if(n.length!==s)throw new Error(`Provided ${e} is an array of ${n.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){const r=[];return t.forEach(i=>{i in n?r.push(n[i]):r.push(null)}),r}else throw new Error(`The model has multiple (${s}) outputs, so ${e} must be either an array with ${s} elements or an object with ${t} keys. Provided ${e} not understood: ${JSON.stringify(n)}`)}function BS(n,t){return iX(n,t,"classWeight")}async function VS(n,t,e,s){if(t!=null||s!=null)throw new Error("Support sampleWeight is not implemented yet");if(e!=null){const r=pt(()=>{if(n.shape.length===1)return Ri(n);if(n.shape.length===2){if(n.shape[1]>1)return Wo(n,1);if(n.shape[1]===1)return ct(n,[n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),i=Array.from(await r.data());Se(r);const o=[];return i.forEach(a=>{if(e[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);o.push(e[a])}),zn(o,"float32")}else return null}function oX(n,t){return ut(n,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const aX=32;function US(n,t){let e,s;const r=t;e=r.xs,s=r.ys,V(e!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${t}`);const i=V3("input",n.inputNames,e),o=V3("output",n.outputNames,s),a=i[0].shape[0];V(i.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${i.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),V(o.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let u=0;u<i.length;u++)V(i[u].shape[0]===a,()=>`Batch size mismatch: input ${n.inputNames[u]} has ${i[u].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);for(let u=0;u<o.length;u++)V(o[u].shape[0]===a,()=>`Batch size mismatch: output ${n.outputNames[u]} has ${o[u].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);return{xs:i,ys:o}}function V3(n,t,e){if(e instanceof $e)return[e];if(Array.isArray(e))return V(e.length===t.length,()=>`Received an array of ${e.length} Tensors, but expected ${t.length} to match the ${n} keys ${t}.`),e;{const s=[];for(const r of t){if(e[r]==null)throw new dt(`The feature data generated by the dataset lacks the required ${n} key '${r}'.`);s.push(e[r])}return s}}function uX(n){if(n.length===3)throw new Oe("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}async function lX(n,t,e){const s=e.batchesPerEpoch!=null;if(V(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),V(e!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),V(e.epochs!=null&&e.epochs>0&&Number.isInteger(e.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${e.epochs}`),V(!s||e.batchesPerEpoch>0&&Number.isInteger(e.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${e.batchesPerEpoch}`),V(e.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{const r=e.validationData!=null;let i,o;if(r)if(U3(e.validationData))V(e.validationBatches==null||e.validationBatches>0&&Number.isInteger(e.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${e.validationBatches}`);else{const g=uX(e.validationData);i=g.xs,o=g.ys}const a=n.makeTrainFunction(),u=n.getDedupedMetricsNames();let l;r?l=u.slice().concat(u.map(g=>"val_"+g)):l=u.slice();const c=AS(e.callbacks,e.yieldEvery),h=e.verbose==null?1:e.verbose,{callbackList:d,history:f}=RS(c,h,e.epochs,null,null,cX(t,e),null,r,l);d.setModel(n),n.history=f,await d.onTrainBegin(),n.stopTraining_=!1;let p=e.initialEpoch==null?0:e.initialEpoch,m=await t.iterator();for(;p<e.epochs;){const g={};await d.onEpochBegin(p);let y=0,b=0;for(s||(m=await t.iterator());!s||y<e.batchesPerEpoch;){const w=await m.next();if(s&&w.done){console.warn(`You provided \`batchesPerEpoch\` as ${e.batchesPerEpoch}, but your dataset iterator ran out of data after ${y} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${e.batchesPerEpoch*e.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(w.value!=null){const{xs:v,ys:S}=US(n,w.value),N={};N.batch=b,N.size=v[0].shape[0],await d.onBatchBegin(b,N);const R=[];if(e.classWeight!=null){const B=BS(e.classWeight,n.outputNames);for(let H=0;H<B.length;++H)R.push(await VS(S[H],null,B[H]))}const L=v.concat(S).concat(R),F=a(L);Se(L);for(let B=0;B<u.length;++B){const H=u[B],z=F[B];N[H]=z,es(z)}await d.onBatchEnd(b,N),_S(N),b++,y++}if(s?y>=e.batchesPerEpoch:w.done){if(r){let v;U3(e.validationData)?v=mn(await n.evaluateDataset(e.validationData,{batches:e.validationBatches})):v=mn(n.evaluate(i,o,{batchSize:e.validationBatchSize==null?aX:e.validationBatchSize,verbose:0}));for(let S=0;S<n.metricsNames.length;++S)g[`val_${n.metricsNames[S]}`]=v[S]}break}if(n.stopTraining_)break}if(await d.onEpochEnd(p,g),p++,n.stopTraining_)break}return await d.onTrainEnd(),await n.history.syncData(),n.history}finally{n.isTraining=!1}}function cX(n,t){let e=null;return t.batchesPerEpoch!=null?e=t.batchesPerEpoch:Number.isFinite(n.size)&&(e=n.size),e}function U3(n){return typeof n.iterator=="function"}function hX(n){return typeof n.next=="function"}async function dX(n,t,e){e=e||{};const s=e.batches!=null,r=n.testFunction;let i=[];if(e.verbose>0)throw new Oe("Verbose mode is not implemented yet.");V(!s||e.batches>0&&Number.isInteger(e.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(e.batches)}`);const o=hX(t)?t:await t.iterator();let a=0,u=0;for(;!s||u<e.batches;){const l=await o.next();if(i=pt(()=>{if(l.value){const{xs:c,ys:h}=US(n,l.value),d=c.concat(h),f=pt(()=>r(d));if(Se(d),u===0)for(let m=0;m<f.length;++m)i.push(fe(0));const p=d[0].shape[0];for(let m=0;m<f.length;++m){const g=f[m],y=i[m];i[m]=pt(()=>Lt(i[m],ut(p,g))),u>0&&Se(y)}Se(f),a+=p,++u}return i}),l.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${e.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let l=0;l<i.length;++l){const c=i[l];i[l]=ie(i[l],a),Se(c)}return js(i)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Fg(n){V(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function ic(n,t,e){return n==null?[null]:Array.isArray(n)?n.map(s=>Da(s,t,e-t)):Da(n,t,e-t)}function O1(n,t){return pt(()=>n==null?null:Array.isArray(n)?n.map(e=>O1(e,t)):gS(n,t.dtype==="int32"?t:Kt(t,"int32")))}function Lg(n,t){const e=[];let s=0,r=null;for(;s<n;)r=s+t,r>=n&&(r=n),e.push([s,r]),s=r;return e}function WS(n){const t=[];n instanceof $e&&(n=[n]);for(let e=0;e<n.length;++e){const s=n[e];if(s.rank===1)t.push(gd(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(s)}}return t}function Qr(n,t){if(n==null)return;const e=[];if(t instanceof $e)e.push(t.id);else if(Array.isArray(t))t.forEach(r=>e.push(r.id));else if(t!=null)for(const r in t){const i=t[r];e.push(i.id)}const s=[];if(n instanceof $e)e.indexOf(n.id)===-1&&s.push(n);else if(Array.isArray(n))n.forEach(r=>{e.indexOf(r.id)===-1&&s.push(r)});else if(n!=null)for(const r in n){const i=n[r];e.indexOf(i.id)===-1&&s.push(i)}s.forEach(r=>{r.isDisposed||r.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function fX(n){return n instanceof $e}function F1(n){return Array.isArray(n)}function W3(n){return!fX(n)&&!F1(n)}function G3(n,t,e,s=!0,r=""){if(t==null||t.length===0){if(n!=null){let o=!1;if(F1(n)&&n.length>0)o=!0;else if(W3(n)){for(const a in n)if(n.hasOwnProperty(a)){o=!0;break}}else o=!0;if(o)throw new dt(`Error when checking model ${r} expected no data, but got ${n}`)}return[]}if(n==null)return t.map(o=>null);let i;if(W3(n)){n=n,i=[];for(const o of t){if(n[o]==null)throw new dt(`No data provided for "${o}". Need data for each key in: ${t}`);i.push(n[o])}}else if(F1(n)){if(n=n,n.length!==t.length)throw new dt(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${t.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);i=n}else{if(n=n,t.length>1)throw new dt(`The model ${r} expects ${t.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);i=[n]}if(i=WS(i),e!=null)for(let o=0;o<t.length;++o){if(e[o]==null)continue;const a=i[o];if(a.shape.length!==e[o].length)throw new dt(`Error when checking ${r}: expected ${t[o]} to have ${e[o].length} dimension(s). but got array with shape ${a.shape}`);for(let u=0;u<e[o].length;++u){if(u===0&&!s)continue;const l=a.shape[u],c=e[o][u];if(c!=null&&c>=0&&l!==c)throw new dt(`${r} expected a batch of elements where each example has shape [${e[o].slice(1,e[o].length)}] (i.e.,tensor shape [*,${e[o].slice(1,e[o].length)}]) but the ${r} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return i}function pX(n,t,e){const s=Mo(n.map(i=>i.shape[0]));s.sort();const r=Mo(t.map(i=>i.shape[0]));if(r.sort(),s.length>1)throw new dt(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(i=>i.shape))}`);if(r.length>1)throw new dt(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(i=>i.shape))}`);if(s.length>0&&r.length>0&&!Ve(s,r))throw new dt(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${r[0]} target sample(s).`)}function mX(n,t,e){const s=[Xm,Ym,Fc];for(let r=0;r<n.length;++r){const i=n[r],o=t[r],a=e[r];if(o!=null){if(o===Fc&&i.shape[i.shape.length-1]===1)throw new dt(`You are passing a target array of shape ${i.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(o)!==-1){const u=i.shape.slice(1),l=a.slice(1);for(let c=0;c<u.length;++c){const h=u[c],d=l[c];if(d!=null&&h!==d)throw new dt(`A target Tensor with shape ${i.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function j3(n,t,e,s=!0,r=""){let i;if(Array.isArray(n)){if(n.length!==t.length)throw new dt(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${t.length} Tensor(s), but instead got ${n.length} Tensors(s).`);i=n}else{if(t.length>1)throw new dt(`The model expects ${t.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);i=[n]}if(e!=null)for(let o=0;o<t.length;++o){if(e[o]==null)continue;const a=i[o];if(a.shape.length!==e[o].length)throw new dt(`Error when checking ${r}: expected ${t[o]} to have ${e[o].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let u=0;u<e[o].length;++u){if(u===0&&!s)continue;const l=a.shape[u],c=e[o][u];if(c!=null&&c!==l)throw new dt(`Error when checking ${r}: expected ${t[o]} to have shape ${JSON.stringify(e[o])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function gX(n,t){if(n==null||Array.isArray(n)&&n.length===0)return t.map(s=>[]);let e;if(typeof n=="string"||typeof n=="function")e=[n];else if(Array.isArray(n)||typeof n=="object")e=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(e))return t.map(s=>e);{const s=[];for(const r of t){let i=e.hasOwnProperty(r)?e[r]:[];Array.isArray(i)||(i=[i]),s.push(i)}return s}}const yX="layers-model";class Tu extends ti{constructor(t){super(t),this.isTraining=!1}summary(t,e,s=console.log){if(!this.built)throw new dt("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");tX(this,t,e,s)}compile(t){if(t.loss==null&&(t.loss=[]),this.loss=t.loss,typeof t.optimizer=="string")this.optimizer_=Qq(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof bo))throw new dt("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}let e=[];if(!Array.isArray(t.loss)&&typeof t.loss!="string"&&typeof t.loss!="function"){t.loss=t.loss;for(const o in t.loss)if(this.outputNames.indexOf(o)===-1)throw new dt(`Unknown entry in loss dictionary: "${o}". Only expected the following keys: ${this.outputNames}`);for(const o of this.outputNames)t.loss[o]==null&&console.warn(`Output "${o}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${o} during training`),e.push(Og(t.loss[o]))}else if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new dt(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${t.loss}.`);e=t.loss.map(a=>Og(a))}else{const o=Og(t.loss);this.outputs.forEach(a=>{e.push(o)})}this.lossFunctions=e,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let o=0;o<this.outputs.length;++o){const a=this.internalOutputShapes[o],u=this.outputNames[o];this.feedOutputNames.push(u),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[o])}const s=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Ra("loss",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const a=this.lossFunctions[o];this.outputs.length>1&&(this.metricsTensors.push([a,o]),this.metricsNames.push(this.outputNames[o]+"_loss"))}});const r=gX(t.metrics,this.outputNames),i=(o,a,u)=>{this.outputNames.length>1&&(a=this.outputNames[o]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([u,o])};Ra("metric",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const a=r[o];(l=>{const c="";let h,d,f;for(const p of l){if(typeof p=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(p)!==-1){const g=this.internalOutputShapes[o];g[g.length-1]===1||this.lossFunctions[o]===Ym?["accuracy","acc"].indexOf(p)!==-1?d=OS:["crossentropy","ce"].indexOf(p)!==-1&&(d=Wq):this.lossFunctions[o]===_f?["accuracy","acc"].indexOf(p)!==-1?d=Gq:["crossentropy","ce"].indexOf(p)!==-1&&(d=PS):["accuracy","acc"].indexOf(p)!==-1?d=FS:["crossentropy","ce"].indexOf(p)!==-1&&(d=LS);let y;["accuracy","acc"].indexOf(p)!==-1?y="acc":["crossentropy","ce"].indexOf(p)!==-1&&(y="ce"),f=d,h=c+y}else f=Jq(p),h=c+qd(p);let m;Ra(h,()=>{m=f}),i(o,h,m)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(t,e,s={}){const r=s.batchSize==null?32:s.batchSize;Fg(r);const i=!0,o=this.standardizeUserDataXY(t,e,i,r);try{const a=o[0].concat(o[1]);this.makeTestFunction();const u=this.testFunction,l=this.testLoop(u,a,r,s.verbose,s.steps);return js(l)}finally{Qr(o[0],t),Qr(o[1],e)}}async evaluateDataset(t,e){return this.makeTestFunction(),dX(this,t,e)}checkNumSamples(t,e,s,r="steps"){let i;if(s!=null){if(i=null,e!=null)throw new dt(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${e}`)}else if(t!=null)Array.isArray(t)?i=t[0].shape[0]:i=t.shape[0];else throw new dt(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return i}execute(t,e){if(Array.isArray(e)&&e.length===0)throw new dt("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(e),r=s?e:[e],i=this.retrieveSymbolicTensors(r),o=new Lo;if(t instanceof $e&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new dt(`The number of inputs provided (${t.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let u=0;u<this.inputs.length;++u)o.add(this.inputs[u],t[u])}else for(const u of this.inputs){const l=t[u.name];if(l==null)throw new dt(`No value is provided for the model's input ${u.name}`);o.add(u,l)}const a=fc(i,o);return s?a:a[0]}retrieveSymbolicTensors(t){const e=Ka(null,t.length);let s=t.length;for(const r of this.layers){const i=Array.isArray(r.output)?r.output:[r.output],o=i.map(a=>a.name);for(let a=0;a<t.length;++a){const u=o.indexOf(t[a]);if(u!==-1&&(e[a]=i[u],s--),s===0)break}if(s===0)break}if(s>0){const r=[];throw e.forEach((i,o)=>{i==null&&r.push(t[o])}),new dt(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return e}predictLoop(t,e=32,s=!1){return pt(()=>{const r=this.checkNumSamples(t);if(s)throw new Oe("Verbose predictLoop() is not implemented yet.");const i=Lg(r,e),o=this.outputs.map(a=>[]);for(let a=0;a<i.length;++a)pt(()=>{const l=i[a][0],c=i[a][1],h=ic(t,l,c),d=[];if(Array.isArray(h))for(let p=0;p<h.length;++p)d.push({key:this.inputs[p],value:h[p]});else d.push({key:this.inputs[0],value:h});const f=new Lo(d);return fc(this.outputs,f)}).forEach((l,c)=>o[c].push(l));return js(o.map(a=>Cn(a,0)))})}predict(t,e={}){const s=WS(t);j3(s,this.inputNames,this.feedInputShapes,!1);try{const r=e.batchSize==null?32:e.batchSize;return Fg(r),this.predictLoop(s,r)}finally{Qr(s,t)}}predictOnBatch(t){j3(t,this.inputNames,this.feedInputShapes,!0);const e=(Array.isArray(t)?t[0]:t).shape[0];return this.predictLoop(t,e)}standardizeUserDataXY(t,e,s=!0,r){if(this.optimizer_==null)throw new Gr("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const i=[];for(let o=0;o<this.feedOutputShapes.length;++o){const a=this.feedOutputShapes[o];this.feedLossFns[o]===_f?i.push(a.slice(0,a.length-1).concat([1])):i.push(a)}if(t=G3(t,this.feedInputNames,this.feedInputShapes,!1,"input"),e=G3(e,this.feedOutputNames,i,!1,"target"),pX(t,e),mX(e,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&t[0].shape[0]%r!==0)throw new dt(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${t[0].shape[0]} sample(s).`);return[t,e]}async standardizeUserData(t,e,s,r,i=!0,o){const[a,u]=this.standardizeUserDataXY(t,e,i,o);if(s!=null)throw new Error("sample weight is not supported yet.");let l=null;if(r!=null){const c=BS(r,this.outputNames);l=[];for(let h=0;h<c.length;++h)l.push(await VS(u[h],null,c[h]))}return[a,u,l]}testLoop(t,e,s,r=0,i){return pt(()=>{const o=this.checkNumSamples(e,s,i,"steps"),a=[];if(r>0)throw new Oe("Verbose mode is not implemented yet.");if(i!=null)throw new Oe("steps mode in testLoop() is not implemented yet");{const u=Lg(o,s),l=zn(li(0,o));for(let c=0;c<u.length;++c){const h=u[c][0],d=u[c][1],f=Da(l,h,d-h),p=O1(e,f),m=t(p);if(c===0)for(let g=0;g<m.length;++g)a.push(fe(0));for(let g=0;g<m.length;++g){const y=m[g];a[g]=Lt(a[g],ut(d-h,y))}}for(let c=0;c<a.length;++c)a[c]=ie(a[c],o)}return a})}getDedupedMetricsNames(){const t=this.metricsNames,e=[];for(let s=0;s<t.length;++s){const r=t[s];let i=r;if(E3(t,r)>1){const o=E3(t.slice(0,s),r);i+=`_${o}`}e.push(i)}return e}makeTrainFunction(){return t=>{const e=[],s=t.slice(0,this.inputs.length),r=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=t.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),o=[],a=()=>{const h=[];for(let m=0;m<this.inputs.length;++m)h.push({key:this.inputs[m],value:s[m]});const d=new Lo(h),f=fc(this.outputs,d,{training:!0});let p;for(let m=0;m<this.lossFunctions.length;++m){const g=this.lossFunctions[m];let y=g(r[m],f[m]);i[m]!=null&&(y=oX(y,i[m]));const b=wn(y);e.push(b),m===0?p=y:p=Lt(p,y)}for(let m=0;m<this.metricsTensors.length;++m){let g;if(this.outputs.length>1&&m<this.outputs.length)g=e[m];else{const y=this.metricsTensors[m][0],b=this.metricsTensors[m][1];g=wn(y(r[b],f[b]))}es(g),o.push(g)}return p=wn(p),this.calculateLosses().forEach(m=>{p=Lt(p,m)}),p},u=this.collectedTrainableWeights.map(h=>h.read()),l=!0;return[this.optimizer_.minimize(a,l,u)].concat(o)}}makeTestFunction(){this.testFunction=t=>pt(()=>{const e=[];let s;const r=t.slice(0,this.inputs.length),i=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=[];for(let l=0;l<this.inputs.length;++l)o.push({key:this.inputs[l],value:r[l]});const a=new Lo(o),u=fc(this.outputs,a);for(let l=0;l<this.lossFunctions.length;++l){const c=this.lossFunctions[l],h=wn(c(i[l],u[l]));l===0?s=h:s=Lt(s,h),e.push(s)}for(let l=0;l<this.metricsTensors.length;++l){const c=this.metricsTensors[l][0],h=this.metricsTensors[l][1],d=wn(c(i[h],u[h]));e.push(d)}return e})}async fit(t,e,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let r,i,o,a,u,l,c,h,d;try{const f=s.batchSize==null?32:s.batchSize;Fg(f);const p=!1,m=await this.standardizeUserData(t,e,s.sampleWeight,s.classWeight,p,f);r=m[0],i=m[1],d=m[2];let g=!1,y;if(s.validationData!=null&&s.validationData.length>0){if(g=!0,s.validationData.length===2)u=s.validationData[0],l=s.validationData[1];else throw s.validationData.length===3?new Oe("validationData including sample weights is not supported yet."):new dt(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const F=!0,B=await this.standardizeUserData(u,l,null,null,F,f);c=B[0],h=B[1],y=c.concat(h)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){g=!0;const F=Math.floor(r[0].shape[0]*(1-s.validationSplit)),B=r[0].shape[0];c=ic(r,F,B),o=r,r=ic(r,0,F),h=ic(i,F,B),a=i,i=ic(i,0,F),y=c.concat(h)}else s.validationSteps!=null&&(g=!0);const b=r.concat(i).concat(d);this.checkTrainableWeightsConsistency();const w=this.makeTrainFunction(),v=this.getDedupedMetricsNames();let S,N;g?(this.makeTestFunction(),S=this.testFunction,N=v.slice().concat(v.map(F=>"val_"+F))):(S=null,y=[],N=v.slice());const R=AS(s.callbacks,s.yieldEvery);return await this.fitLoop(w,b,v,f,s.epochs,s.verbose,R,S,y,s.shuffle,N,s.initialEpoch,null,null)}finally{this.isTraining=!1,Qr(r,t),Qr(i,e),Qr(o,t),Qr(a,e),Qr(c,u),Qr(h,l),d!=null&&Se(d)}}async fitLoop(t,e,s,r,i,o,a,u,l,c,h,d,f,p){r==null&&(r=32),i==null&&(i=1),c==null&&(c=!0),d==null&&(d=0);let m=!1;if(u!=null&&l!=null&&(m=!0),p!=null&&(m=!0,f==null))throw new dt("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const g=this.checkNumSamples(e,r,f,"steps_per_epoch");let y;g!=null&&(y=li(0,g)),o==null&&(o=1);const{callbackList:b,history:w}=RS(a,o,i,d,g,f,r,m,h);b.setModel(this),this.history=w,await b.onTrainBegin(),this.stopTraining_=!1;for(let v=d;v<i;++v){await b.onEpochBegin(v);const S={};if(f!=null)throw new Oe("stepsPerEpoch mode is not implemented yet.");{if(c==="batch")throw new Oe("batch shuffling is not implemneted yet");c&&z1(y);const N=zn(y),R=Lg(g,r);for(let L=0;L<R.length;++L){const F={};if(await b.onBatchBegin(L,F),pt(()=>{const B=R[L][0],H=R[L][1],z=Da(N,B,H-B);F.batch=L,F.size=H-B;const G=O1(e,z),T=t(G);for(let K=0;K<s.length;++K){const ht=s[K],rt=T[K];F[ht]=rt,es(rt)}if(L===R.length-1&&m){const K=this.testLoop(u,l,r);for(let ht=0;ht<s.length;++ht){const rt=s[ht],gt=K[ht];es(gt),S["val_"+rt]=gt}}}),await b.onBatchEnd(L,F),_S(F),this.stopTraining_)break}N.dispose()}if(await b.onEpochEnd(v,S),this.stopTraining_)break}return await b.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(t,e){return lX(this,t,e)}async trainOnBatch(t,e){const s=await this.standardizeUserData(t,e),r=s[0],i=s[1],a=this.makeTrainFunction()(r.concat(i)),u=[];for(const l of a){const c=await l.data();u.push(c[0])}return Se(a),Qr(s[0],t),Qr(s[1],e),js(u)}getNamedWeights(t){const e=[],s=t!=null&&t.trainableOnly,r=s?this.trainableWeights:this.weights,i=this.getWeights(s);for(let o=0;o<r.length;++o)s&&!r[o].trainable||e.push({name:r[o].originalName,tensor:i[o]});return e}set stopTraining(t){this.stopTraining_=t}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)}dispose(){const t=super.dispose();if(t.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const e=hf().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=e-hf().numTensors}return t}getLossIdentifiers(){let t;if(typeof this.loss=="string")t=Xi(this.loss);else if(Array.isArray(this.loss)){for(const e of this.loss)if(typeof e!="string")throw new Error("Serialization of non-string loss is not supported.");t=this.loss.map(e=>Xi(e))}else{const e=Object.keys(this.loss);t={};const s=this.loss;for(const r of e)if(typeof s[r]=="string")t[r]=Xi(s[r]);else throw new Error("Serialization of non-string loss is not supported.")}return t}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Xi(qd(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(t=>Xi(qd(t)));{const t={};for(const e in this.metrics)t[e]=Xi(qd(this.metrics[e]));return t}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(t){if(t.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(t.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(t.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const e=R1(t.optimizer_config),s=eo(e);let r;if(typeof t.loss=="string")r=Ia(t.loss);else if(Array.isArray(t.loss))r=t.loss.map(o=>Ia(o));else if(t.loss!=null){r={};for(const o in t.loss)r[o]=Ia(t.loss[o])}let i;if(Array.isArray(t.metrics))i=t.metrics.map(o=>Ia(o));else if(t.metrics!=null){i={};for(const o in t.metrics)i[o]=Ia(t.metrics[o])}this.compile({loss:r,metrics:i,optimizer:s})}async save(t,e){if(typeof t=="string"){const l=Wx(t);if(l.length===0)throw new dt(`Cannot find any save handlers for URL '${t}'`);if(l.length>1)throw new dt(`Found more than one (${l.length}) save handlers for URL '${t}'`);t=l[0]}if(t.save==null)throw new dt("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await Zg(this.getNamedWeights(e)),r=!1,i=null,a={modelTopology:this.toJSON(i,r),format:yX,generatedBy:`TensorFlow.js tfjs-layers v${zS}`,convertedBy:null};if((e==null?!1:e.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const l="optimizer",{data:c,specs:h}=await Zg(await this.optimizer.getWeights(),l);s.specs.push(...h),s.data=zx([s.data,c])}return this.userDefinedMetadata!=null&&(B3(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=s.data,a.weightSpecs=s.specs,t.save(a)}setUserDefinedMetadata(t){B3(t,this.name),this.userDefinedMetadata=t}getUserDefinedMetadata(){return this.userDefinedMetadata}}Tu.className="Model";Vt(Tu);class GS extends Tu{}GS.className="Functional";Vt(GS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Lc extends Tu{constructor(t){if(super({inputs:[],outputs:[]}),t=t||{},this.trainable=!0,this.built=!1,this.name=t.name!=null?t.name:Hm("sequential_"),t.layers!=null)for(const e of t.layers)this.add(e)}checkShape(t){if(t.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new dt(`Negative dimension size caused by adding layer ${t.name} with input shape [${t.inboundNodes[0].inputTensors[0].shape}]`)}add(t){const e=t instanceof Lc||t instanceof Tu;let s;if(e){if(s=t,s.outputs.length!==1)throw new dt("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new dt("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(t.inboundNodes.length===0){if(t.batchInputShape==null)throw new dt("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const r=wq({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(r)}if(e)this.outputs=s.outputs,this.inputs=s.inputs;else{if(t.inboundNodes.length!==1)throw new dt(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${t.name} which has ${t.inboundNodes.length} pre-existing inbound connections.`);if(t.inboundNodes[0].outputTensors.length!==1)throw new dt("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=CS(this.outputs[0])}this.inboundNodes=[],new qm({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Ka(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(r=>r.shape),outputShapes:this.outputs[0].shape})}else{const r=t.apply(this.outputs[0]);if(Array.isArray(r))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[r],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(t,e){return this.model==null&&this.build(),this.model.call(t,e)}build(t){if(Xe(t),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Tu({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(t,e,s=console.log){this.built||this.build(),super.summary(t,e,s)}setWeights(t){this.model==null&&this.build(),this.model.setWeights(t)}evaluate(t,e,s={}){if(!this.built)throw new Gr("The model needs to be compiled before being used.");return this.model.evaluate(t,e,s)}async evaluateDataset(t,e){if(!this.built)throw new Gr("The model needs to be compiled before being used.");return this.model.evaluateDataset(t,e)}predict(t,e={}){return this.model==null&&this.build(),this.model.predict(t,e)}predictOnBatch(t){return this.model==null&&this.build(),this.model.predictOnBatch(t)}compile(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(t){this.model.optimizer=t}async fit(t,e,s={}){if(!this.built)throw new Gr("The model needs to be compiled before being used.");return this.model.fit(t,e,s)}async fitDataset(t,e){if(!this.built)throw new Gr("The model needs to be compiled before being used.");return this.model.fitDataset(t,e)}async trainOnBatch(t,e){return this.model.trainOnBatch(t,e)}static fromConfig(t,e,s={},r=!1){let i,o={};if(e instanceof Array){if(e[0].className==null||e[0].className==="Merge")throw new dt("Legacy serialization format not supported yet.");i=e}else V(e.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),i=e.layers,delete e.layers,o=e;const a=new t(o);if(!(a instanceof Lc))throw new Oe(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const u of i){const c=eo(u,void 0,r);r&&c.setFastWeightInitDuringBuild(!0),a.add(c)}return a}set stopTraining(t){if(this.model==null)throw new dt("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t}get stopTraining(){if(this.model==null)throw new dt("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const t=[];for(const e of this.layers){const s={};s.className=e.getClassName(),s.config=e.getConfig(),t.push(s)}return{name:this.name,layers:t}}}Lc.className="Sequential";Vt(Lc);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Zs=class extends su{getConfig(){return{}}};class jS extends Zs{apply(t,e=1){return oq(t,e)}}jS.className="elu";Vt(jS);class HS extends Zs{apply(t){return hm(t)}}HS.className="selu";Vt(HS);class KS extends Zs{apply(t){return fi(t)}}KS.className="relu";Vt(KS);class qS extends Zs{apply(t){return pt(()=>jo(6,fi(t)))}}qS.className="relu6";Vt(qS);class XS extends Zs{apply(t){return t}}XS.className="linear";Vt(XS);class YS extends Zs{apply(t){return Hs(t)}}YS.className="sigmoid";Vt(YS);class ZS extends Zs{apply(t){return uq(t)}}ZS.className="hardSigmoid";Vt(ZS);class JS extends Zs{apply(t){return tu(t)}}JS.className="softplus";Vt(JS);class QS extends Zs{apply(t){return aq(t)}}QS.className="softsign";Vt(QS);class tI extends Zs{apply(t){return Ma(t)}}tI.className="tanh";Vt(tI);let Ny=class extends Zs{apply(t,e=-1){return sd(t,e)}};Ny.className="softmax";Vt(Ny);class eI extends Zs{apply(t,e=-1){return em(t,e)}}eI.className="logSoftmax";Vt(eI);class nI extends Zs{apply(t,e=1){return pt(()=>ut(Hs(ut(t,e)),t))}}nI.className="swish";Vt(nI);class sI extends Zs{apply(t){return pt(()=>ut(t,Ma(tu(t))))}}sI.className="mish";Vt(sI);function Xo(n){return n.getClassName()}function Pg(n,t={}){return md(n,vr.getMap().classNameMap,t,"activation")}function Yo(n){if(n==null){const t={};return t.className="linear",t.config={},Pg(t)}if(typeof n=="string"){const t={};return t.className=n,t.config={},Pg(t)}else return n instanceof Zs?n:Pg(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function bX(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}class rI extends su{}class iI extends rI{constructor(t){super(),bX(t),this.l1=t==null||t.l1==null?.01:t.l1,this.l2=t==null||t.l2==null?.01:t.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(t){return pt(()=>{let e=Mn([1]);return this.hasL1&&(e=Lt(e,he(ut(this.l1,Pn(t))))),this.hasL2&&(e=Lt(e,he(ut(this.l2,yd(t))))),ct(e,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(t,e){return new t({l1:e.l1,l2:e.l2})}}iI.className="L1L2";Vt(iI);const H3={l1l2:"L1L2"};function cn(n){return dy(n)}function K3(n,t={}){return md(n,vr.getMap().classNameMap,t,"regularizer")}function kn(n){if(n==null)return null;if(typeof n=="string"){const e={className:n in H3?H3[n]:n,config:{}};return K3(e)}else return n instanceof rI?n:K3(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class oI extends Me{constructor(t){super(t??{}),this.supportsMasking=!0,t!=null&&(this.maxValue=t.maxValue)}call(t,e){t=we(t);let s=fi(t);return this.maxValue!=null&&(s=Os(s,0,this.maxValue)),s}computeOutputShape(t){return t}getConfig(){const t={maxValue:this.maxValue},e=super.getConfig();return Object.assign(t,e),t}}oI.className="ReLU";Vt(oI);class aI extends Me{constructor(t){super(t??{}),this.DEFAULT_ALPHA=.3,t==null&&(t={}),this.alpha=t.alpha==null?this.DEFAULT_ALPHA:t.alpha}call(t,e){const s=we(t);return qh(s,this.alpha)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},e=super.getConfig();return Object.assign(t,e),t}}aI.className="LeakyReLU";Vt(aI);class uI extends Me{constructor(t){if(super(t??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",t==null&&(t={}),this.supportsMasking=!0,this.alphaInitializer=vn(t.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=kn(t.alphaRegularizer),this.alphaConstraint=Kn(t.alphaConstraint),t.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(t.sharedAxes))this.sharedAxes=t.sharedAxes;else if(typeof t.sharedAxes=="number")this.sharedAxes=[t.sharedAxes];else throw new dt(`Expected sharedAxes to be a number or an array of numbers, but got ${t.sharedAxes}`)}build(t){t=Xe(t);const e=t.slice(1);if(this.sharedAxes!=null)for(const r of this.sharedAxes)e[r-1]=1;this.alpha=this.addWeight("alpha",e,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let r=1;r<t.length;++r)s[r]=t[r];this.inputSpec=[new jn({ndim:t.length,axes:s})],this.built=!0}call(t,e){return t=we(t),td(t,this.alpha.read())}getConfig(){const t={alphaInitializer:In(this.alphaInitializer),alphaRegularizer:cn(this.alphaRegularizer),alphaConstraint:Hn(this.alphaConstraint),sharedAxes:this.sharedAxes},e=super.getConfig();return Object.assign(t,e),t}}uI.className="PReLU";Vt(uI);class lI extends Me{constructor(t){if(super(t??{}),this.DEFAULT_ALPHA=1,t==null&&(t={}),t.alpha!=null&&t.alpha!==this.DEFAULT_ALPHA)throw new Oe(`Non-default alpha value (${t.alpha}) is not supported by the ELU layer yet.`);this.alpha=t.alpha==null?this.DEFAULT_ALPHA:t.alpha}call(t,e){const s=we(t);return Bl(s)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},e=super.getConfig();return Object.assign(t,e),t}}lI.className="ELU";Vt(lI);class cI extends Me{constructor(t){super(t??{}),this.DEFAULT_THETA=1,t==null&&(t={}),this.theta=t.theta==null?this.DEFAULT_THETA:t.theta}call(t,e){const s=we(t);return ut(s,Kt(Ms(s,this.theta),"float32"))}computeOutputShape(t){return t}getConfig(){const t={theta:this.theta},e=super.getConfig();return Object.assign(t,e),t}}cI.className="ThresholdedReLU";Vt(cI);class hI extends Me{constructor(t){super(t??{}),this.DEFAULT_AXIS=1,t==null&&(t={}),this.softmax=new Ny().apply,this.axis=t.axis==null?this.DEFAULT_AXIS:t.axis}call(t,e){const s=we(t);return this.softmax(s,this.axis)}computeOutputShape(t){return t}getConfig(){const t={axis:this.axis},e=super.getConfig();return Object.assign(t,e),t}}hI.className="Softmax";Vt(hI);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function $u(n,t,e){if(typeof n=="number")return Ka(n,t);if(n.length!==t)throw new dt(`The ${e} argument must be an integer or tuple of ${t} integers. Received: ${n.length} elements.`);for(let s=0;s<t;++s){const r=n[s];if(!nq(r))throw new dt(`The ${e} argument must be an integer or tuple of ${t} integers. Received: ${JSON.stringify(n)} including a non-integer number ${r}`)}return n}function oi(n,t,e,s,r=1){if(n==null)return n;const i=t+(t-1)*(r-1);let o;return e==="same"?o=n:o=n-i+1,Math.floor((o+s-1)/s)}function Ni(n,t,e,s){if(n==null)return null;if(s==="valid")n=n*t+qo([e-t,0]);else if(s==="same")n=n*t;else throw new dt(`Unsupport padding mode: ${s}.`);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ty(n,t){return pt(()=>(On(t),t==="channelsFirst"?Ue(n,[0,2,3,1]):n))}function dI(n,t){return pt(()=>(On(t),t==="channelsFirst"?Ue(n,[0,2,3,4,1]):n))}function xX(n,t,e,s=1,r="valid",i,o=1){return pt(()=>{if(i==null&&(i=ci()),On(i),n.shape.length!==3)throw new dt(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(t.shape.length!==3)throw new dt(`The kernel for a conv1dWithBias operation should be 3, but is ${t.shape.length} instead`);if(e!=null&&e.shape.length!==1)throw new dt(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if(i==="channelsFirst"&&(n=Ue(n,[0,2,1])),r==="causal")throw new Oe("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=Xp(n,t,s,r==="same"?"same":"valid","NWC",o);return e!=null&&(a=pi(a,e)),a})}function q3(n,t,e,s=[1,1],r="valid",i,o,a=null){return pt(()=>{if(i==null&&(i=ci()),On(i),n.rank!==3&&n.rank!==4)throw new dt(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(t.rank!==3&&t.rank!==4)throw new dt(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let u=Ty(n,i);if(r==="causal")throw new Oe("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=jw({x:u,filter:t,strides:s,pad:r==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:e,activation:a}),i==="channelsFirst"&&(u=Ue(u,[0,3,1,2])),u})}function wX(n,t,e,s=[1,1,1],r="valid",i,o){return pt(()=>{if(i==null&&(i=ci()),On(i),n.rank!==4&&n.rank!==5)throw new dt(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(t.rank!==4&&t.rank!==5)throw new dt(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let a=dI(n,i);if(r==="causal")throw new Oe("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=k0(a,t,s,r==="same"?"same":"valid","NDHWC",o),e!=null&&(a=pi(a,e)),i==="channelsFirst"&&(a=Ue(a,[0,4,1,2,3])),a})}class Zm extends Me{constructor(t,e){if(super(e),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",Zm.verifyArgs(e),this.rank=t,ns(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new Oe(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=$u(e.kernelSize,t,"kernelSize"),this.strides=$u(e.strides==null?1:e.strides,t,"strides"),this.padding=e.padding==null?"valid":e.padding,Er(this.padding),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,On(this.dataFormat),this.activation=Yo(e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.biasInitializer=vn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Kn(e.biasConstraint),this.biasRegularizer=kn(e.biasRegularizer),this.activityRegularizer=kn(e.activityRegularizer),this.dilationRate=$u(e.dilationRate==null?1:e.dilationRate,t,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new dt(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new dt(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new dt(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(t){if(Ci("kernelSize"in t,"required key 'kernelSize' not in config"),typeof t.kernelSize!="number"&&!fy(t.kernelSize,"number",1,3))throw new dt(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(t.kernelSize)}.`)}getConfig(){const t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Xo(this.activation),useBias:this.useBias,biasInitializer:In(this.biasInitializer),biasRegularizer:cn(this.biasRegularizer),activityRegularizer:cn(this.activityRegularizer),biasConstraint:Hn(this.biasConstraint)},e=super.getConfig();return Object.assign(t,e),t}}class Ql extends Zm{constructor(t,e){super(t,e),this.kernel=null,Ql.verifyArgs(e),this.filters=e.filters,ns(this.filters,"filters"),this.kernelInitializer=vn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Kn(e.kernelConstraint),this.kernelRegularizer=kn(e.kernelRegularizer)}build(t){t=Xe(t);const e=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[e]==null)throw new dt(`The channel dimension of the input should be defined. Found ${t[e]}`);const s=t[e],r=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[e]:s}}],this.built=!0}call(t,e){return pt(()=>{t=we(t);let s;const r=this.bias==null?null:this.bias.read(),i=cS(this.activation.getClassName());if(i!=null&&this.rank===2)s=q3(t,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate,i);else{if(this.rank===1)s=xX(t,this.kernel.read(),r,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=q3(t,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=wX(t,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new Oe("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(t){t=Xe(t);const e=[],s=this.dataFormat==="channelsLast"?t.slice(1,t.length-1):t.slice(2);for(let i=0;i<s.length;++i){const o=oi(s[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);e.push(o)}let r=[t[0]];return this.dataFormat==="channelsLast"?(r=r.concat(e),r.push(this.filters)):(r.push(this.filters),r=r.concat(e)),r}getConfig(){const t={filters:this.filters,kernelInitializer:In(this.kernelInitializer),kernelRegularizer:cn(this.kernelRegularizer),kernelConstraint:Hn(this.kernelConstraint)},e=super.getConfig();return Object.assign(t,e),t}static verifyArgs(t){if(!("filters"in t)||typeof t.filters!="number"||t.filters<1)throw new dt(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(t.filters)}`)}}class vd extends Ql{constructor(t){super(2,t),vd.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!fy(t.kernelSize,"number",1,2))throw new dt(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(t.kernelSize)}.`)}}vd.className="Conv2D";Vt(vd);class kd extends Ql{constructor(t){super(3,t),kd.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!(Array.isArray(t.kernelSize)&&(t.kernelSize.length===1||t.kernelSize.length===3)))throw new dt(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(t.kernelSize)}.`)}}kd.className="Conv3D";Vt(kd);class fI extends vd{constructor(t){if(super(t),this.inputSpec=[new jn({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new dt(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(t=Xe(t),t.length!==4)throw new dt("Input should have rank 4; Received input shape: "+JSON.stringify(t));const e=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[e]==null)throw new dt("The channel dimension of the inputs should be defined. Found `None`.");const s=t[e],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new jn({ndim:4,axes:{[e]:s}})],this.built=!0}call(t,e){return pt(()=>{let s=we(t);if(s.shape.length!==4)throw new dt(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,i=r[0];let o,a;this.dataFormat==="channelsFirst"?(o=2,a=3):(o=1,a=2);const u=r[o],l=r[a],c=this.kernelSize[0],h=this.kernelSize[1],d=this.strides[0],f=this.strides[1],p=Ni(u,d,c,this.padding),m=Ni(l,f,h,this.padding),g=[i,p,m,this.filters];this.dataFormat!=="channelsLast"&&(s=Ue(s,[0,2,3,1]));let y=Yp(s,this.kernel.read(),g,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(y=Ue(y,[0,3,1,2])),this.bias!=null&&(y=pi(y,this.bias.read(),this.dataFormat)),this.activation!=null&&(y=this.activation.apply(y)),y})}computeOutputShape(t){t=Xe(t);const e=t.slice();let s,r,i;this.dataFormat==="channelsFirst"?(s=1,r=2,i=3):(s=3,r=1,i=2);const o=this.kernelSize[0],a=this.kernelSize[1],u=this.strides[0],l=this.strides[1];return e[s]=this.filters,e[r]=Ni(e[r],u,o,this.padding),e[i]=Ni(e[i],l,a,this.padding),e}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}fI.className="Conv2DTranspose";Vt(fI);class pI extends kd{constructor(t){if(super(t),this.inputSpec=[new jn({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new dt(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(t=Xe(t),t.length!==5)throw new dt("Input should have rank 5; Received input shape: "+JSON.stringify(t));const e=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[e]==null)throw new dt("The channel dimension of the inputs should be defined. Found `None`.");const s=t[e],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new jn({ndim:5,axes:{[e]:s}})],this.built=!0}call(t,e){return pt(()=>{let s=we(t);if(s.shape.length!==5)throw new dt(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,i=r[0];let o,a,u;this.dataFormat==="channelsFirst"?(u=2,o=3,a=4):(u=1,o=2,a=3);const l=r[u],c=r[o],h=r[a],d=this.kernelSize[0],f=this.kernelSize[1],p=this.kernelSize[2],m=this.strides[0],g=this.strides[1],y=this.strides[2],b=Ni(l,m,d,this.padding),w=Ni(c,g,f,this.padding),v=Ni(h,y,p,this.padding),S=[i,b,w,v,this.filters];this.dataFormat!=="channelsLast"&&(s=Ue(s,[0,2,3,4,1]));let N=S0(s,this.kernel.read(),S,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(N=Ue(N,[0,4,1,2,3])),this.bias!==null&&(N=pi(N,this.bias.read(),this.dataFormat)),this.activation!==null&&(N=this.activation.apply(N)),N})}computeOutputShape(t){t=Xe(t);const e=t.slice();let s,r,i,o;this.dataFormat==="channelsFirst"?(s=1,r=2,i=3,o=4):(s=4,r=1,i=2,o=3);const a=this.kernelSize[0],u=this.kernelSize[1],l=this.kernelSize[2],c=this.strides[0],h=this.strides[1],d=this.strides[2];return e[s]=this.filters,e[r]=Ni(e[r],c,a,this.padding),e[i]=Ni(e[i],h,u,this.padding),e[o]=Ni(e[o],d,l,this.padding),e}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}pI.className="Conv3DTranspose";Vt(pI);class mI extends Ql{constructor(t,e){if(super(t,e),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,e.filters==null)throw new dt("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(e.kernelInitializer!=null||e.kernelRegularizer!=null||e.kernelConstraint!=null)throw new dt("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(e.padding!=null&&e.padding!=="same"&&e.padding!=="valid")throw new dt(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(e.padding)}`);this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=vn(e.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=kn(e.depthwiseRegularizer),this.depthwiseConstraint=Kn(e.depthwiseConstraint),this.pointwiseInitializer=vn(e.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=kn(e.pointwiseRegularizer),this.pointwiseConstraint=Kn(e.pointwiseConstraint)}build(t){if(t=Xe(t),t.length<this.rank+2)throw new dt(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(t)}`);const e=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[e]==null||t[e]<0)throw new dt(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(t[e])}`);const s=t[e],r=this.kernelSize.concat([s,this.depthMultiplier]),i=[];for(let a=0;a<this.rank;++a)i.push(1);i.push(s*this.depthMultiplier,this.filters);const o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new jn({ndim:this.rank+2,axes:{[e]:s}})],this.built=!0}call(t,e){return pt(()=>{t=we(t);let s;if(this.rank===1)throw new Oe("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(t=Ue(t,[0,2,3,1])),s=dm(t,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=pi(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=Ue(s,[0,3,1,2])),s})}getConfig(){const t=super.getConfig();return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=In(this.depthwiseInitializer),t.pointwiseInitializer=In(this.pointwiseInitializer),t.depthwiseRegularizer=cn(this.depthwiseRegularizer),t.pointwiseRegularizer=cn(this.pointwiseRegularizer),t.depthwiseConstraint=Hn(this.depthwiseConstraint),t.pointwiseConstraint=Hn(this.pointwiseConstraint),t}}mI.className="SeparableConv";class gI extends mI{constructor(t){super(2,t)}}gI.className="SeparableConv2D";Vt(gI);class Jm extends Ql{constructor(t){super(1,t),Jm.verifyArgs(t),this.inputSpec=[{ndim:3}]}getConfig(){const t=super.getConfig();return delete t.rank,delete t.dataFormat,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!fy(t.kernelSize,"number",1,1))throw new dt(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(t.kernelSize)}.`)}}Jm.className="Conv1D";Vt(Jm);class yI extends Me{constructor(t){super(t),typeof t.cropping=="number"?this.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:typeof t.cropping[0]=="number"?this.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:this.cropping=t.cropping,this.dataFormat=t.dataFormat===void 0?"channelsLast":t.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(t){return this.dataFormat==="channelsFirst"?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]}call(t,e){return pt(()=>{if(t=we(t),this.dataFormat==="channelsLast"){const s=Kd(t,this.cropping[0][0],t.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return Kd(s,this.cropping[1][0],t.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=Kd(t,this.cropping[0][0],t.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return Kd(s,this.cropping[1][0],t.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const t={cropping:this.cropping,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}yI.className="Cropping2D";Vt(yI);class bI extends Me{constructor(t){super(t),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=t.size==null?this.DEFAULT_SIZE:t.size,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,On(this.dataFormat),this.interpolation=t.interpolation==null?"nearest":t.interpolation,QK(this.interpolation)}computeOutputShape(t){if(this.dataFormat==="channelsFirst"){const e=t[2]==null?null:this.size[0]*t[2],s=t[3]==null?null:this.size[1]*t[3];return[t[0],t[1],e,s]}else{const e=t[1]==null?null:this.size[0]*t[1],s=t[2]==null?null:this.size[1]*t[2];return[t[0],e,s,t[3]]}}call(t,e){return pt(()=>{let s=we(t);const r=s.shape;if(this.dataFormat==="channelsFirst"){s=Ue(s,[0,2,3,1]);const i=this.size[0]*r[2],o=this.size[1]*r[3],a=this.interpolation==="nearest"?Bn.resizeNearestNeighbor(s,[i,o]):Bn.resizeBilinear(s,[i,o]);return Ue(a,[0,3,1,2])}else{const i=this.size[0]*r[1],o=this.size[1]*r[2];return this.interpolation==="nearest"?Bn.resizeNearestNeighbor(s,[i,o]):Bn.resizeBilinear(s,[i,o])}})}getConfig(){const t={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},e=super.getConfig();return Object.assign(t,e),t}}bI.className="UpSampling2D";Vt(bI);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function vX(n,t,e=[1,1],s="valid",r,i){return pt(()=>{r==null&&(r=ci()),On(r);let o=Ty(n,r);if(n.rank!==4)throw new dt(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(t.rank!==4)throw new dt(`depthwiseKernel is required to be 4-D, but is instead ${t.rank}-D`);return o=zl(o,t,e,s==="same"?"same":"valid","NHWC",i),r==="channelsFirst"&&(o=Ue(o,[0,3,1,2])),o})}class xI extends Zm{constructor(t){super(2,t),this.depthwiseKernel=null,this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=vn(t.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Kn(t.depthwiseConstraint),this.depthwiseRegularizer=kn(t.depthwiseRegularizer)}build(t){if(t=Xe(t),t.length<4)throw new dt(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(t)}.`);const e=this.dataFormat==="channelsFirst"?1:3;if(t[e]==null||t[e]<0)throw new dt(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${t[e]}).`);const s=t[e],r=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return pt(()=>{t=we(t);let s=vX(t,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=pi(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(t){t=Xe(t);const e=this.dataFormat==="channelsFirst"?t[2]:t[1],s=this.dataFormat==="channelsFirst"?t[3]:t[2],r=this.dataFormat==="channelsFirst"?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,i=oi(e,this.kernelSize[0],this.padding,this.strides[0]),o=oi(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[t[0],r,i,o]:[t[0],i,o,r]}getConfig(){const t=super.getConfig();return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=In(this.depthwiseInitializer),t.depthwiseRegularizer=cn(this.depthwiseRegularizer),t.depthwiseConstraint=Hn(this.depthwiseRegularizer),t}}xI.className="DepthwiseConv2D";Vt(xI);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function wI(n,t,e,s){if(Array.isArray(n)){if(t!=null||e!=null)throw new dt("When inputs is an array, neither initialState or constants should be provided");s!=null&&(e=n.slice(n.length-s,n.length),n=n.slice(0,n.length-s)),n.length>1&&(t=n.slice(1,n.length)),n=n[0]}function r(i){return i==null||Array.isArray(i)?i:[i]}return t=r(t),e=r(e),{inputs:n,initialState:t,constants:e}}function vI(n,t,e,s=!1,r,i,o=!1,a=!1){return pt(()=>{const u=t.shape.length;if(u<3)throw new dt(`Input should be at least 3D, but is ${u}D.`);const l=[1,0].concat(li(2,u));if(t=Ue(t,l),i!=null)throw new Oe("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r!=null&&(r=Kt(Kt(r,"bool"),"float32"),r.rank===u-1&&(r=gn(r,-1)),r=Ue(r,l)),s&&(t=Tr(t,0),r!=null&&(r=Tr(r,0)));const c=[];let h,d=e;const f=t.shape[0],p=$r(t);let m;r!=null&&(m=$r(r));for(let y=0;y<f;++y){const b=p[y],w=pt(()=>n(b,d));if(r==null)h=w[0],d=w[1];else{const v=pt(()=>{const S=m[y],N=oe(lr(S),S),R=Lt(ut(w[0],S),ut(d[0],N)),L=d.map((F,B)=>Lt(ut(w[1][B],S),ut(F,N)));return{output:R,newStates:L}});h=v.output,d=v.newStates}a&&c.push(h)}let g;return a&&(g=cr(c,1)),[h,g,d]})}class aa extends Me{constructor(t){super(t);let e;if(t.cell==null)throw new dt("cell property is missing for the constructor of RNN.");if(Array.isArray(t.cell)?e=new _y({cells:t.cell}):e=t.cell,e.stateSize==null)throw new dt("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=e,this.returnSequences=t.returnSequences==null?!1:t.returnSequences,this.returnState=t.returnState==null?!1:t.returnState,this.goBackwards=t.goBackwards==null?!1:t.goBackwards,this._stateful=t.stateful==null?!1:t.stateful,this.unroll=t.unroll==null?!1:t.unroll,this.supportsMasking=!0,this.inputSpec=[new jn({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return li(0,t).map(e=>null)}else return this.states_}setStates(t){this.states_=t}computeOutputShape(t){E1(t)&&(t=t[0]),t=t;let e=this.cell.stateSize;Array.isArray(e)||(e=[e]);const s=e[0];let r;if(this.returnSequences?r=[t[0],t[1],s]:r=[t[0],s],this.returnState){const i=[];for(const o of e)i.push([t[0],o]);return[r].concat(i)}else return r}computeMask(t,e){return pt(()=>{Array.isArray(e)&&(e=e[0]);const s=this.returnSequences?e:null;if(this.returnState){const r=this.states.map(i=>null);return[s].concat(r)}else return s})}get states(){if(this.states_==null){const t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,e=[];for(let s=0;s<t;++s)e.push(null);return e}else return this.states_}set states(t){this.states_=t}build(t){if(this.numConstants!=null)throw new Oe("Constants support is not implemented in RNN yet.");E1(t)&&(t=t[0]),t=t;const e=this.stateful?t[0]:null,s=t.slice(2);this.inputSpec[0]=new jn({shape:[e,null,...s]});const r=[t[0]].concat(t.slice(2));this.cell.build(r);let i;if(Array.isArray(this.cell.stateSize)?i=this.cell.stateSize:i=[this.cell.stateSize],this.stateSpec!=null){if(!Ve(this.stateSpec.map(o=>o.shape[o.shape.length-1]),i))throw new dt(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=i.map(o=>new jn({shape:[null,o]}));this.stateful&&this.resetStates()}resetStates(t,e=!1){pt(()=>{if(!this.stateful)throw new Ii("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new dt("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>Mn([s,r])):this.states_=[Mn([s,this.cell.stateSize])];else if(t==null)Se(this.states_),this.keptStates!=null&&(Se(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>Mn([s,r])):this.states_[0]=Mn([s,this.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new dt(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);e===!0?this.keptStates.push(this.states_.slice()):Se(this.states_);for(let r=0;r<this.states_.length;++r){const i=t[r],o=Array.isArray(this.cell.stateSize)?this.cell.stateSize[r]:this.cell.stateSize,a=[s,o];if(!Ve(i.shape,a))throw new dt(`State ${r} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${i.shape}`);this.states_[r]=i}}this.states_=this.states_.map(r=>es(r.clone()))})}apply(t,e){let s=e==null?null:e.initialState,r=e==null?null:e.constants;e==null&&(e={});const i=wI(t,s,r,this.numConstants);t=i.inputs,s=i.initialState,r=i.constants;let o=[],a=[];if(s!=null){e.initialState=s,o=o.concat(s),this.stateSpec=[];for(const l of s)this.stateSpec.push(new jn({shape:l.shape}));a=a.concat(this.stateSpec)}if(r!=null&&(e.constants=r,o=o.concat(r),this.numConstants=r.length),o[0]instanceof _i){const l=[t].concat(o),c=this.inputSpec.concat(a),h=this.inputSpec;this.inputSpec=c;const d=super.apply(l,e);return this.inputSpec=h,d}else return super.apply(t,e)}call(t,e){return pt(()=>{const s=e==null?null:e.mask,r=e==null?null:e.training;let i=e==null?null:e.initialState;t=we(t),i==null&&(this.stateful?i=this.states_:i=this.getInitialState(t));const o=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==o)throw new dt(`RNN Layer has ${o} state(s) but was passed ${i.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:r},l=vI((p,m)=>{const g=this.cell.call([p].concat(m),a);return[g[0],g.slice(1)]},t,i,this.goBackwards,s,null,this.unroll,this.returnSequences),c=l[0],h=l[1],d=l[2];this.stateful&&this.resetStates(d,r);const f=this.returnSequences?h:c;return this.returnState?[f].concat(d):f})}getInitialState(t){return pt(()=>{let e=Mn(t.shape);return e=he(e,[1,2]),e=gd(e),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?T1(e,[1,s]):e):this.cell.stateSize>1?[T1(e,[1,this.cell.stateSize])]:[e]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(t)}getConfig(){const t=super.getConfig(),e={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(e.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===aa.className&&(e.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),t),e)}static fromConfig(t,e,s={}){const r=e.cell,i=eo(r,s);return new t(Object.assign(e,{cell:i}))}}aa.className="RNN";Vt(aa);class Qm extends Me{}class $y extends Qm{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,ns(this.units,"units"),this.activation=Yo(t.activation==null?this.DEFAULT_ACTIVATION:t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=vn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=vn(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=vn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=kn(t.kernelRegularizer),this.recurrentRegularizer=kn(t.recurrentRegularizer),this.biasRegularizer=kn(t.biasRegularizer),this.kernelConstraint=Kn(t.kernelConstraint),this.recurrentConstraint=Kn(t.recurrentConstraint),this.biasConstraint=Kn(t.biasConstraint),this.dropout=Bu([1,qo([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=Bu([1,qo([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=Xe(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return pt(()=>{if(t=t,t.length!==2)throw new dt(`SimpleRNNCell expects 2 input Tensors, got ${t.length}.`);let s=t[1];t=t[0];const r=e.training==null?!1:e.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Zo({ones:()=>lr(t),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Zo({ones:()=>lr(s),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let i;const o=this.dropoutMask,a=this.recurrentDropoutMask;o!=null?i=Li(ut(t,o),this.kernel.read()):i=Li(t,this.kernel.read()),this.bias!=null&&(i=pi(i,this.bias.read())),a!=null&&(s=ut(s,a));let u=Lt(i,Li(s,this.recurrentKernel.read()));return this.activation!=null&&(u=this.activation.apply(u)),[u,u]})}getConfig(){const t=super.getConfig(),e={units:this.units,activation:Xo(this.activation),useBias:this.useBias,kernelInitializer:In(this.kernelInitializer),recurrentInitializer:In(this.recurrentInitializer),biasInitializer:In(this.biasInitializer),kernelRegularizer:cn(this.kernelRegularizer),recurrentRegularizer:cn(this.recurrentRegularizer),biasRegularizer:cn(this.biasRegularizer),activityRegularizer:cn(this.activityRegularizer),kernelConstraint:Hn(this.kernelConstraint),recurrentConstraint:Hn(this.recurrentConstraint),biasConstraint:Hn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},t),e)}}$y.className="SimpleRNNCell";Vt($y);class kI extends aa{constructor(t){t.cell=new $y(t),super(t)}call(t,e){return pt(()=>{this.cell.dropoutMask!=null&&(Se(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Se(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=e==null?null:e.mask,r=e==null?null:e.training,i=e==null?null:e.initialState;return super.call(t,{mask:s,training:r,initialState:i})})}static fromConfig(t,e){return new t(e)}}kI.className="SimpleRNN";Vt(kI);class Ey extends Qm{constructor(t){if(super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.resetAfter)throw new dt("GRUCell does not support reset_after parameter set to true.");this.units=t.units,ns(this.units,"units"),this.activation=Yo(t.activation===void 0?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=Yo(t.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=vn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=vn(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=vn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=kn(t.kernelRegularizer),this.recurrentRegularizer=kn(t.recurrentRegularizer),this.biasRegularizer=kn(t.biasRegularizer),this.kernelConstraint=Kn(t.kernelConstraint),this.recurrentConstraint=Kn(t.recurrentConstraint),this.biasConstraint=Kn(t.biasConstraint),this.dropout=Bu([1,qo([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=Bu([1,qo([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=Xe(t);const e=t[t.length-1];this.kernel=this.addWeight("kernel",[e,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return pt(()=>{if(t=t,t.length!==2)throw new dt(`GRUCell expects 2 input Tensors (inputs, h, c), got ${t.length}.`);const s=e.training==null?!1:e.training;let r=t[1];t=t[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Zo({ones:()=>lr(t),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Zo({ones:()=>lr(r),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,o=this.recurrentDropoutMask;let a,u,l;0<this.dropout&&this.dropout<1&&(t=ut(t,i[0]));let c=Li(t,this.kernel.read());this.useBias&&(c=pi(c,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=ut(r,o[0]));const h=this.recurrentKernel.read(),[d,f]=Ks(h,[2*this.units,this.units],h.rank-1),p=Li(r,d),[m,g,y]=Ks(c,3,c.rank-1),[b,w]=Ks(p,2,p.rank-1);a=this.recurrentActivation.apply(Lt(m,b)),u=this.recurrentActivation.apply(Lt(g,w));const v=Li(ut(u,r),f);l=this.activation.apply(Lt(y,v));const S=Lt(ut(a,r),ut(Lt(1,dn(a)),l));return[S,S]})}getConfig(){const t=super.getConfig(),e={units:this.units,activation:Xo(this.activation),recurrentActivation:Xo(this.recurrentActivation),useBias:this.useBias,kernelInitializer:In(this.kernelInitializer),recurrentInitializer:In(this.recurrentInitializer),biasInitializer:In(this.biasInitializer),kernelRegularizer:cn(this.kernelRegularizer),recurrentRegularizer:cn(this.recurrentRegularizer),biasRegularizer:cn(this.biasRegularizer),activityRegularizer:cn(this.activityRegularizer),kernelConstraint:Hn(this.kernelConstraint),recurrentConstraint:Hn(this.recurrentConstraint),biasConstraint:Hn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},t),e)}}Ey.className="GRUCell";Vt(Ey);class SI extends aa{constructor(t){t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new Ey(t),super(t)}call(t,e){return pt(()=>{this.cell.dropoutMask!=null&&(Se(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Se(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=e==null?null:e.mask,r=e==null?null:e.training,i=e==null?null:e.initialState;return super.call(t,{mask:s,training:r,initialState:i})})}static fromConfig(t,e){return e.implmentation===0&&(e.implementation=1),new t(e)}}SI.className="GRU";Vt(SI);class tg extends Qm{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,ns(this.units,"units"),this.activation=Yo(t.activation===void 0?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=Yo(t.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=vn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=vn(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=vn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=t.unitForgetBias,this.kernelRegularizer=kn(t.kernelRegularizer),this.recurrentRegularizer=kn(t.recurrentRegularizer),this.biasRegularizer=kn(t.biasRegularizer),this.kernelConstraint=Kn(t.kernelConstraint),this.recurrentConstraint=Kn(t.recurrentConstraint),this.biasConstraint=Kn(t.biasConstraint),this.dropout=Bu([1,qo([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=Bu([1,qo([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){var e;t=Xe(t);const s=t[t.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){const i=this.biasInitializer,o=this.units;r=new(e=class extends Kr{apply(u,l){const c=i.apply([o]),h=new my().apply([o]),d=i.apply([o*2]);return A3(A3(c,h),d)}},e.className="CustomInit",e)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(t,e){return pt(()=>{const s=e.training==null?!1:e.training;if(t=t,t.length!==3)throw new dt(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);let r=t[1];const i=t[2];t=t[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Zo({ones:()=>lr(t),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Zo({ones:()=>lr(r),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,a=this.recurrentDropoutMask;let u,l,c,h;0<this.dropout&&this.dropout<1&&(t=ut(t,o[0]));let d=Li(t,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=ut(r,a[0])),d=Lt(d,Li(r,this.recurrentKernel.read())),this.useBias&&(d=pi(d,this.bias.read()));const[f,p,m,g]=Ks(d,4,d.rank-1);u=this.recurrentActivation.apply(f),l=this.recurrentActivation.apply(p),c=Lt(ut(l,i),ut(u,this.activation.apply(m))),h=this.recurrentActivation.apply(g);const y=ut(h,this.activation.apply(c));return[y,y,c]})}getConfig(){const t=super.getConfig(),e={units:this.units,activation:Xo(this.activation),recurrentActivation:Xo(this.recurrentActivation),useBias:this.useBias,kernelInitializer:In(this.kernelInitializer),recurrentInitializer:In(this.recurrentInitializer),biasInitializer:In(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:cn(this.kernelRegularizer),recurrentRegularizer:cn(this.recurrentRegularizer),biasRegularizer:cn(this.biasRegularizer),activityRegularizer:cn(this.activityRegularizer),kernelConstraint:Hn(this.kernelConstraint),recurrentConstraint:Hn(this.recurrentConstraint),biasConstraint:Hn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},t),e)}}tg.className="LSTMCell";Vt(tg);class II extends aa{constructor(t){t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new tg(t),super(t)}call(t,e){return pt(()=>{this.cell.dropoutMask!=null&&(Se(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Se(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=e==null?null:e.mask,r=e==null?null:e.training,i=e==null?null:e.initialState;return super.call(t,{mask:s,training:r,initialState:i})})}static fromConfig(t,e){return e.implmentation===0&&(e.implementation=1),new t(e)}}II.className="LSTM";Vt(II);class _y extends Qm{constructor(t){super(t),this.cells=t.cells}get stateSize(){const t=[];for(const e of this.cells.slice().reverse())Array.isArray(e.stateSize)?t.push(...e.stateSize):t.push(e.stateSize);return t}call(t,e){return pt(()=>{t=t;let s=t.slice(1);const r=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?r.push(s.splice(0,a.stateSize.length)):r.push(s.splice(0,1));r.reverse();const i=[];let o;for(let a=0;a<this.cells.length;++a){const u=this.cells[a];s=r[a],a===0?o=[t[0]].concat(s):o=[o[0]].concat(s),o=u.call(o,e),i.push(o.slice(1))}s=[];for(const a of i.slice().reverse())s.push(...a);return[o[0]].concat(s)})}build(t){E1(t)&&(t=t[0]),t=t;let e;this.cells.forEach((s,r)=>{Ra(`RNNCell_${r}`,()=>{s.build(t),Array.isArray(s.stateSize)?e=s.stateSize[0]:e=s.stateSize,t=[t[0],e]})}),this.built=!0}getConfig(){const t=super.getConfig(),e=i=>({className:i.getClassName(),config:i.getConfig()}),r={cells:this.cells.map(e)};return Object.assign(Object.assign({},t),r)}static fromConfig(t,e,s={}){const r=[];for(const i of e.cells)r.push(eo(i,s));return new t({cells:r})}get trainableWeights(){if(!this.trainable)return[];const t=[];for(const e of this.cells)t.push(...e.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const e of this.cells)t.push(...e.nonTrainableWeights);if(!this.trainable){const e=[];for(const s of this.cells)e.push(...s.trainableWeights);return e.concat(t)}return t}getWeights(){const t=[];for(const e of this.cells)t.push(...e.weights);return _1(t)}setWeights(t){const e=[];for(const s of this.cells){const r=s.weights.length,i=t.splice(r);for(let o=0;o<s.weights.length;++o)e.push([s.weights[o],i[o]])}ky(e)}}_y.className="StackedRNNCells";Vt(_y);function Zo(n){const{ones:t,rate:e,training:s=!1,count:r=1,dropoutFunc:i}=n,o=()=>i!=null?i(t(),e):yS(t(),e),a=()=>bd(o,t,s);return!r||r<=1?es(a().clone()):Array(r).fill(void 0).map(a).map(l=>es(l.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var kX=globalThis&&globalThis.__rest||function(n,t){var e={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&t.indexOf(s)<0&&(e[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(e[s[r]]=n[s[r]]);return e};class CI extends aa{constructor(t){if(t.unroll)throw new Oe("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(t.cell))throw new Oe("It is not possible at the moment to stack convolutional cells.");super(t),this.inputSpec=[new jn({ndim:5})]}call(t,e){return pt(()=>{if(this.cell.dropoutMask!=null&&(Se(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Se(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),e&&e.constants)throw new dt("ConvRNN2D cell does not support constants");const s=e==null?null:e.mask,r=e==null?null:e.training,i=e==null?null:e.initialState;return super.call(t,{mask:s,training:r,initialState:i})})}computeOutputShape(t){let e=this.computeSingleOutputShape(t);return this.returnSequences||(e=[e[0],...e.slice(2)]),this.returnState&&(e=[e,...Array(2).fill([t[0],...e.slice(-3)])]),e}getInitialState(t){return pt(()=>{const{stateSize:e}=this.cell,s=t.shape,r=this.computeSingleOutputShape(s),i=[r[0],...r.slice(2)],o=Mn(i);return Array.isArray(e)?Array(e.length).fill(o):[o]})}resetStates(t,e=!1){pt(()=>{if(!this.stateful)throw new Ii("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,r=this.computeSingleOutputShape(s),i=[r[0],...r.slice(2)];if(s[0]==null)throw new dt("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Mn(i)):this.states_=[Mn(i)];else if(t==null)Se(this.states_),this.keptStates!=null&&(Se(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Mn(i)):this.states_[0]=Mn(i);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new dt(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);e?this.keptStates.push(this.states_.slice()):Se(this.states_);for(let a=0;a<this.states_.length;++a){const u=t[a],l=i;if(!Ve(u.shape,l))throw new dt(`State ${a} is incompatible with layer ${this.name}: expected shape=${l}, received shape=${u.shape}`);this.states_[a]=u}}this.states_=this.states_.map(a=>es(a.clone()))})}computeSingleOutputShape(t){const{dataFormat:e,filters:s,kernelSize:r,padding:i,strides:o,dilationRate:a}=this.cell,u=e==="channelsFirst",l=t[u?3:2],c=t[u?4:3],h=oi(l,r[0],i,o[0],a[0]),d=oi(c,r[1],i,o[1],a[1]);return[...t.slice(0,2),...u?[s,h,d]:[h,d,s]]}}CI.className="ConvRNN2D";class Ay extends tg{constructor(t){const{filters:e,kernelSize:s,strides:r,padding:i,dataFormat:o,dilationRate:a}=t;super(Object.assign(Object.assign({},t),{units:e})),this.filters=e,ns(this.filters,"filters"),this.kernelSize=$u(s,2,"kernelSize"),this.kernelSize.forEach(u=>ns(u,"kernelSize")),this.strides=$u(r||1,2,"strides"),this.strides.forEach(u=>ns(u,"strides")),this.padding=i||"valid",Er(this.padding),this.dataFormat=o||"channelsLast",On(this.dataFormat),this.dilationRate=$u(a||1,2,"dilationRate"),this.dilationRate.forEach(u=>ns(u,"dilationRate"))}build(t){var e;t=Xe(t);const s=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[s]==null)throw new dt(`The channel dimension of the input should be defined. Found ${t[s]}`);const r=t[s],i=4,o=this.kernelSize.concat([r,this.filters*i]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*i]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let u;if(this.unitForgetBias){const l=this.biasInitializer,c=this.filters;u=new(e=class extends Kr{apply(d,f){const p=l.apply([c]),m=or([c]),g=l.apply([c*2]);return py([p,m,g])}},e.className="CustomInit",e)}else u=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*i],null,u,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(t,e){return pt(()=>{if(t.length!==3)throw new dt(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);const s=e.training||!1,r=t[0],i=t[1],o=t[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Zo({ones:()=>lr(r),rate:this.dropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const u=this.dropoutMask,l=(It,et,st)=>!et||!et[st]?It:ut(et[st],It);let c=l(r,u,0),h=l(r,u,1),d=l(r,u,2),f=l(r,u,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Zo({ones:()=>lr(i),rate:this.recurrentDropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const p=this.recurrentDropoutMask;let m=l(i,p,0),g=l(i,p,1),y=l(i,p,2),b=l(i,p,3);const w=3,[v,S,N,R]=Ks(this.kernel.read(),a,w),[L,F,B,H]=this.useBias?Ks(this.bias.read(),a):[null,null,null,null];c=this.inputConv(c,v,L,this.padding),h=this.inputConv(h,S,F,this.padding),d=this.inputConv(d,N,B,this.padding),f=this.inputConv(f,R,H,this.padding);const[z,G,T,K]=Ks(this.recurrentKernel.read(),a,w);m=this.recurrentConv(m,z),g=this.recurrentConv(g,G),y=this.recurrentConv(y,T),b=this.recurrentConv(b,K);const ht=this.recurrentActivation.apply(Lt(c,m)),rt=this.recurrentActivation.apply(Lt(h,g)),gt=Lt(ut(rt,o),ut(ht,this.activation.apply(Lt(d,y)))),at=ut(this.recurrentActivation.apply(Lt(f,b)),this.activation.apply(gt));return[at,at,gt]})}getConfig(){const t=super.getConfig(),e=kX(t,["units"]),s={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},e),s)}inputConv(t,e,s,r){const i=ro(t,e,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?pi(i,s,this.dataFormat):i}recurrentConv(t,e){return ro(t,e,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}Ay.className="ConvLSTM2DCell";Vt(Ay);class NI extends CI{constructor(t){const e=new Ay(t);super(Object.assign(Object.assign({},t),{cell:e}))}static fromConfig(t,e){return new t(e)}}NI.className="ConvLSTM2D";Vt(NI);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Ry extends Me{constructor(t){super(t),this.rate=Math.max(Math.min(t.rate,1),0),this.noiseShape=t.noiseShape,this.seed=t.seed,this.supportsMasking=!0}getNoiseShape(t){if(this.noiseShape==null)return this.noiseShape;const e=t.shape,s=[];for(let r=0;r<this.noiseShape.length;++r)s.push(this.noiseShape[r]==null?e[r]:this.noiseShape[r]);return s}call(t,e){return pt(()=>{this.invokeCallHook(t,e);const s=we(t);if(0<this.rate&&this.rate<1){const r=e.training==null?!1:e.training,i=this.getNoiseShape(s);return bd(()=>yS(s,this.rate,i,this.seed),()=>s,r)}return t})}getConfig(){const t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},e=super.getConfig();return Object.assign(t,e),t}dispose(){return super.dispose()}}Ry.className="Dropout";Vt(Ry);class TI extends Ry{constructor(t){super(t),this.inputSpec=[{ndim:3}]}getNoiseShape(t){const e=t.shape;return[e[0],1,e[2]]}}TI.className="SpatialDropout1D";Vt(TI);class $I extends Me{constructor(t){if(super(t),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.batchInputShape==null&&t.inputShape==null&&t.inputDim!=null){let e=null;t.batchSize!=null&&(e=t.batchSize),this.batchInputShape=[e,t.inputDim]}this.units=t.units,ns(this.units,"units"),this.activation=Yo(t.activation),t.useBias!=null&&(this.useBias=t.useBias),this.kernelInitializer=vn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=vn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Kn(t.kernelConstraint),this.biasConstraint=Kn(t.biasConstraint),this.kernelRegularizer=kn(t.kernelRegularizer),this.biasRegularizer=kn(t.biasRegularizer),this.activityRegularizer=kn(t.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(t){t=Xe(t);const e=t[t.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[e,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:e}}],this.built=!0}computeOutputShape(t){t=Xe(t);const e=t.slice();return e[e.length-1]=this.units,e}call(t,e){return pt(()=>{this.invokeCallHook(t,e);const s=we(t),r=cS(this.activation.getClassName());let i;return r!=null?i=Li(s,this.kernel.read(),r,this.bias?this.bias.read():null):(i=Li(s,this.kernel.read()),this.bias!=null&&(i=pi(i,this.bias.read())),this.activation!=null&&(i=this.activation.apply(i))),i})}getConfig(){const t={units:this.units,activation:Xo(this.activation),useBias:this.useBias,kernelInitializer:In(this.kernelInitializer),biasInitializer:In(this.biasInitializer),kernelRegularizer:cn(this.kernelRegularizer),biasRegularizer:cn(this.biasRegularizer),activityRegularizer:cn(this.activityRegularizer),kernelConstraint:Hn(this.kernelConstraint),biasConstraint:Hn(this.biasConstraint)},e=super.getConfig();return Object.assign(t,e),t}}$I.className="Dense";Vt($I);class EI extends Me{constructor(t){t=t||{},super(t),this.inputSpec=[{minNDim:3}],this.dataFormat=t.dataFormat}computeOutputShape(t){t=Xe(t);for(const e of t.slice(1))if(e==null)throw new dt(`The shape of the input to "Flatten" is not fully defined (got ${t.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[t[0],zo(t,1)]}call(t,e){return pt(()=>{this.invokeCallHook(t,e);let s=we(t);if(this.dataFormat==="channelsFirst"&&s.rank>1){const r=[0];for(let i=2;i<s.rank;++i)r.push(i);r.push(1),s=Ue(s,r)}return iq(s)})}getConfig(){const t={};this.dataFormat!=null&&(t.dataFormat=this.dataFormat);const e=super.getConfig();return Object.assign(t,e),t}}EI.className="Flatten";Vt(EI);class _I extends Me{constructor(t){super(t),this.supportsMasking=!0,this.activation=Yo(t.activation)}call(t,e){return pt(()=>{this.invokeCallHook(t,e);const s=we(t);return this.activation.apply(s)})}getConfig(){const t={activation:Xo(this.activation)},e=super.getConfig();return Object.assign(t,e),t}}_I.className="Activation";Vt(_I);class AI extends Me{constructor(t){super(t),this.n=t.n,this.inputSpec=[{ndim:2}]}computeOutputShape(t){return[t[0],this.n,t[1]]}call(t,e){return pt(()=>(t=we(t),sq(t,this.n)))}getConfig(){const t={n:this.n},e=super.getConfig();return Object.assign(t,e),t}}AI.className="RepeatVector";Vt(AI);class RI extends Me{constructor(t){super(t),this.targetShape=t.targetShape;for(let e=0;e<this.targetShape.length;++e)this.isUnknown(this.targetShape[e])&&(this.targetShape[e]=null)}isUnknown(t){return t<0||t==null}fixUnknownDimension(t,e){const s="Total size of new array must be unchanged.",r=e.slice();let i=1,o=null;for(let u=0;u<r.length;++u){const l=r[u];if(this.isUnknown(l))if(o===null)o=u;else throw new dt("Can only specifiy one unknown dimension.");else i*=l}const a=zo(t);if(o!==null){if(i===0||a%i!==0)throw new dt(s);r[o]=a/i}else if(a!==i)throw new dt(s);return r}computeOutputShape(t){let e=!1;for(let s=0;s<t.length;++s)if(this.isUnknown(t[s])){e=!0;break}return e?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))}call(t,e){return pt(()=>{this.invokeCallHook(t,e);const s=we(t),r=s.shape,i=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return ct(s,i)})}getConfig(){const t={targetShape:this.targetShape},e=super.getConfig();return Object.assign(t,e),t}}RI.className="Reshape";Vt(RI);class DI extends Me{constructor(t){if(super(t),t.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${t.dims} instead.`);const e=li(1,t.dims.length+1);if(!Ve(t.dims.slice().sort(),e))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=t.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new jn({ndim:this.dims.length+1})]}computeOutputShape(t){t=Xe(t);const e=t.slice();return this.dims.forEach((s,r)=>{e[r+1]=t[s]}),e}call(t,e){return Ue(we(t),this.dimsIncludingBatch)}getConfig(){const t={dims:this.dims},e=super.getConfig();return Object.assign(t,e),t}}DI.className="Permute";Vt(DI);class OI extends Me{constructor(t){super(t??{}),this.supportsMasking=!0,t!=null?this.maskValue=t.maskValue==null?0:t.maskValue:this.maskValue=0}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={maskValue:this.maskValue};return Object.assign(e,t),e}computeMask(t,e){const s=we(t),r=-1;return Cc(Ba(s,this.maskValue),r)}call(t,e){return pt(()=>{this.invokeCallHook(t,e);const s=we(t),r=-1,i=!0,o=Cc(Ba(s,this.maskValue),r,i);return ut(s,Kt(o,s.dtype))})}}OI.className="Masking";Vt(OI);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class FI extends Me{constructor(t){if(super(t),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",t.batchInputShape==null&&t.inputShape==null){let e=null;t.batchSize!=null&&(e=t.batchSize),t.inputLength==null?this.batchInputShape=[e,null]:this.batchInputShape=[e].concat(mn(t.inputLength))}this.inputDim=t.inputDim,ns(this.inputDim,"inputDim"),this.outputDim=t.outputDim,ns(this.outputDim,"outputDim"),this.embeddingsInitializer=vn(t.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=kn(t.embeddingsRegularizer),this.activityRegularizer=kn(t.activityRegularizer),this.embeddingsConstraint=Kn(t.embeddingsConstraint),this.maskZero=t.maskZero,this.supportsMasking=t.maskZero,this.inputLength=t.inputLength}build(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(t){}computeMask(t,e){return pt(()=>this.maskZero?(t=we(t),Ba(t,je(t))):null)}computeOutputShape(t){if(t=Xe(t),this.inputLength==null)return[...t,this.outputDim];const e=mn(this.inputLength);if(e.length!==t.length-1)throw new dt(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);{let s=0;for(let r=0;r<e.length;++r){const i=e[r],o=t[r+1];if(i!=null&&o!=null&&i!==o)throw new dt(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);i==null&&(e[s]=o),s++}}return[t[0],...e,this.outputDim]}call(t,e){return pt(()=>{this.invokeCallHook(t,e);let s=we(t);s.dtype!=="int32"&&(s=Fi(s,"int32"));const r=gS(this.embeddings.read(),ct(s,[s.size]));return ct(r,Xe(this.computeOutputShape(s.shape)))})}getConfig(){const t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:In(this.embeddingsInitializer),embeddingsRegularizer:cn(this.embeddingsRegularizer),activityRegularizer:cn(this.activityRegularizer),embeddingsConstraint:Hn(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},e=super.getConfig();return Object.assign(t,e),t}}FI.className="Embedding";Vt(FI);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class hu extends Me{constructor(t){super(t||{}),this.supportsMasking=!0}mergeFunction(t){throw new Oe}computeElementwiseOpOutputShape(t,e){if(t==null||e==null)return null;if(t.length<e.length)return this.computeElementwiseOpOutputShape(e,t);if(e.length===0)return t;const s=t.slice(0,t.length-e.length);for(let r=0;r<e.length;++r){const i=t[t.length-e.length+r],o=e[r];if(i==null||o==null||i<0||o<0)s.push(null);else if(i===1)s.push(o);else if(o===1)s.push(i);else{if(i!==o)throw new dt("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(e));s.push(i)}}return s}build(t){if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[Xe(t)]),t=t,t.length<2)throw new dt(`A merge layer should be called on an Array of at least 2 inputs. Got ${t.length} input(s).`);let e=[];for(const i of t)i!=null&&i[0]!==null&&e.push(i[0]);if(e=Mo(e),e.length>1)throw new dt(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(t)}.`);let s=t[0]==null?null:t[0].slice(1);for(let i=1;i<t.length;++i){const o=t[i]==null?null:t[i].slice(1);s=this.computeElementwiseOpOutputShape(s,o)}const r=t.map(i=>i.length);t.indexOf(null)===-1&&Mo(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(t,e){return pt(()=>{if(t=t,this.reshapeRequired){const s=[],r=t.map(i=>i.rank);if(r.indexOf(null)===-1){const i=qo(r);for(let o of t){const a=o.rank;for(let u=0;u<i-a;++u)o=gd(o,1);s.push(o)}return this.mergeFunction(s)}else{let i=!1;for(const u of t){const l=u.rank;if(l==null){const c=u.shape,h=c[0],d=c.slice(1).concat([h]);let f=ct(u,[h].concat(zo(c.slice(1))));f=Ue(f,[1,0]),f=ct(f,d),s.push(f),i=!0}else if(l>1){const c=li(1,l).concat([0]);s.push(Ue(u,c)),i=!0}else s.push(u)}let o=this.mergeFunction(s);const a=o.rank;if(i){if(a==null){const u=o.shape,l=u.length,c=u[l-1],h=[c].concat(u.slice(0,u.length-1));o=ct(Ue(ct(o,[-1,c]),[1,0]),h)}else if(a>1){const u=[a-1].concat(li(0,a-1));o=Ue(o,u)}}return o}}else return this.mergeFunction(t)})}computeOutputShape(t){t=t;let e;t[0]==null?e=null:e=t[0].slice(1);for(let r=1;r<t.length;++r){const i=t[r]==null?null:t[r].slice(1);e=this.computeElementwiseOpOutputShape(e,i)}let s=[];for(const r of t)r!=null&&r[0]!==null&&s.push(r[0]);return s=Mo(s),s.length===1?e=s.concat(e):e=[null].concat(e),e}computeMask(t,e){return pt(()=>{if(e==null)return null;if(!Array.isArray(e))throw new dt("`mask` should be an Array");if(!Array.isArray(t))throw new dt("`inputs` should be an Array");if(e.length!==t.length)throw new dt(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${t.length} vs ${e.length})`);if(e.every(r=>r==null))return null;e=e.map(r=>r==null?r:gn(r,0));let s=e[0];for(let r=1;r<e.length-1;++r)s=ai(s,e[r]);return s})}}class LI extends hu{constructor(t){super(t)}mergeFunction(t){return pt(()=>{let e=t[0].clone();for(let s=1;s<t.length;++s)e=Lt(e,t[s]);return e})}}LI.className="Add";Vt(LI);class PI extends hu{constructor(t){super(t)}mergeFunction(t){return pt(()=>{let e=t[0].clone();for(let s=1;s<t.length;++s)e=ut(e,t[s]);return e})}}PI.className="Multiply";Vt(PI);class MI extends hu{constructor(t){super(t)}mergeFunction(t){return pt(()=>{let e=t[0].clone();for(let s=1;s<t.length;++s)e=Lt(e,t[s]);return ut(1/t.length,e)})}}MI.className="Average";Vt(MI);class zI extends hu{constructor(t){super(t)}mergeFunction(t){return pt(()=>{let e=t[0];for(let s=1;s<t.length;++s)e=Vi(e,t[s]);return e})}}zI.className="Maximum";Vt(zI);class BI extends hu{constructor(t){super(t)}mergeFunction(t){return pt(()=>{let e=t[0];for(let s=1;s<t.length;++s)e=jo(e,t[s]);return e})}}BI.className="Minimum";Vt(BI);class VI extends hu{constructor(t){super(t),this.DEFAULT_AXIS=-1,t==null&&(t={}),this.axis=t.axis==null?this.DEFAULT_AXIS:t.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){if(!(Array.isArray(t)&&Array.isArray(t[0]))||t.length===1)throw new dt("A `Concatenate` layer should be called on a list of at least 2 inputs");t=t;let e=!0;for(const r of t)if(r!=null){e=!1;break}if(e)return;const s=[];for(let r=0;r<t.length;++r){const i=t[r].slice();i.splice(this.axis,1);let o=!1;for(const a of s)if(Ve(a,i)){o=!0;break}o||s.push(i)}if(s.length>1)throw new dt("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}mergeFunction(t){return pt(()=>py(t,this.axis))}computeOutputShape(t){if(!(Array.isArray(t)&&Array.isArray(t[0])))throw new dt("A `Concatenate` layer should be called on a list of inputs.");const e=t,s=e[0].slice(),r=this.axis<0?s.length+this.axis:this.axis;for(const i of e.slice(1)){if(s[r]==null||i[r]==null){s[r]=null;break}s[r]+=i[r]}return s}computeMask(t,e){if(e==null)return null;if(!Array.isArray(e))throw new dt("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new dt("`inputs` should be an array for Concatenate");if(e.length!==t.length)throw new dt(`Mismatch in the length of mask (${e.length}) and the legnth of inputs (${t.length})`);return pt(()=>{let s=!0;if(e.forEach(o=>{if(o!=null){s=!1;return}}),s)return null;const r=[];for(let o=0;o<t.length;++o)e[o]==null?r.push(Kt(lr(t[o]),"bool")):e[o].rank<t[o].rank?r.push(gn(e[o],-1)):r.push(e[o]);const i=Cn(r,this.axis);return qp(i,-1,!1)})}getConfig(){const t={axis:this.axis},e=super.getConfig();return Object.assign(t,e),t}}VI.className="Concatenate";Vt(VI);function oc(n,t){for(;n<0;)n+=t;return n}function SX(n,t,e){if(n.shape.length>3||t.shape.length>3)throw new Oe("batchDot is not implemented for tensors of 4D or higher rank yet");if(V(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),V(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${t.shape.length}`),typeof e=="number"&&(e=[e,e]),n.dtype==="complex64"||t.dtype==="complex64")throw new Oe("batchDot is not implemented for complex64-type Tensors yet.");const s=n.shape.length,r=t.shape.length;e==null&&(e=[s-1,r-2]);const i=e;return pt(()=>{let o;if(s>r){o=s-r;const u=[];for(let l=0;l<o;++l)u.push(1);t=ct(t,t.shape.concat(u))}else if(r>s){o=r-s;const u=[];for(let l=0;l<o;++l)u.push(1);n=ct(n,n.shape.concat(u))}else o=0;let a;if(n.shape.length===2&&t.shape.length===2)i[0]===i[1]?a=he(ut(n,t),i[0]):a=he(ut(Ue(n,[1,0]),t),i[1]);else{const u=i[0]!==n.shape.length-1,l=i[1]===t.shape.length-1;a=De(n,t,u,l)}if(o>0){let u;s>r?u=s+r-3:u=s-1;const l=[];for(let c=u;c<u+o;++c)l.push(c);a=tn(a,l)}return a.shape.length===1&&(a=gn(a,1)),a})}class UI extends hu{constructor(t){super(t),this.axes=t.axes,this.normalize=t.normalize==null?!1:t.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){V(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const e=t[0],s=t[1];if(e.length>3||s.length>3)throw new Oe("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(e,s);if(e[r[0]]!==s[r[1]])throw new dt(`Dimension incompatibility: ${e[r[0]]} !== ${s[r[1]]}`)}mergeFunction(t){if(t.length!==2)throw new dt(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${t.length} input(s).`);let e=t[0],s=t[1],r;return Array.isArray(this.axes)?r=this.axes.map((i,o)=>oc(i,t[o].shape.length)):r=[oc(this.axes,e.shape.length),oc(this.axes,s.shape.length)],this.normalize&&(e=Ef(e,r[0]),s=Ef(s,r[1])),SX(e,s,r)}interpretAxes(t,e){let s;return Array.isArray(this.axes)?s=this.axes:s=[oc(this.axes,t.length),oc(this.axes,e.length)],s}computeOutputShape(t){V(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const e=t[0].slice(),s=t[1].slice();if(e.length>3||s.length>3)throw new Oe("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(e,s);e.splice(r[0],1),s.splice(r[1],1),s.splice(0,1);const i=e.concat(s);return i.length===1&&i.push(1),i}computeMask(t,e){return null}getConfig(){const t={axes:this.axes,normalize:this.normalize},e=super.getConfig();return Object.assign(t,e),t}}UI.className="Dot";Vt(UI);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class WI extends Me{constructor(t){super(t),this.supportsMasking=!0,this.stddev=t.stddev}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={stddev:this.stddev};return Object.assign(e,t),e}call(t,e){return pt(()=>{this.invokeCallHook(t,e);const s=we(t);return bd(()=>Lt(Km(s.shape,0,this.stddev),s),()=>s,e.training||!1)})}}WI.className="GaussianNoise";Vt(WI);class GI extends Me{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={rate:this.rate};return Object.assign(e,t),e}call(t,e){return pt(()=>{this.invokeCallHook(t,e);const s=we(t);return this.rate>0&&this.rate<1?bd(()=>{const i=Math.sqrt(this.rate/(1-this.rate));return ut(s,Km(s.shape,1,i))},()=>s,e.training||!1):s})}}GI.className="GaussianDropout";Vt(GI);class jI extends Me{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate,this.noiseShape=t.noiseShape}_getNoiseShape(t){return this.noiseShape||we(t).shape}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={rate:this.rate};return Object.assign(e,t),e}call(t,e){return pt(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(t);return bd(()=>{const i=we(t),o=1.6732632423543772,a=1.0507009873554805,u=-o*a;let l=go(sa(s),this.rate);l=Fi(l,"float32");const c=((1-this.rate)*(1+this.rate*u**2))**-.5,h=-c*u*this.rate,d=Lt(ut(i,l),ut(Lt(l,-1),u));return Lt(ut(d,c),h)},()=>we(t),e.training||!1)}return t})}}jI.className="AlphaDropout";Vt(jI);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Pc(n,t,e,s,r,i=.001){let o;if(n.rank===2)o=d0(n,t,e,s,r,i);else if(n.rank===3)o=f0(n,t,e,s,r,i);else if(n.rank===4)o=p0(n,t,e,s,r,i);else throw new Oe(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return o}function IX(n,t,e,s,r=.001){return pt(()=>{const i=Jh(n,s),o=i.mean,a=i.variance;return[Pc(n,o,a,e,t,r),o,a]})}function CX(n,t,e,s,r=.001){return pt(()=>{const i=Jh(n,s),o=i.mean,a=i.variance,u=[];for(const p of li(0,n.rank))s.indexOf(p)!==-1?u.push(1):u.push(n.shape[p]);const l=ct(o,u),c=ct(a,u),h=t==null?null:ct(t,u),d=e==null?null:ct(e,u);return[Pc(n,l,c,d,h,r),o,a]})}function NX(n,t,e,s,r=.001){return Ve(s.slice().sort(),li(0,n.rank-1))?IX(n,t,e,s,r):CX(n,t,e,s,r)}class HI extends Me{constructor(t){t==null&&(t={}),super(t),this.supportsMasking=!0,this.axis=t.axis==null?-1:t.axis,this.momentum=t.momentum==null?.99:t.momentum,this.epsilon=t.epsilon==null?.001:t.epsilon,this.center=t.center==null?!0:t.center,this.scale=t.scale==null?!0:t.scale,this.betaInitializer=vn(t.betaInitializer||"zeros"),this.gammaInitializer=vn(t.gammaInitializer||"ones"),this.movingMeanInitializer=vn(t.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=vn(t.movingVarianceInitializer||"ones"),this.betaConstraint=Kn(t.betaConstraint),this.gammaConstraint=Kn(t.gammaConstraint),this.betaRegularizer=kn(t.betaRegularizer),this.gammaRegularizer=kn(t.gammaRegularizer)}build(t){t=Xe(t);const e=this.axis>=0?this.axis:this.axis+t.length,s=t[e];if(s==null)throw new dt(`Axis ${e} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(t)}.`);this.inputSpec=[new jn({ndim:t.length,axes:{[e]:s}})];const r=[s];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(t,e){return pt(()=>{const s=e.training==null?!1:e.training,r=we(t),i=r.shape,o=i.length,a=li(0,o),u=this.axis>=0?this.axis:this.axis+o;a.splice(u,1);const l=Ka(1,o);l[u]=i[u];const c=a.slice();c.sort();const h=!Ve(c,li(0,o).slice(0,o-1)),d=()=>{if(h){const b=ct(this.movingMean.read(),l),w=ct(this.movingVariance.read(),l),v=this.center?ct(this.beta.read(),l):null,S=this.scale?ct(this.gamma.read(),l):null;return Pc(r,b,w,v,S,this.epsilon)}else return Pc(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return d();const[f,p,m]=NX(r,this.gamma.read(),this.beta.read(),a,this.epsilon),g=(b,w,v)=>{pt(()=>{const S=1-v,N=b.read(),R=ut(oe(N,w),S);b.write(oe(N,R))})};return(()=>{g(this.movingMean,p,this.momentum),g(this.movingVariance,m,this.momentum)})(),f})}getConfig(){const t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:In(this.betaInitializer),gammaInitializer:In(this.gammaInitializer),movingMeanInitializer:In(this.movingMeanInitializer),movingVarianceInitializer:In(this.movingVarianceInitializer),betaRegularizer:cn(this.betaRegularizer),gammaRegularizer:cn(this.gammaRegularizer),betaConstraint:Hn(this.betaConstraint),gammaConstraint:Hn(this.gammaConstraint)},e=super.getConfig();return Object.assign(t,e),t}}HI.className="BatchNormalization";Vt(HI);class KI extends Me{constructor(t){if(t==null&&(t={}),super(t),this.axis=t.axis==null?-1:t.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const e of this.axis)if(!Number.isInteger(e))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=t.epsilon==null?.001:t.epsilon,this.center=t.center==null?!0:t.center,this.scale=t.scale==null?!0:t.scale,this.betaInitializer=vn(t.betaInitializer||"zeros"),this.gammaInitializer=vn(t.gammaInitializer||"ones"),this.betaRegularizer=kn(t.betaRegularizer),this.gammaRegularizer=kn(t.gammaRegularizer),this.supportsMasking=!0}build(t){t=Xe(t);const e=t.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let i=0;i<this.axis.length;++i)this.axis[i]<0&&(this.axis[i]+=e);for(const i of this.axis)if(i<0||i>=e)throw new Error(`Invalid axis: ${i}`);if(this.axis.length!==Mo(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(i=>t[i]),r=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(t,e){const s=we(t),r=s.shape,i=r.length;return pt(()=>{let{mean:a,variance:u}=Jh(s,this.axis,!0);const l=Ka(1,i);for(const m of this.axis)l[m]=r[m];const c=m=>m!=null&&m.shape.length!==i?ct(m,l):m;let h=this.scale?c(this.gamma.read()):null,d=this.center?c(this.beta.read()):null;const f=[],p=[];for(let m=0;m<i;++m)this.axis.indexOf(m)!==-1?(f.push(r[m]),p.push(1)):(f.push(1),p.push(r[m]));return a=kr(a,f),u=kr(u,f),h!=null&&(h=kr(h,p)),d!=null&&(d=kr(d,p)),Pc(s,a,u,d,h,this.epsilon)})}getConfig(){const t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:In(this.betaInitializer),gammaInitializer:In(this.gammaInitializer),betaRegularizer:cn(this.betaRegularizer),gammaRegularizer:cn(this.gammaRegularizer)},e=super.getConfig();return Object.assign(t,e),t}}KI.className="LayerNormalization";Vt(KI);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function TX(n,t,e){return pt(()=>{if(n.rank!==4)throw new dt(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(t==null&&(t=[[1,1],[1,1]]),t.length!==2||t[0].length!==2||t[1].length!==2)throw new dt("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(e==null&&(e=ci()),e!=="channelsLast"&&e!=="channelsFirst")throw new dt(`Unknown data format: ${e}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return e==="channelsFirst"?s=[[0,0],[0,0],t[0],t[1]]:s=[[0,0],t[0],t[1],[0,0]],Ui(n,s)})}class qI extends Me{constructor(t){if(t==null&&(t={}),super(t),this.dataFormat=t.dataFormat==null?ci():t.dataFormat,t.padding==null)this.padding=[[1,1],[1,1]];else if(typeof t.padding=="number")this.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,t.padding.length!==2)throw new dt(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${t.padding.length} array.`);let e,s;if(typeof t.padding[0]=="number")e=[t.padding[0],t.padding[0]],s=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,t.padding[0].length!==2)throw new dt(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${t.padding[0].length} array.`);if(e=t.padding[0],t.padding[1].length!==2)throw new dt(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${t.padding[1].length} array.`);s=t.padding[1]}this.padding=[e,s]}this.inputSpec=[new jn({ndim:4})]}computeOutputShape(t){t=Xe(t);let e,s;return this.dataFormat==="channelsFirst"?(t[2]!=null&&t[2]>=0?e=t[2]+this.padding[0][0]+this.padding[0][1]:e=null,t[3]!=null&&t[3]>=0?s=t[3]+this.padding[1][0]+this.padding[1][1]:s=null,[t[0],t[1],e,s]):(t[1]!=null&&t[1]>=0?e=t[1]+this.padding[0][0]+this.padding[0][1]:e=null,t[2]!=null&&t[2]>=0?s=t[2]+this.padding[1][0]+this.padding[1][1]:s=null,[t[0],e,s,t[3]])}call(t,e){return pt(()=>TX(we(t),this.padding,this.dataFormat))}getConfig(){const t={padding:this.padding,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}qI.className="ZeroPadding2D";Vt(qI);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function eg(n,t,e,s,r,i){return pt(()=>{On(r),dS(i),Er(s),e==null&&(e=[1,1]),s==null&&(s="valid"),r==null&&(r=ci()),i==null&&(i="max"),n=Ty(n,r);let o;const a=s==="same"?"same":"valid";return i==="max"?o=Zh(n,t,e,a):o=Gh(n,t,e,a),r==="channelsFirst"&&(o=Ue(o,[0,3,1,2])),o})}function XI(n,t,e,s,r,i){return pt(()=>{On(r),dS(i),Er(s),e==null&&(e=[1,1,1]),s==null&&(s="valid"),r==null&&(r=ci()),i==null&&(i="max"),n=dI(n,r);let o;const a=s==="same"?"same":"valid";return i==="max"?o=M0(n,t,e,a):o=h0(n,t,e,a),r==="channelsFirst"&&(o=Ue(o,[0,4,1,2,3])),o})}class YI extends Me{constructor(t){if(t.poolSize==null&&(t.poolSize=2),super(t),typeof t.poolSize=="number")this.poolSize=[t.poolSize];else if(Array.isArray(t.poolSize)&&t.poolSize.length===1&&typeof t.poolSize[0]=="number")this.poolSize=t.poolSize;else throw new dt(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.poolSize)}`);if(ns(this.poolSize,"poolSize"),t.strides==null)this.strides=this.poolSize;else if(typeof t.strides=="number")this.strides=[t.strides];else if(Array.isArray(t.strides)&&t.strides.length===1&&typeof t.strides[0]=="number")this.strides=t.strides;else throw new dt(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.strides)}`);ns(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,Er(this.padding),this.inputSpec=[new jn({ndim:3})]}computeOutputShape(t){t=Xe(t);const e=oi(t[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],e,t[2]]}call(t,e){return pt(()=>{this.invokeCallHook(t,e),t=gd(we(t),2);const s=this.poolingFunction(we(t),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return tn(s,[2])})}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},e=super.getConfig();return Object.assign(t,e),t}}class ZI extends YI{constructor(t){super(t)}poolingFunction(t,e,s,r,i){return On(i),Er(r),eg(t,e,s,r,i,"max")}}ZI.className="MaxPooling1D";Vt(ZI);class JI extends YI{constructor(t){super(t)}poolingFunction(t,e,s,r,i){return On(i),Er(r),eg(t,e,s,r,i,"avg")}}JI.className="AveragePooling1D";Vt(JI);class QI extends Me{constructor(t){if(t.poolSize==null&&(t.poolSize=[2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],t.strides==null)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==2)throw new dt(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides];ns(this.poolSize,"poolSize"),ns(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,On(this.dataFormat),Er(this.padding),this.inputSpec=[new jn({ndim:4})]}computeOutputShape(t){t=Xe(t);let e=this.dataFormat==="channelsFirst"?t[2]:t[1],s=this.dataFormat==="channelsFirst"?t[3]:t[2];return e=oi(e,this.poolSize[0],this.padding,this.strides[0]),s=oi(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[t[0],t[1],e,s]:[t[0],e,s,t[3]]}call(t,e){return pt(()=>(this.invokeCallHook(t,e),this.poolingFunction(we(t),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class tC extends QI{constructor(t){super(t)}poolingFunction(t,e,s,r,i){return On(i),Er(r),eg(t,e,s,r,i,"max")}}tC.className="MaxPooling2D";Vt(tC);class eC extends QI{constructor(t){super(t)}poolingFunction(t,e,s,r,i){return On(i),Er(r),eg(t,e,s,r,i,"avg")}}eC.className="AveragePooling2D";Vt(eC);class nC extends Me{constructor(t){if(t.poolSize==null&&(t.poolSize=[2,2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],t.strides==null)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==3)throw new dt(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides,t.strides];ns(this.poolSize,"poolSize"),ns(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,On(this.dataFormat),Er(this.padding),this.inputSpec=[new jn({ndim:5})]}computeOutputShape(t){t=Xe(t);let e=this.dataFormat==="channelsFirst"?t[2]:t[1],s=this.dataFormat==="channelsFirst"?t[3]:t[2],r=this.dataFormat==="channelsFirst"?t[4]:t[3];return e=oi(e,this.poolSize[0],this.padding,this.strides[0]),s=oi(s,this.poolSize[1],this.padding,this.strides[1]),r=oi(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[t[0],t[1],e,s,r]:[t[0],e,s,r,t[4]]}call(t,e){return pt(()=>(this.invokeCallHook(t,e),this.poolingFunction(we(t),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class sC extends nC{constructor(t){super(t)}poolingFunction(t,e,s,r,i){return On(i),Er(r),XI(t,e,s,r,i,"max")}}sC.className="MaxPooling3D";Vt(sC);class rC extends nC{constructor(t){super(t)}poolingFunction(t,e,s,r,i){return On(i),Er(r),XI(t,e,s,r,i,"avg")}}rC.className="AveragePooling3D";Vt(rC);class iC extends Me{constructor(t){super(t),this.inputSpec=[new jn({ndim:3})]}computeOutputShape(t){return[t[0],t[2]]}call(t,e){throw new Oe}}class oC extends iC{constructor(t){super(t||{})}call(t,e){return pt(()=>{const s=we(t);return wn(s,1)})}}oC.className="GlobalAveragePooling1D";Vt(oC);class aC extends iC{constructor(t){super(t||{})}call(t,e){return pt(()=>{const s=we(t);return Nr(s,1)})}}aC.className="GlobalMaxPooling1D";Vt(aC);class uC extends Me{constructor(t){super(t),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,On(this.dataFormat),this.inputSpec=[new jn({ndim:4})]}computeOutputShape(t){return t=t,this.dataFormat==="channelsLast"?[t[0],t[3]]:[t[0],t[1]]}call(t,e){throw new Oe}getConfig(){const t={dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class lC extends uC{call(t,e){return pt(()=>{const s=we(t);return this.dataFormat==="channelsLast"?wn(s,[1,2]):wn(s,[2,3])})}}lC.className="GlobalAveragePooling2D";Vt(lC);class cC extends uC{call(t,e){return pt(()=>{const s=we(t);return this.dataFormat==="channelsLast"?Nr(s,[1,2]):Nr(s,[2,3])})}}cC.className="GlobalMaxPooling2D";Vt(cC);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class hC extends Me{constructor(t){super(t),this.layer=t.layer}build(t){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(t){this.layer!=null&&(this.layer.trainable=t)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(t){this.layer.setWeights(t)}getConfig(){const t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},e=super.getConfig();return Object.assign(t,e),t}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(t)}static fromConfig(t,e,s={}){const r=e.layer,i=eo(r,s);delete e.layer;const o={layer:i};return Object.assign(o,e),new t(o)}}class dC extends hC{constructor(t){super(t),this.supportsMasking=!0}build(t){if(t=Xe(t),t.length<3)throw new dt(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(t)}`);this.inputSpec=[{shape:t}];const e=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(e),this.layer.built=!0),super.build(t)}computeOutputShape(t){t=Xe(t);const e=[t[0]].concat(t.slice(2)),s=this.layer.computeOutputShape(e),r=t[1];return[s[0],r].concat(s.slice(1))}call(t,e){return pt(()=>(t=we(t),vI((o,a)=>[we(this.layer.call(o,e)),[]],t,[],!1,null,null,!1,!0)[1]))}}dC.className="TimeDistributed";Vt(dC);function $X(n){cu(JK,"BidirectionalMergeMode",n)}const EX="concat";class fC extends hC{constructor(t){super(t);const e=t.layer.getConfig(),s={};s.className=t.layer.getClassName(),s.config=e,this.forwardLayer=eo(s),e.goBackwards=e.goBackwards!==!0;const r={};if(r.className=t.layer.getClassName(),r.config=e,this.backwardLayer=eo(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=t.mergeMode===void 0?EX:t.mergeMode,$X(this.mergeMode),t.weights)throw new Oe("weights support is not implemented for Bidirectional layer yet.");this._stateful=t.layer.stateful,this.returnSequences=t.layer.returnSequences,this.returnState=t.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=t.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(t){this._trainable=t,this.forwardLayer!=null&&(this.forwardLayer.trainable=t),this.backwardLayer!=null&&(this.backwardLayer.trainable=t)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(t){const e=t.length,s=Math.floor(e/2);this.forwardLayer.setWeights(t.slice(0,s)),this.backwardLayer.setWeights(t.slice(s))}computeOutputShape(t){let e=this.forwardLayer.computeOutputShape(t);Array.isArray(e)&&Array.isArray(e[0])||(e=[e]),e=e;let s,r,i;return this.returnState&&(i=e.slice(1)),s=e[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,r=[s]):this.mergeMode==null?r=[s,s.slice()]:r=[s],this.returnState?this.mergeMode==null?r.concat(i).concat(i.slice()):[s].concat(i).concat(i.slice()):js(r)}apply(t,e){let s=e==null?null:e.initialState,r=e==null?null:e.constants;e==null&&(e={});const i=wI(t,s,r,this.numConstants);if(t=i.inputs,s=i.initialState,r=i.constants,Array.isArray(t)&&(s=t.slice(1),t=t[0]),(s==null||s.length===0)&&r==null)return super.apply(t,e);const o=[],a=[];if(s!=null){const l=s.length;if(l%2>0)throw new dt("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");e.initialState=s,o.push(...s);const c=s.map(h=>new jn({shape:h.shape}));this.forwardLayer.stateSpec=c.slice(0,l/2),this.backwardLayer.stateSpec=c.slice(l/2),a.push(...c)}if(r!=null)throw new Oe("Support for constants in Bidirectional layers is not implemented yet.");const u=o[0]instanceof _i;for(const l of o)if(l instanceof _i!==u)throw new dt("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(u){const l=[t].concat(o),c=this.inputSpec.concat(a),h=this.inputSpec;this.inputSpec=c;const d=super.apply(l,e);return this.inputSpec=h,d}else return super.apply(t,e)}call(t,e){return pt(()=>{const s=e.initialState;let r,i;if(s==null)r=this.forwardLayer.call(t,e),i=this.backwardLayer.call(t,e);else{const u=s.slice(0,s.length/2),l=s.slice(s.length/2);r=this.forwardLayer.call(t,Object.assign(e,{initialState:u})),i=this.backwardLayer.call(t,Object.assign(e,{initialState:l}))}let o;this.returnState&&(Array.isArray(r)&&(o=r.slice(1).concat(i.slice(1))),r=r[0],i=i[0]),this.returnSequences&&(i=Tr(i,1));let a;return this.mergeMode==="concat"?a=py([r,i]):this.mergeMode==="sum"?a=Lt(r,i):this.mergeMode==="ave"?a=ut(.5,Lt(r,i)):this.mergeMode==="mul"?a=ut(r,i):this.mergeMode==null&&(a=[r,i]),this.returnState?this.mergeMode==null?a.concat(o):[a].concat(o):a})}resetStates(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(t){Ra(this.forwardLayer.name,()=>{this.forwardLayer.build(t)}),Ra(this.backwardLayer.name,()=>{this.backwardLayer.build(t)}),this.built=!0}computeMask(t,e){Array.isArray(e)&&(e=e[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[e,e]:s=e:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const i=this.forwardLayer.states.map(o=>null);return Array.isArray(s)?s.concat(i).concat(i):[s].concat(i).concat(i)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(t),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(t)}getConfig(){const t={mergeMode:this.mergeMode},e=super.getConfig();return Object.assign(t,e),t}static fromConfig(t,e){const s=eo(e.layer);if(delete e.layer,e.numConstants!=null)throw new Oe("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=e;return r.layer=s,new t(r)}}fC.className="Bidirectional";Vt(fC);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class pC extends Me{constructor(t){super(t),this.scale=t.scale,t.offset?this.offset=t.offset:this.offset=0}getConfig(){const t={scale:this.scale,offset:this.offset},e=super.getConfig();return Object.assign(t,e),t}call(t,e){return pt(()=>(t=we(t),t.dtype!=="float32"&&(t=Fi(t,"float32")),Lt(ut(t,this.scale),this.offset)))}}pC.className="Rescaling";Vt(pC);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:_X,cropAndResize:AX}=Bn;class mC extends Me{constructor(t){super(t),this.height=t.height,this.width=t.width}centerCrop(t,e,s,r,i,o,a,u){return pt(()=>{let l,c=!1;const h=e/o,d=s/a,f=(r+e)/o,p=(i+s)/a,m=[h,d,f,p],g=[];t.rank===3?(c=!0,l=cr([t])):l=t;for(let S=0;S<l.shape[0];S++)g.push(m);const y=Cr(g,[g.length,4]),b=oo(0,g.length,1,"int32"),v=AX(l,y,b,[r,i],"nearest");return Fi(c?we($r(v)):v,u)})}upsize(t,e,s,r){return pt(()=>{const i=_X(t,[e,s]);return Fi(i,r)})}call(t,e){return pt(()=>{const s=we(t),r=s.dtype,i=s.shape,o=i[i.length-3],a=i[i.length-2];let u=0;o!==this.height&&(u=Math.floor((o-this.height)/2));let l=0;return a!==this.width&&(l=Math.floor((a-this.width)/2),l===0&&(l=1)),u>=0&&l>=0?this.centerCrop(s,u,l,this.height,this.width,o,a,r):this.upsize(t,this.height,this.width,r)})}getConfig(){const t={height:this.height,width:this.width},e=super.getConfig();return Object.assign(t,e),t}computeOutputShape(t){t=Xe(t);const e=t.length-3,s=t.length-2;return t[e]=this.height,t[s]=this.width,t}}mC.className="CenterCrop";Vt(mC);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function RX(n,t,e,s){let r=we(n);if(r.dtype!=="int32"&&(r=Fi(r,"int32")),t==="int")return r;const i=r.shape;if(r.rank===0&&(r=gn(r,-1)),t==="oneHot"&&r.shape[r.shape.length-1]!==1&&(r=gn(r,-1)),r.rank>2)throw new dt(`When outputMode is not int, maximum output rank is 2 Received outputMode ${t} and input shape ${i} which would result in output rank ${r.rank}.`);const o=["multiHot","oneHot"].includes(t),a=r;let u;if(typeof s<"u"&&t==="count"?u=df(a,s,e,o):u=df(a,[],e,o),t!=="tfIdf")return u;if(s)return ut(u,s);throw new dt("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class gC extends Me{constructor(t){super(t),this.numTokens=t.numTokens,t.outputMode?this.outputMode=t.outputMode:this.outputMode="multiHot"}getConfig(){const t={numTokens:this.numTokens,outputMode:this.outputMode},e=super.getConfig();return Object.assign(t,e),t}computeOutputShape(t){return t=Xe(t),t==null?[this.numTokens]:this.outputMode==="oneHot"&&t[t.length-1]!==1?(t.push(this.numTokens),t):(t[t.length-1]=this.numTokens,t)}call(t,e){return pt(()=>{t=we(t),t.dtype!=="int32"&&(t=Fi(t,"int32"));let s;if(typeof e.countWeights<"u"){if(this.outputMode!=="count")throw new dt(`countWeights is not used when outputMode !== count.
              Received countWeights=${e.countWeights}`);s=we(e.countWeights)}const r=Nr(t),i=Ru(t),o=Ms(this.numTokens,r).bufferSync().get(0),a=go(i,0).bufferSync().get(0);if(!(o&&a))throw new dt(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return RX(t,this.outputMode,this.numTokens,s)})}}gC.className="CategoryEncoding";Vt(gC);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const DX=["bilinear","nearest"],X3=new Set(DX);class yC extends Me{constructor(t){if(super(t),this.height=t.height,this.width=t.width,t.interpolation)if(X3.has(t.interpolation))this.interpolation=t.interpolation;else throw new dt(`Invalid interpolation parameter: ${t.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!t.cropToAspectRatio}computeOutputShape(t){t=Xe(t);const e=t[2];return[this.height,this.width,e]}getConfig(){const t={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},e=super.getConfig();return Object.assign(t,e),t}call(t,e){return pt(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return Bn.resizeBilinear(t,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Bn.resizeNearestNeighbor(t,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...X3]} are supported`)})}}yC.className="Resizing";Vt(yC);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class bC{constructor(t){this.seed=t}next(){if(this.seed!==void 0)return this.seed++}}bC.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class xC extends Me{constructor(t){super(t),this.randomGenerator=new bC(t.seed)}getConfig(){const t={seed:this.randomGenerator.seed},e=super.getConfig();return Object.assign(t,e),t}}xC.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const OX=["bilinear","nearest"],Y3=new Set(OX);class wC extends xC{constructor(t){super(t);const{factor:e,interpolation:s="bilinear"}=t;if(this.factor=e,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new dt(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new dt(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new dt(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if(Y3.has(s))this.interpolation=s;else throw new dt(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const t={factor:this.factor,interpolation:this.interpolation},e=super.getConfig();return Object.assign(t,e),t}computeOutputShape(t){t=Xe(t);const e=t[2];return[this.imgHeight,-1,e]}call(t,e){return pt(()=>{const s=we(t);this.imgHeight=s.shape[s.shape.length-3];const r=s.shape[s.shape.length-2];this.widthFactor=sa([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let i=this.widthFactor.dataSync()[0]*r;i=Math.round(i);const o=[this.imgHeight,i];switch(this.interpolation){case"bilinear":return Bn.resizeBilinear(t,o);case"nearest":return Bn.resizeNearestNeighbor(t,o);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...Y3]} are supported`)}})}}wC.className="RandomWidth";Vt(wC);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FX=vt();FX.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var Z3;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(Z3||(Z3={}));var J3;(function(n){(function(t){t[t.LEGACY=0]="LEGACY",t[t.V1=1]="V1",t[t.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(J3||(J3={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var Q3;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(Q3||(Q3={}));/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LX=vm;class ng extends Pf{nextDataId(){return ng.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new M1(this,xr())}write(t,e,s){this.firstUse&&(this.firstUse=!1,vt().get("IS_NODE")&&wr(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const r={id:this.nextDataId()};return this.data.set(r,{values:t,dtype:s,refCount:1}),r}makeTensorInfo(t,e,s){let r;if(e==="string"&&s!=null&&s.length>0&&$i(s[0])){const i=s.map(o=>Ai(o));r=this.write(i,t,e)}else r=this.write(s,t,e);return{dataId:r,shape:t,dtype:e}}refCount(t){return this.data.has(t)?this.data.get(t).refCount:0}incRef(t){const e=this.data.get(t);e.refCount++}decRef(t){if(this.data.has(t)){const e=this.data.get(t);e.refCount--}}move(t,e,s,r,i){this.data.set(t,{values:e,dtype:r,refCount:i})}numDataIds(){return this.data.numDataIds()}async read(t){return this.readSync(t)}readSync(t){const{dtype:e,complexTensorInfos:s}=this.data.get(t);if(e==="complex64"){const r=this.readSync(s.real.dataId),i=this.readSync(s.imag.dataId);return ao(r,i)}return mx(this.data.get(t).values,e)}bufferSync(t){const e=this.readSync(t.dataId);if(t.dtype==="string")try{const s=e.map(r=>no(r));return Fe(t.shape,t.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Fe(t.shape,t.dtype,e)}makeOutput(t,e,s){return xr().makeTensorFromTensorInfo(this.makeTensorInfo(e,s,t),this)}disposeData(t,e=!1){if(this.data.has(t)){if(this.data.get(t).refCount--,!e&&this.data.get(t).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(t);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(t)}return!0}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}async time(t){const e=$s();return t(),{kernelMs:$s()-e}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(t){de([t],"where");const e=this.readSync(t.dataId);return LX(t.shape,e)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}ng.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */t0("cpu",()=>new ng,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vC=rn(nl,n=>n>=0?n:Math.exp(n)-1),PX={kernelName:nl,backendName:"cpu",kernelFunc:vC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kC(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{alpha:i}=s;de([r],"leakyRelu");const o=Et(r.shape),a=e.data.get(r.dataId).values,u=ss("float32",o);for(let l=0;l<a.length;l++)u[l]=a[l]<0?i*a[l]:a[l];return e.makeTensorInfo(r.shape,"float32",u)}const MX={kernelName:oh,backendName:"cpu",kernelFunc:kC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zX=Dn((n,t)=>n<0?t*n:n);function SC(n){const{inputs:t,backend:e}=n,{x:s,alpha:r}=t;de([s,r],"prelu");const i=e.data.get(s.dataId).values,o=e.data.get(r.dataId).values,[a,u]=zX(s.shape,r.shape,i,o,"float32");return e.makeTensorInfo(u,"float32",a)}const BX={kernelName:Ch,backendName:"cpu",kernelFunc:SC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IC=rn(vl,n=>Math.max(0,n)),VX={kernelName:vl,backendName:"cpu",kernelFunc:IC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CC=rn(kl,n=>Math.min(Math.max(0,n),6)),UX={kernelName:kl,backendName:"cpu",kernelFunc:CC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Of(n,t,e,s,r){if(e==="linear")return Bi({inputs:{x:t},backend:n});if(e==="relu")return IC({inputs:{x:t},backend:n});if(e==="elu")return vC({inputs:{x:t},backend:n});if(e==="relu6")return CC({inputs:{x:t},backend:n});if(e==="prelu")return SC({inputs:{x:t,alpha:s},backend:n});if(e==="leakyrelu")return kC({inputs:{x:t},backend:n,attrs:{alpha:r}});if(e==="sigmoid")return P4({inputs:{x:t},backend:n});throw new Error(`Activation ${e} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fn(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{shape:i}=s,o=Et(r.shape),a=B1(i,o),u=Et(a);V(o===u,()=>`The new shape (${a}) has ${u} elements and the old shape (${r.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`),e.incRef(r.dataId);const l=e.data.get(r.dataId);if(l.complexTensorInfos!=null){const c=l.complexTensorInfos.real,h=l.complexTensorInfos.imag;c.shape=a,h.shape=a}return{dataId:r.dataId,shape:a,dtype:r.dtype}}const WX={kernelName:Th,backendName:"cpu",kernelFunc:fn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NC(n){const{inputs:t,backend:e,attrs:s}=n,{a:r,b:i}=t,{transposeA:o,transposeB:a}=s;de([r,i],"matMul");const u=r.shape.length,l=i.shape.length,c=o?r.shape[u-2]:r.shape[u-1],h=a?i.shape[l-1]:i.shape[l-2],d=o?r.shape[u-1]:r.shape[u-2],f=a?i.shape[l-2]:i.shape[l-1],p=r.shape.slice(0,-2),m=i.shape.slice(0,-2),g=Et(p),y=Et(m),w=Ee(r.shape.slice(0,-2),i.shape.slice(0,-2)).concat([d,f]);V(c===h,()=>`Error in matMul: inner shapes (${c}) and (${h}) of Tensors with shapes ${r.shape} and ${i.shape} and transposeA=${o} and transposeB=${a} must match.`);const v=o?[g,c,d]:[g,d,c],S=a?[y,f,h]:[y,h,f],N=fn({inputs:{x:r},backend:e,attrs:{shape:v}}),R=fn({inputs:{x:i},backend:e,attrs:{shape:S}}),L=o?N.shape[1]:N.shape[2],F=o?N.shape[2]:N.shape[1],B=a?R.shape[1]:R.shape[2],H=Math.max(g,y),z=e.data.get(N.dataId).values,G=e.data.get(R.dataId).values,T=ge(N.shape),K=ge(R.shape),[ht,rt,gt]=o?[T[0],1,T[1]]:[T[0],T[1],1],[at,It,et]=a?[1,K[1],K[0]]:[K[1],1,K[0]],st=F*B,St=Fe([H,F,B],N.dtype),kt=St.values,yt=e.blockSize;for(let Pt=0;Pt<H;Pt++){const Xt=Pt%g,Wt=Pt%y;for(let Bt=0;Bt<F;Bt+=yt){const Jt=Math.min(Bt+yt,F);for(let jt=0;jt<B;jt+=yt){const be=Math.min(jt+yt,B);for(let ce=0;ce<L;ce+=yt){const O=Math.min(ce+yt,L);for(let Nt=Bt;Nt<Jt;Nt++)for(let xt=jt;xt<be;xt++){let q=0;for(let j=ce;j<O;j++){const ft=z[Xt*ht+Nt*rt+j*gt],At=G[j*at+xt*It+Wt*et];q+=ft*At}kt[Pt*st+(Nt*B+xt)]+=q}}}}}return e.disposeIntermediateTensorInfo(N),e.disposeIntermediateTensorInfo(R),e.makeTensorInfo(w,St.dtype,St.values)}const GX={kernelName:Gc,backendName:"cpu",kernelFunc:NC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jX(n){const{inputs:t,backend:e,attrs:s}=n,{a:r,b:i,bias:o,preluActivationWeights:a}=t,{transposeA:u,transposeB:l,activation:c,leakyreluAlpha:h}=s;let d,f,p;const m=[];d=NC({inputs:{a:r,b:i},attrs:{transposeA:u,transposeB:l},backend:e}),o&&(f=zu({inputs:{a:d,b:o},backend:e}),m.push(d),d=f),c&&(p=Of(e,d,c,a,h),m.push(d),d=p);for(const y of m)e.disposeIntermediateTensorInfo(y);return d}const HX={kernelName:bc,backendName:"cpu",kernelFunc:jX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KX=rn(Wu,n=>Math.acos(n)),qX={kernelName:Wu,backendName:"cpu",kernelFunc:KX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XX=rn(Gu,n=>Math.acosh(n)),YX={kernelName:Gu,backendName:"cpu",kernelFunc:XX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZX(n){const{inputs:t,backend:e}=n,s=t;de(t,"addN");const r=s.map(a=>e.data.get(a.dataId).values),i=Fe(s[0].shape,s[0].dtype),o=i.values;for(let a=0;a<s.length;a++){const u=r[a];for(let l=0;l<o.length;l++)o[l]+=u[l]}return e.makeTensorInfo(i.shape,i.dtype,i.values)}const JX={kernelName:zc,backendName:"cpu",kernelFunc:ZX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QX(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i,keepDims:o}=s;de(r,"all");const a=Pe(i,r.shape);let u=a;const l=Tn(u,r.shape.length);let c=r;l!=null&&(c=Ys({inputs:{x:r},backend:e,attrs:{perm:l}}),u=Rn(u.length,r.shape.length)),fs("all",u,c.shape.length);const[h,d]=is(c.shape,u),f=Et(d),p=ls(Et(h),c.dtype),m=e.data.get(c.dataId).values;for(let y=0;y<p.length;++y){const b=y*f;let w=m[b];for(let v=0;v<f;++v){const S=m[b+v];w=w&&S}p[y]=w}l!=null&&e.disposeIntermediateTensorInfo(c);const g=e.makeTensorInfo(h,c.dtype,p);if(o){const y=An(h,a),b=fn({inputs:{x:g},backend:e,attrs:{shape:y}});return e.disposeIntermediateTensorInfo(g),b}return g}const tY={kernelName:Bf,backendName:"cpu",kernelFunc:QX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eY(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i,keepDims:o}=s;de(r,"any");const a=Pe(i,r.shape);let u=a;const l=Tn(u,r.shape.length);let c=r;l!=null&&(c=Ys({inputs:{x:r},backend:e,attrs:{perm:l}}),u=Rn(u.length,r.shape.length)),fs("any",u,c.shape.length);const[h,d]=is(c.shape,u),f=Et(d),p=ls(Et(h),c.dtype),m=e.data.get(c.dataId).values;for(let y=0;y<p.length;++y){const b=y*f;let w=m[b];for(let v=0;v<f;++v){const S=m[b+v];w=w||S}p[y]=w}l!=null&&e.disposeIntermediateTensorInfo(c);const g=e.makeTensorInfo(h,c.dtype,p);if(o){const y=An(h,a),b=fn({inputs:{x:g},backend:e,attrs:{shape:y}});return e.disposeIntermediateTensorInfo(g),b}return g}const nY={kernelName:Vf,backendName:"cpu",kernelFunc:eY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sY(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i}=s;de(r,"argMax");let o=Pe(i,r.shape);const a=Tn(o,r.shape.length);let u=r;const l=[];a!=null&&(u=Ys({inputs:{x:r},backend:e,attrs:{perm:a}}),l.push(u),o=Rn(o.length,u.shape.length)),o=[o[0]],fs("argMax",o,u.shape.length);const[c,h]=is(u.shape,o),d=Et(c),f=ls(d,"int32"),p=Et(h),m=e.data.get(u.dataId).values;for(let g=0;g<f.length;++g){const y=g*p;let b=m[y],w=0;for(let v=0;v<p;++v){const S=m[y+v];S>b&&(b=S,w=v)}f[g]=w}return l.forEach(g=>e.disposeIntermediateTensorInfo(g)),e.makeTensorInfo(c,"int32",f)}const rY={kernelName:Bc,backendName:"cpu",kernelFunc:sY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iY(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i}=s;de(r,"argMin");let o=Pe(i,r.shape);const a=Tn(o,r.shape.length);let u=r;const l=[];a!=null&&(u=Ys({inputs:{x:r},backend:e,attrs:{perm:a}}),l.push(u),o=Rn(o.length,u.shape.length)),o=[o[0]],fs("argMin",o,u.shape.length);const[c,h]=is(u.shape,o),d=Et(c),f=ls(d,"int32"),p=Et(h),m=e.data.get(u.dataId).values;for(let g=0;g<f.length;++g){const y=g*p;let b=m[y],w=0;for(let v=0;v<p;++v){const S=m[y+v];S<b&&(b=S,w=v)}f[g]=w}return l.forEach(g=>e.disposeIntermediateTensorInfo(g)),e.makeTensorInfo(c,"int32",f)}const oY={kernelName:Vc,backendName:"cpu",kernelFunc:iY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aY=rn(ju,n=>Math.asin(n)),uY={kernelName:ju,backendName:"cpu",kernelFunc:aY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lY=rn(Hu,n=>Math.asinh(n)),cY={kernelName:Hu,backendName:"cpu",kernelFunc:lY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hY=rn(Ku,n=>Math.atan(n)),dY={kernelName:Ku,backendName:"cpu",kernelFunc:hY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fY=Dn((n,t)=>Math.atan2(n,t)),pY=qn(Xu,fY),mY={kernelName:Xu,backendName:"cpu",kernelFunc:pY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gY=rn(qu,n=>Math.atanh(n)),yY={kernelName:qu,backendName:"cpu",kernelFunc:gY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dy(n,t,e,s,r,i){const o=r.strideHeight,a=r.strideWidth,u=r.dilationHeight,l=r.dilationWidth,c=r.effectiveFilterHeight,h=r.effectiveFilterWidth,d=r.padInfo.top,f=r.padInfo.left,p=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=Fe(r.outShape,e),g=m.values,y=r.outShape[1]*r.outShape[2]*r.outShape[3],b=r.outShape[2]*r.outShape[3],w=r.outShape[3];for(let v=0;v<r.batchSize;++v){const S=v*y,N=v*s[0];for(let R=0;R<r.inChannels;++R)for(let L=0;L<r.outHeight;++L){const F=L*o-d,B=Math.max(0,F),H=Math.min(r.inHeight,c+F),z=S+L*b;for(let G=0;G<r.outWidth;++G){const T=G*a-f,K=Math.max(0,T),ht=Math.min(r.inWidth,h+T);let rt=p,gt=0,at=0;for(let et=B;et<H;et+=u){const st=N+et*s[1];for(let St=K;St<ht;St+=l){const kt=st+St*s[2],yt=n[kt+R];i==="max"&&yt>rt?rt=yt:i==="avg"&&(gt+=yt,at++)}if(isNaN(rt))break}const It=z+G*w+R;g[It]=i==="avg"?gt/at:rt}}}return m}function TC(n,t,e,s,r=!1,i=!1){const o=Fe(s.outShape,"int32"),a=s.strideHeight,u=s.strideWidth,l=s.dilationHeight,c=s.dilationWidth,h=s.effectiveFilterHeight,d=s.effectiveFilterWidth,f=s.padInfo.top,p=s.padInfo.left,m=Fe(t,e,n);for(let g=0;g<s.batchSize;++g)for(let y=0;y<s.inChannels;++y)for(let b=0;b<s.outHeight;++b){const w=b*a-f;let v=w;for(;v<0;)v+=l;const S=Math.min(s.inHeight,h+w);for(let N=0;N<s.outWidth;++N){const R=N*u-p;let L=R;for(;L<0;)L+=c;const F=Math.min(s.inWidth,d+R);let B=Number.NEGATIVE_INFINITY,H=-1;for(let z=v;z<S;z+=l){const G=z-w;for(let T=L;T<F;T+=c){const K=T-R,ht=m.get(g,z,T,y);ht>B&&(B=ht,r?H=i?((g*s.inHeight+z)*s.inWidth+T)*s.inChannels+y:(z*s.inWidth+T)*s.inChannels+y:H=G*d+K)}}o.set(H,g,b,N,y)}}return o}function $C(n,t,e,s,r,i){const o=r.strideDepth,a=r.strideHeight,u=r.strideWidth,l=r.dilationDepth,c=r.dilationHeight,h=r.dilationWidth,d=r.effectiveFilterDepth,f=r.effectiveFilterHeight,p=r.effectiveFilterWidth,m=r.padInfo.front,g=r.padInfo.top,y=r.padInfo.left,b=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,w=Fe(r.outShape,e),v=w.values,S=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],N=r.outShape[2]*r.outShape[3]*r.outShape[4],R=r.outShape[3]*r.outShape[4],L=r.outShape[4];for(let F=0;F<r.batchSize;++F){const B=F*S,H=F*s[0];for(let z=0;z<r.inChannels;++z)for(let G=0;G<r.outDepth;++G){const T=G*o-m;let K=T;for(;K<0;)K+=l;const ht=Math.min(r.inDepth,d+T),rt=B+G*N;for(let gt=0;gt<r.outHeight;++gt){const at=gt*a-g;let It=at;for(;It<0;)It+=c;const et=Math.min(r.inHeight,f+at),st=rt+gt*R;for(let St=0;St<r.outWidth;++St){const kt=St*u-y;let yt=kt;for(;yt<0;)yt+=h;const Pt=Math.min(r.inWidth,p+kt),Xt=st+St*L;let Wt=b,Bt=0,Jt=0;for(let be=K;be<ht;be+=l){const ce=H+be*s[1];for(let O=It;O<et;O+=c){const Nt=ce+O*s[2];for(let xt=yt;xt<Pt;xt+=h){const q=Nt+xt*s[3],j=n[q+z];if(i==="max"&&j>Wt?Wt=j:i==="avg"&&(Bt+=j,Jt++),isNaN(Wt))break}if(isNaN(Wt))break}if(isNaN(Wt))break}const jt=Xt+z;v[jt]=i==="avg"?Bt/Math.max(Jt,1):Wt}}}}return w}function bY(n,t){const e=Fe(t.outShape,"int32"),s=t.strideDepth,r=t.strideHeight,i=t.strideWidth,o=t.dilationDepth,a=t.dilationHeight,u=t.dilationWidth,l=t.effectiveFilterDepth,c=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=t.padInfo.front,f=t.padInfo.top,p=t.padInfo.left;for(let m=0;m<t.batchSize;++m)for(let g=0;g<t.inChannels;++g)for(let y=0;y<t.outDepth;++y){const b=y*s-d;let w=b;for(;w<0;)w+=o;const v=Math.min(t.inDepth,l+b);for(let S=0;S<t.outHeight;++S){const N=S*r-f;let R=N;for(;R<0;)R+=a;const L=Math.min(t.inHeight,c+N);for(let F=0;F<t.outWidth;++F){const B=F*i-p;let H=B;for(;H<0;)H+=u;const z=Math.min(t.inWidth,h+B);let G=Number.NEGATIVE_INFINITY,T=-1;for(let K=w;K<v;K+=o){const ht=K-b;for(let rt=R;rt<L;rt+=a){const gt=rt-N;for(let at=H;at<z;at+=u){const It=at-B,et=n.get(m,K,rt,at,g);et>=G&&(G=et,T=ht*c*h+gt*c+It)}}}e.set(T,m,y,S,F,g)}}}return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xY(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t;de(r,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:u}=s,l=1;V(ds(o,l),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${l}'`);const c=jr(r.shape,i,o,l,a,u);let h;if(c.filterWidth===1&&c.filterHeight===1&&Ve(c.inShape,c.outShape))h=Bi({inputs:{x:r},backend:e});else{const d=e.data.get(r.dataId).values,f=ge(r.shape),p=Dy(d,r.shape,r.dtype,f,c,"avg");h=e.makeTensorInfo(c.outShape,r.dtype,p.values)}return h}const wY={kernelName:Uc,backendName:"cpu",kernelFunc:xY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vY(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{filterSize:i,strides:o,pad:a,dimRoundingMode:u,dataFormat:l}=s;de(r,"avgPool3d");const c=po(r.shape,i,o,1,a,u,l),h=e.data.get(r.dataId).values,d=$C(h,r.shape,r.dtype,ge(r.shape),c,"avg");return e.makeTensorInfo(d.shape,"float32",d.values)}const kY={kernelName:Wc,backendName:"cpu",kernelFunc:vY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SY(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,input:i}=t,{filterSize:o,strides:a,pad:u,dimRoundingMode:l}=s;de([r,i],"avgPool3DGrad");const c=po(i.shape,o,a,1,u,l),h=c.strideDepth,d=c.strideHeight,f=c.strideWidth,p=c.filterDepth,m=c.filterHeight,g=c.filterWidth,y=c.dilationDepth,b=c.dilationHeight,w=c.dilationWidth,v=c.effectiveFilterDepth,S=c.effectiveFilterHeight,N=c.effectiveFilterWidth,R=v-1-c.padInfo.front,L=N-1-c.padInfo.left,F=S-1-c.padInfo.top,B=Fe(i.shape,"float32"),H=1/(p*m*g),z=e.bufferSync(r);for(let G=0;G<c.batchSize;++G)for(let T=0;T<c.inChannels;++T)for(let K=0;K<c.inDepth;++K)for(let ht=0;ht<c.inHeight;++ht)for(let rt=0;rt<c.inWidth;++rt){const gt=K-R,at=ht-F,It=rt-L;let et=0;for(let st=0;st<v;st+=y){const St=(gt+st)/h;if(!(St<0||St>=c.outDepth||Math.floor(St)!==St))for(let kt=0;kt<S;kt+=b){const yt=(at+kt)/d;if(!(yt<0||yt>=c.outHeight||Math.floor(yt)!==yt))for(let Pt=0;Pt<N;Pt+=w){const Xt=(It+Pt)/f;if(Xt<0||Xt>=c.outWidth||Math.floor(Xt)!==Xt)continue;const Wt=z.get(G,St,yt,Xt,T);et+=Wt}}}B.set(et*H,G,K,ht,rt,T)}return e.makeTensorInfo(B.shape,B.dtype,B.values)}const IY={kernelName:Wf,backendName:"cpu",kernelFunc:SY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CY(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,input:i}=t,o=i;de([r,i],"avgPoolGrad");const{filterSize:a,strides:u,pad:l}=s,c=jr(o.shape,a,u,1,l),h=c.strideHeight,d=c.strideWidth,f=c.filterHeight,p=c.filterWidth,m=c.dilationHeight,g=c.dilationWidth,y=c.effectiveFilterHeight,b=c.effectiveFilterWidth,w=b-1-c.padInfo.left,v=y-1-c.padInfo.top,S=Fe(o.shape,"float32"),N=1/(f*p),R=e.data.get(r.dataId).values,L=Fe(r.shape,"float32",R);for(let F=0;F<c.batchSize;++F)for(let B=0;B<c.inChannels;++B)for(let H=0;H<c.inHeight;++H)for(let z=0;z<c.inWidth;++z){const G=H-v,T=z-w;let K=0;for(let ht=0;ht<y;ht+=m){const rt=(G+ht)/h;if(!(rt<0||rt>=c.outHeight||Math.floor(rt)!==rt))for(let gt=0;gt<b;gt+=g){const at=(T+gt)/d;if(at<0||at>=c.outWidth||Math.floor(at)!==at)continue;const It=L.get(F,rt,at,B);K+=It}}S.set(K*N,F,H,z,B)}return e.makeTensorInfo(S.shape,S.dtype,S.values)}const NY={kernelName:Uf,backendName:"cpu",kernelFunc:CY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TY(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,scale:i,offset:o,mean:a,variance:u}=t;V(a.shape.length===u.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),V(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),V(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),de([r,a,u,i,o],"batchNorm");let{varianceEpsilon:l}=s;l==null&&(l=.001);const c=e.data.get(r.dataId).values,h=e.data.get(a.dataId).values,d=e.data.get(u.dataId).values,f=i?e.data.get(i.dataId).values:new Float32Array([1]),p=o?e.data.get(o.dataId).values:new Float32Array([0]),m=new Float32Array(c.length),g=p.length,y=f.length,b=d.length,w=h.length;let v=0,S=0,N=0,R=0;for(let L=0;L<c.length;++L)m[L]=p[v++]+(c[L]-h[S++])*f[N++]/Math.sqrt(d[R++]+l),v>=g&&(v=0),S>=w&&(S=0),N>=y&&(N=0),R>=b&&(R=0);return e.makeTensorInfo(r.shape,r.dtype,m)}const $Y={kernelName:sh,backendName:"cpu",kernelFunc:TY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EY(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{blockShape:i,crops:o}=s;de([r],"batchToSpaceND");const a=i.reduce((y,b)=>y*b),u=od(r.shape,i,a),l=ad(u.length,i.length),c=ud(r.shape,i,a),h=A2(o,i.length),d=R2(c,o,i.length),f=fn({inputs:{x:r},backend:e,attrs:{shape:u}}),p=Ys({inputs:{x:f},backend:e,attrs:{perm:l}}),m=fn({inputs:{x:p},backend:e,attrs:{shape:c}}),g=Ga({inputs:{x:m},backend:e,attrs:{begin:h,size:d}});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(m),g}const _Y={kernelName:jc,backendName:"cpu",kernelFunc:EY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AY(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,weights:i}=t,{size:o}=s,a=e.data.get(r.dataId).values,u=e.data.get(i.dataId).values,l=J2(a,u,i.dtype,i.shape,o);return e.makeTensorInfo([o],i.dtype,l)}const RY={kernelName:Gf,backendName:"cpu",kernelFunc:AY};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DY(n){const{inputs:t,backend:e}=n,{s0:s,s1:r}=t,i=e.data.get(s.dataId).values,o=e.data.get(r.dataId).values,a=Ee(Array.from(i),Array.from(o));return e.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const OY={kernelName:jf,backendName:"cpu",kernelFunc:DY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FY=rn(Ju,(n,t)=>{const e=t;return n>e.clipValueMax?e.clipValueMax:n<e.clipValueMin?e.clipValueMin:n}),LY={kernelName:Ju,backendName:"cpu",kernelFunc:FY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PY=n=>{const{x:t}=n.inputs,e=n.backend,s=new Float32Array(Et(t.shape)),r=e.data.get(t.dataId),i=r.complexTensorInfos.real,o=r.complexTensorInfos.imag,a=e.data.get(i.dataId).values,u=e.data.get(o.dataId).values;for(let l=0;l<a.length;l++){const c=a[l],h=u[l];s[l]=Math.hypot(c,h)}return e.makeOutput(s,t.shape,"float32")},MY={kernelName:Kc,backendName:"cpu",kernelFunc:PY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vu(n){const{inputs:t,backend:e}=n,{input:s}=t,r=e.data.get(s.dataId).complexTensorInfos.imag,i=e.data.get(r.dataId).values;return e.makeTensorInfo(r.shape,r.dtype,i)}const zY={kernelName:hp,backendName:"cpu",kernelFunc:Vu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uu(n){const{inputs:t,backend:e,attrs:s}=n,{axis:r}=s,i=Pe(r,t[0].shape)[0],o=t.map(m=>m.shape);$2(o,i);let a=Oi(t.map(m=>m.shape),i);if(Et(a)===0)return e.makeTensorInfo(a,t[0].dtype,[]);const u=t.filter(m=>Et(m.shape)>0);if(u.length===1)return Bi({inputs:{x:u[0]},backend:e});if(u[0].dtype==="complex64"){const m=u.map(v=>Wa({inputs:{input:v},backend:e})),g=u.map(v=>Vu({inputs:{input:v},backend:e})),y=Uu({inputs:m,backend:e,attrs:{axis:i}}),b=Uu({inputs:g,backend:e,attrs:{axis:i}}),w=rr({inputs:{real:y,imag:b},backend:e});return m.forEach(v=>e.disposeIntermediateTensorInfo(v)),g.forEach(v=>e.disposeIntermediateTensorInfo(v)),e.disposeIntermediateTensorInfo(y),e.disposeIntermediateTensorInfo(b),w}const l=u.map(m=>{const y=[-1,Et(m.shape.slice(i))];return fn({inputs:{x:m},backend:e,attrs:{shape:y}})}),c=l.map(m=>({vals:e.data.get(m.dataId).values,shape:m.shape}));a=Oi(l.map(m=>m.shape),1);const h=l[0].shape[0]===1,d=c4(c,a,t[0].dtype,h),f=Oi(u.map(m=>m.shape),i),p=e.makeTensorInfo(f,t[0].dtype,d);return l.forEach(m=>e.disposeIntermediateTensorInfo(m)),p}const BY={kernelName:qc,backendName:"cpu",kernelFunc:Uu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EC(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,filter:i}=t,{strides:o,pad:a,dataFormat:u,dilations:l,dimRoundingMode:c}=s;de([r,i],"conv2d");const h=mo(u),d=rs(r.shape,i.shape,o,l,a,c,!1,h),f=d.filterHeight,p=d.filterWidth,m=d.dilationHeight,g=d.dilationWidth,y=d.padInfo.left,b=d.padInfo.top,w=d.dataFormat==="channelsLast",v=new Vn(d.outShape,r.dtype),S=ge(r.shape),N=ge(i.shape),R=S[0],L=w?S[1]:S[2],F=w?S[2]:1,B=w?1:S[1],H=v.strides[0],z=w?v.strides[1]:v.strides[2],G=w?v.strides[2]:1,T=w?1:v.strides[1],K=e.data.get(r.dataId).values,ht=e.data.get(i.dataId).values,rt=v.values;for(let gt=0;gt<d.batchSize;++gt){const at=gt*R,It=gt*H;for(let et=0;et<d.outHeight;++et){const st=It+et*z,St=et*d.strideHeight-b;for(let kt=0;kt<f;++kt){const yt=St+kt*m;if(yt<0||yt>=d.inHeight)continue;const Pt=kt*N[0],Xt=at+yt*L;for(let Wt=0;Wt<d.outWidth;++Wt){const Bt=st+Wt*G,Jt=Wt*d.strideWidth-y;for(let jt=0;jt<p;++jt){const be=Jt+jt*g;if(be<0||be>=d.inWidth)continue;const ce=Pt+jt*N[1],O=Xt+be*F;let Nt=ce;for(let xt=0;xt<d.inChannels;++xt){const q=K[O+xt*B];for(let j=0;j<d.outChannels;++j)rt[Bt+j*T]+=q*ht[Nt+j];Nt+=d.outChannels}}}}}}return e.makeTensorInfo(v.shape,v.dtype,rt)}const VY={kernelName:Xc,backendName:"cpu",kernelFunc:EC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UY(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,dy:i}=t,{strides:o,pad:a,dataFormat:u,dimRoundingMode:l,filterShape:c}=s;de([r,i],"conv2dBackpropFilter");const h=mo(u),d=rs(r.shape,c,o,1,a,l,!1,h),{strideHeight:f,strideWidth:p,filterHeight:m,filterWidth:g}=d,y=d.dataFormat==="channelsLast",b=new Vn(d.filterShape,"float32"),w=d.padInfo.left,v=d.padInfo.top,S=e.data.get(r.dataId).values,N=e.data.get(i.dataId).values,R=new Vn(r.shape,r.dtype,S),L=new Vn(i.shape,i.dtype,N);for(let F=0;F<m;++F){const B=Math.max(0,Math.ceil((v-F)/f)),H=Math.min(d.outHeight,(d.inHeight+v-F)/f);for(let z=0;z<g;++z){const G=Math.max(0,Math.ceil((w-z)/p)),T=Math.min(d.outWidth,(d.inWidth+w-z)/p);for(let K=0;K<d.inChannels;++K)for(let ht=0;ht<d.outChannels;++ht){let rt=0;for(let gt=0;gt<d.batchSize;++gt)for(let at=B;at<H;++at){const It=F+at*f-v;for(let et=G;et<T;++et){const st=z+et*p-w;y?rt+=R.get(gt,It,st,K)*L.get(gt,at,et,ht):rt+=R.get(gt,K,It,st)*L.get(gt,ht,at,et)}}b.set(rt,F,z,K,ht)}}}return e.makeTensorInfo(b.shape,b.dtype,b.values)}const WY={kernelName:Kf,backendName:"cpu",kernelFunc:UY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GY(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,filter:i}=t,{inputShape:o,strides:a,pad:u,dataFormat:l,dimRoundingMode:c}=s;de([r,i],"conv2dBackpropInput");const h=ge(i.shape),d=ge(r.shape);let f=mo(l);const p=rs(o,i.shape,a,1,u,c,!1,f),m=new Vn(p.inShape,"float32"),g=m.values,y=e.data.get(r.dataId).values,b=e.data.get(i.dataId).values,[w,v,S]=h,{batchSize:N,filterHeight:R,filterWidth:L,inChannels:F,inHeight:B,inWidth:H,outChannels:z,outHeight:G,outWidth:T,strideHeight:K,strideWidth:ht}=p;f=p.dataFormat;const rt=R-1-p.padInfo.top,gt=L-1-p.padInfo.left,at=f==="channelsLast",It=m.strides[0],et=at?m.strides[1]:m.strides[2],st=at?m.strides[2]:1,St=at?1:m.strides[1],kt=d[0],yt=at?d[1]:d[2],Pt=at?d[2]:1,Xt=at?1:d[1];for(let Wt=0;Wt<N;++Wt)for(let Bt=0;Bt<F;++Bt)for(let Jt=0;Jt<B;++Jt){const jt=Jt-rt,be=Math.max(0,Math.ceil(jt/K)),ce=Math.min(G,(R+jt)/K);for(let O=0;O<H;++O){const Nt=O-gt,xt=Math.max(0,Math.ceil(Nt/ht)),q=Math.min(T,(L+Nt)/ht);let j=0;for(let At=be;At<ce;++At){const Rt=At*K-jt;for(let bt=xt;bt<q;++bt){const Ut=bt*ht-Nt,qt=kt*Wt+yt*At+Pt*bt,zt=w*(R-1-Rt)+v*(L-1-Ut)+S*Bt;for(let ne=0;ne<z;++ne){const Te=y[qt+Xt*ne],me=b[zt+ne];j+=Te*me}}}const ft=It*Wt+et*Jt+st*O+St*Bt;g[ft]=j}}return e.makeTensorInfo(m.shape,m.dtype,m.values)}const jY={kernelName:Yc,backendName:"cpu",kernelFunc:GY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HY(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,filter:i}=t,{strides:o,pad:a,dilations:u}=s;de([r,i],"conv3d");const l=ta(r.shape,i.shape,o,u,a),{filterDepth:c,filterHeight:h,filterWidth:d,dilationDepth:f,dilationHeight:p,dilationWidth:m,padInfo:g}=l,y=g.front,b=g.left,w=g.top,v=new Vn(l.outShape,r.dtype),S=e.data.get(r.dataId).values,N=e.data.get(i.dataId).values,R=v.values,L=ge(r.shape),F=ge(i.shape);for(let B=0;B<l.batchSize;++B){const H=B*L[0],z=B*v.strides[0];for(let G=0;G<l.outDepth;++G){const T=z+G*v.strides[1],K=G*l.strideDepth-y;for(let ht=0;ht<c;++ht){const rt=K+ht*f;if(rt<0||rt>=l.inDepth)continue;const gt=ht*F[0],at=H+rt*L[1];for(let It=0;It<l.outHeight;++It){const et=T+It*v.strides[2],st=It*l.strideHeight-w;for(let St=0;St<h;++St){const kt=st+St*p;if(kt<0||kt>=l.inHeight)continue;const yt=gt+St*F[1],Pt=at+kt*L[2];for(let Xt=0;Xt<l.outWidth;++Xt){const Wt=et+Xt*l.outChannels,Bt=Xt*l.strideWidth-b;for(let Jt=0;Jt<d;++Jt){const jt=Bt+Jt*m;if(jt<0||jt>=l.inWidth)continue;const be=yt+Jt*F[2],ce=Pt+jt*l.inChannels;let O=be;for(let Nt=0;Nt<l.inChannels;++Nt){const xt=S[ce+Nt];for(let q=0;q<l.outChannels;++q)R[Wt+q]+=xt*N[O+q];O+=l.outChannels}}}}}}}}return e.makeTensorInfo(v.shape,v.dtype,v.values)}const KY={kernelName:Zc,backendName:"cpu",kernelFunc:HY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qY(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,dy:i}=t,{strides:o,pad:a,filterShape:u}=s;de([r,i],"conv3dBackpropFilterV2");const l=ge(r.shape),c=ge(i.shape),h=ta(r.shape,u,o,1,a),d=h.strideDepth,f=h.strideHeight,p=h.strideWidth,m=h.filterDepth,g=h.filterHeight,y=h.filterWidth,b=new Vn(h.filterShape,"float32"),w=b.values,[v,S,N,R]=b.strides,L=e.data.get(i.dataId).values,[F,B,H,z]=c,G=e.data.get(r.dataId).values,[T,K,ht,rt]=l,gt=h.padInfo.front,at=h.padInfo.left,It=h.padInfo.top;for(let et=0;et<m;++et){const st=Math.max(0,Math.ceil((gt-et)/d)),St=Math.min(h.outDepth,(h.inDepth+gt-et)/d),kt=et*v;for(let yt=0;yt<g;++yt){const Pt=Math.max(0,Math.ceil((It-yt)/f)),Xt=Math.min(h.outHeight,(h.inHeight+It-yt)/f),Wt=yt*S+kt;for(let Bt=0;Bt<y;++Bt){const Jt=Math.max(0,Math.ceil((at-Bt)/p)),jt=Math.min(h.outWidth,(h.inWidth+at-Bt)/p),be=Bt*N+Wt;for(let ce=0;ce<h.inChannels;++ce){const O=ce*R+be;for(let Nt=0;Nt<h.outChannels;++Nt){let xt=0;for(let q=0;q<h.batchSize;++q){const j=q*T,ft=q*F;for(let At=st;At<St;++At){const bt=(et+At*d-gt)*K+j,Ut=At*B+ft;for(let qt=Pt;qt<Xt;++qt){const ne=(yt+qt*f-It)*ht+bt,Te=qt*H+Ut;for(let me=Jt;me<jt;++me){const ms=(Bt+me*p-at)*rt+ne,$n=me*z+Te;xt+=G[ms+ce]*L[$n+Nt]}}}}w[O+Nt]=xt}}}}}return e.makeTensorInfo(b.shape,b.dtype,b.values)}const XY={kernelName:qf,backendName:"cpu",kernelFunc:qY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YY(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,filter:i}=t,{pad:o,strides:a,inputShape:u}=s;de([r],"conv3dBackpropInputV2");const l=ge(r.shape),c=ge(i.shape),h=ta(u,i.shape,a,1,o),d=new Vn(h.inShape,"float32"),f=d.values,[p,m,g,y]=d.strides,b=e.data.get(r.dataId).values,[w,v,S,N]=l,R=e.data.get(i.dataId).values,[L,F,B,H]=c,{batchSize:z,filterDepth:G,filterHeight:T,filterWidth:K,inChannels:ht,inDepth:rt,inHeight:gt,inWidth:at,outChannels:It,outDepth:et,outHeight:st,outWidth:St,strideDepth:kt,strideHeight:yt,strideWidth:Pt}=h,Xt=G-1-h.padInfo.front,Wt=T-1-h.padInfo.top,Bt=K-1-h.padInfo.left;for(let Jt=0;Jt<z;++Jt)for(let jt=0;jt<ht;++jt)for(let be=0;be<rt;++be){const ce=be-Xt,O=Math.max(0,Math.ceil(ce/kt)),Nt=Math.min(et,(G+ce)/kt);for(let xt=0;xt<gt;++xt){const q=xt-Wt,j=Math.max(0,Math.ceil(q/yt)),ft=Math.min(st,(T+q)/yt);for(let At=0;At<at;++At){const Rt=At-Bt,bt=Math.max(0,Math.ceil(Rt/Pt)),Ut=Math.min(St,(K+Rt)/Pt);let qt=0;for(let zt=O;zt<Nt;++zt){const ne=zt*kt-ce;for(let Te=j;Te<ft;++Te){const me=Te*yt-q;for(let on=bt;on<Ut;++on){const ms=on*Pt-Rt,$n=w*Jt+v*zt+S*Te+N*on,Bs=L*(G-1-ne)+F*(T-1-me)+B*(K-1-ms)+H*jt;for(let We=0;We<It;++We){const ln=b[$n+We],en=R[Bs+We];qt+=ln*en}}}}f[p*Jt+m*be+g*xt+y*At+jt]=qt}}}return e.makeTensorInfo(d.shape,d.dtype,d.values)}const ZY={kernelName:Xf,backendName:"cpu",kernelFunc:YY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JY=rn(Qu,n=>Math.cos(n)),QY={kernelName:Qu,backendName:"cpu",kernelFunc:JY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tZ=rn(tl,n=>Math.cosh(n)),eZ={kernelName:tl,backendName:"cpu",kernelFunc:tZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nZ(n){const{inputs:t,backend:e,attrs:s}=n,{image:r,boxes:i,boxInd:o}=t,{cropSize:a,method:u,extrapolationValue:l}=s,[c,h,d,f]=r.shape,p=i.shape[0],[m,g]=a,y=Fe([p,m,g,f],"float32"),b=e.data.get(i.dataId).values,w=e.data.get(o.dataId).values,v=e.data.get(r.dataId).values,S=ge(r.shape),N=ge(y.shape);for(let R=0;R<p;R++){const L=R*4,F=b[L],B=b[L+1],H=b[L+2],z=b[L+3],G=w[R];if(G>=c)continue;const T=m>1?(H-F)*(h-1)/(m-1):0,K=g>1?(z-B)*(d-1)/(g-1):0;for(let ht=0;ht<m;ht++){const rt=m>1?F*(h-1)+ht*T:.5*(F+H)*(h-1);if(rt<0||rt>h-1){for(let gt=0;gt<g;gt++)for(let at=0;at<f;at++){const It=at+gt*N[2]+ht*N[1]+R*N[0];y.values[It]=l}continue}if(u==="bilinear"){const gt=Math.floor(rt),at=Math.ceil(rt),It=rt-gt;for(let et=0;et<g;et++){const st=g>1?B*(d-1)+et*K:.5*(B+z)*(d-1);if(st<0||st>d-1){for(let Pt=0;Pt<f;Pt++){const Xt=Pt+et*N[2]+ht*N[1]+R*N[0];y.values[Xt]=l}continue}const St=Math.floor(st),kt=Math.ceil(st),yt=st-St;for(let Pt=0;Pt<f;Pt++){let Xt=Pt+St*S[2]+gt*S[1]+G*S[0];const Wt=v[Xt];Xt=Pt+kt*S[2]+gt*S[1]+G*S[0];const Bt=v[Xt];Xt=Pt+St*S[2]+at*S[1]+G*S[0];const Jt=v[Xt];Xt=Pt+kt*S[2]+at*S[1]+G*S[0];const jt=v[Xt],be=Wt+(Bt-Wt)*yt,ce=Jt+(jt-Jt)*yt;Xt=Pt+et*N[2]+ht*N[1]+R*N[0],y.values[Xt]=be+(ce-be)*It}}}else for(let gt=0;gt<g;++gt){const at=g>1?B*(d-1)+gt*K:.5*(B+z)*(d-1);if(at<0||at>d-1){for(let st=0;st<f;st++){const St=st+gt*N[2]+ht*N[1]+R*N[0];y.values[St]=l}continue}const It=Math.round(at),et=Math.round(rt);for(let st=0;st<f;st++){const St=st+It*S[2]+et*S[1]+G*S[0],kt=st+gt*N[2]+ht*N[1]+R*N[0];y.values[kt]=v[St]}}}}return e.makeTensorInfo(y.shape,y.dtype,y.values)}const sZ={kernelName:Zf,backendName:"cpu",kernelFunc:nZ};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rZ(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i,exclusive:o,reverse:a}=s;de(r,"cumprod");const u=Tn([i],r.shape.length);let l=r;u!=null&&(l=Ys({inputs:{x:r},backend:e,attrs:{perm:u}}));const c=Rn(1,r.shape.length)[0];if(c!==l.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${l.shape.length-1} but got axis=${c}`);const h=qs(l.dtype,"int32"),d=zf(Et(l.shape),h),f=e.data.get(l.dataId).values,p=l.shape[l.shape.length-1],m=a?(y,b)=>y+p-b-1:(y,b)=>y+b;for(let y=0;y<f.length;y+=p)for(let b=0;b<p;b++){const w=m(y,b);if(b===0)d[w]=o?1:f[w];else{const v=m(y,b-1);d[w]=o?f[v]*d[v]:f[w]*d[v]}}const g=e.makeTensorInfo(l.shape,h,d);if(u!=null){const y=ea(u),b=Ys({inputs:{x:g},backend:e,attrs:{perm:y}});return e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(l),b}return g}const iZ={kernelName:Yf,backendName:"cpu",kernelFunc:rZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oZ(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i,exclusive:o,reverse:a}=s;de(r,"cumsum");const u=Tn([i],r.shape.length);let l=r;u!=null&&(l=Ys({inputs:{x:r},backend:e,attrs:{perm:u}}));const c=Rn(1,r.shape.length)[0];if(c!==l.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${l.shape.length-1} but got axis=${c}`);const h=qs(l.dtype,"int32"),d=ls(Et(l.shape),h),f=e.data.get(l.dataId).values,p=l.shape[l.shape.length-1],m=a?(y,b)=>y+p-b-1:(y,b)=>y+b;for(let y=0;y<f.length;y+=p)for(let b=0;b<p;b++){const w=m(y,b);if(b===0)d[w]=o?0:f[w];else{const v=m(y,b-1);d[w]=o?f[v]+d[v]:f[w]+d[v]}}const g=e.makeTensorInfo(l.shape,h,d);if(u!=null){const y=ea(u),b=Ys({inputs:{x:g},backend:e,attrs:{perm:y}});return e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(l),b}return g}const aZ={kernelName:Jc,backendName:"cpu",kernelFunc:oZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uZ(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,weights:i}=t,{size:o,binaryOutput:a}=s;if(r.shape.length===1){const u=e.data.get(r.dataId).values,l=e.data.get(i.dataId).values,c=J2(u,l,i.dtype,i.shape,o);return e.makeTensorInfo([o],i.dtype,c)}else if(r.shape.length===2){const u=e.bufferSync(r),l=e.bufferSync(i),c=a4(u,l,o,a);return e.makeTensorInfo(c.shape,i.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const lZ={kernelName:Jf,backendName:"cpu",kernelFunc:uZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cZ(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{blockSize:i,dataFormat:o}=s;V(o==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${o}`);const a=r.shape[0],u=r.shape[1],l=r.shape[2],c=r.shape[3],h=u*i,d=l*i,f=c/(i*i),p=e.data.get(r.dataId).values,m=new Float32Array(a*h*d*f);let g=0;for(let y=0;y<a;++y)for(let b=0;b<h;++b){const w=Math.floor(b/i),v=b%i;for(let S=0;S<d;++S){const N=Math.floor(S/i),R=S%i,L=(v*i+R)*f;for(let F=0;F<f;++F){const H=F+L+c*(N+l*(w+u*y));m[g++]=p[H]}}}return e.makeTensorInfo([a,h,d,f],r.dtype,m)}const hZ={kernelName:Qf,backendName:"cpu",kernelFunc:cZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _C(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,filter:i}=t,{strides:o,pad:a,dilations:u,dimRoundingMode:l}=s;de([r,i],"depthwiseConv2DNative");const c=ge(r.shape),h=ge(i.shape);let d=u;d==null&&(d=[1,1]),V(ds(o,d),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${d}'`);const f=rs(r.shape,i.shape,o,d,a,l,!0),{filterHeight:p,filterWidth:m,dilationHeight:g,dilationWidth:y,padInfo:b}=f,w=b.left,v=b.top,S=f.outChannels/f.inChannels,N=new Vn(f.outShape,r.dtype),R=e.data.get(r.dataId).values,L=e.data.get(i.dataId).values,F=N.values;for(let B=0;B<f.batchSize;++B){const H=B*c[0],z=B*N.strides[0];for(let G=0;G<f.outHeight;++G){const T=z+G*N.strides[1],K=G*f.strideHeight-v;for(let ht=0;ht<p;++ht){const rt=K+ht*g;if(rt<0||rt>=f.inHeight)continue;const gt=ht*h[0],at=H+rt*c[1];for(let It=0;It<f.outWidth;++It){const et=T+It*N.strides[2],st=It*f.strideWidth-w;for(let St=0;St<m;++St){const kt=st+St*y;if(kt<0||kt>=f.inWidth)continue;const yt=gt+St*h[1],Pt=at+kt*f.inChannels;let Xt=et,Wt=yt;for(let Bt=0;Bt<f.inChannels;++Bt){const Jt=R[Pt+Bt];for(let jt=0;jt<S;++jt)F[Xt+jt]+=Jt*L[Wt+jt];Xt+=S,Wt+=S}}}}}}return e.makeTensorInfo(N.shape,N.dtype,N.values)}const dZ={kernelName:Qc,backendName:"cpu",kernelFunc:_C};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fZ(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,dy:i}=t,{strides:o,dilations:a,pad:u,dimRoundingMode:l,filterShape:c}=s;de([r,i],"depthwiseConv2dNativeBackpropFilter");const h=rs(r.shape,c,o,a,u,l,!0),{strideHeight:d,strideWidth:f,filterHeight:p,filterWidth:m}=h,g=new Vn(h.filterShape,"float32"),y=h.padInfo.left,b=h.padInfo.top,w=h.outChannels/h.inChannels,v=e.data.get(r.dataId).values,S=new Vn(r.shape,r.dtype,v),N=e.data.get(i.dataId).values,R=new Vn(i.shape,i.dtype,N);for(let L=0;L<p;++L){const F=Math.max(0,Math.ceil((b-L)/d)),B=Math.min(h.outHeight,(h.inHeight+b-L)/d);for(let H=0;H<m;++H){const z=Math.max(0,Math.ceil((y-H)/f)),G=Math.min(h.outWidth,(h.inWidth+y-H)/f);for(let T=0;T<h.outChannels;++T){const K=Math.trunc(T/w),ht=T%w;let rt=0;for(let gt=0;gt<h.batchSize;++gt)for(let at=F;at<B;++at){const It=L+at*d-b;for(let et=z;et<G;++et){const st=H+et*f-y;rt+=S.get(gt,It,st,K)*R.get(gt,at,et,T)}}g.set(rt,L,H,K,ht)}}}return e.makeTensorInfo(g.shape,g.dtype,g.values)}const pZ={kernelName:tp,backendName:"cpu",kernelFunc:fZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mZ(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,filter:i}=t,{strides:o,dilations:a,pad:u,dimRoundingMode:l,inputShape:c}=s;de([r,i],"depthwiseConv2DNativeBackpropInput");const h=ge(r.shape),d=ge(i.shape),f=rs(c,i.shape,o,a,u,l,!0),p=new Vn(f.inShape,"float32"),m=p.values,[g,y,b]=p.strides,w=e.data.get(r.dataId).values,[v,S,N]=h,R=e.data.get(i.dataId).values,[L,F,B]=d,{batchSize:H,filterHeight:z,filterWidth:G,inChannels:T,inHeight:K,inWidth:ht,outChannels:rt,outHeight:gt,outWidth:at,strideHeight:It,strideWidth:et}=f,st=z-1-f.padInfo.top,St=G-1-f.padInfo.left,kt=rt/T;for(let yt=0;yt<H;++yt)for(let Pt=0;Pt<T;++Pt)for(let Xt=0;Xt<K;++Xt){const Wt=Xt-st,Bt=Math.max(0,Math.ceil(Wt/It)),Jt=Math.min(gt,(z+Wt)/It);for(let jt=0;jt<ht;++jt){const be=jt-St,ce=Math.max(0,Math.ceil(be/et)),O=Math.min(at,(G+be)/et);let Nt=0;for(let xt=Bt;xt<Jt;++xt){const q=xt*It-Wt;for(let j=ce;j<O;++j){const ft=j*et-be,At=v*yt+S*xt+N*j,Rt=L*(z-1-q)+F*(G-1-ft)+B*Pt;for(let bt=0;bt<kt;++bt){const Ut=Pt*kt+bt,qt=w[At+Ut],zt=R[Rt+bt];Nt+=qt*zt}}}m[g*yt+y*Xt+b*jt+Pt]=Nt}}return e.makeTensorInfo(p.shape,p.dtype,p.values)}const gZ={kernelName:ep,backendName:"cpu",kernelFunc:mZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yZ(n){const{inputs:t,backend:e}=n,{x:s}=t,r=Et(s.shape),i=e.data.get(s.dataId).values,o=Fe([r,r],s.dtype),a=o.values;for(let l=0;l<i.length;l++)a[l*r+l]=i[l];const u=[...s.shape,...s.shape];return e.makeTensorInfo(u,o.dtype,o.values)}const bZ={kernelName:np,backendName:"cpu",kernelFunc:yZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xZ={kernelName:th,backendName:"cpu",kernelFunc:({inputs:n,backend:t,attrs:e})=>{const{x:s,filter:r}=n,{strides:i,pad:o,dilations:a}=e,u=t,l=u.data.get(s.dataId).values,c=s.shape.length,h=u.data.get(r.dataId).values,d=r.shape.length,{batchSize:f,inHeight:p,inWidth:m,inChannels:g,outHeight:y,outWidth:b,padInfo:w,strideHeight:v,strideWidth:S,filterHeight:N,filterWidth:R,dilationHeight:L,dilationWidth:F,outShape:B}=Wh(s.shape,r.shape,i,o,"NHWC",a),H=Et(B),z=B.length,G=En(s.dtype,H);for(let K=0;K<f;++K)for(let ht=0;ht<y;++ht){const rt=ht*v-w.top;for(let gt=0;gt<b;++gt){const at=gt*S-w.left;for(let It=0;It<g;++It){let et=Number.MIN_SAFE_INTEGER;for(let St=0;St<N;++St){const kt=rt+St*L;if(kt>=0&&kt<p)for(let yt=0;yt<R;++yt){const Pt=at+yt*F;if(Pt>=0&&Pt<m){const Xt=ri([K,kt,Pt,It],c,ge(s.shape)),Wt=ri([St,yt,It],d,ge(r.shape)),Bt=l[Xt]+h[Wt];Bt>et&&(et=Bt)}}}const st=ri([K,ht,gt,It],z,ge(B));G[st]=et}}}return{dataId:u.write(Jo(G,s.dtype),B,s.dtype),shape:B,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wZ={kernelName:of,backendName:"cpu",kernelFunc:({inputs:n,backend:t,attrs:e})=>{const{x:s,filter:r,dy:i}=n,{strides:o,pad:a,dilations:u}=e,l=t,c=Ir(s.shape,l.data.get(s.dataId).values),h=Ir(r.shape,l.data.get(r.dataId).values),{batchSize:d,inHeight:f,inWidth:p,inChannels:m,outHeight:g,outWidth:y,padInfo:b,strideHeight:w,strideWidth:v,filterHeight:S,filterWidth:N,dilationHeight:R,dilationWidth:L,outShape:F}=Wh(s.shape,r.shape,o,a,"NHWC",u);V(i.rank===F.length,()=>`Error in ${of}, dy must have the same rank as output ${F.length}, but got ${i.rank}`);const B=Ir(F,l.data.get(i.dataId).values),H=U1(r.shape,r.dtype);for(let G=0;G<d;++G)for(let T=0;T<g;++T){const K=T*w-b.top;for(let ht=0;ht<y;++ht){const rt=ht*v-b.left;for(let gt=0;gt<m;++gt){let at=Number.MIN_SAFE_INTEGER,It=0,et=0;for(let st=0;st<S;++st){const St=K+st*R;if(St>=0&&St<f)for(let kt=0;kt<N;++kt){const yt=rt+kt*L;if(yt>=0&&yt<p){const Pt=c[G][St][yt][gt]+h[st][kt][gt];Pt>at&&(at=Pt,It=st,et=kt)}}}H[It][et][gt]+=B[G][T][ht][gt]}}}return{dataId:l.write(Jo(H,s.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vZ={kernelName:rf,backendName:"cpu",kernelFunc:({inputs:n,backend:t,attrs:e})=>{const{x:s,filter:r,dy:i}=n,{strides:o,pad:a,dilations:u}=e,l=t,c=Ir(s.shape,l.data.get(s.dataId).values),h=Ir(r.shape,l.data.get(r.dataId).values),{batchSize:d,inHeight:f,inWidth:p,inChannels:m,outHeight:g,outWidth:y,padInfo:b,strideHeight:w,strideWidth:v,filterHeight:S,filterWidth:N,dilationHeight:R,dilationWidth:L,outShape:F}=Wh(s.shape,r.shape,o,a,"NHWC",u);V(i.rank===F.length,()=>`Error in ${rf}, dy must have the same rank as output ${F.length}, but got ${i.rank}`);const B=Ir(F,l.data.get(i.dataId).values),H=U1(s.shape,s.dtype);for(let G=0;G<d;++G)for(let T=0;T<g;++T){const K=T*w-b.top;for(let ht=0;ht<y;++ht){const rt=ht*v-b.left;for(let gt=0;gt<m;++gt){let at=Number.MIN_SAFE_INTEGER,It=K<0?0:K,et=rt<0?0:rt;for(let st=0;st<S;++st){const St=K+st*R;if(St>=0&&St<f)for(let kt=0;kt<N;++kt){const yt=rt+kt*L;if(yt>=0&&yt<p){const Pt=c[G][St][yt][gt]+h[st][kt][gt];Pt>at&&(at=Pt,It=St,et=yt)}}}H[G][It][et][gt]+=B[G][T][ht][gt]}}}return{dataId:l.write(Jo(H,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kZ(n){const{inputs:t,backend:e,attrs:s}=n,{image:r}=t,{canvas:i,options:o}=s,{contextOptions:a,imageOptions:u}=o||{},l=(u==null?void 0:u.alpha)||1,c=(a==null?void 0:a.contextType)||"2d";if(c!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const h=i.getContext(c,(a==null?void 0:a.contextAttributes)||{});if(h==null)throw new Error(`Could not get the context with ${c} type.`);const[d,f]=r.shape.slice(0,2),p=r.shape.length===2?1:r.shape[2],m=e.data.get(r.dataId).values,g=r.dtype==="float32"?255:1,y=new Uint8ClampedArray(f*d*4);for(let w=0;w<d*f;++w){const v=[0,0,0,255*l];for(let N=0;N<p;N++){const R=m[w*p+N];if(r.dtype==="float32"){if(R<0||R>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${R}.`)}else if(r.dtype==="int32"&&(R<0||R>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${R}.`);p===1?(v[0]=R*g,v[1]=R*g,v[2]=R*g):v[N]=R*g}const S=w*4;y[S+0]=Math.round(v[0]),y[S+1]=Math.round(v[1]),y[S+2]=Math.round(v[2]),y[S+3]=Math.round(v[3])}i.width=f,i.height=d;const b=new ImageData(y,f,d);return h.putImageData(b,0,0),r}const SZ={kernelName:sp,backendName:"cpu",kernelFunc:kZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sd(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i,keepDims:o}=s;de(r,"sum");let a;r.dtype==="bool"?a=Ho({inputs:{x:r},backend:e,attrs:{dtype:"int32"}}):a=Bi({inputs:{x:r},backend:e});const u=a.shape.length,l=Pe(i,a.shape),c=Tn(l,u);let h=l,d=a;c!=null&&(d=Ys({inputs:{x:a},backend:e,attrs:{perm:c}}),h=Rn(h.length,u)),fs("sum",h,d.shape.length);const[f,p]=is(d.shape,h),m=qs(d.dtype,"int32");let g=pf(e,f,m);const y=Et(p),b=e.data.get(g.dataId).values,w=e.data.get(d.dataId).values;for(let v=0;v<b.length;++v){const S=v*y;let N=0;for(let R=0;R<y;++R)N+=w[S+R];b[v]=N}if(o){const v=An(g.shape,l),S=g;g=fn({inputs:{x:g},backend:e,attrs:{shape:v}}),e.disposeIntermediateTensorInfo(S)}return e.disposeIntermediateTensorInfo(a),c!=null&&e.disposeIntermediateTensorInfo(d),g}const IZ={kernelName:Dh,backendName:"cpu",kernelFunc:Sd};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CZ(n){const{inputs:t,backend:e,attrs:s}=n,{equation:r}=s,i=t,{allDims:o,summedDims:a,idDims:u}=B2(r,i.length);U2(o.length,u,i);const{path:l,steps:c}=W2(a,u),h=c.length;let d=null,f=o.length;const p=[];for(let m=0;m<h;++m){for(const g of c[m]){const{permutationIndices:y,expandDims:b}=V2(f,u[g]);let w;G2(y)?w=i[g]:(w=Ys({inputs:{x:i[g]},backend:e,attrs:{perm:y}}),p.push(w));const v=w.shape.slice();for(let S=0;S<b.length;++S)v.splice(b[S],0,1);Ve(w.shape,v)||(w=fn({inputs:{x:w},backend:e,attrs:{shape:v}}),p.push(w)),d===null?d=w:(d=Pm({inputs:{a:w,b:d},backend:e}),p.push(d))}m<h-1&&(l[m]>=0&&(d=Sd({inputs:{x:d},backend:e,attrs:{axis:l[m]-(o.length-f),keepDims:!1}}),p.push(d)),f--)}for(const m of p)m!==d&&e.disposeIntermediateTensorInfo(m);return d}const NZ={kernelName:rp,backendName:"cpu",kernelFunc:CZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TZ(n){const{inputs:t,backend:e}=n,{dy:s,y:r}=t;de([s,r],"eluGrad");const i=new Float32Array(Et(r.shape)),o=e.data.get(r.dataId).values,a=e.data.get(s.dataId).values;for(let u=0;u<o.length;++u){const l=o[u];l>=0?i[u]=a[u]:i[u]=a[u]*(l+1)}return e.makeTensorInfo(r.shape,"float32",i)}const $Z={kernelName:ip,backendName:"cpu",kernelFunc:TZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EZ=D2,_Z=O2,AZ=F2,RZ=L2,DZ=P2,OZ=M2,FZ=rn(sl,n=>{const t=Math.sign(n),e=Math.abs(n),s=1/(1+EZ*e);return t*(1-((((OZ*s+DZ)*s+RZ)*s+AZ)*s+_Z)*s*Math.exp(-e*e))}),LZ={kernelName:sl,backendName:"cpu",kernelFunc:FZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ff(n){const{inputs:t,backend:e,attrs:s}=n,{input:r}=t,{dim:i}=s,o=r.shape.length,a=r.shape.slice();let u=i;return i<0&&(V(-(o+1)<=i,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),u=o+i+1),a.splice(u,0,1),fn({inputs:{x:r},backend:e,attrs:{shape:a}})}const PZ={kernelName:nh,backendName:"cpu",kernelFunc:Ff};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MZ=Dn((n,t)=>n/t),Oy=qn(el,MZ),L1={kernelName:el,backendName:"cpu",kernelFunc:Oy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AC(n,t,e){const s=n.shape,r=s[0],i=s[1],o=e.data.get(n.dataId),a=o.complexTensorInfos.real,u=o.complexTensorInfos.imag,l=[r,i],c=Et(l),h=ss("float32",c),d=ss("float32",c);for(let g=0;g<r;g++){const y=Ga({inputs:{x:a},backend:e,attrs:{begin:[g,0],size:[1,i]}}),b=Ga({inputs:{x:u},backend:e,attrs:{begin:[g,0],size:[1,i]}}),w=rr({inputs:{real:y,imag:b},backend:e}),{real:v,imag:S}=zZ(w,t,e),N=ao(v,S);for(let R=0;R<i;R++){const L=z2(N,R);h[g*i+R]=L.real,d[g*i+R]=L.imag}e.disposeIntermediateTensorInfo(y),e.disposeIntermediateTensorInfo(b),e.disposeIntermediateTensorInfo(w)}const f=e.makeTensorInfo(l,"float32",h),p=e.makeTensorInfo(l,"float32",d),m=rr({inputs:{real:f,imag:p},backend:e});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(p),m}function zZ(n,t,e){const s=Et(n.shape),r=e.data.get(n.dataId),i=e.data.get(r.complexTensorInfos.real.dataId).values,o=e.data.get(r.complexTensorInfos.imag.dataId).values;if(BZ(s)){const a=P1(i,o,s,t,e),u=[n.shape[0],n.shape[1]];if(t){const l=e.makeTensorInfo(u,"float32",a.real),c=e.makeTensorInfo(u,"float32",a.imag),h=e.makeTensorInfo([],"float32",fo(s,"float32")),d=Bi({inputs:{x:h},backend:e}),f=L1.kernelFunc({inputs:{a:l,b:h},backend:e}),p=L1.kernelFunc({inputs:{a:c,b:d},backend:e}),m=e.data.get(f.dataId).values,g=e.data.get(p.dataId).values;return e.disposeIntermediateTensorInfo(l),e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(p),{real:m,imag:g}}return a}else{const a=ao(i,o),u=VZ(a,s,t);return Cv(u)}}function BZ(n){return(n&n-1)===0}function P1(n,t,e,s,r){if(e===1)return{real:n,imag:t};const i=ao(n,t),o=e/2,a=Nv(i),u=a.real,l=a.imag,c=[u.length],h=r.makeTensorInfo(c,"float32",u),d=r.makeTensorInfo(c,"float32",l),f=rr({inputs:{real:h,imag:d},backend:r}),p=Tv(i),m=p.real,g=p.imag,y=[m.length],b=r.makeTensorInfo(y,"float32",m),w=r.makeTensorInfo(y,"float32",g),v=rr({inputs:{real:b,imag:w},backend:r}),S=P1(u,l,o,s,r),N=S.real,R=S.imag,L=[N.length],F=r.makeTensorInfo(L,"float32",N),B=r.makeTensorInfo(L,"float32",R),H=rr({inputs:{real:F,imag:B},backend:r}),z=P1(m,g,o,s,r),G=z.real,T=z.imag,K=[G.length],ht=r.makeTensorInfo(K,"float32",G),rt=r.makeTensorInfo(K,"float32",T),gt=rr({inputs:{real:ht,imag:rt},backend:r}),at=Ev(e,s),It=[at.real.length],et=r.makeTensorInfo(It,"float32",at.real),st=r.makeTensorInfo(It,"float32",at.imag),St=rr({inputs:{real:et,imag:st},backend:r}),kt=Pm({inputs:{a:St,b:gt},backend:r}),yt=zu({inputs:{a:H,b:kt},backend:r}),Pt=ny({inputs:{a:H,b:kt},backend:r}),Xt=Wa({inputs:{input:yt},backend:r}),Wt=Wa({inputs:{input:Pt},backend:r}),Bt=Vu({inputs:{input:yt},backend:r}),Jt=Vu({inputs:{input:Pt},backend:r}),jt=Uu({inputs:[Xt,Wt],backend:r,attrs:{axis:0}}),be=Uu({inputs:[Bt,Jt],backend:r,attrs:{axis:0}}),ce=r.data.get(jt.dataId).values,O=r.data.get(be.dataId).values;return r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(b),r.disposeIntermediateTensorInfo(w),r.disposeIntermediateTensorInfo(v),r.disposeIntermediateTensorInfo(F),r.disposeIntermediateTensorInfo(B),r.disposeIntermediateTensorInfo(H),r.disposeIntermediateTensorInfo(ht),r.disposeIntermediateTensorInfo(rt),r.disposeIntermediateTensorInfo(gt),r.disposeIntermediateTensorInfo(et),r.disposeIntermediateTensorInfo(st),r.disposeIntermediateTensorInfo(St),r.disposeIntermediateTensorInfo(kt),r.disposeIntermediateTensorInfo(yt),r.disposeIntermediateTensorInfo(Pt),r.disposeIntermediateTensorInfo(Xt),r.disposeIntermediateTensorInfo(Bt),r.disposeIntermediateTensorInfo(Wt),r.disposeIntermediateTensorInfo(Jt),r.disposeIntermediateTensorInfo(jt),r.disposeIntermediateTensorInfo(be),{real:ce,imag:O}}function VZ(n,t,e){const s=new Float32Array(t*2);for(let r=0;r<t;r++){let i=0,o=0;for(let a=0;a<t;a++){const u=_v(r*a,t,e),l=z2(n,a);i+=l.real*u.real-l.imag*u.imag,o+=l.real*u.imag+l.imag*u.real}e&&(i/=t,o/=t),$v(s,i,o,r)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UZ(n){const{inputs:t,backend:e}=n,{input:s}=t,r=Et(s.shape),i=s.shape[s.shape.length-1],o=r/i,a=fn({inputs:{x:s},backend:e,attrs:{shape:[o,i]}}),u=AC(a,!1,e),l=fn({inputs:{x:u},backend:e,attrs:{shape:s.shape}});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(u),l}const WZ={kernelName:op,backendName:"cpu",kernelFunc:UZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fy(n){const{backend:t,attrs:e}=n,{shape:s,value:r,dtype:i}=e,o=i||Xa(r),a=En(o,Et(s));return jZ(a,r,o),t.makeTensorInfo(s,o,a)}const GZ={kernelName:ap,backendName:"cpu",kernelFunc:Fy};function jZ(n,t,e){n.fill(t)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HZ={kernelName:up,backendName:"cpu",kernelFunc:({inputs:n,attrs:t,backend:e})=>{const{image:s}=n,r=e,i=ss(s.dtype,Et(s.shape)),[o,a,u,l]=s.shape,c=r.data.get(s.dataId).values;for(let d=0;d<o;d++){const f=d*u*a*l;for(let p=0;p<a;p++){const m=p*(u*l);for(let g=0;g<u;g++){const y=g*l;for(let b=0;b<l;b++){const w=Math.round(u-g-1),v=f+m+y+b;let S=c[v];if(w>=0&&w<u){const N=w*l,R=f+m+N+b;S=c[R]}i[v]=S}}}}return{dataId:r.write(i,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KZ(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=t,{strides:u,pad:l,dataFormat:c,dilations:h,dimRoundingMode:d,activation:f,leakyreluAlpha:p}=s;let m=EC({inputs:{x:r,filter:i},backend:e,attrs:{strides:u,pad:l,dataFormat:c,dilations:h,dimRoundingMode:d}});if(o){const g=m;if(c==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){const y=fn({inputs:{x:o},backend:e,attrs:{shape:[o.shape[0],1,1]}});m=zu({inputs:{a:m,b:y},backend:e}),e.disposeIntermediateTensorInfo(y)}else m=zu({inputs:{a:m,b:o},backend:e});e.disposeIntermediateTensorInfo(g)}if(f){const g=m;if(c==="NCHW"&&f==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const y=fn({inputs:{x:a},backend:e,attrs:{shape:[a.shape[0],1,1]}});m=Of(e,m,f,y,p),e.disposeIntermediateTensorInfo(y)}else m=Of(e,m,f,a,p);e.disposeIntermediateTensorInfo(g)}return m}const qZ={kernelName:xc,backendName:"cpu",kernelFunc:KZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XZ(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=t,{strides:u,pad:l,dataFormat:c,dilations:h,dimRoundingMode:d,activation:f,leakyreluAlpha:p}=s;let m=_C({inputs:{x:r,filter:i},backend:e,attrs:{strides:u,pad:l,dataFormat:c,dilations:h,dimRoundingMode:d}});if(o){const g=m;m=zu({inputs:{a:m,b:o},backend:e}),e.disposeIntermediateTensorInfo(g)}if(f){const g=m;m=Of(e,m,f,a,p),e.disposeIntermediateTensorInfo(g)}return m}const YZ={kernelName:wc,backendName:"cpu",kernelFunc:XZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZZ(n){const{inputs:t,backend:e}=n,{params:s,indices:r}=t,i=Et(s.shape),o=r.shape,a=o[o.length-1],[u,l,c,h]=Am(s,r);if(l===0)return e.makeTensorInfo(u,s.dtype,[]);const d=e.data.get(r.dataId).values,f=e.bufferSync(s),p=b4(d,f,s.dtype,l,a,c,h,s.shape,i);return e.makeTensorInfo(u,s.dtype,p.values)}const JZ={kernelName:lp,backendName:"cpu",kernelFunc:ZZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QZ(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,indices:i}=t,{axis:o,batchDims:a}=s;de([r,i],"gatherV2");const u=Pe(o,r.shape)[0],l=e.data.get(i.dataId).values,c=r.shape[u];for(let v=0;v<l.length;++v){const S=l[v];V(S<=c-1&&S>=0,()=>`GatherV2: the index value ${S} is not in [0, ${c-1}]`)}let h=a;a==null&&(h=0);const d=Et(i.shape),f=H2(r,i,u,h),p=fn({inputs:{x:r},backend:e,attrs:{shape:[f.batchSize,f.outerSize,f.dimSize,f.sliceSize]}}),m=fn({inputs:{x:i},backend:e,attrs:{shape:[f.batchSize,d/f.batchSize]}}),g=[f.batchSize,f.outerSize,d/f.batchSize,f.sliceSize],y=e.bufferSync(m),b=e.bufferSync(p),w=x4(b,y,g);return e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(m),e.makeTensorInfo(f.outputShape,w.dtype,w.values)}const tJ={kernelName:rh,backendName:"cpu",kernelFunc:QZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eJ(n){const{inputs:t,backend:e}=n,{input:s}=t,r=Et(s.shape),i=s.shape[s.shape.length-1],o=r/i,a=fn({inputs:{x:s},backend:e,attrs:{shape:[o,i]}}),u=AC(a,!0,e),l=fn({inputs:{x:u},backend:e,attrs:{shape:s.shape}});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(u),l}const nJ={kernelName:cp,backendName:"cpu",kernelFunc:eJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sJ=rn(cl,n=>Number.isFinite(n)?1:0,"bool"),rJ={kernelName:cl,backendName:"cpu",kernelFunc:sJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iJ=rn(hl,n=>Math.abs(n)===1/0?1:0,"bool"),oJ={kernelName:hl,backendName:"cpu",kernelFunc:iJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aJ=rn(dl,n=>Number.isNaN(n)?1:0,"bool"),uJ={kernelName:dl,backendName:"cpu",kernelFunc:aJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lJ(n){const{backend:t,attrs:e}=n,{start:s,stop:r,num:i}=e,o=I4(s,r,i);return t.makeTensorInfo([o.length],"float32",o)}const cJ={kernelName:dp,backendName:"cpu",kernelFunc:lJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hJ=rn(pl,n=>Math.log1p(n)),dJ={kernelName:pl,backendName:"cpu",kernelFunc:hJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fJ=Dn((n,t)=>n&&t),pJ=qn(lh,fJ,null,"bool"),mJ={kernelName:lh,backendName:"cpu",kernelFunc:pJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gJ=rn(ch,n=>n?0:1,"bool"),yJ={kernelName:ch,backendName:"cpu",kernelFunc:gJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bJ=Dn((n,t)=>n||t),xJ=qn(hh,bJ,null,"bool"),wJ={kernelName:hh,backendName:"cpu",kernelFunc:xJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vJ(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{depthRadius:i,bias:o,alpha:a,beta:u}=s;de(r,"LRN");const l=r.shape[3],c=l-1,h=e.data.get(r.dataId).values,d=Et(r.shape),f=new Float32Array(d);function p(m){const g=m%l;let y=m-g+Math.max(0,g-i);const b=m-g+Math.min(g+i,c);let w=0;for(;y<=b;y++){const v=h[y];w+=v*v}return w}for(let m=0;m<d;m++){const g=p(m),y=h[m]*Math.pow(o+a*g,-u);f[m]=y}return e.makeTensorInfo(r.shape,r.dtype,f)}const kJ={kernelName:dh,backendName:"cpu",kernelFunc:vJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SJ(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,y:i,dy:o}=t,{depthRadius:a,bias:u,alpha:l,beta:c}=s;de(o,"LRNGrad");const h=Et(o.shape),d=o.shape[3],f=e.data.get(o.dataId).values,p=e.data.get(r.dataId).values,m=e.data.get(i.dataId).values,g=new Float32Array(h),y=h;for(let b=0;b<y;b++){const w=b%d,v=b-w+Math.max(0,w-a),S=b-w+Math.min(d,w+a+1);let N=0;for(let R=v;R<S;R++)N+=Math.pow(p[R],2);N=l*N+u;for(let R=v;R<S;R++){let L=-2*l*c*p[R]*m[b]/N;b===R&&(L+=Math.pow(N,-c)),L*=f[b],g[R]+=L}}return e.makeTensorInfo(o.shape,r.dtype,g)}const IJ={kernelName:fp,backendName:"cpu",kernelFunc:SJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RC(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{reductionIndices:i,keepDims:o}=s,a=e;let u=r.shape;const l=u.length,c=Pe(i,u);let h=c;const d=Tn(h,l);let f=a.data.get(r.dataId).values;if(d!=null){const v=new Array(l);for(let S=0;S<v.length;S++)v[S]=u[d[S]];f=ty(f,u,r.dtype,d,v),h=Rn(h.length,l),u=v}de(r,"max"),fs("max",h,l);const[p,m]=is(u,h),g=Et(m),y=N4(f,g,p,r.dtype),b=a.write(y,p,r.dtype);let w=p;return o&&(w=An(p,c)),{dataId:b,shape:w,dtype:r.dtype}}const CJ={kernelName:fh,backendName:"cpu",kernelFunc:RC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NJ(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t;de(r,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:u}=s,l=1;V(ds(o,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${l}'`);const c=jr(r.shape,i,o,l,a,u);let h;if(c.filterWidth===1&&c.filterHeight===1&&Ve(c.inShape,c.outShape))h=Bi({inputs:{x:r},backend:e});else{const d=e.data.get(r.dataId).values,f=ge(r.shape),p=Dy(d,r.shape,r.dtype,f,c,"max");h=e.makeTensorInfo(c.outShape,r.dtype,p.values)}return h}const TJ={kernelName:ph,backendName:"cpu",kernelFunc:NJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $J(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{filterSize:i,strides:o,pad:a,dimRoundingMode:u,dataFormat:l}=s;de(r,"maxPool3d");const c=po(r.shape,i,o,1,a,u,l),h=e.data.get(r.dataId).values,d=$C(h,r.shape,r.dtype,ge(r.shape),c,"max");return e.makeTensorInfo(d.shape,"float32",d.values)}const EJ={kernelName:mh,backendName:"cpu",kernelFunc:$J};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _J(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,input:i}=t,{filterSize:o,strides:a,pad:u,dimRoundingMode:l}=s;de([r,i],"maxPool3DGrad");const c=po(i.shape,o,a,1,u,l),h=e.bufferSync(i),d=bY(h,c),f=c.strideDepth,p=c.strideHeight,m=c.strideWidth,g=c.dilationDepth,y=c.dilationHeight,b=c.dilationWidth,w=c.effectiveFilterDepth,v=c.effectiveFilterHeight,S=c.effectiveFilterWidth,N=w-1-c.padInfo.front,R=S-1-c.padInfo.left,L=v-1-c.padInfo.top,F=Fe(i.shape,"float32"),B=e.bufferSync(r);for(let H=0;H<c.batchSize;++H)for(let z=0;z<c.inChannels;++z)for(let G=0;G<c.inDepth;++G)for(let T=0;T<c.inHeight;++T)for(let K=0;K<c.inWidth;++K){const ht=G-N,rt=T-L,gt=K-R;let at=0;for(let It=0;It<w;It+=g){const et=(ht+It)/f;if(!(et<0||et>=c.outDepth||Math.floor(et)!==et))for(let st=0;st<v;st+=y){const St=(rt+st)/p;if(!(St<0||St>=c.outHeight||Math.floor(St)!==St))for(let kt=0;kt<S;kt+=b){const yt=(gt+kt)/m;if(yt<0||yt>=c.outWidth||Math.floor(yt)!==yt)continue;const Pt=w*v*S-1-d.get(H,et,St,yt,z),Xt=It*v*S+st*S+kt,Wt=Pt===Xt?1:0;if(Wt===0)continue;const Bt=B.get(H,et,St,yt,z);at+=Bt*Wt}}}F.set(at,H,G,T,K,z)}return e.makeTensorInfo(F.shape,F.dtype,F.values)}const AJ={kernelName:mp,backendName:"cpu",kernelFunc:_J};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RJ(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,input:i,output:o}=t,a=i;de([i,o],"maxPoolGrad");const{filterSize:u,strides:l,pad:c,dimRoundingMode:h}=s,d=jr(a.shape,u,l,1,c,h),f=e.data.get(a.dataId).values,p=Fe(d.outShape,a.dtype,TC(f,a.shape,a.dtype,d).values),m=d.strideHeight,g=d.strideWidth,y=d.dilationHeight,b=d.dilationWidth,w=d.effectiveFilterHeight,v=d.effectiveFilterWidth,S=v-1-d.padInfo.left,N=w-1-d.padInfo.top,R=Fe(a.shape,"float32"),L=e.data.get(r.dataId).values,F=Fe(r.shape,"float32",L);for(let B=0;B<d.batchSize;++B)for(let H=0;H<d.inChannels;++H)for(let z=0;z<d.inHeight;++z)for(let G=0;G<d.inWidth;++G){const T=z-N,K=G-S;let ht=0;for(let rt=0;rt<w;rt+=y){const gt=(T+rt)/m;if(!(gt<0||gt>=d.outHeight||Math.floor(gt)!==gt))for(let at=0;at<v;at+=b){const It=(K+at)/g;if(It<0||It>=d.outWidth||Math.floor(It)!==It)continue;const et=w*v-1-p.get(B,gt,It,H),st=rt*v+at,St=et===st?1:0;if(St===0)continue;const kt=F.get(B,gt,It,H);ht+=kt*St}}R.set(ht,B,z,G,H)}return e.makeTensorInfo(R.shape,R.dtype,R.values)}const DJ={kernelName:pp,backendName:"cpu",kernelFunc:RJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OJ(n,t,e,s,r){const i=ge(t),o=Dy(n,t,e,i,r,"max"),a=TC(n,t,e,r,!0,s);return[o.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FJ={kernelName:gp,backendName:"cpu",kernelFunc:({inputs:n,attrs:t,backend:e})=>{const{x:s}=n,{filterSize:r,strides:i,pad:o,includeBatchInIndex:a}=t,u=e;de(s,"MaxPoolWithArgmax");const l=u.data.get(s.dataId).values,c=jr(s.shape,r,i,[1,1],o),[h,d]=OJ(l,s.shape,s.dtype,a,c),f=u.write(h,c.outShape,s.dtype),p=u.write(d,c.outShape,s.dtype);return[{dataId:f,shape:c.outShape,dtype:s.dtype},{dataId:p,shape:c.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LJ(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i,keepDims:o}=s,a=Pe(i,r.shape),l=is(r.shape,a)[1],c=Et(l),h=[],d=e.makeTensorInfo([],"float32",new Float32Array([c]));h.push(d);const f=Ho({inputs:{x:r},backend:e,attrs:{dtype:"float32"}});h.push(f);const p=Oy({inputs:{a:f,b:d},backend:e});h.push(p);const m=Sd({inputs:{x:p},backend:e,attrs:{axis:i,keepDims:o}});return h.forEach(g=>e.disposeIntermediateTensorInfo(g)),m}const PJ={kernelName:gh,backendName:"cpu",kernelFunc:LJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MJ(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i,keepDims:o}=s;de(r,"min");const a=Pe(i,r.shape);let u=a;const l=Tn(u,r.shape.length);let c=r;l!=null&&(c=Ys({inputs:{x:r},backend:e,attrs:{perm:l}}),u=Rn(u.length,r.shape.length)),fs("min",u,c.shape.length);const[h,d]=is(c.shape,u),f=Et(d),p=ls(Et(h),c.dtype),m=e.data.get(c.dataId).values;for(let y=0;y<p.length;++y){const b=y*f;let w=m[b];for(let v=0;v<f;++v){const S=m[b+v];(Number.isNaN(S)||S<w)&&(w=S)}p[y]=w}l!=null&&e.disposeIntermediateTensorInfo(c);const g=e.makeTensorInfo(h,c.dtype,p);if(o){const y=An(h,a),b=fn({inputs:{x:g},backend:e,attrs:{shape:y}});return e.disposeIntermediateTensorInfo(g),b}return g}const zJ={kernelName:yh,backendName:"cpu",kernelFunc:MJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BJ(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{paddings:i,mode:o}=s;de(r,"mirrorPad");const a=i.map((w,v)=>w[0]+r.shape[v]+w[1]),u=i.map(w=>w[0]),l=i.map((w,v)=>w[0]+r.shape[v]),c=o==="reflect"?0:1,h=e.data.get(r.dataId).values,d=r.shape.length,f=ge(r.shape),p=Et(a),m=a.length,g=ge(a),y=ss(r.dtype,p);for(let w=0;w<p;w++){let v=Ya(w,m,g);for(let N=0;N<m;N++)v[N]<u[N]?v[N]=u[N]*2-v[N]-c:v[N]>=l[N]&&(v[N]=(l[N]-1)*2-v[N]+c);v=v.map((N,R)=>N-u[R]);const S=ri(v,d,f);y[w]=h[S]}return{dataId:e.write(y,a,r.dtype),shape:a,dtype:r.dtype}}const VJ={kernelName:bh,backendName:"cpu",kernelFunc:BJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UJ=Dn((n,t)=>{const e=n%t;return n<0&&t<0||n>=0&&t>=0?e:(e+t)%t}),WJ=qn(yl,UJ),GJ={kernelName:yl,backendName:"cpu",kernelFunc:WJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DC(n){const{inputs:t,backend:e,attrs:s}=n,{logits:r}=t,{dim:i}=s,o=r.shape.length;let a=i;if(a===-1&&(a=o-1),a!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${a}`);const u=Pe([a],r.shape),l=RC({inputs:{x:r},backend:e,attrs:{reductionIndices:u,keepDims:!1}}),c=An(l.shape,u),h=fn({inputs:{x:l},backend:e,attrs:{shape:c}}),d=ny({inputs:{a:r,b:h},backend:e}),f=p4({inputs:{x:d},backend:e}),p=Sd({inputs:{x:f},backend:e,attrs:{axis:u,keepDims:!1}}),m=fn({inputs:{x:p},backend:e,attrs:{shape:c}}),g=Oy({inputs:{a:f,b:m},backend:e});return e.disposeIntermediateTensorInfo(l),e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(m),g}const jJ={kernelName:Lh,backendName:"cpu",kernelFunc:DC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HJ(n){const{inputs:t,backend:e,attrs:s}=n,{logits:r}=t,{numSamples:i,seed:o,normalized:a}=s;de(r,"multinomial");const u=a?r:DC({inputs:{logits:r},backend:e,attrs:{dim:-1}}),l=u.shape[0],c=u.shape[1],h=e.data.get(u.dataId).values,d=[l,i],f=ls(Et(d),"int32");for(let p=0;p<l;++p){const m=p*c,g=new Float32Array(c-1);g[0]=h[m];for(let w=1;w<g.length;++w)g[w]=g[w-1]+h[m+w];const y=om.alea(o.toString()),b=p*i;for(let w=0;w<i;++w){const v=y();f[b+w]=g.length;for(let S=0;S<g.length;S++)if(v<g[S]){f[b+w]=S;break}}}return a||e.disposeIntermediateTensorInfo(u),e.makeTensorInfo(d,"int32",f)}const KJ={kernelName:yp,backendName:"cpu",kernelFunc:HJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qJ=Tm;function XJ(n){const{inputs:t,backend:e,attrs:s}=n,{boxes:r,scores:i}=t,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u}=s;de(r,"NonMaxSuppression");const l=e.data.get(r.dataId).values,c=e.data.get(i.dataId).values,{selectedIndices:h}=qJ(l,c,o,a,u);return e.makeTensorInfo([h.length],"int32",new Int32Array(h))}const YJ={kernelName:bp,backendName:"cpu",kernelFunc:XJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZJ=$m;function JJ(n){const{inputs:t,backend:e,attrs:s}=n,{boxes:r,scores:i}=t,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u,padToMaxOutputSize:l}=s;de(r,"NonMaxSuppressionPadded");const c=e.data.get(r.dataId).values,h=e.data.get(i.dataId).values,{selectedIndices:d,validOutputs:f}=ZJ(c,h,o,a,u,l);return[e.makeTensorInfo([d.length],"int32",new Int32Array(d)),e.makeTensorInfo([],"int32",new Int32Array([f]))]}const QJ={kernelName:xp,backendName:"cpu",kernelFunc:JJ};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tQ=Em;function eQ(n){const{inputs:t,backend:e,attrs:s}=n,{boxes:r,scores:i}=t,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u,softNmsSigma:l}=s;de(r,"NonMaxSuppressionWithScore");const c=e.data.get(r.dataId).values,h=e.data.get(i.dataId).values,d=o,f=a,p=u,m=l,{selectedIndices:g,selectedScores:y}=tQ(c,h,d,f,p,m);return[e.makeTensorInfo([g.length],"int32",new Int32Array(g)),e.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const nQ={kernelName:wp,backendName:"cpu",kernelFunc:eQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sQ(n){const{inputs:t,backend:e,attrs:s}=n,{indices:r}=t,{dtype:i,depth:o,onValue:a,offValue:u}=s;de(r,"oneHot");const l=Et(r.shape),c=new Float32Array(l*o);c.fill(u);const h=e.data.get(r.dataId).values;for(let d=0;d<l;++d)h[d]>=0&&h[d]<o&&(c[d*o+h[d]]=a);return e.makeTensorInfo([...r.shape,o],i,c)}const rQ={kernelName:kh,backendName:"cpu",kernelFunc:sQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lf(n){const{inputs:t,backend:e}=n,{x:s}=t;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const r=Wa({inputs:{input:s},backend:e}),i=Lf({inputs:{x:r},backend:e}),o=Vu({inputs:{input:s},backend:e}),a=Lf({inputs:{x:o},backend:e}),u=rr({inputs:{real:i,imag:a},backend:e});return e.disposeIntermediateTensorInfo(r),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(a),u}else return Fy({backend:e,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const iQ={kernelName:Bh,backendName:"cpu",kernelFunc:Lf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OC(n){const{inputs:t,backend:e}=n,{x:s}=t;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const r=Wa({inputs:{input:s},backend:e}),i=OC({inputs:{x:r},backend:e}),o=Vu({inputs:{input:s},backend:e}),a=Lf({inputs:{x:o},backend:e}),u=rr({inputs:{real:i,imag:a},backend:e});return e.disposeIntermediateTensorInfo(r),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(a),u}else return Fy({backend:e,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const oQ={kernelName:vh,backendName:"cpu",kernelFunc:OC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FC(n){const{inputs:t,backend:e,attrs:s}=n,{axis:r}=s;if(t.length===1)return Ff({inputs:{input:t[0]},backend:e,attrs:{dim:r}});const i=t[0].shape,o=t[0].dtype;t.forEach(c=>{hs(i,c.shape,"All tensors passed to stack must have matching shapes"),V(o===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],u=t.map(c=>{const h=Ff({inputs:{input:c},backend:e,attrs:{dim:r}});return a.push(h),h}),l=Uu({inputs:u,backend:e,attrs:{axis:r}});return a.forEach(c=>e.disposeIntermediateTensorInfo(c)),l}const aQ={kernelName:Sh,backendName:"cpu",kernelFunc:FC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uQ(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{paddings:i,constantValue:o}=s;de(r,"pad");const a=i.map((b,w)=>b[0]+r.shape[w]+b[1]),u=i.map(b=>b[0]),l=e.data.get(r.dataId).values,c=Et(r.shape),h=r.shape.length,d=ge(r.shape),f=Et(a),p=a.length,m=ge(a),g=ss(r.dtype,f);o!==0&&g.fill(o);for(let b=0;b<c;b++){const v=Ya(b,h,d).map((N,R)=>N+u[R]),S=ri(v,p,m);g[S]=l[b]}return{dataId:e.write(g,a,r.dtype),shape:a,dtype:r.dtype}}const LC={kernelName:Ih,backendName:"cpu",kernelFunc:uQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lQ=Dn((n,t)=>Math.pow(n,t)),cQ=qn(xl,lQ),hQ={kernelName:xl,backendName:"cpu",kernelFunc:cQ};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dQ(n){const{inputs:t,backend:e,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:i,indices:o}=t,a=r.map(g=>e.data.get(g.dataId).values),u=r.map(g=>g.shape),l=e.data.get(i.dataId).values,c=e.data.get(o.dataId).values,[h,d,f]=R4(a,u,l,i.shape,i.dtype,c,o.shape),p=h.map(g=>e.makeTensorInfo([g.length],"int32",g)),m=e.makeTensorInfo(f,i.dtype,d);return p.concat([m])}const fQ={kernelName:vp,backendName:"cpu",kernelFunc:dQ};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pQ(n){const{inputs:t,backend:e}=n,{starts:s,limits:r,deltas:i}=t,o=e.data.get(s.dataId).values,a=e.data.get(r.dataId).values,u=e.data.get(i.dataId).values,[l,c]=D4(o,s.shape,s.dtype,a,r.shape,u,i.shape),h=e.makeTensorInfo([l.length],"int32",l),d=e.makeTensorInfo([c.length],s.dtype,c);return[h,d]}const mQ={kernelName:kp,backendName:"cpu",kernelFunc:pQ};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gQ(n){const{inputs:t,backend:e,attrs:s}=n,{shape:r,values:i,defaultValue:o,rowPartitionTensors:a}=t,{rowPartitionTypes:u}=s,l=e.data.get(r.dataId).values,c=e.data.get(i.dataId).values,h=e.data.get(o.dataId).values,d=a.map(g=>e.data.get(g.dataId).values),f=a.map(g=>g.shape),[p,m]=O4(l,r.shape,c,i.shape,i.dtype,h,o.shape,d,f,u);return e.makeTensorInfo(p,i.dtype,m)}const yQ={kernelName:Sp,backendName:"cpu",kernelFunc:gQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bQ(n){const{backend:t,attrs:e}=n,{start:s,stop:r,dtype:i,step:o}=e,a=F4(s,r,o,i);return t.makeTensorInfo([a.length],i,a)}const xQ={kernelName:Ip,backendName:"cpu",kernelFunc:bQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wQ=rn(wl,n=>1/n),vQ={kernelName:wl,backendName:"cpu",kernelFunc:wQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kQ(n){const{inputs:t,backend:e,attrs:s}=n,{images:r}=t,{alignCorners:i,halfPixelCenters:o,size:a}=s;de(r,"resizeBilinear");const u=ge(r.shape),[l,c]=a,[h,d,f,p]=r.shape,m=e.data.get(r.dataId).values,g=new Float32Array(Et([h,l,c,p])),y=[i&&l>1?d-1:d,i&&c>1?f-1:f],b=[i&&l>1?l-1:l,i&&c>1?c-1:c];let w=0;const v=y[0]/b[0],S=y[1]/b[1];for(let N=0;N<h;N++)for(let R=0;R<l;R++){let L;o?L=v*(R+.5)-.5:L=v*R;const F=Math.max(0,Math.floor(L)),B=L-F,H=Math.min(d-1,Math.ceil(L)),z=N*u[0]+F*u[1],G=N*u[0]+H*u[1];for(let T=0;T<c;T++){let K;o?K=S*(T+.5)-.5:K=S*T;const ht=Math.max(0,Math.floor(K)),rt=K-ht,gt=Math.min(f-1,Math.ceil(K)),at=z+ht*u[2],It=G+ht*u[2],et=z+gt*u[2],st=G+gt*u[2];for(let St=0;St<p;St++){const kt=m[at+St],yt=m[It+St],Pt=m[et+St],Xt=m[st+St],Wt=kt+(Pt-kt)*rt,Bt=yt+(Xt-yt)*rt,Jt=Wt+(Bt-Wt)*B;g[w++]=Jt}}}return e.makeTensorInfo([h,l,c,p],"float32",g)}const SQ={kernelName:Eh,backendName:"cpu",kernelFunc:kQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IQ(n){const{inputs:t,backend:e,attrs:s}=n,{images:r,dy:i}=t,{alignCorners:o}=s;de([i,r],"resizeBilinearGrad");const a=ge(r.shape),[u,l,c,h]=r.shape,[,d,f]=i.shape,p=new Float32Array(u*l*c*h),m=[o&&d>1?l-1:l,o&&f>1?c-1:c],g=[o&&d>1?d-1:d,o&&f>1?f-1:f],y=m[0]/g[0],b=m[1]/g[1],w=e.data.get(i.dataId).values;let v=0;for(let S=0;S<u;S++){const N=S*a[0];for(let R=0;R<d;R++){const L=R*y,F=Math.floor(L),B=Math.min(Math.ceil(L),l-1),H=N+F*a[1],z=N+B*a[1],G=L-F,T=1-G;for(let K=0;K<f;K++){const ht=K*b,rt=Math.floor(ht),gt=Math.min(Math.ceil(ht),c-1),at=ht-rt,It=1-at,et=H+rt*a[2],st=H+gt*a[2],St=z+rt*a[2],kt=z+gt*a[2],yt=T*It,Pt=T*at,Xt=G*It,Wt=G*at;for(let Bt=0;Bt<h;Bt++){const Jt=w[v++];p[et+Bt]+=Jt*yt,p[st+Bt]+=Jt*Pt,p[St+Bt]+=Jt*Xt,p[kt+Bt]+=Jt*Wt}}}}return e.makeTensorInfo([u,c,l,h],"float32",p)}const CQ={kernelName:Tp,backendName:"cpu",kernelFunc:IQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NQ(n){const{inputs:t,backend:e,attrs:s}=n,{images:r}=t,{alignCorners:i,halfPixelCenters:o,size:a}=s;de(r,"resizeNearestNeighbor");const u=ge(r.shape),[l,c]=a,[h,d,f,p]=r.shape,m=e.data.get(r.dataId).values,g=new Float32Array(h*l*c*p),y=[i&&l>1?d-1:d,i&&c>1?f-1:f],b=[i&&l>1?l-1:l,i&&c>1?c-1:c],w=y[0]/b[0],v=y[1]/b[1];let S=0;for(let N=0;N<h;N++){const R=N*u[0];for(let L=0;L<l;L++){const F=o?w*(L+.5):w*L;let B=Math.min(d-1,i?Math.round(F):Math.floor(F));o&&(B=Math.max(0,B));const H=R+B*u[1];for(let z=0;z<c;z++){const G=o?v*(z+.5):v*z;let T=Math.min(f-1,i?Math.round(G):Math.floor(G));o&&(T=Math.max(0,T));const K=H+T*u[2];for(let ht=0;ht<p;ht++){const rt=m[K+ht];g[S++]=rt}}}}return e.makeTensorInfo([h,l,c,p],r.dtype,g)}const TQ={kernelName:$h,backendName:"cpu",kernelFunc:NQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Q(n){const{inputs:t,backend:e,attrs:s}=n,{images:r,dy:i}=t,{alignCorners:o}=s;de([i,r],"resizeNearestNeighborGrad");const a=ge(r.shape),u=ge(i.shape),[l,c,h,d]=r.shape,[,f,p]=i.shape,m=new Float32Array(l*c*h*d),g=e.data.get(i.dataId).values,y=[o&&f>1?c-1:c,o&&p>1?h-1:h],b=[o&&f>1?f-1:f,o&&p>1?p-1:p],w=y[0]/b[0],v=y[1]/b[1],S=1/w,N=1/v,R=Math.ceil(S)*2+2,L=Math.ceil(N)*2+2;for(let F=0;F<l;F++){const B=F*a[0];for(let H=0;H<c;H++){const z=B+H*a[1],G=Math.floor(H*S),T=Math.floor(G-R/2);for(let K=0;K<h;K++){const ht=z+K*a[2],rt=Math.floor(K*N),gt=Math.floor(rt-L/2);for(let at=0;at<d;at++){let It=0;for(let et=0;et<R;et++){const st=et+T;if(st<0||st>=f)continue;const St=B+st*u[1],kt=st*w,yt=Math.min(c-1,o?Math.round(kt):Math.floor(kt));if(H===yt)for(let Pt=0;Pt<L;Pt++){const Xt=Pt+gt;if(Xt<0||Xt>=p)continue;const Wt=St+Xt*u[2],Bt=Xt*v,Jt=Math.min(h-1,o?Math.round(Bt):Math.floor(Bt));K===Jt&&(It+=g[Wt+at])}}m[ht+at]=It}}}}return e.makeTensorInfo(r.shape,r.dtype,m)}const EQ={kernelName:Np,backendName:"cpu",kernelFunc:$Q};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Q(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{dims:i}=s;de(r,"reverse");const o=r.shape.length,a=Pe(i,r.shape);if(o===0)return Bi({inputs:{x:r},backend:e});const u=new Vn(r.shape,r.dtype),l=e.bufferSync(r);for(let c=0;c<u.size;c++){const h=u.indexToLoc(c),d=h.slice();a.forEach(f=>d[f]=r.shape[f]-1-d[f]),u.set(l.get(...d),...h)}return e.makeTensorInfo(u.shape,u.dtype,u.values)}const AQ={kernelName:_h,backendName:"cpu",kernelFunc:_Q};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RQ={kernelName:Gp,backendName:"cpu",kernelFunc:({inputs:n,attrs:t,backend:e})=>{const{image:s}=n,{radians:r,fillValue:i,center:o}=t,a=e,u=ss(s.dtype,Et(s.shape)),[l,c,h,d]=s.shape,[f,p]=_2(o,c,h),m=255,g=Math.sin(r),y=Math.cos(r),b=a.data.get(s.dataId).values;for(let v=0;v<l;v++){const S=v*h*c*d;for(let N=0;N<c;N++){const R=N*(h*d);for(let L=0;L<h;L++){const F=L*d;for(let B=0;B<d;B++){const H=[l,N,L,B],z=H[2],G=H[1];let T=(z-f)*y-(G-p)*g,K=(z-f)*g+(G-p)*y;T=Math.round(T+f),K=Math.round(K+p);let ht=i;if(typeof i!="number"&&(B===3?ht=m:ht=i[B]),T>=0&&T<h&&K>=0&&K<c){const gt=K*(h*d),at=T*d,It=S+gt+at+B;ht=b[It]}const rt=S+R+F+B;u[rt]=ht}}}}return{dataId:a.write(u,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DQ=rn(Sl,n=>{const t=Math.floor(n);return n-t<.5?Math.floor(n):n-t>.5?Math.ceil(n):t%2===0?t:t+1}),OQ={kernelName:Sl,backendName:"cpu",kernelFunc:DQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FQ(n){const{inputs:t,backend:e,attrs:s}=n,{indices:r,updates:i}=t,{shape:o}=s,{sliceRank:a,numUpdates:u,sliceSize:l,strides:c,outputSize:h}=ra(i,r,o),d=!0,f=e.bufferSync(r),p=e.bufferSync(i),m=$a(f,p,o,h,l,u,a,c,0,d);return e.makeTensorInfo(o,m.dtype,m.values)}const LQ={kernelName:$p,backendName:"cpu",kernelFunc:FQ};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PQ(n,t){let e=0,s=n.length,r=0;for(;e<s;)r=Math.floor((e+s)/2),n[r]<t?e=r+1:s=r;return s}function MQ(n,t){let e=0,s=n.length,r=0;for(;e<s;)r=Math.floor((e+s)/2),n[r]<=t?e=r+1:s=r;return s}function zQ(n,t,e,s,r,i){const o=En("int32",e*r);for(let a=0;a<e;++a){const u=n.slice(a*s,(a+1)*s),l=a*r;for(let c=0;c<r;++c)o[l+c]=i==="left"?PQ(u,t[c+l]):MQ(u,t[c+l])}return o}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BQ(n){const{inputs:t,backend:e,attrs:s}=n,{sortedSequence:r,values:i}=t,{side:o}=s,a=e.data.get(r.dataId).values,u=e.data.get(i.dataId).values,l=zQ(a,u,r.shape[0],r.shape[1],i.shape[1],o);return e.makeTensorInfo(i.shape,"int32",l)}const VQ={kernelName:_p,backendName:"cpu",kernelFunc:BQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UQ(n){const{inputs:t,backend:e}=n,{condition:s,t:r,e:i}=t;de([s,r,i],"select");const o=s.shape.length,a=e.data.get(s.dataId).values,u=e.data.get(r.dataId).values,l=e.data.get(i.dataId).values,c=qs(r.dtype,i.dtype),h=ls(Et(r.shape),c);let d=0;const f=o===0||o>1||r.shape.length===1?1:Et(r.shape.slice(1));for(let p=0;p<a.length;p++)for(let m=0;m<f;m++)a[p]===1?h[d++]=u[p]:h[d++]=l[p];return e.makeTensorInfo(r.shape,c,h)}const WQ={kernelName:Ah,backendName:"cpu",kernelFunc:UQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GQ=Om,jQ=Fm,HQ=rn(Cl,n=>n>=0?jQ*n:GQ*(Math.exp(n)-1)),KQ={kernelName:Cl,backendName:"cpu",kernelFunc:HQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qQ=rn($l,n=>n<0?-1:n>0?1:0),XQ={kernelName:$l,backendName:"cpu",kernelFunc:qQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YQ=rn(Nl,n=>Math.sin(n)),ZQ={kernelName:Nl,backendName:"cpu",kernelFunc:YQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JQ=rn(Tl,n=>Math.sinh(n)),QQ={kernelName:Tl,backendName:"cpu",kernelFunc:JQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ttt=11920928955078125e-23,tx=Math.log(ttt)+2,ett=rn(_l,n=>{const t=n>-tx,e=n<tx,s=Math.exp(n);let r;return e?r=s:t?r=n:r=Math.log(1+s),r}),ntt={kernelName:_l,backendName:"cpu",kernelFunc:ett};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function stt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{blockShape:i,paddings:o}=s;de([r],"spaceToBatchND");const a=Et(i),u=[[0,0]];u.push(...o);for(let N=1+i.length;N<r.shape.length;++N)u.push([0,0]);const l=LC.kernelFunc({inputs:{x:r},backend:e,attrs:{paddings:u,constantValue:0}}),c=od(l.shape,i,a,!1),h=ad(c.length,i.length,!1),d=ud(l.shape,i,a,!1),m=fn({inputs:{x:l},backend:e,attrs:{shape:c}}),b=Ys({inputs:{x:m},backend:e,attrs:{perm:h}}),S=fn({inputs:{x:b},backend:e,attrs:{shape:d}});return e.disposeIntermediateTensorInfo(l),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(b),S}const rtt={kernelName:Oh,backendName:"cpu",kernelFunc:stt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function itt(n){const{inputs:t,backend:e}=n,{indices:s,values:r,denseShape:i,defaultValue:o}=t;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${i.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=e.data.get(s.dataId).values,u=e.data.get(r.dataId).values,l=e.data.get(i.dataId).values,c=e.data.get(o.dataId).values[0],[h,d,f,p,m]=z4(a,s.shape,s.dtype,u,r.dtype,l,c);return[e.makeTensorInfo(d,s.dtype,h),e.makeTensorInfo([d[0]],r.dtype,f),e.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(g=>Number(g)))),e.makeTensorInfo([m.length],s.dtype,new Int32Array(m))]}const ott={kernelName:Ap,backendName:"cpu",kernelFunc:itt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function att(n){const{inputs:t,backend:e}=n,{inputIndices:s,inputShape:r,newShape:i}=t;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(e.data.get(r.dataId).values),a=e.data.get(s.dataId).values,u=Array.from(e.data.get(i.dataId).values),[l,c,h]=B4(a,s.shape,s.dtype,o,u);return[e.makeTensorInfo(c,s.dtype,l),e.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}const utt={kernelName:Rp,backendName:"cpu",kernelFunc:att};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ltt(n){const{inputs:t,backend:e}=n,{data:s,indices:r,segmentIds:i}=t;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${i.shape}`);if(r.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=e.data.get(s.dataId).values,a=e.data.get(r.dataId).values,u=e.data.get(i.dataId).values,[l,c]=ey(o,s.shape,s.dtype,a,u,!0);return e.makeTensorInfo(c,s.dtype,l)}const ctt={kernelName:Dp,backendName:"cpu",kernelFunc:ltt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function htt(n){const{inputs:t,backend:e}=n,{data:s,indices:r,segmentIds:i}=t;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${i.shape}`);if(r.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=e.data.get(s.dataId).values,a=e.data.get(r.dataId).values,u=e.data.get(i.dataId).values,[l,c]=ey(o,s.shape,s.dtype,a,u);return e.makeTensorInfo(c,s.dtype,l)}const dtt={kernelName:Op,backendName:"cpu",kernelFunc:htt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ftt(n){const{inputs:t,backend:e,attrs:s}=n,{sparseIndices:r,sparseValues:i,defaultValue:o}=t,{outputShape:a}=s,{sliceRank:u,numUpdates:l,sliceSize:c,strides:h,outputSize:d}=ra(i,r,a),f=!1,p=e.bufferSync(r);let m;switch(i.dtype){case"bool":{const g=e.bufferSync(i),y=!!e.data.get(o.dataId).values[0];m=$a(p,g,a,d,c,l,u,h,y,f);break}case"float32":{const g=e.bufferSync(i),y=e.data.get(o.dataId).values[0];m=$a(p,g,a,d,c,l,u,h,y,f);break}case"int32":{const g=e.bufferSync(i),y=e.data.get(o.dataId).values[0];m=$a(p,g,a,d,c,l,u,h,y,f);break}case"string":{const g=e.bufferSync(i),y=no(e.data.get(o.dataId).values[0]);m=$a(p,g,a,d,c,l,u,h,y,f);break}default:throw new Error(`Unsupported type ${i.dtype}`)}return e.makeTensorInfo(a,m.dtype,m.values)}const ptt={kernelName:Fp,backendName:"cpu",kernelFunc:ftt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mtt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{numOrSizeSplits:i,axis:o}=s,a=Pe(o,r.shape)[0],u=j2(r,i,a),l=new Array(r.shape.length).fill(0),c=r.shape.slice();return u.map(h=>{const d=[...c];d[a]=h;const f=Ga({inputs:{x:r},backend:e,attrs:{begin:l,size:d}});return l[a]+=h,f})}const gtt={kernelName:Fh,backendName:"cpu",kernelFunc:mtt};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ytt={kernelName:Lp,backendName:"cpu",kernelFunc:({inputs:n,backend:t})=>{const{x:e}=n,s=t;de(e,"square");const r=s.data.get(e.dataId).values,i=new Float32Array(r.length);for(let a=0;a<r.length;++a){const u=r[a];i[a]=u*u}return{dataId:s.write(i,e.shape,e.dtype),shape:e.shape,dtype:e.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const btt=rn(Pl,(n,t)=>{const e=t;return isNaN(n)?NaN:n>0?1:e.alpha}),xtt={kernelName:Pl,backendName:"cpu",kernelFunc:btt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wtt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{begin:i,end:o,strides:a,beginMask:u,endMask:l,ellipsisMask:c,newAxisMask:h,shrinkAxisMask:d}=s;de(r,"stridedSlice");const{finalShapeSparse:f,finalShape:p,isIdentity:m,sliceDim0:g,isSimpleSlice:y,begin:b,end:w,strides:v}=N2(r.shape,i,o,a,u,l,c,h,d);let S;if(m)S=fn({inputs:{x:r},backend:e,attrs:{shape:p}});else if(g||y){V(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const N=S2(b,w,v),R=Ga({inputs:{x:r},backend:e,attrs:{begin:b,size:N}});S=fn({inputs:{x:R},backend:e,attrs:{shape:p}}),e.disposeIntermediateTensorInfo(R)}else{const N=e.bufferSync(r),R=W4(f,N,v,b);S=e.makeTensorInfo(p,R.dtype,R.values)}return S}const vtt={kernelName:Pp,backendName:"cpu",kernelFunc:wtt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ktt(n){const{inputs:t,backend:e,attrs:s}=n,{separator:r,nGramWidths:i,leftPad:o,rightPad:a,padWidth:u,preserveShortSequences:l}=s,{data:c,dataSplits:h}=t,d=e.data.get(c.dataId).values,f=e.data.get(h.dataId).values,[p,m]=G4(d,f,r,i,o,a,u,l);return[e.makeTensorInfo([p.length],"string",p),e.makeTensorInfo(h.shape,"int32",m)]}const Stt={kernelName:Mp,backendName:"cpu",kernelFunc:ktt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Itt(n){const{inputs:t,backend:e,attrs:s}=n,{skipEmpty:r}=s,{input:i,delimiter:o}=t;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=e.data.get(i.dataId).values,u=e.data.get(o.dataId).values[0],[l,c,h]=j4(a,u,r),d=c.length;return[e.makeTensorInfo([d,2],"int32",l),e.makeTensorInfo([d],"string",c),e.makeTensorInfo([2],"int32",new Int32Array(h))]}const Ctt={kernelName:zp,backendName:"cpu",kernelFunc:Itt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ntt(n){const{inputs:t,backend:e,attrs:s}=n,{numBuckets:r}=s,{input:i}=t;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=e.data.get(i.dataId).values,a=H4(o,r);return e.makeTensorInfo(i.shape,"int32",a)}const Ttt={kernelName:Bp,backendName:"cpu",kernelFunc:Ntt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $tt=rn(Ol,n=>Math.tan(n)),Ett={kernelName:Ol,backendName:"cpu",kernelFunc:$tt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _tt=rn(Fl,n=>Math.tanh(n)),Att={kernelName:Fl,backendName:"cpu",kernelFunc:_tt};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rtt(n){const{inputs:t,backend:e}=n,{tensor:s,indices:r,updates:i}=t,{sliceRank:o,numUpdates:a,sliceSize:u,strides:l,outputSize:c}=ra(i,r,s.shape),h=!1,d=e.bufferSync(r),f=e.bufferSync(i),p=e.bufferSync(s),m=$a(d,f,s.shape,c,u,a,o,l,p,h);return e.makeTensorInfo(s.shape,m.dtype,m.values)}const Dtt={kernelName:Ep,backendName:"cpu",kernelFunc:Rtt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ott(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{reps:i}=s;de(r,"tile");const o=q4(e.bufferSync(r),i);return e.makeTensorInfo(o.shape,o.dtype,o.values)}const Ftt={kernelName:Ll,backendName:"cpu",kernelFunc:Ott};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ltt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{k:i,sorted:o}=s;de(r,"topk");const a=e.data.get(r.dataId).values,[u,l]=Y4(a,r.shape,r.dtype,i,o);return[e.makeTensorInfo(u.shape,u.dtype,u.values),e.makeTensorInfo(l.shape,l.dtype,l.values)]}const Ptt={kernelName:Vp,backendName:"cpu",kernelFunc:Ltt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mtt(n){const{inputs:t,attrs:e,backend:s}=n,{image:r,transforms:i}=t,{interpolation:o,fillMode:a,fillValue:u,outputShape:l}=e,[c,h,d,f]=r.shape,[p,m]=l??[h,d],g=[c,p,m,f],y=ge(r.shape),b=y[0],w=y[1],v=y[2],S=ge(g),N=S[0],R=S[1],L=S[2],F=ss(r.dtype,Et(g));F.fill(u);const B=s.data.get(r.dataId).values,H=s.data.get(i.dataId).values;for(let G=0;G<c;++G){const T=i.shape[0]===1?H:H.subarray(G*8,G*8+8);for(let K=0;K<p;++K)for(let ht=0;ht<m;++ht)for(let rt=0;rt<f;++rt){let gt;const at=T[6]*ht+T[7]*K+1;if(at===0)continue;const It=(T[0]*ht+T[1]*K+T[2])/at,et=(T[3]*ht+T[4]*K+T[5])/at,st=ex(It,d,a),St=ex(et,h,a);switch(o){case"nearest":gt=Gtt(B,h,d,b,w,v,G,St,st,rt,u);break;case"bilinear":gt=jtt(B,h,d,b,w,v,G,St,st,rt,u);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${o}`)}const kt=G*N+K*R+ht*L+rt;F[kt]=gt}return s.makeTensorInfo(g,r.dtype,F)}return{dataId:s.write(F,g,r.dtype),shape:r.shape,dtype:r.dtype}}const ztt={kernelName:Up,backendName:"cpu",kernelFunc:Mtt};function ex(n,t,e){switch(e){case"reflect":return Btt(n,t);case"wrap":return Vtt(n,t);case"nearest":return Wtt(n,t);case"constant":default:return Utt(n)}}function Btt(n,t){let e=n;if(e<0)if(t<=1)e=0;else{const s=2*t;e<s&&(e=s*Math.trunc(-e/s)+e),e=e<-t?e+s:-e-1}else if(e>t-1)if(t<=1)e=0;else{const s=2*t;e-=s*Math.trunc(e/s),e>=t&&(e=s-e-1)}return Bo(0,e,t-1)}function Vtt(n,t){let e=n;if(e<0)if(t<=1)e=0;else{const s=t-1;e+=t*(Math.trunc(-e/s)+1)}else if(e>t-1)if(t<=1)e=0;else{const s=t-1;e-=t*Math.trunc(e/s)}return Bo(0,e,t-1)}function Utt(n,t){return n}function Wtt(n,t){return Bo(0,n,t-1)}function pc(n,t,e,s,r,i,o,a,u,l,c){const h=o*s+a*r+u*i+l;return 0<=a&&a<t&&0<=u&&u<e?n[h]:c}function Gtt(n,t,e,s,r,i,o,a,u,l,c){const h=Math.round(a),d=Math.round(u);return pc(n,t,e,s,r,i,o,h,d,l,c)}function jtt(n,t,e,s,r,i,o,a,u,l,c){const h=Math.floor(a),d=Math.floor(u),f=h+1,p=d+1,m=(p-u)*pc(n,t,e,s,r,i,o,h,d,l,c)+(u-d)*pc(n,t,e,s,r,i,o,h,p,l,c),g=(p-u)*pc(n,t,e,s,r,i,o,f,d,l,c)+(u-d)*pc(n,t,e,s,r,i,o,f,p,l,c);return(f-a)*m+(a-h)*g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Htt(n){const{inputs:t,attrs:e,backend:s}=n,{axis:r}=e,{x:i}=t;de(i,"unique");const o=s.data.get(i.dataId).values,{outputValues:a,outputShape:u,indices:l}=Z4(o,r,i.shape,i.dtype);return[s.makeTensorInfo(u,i.dtype,a),s.makeTensorInfo([l.length],"int32",l)]}const Ktt={kernelName:Wp,backendName:"cpu",kernelFunc:Htt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qtt(n){const{inputs:t,backend:e,attrs:s}=n,{value:r}=t;let{axis:i}=s;i<0&&(i+=r.shape.length);const o=r.shape.length,a=r.shape[i],u=new Array(o-1);let l=0;for(let f=0;f<o;f++)f!==i&&(u[l++]=r.shape[f]);const c=new Array(o).fill(0),h=r.shape.slice();h[i]=1;const d=new Array(a);for(let f=0;f<d.length;f++){c[i]=f;const p=Ga({inputs:{x:r},backend:e,attrs:{begin:c,size:h}});d[f]=fn({inputs:{x:p},backend:e,attrs:{shape:u}}),e.disposeIntermediateTensorInfo(p)}return d}const Xtt={kernelName:Mh,backendName:"cpu",kernelFunc:qtt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ytt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,segmentIds:i}=t,{numSegments:o}=s;de(r,"unsortedSegmentSum");const a=r.shape.length,u=i.shape.length,l=[],c=[],h=a-u;let d=i;for(let p=0;p<h;++p){const m=Ff({inputs:{input:d},backend:e,attrs:{dim:p+1}});d=m,c.push(m)}for(let p=0;p<o;++p){const m=fo(p,"int32"),g=e.makeTensorInfo([],"int32",m),y=d4({inputs:{a:g,b:d},backend:e}),b=Ho({inputs:{x:y},backend:e,attrs:{dtype:"float32"}}),w=Pm({inputs:{a:b,b:r},backend:e}),v=Sd({inputs:{x:w},backend:e,attrs:{axis:0,keepDims:!1}});l.push(v),c.push(g),c.push(y),c.push(b),c.push(w),c.push(v)}const f=FC({inputs:l,backend:e,attrs:{axis:0}});return c.forEach(p=>e.disposeIntermediateTensorInfo(p)),f}const Ztt={kernelName:zh,backendName:"cpu",kernelFunc:Ytt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jtt=[HX,kO,qX,YX,$O,JX,tY,nY,rY,oY,uY,cY,dY,mY,yY,wY,kY,IY,NY,GX,$Y,_Y,RY,_O,OY,NO,RO,LY,SO,MY,BY,VY,WY,jY,KY,XY,ZY,QY,eZ,sZ,iZ,aZ,lZ,hZ,dZ,pZ,gZ,bZ,xZ,wZ,vZ,SZ,NZ,PX,$Z,DO,LZ,OO,PZ,LO,WZ,GZ,HZ,MO,BO,qZ,YZ,JZ,tJ,UO,GO,IO,nJ,zY,rJ,oJ,uJ,MX,HO,qO,cJ,YO,dJ,mJ,yJ,wJ,kJ,IJ,CJ,JO,TJ,EJ,AJ,DJ,FJ,PJ,zJ,tF,VJ,GJ,KJ,nF,rF,YJ,QJ,nQ,oF,rQ,oQ,aQ,LC,hQ,BX,lF,fQ,mQ,yQ,xQ,CO,L1,vQ,VX,UX,WX,SQ,CQ,TQ,EQ,AQ,RQ,OQ,yF,LQ,VQ,WQ,KQ,xF,XQ,ZQ,QQ,wF,jJ,ntt,rtt,ott,utt,ctt,dtt,ptt,gtt,SF,ytt,CF,TF,xtt,vtt,Stt,Ctt,Ttt,AF,IZ,Ett,Att,Dtt,Ftt,Ptt,ztt,aF,Ktt,Xtt,Ztt,iQ];for(const n of Jtt)jp(n);const Qtt=kf.MediaPipeFaceMesh,tet={runtime:"tfjs",maxFaces:99,refineLandmarks:!0},eet=Dc.MediaPipeSelfieSegmentation,net={runtime:"tfjs",modelType:"general"},Ca=class{constructor(){br(this,"WIDTH",413);br(this,"HEIGHT",531);br(this,"segmenter");br(this,"detector")}static async getInstance(){return Ca.instance||(Ca.instance=new Ca,await Ca.instance.setup()),Ca.instance}async setup(){this.detector=await WG(Qtt,tet),this.segmenter=await Nj(eet,net)}async loadImageFromFile(t){return console.log("loadImageFromFile"),new Promise((e,s)=>{const r=new Image;r.onload=()=>e(r),r.onerror=i=>s(i),r.src=URL.createObjectURL(t)})}async processImage(t,e=!1){console.log("processImage");let s=await this.loadImageFromFile(t);return e&&(s=await this.removeBackground(s)),await this.runFaceRecognition(s,t.name)}async getBrightness(t){const e=iu(t),s=await wn(e).array();return e.dispose(),s}async removeBackground(t){console.log("removeBackground");const e=document.createElement("canvas");e.width=this.WIDTH,e.height=this.HEIGHT;const s=await this.segmenter.segmentPeople(t),o=await Mj(s,{r:0,g:0,b:0,a:0},{r:255,g:255,b:255,a:255});await zj(e,t,o,1,3,!1);const c=new Image;return c.src=e.toDataURL(),this.segmenter.reset(),c}async detectFaces(t){console.log("detectFaces");const e=await this.detector.estimateFaces(t);return this.detector.reset(),e}getRemoveMotivation(t,e){let s=[];return t==0?s.push("Nessun volto rilevato!"):t>=2&&s.push("Ci sono troppi volti all'interno della foto!"),e<=58&&s.push("L'immagine risulta essere troppo scura!"),s.join("; ")}async runFaceRecognition(t,e){var i;console.log("runFaceRecognition");const s=await this.detectFaces(t),r=await this.getBrightness(t);if(s)return{image:t,fileName:e,faces:s.length,facesBox:(i=s[0])==null?void 0:i.box,toRemove:s.length!==1||r<=58,toRemoveMotivation:this.getRemoveMotivation(s.length,r),finalSrc:""}}};let gc=Ca;br(gc,"instance");class set{constructor(){br(this,"image",new HTMLImageElement);br(this,"faces");br(this,"finalSrc","");br(this,"facesBox");br(this,"toRemove",!1);br(this,"toRemoveMotivation","");br(this,"fileName","")}}const tc=n=>(tN("data-v-a13d265d"),n=n(),eN(),n),ret={key:0,class:"loading card"},iet=tc(()=>_e("i",{class:"fa-solid fa-spinner fa-spin fs-3"},null,-1)),oet=[iet],aet={class:"card-header d-flex justify-content-between align-items-center"},uet={class:"d-flex align-items-baseline w-50"},cet={key:0,class:"fa-solid fa-check text-success"},het={key:1,class:"fa-solid fa-xmark text-danger"},det={class:"ms-3 fw-bold"},fet={class:"input-group ms-3"},pet=tc(()=>_e("span",{class:"input-group-text",id:"fileName"},".jpeg",-1)),met={class:"align-items-center d-flex"},get=["disabled"],yet={key:0,class:"fa-solid fa-download"},bet={class:"form-check form-switch mb-0"},xet={class:"card-body d-flex align-items-center justify-content-between"},wet={class:"align-items-center d-flex"},vet={class:"mt-2"},ket=tc(()=>_e("i",{class:"fa-solid fa-user-xmark ms-1"},null,-1)),Iet=tc(()=>_e("sup",{class:"ms-1 text-danger"},"Beta",-1)),Cet=tc(()=>_e("i",{class:"fa-solid fa-rotate-left ms-1"},null,-1)),Net={key:0,class:"p-3"},Tet={class:"row"},$et={class:"col"},Eet=tc(()=>_e("label",{for:"remoteMotivation",class:"form-label"},"Motivare l'esclusione della foto.",-1));let nx;const _et=ox({name:"image-row",data(){return{result:{coordinates:null,image:null},elaborating:!1,originalImage:null,cropper:null}},computed:{isValid(){return this.source.faces==1}},async beforeMount(){nx=await gc.getInstance()},mounted(){this.source.fileName=this.source.fileName.substr(0,this.source.fileName.lastIndexOf("."))||this.source.fileName,this.originalImage=this.source.image,this.cropper=this.$refs["cropper_"+this.index]},methods:{onChange({coordinates:n,image:t}){this.result={coordinates:n,image:t},this.source.finalSrc=this.getFinalImage()},download(){zg(this.getFinalImage(),this.source.fileName)},getFinalImage(){const{canvas:n}=this.cropper.getResult();return n==null?void 0:n.toDataURL("image/jpeg")},resetImage(){this.cropper.reset(),this.source.image=this.originalImage},async removeBg(){this.elaborating=!0,this.source.image=await nx.removeBackground(this.source.image),this.elaborating=!1},defaultPosition(){if(this.source.facesBox){const n=this.source.facesBox,t=n.width*this.PAD,e=n.height*this.PAD,s=n.xMin-t,r=n.yMin-e,i=n.height+2*e;return{left:s+10,top:r,height:i}}else return{}}}},"$rfqIyoXKjO"),Aet=QC({..._et,props:{source:{type:[set],default:{}},index:{type:Number,default:0},PAD:{type:Number,default:.5}},setup(n){return(t,e)=>{const s=zy("Cropper"),r=zy("Preview");return vs(),Ns("div",{class:rg(["image-row card mb-3",{"border-danger":n.source.toRemove}])},[t.elaborating?(vs(),Ns("div",ret,oet)):Ti("",!0),_e("div",aet,[_e("div",uet,[t.isValid?(vs(),Ns("i",cet)):Ti("",!0),t.isValid?Ti("",!0):(vs(),Ns("i",het)),_e("span",det,"#"+Mg(n.index+1),1),_e("div",fet,[Yd(_e("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=i=>n.source.fileName=i),class:"form-control",placeholder:"Nome file","aria-label":"Nome file","aria-describedby":"fileName"},null,512),[[By,n.source.fileName]]),pet])]),_e("div",met,[_e("button",{disabled:n.source.fileName=="",type:"button",class:"btn btn-light btn-sm me-4 p-0",onClick:e[1]||(e[1]=(...i)=>t.download&&t.download(...i))},[n.source.toRemove?Ti("",!0):(vs(),Ns("i",yet))],8,get),_e("div",bet,[Yd(_e("input",{class:"form-check-input","aria-label":"Rimuovi","onUpdate:modelValue":e[2]||(e[2]=i=>n.source.toRemove=i),type:"checkbox",role:"switch",id:"keepCheck"},null,512),[[rx,n.source.toRemove]])])])]),_e("div",xet,[_e("div",wet,[_e("div",null,[Vy(s,{class:rg([{"opacity-50":n.source.toRemove},"source-image"]),ref:"cropper_"+n.index,imageRestriction:"none","default-position":t.defaultPosition,onChange:t.onChange,src:n.source.image.src,canvas:{height:531,width:413},"stencil-props":{aspectRatio:413/531}},null,8,["class","default-position","onChange","src"]),_e("div",vet,[_e("button",{onClick:e[3]||(e[3]=i=>t.removeBg()),type:"button",class:"btn btn-sm btn-light me-2"},[Yi(" Rimuovi sfondo "),ket,Iet]),_e("button",{onClick:e[4]||(e[4]=i=>t.resetImage()),type:"button",class:"btn btn-sm btn-light"},[Yi(" Ripristina "),Cet])])]),Vy(r,{class:rg([{"opacity-50":n.source.toRemove},"ms-3 border border-1 border-black"]),image:t.result.image,width:413,height:531,coordinates:t.result.coordinates},null,8,["class","image","coordinates"])]),n.source.toRemove?(vs(),Ns("div",Net,[_e("div",Tet,[_e("div",$et,[Eet,Yd(_e("input",{"onUpdate:modelValue":e[5]||(e[5]=i=>n.source.toRemoveMotivation=i),type:"text",id:"remoteMotivation",class:"form-control",placeholder:"Motivazione esclusione","aria-label":"Motivazione esclusione"},null,512),[[By,n.source.toRemoveMotivation]])])])])):Ti("",!0)])],2)}}});const Ret=ix(Aet,[["__scopeId","data-v-a13d265d"]]);function Xd(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var PC={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(n,t){(function(e){n.exports=e()})(function(){return function e(s,r,i){function o(l,c){if(!r[l]){if(!s[l]){var h=typeof Xd=="function"&&Xd;if(!c&&h)return h(l,!0);if(a)return a(l,!0);var d=new Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var f=r[l]={exports:{}};s[l][0].call(f.exports,function(p){var m=s[l][1][p];return o(m||p)},f,f.exports,e,s,r,i)}return r[l].exports}for(var a=typeof Xd=="function"&&Xd,u=0;u<i.length;u++)o(i[u]);return o}({1:[function(e,s,r){var i=e("./utils"),o=e("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(u){for(var l,c,h,d,f,p,m,g=[],y=0,b=u.length,w=b,v=i.getTypeOf(u)!=="string";y<u.length;)w=b-y,h=v?(l=u[y++],c=y<b?u[y++]:0,y<b?u[y++]:0):(l=u.charCodeAt(y++),c=y<b?u.charCodeAt(y++):0,y<b?u.charCodeAt(y++):0),d=l>>2,f=(3&l)<<4|c>>4,p=1<w?(15&c)<<2|h>>6:64,m=2<w?63&h:64,g.push(a.charAt(d)+a.charAt(f)+a.charAt(p)+a.charAt(m));return g.join("")},r.decode=function(u){var l,c,h,d,f,p,m=0,g=0,y="data:";if(u.substr(0,y.length)===y)throw new Error("Invalid base64 input, it looks like a data url.");var b,w=3*(u=u.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(u.charAt(u.length-1)===a.charAt(64)&&w--,u.charAt(u.length-2)===a.charAt(64)&&w--,w%1!=0)throw new Error("Invalid base64 input, bad content length.");for(b=o.uint8array?new Uint8Array(0|w):new Array(0|w);m<u.length;)l=a.indexOf(u.charAt(m++))<<2|(d=a.indexOf(u.charAt(m++)))>>4,c=(15&d)<<4|(f=a.indexOf(u.charAt(m++)))>>2,h=(3&f)<<6|(p=a.indexOf(u.charAt(m++))),b[g++]=l,f!==64&&(b[g++]=c),p!==64&&(b[g++]=h);return b}},{"./support":30,"./utils":32}],2:[function(e,s,r){var i=e("./external"),o=e("./stream/DataWorker"),a=e("./stream/Crc32Probe"),u=e("./stream/DataLengthProbe");function l(c,h,d,f,p){this.compressedSize=c,this.uncompressedSize=h,this.crc32=d,this.compression=f,this.compressedContent=p}l.prototype={getContentWorker:function(){var c=new o(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new u("data_length")),h=this;return c.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),c},getCompressedWorker:function(){return new o(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(c,h,d){return c.pipe(new a).pipe(new u("uncompressedSize")).pipe(h.compressWorker(d)).pipe(new u("compressedSize")).withStreamInfo("compression",h)},s.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,s,r){var i=e("./stream/GenericWorker");r.STORE={magic:"\0\0",compressWorker:function(){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},r.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,s,r){var i=e("./utils"),o=function(){for(var a,u=[],l=0;l<256;l++){a=l;for(var c=0;c<8;c++)a=1&a?3988292384^a>>>1:a>>>1;u[l]=a}return u}();s.exports=function(a,u){return a!==void 0&&a.length?i.getTypeOf(a)!=="string"?function(l,c,h,d){var f=o,p=d+h;l^=-1;for(var m=d;m<p;m++)l=l>>>8^f[255&(l^c[m])];return-1^l}(0|u,a,a.length,0):function(l,c,h,d){var f=o,p=d+h;l^=-1;for(var m=d;m<p;m++)l=l>>>8^f[255&(l^c.charCodeAt(m))];return-1^l}(0|u,a,a.length,0):0}},{"./utils":32}],5:[function(e,s,r){r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(e,s,r){var i=null;i=typeof Promise<"u"?Promise:e("lie"),s.exports={Promise:i}},{lie:37}],7:[function(e,s,r){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=e("pako"),a=e("./utils"),u=e("./stream/GenericWorker"),l=i?"uint8array":"array";function c(h,d){u.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=d,this.meta={}}r.magic="\b\0",a.inherits(c,u),c.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(l,h.data),!1)},c.prototype.flush=function(){u.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},c.prototype.cleanUp=function(){u.prototype.cleanUp.call(this),this._pako=null},c.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(d){h.push({data:d,meta:h.meta})}},r.compressWorker=function(h){return new c("Deflate",h)},r.uncompressWorker=function(){return new c("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,s,r){function i(f,p){var m,g="";for(m=0;m<p;m++)g+=String.fromCharCode(255&f),f>>>=8;return g}function o(f,p,m,g,y,b){var w,v,S=f.file,N=f.compression,R=b!==l.utf8encode,L=a.transformTo("string",b(S.name)),F=a.transformTo("string",l.utf8encode(S.name)),B=S.comment,H=a.transformTo("string",b(B)),z=a.transformTo("string",l.utf8encode(B)),G=F.length!==S.name.length,T=z.length!==B.length,K="",ht="",rt="",gt=S.dir,at=S.date,It={crc32:0,compressedSize:0,uncompressedSize:0};p&&!m||(It.crc32=f.crc32,It.compressedSize=f.compressedSize,It.uncompressedSize=f.uncompressedSize);var et=0;p&&(et|=8),R||!G&&!T||(et|=2048);var st=0,St=0;gt&&(st|=16),y==="UNIX"?(St=798,st|=function(yt,Pt){var Xt=yt;return yt||(Xt=Pt?16893:33204),(65535&Xt)<<16}(S.unixPermissions,gt)):(St=20,st|=function(yt){return 63&(yt||0)}(S.dosPermissions)),w=at.getUTCHours(),w<<=6,w|=at.getUTCMinutes(),w<<=5,w|=at.getUTCSeconds()/2,v=at.getUTCFullYear()-1980,v<<=4,v|=at.getUTCMonth()+1,v<<=5,v|=at.getUTCDate(),G&&(ht=i(1,1)+i(c(L),4)+F,K+="up"+i(ht.length,2)+ht),T&&(rt=i(1,1)+i(c(H),4)+z,K+="uc"+i(rt.length,2)+rt);var kt="";return kt+=`
\0`,kt+=i(et,2),kt+=N.magic,kt+=i(w,2),kt+=i(v,2),kt+=i(It.crc32,4),kt+=i(It.compressedSize,4),kt+=i(It.uncompressedSize,4),kt+=i(L.length,2),kt+=i(K.length,2),{fileRecord:h.LOCAL_FILE_HEADER+kt+L+K,dirRecord:h.CENTRAL_FILE_HEADER+i(St,2)+kt+i(H.length,2)+"\0\0\0\0"+i(st,4)+i(g,4)+L+K+H}}var a=e("../utils"),u=e("../stream/GenericWorker"),l=e("../utf8"),c=e("../crc32"),h=e("../signature");function d(f,p,m,g){u.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=m,this.encodeFileName=g,this.streamFiles=f,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(d,u),d.prototype.push=function(f){var p=f.meta.percent||0,m=this.entriesCount,g=this._sources.length;this.accumulate?this.contentBuffer.push(f):(this.bytesWritten+=f.data.length,u.prototype.push.call(this,{data:f.data,meta:{currentFile:this.currentFile,percent:m?(p+100*(m-g-1))/m:100}}))},d.prototype.openedSource=function(f){this.currentSourceOffset=this.bytesWritten,this.currentFile=f.file.name;var p=this.streamFiles&&!f.file.dir;if(p){var m=o(f,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(f){this.accumulate=!1;var p=this.streamFiles&&!f.file.dir,m=o(f,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),p)this.push({data:function(g){return h.DATA_DESCRIPTOR+i(g.crc32,4)+i(g.compressedSize,4)+i(g.uncompressedSize,4)}(f),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var f=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var m=this.bytesWritten-f,g=function(y,b,w,v,S){var N=a.transformTo("string",S(v));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(y,2)+i(y,2)+i(b,4)+i(w,4)+i(N.length,2)+N}(this.dirRecords.length,m,f,this.zipComment,this.encodeFileName);this.push({data:g,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(f){this._sources.push(f);var p=this;return f.on("data",function(m){p.processChunk(m)}),f.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),f.on("error",function(m){p.error(m)}),this},d.prototype.resume=function(){return!!u.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(f){var p=this._sources;if(!u.prototype.error.call(this,f))return!1;for(var m=0;m<p.length;m++)try{p[m].error(f)}catch{}return!0},d.prototype.lock=function(){u.prototype.lock.call(this);for(var f=this._sources,p=0;p<f.length;p++)f[p].lock()},s.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,s,r){var i=e("../compressions"),o=e("./ZipFileWorker");r.generateWorker=function(a,u,l){var c=new o(u.streamFiles,l,u.platform,u.encodeFileName),h=0;try{a.forEach(function(d,f){h++;var p=function(b,w){var v=b||w,S=i[v];if(!S)throw new Error(v+" is not a valid compression method !");return S}(f.options.compression,u.compression),m=f.options.compressionOptions||u.compressionOptions||{},g=f.dir,y=f.date;f._compressWorker(p,m).withStreamInfo("file",{name:d,dir:g,date:y,comment:f.comment||"",unixPermissions:f.unixPermissions,dosPermissions:f.dosPermissions}).pipe(c)}),c.entriesCount=h}catch(d){c.error(d)}return c}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,s,r){function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new i;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(i.prototype=e("./object")).loadAsync=e("./load"),i.support=e("./support"),i.defaults=e("./defaults"),i.version="3.10.1",i.loadAsync=function(o,a){return new i().loadAsync(o,a)},i.external=e("./external"),s.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,s,r){var i=e("./utils"),o=e("./external"),a=e("./utf8"),u=e("./zipEntries"),l=e("./stream/Crc32Probe"),c=e("./nodejsUtils");function h(d){return new o.Promise(function(f,p){var m=d.decompressed.getContentWorker().pipe(new l);m.on("error",function(g){p(g)}).on("end",function(){m.streamInfo.crc32!==d.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):f()}).resume()})}s.exports=function(d,f){var p=this;return f=i.extend(f||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),c.isNode&&c.isStream(d)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",d,!0,f.optimizedBinaryString,f.base64).then(function(m){var g=new u(f);return g.load(m),g}).then(function(m){var g=[o.Promise.resolve(m)],y=m.files;if(f.checkCRC32)for(var b=0;b<y.length;b++)g.push(h(y[b]));return o.Promise.all(g)}).then(function(m){for(var g=m.shift(),y=g.files,b=0;b<y.length;b++){var w=y[b],v=w.fileNameStr,S=i.resolve(w.fileNameStr);p.file(S,w.decompressed,{binary:!0,optimizedBinaryString:!0,date:w.date,dir:w.dir,comment:w.fileCommentStr.length?w.fileCommentStr:null,unixPermissions:w.unixPermissions,dosPermissions:w.dosPermissions,createFolders:f.createFolders}),w.dir||(p.file(S).unsafeOriginalName=v)}return g.zipComment.length&&(p.comment=g.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,s,r){var i=e("../utils"),o=e("../stream/GenericWorker");function a(u,l){o.call(this,"Nodejs stream input adapter for "+u),this._upstreamEnded=!1,this._bindStream(l)}i.inherits(a,o),a.prototype._bindStream=function(u){var l=this;(this._stream=u).pause(),u.on("data",function(c){l.push({data:c,meta:{percent:0}})}).on("error",function(c){l.isPaused?this.generatedError=c:l.error(c)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},s.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,s,r){var i=e("readable-stream").Readable;function o(a,u,l){i.call(this,u),this._helper=a;var c=this;a.on("data",function(h,d){c.push(h)||c._helper.pause(),l&&l(d)}).on("error",function(h){c.emit("error",h)}).on("end",function(){c.push(null)})}e("../utils").inherits(o,i),o.prototype._read=function(){this._helper.resume()},s.exports=o},{"../utils":32,"readable-stream":16}],14:[function(e,s,r){s.exports={isNode:typeof Buffer<"u",newBufferFrom:function(i,o){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(i,o);if(typeof i=="number")throw new Error('The "data" argument must not be a number');return new Buffer(i,o)},allocBuffer:function(i){if(Buffer.alloc)return Buffer.alloc(i);var o=new Buffer(i);return o.fill(0),o},isBuffer:function(i){return Buffer.isBuffer(i)},isStream:function(i){return i&&typeof i.on=="function"&&typeof i.pause=="function"&&typeof i.resume=="function"}}},{}],15:[function(e,s,r){function i(S,N,R){var L,F=a.getTypeOf(N),B=a.extend(R||{},c);B.date=B.date||new Date,B.compression!==null&&(B.compression=B.compression.toUpperCase()),typeof B.unixPermissions=="string"&&(B.unixPermissions=parseInt(B.unixPermissions,8)),B.unixPermissions&&16384&B.unixPermissions&&(B.dir=!0),B.dosPermissions&&16&B.dosPermissions&&(B.dir=!0),B.dir&&(S=y(S)),B.createFolders&&(L=g(S))&&b.call(this,L,!0);var H=F==="string"&&B.binary===!1&&B.base64===!1;R&&R.binary!==void 0||(B.binary=!H),(N instanceof h&&N.uncompressedSize===0||B.dir||!N||N.length===0)&&(B.base64=!1,B.binary=!0,N="",B.compression="STORE",F="string");var z=null;z=N instanceof h||N instanceof u?N:p.isNode&&p.isStream(N)?new m(S,N):a.prepareContent(S,N,B.binary,B.optimizedBinaryString,B.base64);var G=new d(S,z,B);this.files[S]=G}var o=e("./utf8"),a=e("./utils"),u=e("./stream/GenericWorker"),l=e("./stream/StreamHelper"),c=e("./defaults"),h=e("./compressedObject"),d=e("./zipObject"),f=e("./generate"),p=e("./nodejsUtils"),m=e("./nodejs/NodejsStreamInputAdapter"),g=function(S){S.slice(-1)==="/"&&(S=S.substring(0,S.length-1));var N=S.lastIndexOf("/");return 0<N?S.substring(0,N):""},y=function(S){return S.slice(-1)!=="/"&&(S+="/"),S},b=function(S,N){return N=N!==void 0?N:c.createFolders,S=y(S),this.files[S]||i.call(this,S,null,{dir:!0,createFolders:N}),this.files[S]};function w(S){return Object.prototype.toString.call(S)==="[object RegExp]"}var v={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(S){var N,R,L;for(N in this.files)L=this.files[N],(R=N.slice(this.root.length,N.length))&&N.slice(0,this.root.length)===this.root&&S(R,L)},filter:function(S){var N=[];return this.forEach(function(R,L){S(R,L)&&N.push(L)}),N},file:function(S,N,R){if(arguments.length!==1)return S=this.root+S,i.call(this,S,N,R),this;if(w(S)){var L=S;return this.filter(function(B,H){return!H.dir&&L.test(B)})}var F=this.files[this.root+S];return F&&!F.dir?F:null},folder:function(S){if(!S)return this;if(w(S))return this.filter(function(F,B){return B.dir&&S.test(F)});var N=this.root+S,R=b.call(this,N),L=this.clone();return L.root=R.name,L},remove:function(S){S=this.root+S;var N=this.files[S];if(N||(S.slice(-1)!=="/"&&(S+="/"),N=this.files[S]),N&&!N.dir)delete this.files[S];else for(var R=this.filter(function(F,B){return B.name.slice(0,S.length)===S}),L=0;L<R.length;L++)delete this.files[R[L].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(S){var N,R={};try{if((R=a.extend(S||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=R.type.toLowerCase(),R.compression=R.compression.toUpperCase(),R.type==="binarystring"&&(R.type="string"),!R.type)throw new Error("No output type specified.");a.checkSupport(R.type),R.platform!=="darwin"&&R.platform!=="freebsd"&&R.platform!=="linux"&&R.platform!=="sunos"||(R.platform="UNIX"),R.platform==="win32"&&(R.platform="DOS");var L=R.comment||this.comment||"";N=f.generateWorker(this,R,L)}catch(F){(N=new u("error")).error(F)}return new l(N,R.type||"string",R.mimeType)},generateAsync:function(S,N){return this.generateInternalStream(S).accumulate(N)},generateNodeStream:function(S,N){return(S=S||{}).type||(S.type="nodebuffer"),this.generateInternalStream(S).toNodejsStream(N)}};s.exports=v},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,s,r){s.exports=e("stream")},{stream:void 0}],17:[function(e,s,r){var i=e("./DataReader");function o(a){i.call(this,a);for(var u=0;u<this.data.length;u++)a[u]=255&a[u]}e("../utils").inherits(o,i),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var u=a.charCodeAt(0),l=a.charCodeAt(1),c=a.charCodeAt(2),h=a.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===u&&this.data[d+1]===l&&this.data[d+2]===c&&this.data[d+3]===h)return d-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var u=a.charCodeAt(0),l=a.charCodeAt(1),c=a.charCodeAt(2),h=a.charCodeAt(3),d=this.readData(4);return u===d[0]&&l===d[1]&&c===d[2]&&h===d[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var u=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,u},s.exports=o},{"../utils":32,"./DataReader":18}],18:[function(e,s,r){var i=e("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var u,l=0;for(this.checkOffset(a),u=this.index+a-1;u>=this.index;u--)l=(l<<8)+this.byteAt(u);return this.index+=a,l},readString:function(a){return i.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},s.exports=o},{"../utils":32}],19:[function(e,s,r){var i=e("./Uint8ArrayReader");function o(a){i.call(this,a)}e("../utils").inherits(o,i),o.prototype.readData=function(a){this.checkOffset(a);var u=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,u},s.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,s,r){var i=e("./DataReader");function o(a){i.call(this,a)}e("../utils").inherits(o,i),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var u=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,u},s.exports=o},{"../utils":32,"./DataReader":18}],21:[function(e,s,r){var i=e("./ArrayReader");function o(a){i.call(this,a)}e("../utils").inherits(o,i),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var u=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,u},s.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(e,s,r){var i=e("../utils"),o=e("../support"),a=e("./ArrayReader"),u=e("./StringReader"),l=e("./NodeBufferReader"),c=e("./Uint8ArrayReader");s.exports=function(h){var d=i.getTypeOf(h);return i.checkSupport(d),d!=="string"||o.uint8array?d==="nodebuffer"?new l(h):o.uint8array?new c(i.transformTo("uint8array",h)):new a(i.transformTo("array",h)):new u(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,s,r){r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,s,r){var i=e("./GenericWorker"),o=e("../utils");function a(u){i.call(this,"ConvertWorker to "+u),this.destType=u}o.inherits(a,i),a.prototype.processChunk=function(u){this.push({data:o.transformTo(this.destType,u.data),meta:u.meta})},s.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(e,s,r){var i=e("./GenericWorker"),o=e("../crc32");function a(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(a,i),a.prototype.processChunk=function(u){this.streamInfo.crc32=o(u.data,this.streamInfo.crc32||0),this.push(u)},s.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,s,r){var i=e("../utils"),o=e("./GenericWorker");function a(u){o.call(this,"DataLengthProbe for "+u),this.propName=u,this.withStreamInfo(u,0)}i.inherits(a,o),a.prototype.processChunk=function(u){if(u){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+u.data.length}o.prototype.processChunk.call(this,u)},s.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(e,s,r){var i=e("../utils"),o=e("./GenericWorker");function a(u){o.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,u.then(function(c){l.dataIsReady=!0,l.data=c,l.max=c&&c.length||0,l.type=i.getTypeOf(c),l.isPaused||l._tickAndRepeat()},function(c){l.error(c)})}i.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var u=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":u=this.data.substring(this.index,l);break;case"uint8array":u=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":u=this.data.slice(this.index,l)}return this.index=l,this.push({data:u,meta:{percent:this.max?this.index/this.max*100:0}})},s.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(e,s,r){function i(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var u=0;u<this._listeners[o].length;u++)this._listeners[o][u].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(u){a.processChunk(u)}),o.on("end",function(){a.end()}),o.on("error",function(u){a.error(u)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},s.exports=i},{}],29:[function(e,s,r){var i=e("../utils"),o=e("./ConvertWorker"),a=e("./GenericWorker"),u=e("../base64"),l=e("../support"),c=e("../external"),h=null;if(l.nodestream)try{h=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(p,m){return new c.Promise(function(g,y){var b=[],w=p._internalType,v=p._outputType,S=p._mimeType;p.on("data",function(N,R){b.push(N),m&&m(R)}).on("error",function(N){b=[],y(N)}).on("end",function(){try{var N=function(R,L,F){switch(R){case"blob":return i.newBlob(i.transformTo("arraybuffer",L),F);case"base64":return u.encode(L);default:return i.transformTo(R,L)}}(v,function(R,L){var F,B=0,H=null,z=0;for(F=0;F<L.length;F++)z+=L[F].length;switch(R){case"string":return L.join("");case"array":return Array.prototype.concat.apply([],L);case"uint8array":for(H=new Uint8Array(z),F=0;F<L.length;F++)H.set(L[F],B),B+=L[F].length;return H;case"nodebuffer":return Buffer.concat(L);default:throw new Error("concat : unsupported type '"+R+"'")}}(w,b),S);g(N)}catch(R){y(R)}b=[]}).resume()})}function f(p,m,g){var y=m;switch(m){case"blob":case"arraybuffer":y="uint8array";break;case"base64":y="string"}try{this._internalType=y,this._outputType=m,this._mimeType=g,i.checkSupport(y),this._worker=p.pipe(new o(y)),p.lock()}catch(b){this._worker=new a("error"),this._worker.error(b)}}f.prototype={accumulate:function(p){return d(this,p)},on:function(p,m){var g=this;return p==="data"?this._worker.on(p,function(y){m.call(g,y.data,y.meta)}):this._worker.on(p,function(){i.delay(m,arguments,g)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(i.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},p)}},s.exports=f},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,s,r){if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",r.nodebuffer=typeof Buffer<"u",r.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")r.blob=!1;else{var i=new ArrayBuffer(0);try{r.blob=new Blob([i],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(i),r.blob=o.getBlob("application/zip").size===0}catch{r.blob=!1}}}try{r.nodestream=!!e("readable-stream").Readable}catch{r.nodestream=!1}},{"readable-stream":16}],31:[function(e,s,r){for(var i=e("./utils"),o=e("./support"),a=e("./nodejsUtils"),u=e("./stream/GenericWorker"),l=new Array(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;l[254]=l[254]=1;function h(){u.call(this,"utf-8 decode"),this.leftOver=null}function d(){u.call(this,"utf-8 encode")}r.utf8encode=function(f){return o.nodebuffer?a.newBufferFrom(f,"utf-8"):function(p){var m,g,y,b,w,v=p.length,S=0;for(b=0;b<v;b++)(64512&(g=p.charCodeAt(b)))==55296&&b+1<v&&(64512&(y=p.charCodeAt(b+1)))==56320&&(g=65536+(g-55296<<10)+(y-56320),b++),S+=g<128?1:g<2048?2:g<65536?3:4;for(m=o.uint8array?new Uint8Array(S):new Array(S),b=w=0;w<S;b++)(64512&(g=p.charCodeAt(b)))==55296&&b+1<v&&(64512&(y=p.charCodeAt(b+1)))==56320&&(g=65536+(g-55296<<10)+(y-56320),b++),g<128?m[w++]=g:(g<2048?m[w++]=192|g>>>6:(g<65536?m[w++]=224|g>>>12:(m[w++]=240|g>>>18,m[w++]=128|g>>>12&63),m[w++]=128|g>>>6&63),m[w++]=128|63&g);return m}(f)},r.utf8decode=function(f){return o.nodebuffer?i.transformTo("nodebuffer",f).toString("utf-8"):function(p){var m,g,y,b,w=p.length,v=new Array(2*w);for(m=g=0;m<w;)if((y=p[m++])<128)v[g++]=y;else if(4<(b=l[y]))v[g++]=65533,m+=b-1;else{for(y&=b===2?31:b===3?15:7;1<b&&m<w;)y=y<<6|63&p[m++],b--;1<b?v[g++]=65533:y<65536?v[g++]=y:(y-=65536,v[g++]=55296|y>>10&1023,v[g++]=56320|1023&y)}return v.length!==g&&(v.subarray?v=v.subarray(0,g):v.length=g),i.applyFromCharCode(v)}(f=i.transformTo(o.uint8array?"uint8array":"array",f))},i.inherits(h,u),h.prototype.processChunk=function(f){var p=i.transformTo(o.uint8array?"uint8array":"array",f.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=p;(p=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),p.set(m,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var g=function(b,w){var v;for((w=w||b.length)>b.length&&(w=b.length),v=w-1;0<=v&&(192&b[v])==128;)v--;return v<0||v===0?w:v+l[b[v]]>w?v:w}(p),y=p;g!==p.length&&(o.uint8array?(y=p.subarray(0,g),this.leftOver=p.subarray(g,p.length)):(y=p.slice(0,g),this.leftOver=p.slice(g,p.length))),this.push({data:r.utf8decode(y),meta:f.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:r.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},r.Utf8DecodeWorker=h,i.inherits(d,u),d.prototype.processChunk=function(f){this.push({data:r.utf8encode(f.data),meta:f.meta})},r.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,s,r){var i=e("./support"),o=e("./base64"),a=e("./nodejsUtils"),u=e("./external");function l(m){return m}function c(m,g){for(var y=0;y<m.length;++y)g[y]=255&m.charCodeAt(y);return g}e("setimmediate"),r.newBlob=function(m,g){r.checkSupport("blob");try{return new Blob([m],{type:g})}catch{try{var y=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return y.append(m),y.getBlob(g)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(m,g,y){var b=[],w=0,v=m.length;if(v<=y)return String.fromCharCode.apply(null,m);for(;w<v;)g==="array"||g==="nodebuffer"?b.push(String.fromCharCode.apply(null,m.slice(w,Math.min(w+y,v)))):b.push(String.fromCharCode.apply(null,m.subarray(w,Math.min(w+y,v)))),w+=y;return b.join("")},stringifyByChar:function(m){for(var g="",y=0;y<m.length;y++)g+=String.fromCharCode(m[y]);return g},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function d(m){var g=65536,y=r.getTypeOf(m),b=!0;if(y==="uint8array"?b=h.applyCanBeUsed.uint8array:y==="nodebuffer"&&(b=h.applyCanBeUsed.nodebuffer),b)for(;1<g;)try{return h.stringifyByChunk(m,y,g)}catch{g=Math.floor(g/2)}return h.stringifyByChar(m)}function f(m,g){for(var y=0;y<m.length;y++)g[y]=m[y];return g}r.applyFromCharCode=d;var p={};p.string={string:l,array:function(m){return c(m,new Array(m.length))},arraybuffer:function(m){return p.string.uint8array(m).buffer},uint8array:function(m){return c(m,new Uint8Array(m.length))},nodebuffer:function(m){return c(m,a.allocBuffer(m.length))}},p.array={string:d,array:l,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},p.arraybuffer={string:function(m){return d(new Uint8Array(m))},array:function(m){return f(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:l,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},p.uint8array={string:d,array:function(m){return f(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:l,nodebuffer:function(m){return a.newBufferFrom(m)}},p.nodebuffer={string:d,array:function(m){return f(m,new Array(m.length))},arraybuffer:function(m){return p.nodebuffer.uint8array(m).buffer},uint8array:function(m){return f(m,new Uint8Array(m.length))},nodebuffer:l},r.transformTo=function(m,g){if(g=g||"",!m)return g;r.checkSupport(m);var y=r.getTypeOf(g);return p[y][m](g)},r.resolve=function(m){for(var g=m.split("/"),y=[],b=0;b<g.length;b++){var w=g[b];w==="."||w===""&&b!==0&&b!==g.length-1||(w===".."?y.pop():y.push(w))}return y.join("/")},r.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":i.nodebuffer&&a.isBuffer(m)?"nodebuffer":i.uint8array&&m instanceof Uint8Array?"uint8array":i.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(m){if(!i[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(m){var g,y,b="";for(y=0;y<(m||"").length;y++)b+="\\x"+((g=m.charCodeAt(y))<16?"0":"")+g.toString(16).toUpperCase();return b},r.delay=function(m,g,y){setImmediate(function(){m.apply(y||null,g||[])})},r.inherits=function(m,g){function y(){}y.prototype=g.prototype,m.prototype=new y},r.extend=function(){var m,g,y={};for(m=0;m<arguments.length;m++)for(g in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],g)&&y[g]===void 0&&(y[g]=arguments[m][g]);return y},r.prepareContent=function(m,g,y,b,w){return u.Promise.resolve(g).then(function(v){return i.blob&&(v instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(v))!==-1)&&typeof FileReader<"u"?new u.Promise(function(S,N){var R=new FileReader;R.onload=function(L){S(L.target.result)},R.onerror=function(L){N(L.target.error)},R.readAsArrayBuffer(v)}):v}).then(function(v){var S=r.getTypeOf(v);return S?(S==="arraybuffer"?v=r.transformTo("uint8array",v):S==="string"&&(w?v=o.decode(v):y&&b!==!0&&(v=function(N){return c(N,i.uint8array?new Uint8Array(N.length):new Array(N.length))}(v))),v):u.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,s,r){var i=e("./reader/readerFor"),o=e("./utils"),a=e("./signature"),u=e("./zipEntry"),l=e("./support");function c(h){this.files=[],this.loadOptions=h}c.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(d)+", expected "+o.pretty(h)+")")}},isSignature:function(h,d){var f=this.reader.index;this.reader.setIndex(h);var p=this.reader.readString(4)===d;return this.reader.setIndex(f),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),d=l.uint8array?"uint8array":"array",f=o.transformTo(d,h);this.zipComment=this.loadOptions.decodeFileName(f)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,d,f,p=this.zip64EndOfCentralSize-44;0<p;)h=this.reader.readInt(2),d=this.reader.readInt(4),f=this.reader.readData(d),this.zip64ExtensibleData[h]={id:h,length:d,value:f}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,d;for(h=0;h<this.files.length;h++)d=this.files[h],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(h=new u({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var d=h;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var f=this.centralDirOffset+this.centralDirSize;this.zip64&&(f+=20,f+=12+this.zip64EndOfCentralSize);var p=d-f;if(0<p)this.isSignature(d,a.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(h){this.reader=i(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},s.exports=c},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,s,r){var i=e("./reader/readerFor"),o=e("./utils"),a=e("./compressedObject"),u=e("./crc32"),l=e("./utf8"),c=e("./compressions"),h=e("./support");function d(f,p){this.options=f,this.loadOptions=p}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(f){var p,m;if(f.skip(22),this.fileNameLength=f.readInt(2),m=f.readInt(2),this.fileName=f.readData(this.fileNameLength),f.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=function(g){for(var y in c)if(Object.prototype.hasOwnProperty.call(c,y)&&c[y].magic===g)return c[y];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,p,f.readData(this.compressedSize))},readCentralPart:function(f){this.versionMadeBy=f.readInt(2),f.skip(2),this.bitFlag=f.readInt(2),this.compressionMethod=f.readString(2),this.date=f.readDate(),this.crc32=f.readInt(4),this.compressedSize=f.readInt(4),this.uncompressedSize=f.readInt(4);var p=f.readInt(2);if(this.extraFieldsLength=f.readInt(2),this.fileCommentLength=f.readInt(2),this.diskNumberStart=f.readInt(2),this.internalFileAttributes=f.readInt(2),this.externalFileAttributes=f.readInt(4),this.localHeaderOffset=f.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");f.skip(p),this.readExtraFields(f),this.parseZIP64ExtraField(f),this.fileComment=f.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var f=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),f==0&&(this.dosPermissions=63&this.externalFileAttributes),f==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var f=i(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=f.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=f.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=f.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=f.readInt(4))}},readExtraFields:function(f){var p,m,g,y=f.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});f.index+4<y;)p=f.readInt(2),m=f.readInt(2),g=f.readData(m),this.extraFields[p]={id:p,length:m,value:g};f.setIndex(y)},handleUTF8:function(){var f=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var m=o.transformTo(f,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var g=this.findExtraFieldUnicodeComment();if(g!==null)this.fileCommentStr=g;else{var y=o.transformTo(f,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(y)}}},findExtraFieldUnicodePath:function(){var f=this.extraFields[28789];if(f){var p=i(f.value);return p.readInt(1)!==1||u(this.fileName)!==p.readInt(4)?null:l.utf8decode(p.readData(f.length-5))}return null},findExtraFieldUnicodeComment:function(){var f=this.extraFields[25461];if(f){var p=i(f.value);return p.readInt(1)!==1||u(this.fileComment)!==p.readInt(4)?null:l.utf8decode(p.readData(f.length-5))}return null}},s.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,s,r){function i(p,m,g){this.name=p,this.dir=g.dir,this.date=g.date,this.comment=g.comment,this.unixPermissions=g.unixPermissions,this.dosPermissions=g.dosPermissions,this._data=m,this._dataBinary=g.binary,this.options={compression:g.compression,compressionOptions:g.compressionOptions}}var o=e("./stream/StreamHelper"),a=e("./stream/DataWorker"),u=e("./utf8"),l=e("./compressedObject"),c=e("./stream/GenericWorker");i.prototype={internalStream:function(p){var m=null,g="string";try{if(!p)throw new Error("No output type specified.");var y=(g=p.toLowerCase())==="string"||g==="text";g!=="binarystring"&&g!=="text"||(g="string"),m=this._decompressWorker();var b=!this._dataBinary;b&&!y&&(m=m.pipe(new u.Utf8EncodeWorker)),!b&&y&&(m=m.pipe(new u.Utf8DecodeWorker))}catch(w){(m=new c("error")).error(w)}return new o(m,g,"")},async:function(p,m){return this.internalStream(p).accumulate(m)},nodeStream:function(p,m){return this.internalStream(p||"nodebuffer").toNodejsStream(m)},_compressWorker:function(p,m){if(this._data instanceof l&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var g=this._decompressWorker();return this._dataBinary||(g=g.pipe(new u.Utf8EncodeWorker)),l.createWorkerFrom(g,p,m)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof c?this._data:new a(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<h.length;f++)i.prototype[h[f]]=d;s.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,s,r){(function(i){var o,a,u=i.MutationObserver||i.WebKitMutationObserver;if(u){var l=0,c=new u(p),h=i.document.createTextNode("");c.observe(h,{characterData:!0}),o=function(){h.data=l=++l%2}}else if(i.setImmediate||i.MessageChannel===void 0)o="document"in i&&"onreadystatechange"in i.document.createElement("script")?function(){var m=i.document.createElement("script");m.onreadystatechange=function(){p(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},i.document.documentElement.appendChild(m)}:function(){setTimeout(p,0)};else{var d=new i.MessageChannel;d.port1.onmessage=p,o=function(){d.port2.postMessage(0)}}var f=[];function p(){var m,g;a=!0;for(var y=f.length;y;){for(g=f,f=[],m=-1;++m<y;)g[m]();y=f.length}a=!1}s.exports=function(m){f.push(m)!==1||a||o()}}).call(this,typeof ks<"u"?ks:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,s,r){var i=e("immediate");function o(){}var a={},u=["REJECTED"],l=["FULFILLED"],c=["PENDING"];function h(y){if(typeof y!="function")throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,y!==o&&m(this,y)}function d(y,b,w){this.promise=y,typeof b=="function"&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),typeof w=="function"&&(this.onRejected=w,this.callRejected=this.otherCallRejected)}function f(y,b,w){i(function(){var v;try{v=b(w)}catch(S){return a.reject(y,S)}v===y?a.reject(y,new TypeError("Cannot resolve promise with itself")):a.resolve(y,v)})}function p(y){var b=y&&y.then;if(y&&(typeof y=="object"||typeof y=="function")&&typeof b=="function")return function(){b.apply(y,arguments)}}function m(y,b){var w=!1;function v(R){w||(w=!0,a.reject(y,R))}function S(R){w||(w=!0,a.resolve(y,R))}var N=g(function(){b(S,v)});N.status==="error"&&v(N.value)}function g(y,b){var w={};try{w.value=y(b),w.status="success"}catch(v){w.status="error",w.value=v}return w}(s.exports=h).prototype.finally=function(y){if(typeof y!="function")return this;var b=this.constructor;return this.then(function(w){return b.resolve(y()).then(function(){return w})},function(w){return b.resolve(y()).then(function(){throw w})})},h.prototype.catch=function(y){return this.then(null,y)},h.prototype.then=function(y,b){if(typeof y!="function"&&this.state===l||typeof b!="function"&&this.state===u)return this;var w=new this.constructor(o);return this.state!==c?f(w,this.state===l?y:b,this.outcome):this.queue.push(new d(w,y,b)),w},d.prototype.callFulfilled=function(y){a.resolve(this.promise,y)},d.prototype.otherCallFulfilled=function(y){f(this.promise,this.onFulfilled,y)},d.prototype.callRejected=function(y){a.reject(this.promise,y)},d.prototype.otherCallRejected=function(y){f(this.promise,this.onRejected,y)},a.resolve=function(y,b){var w=g(p,b);if(w.status==="error")return a.reject(y,w.value);var v=w.value;if(v)m(y,v);else{y.state=l,y.outcome=b;for(var S=-1,N=y.queue.length;++S<N;)y.queue[S].callFulfilled(b)}return y},a.reject=function(y,b){y.state=u,y.outcome=b;for(var w=-1,v=y.queue.length;++w<v;)y.queue[w].callRejected(b);return y},h.resolve=function(y){return y instanceof this?y:a.resolve(new this(o),y)},h.reject=function(y){var b=new this(o);return a.reject(b,y)},h.all=function(y){var b=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var w=y.length,v=!1;if(!w)return this.resolve([]);for(var S=new Array(w),N=0,R=-1,L=new this(o);++R<w;)F(y[R],R);return L;function F(B,H){b.resolve(B).then(function(z){S[H]=z,++N!==w||v||(v=!0,a.resolve(L,S))},function(z){v||(v=!0,a.reject(L,z))})}},h.race=function(y){var b=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var w=y.length,v=!1;if(!w)return this.resolve([]);for(var S=-1,N=new this(o);++S<w;)R=y[S],b.resolve(R).then(function(L){v||(v=!0,a.resolve(N,L))},function(L){v||(v=!0,a.reject(N,L))});var R;return N}},{immediate:36}],38:[function(e,s,r){var i={};(0,e("./lib/utils/common").assign)(i,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),s.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,s,r){var i=e("./zlib/deflate"),o=e("./utils/common"),a=e("./utils/strings"),u=e("./zlib/messages"),l=e("./zlib/zstream"),c=Object.prototype.toString,h=0,d=-1,f=0,p=8;function m(y){if(!(this instanceof m))return new m(y);this.options=o.assign({level:d,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},y||{});var b=this.options;b.raw&&0<b.windowBits?b.windowBits=-b.windowBits:b.gzip&&0<b.windowBits&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var w=i.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(w!==h)throw new Error(u[w]);if(b.header&&i.deflateSetHeader(this.strm,b.header),b.dictionary){var v;if(v=typeof b.dictionary=="string"?a.string2buf(b.dictionary):c.call(b.dictionary)==="[object ArrayBuffer]"?new Uint8Array(b.dictionary):b.dictionary,(w=i.deflateSetDictionary(this.strm,v))!==h)throw new Error(u[w]);this._dict_set=!0}}function g(y,b){var w=new m(b);if(w.push(y,!0),w.err)throw w.msg||u[w.err];return w.result}m.prototype.push=function(y,b){var w,v,S=this.strm,N=this.options.chunkSize;if(this.ended)return!1;v=b===~~b?b:b===!0?4:0,typeof y=="string"?S.input=a.string2buf(y):c.call(y)==="[object ArrayBuffer]"?S.input=new Uint8Array(y):S.input=y,S.next_in=0,S.avail_in=S.input.length;do{if(S.avail_out===0&&(S.output=new o.Buf8(N),S.next_out=0,S.avail_out=N),(w=i.deflate(S,v))!==1&&w!==h)return this.onEnd(w),!(this.ended=!0);S.avail_out!==0&&(S.avail_in!==0||v!==4&&v!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(S.output,S.next_out))):this.onData(o.shrinkBuf(S.output,S.next_out)))}while((0<S.avail_in||S.avail_out===0)&&w!==1);return v===4?(w=i.deflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===h):v!==2||(this.onEnd(h),!(S.avail_out=0))},m.prototype.onData=function(y){this.chunks.push(y)},m.prototype.onEnd=function(y){y===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.msg=this.strm.msg},r.Deflate=m,r.deflate=g,r.deflateRaw=function(y,b){return(b=b||{}).raw=!0,g(y,b)},r.gzip=function(y,b){return(b=b||{}).gzip=!0,g(y,b)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,s,r){var i=e("./zlib/inflate"),o=e("./utils/common"),a=e("./utils/strings"),u=e("./zlib/constants"),l=e("./zlib/messages"),c=e("./zlib/zstream"),h=e("./zlib/gzheader"),d=Object.prototype.toString;function f(m){if(!(this instanceof f))return new f(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var g=this.options;g.raw&&0<=g.windowBits&&g.windowBits<16&&(g.windowBits=-g.windowBits,g.windowBits===0&&(g.windowBits=-15)),!(0<=g.windowBits&&g.windowBits<16)||m&&m.windowBits||(g.windowBits+=32),15<g.windowBits&&g.windowBits<48&&!(15&g.windowBits)&&(g.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var y=i.inflateInit2(this.strm,g.windowBits);if(y!==u.Z_OK)throw new Error(l[y]);this.header=new h,i.inflateGetHeader(this.strm,this.header)}function p(m,g){var y=new f(g);if(y.push(m,!0),y.err)throw y.msg||l[y.err];return y.result}f.prototype.push=function(m,g){var y,b,w,v,S,N,R=this.strm,L=this.options.chunkSize,F=this.options.dictionary,B=!1;if(this.ended)return!1;b=g===~~g?g:g===!0?u.Z_FINISH:u.Z_NO_FLUSH,typeof m=="string"?R.input=a.binstring2buf(m):d.call(m)==="[object ArrayBuffer]"?R.input=new Uint8Array(m):R.input=m,R.next_in=0,R.avail_in=R.input.length;do{if(R.avail_out===0&&(R.output=new o.Buf8(L),R.next_out=0,R.avail_out=L),(y=i.inflate(R,u.Z_NO_FLUSH))===u.Z_NEED_DICT&&F&&(N=typeof F=="string"?a.string2buf(F):d.call(F)==="[object ArrayBuffer]"?new Uint8Array(F):F,y=i.inflateSetDictionary(this.strm,N)),y===u.Z_BUF_ERROR&&B===!0&&(y=u.Z_OK,B=!1),y!==u.Z_STREAM_END&&y!==u.Z_OK)return this.onEnd(y),!(this.ended=!0);R.next_out&&(R.avail_out!==0&&y!==u.Z_STREAM_END&&(R.avail_in!==0||b!==u.Z_FINISH&&b!==u.Z_SYNC_FLUSH)||(this.options.to==="string"?(w=a.utf8border(R.output,R.next_out),v=R.next_out-w,S=a.buf2string(R.output,w),R.next_out=v,R.avail_out=L-v,v&&o.arraySet(R.output,R.output,w,v,0),this.onData(S)):this.onData(o.shrinkBuf(R.output,R.next_out)))),R.avail_in===0&&R.avail_out===0&&(B=!0)}while((0<R.avail_in||R.avail_out===0)&&y!==u.Z_STREAM_END);return y===u.Z_STREAM_END&&(b=u.Z_FINISH),b===u.Z_FINISH?(y=i.inflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===u.Z_OK):b!==u.Z_SYNC_FLUSH||(this.onEnd(u.Z_OK),!(R.avail_out=0))},f.prototype.onData=function(m){this.chunks.push(m)},f.prototype.onEnd=function(m){m===u.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},r.Inflate=f,r.inflate=p,r.inflateRaw=function(m,g){return(g=g||{}).raw=!0,p(m,g)},r.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,s,r){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";r.assign=function(u){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var c=l.shift();if(c){if(typeof c!="object")throw new TypeError(c+"must be non-object");for(var h in c)c.hasOwnProperty(h)&&(u[h]=c[h])}}return u},r.shrinkBuf=function(u,l){return u.length===l?u:u.subarray?u.subarray(0,l):(u.length=l,u)};var o={arraySet:function(u,l,c,h,d){if(l.subarray&&u.subarray)u.set(l.subarray(c,c+h),d);else for(var f=0;f<h;f++)u[d+f]=l[c+f]},flattenChunks:function(u){var l,c,h,d,f,p;for(l=h=0,c=u.length;l<c;l++)h+=u[l].length;for(p=new Uint8Array(h),l=d=0,c=u.length;l<c;l++)f=u[l],p.set(f,d),d+=f.length;return p}},a={arraySet:function(u,l,c,h,d){for(var f=0;f<h;f++)u[d+f]=l[c+f]},flattenChunks:function(u){return[].concat.apply([],u)}};r.setTyped=function(u){u?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,o)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,a))},r.setTyped(i)},{}],42:[function(e,s,r){var i=e("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var u=new i.Buf8(256),l=0;l<256;l++)u[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function c(h,d){if(d<65537&&(h.subarray&&a||!h.subarray&&o))return String.fromCharCode.apply(null,i.shrinkBuf(h,d));for(var f="",p=0;p<d;p++)f+=String.fromCharCode(h[p]);return f}u[254]=u[254]=1,r.string2buf=function(h){var d,f,p,m,g,y=h.length,b=0;for(m=0;m<y;m++)(64512&(f=h.charCodeAt(m)))==55296&&m+1<y&&(64512&(p=h.charCodeAt(m+1)))==56320&&(f=65536+(f-55296<<10)+(p-56320),m++),b+=f<128?1:f<2048?2:f<65536?3:4;for(d=new i.Buf8(b),m=g=0;g<b;m++)(64512&(f=h.charCodeAt(m)))==55296&&m+1<y&&(64512&(p=h.charCodeAt(m+1)))==56320&&(f=65536+(f-55296<<10)+(p-56320),m++),f<128?d[g++]=f:(f<2048?d[g++]=192|f>>>6:(f<65536?d[g++]=224|f>>>12:(d[g++]=240|f>>>18,d[g++]=128|f>>>12&63),d[g++]=128|f>>>6&63),d[g++]=128|63&f);return d},r.buf2binstring=function(h){return c(h,h.length)},r.binstring2buf=function(h){for(var d=new i.Buf8(h.length),f=0,p=d.length;f<p;f++)d[f]=h.charCodeAt(f);return d},r.buf2string=function(h,d){var f,p,m,g,y=d||h.length,b=new Array(2*y);for(f=p=0;f<y;)if((m=h[f++])<128)b[p++]=m;else if(4<(g=u[m]))b[p++]=65533,f+=g-1;else{for(m&=g===2?31:g===3?15:7;1<g&&f<y;)m=m<<6|63&h[f++],g--;1<g?b[p++]=65533:m<65536?b[p++]=m:(m-=65536,b[p++]=55296|m>>10&1023,b[p++]=56320|1023&m)}return c(b,p)},r.utf8border=function(h,d){var f;for((d=d||h.length)>h.length&&(d=h.length),f=d-1;0<=f&&(192&h[f])==128;)f--;return f<0||f===0?d:f+u[h[f]]>d?f:d}},{"./common":41}],43:[function(e,s,r){s.exports=function(i,o,a,u){for(var l=65535&i|0,c=i>>>16&65535|0,h=0;a!==0;){for(a-=h=2e3<a?2e3:a;c=c+(l=l+o[u++]|0)|0,--h;);l%=65521,c%=65521}return l|c<<16|0}},{}],44:[function(e,s,r){s.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,s,r){var i=function(){for(var o,a=[],u=0;u<256;u++){o=u;for(var l=0;l<8;l++)o=1&o?3988292384^o>>>1:o>>>1;a[u]=o}return a}();s.exports=function(o,a,u,l){var c=i,h=l+u;o^=-1;for(var d=l;d<h;d++)o=o>>>8^c[255&(o^a[d])];return-1^o}},{}],46:[function(e,s,r){var i,o=e("../utils/common"),a=e("./trees"),u=e("./adler32"),l=e("./crc32"),c=e("./messages"),h=0,d=4,f=0,p=-2,m=-1,g=4,y=2,b=8,w=9,v=286,S=30,N=19,R=2*v+1,L=15,F=3,B=258,H=B+F+1,z=42,G=113,T=1,K=2,ht=3,rt=4;function gt(O,Nt){return O.msg=c[Nt],Nt}function at(O){return(O<<1)-(4<O?9:0)}function It(O){for(var Nt=O.length;0<=--Nt;)O[Nt]=0}function et(O){var Nt=O.state,xt=Nt.pending;xt>O.avail_out&&(xt=O.avail_out),xt!==0&&(o.arraySet(O.output,Nt.pending_buf,Nt.pending_out,xt,O.next_out),O.next_out+=xt,Nt.pending_out+=xt,O.total_out+=xt,O.avail_out-=xt,Nt.pending-=xt,Nt.pending===0&&(Nt.pending_out=0))}function st(O,Nt){a._tr_flush_block(O,0<=O.block_start?O.block_start:-1,O.strstart-O.block_start,Nt),O.block_start=O.strstart,et(O.strm)}function St(O,Nt){O.pending_buf[O.pending++]=Nt}function kt(O,Nt){O.pending_buf[O.pending++]=Nt>>>8&255,O.pending_buf[O.pending++]=255&Nt}function yt(O,Nt){var xt,q,j=O.max_chain_length,ft=O.strstart,At=O.prev_length,Rt=O.nice_match,bt=O.strstart>O.w_size-H?O.strstart-(O.w_size-H):0,Ut=O.window,qt=O.w_mask,zt=O.prev,ne=O.strstart+B,Te=Ut[ft+At-1],me=Ut[ft+At];O.prev_length>=O.good_match&&(j>>=2),Rt>O.lookahead&&(Rt=O.lookahead);do if(Ut[(xt=Nt)+At]===me&&Ut[xt+At-1]===Te&&Ut[xt]===Ut[ft]&&Ut[++xt]===Ut[ft+1]){ft+=2,xt++;do;while(Ut[++ft]===Ut[++xt]&&Ut[++ft]===Ut[++xt]&&Ut[++ft]===Ut[++xt]&&Ut[++ft]===Ut[++xt]&&Ut[++ft]===Ut[++xt]&&Ut[++ft]===Ut[++xt]&&Ut[++ft]===Ut[++xt]&&Ut[++ft]===Ut[++xt]&&ft<ne);if(q=B-(ne-ft),ft=ne-B,At<q){if(O.match_start=Nt,Rt<=(At=q))break;Te=Ut[ft+At-1],me=Ut[ft+At]}}while((Nt=zt[Nt&qt])>bt&&--j!=0);return At<=O.lookahead?At:O.lookahead}function Pt(O){var Nt,xt,q,j,ft,At,Rt,bt,Ut,qt,zt=O.w_size;do{if(j=O.window_size-O.lookahead-O.strstart,O.strstart>=zt+(zt-H)){for(o.arraySet(O.window,O.window,zt,zt,0),O.match_start-=zt,O.strstart-=zt,O.block_start-=zt,Nt=xt=O.hash_size;q=O.head[--Nt],O.head[Nt]=zt<=q?q-zt:0,--xt;);for(Nt=xt=zt;q=O.prev[--Nt],O.prev[Nt]=zt<=q?q-zt:0,--xt;);j+=zt}if(O.strm.avail_in===0)break;if(At=O.strm,Rt=O.window,bt=O.strstart+O.lookahead,Ut=j,qt=void 0,qt=At.avail_in,Ut<qt&&(qt=Ut),xt=qt===0?0:(At.avail_in-=qt,o.arraySet(Rt,At.input,At.next_in,qt,bt),At.state.wrap===1?At.adler=u(At.adler,Rt,qt,bt):At.state.wrap===2&&(At.adler=l(At.adler,Rt,qt,bt)),At.next_in+=qt,At.total_in+=qt,qt),O.lookahead+=xt,O.lookahead+O.insert>=F)for(ft=O.strstart-O.insert,O.ins_h=O.window[ft],O.ins_h=(O.ins_h<<O.hash_shift^O.window[ft+1])&O.hash_mask;O.insert&&(O.ins_h=(O.ins_h<<O.hash_shift^O.window[ft+F-1])&O.hash_mask,O.prev[ft&O.w_mask]=O.head[O.ins_h],O.head[O.ins_h]=ft,ft++,O.insert--,!(O.lookahead+O.insert<F)););}while(O.lookahead<H&&O.strm.avail_in!==0)}function Xt(O,Nt){for(var xt,q;;){if(O.lookahead<H){if(Pt(O),O.lookahead<H&&Nt===h)return T;if(O.lookahead===0)break}if(xt=0,O.lookahead>=F&&(O.ins_h=(O.ins_h<<O.hash_shift^O.window[O.strstart+F-1])&O.hash_mask,xt=O.prev[O.strstart&O.w_mask]=O.head[O.ins_h],O.head[O.ins_h]=O.strstart),xt!==0&&O.strstart-xt<=O.w_size-H&&(O.match_length=yt(O,xt)),O.match_length>=F)if(q=a._tr_tally(O,O.strstart-O.match_start,O.match_length-F),O.lookahead-=O.match_length,O.match_length<=O.max_lazy_match&&O.lookahead>=F){for(O.match_length--;O.strstart++,O.ins_h=(O.ins_h<<O.hash_shift^O.window[O.strstart+F-1])&O.hash_mask,xt=O.prev[O.strstart&O.w_mask]=O.head[O.ins_h],O.head[O.ins_h]=O.strstart,--O.match_length!=0;);O.strstart++}else O.strstart+=O.match_length,O.match_length=0,O.ins_h=O.window[O.strstart],O.ins_h=(O.ins_h<<O.hash_shift^O.window[O.strstart+1])&O.hash_mask;else q=a._tr_tally(O,0,O.window[O.strstart]),O.lookahead--,O.strstart++;if(q&&(st(O,!1),O.strm.avail_out===0))return T}return O.insert=O.strstart<F-1?O.strstart:F-1,Nt===d?(st(O,!0),O.strm.avail_out===0?ht:rt):O.last_lit&&(st(O,!1),O.strm.avail_out===0)?T:K}function Wt(O,Nt){for(var xt,q,j;;){if(O.lookahead<H){if(Pt(O),O.lookahead<H&&Nt===h)return T;if(O.lookahead===0)break}if(xt=0,O.lookahead>=F&&(O.ins_h=(O.ins_h<<O.hash_shift^O.window[O.strstart+F-1])&O.hash_mask,xt=O.prev[O.strstart&O.w_mask]=O.head[O.ins_h],O.head[O.ins_h]=O.strstart),O.prev_length=O.match_length,O.prev_match=O.match_start,O.match_length=F-1,xt!==0&&O.prev_length<O.max_lazy_match&&O.strstart-xt<=O.w_size-H&&(O.match_length=yt(O,xt),O.match_length<=5&&(O.strategy===1||O.match_length===F&&4096<O.strstart-O.match_start)&&(O.match_length=F-1)),O.prev_length>=F&&O.match_length<=O.prev_length){for(j=O.strstart+O.lookahead-F,q=a._tr_tally(O,O.strstart-1-O.prev_match,O.prev_length-F),O.lookahead-=O.prev_length-1,O.prev_length-=2;++O.strstart<=j&&(O.ins_h=(O.ins_h<<O.hash_shift^O.window[O.strstart+F-1])&O.hash_mask,xt=O.prev[O.strstart&O.w_mask]=O.head[O.ins_h],O.head[O.ins_h]=O.strstart),--O.prev_length!=0;);if(O.match_available=0,O.match_length=F-1,O.strstart++,q&&(st(O,!1),O.strm.avail_out===0))return T}else if(O.match_available){if((q=a._tr_tally(O,0,O.window[O.strstart-1]))&&st(O,!1),O.strstart++,O.lookahead--,O.strm.avail_out===0)return T}else O.match_available=1,O.strstart++,O.lookahead--}return O.match_available&&(q=a._tr_tally(O,0,O.window[O.strstart-1]),O.match_available=0),O.insert=O.strstart<F-1?O.strstart:F-1,Nt===d?(st(O,!0),O.strm.avail_out===0?ht:rt):O.last_lit&&(st(O,!1),O.strm.avail_out===0)?T:K}function Bt(O,Nt,xt,q,j){this.good_length=O,this.max_lazy=Nt,this.nice_length=xt,this.max_chain=q,this.func=j}function Jt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=b,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*R),this.dyn_dtree=new o.Buf16(2*(2*S+1)),this.bl_tree=new o.Buf16(2*(2*N+1)),It(this.dyn_ltree),It(this.dyn_dtree),It(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(L+1),this.heap=new o.Buf16(2*v+1),It(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*v+1),It(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function jt(O){var Nt;return O&&O.state?(O.total_in=O.total_out=0,O.data_type=y,(Nt=O.state).pending=0,Nt.pending_out=0,Nt.wrap<0&&(Nt.wrap=-Nt.wrap),Nt.status=Nt.wrap?z:G,O.adler=Nt.wrap===2?0:1,Nt.last_flush=h,a._tr_init(Nt),f):gt(O,p)}function be(O){var Nt=jt(O);return Nt===f&&function(xt){xt.window_size=2*xt.w_size,It(xt.head),xt.max_lazy_match=i[xt.level].max_lazy,xt.good_match=i[xt.level].good_length,xt.nice_match=i[xt.level].nice_length,xt.max_chain_length=i[xt.level].max_chain,xt.strstart=0,xt.block_start=0,xt.lookahead=0,xt.insert=0,xt.match_length=xt.prev_length=F-1,xt.match_available=0,xt.ins_h=0}(O.state),Nt}function ce(O,Nt,xt,q,j,ft){if(!O)return p;var At=1;if(Nt===m&&(Nt=6),q<0?(At=0,q=-q):15<q&&(At=2,q-=16),j<1||w<j||xt!==b||q<8||15<q||Nt<0||9<Nt||ft<0||g<ft)return gt(O,p);q===8&&(q=9);var Rt=new Jt;return(O.state=Rt).strm=O,Rt.wrap=At,Rt.gzhead=null,Rt.w_bits=q,Rt.w_size=1<<Rt.w_bits,Rt.w_mask=Rt.w_size-1,Rt.hash_bits=j+7,Rt.hash_size=1<<Rt.hash_bits,Rt.hash_mask=Rt.hash_size-1,Rt.hash_shift=~~((Rt.hash_bits+F-1)/F),Rt.window=new o.Buf8(2*Rt.w_size),Rt.head=new o.Buf16(Rt.hash_size),Rt.prev=new o.Buf16(Rt.w_size),Rt.lit_bufsize=1<<j+6,Rt.pending_buf_size=4*Rt.lit_bufsize,Rt.pending_buf=new o.Buf8(Rt.pending_buf_size),Rt.d_buf=1*Rt.lit_bufsize,Rt.l_buf=3*Rt.lit_bufsize,Rt.level=Nt,Rt.strategy=ft,Rt.method=xt,be(O)}i=[new Bt(0,0,0,0,function(O,Nt){var xt=65535;for(xt>O.pending_buf_size-5&&(xt=O.pending_buf_size-5);;){if(O.lookahead<=1){if(Pt(O),O.lookahead===0&&Nt===h)return T;if(O.lookahead===0)break}O.strstart+=O.lookahead,O.lookahead=0;var q=O.block_start+xt;if((O.strstart===0||O.strstart>=q)&&(O.lookahead=O.strstart-q,O.strstart=q,st(O,!1),O.strm.avail_out===0)||O.strstart-O.block_start>=O.w_size-H&&(st(O,!1),O.strm.avail_out===0))return T}return O.insert=0,Nt===d?(st(O,!0),O.strm.avail_out===0?ht:rt):(O.strstart>O.block_start&&(st(O,!1),O.strm.avail_out),T)}),new Bt(4,4,8,4,Xt),new Bt(4,5,16,8,Xt),new Bt(4,6,32,32,Xt),new Bt(4,4,16,16,Wt),new Bt(8,16,32,32,Wt),new Bt(8,16,128,128,Wt),new Bt(8,32,128,256,Wt),new Bt(32,128,258,1024,Wt),new Bt(32,258,258,4096,Wt)],r.deflateInit=function(O,Nt){return ce(O,Nt,b,15,8,0)},r.deflateInit2=ce,r.deflateReset=be,r.deflateResetKeep=jt,r.deflateSetHeader=function(O,Nt){return O&&O.state?O.state.wrap!==2?p:(O.state.gzhead=Nt,f):p},r.deflate=function(O,Nt){var xt,q,j,ft;if(!O||!O.state||5<Nt||Nt<0)return O?gt(O,p):p;if(q=O.state,!O.output||!O.input&&O.avail_in!==0||q.status===666&&Nt!==d)return gt(O,O.avail_out===0?-5:p);if(q.strm=O,xt=q.last_flush,q.last_flush=Nt,q.status===z)if(q.wrap===2)O.adler=0,St(q,31),St(q,139),St(q,8),q.gzhead?(St(q,(q.gzhead.text?1:0)+(q.gzhead.hcrc?2:0)+(q.gzhead.extra?4:0)+(q.gzhead.name?8:0)+(q.gzhead.comment?16:0)),St(q,255&q.gzhead.time),St(q,q.gzhead.time>>8&255),St(q,q.gzhead.time>>16&255),St(q,q.gzhead.time>>24&255),St(q,q.level===9?2:2<=q.strategy||q.level<2?4:0),St(q,255&q.gzhead.os),q.gzhead.extra&&q.gzhead.extra.length&&(St(q,255&q.gzhead.extra.length),St(q,q.gzhead.extra.length>>8&255)),q.gzhead.hcrc&&(O.adler=l(O.adler,q.pending_buf,q.pending,0)),q.gzindex=0,q.status=69):(St(q,0),St(q,0),St(q,0),St(q,0),St(q,0),St(q,q.level===9?2:2<=q.strategy||q.level<2?4:0),St(q,3),q.status=G);else{var At=b+(q.w_bits-8<<4)<<8;At|=(2<=q.strategy||q.level<2?0:q.level<6?1:q.level===6?2:3)<<6,q.strstart!==0&&(At|=32),At+=31-At%31,q.status=G,kt(q,At),q.strstart!==0&&(kt(q,O.adler>>>16),kt(q,65535&O.adler)),O.adler=1}if(q.status===69)if(q.gzhead.extra){for(j=q.pending;q.gzindex<(65535&q.gzhead.extra.length)&&(q.pending!==q.pending_buf_size||(q.gzhead.hcrc&&q.pending>j&&(O.adler=l(O.adler,q.pending_buf,q.pending-j,j)),et(O),j=q.pending,q.pending!==q.pending_buf_size));)St(q,255&q.gzhead.extra[q.gzindex]),q.gzindex++;q.gzhead.hcrc&&q.pending>j&&(O.adler=l(O.adler,q.pending_buf,q.pending-j,j)),q.gzindex===q.gzhead.extra.length&&(q.gzindex=0,q.status=73)}else q.status=73;if(q.status===73)if(q.gzhead.name){j=q.pending;do{if(q.pending===q.pending_buf_size&&(q.gzhead.hcrc&&q.pending>j&&(O.adler=l(O.adler,q.pending_buf,q.pending-j,j)),et(O),j=q.pending,q.pending===q.pending_buf_size)){ft=1;break}ft=q.gzindex<q.gzhead.name.length?255&q.gzhead.name.charCodeAt(q.gzindex++):0,St(q,ft)}while(ft!==0);q.gzhead.hcrc&&q.pending>j&&(O.adler=l(O.adler,q.pending_buf,q.pending-j,j)),ft===0&&(q.gzindex=0,q.status=91)}else q.status=91;if(q.status===91)if(q.gzhead.comment){j=q.pending;do{if(q.pending===q.pending_buf_size&&(q.gzhead.hcrc&&q.pending>j&&(O.adler=l(O.adler,q.pending_buf,q.pending-j,j)),et(O),j=q.pending,q.pending===q.pending_buf_size)){ft=1;break}ft=q.gzindex<q.gzhead.comment.length?255&q.gzhead.comment.charCodeAt(q.gzindex++):0,St(q,ft)}while(ft!==0);q.gzhead.hcrc&&q.pending>j&&(O.adler=l(O.adler,q.pending_buf,q.pending-j,j)),ft===0&&(q.status=103)}else q.status=103;if(q.status===103&&(q.gzhead.hcrc?(q.pending+2>q.pending_buf_size&&et(O),q.pending+2<=q.pending_buf_size&&(St(q,255&O.adler),St(q,O.adler>>8&255),O.adler=0,q.status=G)):q.status=G),q.pending!==0){if(et(O),O.avail_out===0)return q.last_flush=-1,f}else if(O.avail_in===0&&at(Nt)<=at(xt)&&Nt!==d)return gt(O,-5);if(q.status===666&&O.avail_in!==0)return gt(O,-5);if(O.avail_in!==0||q.lookahead!==0||Nt!==h&&q.status!==666){var Rt=q.strategy===2?function(bt,Ut){for(var qt;;){if(bt.lookahead===0&&(Pt(bt),bt.lookahead===0)){if(Ut===h)return T;break}if(bt.match_length=0,qt=a._tr_tally(bt,0,bt.window[bt.strstart]),bt.lookahead--,bt.strstart++,qt&&(st(bt,!1),bt.strm.avail_out===0))return T}return bt.insert=0,Ut===d?(st(bt,!0),bt.strm.avail_out===0?ht:rt):bt.last_lit&&(st(bt,!1),bt.strm.avail_out===0)?T:K}(q,Nt):q.strategy===3?function(bt,Ut){for(var qt,zt,ne,Te,me=bt.window;;){if(bt.lookahead<=B){if(Pt(bt),bt.lookahead<=B&&Ut===h)return T;if(bt.lookahead===0)break}if(bt.match_length=0,bt.lookahead>=F&&0<bt.strstart&&(zt=me[ne=bt.strstart-1])===me[++ne]&&zt===me[++ne]&&zt===me[++ne]){Te=bt.strstart+B;do;while(zt===me[++ne]&&zt===me[++ne]&&zt===me[++ne]&&zt===me[++ne]&&zt===me[++ne]&&zt===me[++ne]&&zt===me[++ne]&&zt===me[++ne]&&ne<Te);bt.match_length=B-(Te-ne),bt.match_length>bt.lookahead&&(bt.match_length=bt.lookahead)}if(bt.match_length>=F?(qt=a._tr_tally(bt,1,bt.match_length-F),bt.lookahead-=bt.match_length,bt.strstart+=bt.match_length,bt.match_length=0):(qt=a._tr_tally(bt,0,bt.window[bt.strstart]),bt.lookahead--,bt.strstart++),qt&&(st(bt,!1),bt.strm.avail_out===0))return T}return bt.insert=0,Ut===d?(st(bt,!0),bt.strm.avail_out===0?ht:rt):bt.last_lit&&(st(bt,!1),bt.strm.avail_out===0)?T:K}(q,Nt):i[q.level].func(q,Nt);if(Rt!==ht&&Rt!==rt||(q.status=666),Rt===T||Rt===ht)return O.avail_out===0&&(q.last_flush=-1),f;if(Rt===K&&(Nt===1?a._tr_align(q):Nt!==5&&(a._tr_stored_block(q,0,0,!1),Nt===3&&(It(q.head),q.lookahead===0&&(q.strstart=0,q.block_start=0,q.insert=0))),et(O),O.avail_out===0))return q.last_flush=-1,f}return Nt!==d?f:q.wrap<=0?1:(q.wrap===2?(St(q,255&O.adler),St(q,O.adler>>8&255),St(q,O.adler>>16&255),St(q,O.adler>>24&255),St(q,255&O.total_in),St(q,O.total_in>>8&255),St(q,O.total_in>>16&255),St(q,O.total_in>>24&255)):(kt(q,O.adler>>>16),kt(q,65535&O.adler)),et(O),0<q.wrap&&(q.wrap=-q.wrap),q.pending!==0?f:1)},r.deflateEnd=function(O){var Nt;return O&&O.state?(Nt=O.state.status)!==z&&Nt!==69&&Nt!==73&&Nt!==91&&Nt!==103&&Nt!==G&&Nt!==666?gt(O,p):(O.state=null,Nt===G?gt(O,-3):f):p},r.deflateSetDictionary=function(O,Nt){var xt,q,j,ft,At,Rt,bt,Ut,qt=Nt.length;if(!O||!O.state||(ft=(xt=O.state).wrap)===2||ft===1&&xt.status!==z||xt.lookahead)return p;for(ft===1&&(O.adler=u(O.adler,Nt,qt,0)),xt.wrap=0,qt>=xt.w_size&&(ft===0&&(It(xt.head),xt.strstart=0,xt.block_start=0,xt.insert=0),Ut=new o.Buf8(xt.w_size),o.arraySet(Ut,Nt,qt-xt.w_size,xt.w_size,0),Nt=Ut,qt=xt.w_size),At=O.avail_in,Rt=O.next_in,bt=O.input,O.avail_in=qt,O.next_in=0,O.input=Nt,Pt(xt);xt.lookahead>=F;){for(q=xt.strstart,j=xt.lookahead-(F-1);xt.ins_h=(xt.ins_h<<xt.hash_shift^xt.window[q+F-1])&xt.hash_mask,xt.prev[q&xt.w_mask]=xt.head[xt.ins_h],xt.head[xt.ins_h]=q,q++,--j;);xt.strstart=q,xt.lookahead=F-1,Pt(xt)}return xt.strstart+=xt.lookahead,xt.block_start=xt.strstart,xt.insert=xt.lookahead,xt.lookahead=0,xt.match_length=xt.prev_length=F-1,xt.match_available=0,O.next_in=Rt,O.input=bt,O.avail_in=At,xt.wrap=ft,f},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,s,r){s.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,s,r){s.exports=function(i,o){var a,u,l,c,h,d,f,p,m,g,y,b,w,v,S,N,R,L,F,B,H,z,G,T,K;a=i.state,u=i.next_in,T=i.input,l=u+(i.avail_in-5),c=i.next_out,K=i.output,h=c-(o-i.avail_out),d=c+(i.avail_out-257),f=a.dmax,p=a.wsize,m=a.whave,g=a.wnext,y=a.window,b=a.hold,w=a.bits,v=a.lencode,S=a.distcode,N=(1<<a.lenbits)-1,R=(1<<a.distbits)-1;t:do{w<15&&(b+=T[u++]<<w,w+=8,b+=T[u++]<<w,w+=8),L=v[b&N];e:for(;;){if(b>>>=F=L>>>24,w-=F,(F=L>>>16&255)===0)K[c++]=65535&L;else{if(!(16&F)){if(!(64&F)){L=v[(65535&L)+(b&(1<<F)-1)];continue e}if(32&F){a.mode=12;break t}i.msg="invalid literal/length code",a.mode=30;break t}B=65535&L,(F&=15)&&(w<F&&(b+=T[u++]<<w,w+=8),B+=b&(1<<F)-1,b>>>=F,w-=F),w<15&&(b+=T[u++]<<w,w+=8,b+=T[u++]<<w,w+=8),L=S[b&R];n:for(;;){if(b>>>=F=L>>>24,w-=F,!(16&(F=L>>>16&255))){if(!(64&F)){L=S[(65535&L)+(b&(1<<F)-1)];continue n}i.msg="invalid distance code",a.mode=30;break t}if(H=65535&L,w<(F&=15)&&(b+=T[u++]<<w,(w+=8)<F&&(b+=T[u++]<<w,w+=8)),f<(H+=b&(1<<F)-1)){i.msg="invalid distance too far back",a.mode=30;break t}if(b>>>=F,w-=F,(F=c-h)<H){if(m<(F=H-F)&&a.sane){i.msg="invalid distance too far back",a.mode=30;break t}if(G=y,(z=0)===g){if(z+=p-F,F<B){for(B-=F;K[c++]=y[z++],--F;);z=c-H,G=K}}else if(g<F){if(z+=p+g-F,(F-=g)<B){for(B-=F;K[c++]=y[z++],--F;);if(z=0,g<B){for(B-=F=g;K[c++]=y[z++],--F;);z=c-H,G=K}}}else if(z+=g-F,F<B){for(B-=F;K[c++]=y[z++],--F;);z=c-H,G=K}for(;2<B;)K[c++]=G[z++],K[c++]=G[z++],K[c++]=G[z++],B-=3;B&&(K[c++]=G[z++],1<B&&(K[c++]=G[z++]))}else{for(z=c-H;K[c++]=K[z++],K[c++]=K[z++],K[c++]=K[z++],2<(B-=3););B&&(K[c++]=K[z++],1<B&&(K[c++]=K[z++]))}break}}break}}while(u<l&&c<d);u-=B=w>>3,b&=(1<<(w-=B<<3))-1,i.next_in=u,i.next_out=c,i.avail_in=u<l?l-u+5:5-(u-l),i.avail_out=c<d?d-c+257:257-(c-d),a.hold=b,a.bits=w}},{}],49:[function(e,s,r){var i=e("../utils/common"),o=e("./adler32"),a=e("./crc32"),u=e("./inffast"),l=e("./inftrees"),c=1,h=2,d=0,f=-2,p=1,m=852,g=592;function y(z){return(z>>>24&255)+(z>>>8&65280)+((65280&z)<<8)+((255&z)<<24)}function b(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function w(z){var G;return z&&z.state?(G=z.state,z.total_in=z.total_out=G.total=0,z.msg="",G.wrap&&(z.adler=1&G.wrap),G.mode=p,G.last=0,G.havedict=0,G.dmax=32768,G.head=null,G.hold=0,G.bits=0,G.lencode=G.lendyn=new i.Buf32(m),G.distcode=G.distdyn=new i.Buf32(g),G.sane=1,G.back=-1,d):f}function v(z){var G;return z&&z.state?((G=z.state).wsize=0,G.whave=0,G.wnext=0,w(z)):f}function S(z,G){var T,K;return z&&z.state?(K=z.state,G<0?(T=0,G=-G):(T=1+(G>>4),G<48&&(G&=15)),G&&(G<8||15<G)?f:(K.window!==null&&K.wbits!==G&&(K.window=null),K.wrap=T,K.wbits=G,v(z))):f}function N(z,G){var T,K;return z?(K=new b,(z.state=K).window=null,(T=S(z,G))!==d&&(z.state=null),T):f}var R,L,F=!0;function B(z){if(F){var G;for(R=new i.Buf32(512),L=new i.Buf32(32),G=0;G<144;)z.lens[G++]=8;for(;G<256;)z.lens[G++]=9;for(;G<280;)z.lens[G++]=7;for(;G<288;)z.lens[G++]=8;for(l(c,z.lens,0,288,R,0,z.work,{bits:9}),G=0;G<32;)z.lens[G++]=5;l(h,z.lens,0,32,L,0,z.work,{bits:5}),F=!1}z.lencode=R,z.lenbits=9,z.distcode=L,z.distbits=5}function H(z,G,T,K){var ht,rt=z.state;return rt.window===null&&(rt.wsize=1<<rt.wbits,rt.wnext=0,rt.whave=0,rt.window=new i.Buf8(rt.wsize)),K>=rt.wsize?(i.arraySet(rt.window,G,T-rt.wsize,rt.wsize,0),rt.wnext=0,rt.whave=rt.wsize):(K<(ht=rt.wsize-rt.wnext)&&(ht=K),i.arraySet(rt.window,G,T-K,ht,rt.wnext),(K-=ht)?(i.arraySet(rt.window,G,T-K,K,0),rt.wnext=K,rt.whave=rt.wsize):(rt.wnext+=ht,rt.wnext===rt.wsize&&(rt.wnext=0),rt.whave<rt.wsize&&(rt.whave+=ht))),0}r.inflateReset=v,r.inflateReset2=S,r.inflateResetKeep=w,r.inflateInit=function(z){return N(z,15)},r.inflateInit2=N,r.inflate=function(z,G){var T,K,ht,rt,gt,at,It,et,st,St,kt,yt,Pt,Xt,Wt,Bt,Jt,jt,be,ce,O,Nt,xt,q,j=0,ft=new i.Buf8(4),At=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!z||!z.state||!z.output||!z.input&&z.avail_in!==0)return f;(T=z.state).mode===12&&(T.mode=13),gt=z.next_out,ht=z.output,It=z.avail_out,rt=z.next_in,K=z.input,at=z.avail_in,et=T.hold,st=T.bits,St=at,kt=It,Nt=d;t:for(;;)switch(T.mode){case p:if(T.wrap===0){T.mode=13;break}for(;st<16;){if(at===0)break t;at--,et+=K[rt++]<<st,st+=8}if(2&T.wrap&&et===35615){ft[T.check=0]=255&et,ft[1]=et>>>8&255,T.check=a(T.check,ft,2,0),st=et=0,T.mode=2;break}if(T.flags=0,T.head&&(T.head.done=!1),!(1&T.wrap)||(((255&et)<<8)+(et>>8))%31){z.msg="incorrect header check",T.mode=30;break}if((15&et)!=8){z.msg="unknown compression method",T.mode=30;break}if(st-=4,O=8+(15&(et>>>=4)),T.wbits===0)T.wbits=O;else if(O>T.wbits){z.msg="invalid window size",T.mode=30;break}T.dmax=1<<O,z.adler=T.check=1,T.mode=512&et?10:12,st=et=0;break;case 2:for(;st<16;){if(at===0)break t;at--,et+=K[rt++]<<st,st+=8}if(T.flags=et,(255&T.flags)!=8){z.msg="unknown compression method",T.mode=30;break}if(57344&T.flags){z.msg="unknown header flags set",T.mode=30;break}T.head&&(T.head.text=et>>8&1),512&T.flags&&(ft[0]=255&et,ft[1]=et>>>8&255,T.check=a(T.check,ft,2,0)),st=et=0,T.mode=3;case 3:for(;st<32;){if(at===0)break t;at--,et+=K[rt++]<<st,st+=8}T.head&&(T.head.time=et),512&T.flags&&(ft[0]=255&et,ft[1]=et>>>8&255,ft[2]=et>>>16&255,ft[3]=et>>>24&255,T.check=a(T.check,ft,4,0)),st=et=0,T.mode=4;case 4:for(;st<16;){if(at===0)break t;at--,et+=K[rt++]<<st,st+=8}T.head&&(T.head.xflags=255&et,T.head.os=et>>8),512&T.flags&&(ft[0]=255&et,ft[1]=et>>>8&255,T.check=a(T.check,ft,2,0)),st=et=0,T.mode=5;case 5:if(1024&T.flags){for(;st<16;){if(at===0)break t;at--,et+=K[rt++]<<st,st+=8}T.length=et,T.head&&(T.head.extra_len=et),512&T.flags&&(ft[0]=255&et,ft[1]=et>>>8&255,T.check=a(T.check,ft,2,0)),st=et=0}else T.head&&(T.head.extra=null);T.mode=6;case 6:if(1024&T.flags&&(at<(yt=T.length)&&(yt=at),yt&&(T.head&&(O=T.head.extra_len-T.length,T.head.extra||(T.head.extra=new Array(T.head.extra_len)),i.arraySet(T.head.extra,K,rt,yt,O)),512&T.flags&&(T.check=a(T.check,K,yt,rt)),at-=yt,rt+=yt,T.length-=yt),T.length))break t;T.length=0,T.mode=7;case 7:if(2048&T.flags){if(at===0)break t;for(yt=0;O=K[rt+yt++],T.head&&O&&T.length<65536&&(T.head.name+=String.fromCharCode(O)),O&&yt<at;);if(512&T.flags&&(T.check=a(T.check,K,yt,rt)),at-=yt,rt+=yt,O)break t}else T.head&&(T.head.name=null);T.length=0,T.mode=8;case 8:if(4096&T.flags){if(at===0)break t;for(yt=0;O=K[rt+yt++],T.head&&O&&T.length<65536&&(T.head.comment+=String.fromCharCode(O)),O&&yt<at;);if(512&T.flags&&(T.check=a(T.check,K,yt,rt)),at-=yt,rt+=yt,O)break t}else T.head&&(T.head.comment=null);T.mode=9;case 9:if(512&T.flags){for(;st<16;){if(at===0)break t;at--,et+=K[rt++]<<st,st+=8}if(et!==(65535&T.check)){z.msg="header crc mismatch",T.mode=30;break}st=et=0}T.head&&(T.head.hcrc=T.flags>>9&1,T.head.done=!0),z.adler=T.check=0,T.mode=12;break;case 10:for(;st<32;){if(at===0)break t;at--,et+=K[rt++]<<st,st+=8}z.adler=T.check=y(et),st=et=0,T.mode=11;case 11:if(T.havedict===0)return z.next_out=gt,z.avail_out=It,z.next_in=rt,z.avail_in=at,T.hold=et,T.bits=st,2;z.adler=T.check=1,T.mode=12;case 12:if(G===5||G===6)break t;case 13:if(T.last){et>>>=7&st,st-=7&st,T.mode=27;break}for(;st<3;){if(at===0)break t;at--,et+=K[rt++]<<st,st+=8}switch(T.last=1&et,st-=1,3&(et>>>=1)){case 0:T.mode=14;break;case 1:if(B(T),T.mode=20,G!==6)break;et>>>=2,st-=2;break t;case 2:T.mode=17;break;case 3:z.msg="invalid block type",T.mode=30}et>>>=2,st-=2;break;case 14:for(et>>>=7&st,st-=7&st;st<32;){if(at===0)break t;at--,et+=K[rt++]<<st,st+=8}if((65535&et)!=(et>>>16^65535)){z.msg="invalid stored block lengths",T.mode=30;break}if(T.length=65535&et,st=et=0,T.mode=15,G===6)break t;case 15:T.mode=16;case 16:if(yt=T.length){if(at<yt&&(yt=at),It<yt&&(yt=It),yt===0)break t;i.arraySet(ht,K,rt,yt,gt),at-=yt,rt+=yt,It-=yt,gt+=yt,T.length-=yt;break}T.mode=12;break;case 17:for(;st<14;){if(at===0)break t;at--,et+=K[rt++]<<st,st+=8}if(T.nlen=257+(31&et),et>>>=5,st-=5,T.ndist=1+(31&et),et>>>=5,st-=5,T.ncode=4+(15&et),et>>>=4,st-=4,286<T.nlen||30<T.ndist){z.msg="too many length or distance symbols",T.mode=30;break}T.have=0,T.mode=18;case 18:for(;T.have<T.ncode;){for(;st<3;){if(at===0)break t;at--,et+=K[rt++]<<st,st+=8}T.lens[At[T.have++]]=7&et,et>>>=3,st-=3}for(;T.have<19;)T.lens[At[T.have++]]=0;if(T.lencode=T.lendyn,T.lenbits=7,xt={bits:T.lenbits},Nt=l(0,T.lens,0,19,T.lencode,0,T.work,xt),T.lenbits=xt.bits,Nt){z.msg="invalid code lengths set",T.mode=30;break}T.have=0,T.mode=19;case 19:for(;T.have<T.nlen+T.ndist;){for(;Bt=(j=T.lencode[et&(1<<T.lenbits)-1])>>>16&255,Jt=65535&j,!((Wt=j>>>24)<=st);){if(at===0)break t;at--,et+=K[rt++]<<st,st+=8}if(Jt<16)et>>>=Wt,st-=Wt,T.lens[T.have++]=Jt;else{if(Jt===16){for(q=Wt+2;st<q;){if(at===0)break t;at--,et+=K[rt++]<<st,st+=8}if(et>>>=Wt,st-=Wt,T.have===0){z.msg="invalid bit length repeat",T.mode=30;break}O=T.lens[T.have-1],yt=3+(3&et),et>>>=2,st-=2}else if(Jt===17){for(q=Wt+3;st<q;){if(at===0)break t;at--,et+=K[rt++]<<st,st+=8}st-=Wt,O=0,yt=3+(7&(et>>>=Wt)),et>>>=3,st-=3}else{for(q=Wt+7;st<q;){if(at===0)break t;at--,et+=K[rt++]<<st,st+=8}st-=Wt,O=0,yt=11+(127&(et>>>=Wt)),et>>>=7,st-=7}if(T.have+yt>T.nlen+T.ndist){z.msg="invalid bit length repeat",T.mode=30;break}for(;yt--;)T.lens[T.have++]=O}}if(T.mode===30)break;if(T.lens[256]===0){z.msg="invalid code -- missing end-of-block",T.mode=30;break}if(T.lenbits=9,xt={bits:T.lenbits},Nt=l(c,T.lens,0,T.nlen,T.lencode,0,T.work,xt),T.lenbits=xt.bits,Nt){z.msg="invalid literal/lengths set",T.mode=30;break}if(T.distbits=6,T.distcode=T.distdyn,xt={bits:T.distbits},Nt=l(h,T.lens,T.nlen,T.ndist,T.distcode,0,T.work,xt),T.distbits=xt.bits,Nt){z.msg="invalid distances set",T.mode=30;break}if(T.mode=20,G===6)break t;case 20:T.mode=21;case 21:if(6<=at&&258<=It){z.next_out=gt,z.avail_out=It,z.next_in=rt,z.avail_in=at,T.hold=et,T.bits=st,u(z,kt),gt=z.next_out,ht=z.output,It=z.avail_out,rt=z.next_in,K=z.input,at=z.avail_in,et=T.hold,st=T.bits,T.mode===12&&(T.back=-1);break}for(T.back=0;Bt=(j=T.lencode[et&(1<<T.lenbits)-1])>>>16&255,Jt=65535&j,!((Wt=j>>>24)<=st);){if(at===0)break t;at--,et+=K[rt++]<<st,st+=8}if(Bt&&!(240&Bt)){for(jt=Wt,be=Bt,ce=Jt;Bt=(j=T.lencode[ce+((et&(1<<jt+be)-1)>>jt)])>>>16&255,Jt=65535&j,!(jt+(Wt=j>>>24)<=st);){if(at===0)break t;at--,et+=K[rt++]<<st,st+=8}et>>>=jt,st-=jt,T.back+=jt}if(et>>>=Wt,st-=Wt,T.back+=Wt,T.length=Jt,Bt===0){T.mode=26;break}if(32&Bt){T.back=-1,T.mode=12;break}if(64&Bt){z.msg="invalid literal/length code",T.mode=30;break}T.extra=15&Bt,T.mode=22;case 22:if(T.extra){for(q=T.extra;st<q;){if(at===0)break t;at--,et+=K[rt++]<<st,st+=8}T.length+=et&(1<<T.extra)-1,et>>>=T.extra,st-=T.extra,T.back+=T.extra}T.was=T.length,T.mode=23;case 23:for(;Bt=(j=T.distcode[et&(1<<T.distbits)-1])>>>16&255,Jt=65535&j,!((Wt=j>>>24)<=st);){if(at===0)break t;at--,et+=K[rt++]<<st,st+=8}if(!(240&Bt)){for(jt=Wt,be=Bt,ce=Jt;Bt=(j=T.distcode[ce+((et&(1<<jt+be)-1)>>jt)])>>>16&255,Jt=65535&j,!(jt+(Wt=j>>>24)<=st);){if(at===0)break t;at--,et+=K[rt++]<<st,st+=8}et>>>=jt,st-=jt,T.back+=jt}if(et>>>=Wt,st-=Wt,T.back+=Wt,64&Bt){z.msg="invalid distance code",T.mode=30;break}T.offset=Jt,T.extra=15&Bt,T.mode=24;case 24:if(T.extra){for(q=T.extra;st<q;){if(at===0)break t;at--,et+=K[rt++]<<st,st+=8}T.offset+=et&(1<<T.extra)-1,et>>>=T.extra,st-=T.extra,T.back+=T.extra}if(T.offset>T.dmax){z.msg="invalid distance too far back",T.mode=30;break}T.mode=25;case 25:if(It===0)break t;if(yt=kt-It,T.offset>yt){if((yt=T.offset-yt)>T.whave&&T.sane){z.msg="invalid distance too far back",T.mode=30;break}Pt=yt>T.wnext?(yt-=T.wnext,T.wsize-yt):T.wnext-yt,yt>T.length&&(yt=T.length),Xt=T.window}else Xt=ht,Pt=gt-T.offset,yt=T.length;for(It<yt&&(yt=It),It-=yt,T.length-=yt;ht[gt++]=Xt[Pt++],--yt;);T.length===0&&(T.mode=21);break;case 26:if(It===0)break t;ht[gt++]=T.length,It--,T.mode=21;break;case 27:if(T.wrap){for(;st<32;){if(at===0)break t;at--,et|=K[rt++]<<st,st+=8}if(kt-=It,z.total_out+=kt,T.total+=kt,kt&&(z.adler=T.check=T.flags?a(T.check,ht,kt,gt-kt):o(T.check,ht,kt,gt-kt)),kt=It,(T.flags?et:y(et))!==T.check){z.msg="incorrect data check",T.mode=30;break}st=et=0}T.mode=28;case 28:if(T.wrap&&T.flags){for(;st<32;){if(at===0)break t;at--,et+=K[rt++]<<st,st+=8}if(et!==(4294967295&T.total)){z.msg="incorrect length check",T.mode=30;break}st=et=0}T.mode=29;case 29:Nt=1;break t;case 30:Nt=-3;break t;case 31:return-4;case 32:default:return f}return z.next_out=gt,z.avail_out=It,z.next_in=rt,z.avail_in=at,T.hold=et,T.bits=st,(T.wsize||kt!==z.avail_out&&T.mode<30&&(T.mode<27||G!==4))&&H(z,z.output,z.next_out,kt-z.avail_out)?(T.mode=31,-4):(St-=z.avail_in,kt-=z.avail_out,z.total_in+=St,z.total_out+=kt,T.total+=kt,T.wrap&&kt&&(z.adler=T.check=T.flags?a(T.check,ht,kt,z.next_out-kt):o(T.check,ht,kt,z.next_out-kt)),z.data_type=T.bits+(T.last?64:0)+(T.mode===12?128:0)+(T.mode===20||T.mode===15?256:0),(St==0&&kt===0||G===4)&&Nt===d&&(Nt=-5),Nt)},r.inflateEnd=function(z){if(!z||!z.state)return f;var G=z.state;return G.window&&(G.window=null),z.state=null,d},r.inflateGetHeader=function(z,G){var T;return z&&z.state&&2&(T=z.state).wrap?((T.head=G).done=!1,d):f},r.inflateSetDictionary=function(z,G){var T,K=G.length;return z&&z.state?(T=z.state).wrap!==0&&T.mode!==11?f:T.mode===11&&o(1,G,K,0)!==T.check?-3:H(z,G,K,K)?(T.mode=31,-4):(T.havedict=1,d):f},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,s,r){var i=e("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],u=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];s.exports=function(c,h,d,f,p,m,g,y){var b,w,v,S,N,R,L,F,B,H=y.bits,z=0,G=0,T=0,K=0,ht=0,rt=0,gt=0,at=0,It=0,et=0,st=null,St=0,kt=new i.Buf16(16),yt=new i.Buf16(16),Pt=null,Xt=0;for(z=0;z<=15;z++)kt[z]=0;for(G=0;G<f;G++)kt[h[d+G]]++;for(ht=H,K=15;1<=K&&kt[K]===0;K--);if(K<ht&&(ht=K),K===0)return p[m++]=20971520,p[m++]=20971520,y.bits=1,0;for(T=1;T<K&&kt[T]===0;T++);for(ht<T&&(ht=T),z=at=1;z<=15;z++)if(at<<=1,(at-=kt[z])<0)return-1;if(0<at&&(c===0||K!==1))return-1;for(yt[1]=0,z=1;z<15;z++)yt[z+1]=yt[z]+kt[z];for(G=0;G<f;G++)h[d+G]!==0&&(g[yt[h[d+G]]++]=G);if(R=c===0?(st=Pt=g,19):c===1?(st=o,St-=257,Pt=a,Xt-=257,256):(st=u,Pt=l,-1),z=T,N=m,gt=G=et=0,v=-1,S=(It=1<<(rt=ht))-1,c===1&&852<It||c===2&&592<It)return 1;for(;;){for(L=z-gt,B=g[G]<R?(F=0,g[G]):g[G]>R?(F=Pt[Xt+g[G]],st[St+g[G]]):(F=96,0),b=1<<z-gt,T=w=1<<rt;p[N+(et>>gt)+(w-=b)]=L<<24|F<<16|B|0,w!==0;);for(b=1<<z-1;et&b;)b>>=1;if(b!==0?(et&=b-1,et+=b):et=0,G++,--kt[z]==0){if(z===K)break;z=h[d+g[G]]}if(ht<z&&(et&S)!==v){for(gt===0&&(gt=ht),N+=T,at=1<<(rt=z-gt);rt+gt<K&&!((at-=kt[rt+gt])<=0);)rt++,at<<=1;if(It+=1<<rt,c===1&&852<It||c===2&&592<It)return 1;p[v=et&S]=ht<<24|rt<<16|N-m|0}}return et!==0&&(p[N+et]=z-gt<<24|64<<16|0),y.bits=ht,0}},{"../utils/common":41}],51:[function(e,s,r){s.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,s,r){var i=e("../utils/common"),o=0,a=1;function u(j){for(var ft=j.length;0<=--ft;)j[ft]=0}var l=0,c=29,h=256,d=h+1+c,f=30,p=19,m=2*d+1,g=15,y=16,b=7,w=256,v=16,S=17,N=18,R=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],L=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],F=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],B=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],H=new Array(2*(d+2));u(H);var z=new Array(2*f);u(z);var G=new Array(512);u(G);var T=new Array(256);u(T);var K=new Array(c);u(K);var ht,rt,gt,at=new Array(f);function It(j,ft,At,Rt,bt){this.static_tree=j,this.extra_bits=ft,this.extra_base=At,this.elems=Rt,this.max_length=bt,this.has_stree=j&&j.length}function et(j,ft){this.dyn_tree=j,this.max_code=0,this.stat_desc=ft}function st(j){return j<256?G[j]:G[256+(j>>>7)]}function St(j,ft){j.pending_buf[j.pending++]=255&ft,j.pending_buf[j.pending++]=ft>>>8&255}function kt(j,ft,At){j.bi_valid>y-At?(j.bi_buf|=ft<<j.bi_valid&65535,St(j,j.bi_buf),j.bi_buf=ft>>y-j.bi_valid,j.bi_valid+=At-y):(j.bi_buf|=ft<<j.bi_valid&65535,j.bi_valid+=At)}function yt(j,ft,At){kt(j,At[2*ft],At[2*ft+1])}function Pt(j,ft){for(var At=0;At|=1&j,j>>>=1,At<<=1,0<--ft;);return At>>>1}function Xt(j,ft,At){var Rt,bt,Ut=new Array(g+1),qt=0;for(Rt=1;Rt<=g;Rt++)Ut[Rt]=qt=qt+At[Rt-1]<<1;for(bt=0;bt<=ft;bt++){var zt=j[2*bt+1];zt!==0&&(j[2*bt]=Pt(Ut[zt]++,zt))}}function Wt(j){var ft;for(ft=0;ft<d;ft++)j.dyn_ltree[2*ft]=0;for(ft=0;ft<f;ft++)j.dyn_dtree[2*ft]=0;for(ft=0;ft<p;ft++)j.bl_tree[2*ft]=0;j.dyn_ltree[2*w]=1,j.opt_len=j.static_len=0,j.last_lit=j.matches=0}function Bt(j){8<j.bi_valid?St(j,j.bi_buf):0<j.bi_valid&&(j.pending_buf[j.pending++]=j.bi_buf),j.bi_buf=0,j.bi_valid=0}function Jt(j,ft,At,Rt){var bt=2*ft,Ut=2*At;return j[bt]<j[Ut]||j[bt]===j[Ut]&&Rt[ft]<=Rt[At]}function jt(j,ft,At){for(var Rt=j.heap[At],bt=At<<1;bt<=j.heap_len&&(bt<j.heap_len&&Jt(ft,j.heap[bt+1],j.heap[bt],j.depth)&&bt++,!Jt(ft,Rt,j.heap[bt],j.depth));)j.heap[At]=j.heap[bt],At=bt,bt<<=1;j.heap[At]=Rt}function be(j,ft,At){var Rt,bt,Ut,qt,zt=0;if(j.last_lit!==0)for(;Rt=j.pending_buf[j.d_buf+2*zt]<<8|j.pending_buf[j.d_buf+2*zt+1],bt=j.pending_buf[j.l_buf+zt],zt++,Rt===0?yt(j,bt,ft):(yt(j,(Ut=T[bt])+h+1,ft),(qt=R[Ut])!==0&&kt(j,bt-=K[Ut],qt),yt(j,Ut=st(--Rt),At),(qt=L[Ut])!==0&&kt(j,Rt-=at[Ut],qt)),zt<j.last_lit;);yt(j,w,ft)}function ce(j,ft){var At,Rt,bt,Ut=ft.dyn_tree,qt=ft.stat_desc.static_tree,zt=ft.stat_desc.has_stree,ne=ft.stat_desc.elems,Te=-1;for(j.heap_len=0,j.heap_max=m,At=0;At<ne;At++)Ut[2*At]!==0?(j.heap[++j.heap_len]=Te=At,j.depth[At]=0):Ut[2*At+1]=0;for(;j.heap_len<2;)Ut[2*(bt=j.heap[++j.heap_len]=Te<2?++Te:0)]=1,j.depth[bt]=0,j.opt_len--,zt&&(j.static_len-=qt[2*bt+1]);for(ft.max_code=Te,At=j.heap_len>>1;1<=At;At--)jt(j,Ut,At);for(bt=ne;At=j.heap[1],j.heap[1]=j.heap[j.heap_len--],jt(j,Ut,1),Rt=j.heap[1],j.heap[--j.heap_max]=At,j.heap[--j.heap_max]=Rt,Ut[2*bt]=Ut[2*At]+Ut[2*Rt],j.depth[bt]=(j.depth[At]>=j.depth[Rt]?j.depth[At]:j.depth[Rt])+1,Ut[2*At+1]=Ut[2*Rt+1]=bt,j.heap[1]=bt++,jt(j,Ut,1),2<=j.heap_len;);j.heap[--j.heap_max]=j.heap[1],function(me,on){var ms,$n,Bs,We,ln,en,Ye=on.dyn_tree,Fn=on.max_code,mr=on.stat_desc.static_tree,Ge=on.stat_desc.has_stree,Vs=on.stat_desc.extra_bits,qr=on.stat_desc.extra_base,Xn=on.stat_desc.max_length,_n=0;for(We=0;We<=g;We++)me.bl_count[We]=0;for(Ye[2*me.heap[me.heap_max]+1]=0,ms=me.heap_max+1;ms<m;ms++)Xn<(We=Ye[2*Ye[2*($n=me.heap[ms])+1]+1]+1)&&(We=Xn,_n++),Ye[2*$n+1]=We,Fn<$n||(me.bl_count[We]++,ln=0,qr<=$n&&(ln=Vs[$n-qr]),en=Ye[2*$n],me.opt_len+=en*(We+ln),Ge&&(me.static_len+=en*(mr[2*$n+1]+ln)));if(_n!==0){do{for(We=Xn-1;me.bl_count[We]===0;)We--;me.bl_count[We]--,me.bl_count[We+1]+=2,me.bl_count[Xn]--,_n-=2}while(0<_n);for(We=Xn;We!==0;We--)for($n=me.bl_count[We];$n!==0;)Fn<(Bs=me.heap[--ms])||(Ye[2*Bs+1]!==We&&(me.opt_len+=(We-Ye[2*Bs+1])*Ye[2*Bs],Ye[2*Bs+1]=We),$n--)}}(j,ft),Xt(Ut,Te,j.bl_count)}function O(j,ft,At){var Rt,bt,Ut=-1,qt=ft[1],zt=0,ne=7,Te=4;for(qt===0&&(ne=138,Te=3),ft[2*(At+1)+1]=65535,Rt=0;Rt<=At;Rt++)bt=qt,qt=ft[2*(Rt+1)+1],++zt<ne&&bt===qt||(zt<Te?j.bl_tree[2*bt]+=zt:bt!==0?(bt!==Ut&&j.bl_tree[2*bt]++,j.bl_tree[2*v]++):zt<=10?j.bl_tree[2*S]++:j.bl_tree[2*N]++,Ut=bt,Te=(zt=0)===qt?(ne=138,3):bt===qt?(ne=6,3):(ne=7,4))}function Nt(j,ft,At){var Rt,bt,Ut=-1,qt=ft[1],zt=0,ne=7,Te=4;for(qt===0&&(ne=138,Te=3),Rt=0;Rt<=At;Rt++)if(bt=qt,qt=ft[2*(Rt+1)+1],!(++zt<ne&&bt===qt)){if(zt<Te)for(;yt(j,bt,j.bl_tree),--zt!=0;);else bt!==0?(bt!==Ut&&(yt(j,bt,j.bl_tree),zt--),yt(j,v,j.bl_tree),kt(j,zt-3,2)):zt<=10?(yt(j,S,j.bl_tree),kt(j,zt-3,3)):(yt(j,N,j.bl_tree),kt(j,zt-11,7));Ut=bt,Te=(zt=0)===qt?(ne=138,3):bt===qt?(ne=6,3):(ne=7,4)}}u(at);var xt=!1;function q(j,ft,At,Rt){kt(j,(l<<1)+(Rt?1:0),3),function(bt,Ut,qt,zt){Bt(bt),zt&&(St(bt,qt),St(bt,~qt)),i.arraySet(bt.pending_buf,bt.window,Ut,qt,bt.pending),bt.pending+=qt}(j,ft,At,!0)}r._tr_init=function(j){xt||(function(){var ft,At,Rt,bt,Ut,qt=new Array(g+1);for(bt=Rt=0;bt<c-1;bt++)for(K[bt]=Rt,ft=0;ft<1<<R[bt];ft++)T[Rt++]=bt;for(T[Rt-1]=bt,bt=Ut=0;bt<16;bt++)for(at[bt]=Ut,ft=0;ft<1<<L[bt];ft++)G[Ut++]=bt;for(Ut>>=7;bt<f;bt++)for(at[bt]=Ut<<7,ft=0;ft<1<<L[bt]-7;ft++)G[256+Ut++]=bt;for(At=0;At<=g;At++)qt[At]=0;for(ft=0;ft<=143;)H[2*ft+1]=8,ft++,qt[8]++;for(;ft<=255;)H[2*ft+1]=9,ft++,qt[9]++;for(;ft<=279;)H[2*ft+1]=7,ft++,qt[7]++;for(;ft<=287;)H[2*ft+1]=8,ft++,qt[8]++;for(Xt(H,d+1,qt),ft=0;ft<f;ft++)z[2*ft+1]=5,z[2*ft]=Pt(ft,5);ht=new It(H,R,h+1,d,g),rt=new It(z,L,0,f,g),gt=new It(new Array(0),F,0,p,b)}(),xt=!0),j.l_desc=new et(j.dyn_ltree,ht),j.d_desc=new et(j.dyn_dtree,rt),j.bl_desc=new et(j.bl_tree,gt),j.bi_buf=0,j.bi_valid=0,Wt(j)},r._tr_stored_block=q,r._tr_flush_block=function(j,ft,At,Rt){var bt,Ut,qt=0;0<j.level?(j.strm.data_type===2&&(j.strm.data_type=function(zt){var ne,Te=4093624447;for(ne=0;ne<=31;ne++,Te>>>=1)if(1&Te&&zt.dyn_ltree[2*ne]!==0)return o;if(zt.dyn_ltree[18]!==0||zt.dyn_ltree[20]!==0||zt.dyn_ltree[26]!==0)return a;for(ne=32;ne<h;ne++)if(zt.dyn_ltree[2*ne]!==0)return a;return o}(j)),ce(j,j.l_desc),ce(j,j.d_desc),qt=function(zt){var ne;for(O(zt,zt.dyn_ltree,zt.l_desc.max_code),O(zt,zt.dyn_dtree,zt.d_desc.max_code),ce(zt,zt.bl_desc),ne=p-1;3<=ne&&zt.bl_tree[2*B[ne]+1]===0;ne--);return zt.opt_len+=3*(ne+1)+5+5+4,ne}(j),bt=j.opt_len+3+7>>>3,(Ut=j.static_len+3+7>>>3)<=bt&&(bt=Ut)):bt=Ut=At+5,At+4<=bt&&ft!==-1?q(j,ft,At,Rt):j.strategy===4||Ut===bt?(kt(j,2+(Rt?1:0),3),be(j,H,z)):(kt(j,4+(Rt?1:0),3),function(zt,ne,Te,me){var on;for(kt(zt,ne-257,5),kt(zt,Te-1,5),kt(zt,me-4,4),on=0;on<me;on++)kt(zt,zt.bl_tree[2*B[on]+1],3);Nt(zt,zt.dyn_ltree,ne-1),Nt(zt,zt.dyn_dtree,Te-1)}(j,j.l_desc.max_code+1,j.d_desc.max_code+1,qt+1),be(j,j.dyn_ltree,j.dyn_dtree)),Wt(j),Rt&&Bt(j)},r._tr_tally=function(j,ft,At){return j.pending_buf[j.d_buf+2*j.last_lit]=ft>>>8&255,j.pending_buf[j.d_buf+2*j.last_lit+1]=255&ft,j.pending_buf[j.l_buf+j.last_lit]=255&At,j.last_lit++,ft===0?j.dyn_ltree[2*At]++:(j.matches++,ft--,j.dyn_ltree[2*(T[At]+h+1)]++,j.dyn_dtree[2*st(ft)]++),j.last_lit===j.lit_bufsize-1},r._tr_align=function(j){kt(j,2,3),yt(j,w,H),function(ft){ft.bi_valid===16?(St(ft,ft.bi_buf),ft.bi_buf=0,ft.bi_valid=0):8<=ft.bi_valid&&(ft.pending_buf[ft.pending++]=255&ft.bi_buf,ft.bi_buf>>=8,ft.bi_valid-=8)}(j)}},{"../utils/common":41}],53:[function(e,s,r){s.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,s,r){(function(i){(function(o,a){if(!o.setImmediate){var u,l,c,h,d=1,f={},p=!1,m=o.document,g=Object.getPrototypeOf&&Object.getPrototypeOf(o);g=g&&g.setTimeout?g:o,u={}.toString.call(o.process)==="[object process]"?function(v){process.nextTick(function(){b(v)})}:function(){if(o.postMessage&&!o.importScripts){var v=!0,S=o.onmessage;return o.onmessage=function(){v=!1},o.postMessage("","*"),o.onmessage=S,v}}()?(h="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",w,!1):o.attachEvent("onmessage",w),function(v){o.postMessage(h+v,"*")}):o.MessageChannel?((c=new MessageChannel).port1.onmessage=function(v){b(v.data)},function(v){c.port2.postMessage(v)}):m&&"onreadystatechange"in m.createElement("script")?(l=m.documentElement,function(v){var S=m.createElement("script");S.onreadystatechange=function(){b(v),S.onreadystatechange=null,l.removeChild(S),S=null},l.appendChild(S)}):function(v){setTimeout(b,0,v)},g.setImmediate=function(v){typeof v!="function"&&(v=new Function(""+v));for(var S=new Array(arguments.length-1),N=0;N<S.length;N++)S[N]=arguments[N+1];var R={callback:v,args:S};return f[d]=R,u(d),d++},g.clearImmediate=y}function y(v){delete f[v]}function b(v){if(p)setTimeout(b,0,v);else{var S=f[v];if(S){p=!0;try{(function(N){var R=N.callback,L=N.args;switch(L.length){case 0:R();break;case 1:R(L[0]);break;case 2:R(L[0],L[1]);break;case 3:R(L[0],L[1],L[2]);break;default:R.apply(a,L)}})(S)}finally{y(v),p=!1}}}}function w(v){v.source===o&&typeof v.data=="string"&&v.data.indexOf(h)===0&&b(+v.data.slice(h.length))}})(typeof self>"u"?i===void 0?this:i:self)}).call(this,typeof ks<"u"?ks:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(PC);var Det=PC.exports;const Oet=ax(Det);let sx;const Fet=ox({name:"index",data(){return{message:"Sto inizializzando l'app, si prega di attendere qualche secondo",appReady:!1,sources:[],elaborating:!1,removeBg:!1,progress:0,PAD:.5,elaboratingReport:!1,elaboratingZip:!1}},async mounted(){this.appReady=!0,this.message="App pronta!"},async beforeMount(){sx=await gc.getInstance()},methods:{async loadImage(n){console.log("loadImage"),this.progress=0;const t=Array.from(n.target.files);this.message=`Sto elaborando ${t.length} immagini, attendere.`;const e=new Date().getTime();if(this.elaborating=!0,t.length>0)for(let r=0;r<t.length;r++){let i=await sx.processImage(t[r],this.removeBg);i&&this.sources.push(i),this.progress=Math.floor((r+1)/t.length*100)}this.elaborating=!1;const s=new Date().getTime();this.message=`Ho elaborato ${t.length} immagini in ${(s-e)/1e3}s.`},generateReport(){this.elaboratingReport=!0;let n=`riferimento;motivazione_scarto
`;n=this.sources.reduce((e,s,r)=>s.toRemove?e+`${s.fileName};${s.toRemoveMotivation}
`:e+"",n);const t=new Blob([n],{type:"text/csv;charset=utf-8"});zg(t,"report.csv"),this.elaboratingReport=!1},async downloadAll(){this.elaboratingZip=!0;const n=new Oet;let t=this.sources.filter(s=>!s.toRemove);for(let s=0;s<t.length;s++){const r=t[s];let i=await(await fetch(r.finalSrc)).blob(),o=new Blob([i],{type:"image/jpeg"});n.file(r.fileName+".jpeg",o)}let e=await n.generateAsync({type:"blob"});zg(e,"images.zip"),this.elaboratingZip=!1}}},"$bGYB3Aqdvs"),Let={id:"main",class:"container"},Pet=_e("h1",{class:"mt-3 mb-3"},[Yi("Project No More Ugly Faces "),_e("sup",{class:"text-danger"},"Beta")],-1),Met={class:"form"},zet={class:"row mb-3"},Bet={class:"col"},Vet=_e("label",{for:"uploadInput",class:"form-label"},"Upload immagini.",-1),Uet=["disabled"],Wet={class:"row mb-2"},Get={class:"col"},jet=["disabled"],Het=_e("label",{class:"form-check-label",for:"removeBgCheck"},[Yi(" Rimuovi sfondo "),_e("sup",{class:"text-danger"},"Beta")],-1),Ket={class:"mb-3"},qet={key:0,class:"fa-solid fa-spinner fa-spin"},Xet=["aria-valuenow"],Yet={class:"results-wrapper"},Zet={key:0,class:"card mb-2 placeholder-glow"},Jet=oN('<div class="card-header"><span class="placeholder w-25"></span></div><div class="card-body"><span class="placeholder image me-5"></span><span class="placeholder image"></span></div>',2),Qet=[Jet],tnt={key:1,class:"cta-wrapper mb-5"},ent=["disabled"],nnt={key:0},snt=_e("i",{class:"fa-solid fa-file-csv"},null,-1),rnt={key:1},int=_e("i",{class:"fa-solid fa-spinner fa-spin"},null,-1),ont=["disabled"],ant={key:0},unt=_e("i",{class:"fa-solid fa-file-zipper"},null,-1),lnt={key:1},cnt=_e("i",{class:"fa-solid fa-spinner fa-spin"},null,-1);function hnt(n,t,e,s,r,i){const o=Ret;return vs(),Ns("div",Let,[Pet,_e("div",Met,[_e("div",zet,[_e("div",Bet,[Vet,_e("input",{disabled:!n.appReady||n.elaborating,multiple:"",type:"file",class:"form-control",id:"uploadInput",accept:"image/*",onChange:t[0]||(t[0]=(...a)=>n.loadImage&&n.loadImage(...a)),"aria-describedby":"fileHelp"},null,40,Uet)]),Ti("",!0)]),_e("div",Wet,[_e("div",Get,[Yd(_e("input",{disabled:!n.appReady||n.elaborating,class:"me-2","onUpdate:modelValue":t[2]||(t[2]=a=>n.removeBg=a),type:"checkbox",id:"removeBgCheck"},null,8,jet),[[rx,n.removeBg]]),Het])])]),_e("div",Ket,[Yi(Mg(n.message)+" ",1),!n.appReady||n.elaborating?(vs(),Ns("i",qet)):Ti("",!0)]),n.elaborating?(vs(),Ns("div",{key:0,class:"progress mb-3",role:"progressbar","aria-label":"Example with label","aria-valuenow":n.progress,"aria-valuemin":"0","aria-valuemax":"100"},[_e("div",{class:"progress-bar",style:nN({width:n.progress+"%"})},Mg(n.progress)+"%",5)],8,Xet)):Ti("",!0),_e("div",Yet,[(vs(!0),Ns(sN,null,rN(n.sources,(a,u)=>(vs(),iN(o,{PAD:n.PAD,source:a,index:u,key:u},null,8,["PAD","source","index"]))),128)),n.elaborating?(vs(),Ns("div",Zet,Qet)):Ti("",!0)]),n.sources.length>0?(vs(),Ns("div",tnt,[_e("button",{type:"button",onClick:t[3]||(t[3]=a=>n.generateReport()),disabled:n.elaborating,class:"btn btn-light me-3"},[n.elaboratingReport?(vs(),Ns("span",rnt,[Yi("Sto generando il report   "),int])):(vs(),Ns("span",nnt,[Yi("Genera Report   "),snt]))],8,ent),_e("button",{type:"button",onClick:t[4]||(t[4]=a=>n.downloadAll()),disabled:n.elaborating,class:"btn btn-light"},[n.elaboratingZip?(vs(),Ns("span",lnt,[Yi("Sto generando lo zip   "),cnt])):(vs(),Ns("span",ant,[Yi("Scarica risultati   "),unt]))],8,ont)])):Ti("",!0)])}const xnt=ix(Fet,[["render",hnt]]);export{xnt as default};
